{"version":3,"names":["scaleElementsByFactor","array","factor","i","length","countBits","n","isPowerOf2","Error","Math","round","log","inverseRealFourierTransform","fullArrayLength","totalPasses","pass","subStride","midSubStride","stride","radiansIncrement","PI","cosIncrement","cos","sinIncrement","sin","oscillatorMultiplier","startIndex","startIndexA","midIndexA","startIndexB","midIndexB","stopIndex","realStartA","imagStartB","c","s","cPrev","sPrev","index","indexA0","indexA1","indexB0","indexB1","real0","real1","imag0","imag1","tempA","tempB","cTemp","sTemp","index1","index2","index3","imag2","imag3","bitCount","finalShift","j","temp","reverseIndexBits","Config","_centerWave","wave","sum","average","Float64Array","getDrumWave","_drumWaves","Float32Array","drumBuffer","newBuffer","random","drawNoiseSpectrum","sqrt","lowOctave","highOctave","lowPower","highPower","overalSlope","lowIndex","pow","highIndex","log2","amplitude","radians","generateSineWave","sineWaveLength","toNameMap","dictionary","value","name","result","scales","realName","flags","blackKeyNameParents","pitchNames","oldKeys","keys","isWhiteKey","basePitch","mixNames","sampleRateNames","tempoMin","tempoMax","reverbRange","blendRange","riffRange","detuneRange","muffRange","beatsPerBarMin","beatsPerBarMax","barCountMin","barCountMax","patternsPerChannelMin","patternsPerChannelMax","instrumentsPerChannelMin","instrumentsPerChannelMax","pitchesPerOctave","drumCount","pitchOctaves","partNames","partCounts","waveNames","waveVolumes","drumNames","drumVolumes","drumBasePitches","drumPitchFilterMult","drumWaveIsSoft","pwmwaveNames","pwmwaveVolumes","filterNames","filterBases","filterDecays","filterVolumes","transitionNames","effectNames","effectVibratos","effectTremolos","effectVibratoDelays","chorusNames","chorusIntervals","chorusOffsets","chorusVolumes","chorusSigns","chorusRiffApp","chorusHarmonizes","harmDisplay","harmNames","fmChorusDisplay","fmChorusNames","imuteNames","imuteValues","octoffNames","octoffValues","volumeNames","volumeValues","volumeMValues","ipanValues","operatorCount","operatorAlgorithmNames","midiAlgorithmNames","operatorModulatedBy","operatorAssociatedCarrier","operatorCarrierCounts","operatorCarrierChorus","operatorAmplitudeMax","operatorFrequencyNames","midiFrequencyNames","operatorFrequencies","operatorHzOffsets","operatorAmplitudeSigns","operatorEnvelopeNames","operatorEnvelopeType","operatorSpecialCustomVolume","operatorEnvelopeSpeed","operatorEnvelopeInverted","operatorFeedbackNames","midiFeedbackNames","operatorFeedbackIndices","pitchChannelTypeNames","pitchChannelTypeValues","drumChannelTypeNames","instrumentTypeNames","oldThemeNames","channelOneBrightColorPallet","channelTwoBrightColorPallet","channelThreeBrightColorPallet","channelFourBrightColorPallet","channelFiveBrightColorPallet","channelSixBrightColorPallet","channelSevenBrightColorPallet","channelEightBrightColorPallet","channelNineBrightColorPallet","channelTenBrightColorPallet","channelElevenBrightColorPallet","channelTwelveBrightColorPallet","channelThirteenBrightColorPallet","channelFourteenBrightColorPallet","channelFifteenBrightColorPallet","channelSixteenBrightColorPallet","channelOneDimColorPallet","channelTwoDimColorPallet","channelThreeDimColorPallet","channelFourDimColorPallet","channelFiveDimColorPallet","channelSixDimColorPallet","channelSevenDimColorPallet","channelEightDimColorPallet","channelNineDimColorPallet","channelTenDimColorPallet","channelElevenDimColorPallet","channelTwelveDimColorPallet","channelThirteenDimColorPallet","channelFourteenDimColorPallet","channelFifteenDimColorPallet","channelSixteenDimColorPallet","pitchChannelColorsDim","pitchChannelColorsBright","pitchNoteColorsDim","pitchNoteColorsBright","drumChannelColorsDim","drumChannelColorsBright","drumNoteColorsDim","drumNoteColorsBright","midiPitchChannelNames","midiDrumChannelNames","midiSustainInstruments","midiDecayInstruments","drumInterval","pitchCount","maxPitch","pitchChannelCountMin","pitchChannelCountMax","drumChannelCountMin","drumChannelCountMax","waves","wavesMixC","pwmwaves","sineWaveMask","sineWave","applyElementArgs","element","args","args_1","__values","args_1_1","next","done","arg","Node","appendChild","document","createTextNode","Array","isArray","Symbol","iterator","__spread","constructor","Object","Element","_d","e_2","_e","key","setAttribute","join","console","warn","tagName","_f","e_3","_g","styleKey","style","setProperty","removeAttribute","svgNS","HTML","_i","arguments","createRange","createContextualFragment","SVG","fragment","createDocumentFragment","svgParser","DOMParser","parseFromString","documentElement","firstChild","importNode","name_1","createElement","_c","split","name_2","createElementNS","test","snakeCaseName","replace","clamp","min","max","val","BitFieldReader","base64CharCodeToInt","source","this","_bits","_readIndex","charCodeAt","push","read","readLongTail","minValue","minBits","numBits","readPartDuration","readPinCount","readPitchInterval","BitFieldWriter","write","writeLongTail","writePartDuration","writePinCount","writePitchInterval","concat","other","encodeBase64","base64IntToCharCode","buffer","lengthBase64","ceil","Operator","frequency","envelope","reset","copy","makeNotePin","interval","time","volume","makeNote","pitch","start","end","fadeout","pitches","pins","Instrument","type","filter","transition","effect","harm","fmChorus","imute","octoff","chorus","ipan","algorithm","feedbackType","feedbackAmplitude","feedbackEnvelope","operators","setTypeAndReset","Channel","octave","instruments","patterns","bars","Pattern","notes","instrument","cloneNotes","oldNote","newNote","oldPin","Song","string","channels","_fingerprint","undefined","fromBase64String","initToDefault","getChannelCount","pitchChannelCount","drumChannelCount","getChannelUnusedCount","getTimeSig","beatsPerBar","partsPerBeat","barCount","getScaleNKey","scale","getChannelIsDrum","channel","getChannelColorDim","getChannelColorBright","getNoteColorDim","getNoteColorBright","andResetChannels","setSongTheme","map","indexOf","mix","sampleRate","loopStart","loopLength","tempo","reverb","blend","riff","detune","muff","patternsPerChannel","instrumentsPerChannel","channelIndex","pattern","bar","toBase64String","bits","_base64IntToCharCode","_variant","_latestNepBoxVersion","encodedSongTheme","encodeURIComponent","o","neededBits","neededInstrumentBits","isDrum","octaveOffset","lastPitch","recentPitches","recentShapes","p","curPart","t","shapeBits","shapePart","startPitch","currentPitch","pitchBends","pin","nextPitch","shapeString","String","fromCharCode","apply","shapeIndex","splice","unshift","pop","allPitches","pitchIndex","pitchIter","stringLength","digits","prototype","compressed","charIndex","fromJsonObject","JSON","parse","substring","fromOld","fromNepBox","version","_base64CharCodeToInt","_latestBeepboxVersion","_oldestBeepboxVersion","_oldestNepBoxVersion","beforeThree","beforeFour","beforeFive","beforeSix","instrumentChannelIterator","instrumentIndexIterator","command","themeIndex","songThemeLength","decodeURIComponent","isPitchChannel","instrumentType","isDrums","subStringLength","bitStringLength","bitStringLengthLength","note","newPattern","newNotes","useOldShape","shape","pinObj","pinCount","initialVolume","bendCount","pitchBend","intervalIter","shift","toJsonObject","enableIntro","loopCount","enableOutro","channelArray","instrumentArray","operatorArray","operator","patternArray","noteArray","pointArray","tick","points","sequenceArray","l","octaveScrollBar","sequence","format","_format","theme","introBars","loopBars","ticksPerBeat","beatsPerMinute","getBeatsPerMinute","jsonObject","oldScaleNames","themes","maxInstruments","maxPatterns","maxBars","channelObject","instrumentObject","oldTransitionNames","binary","transitionObject","oldFilterNames","operatorObject","patternObject","maxNoteCount","tickClock","noteObject","k","noteClock","startInterval","pointObject","lowestPitch","highestPitch","getPattern","patternIndex","getPatternInstrument","getPatternInstrumentMute","instrumentIndex","getPatternInstrumentVolume","getChannelFingerprint","channelCount","charCount","Change","_noop","_didSomething","isNoop","commit","UndoableChange","reversed","super","_reversed","_doneForwards","undo","_doForwards","_doBackwards","redo","_isDoneForwards","ChangeGroup","append","change","ChangeSequence","changes","_changes","ChangePins","_doc","_note","_oldStart","_oldEnd","_newStart","_newEnd","_oldPins","_newPins","_oldPitches","_newPitches","_finishSetup","firstInterval","firstTime","notifier","changed","ChangeInstrumentType","doc","newValue","song","getCurrentInstrument","ChangeTransition","ChangePattern","oldValue","ChangeBarCount","newBar","newBarScrollPos","barScrollPos","newLoopStart","newLoopLength","trackVisibleBars","ChangeInsertBars","count","newLength","ChangeDeleteBars","ChangeChannelCount","newPitchChannelCount","newDrumChannelCount","newChannels","oldChannel","ChangeBeatsPerBar","ChangeNoteTruncate","ChangeChannelOrder","selectionMin","selectionMax","offset","ChangeAddChannel","isNoise","newNoiseChannelCount","addedChannelIndex","ChangeRemoveChannel","minIndex","maxIndex","ChangeChannelBar","newChannel","oldBar","ChangeChorus","ChangeEffect","ChangeHarm","ChangeFMChorus","ChangeOctoff","ChangeImute","ChangeAllImute","ChangeSoloChannels","curChannel","curInstrument","ChangeIpan","ChangeFilter","ChangeAlgorithm","ChangeFeedbackType","ChangeFeedbackEnvelope","ChangeOperatorEnvelope","operatorIndex","ChangeOperatorFrequency","ChangeOperatorAmplitude","ChangeFeedbackAmplitude","ChangeInstrumentsPerChannel","newInstrumentsPerChannel","sampleInstrument","newInstrument","ChangeKey","ChangeSongTheme","ChangeLoop","oldStart","oldLength","newStart","ChangePitchAdded","deletion","_pitch","_index","ChangeOctave","ChangePartsPerBeat","ChangeRhythm","ChangePaste","newBeatsPerBar","newPartsPerBeat","ChangePatternInstrument","ChangePatternsPerChannel","channelBars","channelPatterns","ChangeEnsurePatternExists","_patternOldNotes","_bar","_channel","_oldPatternCount","_newPatternCount","firstEmptyUnusedIndex","firstUnusedIndex","used","barIndex","_patternIndex","ChangePinTime","pinIndex","shiftedTime","originalTime","skipStart","skipEnd","setPin","ChangePitchBend","bendStart","bendEnd","bendTo","direction","stop","setStart","setEnd","prevInterval","prevVolume","persist","item","oldPartsPerBeat","changeRhythm","oldTime","floor","ChangeNoteAdded","ChangeRhythmNote","ChangeScale","ChangeMix","ChangeSampleRate","ChangeSong","newHash","ChangeTempo","ChangeReverb","ChangeBlend","ChangeRiff","ChangeDetune","ChangeMuff","_pattern","ChangeNoteLength","truncStart","truncEnd","pushLastPin","skipNote","ChangeTransposeNote","upward","foundMatch","diff","ChangeTranspose","ChangeVolume","ChangeVolumeBend","bendPart","bendVolume","bendInterval","inserted","ChangeWave","ColorConfig","getChannelColor","pitchChannels","noiseChannels","setTheme","_styleElement","textContent","_themeMap","usesPianoScheme","getComputedStyle","getPropertyValue","trim","colorLookup","Map","default","nepbox","laffey","modbox2","artic","Ocean","rainbow","float","windows","grassland","dessert","kahootiest","beambit","egg","Poniryoshka","gameboy","woodkid","midnight","snedbox","unnamed","piano","halloween","frozen","pageMargin","editorBackground","hoverPreview","playhead","primaryText","secondaryText","invertedText","textSelection","boxSelectionFill","loopAccent","linkAccent","uiWidgetBackground","uiWidgetFocus","pitchBackground","tonic","fifthNote","pitch1Background","pitch2Background","pitch3Background","pitch4Background","pitch5Background","pitch6Background","pitch8Background","pitch9Background","pitch10Background","pitch11Background","volumeIcon","octaveScrollbar","scrollbarOctave","channelBox","blackPianoKey","whitePianoKey","secondaryChannel","primaryChannel","secondaryNote","primaryNote","head","div","prettyNumber","toFixed","PatternCursor","valid","prevNote","curNote","nextNote","curIndex","part","notePart","nearPinIndex","PatternEditor","_svgNoteBackground","id","x","y","width","height","patternUnits","_svgDrumBackground","_svgBackground","rect","fill","_svgNoteContainer","svg","_svgPlayhead","_svgPreview","path","stroke","_svg","viewBox","preserveAspectRatio","defs","container","_defaultPitchHeight","_defaultDrumHeight","_backgroundPitchRows","_backgroundDrumRow","_defaultPinChannels","_editorHeight","_mouseX","_mouseY","_mouseDown","_mouseOver","_mouseDragging","_mouseHorizontal","_usingTouch","_copiedPinChannels","_mouseXStart","_mouseYStart","_mouseXPrev","_mouseYPrev","_dragTime","_dragPitch","_dragVolume","_dragVisible","_dragChange","_cursor","_playheadX","_octaveOffset","_renderedWidth","_renderedBeatWidth","_renderedFifths","_renderedACS","_renderedPiano","_renderedDrums","_setKey","_renderedPartsPerBeat","_renderedPitchChannelCount","_renderedDrumChannelCount","_followPlayheadBar","resetCopiedPins","maxDivision","_getMaxDivision","_animatePlayhead","timestamp","playheadBar","synth","playing","modPlayhead","abs","_editorWidth","prefs","autoFollow","notifyWatchers","window","requestAnimationFrame","_whenMouseOver","event","_whenMouseOut","_whenMousePressed","preventDefault","boundingRect","getBoundingClientRect","clientX","pageX","left","right","clientY","pageY","top","bottom","isNaN","_whenCursorPressed","_whenTouchPressed","touches","_whenMouseMoved","_whenCursorMoved","_whenTouchMoved","_whenCursorReleased","continuousState","lastChangeWas","record","getCurrentPattern","_copyPins","_updateCursorStatus","_updatePreview","_documentChanged","showLetters","showScrollBar","_partWidth","_pitchHeight","_pitchCount","_copiedPins","beatWidth","node","clone","cloneNode","parentNode","replaceChild","makeEmptyReplacementElement","visibility","showChannels","pattern2","notePath","_drawNote","oscillatorLabel","text","_pitchToPixelHeight","rectangle","backgroundColor","watch","addEventListener","mousePitch","_findMousePitch","prevPin","error","nextPin","leftSide","rightSide","intervalRatio","arc","bendHeight","minInterval","Number","MAX_VALUE","maxInterval","bestDistance","pinDistance","_snapToPitch","nearest","distance","defaultLength","fullBeats","modMouse","division","forceStart","forceEnd","pixelY","guess","topPitch","bottomPitch","topRange","bottomRange","setProspectiveChange","dx","dy","currentPart","backwards","directLength","blessedLength","theNote","shiftedPin","volumeRatio","minPitch","radius","pathString","render","showMore","showFifth","svgElement","showVolume","prevSide","nextSide","prevHeight","nextHeight","nextVolume","select","option","Box","color","_label","_rect","_vol1","_volb","_renderedIndex","_renderedDim","_renderedSelected","_renderedColor","setSquashed","squashed","setIndex","dim","selected","colorB","innerHTML","TrackEditor","_barWidth","_select","class","_boxContainer","g","_playhead","_boxHighlight","_upHighlight","_downHighlight","_grid","_digits","_channelHeight","_renderedChannelCount","_renderedBarCount","_renderedPatternCount","_renderedPlayhead","_renderedSquashed","_changePattern","_whenSelectChanged","_setPattern","selectedIndex","up","patternCount","_setChannelBar","_whenMouseReleased","forgetLastChange","currentValue","canReplaceLastChange","_nextDigit","digit","parsed","parseInt","wideScreen","innerWidth","center","middle","base","tip","removeChild","lastChild","selectedPattern","box","showVolumeBar","editorWidth","patternMute","patternVolume","mute","LoopEditor","_startMode","_endMode","_bothMode","_loop","_highlight","_change","startBar","mode","_clientStartX","_clientStartY","_startedScrolling","_draggingHorizontally","_renderedLoopStart","_renderedLoopStop","_whenTouchReleased","_render","_findEndPoints","oldEnd","endPoints","showHighlight","highlightStart","highlightStop","loopStop","BarScrollBar","_trackContainer","_notches","_handle","_handleHighlight","_leftHighlight","_rightHighlight","_dragging","_renderedNotchCount","_renderedBarPos","_onScroll","scrollLeft","_dragStart","capture","passive","showleftHighlight","showRightHighlight","showHandleHighlight","resized","lineHeight","OctaveScrollBar","_piano","_notchHeight","_octaveCount","_octaveHeight","_barHeight","_renderedBarBottom","_barBottom","currentOctave","forceRender","showUpHighlight","showDownHighlight","canvas","Piano","_pianoContainer","_drumContainer","_preview","_pianoKeys","_pianoLabels","_renderedScale","_renderedKey","_renderedPitchCount","_renderedLiveInputPitches","_updateCursorPitch","pianoPitch","_cursorPitch","pianoPressed","getVisiblePitchCount","display","pianoLabel","pianoKey","pitchNameIndex","background","classList","remove","label","transform","getPitchName","getBaseVisibleOctave","add","pitchHeight","children","child","scaleIndex","baseVisibleOctave","shiftDir","button","MixPrompt","_cancelButton","_close","cleanUp","removeEventListener","ChorusPrompt","SynthChannel","sampleLeft","sampleRight","phases","phaseDeltas","volumeStarts","volumeDeltas","volumeLeft","volumeRight","phaseDeltaScale","filterScale","vibratoScale","harmonyMult","harmonyVolumeMult","feedbackOutputs","feedbackMult","feedbackDelta","Synth","warmUpSynthesizer","getGeneratedSynthesizer","operatorAmplitudeCurve","isPlaying","playheadInternal","remainder","beat","arpeggio","samplesPerTick","getSamplesPerArpeggio","arpSampleCountdown","totalSamples","samplesPerBar","loopMinCount","totalSeconds","samplesPerSecond","totalBars","effectDuration","effectAngle","effectYMult","limitDecay","pianoChannel","liveInputDuration","liveInputStarted","liveInputPitches","liveInputChannel","liveInputEndTime","browserAutomaticallyClearsAudioBuffer","stillGoing","effectPhase","limit","delayLineLeft","delayLineRight","delayPosLeft","delayPosRight","delayFeedback0Left","delayFeedback0Right","delayFeedback1Left","delayFeedback1Right","delayFeedback2Left","delayFeedback2Right","delayFeedback3Left","delayFeedback3Right","audioCtx","scriptNode","audioProcessCallback","audioProcessingEvent","outputBuffer","outputDataL","getChannelData","outputDataR","performance","now","deactivateAudio","synthesize","setSong","spsCalc","activateAudio","AudioContext","webkitAudioContext","createScriptProcessor","createJavaScriptNode","onaudioprocess","channelCountMode","channelInterpretation","connect","destination","resume","disconnect","close","maintainLiveInput","play","pause","snapToStart","snapToBar","nextBar","prevBar","dataLeft","dataRight","bufferLength","playSong","bufferIndex","ended","generatedSynthesizer","computeOperatorEnvelope","beats","customVolume","curve","attack","speed","computeChannelInstrument","sampleTime","samples","synthChannel","pianoMode","intervalScale","pitchDamping","secondsPerPart","beatsPerPart","partsSinceStart","resetPhases","intervalStart","intervalEnd","transitionVolumeStart","transitionVolumeEnd","envelopeVolumeStart","envelopeVolumeEnd","partTimeStart","partTimeEnd","decayTimeStart","decayTimeEnd","endPinIndex","startPin","endPin","noteStart","noteEnd","pinStart","pinEnd","tickTimeStart","tickTimeEnd","pinRatioStart","pinRatioEnd","envelopeVolumeTickStart","envelopeVolumeTickEnd","transitionVolumeTickStart","transitionVolumeTickEnd","intervalTickStart","intervalTickEnd","partTimeTickStart","partTimeTickEnd","decayTimeTickStart","decayTimeTickEnd","startRatio","endRatio","volumeConversion","harmonyOffset","endPitch","startFreq","frequencyFromPitch","pitchVolumeStart","pitchVolumeEnd","settingsVolumeMult","filterScaleRate","endFilter","instrumentVolumeMult","volumeEnd","sineVolumeBoost","totalCarrierVolume","carrierCount","isCarrier","associatedCarrierIndex","freqMult","amplitudeCurve","amplitudeMult","volumeStart","volumeMult","feedbackStart","feedbackEnd","fingerprint","generatedSynthesizers","synthSource","line","synthSourceTemplate","outputs","operatorLine","operatorSourceTemplate","modulators","modulatorNumber","feedbackIndices","feedbacks","Function","noteVolume","arpeggioPerSecond","negativePhaseGuard","input","save","blob","navigator","msSaveOrOpenBlob","anchor","download","url","URL","createObjectURL","setTimeout","revokeObjectURL","href","dispatchEvent","MouseEvent","open","location","ExportPrompt","_fileName","maxlength","_enableIntro","_loopDropDown","step","_enableOutro","_exportWavButton","_exportJsonButton","_validateFileName","_validateNumber","_whenExportToWav","_whenExportToJson","checked","introIter","sampleFrames","recordedSamplesLeft","recordedSamplesRight","sampleCount","arrayBuffer","ArrayBuffer","data","DataView","repeat","valLeft","valRight","setUint32","setUint16","setInt16","Blob","jsonString","stringify","disabled","target","deleteChars","cursorPos","selectionStart","setSelectionRange","ImportPrompt","_fileInput","accept","_whenFileSelected","file","files","reader","FileReader","prompt","readAsText","a","ArchivePrompt","SongDataPrompt","RefreshKeyPrompt","_songEditor","_newKeyValue","_refreshButton","_saveChangesAndRefresh","refreshNow","span","SongDurationPrompt","_beatsStepper","_barsStepper","_patternsStepper","_instrumentsStepper","_pitchChannelStepper","_drumChannelStepper","_okayButton","_saveChanges","_validateKey","group","_validate","charCode","which","keyCode","InstrumentTypePrompt","form","ThemePrompt","hasChanged","_closeButton","_previewButton","_previewText","previewExit","_form","title","themeContainer","localStorage","getItem","setItem","elements","_themeChange","_previewTheme","opacity","pointerEvents","_exitPreview","SongThemePrompt","Layout","setLayout","layout","_layoutMap","small","full","flow","LayoutPrompt","_confirm","_whenKeyPressed","focus","isMobile","userAgent","songThemeSet","buildOptions","menu","items","setSelectedIndex","Slider","_getChange","_value","_oldValue","_whenInput","_whenChange","updateValue","SongEditor","_patternEditor","_trackEditor","_loopEditor","_trackVisibleArea","_barScrollBar","_octaveScrollBar","_editorBox","_trackAndMuteContainer","_trackEditorBox","_playButton","_prevBarButton","_nextBarButton","_volumeSlider","_fileMenu","hidden","_editMenu","_optionsMenu","_newSongButton","d","_songDataButton","_customizeButton","_archiveButton","_undoButton","_redoButton","_exportButton","_scaleSelect","_mixSelect","_sampleRateSelect","_mixHint","_archiveHint","_mixSelectRow","_instrumentTypeHint","_keySelect","reverse","_tempoStepper","_tempoSlider","_reverbSlider","_blendSlider","_riffSlider","_detuneSlider","_muffSlider","_imuteButton","_iMmuteButton","_partSelect","_instrumentTypeSelect","values","buildOptionsWithSpecificValues","_instrumentTypeSelectRow","_algorithmSelect","_algorithmSelectRow","_instrumentSelect","_instrumentInput","_instrumentSelectRow","_instrumentVolumeSlider","_instrumentMVolumeSlider","_instrumentVolumeSliderRow","_instrumentMVolumeSliderRow","_SettingsLabel","_advancedInstrumentSettingsLabel","_waveSelect","_drumSelect","_pwmwaveSelect","_waveSelectRow","_transitionSelect","_filterSelect","_filterSelectRow","_chorusSelect","_chorusHint","_chorusSelectRow","_effectSelect","_effectSelectRow","_harmSelect","_harmSelectRow","_octoffSelect","_octoffSelectRow","_fmChorusSelect","_fmChorusSelectRow","_ipanSlider","_ipanSliderRow","_phaseModGroup","_feedbackTypeSelect","_feedbackRow1","_feedbackAmplitudeSlider","_feedbackEnvelopeSelect","_feedbackRow2","_songSettingsButton","_instSettingsButton","_settingsTabs","_instrumentSettingsGroup","_songSettingsGroup","_advancedInstrumentSettingsGroup","_promptContainer","_advancedSongSettings","_advancedSettingsContainer","mainLayer","tabIndex","_changeTranspose","_operatorRows","_operatorAmplitudeSliders","_operatorEnvelopeSelects","_operatorFrequencySelects","_refocusStage","whenUpdated","trackBounds","advancedSettings","optionCommands","autoPlay","innerText","wasActive","contains","activeElement","parentElement","operatorName","patternWidth","clientWidth","_setPrompt","_setSongSettings","borderBottom","_setInstSettings","_muteInstrument","_whenSetTempo","_captureNumberKeys","stopPropagation","history","back","ctrlKey","metaKey","selection","insertChannel","shiftKey","muteAllInstruments","_openPrompt","soloChannels","_togglePlay","_cut","_copy","_paste","_transpose","_whenPrevBarPressed","_whenNextBarPressed","_pause","_play","_setVolumeSlider","setVolume","_whenNewSongPressed","_whenCustomizePressed","_advancedUndo","_advancedRedo","_openExportPrompt","_openSongDataPrompt","_openInstrumentTypePrompt","_openMixPrompt","_openChorusPrompt","_openArchivePrompt","reload","_whenSetScale","_whenSetMix","_whenSetSampleRate","_whenSetKey","_whenSetPartsPerBeat","_whenSetInstrumentType","_whenSetFeedbackType","_whenSetFeedbackEnvelope","_whenSetAlgorithm","_whenSetInstrument","_whenSetWave","_whenSetDrum","_whenSetPWMWave","_whenSetFilter","_whenSetTransition","_whenSetEffect","_whenSetHarm","_whenSetFMChorus","_whenSetOctoff","_whenSetChorus","_fileMenuHandler","_editMenuHandler","_optionsMenuHandler","operatorNumber","frequencySelect","amplitudeSlider","envelopeSelect","row","promptName","openPrompt","_wasPlaying","updatePlayButton","drums","patternCopy","ChangeNotifier","_watchers","_dirty","watcher","unwatch","Selection","shouldMute","invert","mutedCounter","insertIndex","Preferences","visibleOctaves","defaultVisibleOctaves","SongDocument","_recentChange","_sequenceNumber","_barFromCurrentState","_channelFromCurrentState","_shouldPushState","_waitingToUpdateState","_whenHistoryStateChanged","state","sequenceNumber","canUndo","hash","replaceState","_cleanDocument","_updateHistoryState","pushState","_calcVolume","eventName","forward","getMobileLayout","getFullScreen","getVisibleOctaveCount","editor","getElementById","autoplay","scrollRestoration","serviceWorker","register","updateViaCache","scope","catch"],"sources":["../synth/FFT.ts","../synth/SynthConfig.ts","../node_modules/imperative-html/src/elements-base.ts","../node_modules/imperative-html/src/elements-strict.ts","../synth/usefulFunctions.ts","../synth/song.ts","../editor/Change.ts","../editor/changes.ts","../editor/ColorConfig.ts","../editor/PatternEditor.ts","../editor/TrackEditor.ts","../editor/LoopEditor.ts","../editor/BarScrollBar.ts","../editor/OctaveScrollBar.ts","../editor/Piano.ts","../editor/MixPrompt.ts","../editor/ChorusPrompt.ts","../synth/synth.ts","../editor/ExportPrompt.ts","../editor/ImportPrompt.ts","../editor/ArchivePrompt.ts","../editor/SongDataPrompt.ts","../editor/RefreshKeyPrompt.ts","../editor/SongDurationPrompt.ts","../editor/InstrumentTypePrompt.ts","../editor/ThemePrompt.ts","../editor/SongThemePrompt.ts","../editor/Layout.ts","../editor/LayoutPrompt.ts","../editor/SongEditor.ts","../editor/ChangeNotifier.ts","../editor/Selection.ts","../editor/Preferences.ts","../editor/SongDocument.ts","../editor/style.ts","../editor/main.ts"],"sourcesContent":["/*\r\nCopyright (C) 2018 John Nesky\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of \r\nthis software and associated documentation files (the \"Software\"), to deal in \r\nthe Software without restriction, including without limitation the rights to \r\nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \r\nof the Software, and to permit persons to whom the Software is furnished to do \r\nso, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all \r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \r\nSOFTWARE.\r\n*/\r\n\r\n\r\n\t// interface shared by number[], Float32Array, and other typed arrays in JavaScript.\r\n\tinterface NumberArray {\r\n\t\tlength: number;\r\n\t\t[index: number]: number;\r\n\t}\r\n\t\r\n\t// A basic FFT operation scales the overall magnitude of elements by the\r\n\t// square root of the length of the array, √N. Performing a forward FFT and\r\n\t// then an inverse FFT results in the original array, but multiplied by N.\r\n\t// This helper function can be used to compensate for that. \r\n\texport function scaleElementsByFactor(array: NumberArray, factor: number): void {\r\n\t\tfor (let i: number = 0; i < array.length; i++) {\r\n\t\t\tarray[i] *= factor;\r\n\t\t}\r\n\t}\r\n\t\r\n\tfunction isPowerOf2(n: number): boolean {\r\n\t\treturn !!n && !(n & (n - 1));\r\n\t}\r\n\t\r\n\tfunction countBits(n: number): number {\r\n\t\tif (!isPowerOf2(n)) throw new Error(\"FFT array length must be a power of 2.\");\r\n\t\treturn Math.round(Math.log(n) / Math.log(2));\r\n\t}\r\n\t\r\n\t// Rearranges the elements of the array, swapping the element at an index\r\n\t// with an element at an index that is the bitwise reverse of the first\r\n\t// index in base 2. Useful for computing the FFT.\r\n\tfunction reverseIndexBits(array: NumberArray): void {\r\n\t\tconst fullArrayLength: number = array.length;\r\n\t\tconst bitCount: number = countBits(fullArrayLength);\r\n\t\tif (bitCount > 16) throw new Error(\"FFT array length must not be greater than 2^16.\");\r\n\t\tconst finalShift: number = 16 - bitCount;\r\n\t\tfor (let i: number = 0; i < fullArrayLength; i++) {\r\n\t\t\t// Dear Javascript: Please support bit order reversal intrinsics. Thanks! :D\r\n\t\t\tlet j: number;\r\n\t\t\tj = ((i & 0xaaaa) >> 1) | ((i & 0x5555) << 1);\r\n\t\t\tj = ((j & 0xcccc) >> 2) | ((j & 0x3333) << 2);\r\n\t\t\tj = ((j & 0xf0f0) >> 4) | ((j & 0x0f0f) << 4);\r\n\t\t\tj = ((j           >> 8) | ((j &   0xff) << 8)) >> finalShift;\r\n\t\t\tif (j > i) {\r\n\t\t\t\tlet temp: number = array[i];\r\n\t\t\t\tarray[i] = array[j];\r\n\t\t\t\tarray[j] = temp;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\t/* Commented out functions that BeepBox doesn't use...\r\n\t\r\n\t// Provided for educational purposes. Easier to read than\r\n\t// fastFourierTransform(), but computes the same result.\r\n\t// Takes two parallel arrays representing the real and imaginary elements,\r\n\t// respectively, and returns an array containing two new arrays, which\r\n\t// contain the complex result of the transform.\r\n\texport function discreteFourierTransform(realArray: NumberArray, imagArray: NumberArray): number[][] {\r\n\t\tconst fullArrayLength: number = realArray.length;\r\n\t\tif (fullArrayLength != imagArray.length) throw new Error(\"FFT arrays must be the same length.\");\r\n\t\tconst realOut: number[] = [];\r\n\t\tconst imagOut: number[] = [];\r\n\t\tfor (let i: number = 0; i < fullArrayLength; i++) {\r\n\t\t\trealOut[i] = 0.0;\r\n\t\t\timagOut[i] = 0.0;\r\n\t\t\tfor (let j: number = 0; j < fullArrayLength; j++) {\r\n\t\t\t\tconst radians: number = -6.2831853 * j * i / fullArrayLength;\r\n\t\t\t\tconst c: number = Math.cos(radians);\r\n\t\t\t\tconst s: number = Math.sin(radians);\r\n\t\t\t\trealOut[i] += realArray[j] * c - imagArray[j] * s;\r\n\t\t\t\timagOut[i] += realArray[j] * s + imagArray[j] * c;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn [realOut, imagOut];\r\n\t}\r\n\t\r\n\t// Performs a Fourier transform in O(N log(N)) operations. Overwrites the\r\n\t// input real and imaginary arrays. Can be used for both forward and inverse\r\n\t// transforms: swap the order of the arguments for the inverse.\r\n\texport function fastFourierTransform(realArray: NumberArray, imagArray: NumberArray): void {\r\n\t\tconst fullArrayLength: number = realArray.length;\r\n\t\tif (!isPowerOf2(fullArrayLength)) throw new Error(\"FFT array length must be a power of 2.\");\r\n\t\tif (fullArrayLength < 4) throw new Error(\"FFT array length must be at least 4.\");\r\n\t\tif (fullArrayLength != imagArray.length) throw new Error(\"FFT arrays must be the same length.\");\r\n\t\t\r\n\t\treverseIndexBits(realArray);\r\n\t\treverseIndexBits(imagArray);\r\n\t\t\r\n\t\t// First two passes, with strides of 2 and 4, can be combined and optimized.\r\n\t\tfor (let startIndex: number = 0; startIndex < fullArrayLength; startIndex += 4) {\r\n\t\t\tconst startIndex1: number = startIndex + 1;\r\n\t\t\tconst startIndex2: number = startIndex + 2;\r\n\t\t\tconst startIndex3: number = startIndex + 3;\r\n\t\t\tconst real0: number = realArray[startIndex ];\r\n\t\t\tconst real1: number = realArray[startIndex1];\r\n\t\t\tconst real2: number = realArray[startIndex2];\r\n\t\t\tconst real3: number = realArray[startIndex3];\r\n\t\t\tconst imag0: number = imagArray[startIndex ];\r\n\t\t\tconst imag1: number = imagArray[startIndex1];\r\n\t\t\tconst imag2: number = imagArray[startIndex2];\r\n\t\t\tconst imag3: number = imagArray[startIndex3];\r\n\t\t\tconst realTemp0: number = real0 + real1;\r\n\t\t\tconst realTemp1: number = real0 - real1;\r\n\t\t\tconst realTemp2: number = real2 + real3;\r\n\t\t\tconst realTemp3: number = real2 - real3;\r\n\t\t\tconst imagTemp0: number = imag0 + imag1;\r\n\t\t\tconst imagTemp1: number = imag0 - imag1;\r\n\t\t\tconst imagTemp2: number = imag2 + imag3;\r\n\t\t\tconst imagTemp3: number = imag2 - imag3;\r\n\t\t\trealArray[startIndex ] = realTemp0 + realTemp2;\r\n\t\t\trealArray[startIndex1] = realTemp1 + imagTemp3;\r\n\t\t\trealArray[startIndex2] = realTemp0 - realTemp2;\r\n\t\t\trealArray[startIndex3] = realTemp1 - imagTemp3;\r\n\t\t\timagArray[startIndex ] = imagTemp0 + imagTemp2;\r\n\t\t\timagArray[startIndex1] = imagTemp1 - realTemp3;\r\n\t\t\timagArray[startIndex2] = imagTemp0 - imagTemp2;\r\n\t\t\timagArray[startIndex3] = imagTemp1 + realTemp3;\r\n\t\t}\r\n\t\t\r\n\t\tfor (let stride: number = 8; stride <= fullArrayLength; stride += stride) {\r\n\t\t\tconst halfLength: number = stride >>> 1;\r\n\t\t\tconst radiansIncrement: number = Math.PI * 2.0 / stride;\r\n\t\t\tconst cosIncrement: number = Math.cos(radiansIncrement);\r\n\t\t\tconst sinIncrement: number = Math.sin(radiansIncrement);\r\n\t\t\tconst oscillatorMultiplier: number = 2.0 * cosIncrement;\r\n\t\t\tfor (let startIndex: number = 0; startIndex < fullArrayLength; startIndex += stride) {\r\n\t\t\t\tlet c: number = 1.0;\r\n\t\t\t\tlet s: number = 0.0;\r\n\t\t\t\tlet cPrev: number = cosIncrement;\r\n\t\t\t\tlet sPrev: number = sinIncrement;\r\n\t\t\t\tconst secondHalf: number = startIndex + halfLength;\r\n\t\t\t\tfor (let i: number = startIndex; i < secondHalf; i++) {\r\n\t\t\t\t\tconst j: number = i + halfLength;\r\n\t\t\t\t\tconst real0: number = realArray[i];\r\n\t\t\t\t\tconst imag0: number = imagArray[i];\r\n\t\t\t\t\tconst real1: number = realArray[j] * c - imagArray[j] * s;\r\n\t\t\t\t\tconst imag1: number = realArray[j] * s + imagArray[j] * c;\r\n\t\t\t\t\trealArray[i] = real0 + real1;\r\n\t\t\t\t\timagArray[i] = imag0 + imag1;\r\n\t\t\t\t\trealArray[j] = real0 - real1;\r\n\t\t\t\t\timagArray[j] = imag0 - imag1;\r\n\t\t\t\t\tconst cTemp: number = oscillatorMultiplier * c - cPrev;\r\n\t\t\t\t\tconst sTemp: number = oscillatorMultiplier * s - sPrev;\r\n\t\t\t\t\tcPrev = c;\r\n\t\t\t\t\tsPrev = s;\r\n\t\t\t\t\tc = cTemp;\r\n\t\t\t\t\ts = sTemp;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\t// Computes the Fourier transform from an array of real-valued time-domain\r\n\t// samples. The output is specially formatted for space efficieny: elements\r\n\t// 0 through N/2 represent cosine wave amplitudes in ascending frequency,\r\n\t// and elements N/2+1 through N-1 represent sine wave amplitudes in\r\n\t// descending frequency. Overwrites the input array.\r\n\texport function forwardRealFourierTransform(array: NumberArray): void {\r\n\t\tconst fullArrayLength: number = array.length;\r\n\t\tconst totalPasses: number = countBits(fullArrayLength);\r\n\t\tif (fullArrayLength < 4) throw new Error(\"FFT array length must be at least 4.\");\r\n\t\t\r\n\t\treverseIndexBits(array);\r\n\t\t\r\n\t\t// First and second pass.\r\n\t\tfor (let index: number = 0; index < fullArrayLength; index += 4) {\r\n\t\t\tconst index1: number = index + 1;\r\n\t\t\tconst index2: number = index + 2;\r\n\t\t\tconst index3: number = index + 3;\r\n\t\t\tconst real0: number = array[index ];\r\n\t\t\tconst real1: number = array[index1];\r\n\t\t\tconst real2: number = array[index2];\r\n\t\t\tconst real3: number = array[index3];\r\n\t\t\t// no imaginary elements yet since the input is fully real.\r\n\t\t\tconst tempA: number = real0 + real1;\r\n\t\t\tconst tempB: number = real2 + real3;\r\n\t\t\tarray[index ] = tempA + tempB;\r\n\t\t\tarray[index1] = real0 - real1;\r\n\t\t\tarray[index2] = tempA - tempB;\r\n\t\t\tarray[index3] = real2 - real3;\r\n\t\t}\r\n\t\t\r\n\t\t// Third pass.\r\n\t\tconst sqrt2over2: number = Math.sqrt(2.0) / 2.0;\r\n\t\tfor (let index: number = 0; index < fullArrayLength; index += 8) {\r\n\t\t\tconst index1: number = index + 1;\r\n\t\t\tconst index3: number = index + 3;\r\n\t\t\tconst index4: number = index + 4;\r\n\t\t\tconst index5: number = index + 5;\r\n\t\t\tconst index7: number = index + 7;\r\n\t\t\tconst real0: number = array[index ];\r\n\t\t\tconst real1: number = array[index1];\r\n\t\t\tconst imag3: number = array[index3];\r\n\t\t\tconst real4: number = array[index4];\r\n\t\t\tconst real5: number = array[index5];\r\n\t\t\tconst imag7: number = array[index7];\r\n\t\t\tconst tempA: number = (real5 - imag7) * sqrt2over2;\r\n\t\t\tconst tempB: number = (real5 + imag7) * sqrt2over2;\r\n\t\t\tarray[index ] = real0 + real4;\r\n\t\t\tarray[index1] = real1 + tempA;\r\n\t\t\tarray[index3] = real1 - tempA;\r\n\t\t\tarray[index4] = real0 - real4;\r\n\t\t\tarray[index5] = tempB - imag3;\r\n\t\t\tarray[index7] = tempB + imag3;\r\n\t\t}\r\n\t\t\r\n\t\t// Handle remaining passes.\r\n\t\tfor (let pass: number = 3; pass < totalPasses; pass++) {\r\n\t\t\tconst subStride: number = 1 << pass;\r\n\t\t\tconst midSubStride: number = subStride >> 1;\r\n\t\t\tconst stride: number = subStride << 1;\r\n\t\t\tconst radiansIncrement: number = Math.PI * 2.0 / stride;\r\n\t\t\tconst cosIncrement: number = Math.cos(radiansIncrement);\r\n\t\t\tconst sinIncrement: number = Math.sin(radiansIncrement);\r\n\t\t\tconst oscillatorMultiplier: number = 2.0 * cosIncrement;\r\n\t\t\tfor (let startIndex: number = 0; startIndex < fullArrayLength; startIndex += stride) {\r\n\t\t\t\tconst startIndexA: number = startIndex;\r\n\t\t\t\tconst startIndexB: number = startIndexA + subStride;\r\n\t\t\t\tconst stopIndex: number = startIndexB + subStride;\r\n\t\t\t\tconst realStartA: number = array[startIndexA];\r\n\t\t\t\tconst realStartB: number = array[startIndexB];\r\n\t\t\t\tarray[startIndexA] = realStartA + realStartB;\r\n\t\t\t\tarray[startIndexB] = realStartA - realStartB;\r\n\t\t\t\tlet c: number = cosIncrement;\r\n\t\t\t\tlet s: number = -sinIncrement;\r\n\t\t\t\tlet cPrev: number = 1.0;\r\n\t\t\t\tlet sPrev: number = 0.0;\r\n\t\t\t\tfor (let index: number = 1; index < midSubStride; index++) {\r\n\t\t\t\t\tconst indexA0: number = startIndexA + index;\r\n\t\t\t\t\tconst indexA1: number = startIndexB - index;\r\n\t\t\t\t\tconst indexB0: number = startIndexB + index;\r\n\t\t\t\t\tconst indexB1: number = stopIndex   - index;\r\n\t\t\t\t\tconst real0: number = array[indexA0];\r\n\t\t\t\t\tconst imag0: number = array[indexA1];\r\n\t\t\t\t\tconst real1: number = array[indexB0];\r\n\t\t\t\t\tconst imag1: number = array[indexB1];\r\n\t\t\t\t\tconst tempA: number = real1 * c + imag1 * s;\r\n\t\t\t\t\tconst tempB: number = real1 * s - imag1 * c;\r\n\t\t\t\t\tarray[indexA0] = real0 + tempA;\r\n\t\t\t\t\tarray[indexA1] = real0 - tempA;\r\n\t\t\t\t\tarray[indexB0] =-imag0 - tempB;\r\n\t\t\t\t\tarray[indexB1] = imag0 - tempB;\r\n\t\t\t\t\tconst cTemp: number = oscillatorMultiplier * c - cPrev;\r\n\t\t\t\t\tconst sTemp: number = oscillatorMultiplier * s - sPrev;\r\n\t\t\t\t\tcPrev = c;\r\n\t\t\t\t\tsPrev = s;\r\n\t\t\t\t\tc = cTemp;\r\n\t\t\t\t\ts = sTemp;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t*/\r\n\t\r\n\t// Computes the inverse Fourier transform from a specially formatted array of\r\n\t// scalar values. Elements 0 through N/2 are expected to be the real values of\r\n\t// the corresponding complex elements, representing cosine wave amplitudes in\r\n\t// ascending frequency, and elements N/2+1 through N-1 correspond to the\r\n\t// imaginary values, representing sine wave amplitudes in descending frequency.\r\n\t// Generates real-valued time-domain samples. Overwrites the input array.\r\n\texport function inverseRealFourierTransform(array: NumberArray): void {\r\n\t\tconst fullArrayLength: number = array.length;\r\n\t\tconst totalPasses: number = countBits(fullArrayLength);\r\n\t\tif (fullArrayLength < 4) throw new Error(\"FFT array length must be at least 4.\");\r\n\t\r\n\t\t// Perform all but the last few passes in reverse.\r\n\t\tfor (let pass: number = totalPasses - 1; pass >= 2; pass--) {\r\n\t\t\tconst subStride: number = 1 << pass;\r\n\t\t\tconst midSubStride: number = subStride >> 1;\r\n\t\t\tconst stride: number = subStride << 1;\r\n\t\t\tconst radiansIncrement: number = Math.PI * 2.0 / stride;\r\n\t\t\tconst cosIncrement: number = Math.cos(radiansIncrement);\r\n\t\t\tconst sinIncrement: number = Math.sin(radiansIncrement);\r\n\t\t\tconst oscillatorMultiplier: number = 2.0 * cosIncrement;\r\n\t\t\t\r\n\t\t\tfor (let startIndex: number = 0; startIndex < fullArrayLength; startIndex += stride) {\r\n\t\t\t\tconst startIndexA: number = startIndex;\r\n\t\t\t\tconst midIndexA: number = startIndexA + midSubStride;\r\n\t\t\t\tconst startIndexB: number = startIndexA + subStride;\r\n\t\t\t\tconst midIndexB: number = startIndexB + midSubStride;\r\n\t\t\t\tconst stopIndex: number = startIndexB + subStride;\r\n\t\t\t\tconst realStartA: number = array[startIndexA];\r\n\t\t\t\tconst imagStartB: number = array[startIndexB];\r\n\t\t\t\tarray[startIndexA] = realStartA + imagStartB;\r\n\t\t\t\tarray[midIndexA] *= 2;\r\n\t\t\t\tarray[startIndexB] = realStartA - imagStartB;\r\n\t\t\t\tarray[midIndexB] *= 2;\r\n\t\t\t\tlet c: number = cosIncrement;\r\n\t\t\t\tlet s: number = -sinIncrement;\r\n\t\t\t\tlet cPrev: number = 1.0;\r\n\t\t\t\tlet sPrev: number = 0.0;\r\n\t\t\t\tfor (let index: number = 1; index < midSubStride; index++) {\r\n\t\t\t\t\tconst indexA0: number = startIndexA + index;\r\n\t\t\t\t\tconst indexA1: number = startIndexB - index;\r\n\t\t\t\t\tconst indexB0: number = startIndexB + index;\r\n\t\t\t\t\tconst indexB1: number = stopIndex   - index;\r\n\t\t\t\t\tconst real0: number = array[indexA0];\r\n\t\t\t\t\tconst real1: number = array[indexA1];\r\n\t\t\t\t\tconst imag0: number = array[indexB0];\r\n\t\t\t\t\tconst imag1: number = array[indexB1];\r\n\t\t\t\t\tconst tempA: number = real0 - real1;\r\n\t\t\t\t\tconst tempB: number = imag0 + imag1;\r\n\t\t\t\t\tarray[indexA0] = real0 + real1;\r\n\t\t\t\t\tarray[indexA1] = imag1 - imag0;\r\n\t\t\t\t\tarray[indexB0] = tempA * c - tempB * s;\r\n\t\t\t\t\tarray[indexB1] = tempB * c + tempA * s;\r\n\t\t\t\t\tconst cTemp: number = oscillatorMultiplier * c - cPrev;\r\n\t\t\t\t\tconst sTemp: number = oscillatorMultiplier * s - sPrev;\r\n\t\t\t\t\tcPrev = c;\r\n\t\t\t\t\tsPrev = s;\r\n\t\t\t\t\tc = cTemp;\r\n\t\t\t\t\ts = sTemp;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t/*\r\n\t\t// Commented out this block (and compensated with an extra pass above)\r\n\t\t// because it's slower in my testing so far.\r\n\t\t// Pass with stride 8.\r\n\t\tconst sqrt2over2: number = Math.sqrt(2.0) / 2.0;\r\n\t\tfor (let index: number = 0; index < fullArrayLength; index += 8) {\r\n\t\t\tconst index1: number = index + 1;\r\n\t\t\tconst index2: number = index + 2;\r\n\t\t\tconst index3: number = index + 3;\r\n\t\t\tconst index4: number = index + 4;\r\n\t\t\tconst index5: number = index + 5;\r\n\t\t\tconst index6: number = index + 6;\r\n\t\t\tconst index7: number = index + 7;\r\n\t\t\tconst real0: number = array[index ];\r\n\t\t\tconst real1: number = array[index1];\r\n\t\t\tconst real2: number = array[index2];\r\n\t\t\tconst real3: number = array[index3];\r\n\t\t\tconst imag4: number = array[index4];\r\n\t\t\tconst imag5: number = array[index5];\r\n\t\t\tconst imag6: number = array[index6];\r\n\t\t\tconst imag7: number = array[index7];\r\n\t\t\tconst tempA: number = real1 - real3;\r\n\t\t\tconst tempB: number = imag5 + imag7;\r\n\t\t\tarray[index ] = real0 + imag4;\r\n\t\t\tarray[index1] = real1 + real3;\r\n\t\t\tarray[index2] = real2 * 2;\r\n\t\t\tarray[index3] = imag7 - imag5;\r\n\t\t\tarray[index4] = real0 - imag4;\r\n\t\t\tarray[index5] = (tempA + tempB) * sqrt2over2;\r\n\t\t\tarray[index6] = imag6 * 2;\r\n\t\t\tarray[index7] = (tempB - tempA) * sqrt2over2;\r\n\t\t}\r\n\t\t*/\r\n\t\t// The final passes with strides 4 and 2, combined into one loop.\r\n\t\tfor (let index: number = 0; index < fullArrayLength; index += 4) {\r\n\t\t\tconst index1: number = index + 1;\r\n\t\t\tconst index2: number = index + 2;\r\n\t\t\tconst index3: number = index + 3;\r\n\t\t\tconst real0: number = array[index ];\r\n\t\t\tconst real1: number = array[index1] * 2;\r\n\t\t\tconst imag2: number = array[index2];\r\n\t\t\tconst imag3: number = array[index3] * 2;\r\n\t\t\tconst tempA: number = real0 + imag2;\r\n\t\t\tconst tempB: number = real0 - imag2;\r\n\t\t\tarray[index ] = tempA + real1;\r\n\t\t\tarray[index1] = tempA - real1;\r\n\t\t\tarray[index2] = tempB + imag3;\r\n\t\t\tarray[index3] = tempB - imag3;\r\n\t\t}\r\n\t\t\r\n\t\treverseIndexBits(array);\r\n\t}\r\n\r\n","/*!\r\nCopyright (c) 2012-2022 John Nesky and contributing authors\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of \r\nthis software and associated documentation files (the \"Software\"), to deal in \r\nthe Software without restriction, including without limitation the rights to \r\nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \r\nof the Software, and to permit persons to whom the Software is furnished to do \r\nso, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all \r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \r\nSOFTWARE.\r\n*/\r\n\r\nimport { inverseRealFourierTransform, scaleElementsByFactor } from \"./FFT\";\r\n\r\nexport interface Dictionary<T> {\r\n\t[K: string]: T;\r\n}\r\n\r\nexport interface DictionaryArray<T> extends ReadonlyArray<T> {\r\n\tdictionary: Dictionary<T>;\r\n}\r\n\r\nexport interface BeepBoxOption {\r\n\treadonly index: number;\r\n\treadonly name: string;\r\n}\r\n\r\nexport const enum EnvelopeType {\r\n\tcustom,\r\n\tsteady,\r\n\tpunch,\r\n\tflare,\r\n\tpluck,\r\n\ttremolo,\r\n\tflute,\r\n}\r\n\r\nexport const enum InstrumentType {\r\n\tchip = 0,\r\n\tfm = 1,\r\n\tnoise = 2,\r\n\tpwm = 3,\r\n}\r\n\r\nexport interface Scale extends BeepBoxOption {\r\n\treadonly flags: ReadonlyArray<boolean>;\r\n\treadonly realName: string;\r\n}\r\n\r\nexport interface Key extends BeepBoxOption {\r\n\treadonly isWhiteKey: boolean;\r\n\treadonly basePitch: number;\r\n}\r\n\r\nexport class Config {\r\n\tpublic static readonly scales: DictionaryArray<Scale> = toNameMap([\r\n\t\t{name: \"easy :)\",            realName: \"pentatonic major\",      flags: [true, false,  true, false,  true, false, false,  true, false,  true, false, false]},\r\n\t\t{name: \"easy :(\",            realName: \"pentatonic minor\",      flags: [true, false, false,  true, false,  true, false,  true, false, false,  true, false]},\r\n\t\t{name: \"island :)\",          realName: \"ryukyu\",                flags: [true, false, false, false,  true,  true, false,  true, false, false, false,  true]},\r\n\t\t{name: \"island :(\",          realName: \"pelog selisir\",         flags: [true,  true, false,  true, false, false, false,  true,  true, false, false, false]},\r\n\t\t{name: \"blues :)\",           realName: \"blues major\",           flags: [true, false,  true,  true,  true, false, false,  true, false,  true, false, false]},\r\n\t\t{name: \"blues :(\",           realName: \"blues\",                 flags: [true, false, false,  true, false,  true,  true,  true, false, false,  true, false]},\r\n\t\t{name: \"normal :)\",          realName: \"ionian\",                flags: [true, false,  true, false,  true,  true, false,  true, false,  true, false,  true]},\r\n\t\t{name: \"normal :(\",          realName: \"aeolian\",               flags: [true, false,  true,  true, false,  true, false,  true,  true, false,  true, false]},\r\n\t\t{name: \"dbl harmonic :)\", \t realName: \"double harmonic major\", flags: [true,  true, false, false,  true,  true, false,  true,  true, false, false,  true]},\r\n\t\t{name: \"dbl harmonic :(\",    realName: \"double harmonic minor\", flags: [true, false,  true,  true, false, false,  true,  true,  true, false, false,  true]},\r\n\t\t{name: \"enigma\",             realName: \"whole tone\",            flags: [true, false,  true, false,  true, false,  true, false,  true, false,  true, false]},\r\n\t\t{name: \"expert\",             realName: \"chromatic\",             flags: [true,  true,  true,  true,  true,  true,  true,  true,  true,  true,  true,  true]},\r\n\t\t{name: \"monotonic\",          realName: \"monotonic\",             flags: [true, false, false, false, false, false, false, false, false, false, false, false]},\r\n\t\t{name: \"no dabbing\",         realName: \"no dabbing\",            flags: [true,  true, false,  true,  true,  true,  true,  true,  true, false,  true, false]},\r\n\t]);\r\n\tstatic readonly blackKeyNameParents: ReadonlyArray<number> = [-1, 1, -1, 1, -1, 1, -1, -1, 1, -1, 1, -1];\r\n\tstatic readonly pitchNames: ReadonlyArray<string | null> = [\"C\", null, \"D\", null, \"E\", \"F\", null, \"G\", null, \"A\", null, \"B\"];\r\n\tpublic static readonly oldKeys: ReadonlyArray<string | null> = [\"B\", \"A♯\", \"A\", \"G♯\", \"F♯\", \"F\", \"E\", \"D♯\", \"D\", \"C♯\", \"C\"];\r\n\tpublic static readonly keys: DictionaryArray<Key> = toNameMap([\r\n\t\t{name: \"C\",  isWhiteKey:  true, basePitch: 12}, // C0 has index 12 on the MIDI scale. C7 is 96, and C9 is 120. C10 is barely in the audible range.\r\n\t\t{name: \"C♯\", isWhiteKey: false, basePitch: 13},\r\n\t\t{name: \"D\",  isWhiteKey:  true, basePitch: 14},\r\n\t\t{name: \"D♯\", isWhiteKey: false, basePitch: 15},\r\n\t\t{name: \"E\",  isWhiteKey:  true, basePitch: 16},\r\n\t\t{name: \"F\",  isWhiteKey:  true, basePitch: 17},\r\n\t\t{name: \"F♯\", isWhiteKey: false, basePitch: 18},\r\n\t\t{name: \"G\",  isWhiteKey:  true, basePitch: 19},\r\n\t\t{name: \"G♯\", isWhiteKey: false, basePitch: 20},\r\n\t\t{name: \"A\",  isWhiteKey:  true, basePitch: 21},\r\n\t\t{name: \"A♯\", isWhiteKey: false, basePitch: 22},\r\n\t\t{name: \"B\",  isWhiteKey:  true, basePitch: 23},\r\n\t]);\r\n\tstatic readonly mixNames: ReadonlyArray<string> = [\"Type A (B & S)\", \"Type B (M)\", \"Type C\"];\r\n\tstatic readonly sampleRateNames: ReadonlyArray<string> = [\"44100kHz\", \"48000kHz\", \"default\", \"×4\", \"×2\", \"÷2\", \"÷4\", \"÷8\", \"÷16\"];\r\n\tstatic readonly tempoMin: number = 1;\r\n\tstatic readonly tempoMax: number = 500;\r\n\tstatic readonly reverbRange: number = 5;\r\n\tstatic readonly blendRange: number = 4;\r\n\tstatic readonly riffRange: number = 11;\r\n\tstatic readonly detuneRange: number = 24;\r\n\tstatic readonly muffRange: number = 24;\r\n\tstatic readonly beatsPerBarMin: number = 1;\r\n\tstatic readonly beatsPerBarMax: number = 24;\r\n\tstatic readonly barCountMin: number = 1;\r\n\tstatic readonly barCountMax: number = 256;\r\n\tstatic readonly patternsPerChannelMin: number = 1;\r\n\tstatic readonly patternsPerChannelMax: number = 64;\r\n\tstatic readonly instrumentsPerChannelMin: number = 1;\r\n\tstatic readonly instrumentsPerChannelMax: number = 64;\r\n\tstatic readonly pitchesPerOctave: number = 12; // TODO: Use this for converting pitch to frequency.\r\n\tstatic readonly drumCount: number = 12;\r\n\tstatic readonly pitchOctaves: number = 7;\r\n\tstatic readonly partNames: ReadonlyArray<string> = [\"÷3 (triplets)\", \"÷4 (standard)\", \"÷6\", \"÷8\", \"÷16 (arpfest)\", \"÷12\", \"÷9\", \"÷5\", \"÷50\", \"÷24\"];\r\n\tstatic readonly partCounts: ReadonlyArray<number> = [3, 4, 6, 8, 16, 12, 9, 5, 50, 24];\r\n\tstatic readonly waveNames: ReadonlyArray<string> = [\"triangle\", \"square\", \"pulse wide\", \"pulse narrow\", \"sawtooth\", \"double saw\", \"double pulse\", \"spiky\", \"plateau\", \"glitch\", \"10% pulse\", \"sunsoft bass\", \"loud pulse\", \"sax\", \"guitar\", \"sine\", \"atari bass\", \"atari pulse\", \"1% pulse\", \"curved sawtooth\", \"viola\", \"brass\", \"acoustic bass\", \"lyre\", \"ramp pulse\", \"piccolo\", \"squaretooth\", \"flatline\", \"pnryshk a (u5)\", \"pnryshk b (riff)\"];\r\n\tstatic readonly waveVolumes: ReadonlyArray<number> = [1.0,        0.5,      0.5,          0.5,            0.65,       0.5,          0.4,            0.4,     0.94,      0.5,      0.5,         1.0,            0.6,          0.1,   0.25,     1.0,    1.0,          1.0,           1.0,        1.0,               1.0,     1.0,     1.0,             0.2,    0.2,          0.9,       0.9,           1.0,        0.4,                 0.5];\r\n\tstatic readonly drumNames: ReadonlyArray<string> = [\"retro\", \"white\", \"periodic\", \"detuned periodic\", \"shine\", \"hollow\", \"deep\", \"cutter\", \"metallic\", \"snare\"/*, \"tom-tom\", \"cymbal\", \"bass\"*/];\r\n\tstatic readonly drumVolumes: ReadonlyArray<number> = [0.25, 1.0, 0.4, 0.3, 0.3, 1.5, 1.5, 0.25, 1.0, 1.0/*, 1.5, 1.5, 1.5*/];\r\n\tstatic readonly drumBasePitches: ReadonlyArray<number> = [69, 69, 69, 69, 69, 96, 120, 96, 96, 69/*, 96, 90, 126*/];\r\n\tstatic readonly drumPitchFilterMult: ReadonlyArray<number> = [100.0, 8.0, 100.0, 100.0, 100.0, 1.0, 100.0, 100.0, 100.0, 100.0/*, 1.0, 1.0, 1.0*/];\r\n\tstatic readonly drumWaveIsSoft: ReadonlyArray<boolean> = [false, true, false, false, false, true, true, false, false, false/*, true, true, true*/];\r\n\t// Noise waves have too many samples to write by hand, they're generated on-demand by getDrumWave instead.\r\n\tprivate static readonly _drumWaves: Array<Float32Array | null> = [null, null, null, null, null, null, null, null, null, null/*, null, null, null*/];\r\n\tstatic readonly pwmwaveNames: ReadonlyArray<string> = [\"5%\", \"10%\", \"15%\", \"20%\", \"25%\", \"30%\", \"35%\", \"40%\", \"45%\", \"50%\"];\r\n\tstatic readonly pwmwaveVolumes: ReadonlyArray<number> = [1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0];\r\n\tstatic readonly filterNames: ReadonlyArray<string> = [\"none\", \"sustain sharp\", \"sustain medium\", \"sustain soft\", \"decay sharp\", \"decay medium\", \"decay soft\", \"decay drawn\", \"fade sharp\", \"fade medium\", \"fade soft\", \"ring\", \"muffled\", \"submerged\", \"shift\", \"overtone\", \"woosh\", \"undertone\"];\r\n\tstatic readonly filterBases: ReadonlyArray<number> = [0.0, 2.0, 3.5, 5.0, 1.0, 2.5, 4.0, 1.0, 5.0, 7.5, 10.0, -1.0, 4.0, 6.0, 0.0, 1.0, 2.0, 5.0];\r\n\tstatic readonly filterDecays: ReadonlyArray<number> = [0.0, 0.0, 0.0, 0.0, 10.0, 7.0, 4.0, 0.5, -10.0, -7.0, -4.0, 0.2, 0.2, 0.3, 0.0, 0.0, -6.0, 0.0];\r\n\tstatic readonly filterVolumes: ReadonlyArray<number> = [0.2, 0.4, 0.7, 1.0, 0.5, 0.75, 1.0, 0.5, 0.4, 0.7, 1.0, 0.5, 0.75, 0.4, 0.4, 1.0, 0.5, 1.75];\r\n\tstatic readonly transitionNames: ReadonlyArray<string> = [\"seamless\", \"sudden\", \"smooth\", \"slide\", \"trill\", \"click\", \"bow\", \"blip\"];\r\n\tstatic readonly effectNames: ReadonlyArray<string> = [\"none\", \"vibrato light\", \"vibrato delayed\", \"vibrato heavy\", \"tremolo light\", \"tremolo heavy\", \"alien\", \"stutter\", \"strum\"];\r\n\tstatic readonly effectVibratos: ReadonlyArray<number> = [0.0, 0.15, 0.3, 0.45, 0.0, 0.0, 1.0, 0.0, 0.05];\r\n\tstatic readonly effectTremolos: ReadonlyArray<number> = [0.0, 0.0, 0.0, 0.0, 0.25, 0.5, 0.0, 1.0, 0.025];\r\n\tstatic readonly effectVibratoDelays: ReadonlyArray<number> = [0, 0, 3, 0, 0, 0, 0, 0];\r\n\tstatic readonly chorusNames: ReadonlyArray<string> = [\"union\", \"shimmer\", \"hum\", \"honky tonk\", \"dissonant\", \"fifths\", \"octaves\", \"spinner\", \"detune\", \"bowed\", \"rising\", \"vibrate\", \"fourths\", \"bass\", \"dirty\", \"stationary\", \"harmonic (legacy)\", \"recurve\", \"voiced\", \"fluctuate\"];\r\n\tstatic readonly chorusIntervals: ReadonlyArray<number> = [0.0, 0.02, 0.05, 0.1, 0.25, 3.5, 6, 0.02, 0.0, 0.02, 1.0, 3.5, 4, 0, 0.0, 3.5, 0.0, 0.005, 0.25, 12];\r\n\tstatic readonly chorusOffsets: ReadonlyArray<number> = [0.0, 0.0, 0.0, 0.0, 0.0, 3.5, 6, 0.0, 0.25, 0.0, 0.7, 7, 4, -7, 0.1, 0.0, 0.0, 0.0, 3.0, 0.0];\r\n\tstatic readonly chorusVolumes: ReadonlyArray<number> = [0.9, 0.9, 1.0, 1.0, 0.95, 0.95, 0.9, 1.0, 1.0, 1.0, 0.95, 0.975, 0.95, 1.0, 0.975, 0.9, 1.0, 1.0, 0.9, 1.0];\r\n\tstatic readonly chorusSigns: ReadonlyArray<number> = [1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, 1.0, -1.0, 1.0, 1.0];\r\n\tstatic readonly chorusRiffApp: ReadonlyArray<number> = [0.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0];\r\n\tstatic readonly chorusHarmonizes: ReadonlyArray<boolean> = [false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false];\r\n\tstatic readonly harmDisplay: ReadonlyArray<string> = [\"arpeggio\", \"duet\", \"chord\", \"seventh\", \"half arpeggio\", \"arp-chord\"];\r\n\tstatic readonly harmNames: ReadonlyArray<number> = [0, 1, 2, 3, 4, 5];\r\n\tstatic readonly fmChorusDisplay: ReadonlyArray<string> = [\"none\", \"default\", \"detune\", \"honky tonk\", \"consecutive\", \"alt. major thirds\", \"alt. minor thirds\", \"fifths\", \"octaves\"];\r\n\tstatic readonly fmChorusNames: ReadonlyArray<number> = [0, 1, 2, 3, 4, 5, 6, 7, 8];\r\n\tstatic readonly imuteNames: ReadonlyArray<string> = [\"◉\", \"◎\"];\r\n\tstatic readonly imuteValues: ReadonlyArray<number> = [1, 0];\r\n\tstatic readonly octoffNames: ReadonlyArray<string> = [\"none\", \"+2 (2 octaves)\",  \"+1 1/2 (octave and fifth)\",  \"+1 (octave)\",  \"+1/2 (fifth)\", \"-1/2 (fifth)\", \"-1 (octave)\", \"-1 1/2 (octave and fifth)\", \"-2 (2 octaves\"];\r\n\tstatic readonly octoffValues: ReadonlyArray<number> = [0.0, 24.0, 19.0, 12.0, 7.0, -7.0, -12.0, -19.0, -24.0];\r\n\tstatic readonly volumeNames: ReadonlyArray<string> = [\"loudest\", \"loud\", \"medium\", \"quiet\", \"quietest\", \"mute\", \"i\", \"couldnt\", \"be\", \"bothered\"];\r\n\tstatic readonly volumeValues: ReadonlyArray<number> = [0.0, 0.25, 0.5, 0.75, 1.0, 1.25, 1.5, 1.75, 2.0, -1.0];\r\n\tstatic readonly volumeMValues: ReadonlyArray<number> = [0.0, 0.5, 1.0, 1.5, 2.0, -1.0];\r\n\tstatic readonly ipanValues: ReadonlyArray<number> = [-1.0, -0.75, -0.5, -0.25, 0.0, 0.25, 0.5, 0.75, 1.0];\r\n\tstatic readonly operatorCount: number = 4;\r\n\tstatic readonly operatorAlgorithmNames: ReadonlyArray<string> = [\r\n\t\t\"1←(2 3 4)\",\r\n\t\t\"1←(2 3←4)\",\r\n\t\t\"1←2←(3 4)\",\r\n\t\t\"1←(2 3)←4\",\r\n\t\t\"1←2←3←4\",\r\n\t\t\"1←3 2←4\",\r\n\t\t\"1 2←(3 4)\",\r\n\t\t\"1 2←3←4\",\r\n\t\t\"(1 2)←3←4\",\r\n\t\t\"(1 2)←(3 4)\",\r\n\t\t\"1 2 3←4\",\r\n\t\t\"(1 2 3)←4\",\r\n\t\t\"1 2 3 4\",\r\n\t];\r\n\tstatic readonly midiAlgorithmNames: ReadonlyArray<string> = [\"1<(2 3 4)\", \"1<(2 3<4)\", \"1<2<(3 4)\", \"1<(2 3)<4\", \"1<2<3<4\", \"1<3 2<4\", \"1 2<(3 4)\", \"1 2<3<4\", \"(1 2)<3<4\", \"(1 2)<(3 4)\", \"1 2 3<4\", \"(1 2 3)<4\", \"1 2 3 4\"];\r\n\tstatic readonly operatorModulatedBy: ReadonlyArray<ReadonlyArray<ReadonlyArray<number>>> = [\r\n\t\t[[2, 3, 4], [],     [],  []],\r\n\t\t[[2, 3],    [],     [4], []],\r\n\t\t[[2],       [3, 4], [],  []],\r\n\t\t[[2, 3],    [4],    [4], []],\r\n\t\t[[2],       [3],    [4], []],\r\n\t\t[[3],       [4],    [],  []],\r\n\t\t[[],        [3, 4], [],  []],\r\n\t\t[[],        [3],    [4], []],\r\n\t\t[[3],       [3],    [4], []],\r\n\t\t[[3, 4],    [3, 4], [],  []],\r\n\t\t[[],        [],     [4], []],\r\n\t\t[[4],       [4],    [4], []],\r\n\t\t[[],        [],     [],  []],\r\n\t];\r\n\tstatic readonly operatorAssociatedCarrier: ReadonlyArray<ReadonlyArray<number>> = [\r\n\t\t[1, 1, 1, 1],\r\n\t\t[1, 1, 1, 1],\r\n\t\t[1, 1, 1, 1],\r\n\t\t[1, 1, 1, 1],\r\n\t\t[1, 1, 1, 1],\r\n\t\t[1, 2, 1, 2],\r\n\t\t[1, 2, 2, 2],\r\n\t\t[1, 2, 2, 2],\r\n\t\t[1, 2, 2, 2],\r\n\t\t[1, 2, 2, 2],\r\n\t\t[1, 2, 3, 3],\r\n\t\t[1, 2, 3, 3],\r\n\t\t[1, 2, 3, 4],\r\n\t];\r\n\tstatic readonly operatorCarrierCounts: ReadonlyArray<number> = [1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 3, 3, 4];\r\n\tstatic readonly operatorCarrierChorus: ReadonlyArray<ReadonlyArray<number>> = [\r\n\t\t[0.0, 0.0, 0.0, 0.0],\r\n\t\t[0.0, 0.04, -0.073, 0.091],\r\n\t\t[0.5, 0.54, 0.427, 0.591],\r\n\t\t[0.0, 0.26, -0.45, 0.67],\r\n\t\t[0.0, 1.0, 2.0, 3.0],\r\n\t\t[0.0, 4.0, 7.0, 11.0],\r\n\t\t[0.0, 3.0, 7.0, 10.0],\r\n\t\t[0.0, 7.0, 14.0, 21.0],\r\n\t\t[0.0, 12.0, 24.0, 36.0],\r\n\t];\r\n\tstatic readonly operatorAmplitudeMax: number = 15;\r\n\tstatic readonly operatorFrequencyNames: ReadonlyArray<string> = [\"1×\", \"~1×\", \"2×\", \"~2×\", \"3×\", \"4×\", \"5×\", \"6×\", \"7×\", \"8×\", \"9×\", \"10×\", \"11×\", \"13×\", \"16×\", \"20×\"];\r\n\tstatic readonly midiFrequencyNames: ReadonlyArray<string> = [\"1x\", \"~1x\", \"2x\", \"~2x\", \"3x\", \"4x\", \"5x\", \"6x\", \"7x\", \"8x\", \"9x\", \"10x\", \"11x\", \"13x\", \"16x\", \"20x\"];\r\n\tstatic readonly operatorFrequencies: ReadonlyArray<number> =    [1.0, 1.0, 2.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0, 9.0, 10.0, 11.0, 13.0, 16.0, 20.0];\r\n\tstatic readonly operatorHzOffsets: ReadonlyArray<number> =      [0.0, 1.5, 0.0, -1.3, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0];\r\n\tstatic readonly operatorAmplitudeSigns: ReadonlyArray<number> = [1.0, -1.0, 1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0];\r\n\tstatic readonly operatorEnvelopeNames: ReadonlyArray<string> = [\"custom\", \"steady\", \"punch\", \"flare 1\", \"flare 2\", \"flare 3\", \"pluck 1\", \"pluck 2\", \"pluck 3\", \"swell 1\", \"swell 2\", \"swell 3\", \"tremolo1\", \"tremolo2\", \"tremolo3\", \"custom flare\", \"custom tremolo\", \"flute 1\", \"flute 2\", \"flute 3\"];\r\n\tstatic readonly operatorEnvelopeType: ReadonlyArray<EnvelopeType> = [EnvelopeType.custom, EnvelopeType.steady, EnvelopeType.punch, EnvelopeType.flare, EnvelopeType.flare, EnvelopeType.flare, EnvelopeType.pluck, EnvelopeType.pluck, EnvelopeType.pluck, EnvelopeType.pluck, EnvelopeType.pluck, EnvelopeType.pluck, EnvelopeType.tremolo, EnvelopeType.tremolo, EnvelopeType.tremolo, EnvelopeType.flare, EnvelopeType.tremolo, EnvelopeType.flute, EnvelopeType.flute, EnvelopeType.flute];\r\n\tstatic readonly operatorSpecialCustomVolume: ReadonlyArray<boolean> = [false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, true, true, false, false, false];\r\n\tstatic readonly operatorEnvelopeSpeed: ReadonlyArray<number> = [0.0, 0.0, 0.0, 32.0, 8.0, 2.0, 32.0, 8.0, 2.0, 32.0, 8.0, 2.0, 4.0, 2.0, 1.0, 8.0, 0.0, 16.0, 8.0, 4.0];\r\n\tstatic readonly operatorEnvelopeInverted: ReadonlyArray<boolean> = [false, false, false, false, false, false, false, false, false, true, true, true, false, false, false, false, false, false, false, false];\r\n\tstatic readonly operatorFeedbackNames: ReadonlyArray<string> = [\r\n\t\t\"1⟲\",\r\n\t\t\"2⟲\",\r\n\t\t\"3⟲\",\r\n\t\t\"4⟲\",\r\n\t\t\"1⟲ 2⟲\",\r\n\t\t\"3⟲ 4⟲\",\r\n\t\t\"1⟲ 2⟲ 3⟲ \",\r\n\t\t\"2⟲ 3⟲ 4⟲ \",\r\n\t\t\"1⟲ 2⟲ 3⟲ 4⟲ \",\r\n\t\t\"1→2\",\r\n\t\t\"1→3\",\r\n\t\t\"1→4\",\r\n\t\t\"2→3\",\r\n\t\t\"2→4\",\r\n\t\t\"3→4\",\r\n\t\t\"1→3 2→4\",\r\n\t\t\"1→4 2→3\",\r\n\t\t\"1→2→3→4\",\r\n\t\t\"1🗘2\",\r\n\t\t\"1🗘3\",\r\n\t\t\"1🗘4\",\r\n\t\t\"2🗘3\",\r\n\t\t\"2🗘4\",\r\n\t\t\"3🗘4\",\r\n\t];\r\n\tstatic readonly midiFeedbackNames: ReadonlyArray<string> = [\r\n\t\t\"1\",\r\n\t\t\"2\",\r\n\t\t\"3\",\r\n\t\t\"4\",\r\n\t\t\"1 2\",\r\n\t\t\"3 4\",\r\n\t\t\"1 2 3\",\r\n\t\t\"2 3 4\",\r\n\t\t\"1 2 3 4\",\r\n\t\t\"1>2\",\r\n\t\t\"1>3\",\r\n\t\t\"1>4\",\r\n\t\t\"2>3\",\r\n\t\t\"2>4\",\r\n\t\t\"3>4\",\r\n\t\t\"1>3 2>4\",\r\n\t\t\"1>4 2>3\",\r\n\t\t\"1>2>3>4\",\r\n\t\t\"1-2\",\r\n\t\t\"1-3\",\r\n\t\t\"1-4\",\r\n\t\t\"2-3\",\r\n\t\t\"2-4\",\r\n\t\t\"3-4\",\r\n\t];\r\n\tstatic readonly operatorFeedbackIndices: ReadonlyArray<ReadonlyArray<ReadonlyArray<number>>> = [\r\n\t\t[[1], [], [], []],\r\n\t\t[[], [2], [], []],\r\n\t\t[[], [], [3], []],\r\n\t\t[[], [], [], [4]],\r\n\t\t[[1], [2], [], []],\r\n\t\t[[], [], [3], [4]],\r\n\t\t[[1], [2], [3], []],\r\n\t\t[[], [2], [3], [4]],\r\n\t\t[[1], [2], [3], [4]],\r\n\t\t[[], [1], [], []],\r\n\t\t[[], [], [1], []],\r\n\t\t[[], [], [], [1]],\r\n\t\t[[], [], [2], []],\r\n\t\t[[], [], [], [2]],\r\n\t\t[[], [], [], [3]],\r\n\t\t[[], [], [1], [2]],\r\n\t\t[[], [], [2], [1]],\r\n\t\t[[], [1], [2], [3]],\r\n\t\t[[2], [1], [],  []  ],\r\n\t\t[[3], [],  [1], []  ],\r\n\t\t[[4], [],  [],  [1] ],\r\n\t\t[[],  [3], [2], []  ],\r\n\t\t[[],  [4], [],  [2] ],\r\n\t\t[[],  [],  [4], [3] ],\r\n\t];\r\n\tstatic readonly pitchChannelTypeNames: ReadonlyArray<string> = [\"chip\", \"FM (expert)\", \"PWM (beta)\"];\r\n\tstatic readonly pitchChannelTypeValues: ReadonlyArray<number> = [InstrumentType.chip, InstrumentType.fm, InstrumentType.pwm];\r\n\tstatic readonly drumChannelTypeNames: ReadonlyArray<string> = [\"noise\"];\r\n\tstatic readonly instrumentTypeNames: ReadonlyArray<string> = [\"chip\", \"FM\", \"noise\", \"PWM\"];\r\n\r\n\tstatic readonly oldThemeNames: ReadonlyArray<string> = [\"Default\", \"ModBox 2.0\", \"Artic\", \"Cinnamon Roll [!]\", \"Ocean\", \"Rainbow [!]\", \"Float [!]\", \"Windows\", \"Grassland\", \"Dessert\", \"Kahootiest\", \"Beam to the Bit [!]\", \"Pretty Egg\", \"Poniryoshka\", \"Gameboy [!]\", \"Woodkid\", \"Midnight\", \"Snedbox\", \"unnamed\", \"Piano [!] [↻]\", \"Halloween\", \"FrozenOver❄️\"];\r\n\r\n\tstatic readonly channelOneBrightColorPallet: string      = \"#25f3ff\";\r\n\tstatic readonly channelTwoBrightColorPallet: string      = \"#44ff44\";\r\n\tstatic readonly channelThreeBrightColorPallet: string    = \"#ffff25\";\r\n\tstatic readonly channelFourBrightColorPallet: string     = \"#ff9752\";\r\n\tstatic readonly channelFiveBrightColorPallet: string     = \"#ff90ff\";\r\n\tstatic readonly channelSixBrightColorPallet: string      = \"#9f31ea\";\r\n\tstatic readonly channelSevenBrightColorPallet: string    = \"#2b6aff\";\r\n\tstatic readonly channelEightBrightColorPallet: string    = \"#00ff9f\";\r\n\tstatic readonly channelNineBrightColorPallet: string     = \"#ffbf00\";\r\n\tstatic readonly channelTenBrightColorPallet: string      = \"#d85d00\";\r\n\tstatic readonly channelElevenBrightColorPallet: string   = \"#ff00a1\";\r\n\tstatic readonly channelTwelveBrightColorPallet: string   = \"#c26afc\";\r\n\tstatic readonly channelThirteenBrightColorPallet: string = \"#ff1616\";\r\n\tstatic readonly channelFourteenBrightColorPallet: string = \"#ffffff\";\r\n\tstatic readonly channelFifteenBrightColorPallet: string  = \"#768dfc\";\r\n\tstatic readonly channelSixteenBrightColorPallet: string  = \"#a5ff00\";\r\n\r\n\tstatic readonly channelOneDimColorPallet: string      = \"#0099a1\";\r\n\tstatic readonly channelTwoDimColorPallet: string      = \"#439143\";\r\n\tstatic readonly channelThreeDimColorPallet: string    = \"#a1a100\";\r\n\tstatic readonly channelFourDimColorPallet: string     = \"#c75000\";\r\n\tstatic readonly channelFiveDimColorPallet: string     = \"#d020d0\";\r\n\tstatic readonly channelSixDimColorPallet: string      = \"#552377\";\r\n\tstatic readonly channelSevenDimColorPallet: string    = \"#221b89\";\r\n\tstatic readonly channelEightDimColorPallet: string    = \"#00995f\";\r\n\tstatic readonly channelNineDimColorPallet: string     = \"#d6b03e\";\r\n\tstatic readonly channelTenDimColorPallet: string      = \"#b25915\";\r\n\tstatic readonly channelElevenDimColorPallet: string   = \"#891a60\";\r\n\tstatic readonly channelTwelveDimColorPallet: string   = \"#965cbc\";\r\n\tstatic readonly channelThirteenDimColorPallet: string = \"#991010\";\r\n\tstatic readonly channelFourteenDimColorPallet: string = \"#aaaaaa\";\r\n\tstatic readonly channelFifteenDimColorPallet: string  = \"#5869BD\";\r\n\tstatic readonly channelSixteenDimColorPallet: string  = \"#7c9b42\";\r\n\r\n\tstatic readonly pitchChannelColorsDim: ReadonlyArray<string>    = [Config.channelOneDimColorPallet, Config.channelTwoDimColorPallet, Config.channelThreeDimColorPallet, Config.channelFourDimColorPallet, Config.channelFiveDimColorPallet, Config.channelSixDimColorPallet, Config.channelSevenDimColorPallet, Config.channelEightDimColorPallet, Config.channelNineDimColorPallet, Config.channelTenDimColorPallet, Config.channelElevenDimColorPallet, Config.channelTwelveDimColorPallet];\r\n\tstatic readonly pitchChannelColorsBright: ReadonlyArray<string> = [Config.channelOneBrightColorPallet, Config.channelTwoBrightColorPallet, Config.channelThreeBrightColorPallet, Config.channelFourBrightColorPallet, Config.channelFiveBrightColorPallet, Config.channelSixBrightColorPallet, Config.channelSevenBrightColorPallet, Config.channelEightBrightColorPallet, Config.channelNineBrightColorPallet, Config.channelTenBrightColorPallet, Config.channelElevenBrightColorPallet, Config.channelTwelveBrightColorPallet];\r\n\tstatic readonly pitchNoteColorsDim: ReadonlyArray<string>       = [Config.channelOneDimColorPallet, Config.channelTwoDimColorPallet, Config.channelThreeDimColorPallet, Config.channelFourDimColorPallet, Config.channelFiveDimColorPallet, Config.channelSixDimColorPallet, Config.channelSevenDimColorPallet, Config.channelEightDimColorPallet, Config.channelNineDimColorPallet, Config.channelTenDimColorPallet, Config.channelElevenDimColorPallet, Config.channelTwelveDimColorPallet];\r\n\tstatic readonly pitchNoteColorsBright: ReadonlyArray<string>    = [Config.channelOneBrightColorPallet, Config.channelTwoBrightColorPallet, Config.channelThreeBrightColorPallet, Config.channelFourBrightColorPallet, Config.channelFiveBrightColorPallet, Config.channelSixBrightColorPallet, Config.channelSevenBrightColorPallet, Config.channelEightBrightColorPallet, Config.channelNineBrightColorPallet, Config.channelTenBrightColorPallet, Config.channelElevenBrightColorPallet, Config.channelTwelveBrightColorPallet];\r\n\tstatic readonly drumChannelColorsDim: ReadonlyArray<string>    = [Config.channelThirteenDimColorPallet, Config.channelFourteenDimColorPallet, Config.channelFifteenDimColorPallet, Config.channelSixteenDimColorPallet];\r\n\tstatic readonly drumChannelColorsBright: ReadonlyArray<string> = [Config.channelThirteenBrightColorPallet, Config.channelFourteenBrightColorPallet, Config.channelFifteenBrightColorPallet, Config.channelSixteenBrightColorPallet];\r\n\tstatic readonly drumNoteColorsDim: ReadonlyArray<string>       = [Config.channelThirteenDimColorPallet, Config.channelFourteenDimColorPallet, Config.channelFifteenDimColorPallet, Config.channelSixteenDimColorPallet];\r\n\tstatic readonly drumNoteColorsBright: ReadonlyArray<string>    = [Config.channelThirteenBrightColorPallet, Config.channelFourteenBrightColorPallet, Config.channelFifteenBrightColorPallet, Config.channelSixteenBrightColorPallet];\r\n\r\n\tstatic readonly midiPitchChannelNames: ReadonlyArray<string> = [\"cyan channel\", \"yellow channel\", \"orange channel\", \"green channel\", \"purple channel\", \"blue channel\"];\r\n\tstatic readonly midiDrumChannelNames: ReadonlyArray<string> = [\"gray channel\", \"brown channel\", \"indigo channel\"];\r\n\tstatic readonly midiSustainInstruments: number[] = [\r\n\t\t0x47, // triangle -> clarinet\r\n\t\t0x50, // square -> square wave\r\n\t\t0x46, // pulse wide -> bassoon\r\n\t\t0x44, // pulse narrow -> oboe\r\n\t\t0x51, // sawtooth -> sawtooth wave\r\n\t\t0x51, // double saw -> sawtooth wave\r\n\t\t0x51, // double pulse -> sawtooth wave\r\n\t\t0x51, // spiky -> sawtooth wave\r\n\t\t0x4A, // plateau -> recorder\r\n\t];\r\n\tstatic readonly midiDecayInstruments: number[] = [\r\n\t\t0x2E, // triangle -> harp\r\n\t\t0x2E, // square -> harp\r\n\t\t0x06, // pulse wide -> harpsichord\r\n\t\t0x18, // pulse narrow -> nylon guitar\r\n\t\t0x19, // sawtooth -> steel guitar\r\n\t\t0x19, // double saw -> steel guitar\r\n\t\t0x6A, // double pulse -> shamisen\r\n\t\t0x6A, // spiky -> shamisen\r\n\t\t0x21, // plateau -> fingered bass\r\n\t];\r\n\tstatic readonly drumInterval: number = 6;\r\n\tstatic readonly pitchCount: number = 37;\r\n\tstatic readonly maxPitch: number = 84;\r\n\tstatic readonly pitchChannelCountMin: number = 0;\r\n\tstatic readonly pitchChannelCountMax: number = 12;\r\n\tstatic readonly drumChannelCountMin: number = 0;\r\n\tstatic readonly drumChannelCountMax: number = 4;\r\n\tstatic readonly waves: ReadonlyArray<Float64Array> = [\r\n\t\tConfig._centerWave([1.0/15.0, 3.0/15.0, 5.0/15.0, 7.0/15.0, 9.0/15.0, 11.0/15.0, 13.0/15.0, 15.0/15.0, 15.0/15.0, 13.0/15.0, 11.0/15.0, 9.0/15.0, 7.0/15.0, 5.0/15.0, 3.0/15.0, 1.0/15.0, -1.0/15.0, -3.0/15.0, -5.0/15.0, -7.0/15.0, -9.0/15.0, -11.0/15.0, -13.0/15.0, -15.0/15.0, -15.0/15.0, -13.0/15.0, -11.0/15.0, -9.0/15.0, -7.0/15.0, -5.0/15.0, -3.0/15.0, -1.0/15.0]),\r\n\t\tConfig._centerWave([1.0, -1.0]),\r\n\t\tConfig._centerWave([1.0, -1.0, -1.0, -1.0]),\r\n\t\tConfig._centerWave([1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0]),\r\n\t\tConfig._centerWave([1.0/31.0, 3.0/31.0, 5.0/31.0, 7.0/31.0, 9.0/31.0, 11.0/31.0, 13.0/31.0, 15.0/31.0, 17.0/31.0, 19.0/31.0, 21.0/31.0, 23.0/31.0, 25.0/31.0, 27.0/31.0, 29.0/31.0, 31.0/31.0, -31.0/31.0, -29.0/31.0, -27.0/31.0, -25.0/31.0, -23.0/31.0, -21.0/31.0, -19.0/31.0, -17.0/31.0, -15.0/31.0, -13.0/31.0, -11.0/31.0, -9.0/31.0, -7.0/31.0, -5.0/31.0, -3.0/31.0, -1.0/31.0]),\r\n\t\tConfig._centerWave([0.0, -0.2, -0.4, -0.6, -0.8, -1.0, 1.0, -0.8, -0.6, -0.4, -0.2, 1.0, 0.8, 0.6, 0.4, 0.2]),\r\n\t\tConfig._centerWave([1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0]),\r\n\t\tConfig._centerWave([1.0, -1.0, 1.0, -1.0, 1.0, 0.0]),\r\n\t\tConfig._centerWave([0.0, 0.2, 0.4, 0.5, 0.6, 0.7, 0.8, 0.85, 0.9, 0.95, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.95, 0.9, 0.85, 0.8, 0.7, 0.6, 0.5, 0.4, 0.2, 0.0, -0.2, -0.4, -0.5, -0.6, -0.7, -0.8, -0.85, -0.9, -0.95, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -0.95, -0.9, -0.85, -0.8, -0.7, -0.6, -0.5, -0.4, -0.2]),\r\n\t\tConfig._centerWave([1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0,1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0]),\r\n\t\tConfig._centerWave([1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0]),\r\n\t\tConfig._centerWave([0.0, 0.1875, 0.3125, 0.5625, 0.5, 0.75, 0.875, 1.0, 1.0, 0.6875, 0.5, 0.625, 0.625, 0.5, 0.375, 0.5625, 0.4375, 0.5625, 0.4375, 0.4375, 0.3125, 0.1875, 0.1875, 0.375, 0.5625, 0.5625, 0.5625, 0.5625, 0.5625, 0.4375, 0.25, 0.0]),\r\n\t\tConfig._centerWave([1.0, 0.7, 0.1, 0.1, 0, 0, 0, 0, 0, 0.1, 0.2, 0.15, 0.25, 0.125, 0.215, 0.345, 4.0]),\r\n\t\tConfig._centerWave([1.0 / 15.0, 3.0 / 15.0, 5.0 / 15.0, 9.0, 0.06]),\r\n\t\tConfig._centerWave([-0.5, 3.5, 3.0, -0.5, -0.25, -1.0]),\r\n\t\tConfig._centerWave([0.0, 0.05, 0.125, 0.2, 0.25, 0.3, 0.425, 0.475, 0.525, 0.625, 0.675, 0.725, 0.775, 0.8, 0.825, 0.875, 0.9, 0.925, 0.95, 0.975, 0.98, 0.99, 0.995, 1, 0.995, 0.99, 0.98, 0.975, 0.95, 0.925, 0.9, 0.875, 0.825, 0.8, 0.775, 0.725, 0.675, 0.625, 0.525, 0.475, 0.425, 0.3, 0.25, 0.2, 0.125, 0.05, 0.0, -0.05, -0.125, -0.2, -0.25, -0.3, -0.425, -0.475, -0.525, -0.625, -0.675, -0.725, -0.775, -0.8, -0.825, -0.875, -0.9, -0.925, -0.95, -0.975, -0.98, -0.99, -0.995, -1, -0.995, -0.99, -0.98, -0.975, -0.95, -0.925, -0.9, -0.875, -0.825, -0.8, -0.775, -0.725, -0.675, -0.625, -0.525, -0.475, -0.425, -0.3, -0.25, -0.2, -0.125, -0.05]),\r\n\t\tConfig._centerWave([1.0, 1.0, 1.0, 1.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0]),\r\n\t\tConfig._centerWave([0.0, 0.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0]),\r\n\t\tConfig._centerWave([1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0]),\r\n\t\tConfig._centerWave([1.0, 1.0 / 2.0, 1.0 / 3.0, 1.0 / 4.0]),\r\n\t\tConfig._centerWave([-0.9, -1.0, -0.85, -0.775, -0.7, -0.6, -0.5, -0.4, -0.325, -0.225, -0.2, -0.125, -0.1, -0.11, -0.125, -0.15, -0.175, -0.18, -0.2, -0.21, -0.22, -0.21, -0.2, -0.175, -0.15, -0.1, -0.5, 0.75, 0.11, 0.175, 0.2, 0.25, 0.26, 0.275, 0.26, 0.25, 0.225, 0.2, 0.19, 0.18, 0.19, 0.2, 0.21, 0.22, 0.23, 0.24, 0.25, 0.26, 0.275, 0.28, 0.29, 0.3, 0.29, 0.28, 0.27, 0.26, 0.25, 0.225, 0.2, 0.175, 0.15, 0.1, 0.075, 0.0, -0.01, -0.025, 0.025, 0.075, 0.2, 0.3, 0.475, 0.6, 0.75, 0.85, 0.85, 1.0, 0.99, 0.95, 0.8, 0.675, 0.475, 0.275, 0.01, -0.15, -0.3, -0.475, -0.5, -0.6, -0.71, -0.81, -0.9, -1.0, -0.9]),\r\n\t\tConfig._centerWave([-1.0, -0.95, -0.975, -0.9, -0.85, -0.8, -0.775, -0.65, -0.6, -0.5, -0.475, -0.35, -0.275, -0.2, -0.125, -0.05, 0.0, 0.075, 0.125, 0.15, 0.20, 0.21, 0.225, 0.25, 0.225, 0.21, 0.20, 0.19, 0.175, 0.125, 0.10, 0.075, 0.06, 0.05, 0.04, 0.025, 0.04, 0.05, 0.10, 0.15, 0.225, 0.325, 0.425, 0.575, 0.70, 0.85, 0.95, 1.0, 0.9, 0.675, 0.375, 0.2, 0.275, 0.4, 0.5, 0.55, 0.6, 0.625, 0.65, 0.65, 0.65, 0.65, 0.64, 0.6, 0.55, 0.5, 0.4, 0.325, 0.25, 0.15, 0.05, -0.05, -0.15, -0.275, -0.35, -0.45, -0.55, -0.65, -0.7, -0.78, -0.825, -0.9, -0.925, -0.95, -0.975]),\r\n\t\tConfig._centerWave([1.0, 0.0, 0.1, -0.1, -0.2, -0.4, -0.3, -1.0]),\r\n\t\tConfig._centerWave([1.0, -1.0, 4.0, 2.15, 4.13, 5.15, 0.0, -0.05, 1.0]),\r\n\t\tConfig._centerWave([6.1, -2.9, 1.4, -2.9]),\r\n\t\tConfig._centerWave([1, 4, 2, 1, -0.1, -1, -0.12]),\r\n\t\tConfig._centerWave([0.2, 1.0, 2.6, 1.0, 0.0, -2.4]),\r\n\t\tConfig._centerWave([1.0, 0.9, 0.8, 0.7, 0.6, 0.5, 0.4, 0.3, 0.2, 0.1, 0.0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9]),\r\n\t\tConfig._centerWave([1.0, 0.9, 0.8, 0.7, 0.6, 0.5, 0.4, 0.3, 0.2, 0.1, 0.0]),\r\n\t\tConfig._centerWave([1.0, -0.9, 0.8, -0.7, 0.6, -0.5, 0.4, -0.3, 0.2, -0.1, 0.0, -0.1, 0.2, -0.3, 0.4, -0.5, 0.6, -0.7, 0.8, -0.9, 1.0]),\r\n\t];\r\n\tstatic readonly wavesMixC: ReadonlyArray<Float64Array> = [\r\n\t\tConfig._centerWave([1.0 / 15.0, 3.0 / 15.0, 5.0 / 15.0, 7.0 / 15.0, 9.0 / 15.0, 11.0 / 15.0, 13.0 / 15.0, 15.0 / 15.0, 15.0 / 15.0, 13.0 / 15.0, 11.0 / 15.0, 9.0 / 15.0, 7.0 / 15.0, 5.0 / 15.0, 3.0 / 15.0, 1.0 / 15.0, -1.0 / 15.0, -3.0 / 15.0, -5.0 / 15.0, -7.0 / 15.0, -9.0 / 15.0, -11.0 / 15.0, -13.0 / 15.0, -15.0 / 15.0, -15.0 / 15.0, -13.0 / 15.0, -11.0 / 15.0, -9.0 / 15.0, -7.0 / 15.0, -5.0 / 15.0, -3.0 / 15.0, -1.0 / 15.0]),\r\n\t\tConfig._centerWave([1.0, -1.0]),\r\n\t\tConfig._centerWave([1.0, -1.0, -1.0, -1.0]),\r\n\t\tConfig._centerWave([1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0]),\r\n\t\tConfig._centerWave([1.0 / 31.0, 3.0 / 31.0, 5.0 / 31.0, 7.0 / 31.0, 9.0 / 31.0, 11.0 / 31.0, 13.0 / 31.0, 15.0 / 31.0, 17.0 / 31.0, 19.0 / 31.0, 21.0 / 31.0, 23.0 / 31.0, 25.0 / 31.0, 27.0 / 31.0, 29.0 / 31.0, 31.0 / 31.0, -31.0 / 31.0, -29.0 / 31.0, -27.0 / 31.0, -25.0 / 31.0, -23.0 / 31.0, -21.0 / 31.0, -19.0 / 31.0, -17.0 / 31.0, -15.0 / 31.0, -13.0 / 31.0, -11.0 / 31.0, -9.0 / 31.0, -7.0 / 31.0, -5.0 / 31.0, -3.0 / 31.0, -1.0 / 31.0]),\r\n\t\tConfig._centerWave([0.0, -0.2, -0.4, -0.6, -0.8, -1.0, 1.0, -0.8, -0.6, -0.4, -0.2, 1.0, 0.8, 0.6, 0.4, 0.2]),\r\n\t\tConfig._centerWave([1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0]),\r\n\t\tConfig._centerWave([1.0, -1.0, 1.0, -1.0, 1.0, 0.0]),\r\n\t\tConfig._centerWave([0.0, 0.2, 0.4, 0.5, 0.6, 0.7, 0.8, 0.85, 0.9, 0.95, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.95, 0.9, 0.85, 0.8, 0.7, 0.6, 0.5, 0.4, 0.2, 0.0, -0.2, -0.4, -0.5, -0.6, -0.7, -0.8, -0.85, -0.9, -0.95, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -0.95, -0.9, -0.85, -0.8, -0.7, -0.6, -0.5, -0.4, -0.2]),\r\n\t\tConfig._centerWave([1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0,1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0]),\r\n\t\tConfig._centerWave([1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0]),\r\n\t\tConfig._centerWave([0.0, 0.1875, 0.3125, 0.5625, 0.5, 0.75, 0.875, 1.0, 1.0, 0.6875, 0.5, 0.625, 0.625, 0.5, 0.375, 0.5625, 0.4375, 0.5625, 0.4375, 0.4375, 0.3125, 0.1875, 0.1875, 0.375, 0.5625, 0.5625, 0.5625, 0.5625, 0.5625, 0.4375, 0.25, 0.0]),\r\n\t\tConfig._centerWave([1.0, 0.7, 0.1, 0.1, 0, 0, 0, 0, 0, 0.1, 0.2, 0.15, 0.25, 0.125, 0.215, 0.345, 4.0]),\r\n\t\tConfig._centerWave([1.0 / 15.0, 3.0 / 15.0, 5.0 / 15.0, 9.0, 0.06]),\r\n\t\tConfig._centerWave([-0.5, 3.5, 3.0, -0.5, -0.25, -1.0]),\r\n\t\tConfig._centerWave([0.0, 0.05, 0.125, 0.2, 0.25, 0.3, 0.425, 0.475, 0.525, 0.625, 0.675, 0.725, 0.775, 0.8, 0.825, 0.875, 0.9, 0.925, 0.95, 0.975, 0.98, 0.99, 0.995, 1, 0.995, 0.99, 0.98, 0.975, 0.95, 0.925, 0.9, 0.875, 0.825, 0.8, 0.775, 0.725, 0.675, 0.625, 0.525, 0.475, 0.425, 0.3, 0.25, 0.2, 0.125, 0.05, 0.0, -0.05, -0.125, -0.2, -0.25, -0.3, -0.425, -0.475, -0.525, -0.625, -0.675, -0.725, -0.775, -0.8, -0.825, -0.875, -0.9, -0.925, -0.95, -0.975, -0.98, -0.99, -0.995, -1, -0.995, -0.99, -0.98, -0.975, -0.95, -0.925, -0.9, -0.875, -0.825, -0.8, -0.775, -0.725, -0.675, -0.625, -0.525, -0.475, -0.425, -0.3, -0.25, -0.2, -0.125, -0.05]),\r\n\t\tConfig._centerWave([1.0, 1.0, 1.0, 1.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0]),\r\n\t\tConfig._centerWave([0.0, 0.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0]),\r\n\t\tConfig._centerWave([1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0]),\r\n\t\tConfig._centerWave([1.0, 1.0 / 2.0, 1.0 / 3.0, 1.0 / 4.0]),\r\n\t\tConfig._centerWave([-0.9, -1.0, -0.85, -0.775, -0.7, -0.6, -0.5, -0.4, -0.325, -0.225, -0.2, -0.125, -0.1, -0.11, -0.125, -0.15, -0.175, -0.18, -0.2, -0.21, -0.22, -0.21, -0.2, -0.175, -0.15, -0.1, -0.5, 0.75, 0.11, 0.175, 0.2, 0.25, 0.26, 0.275, 0.26, 0.25, 0.225, 0.2, 0.19, 0.18, 0.19, 0.2, 0.21, 0.22, 0.23, 0.24, 0.25, 0.26, 0.275, 0.28, 0.29, 0.3, 0.29, 0.28, 0.27, 0.26, 0.25, 0.225, 0.2, 0.175, 0.15, 0.1, 0.075, 0.0, -0.01, -0.025, 0.025, 0.075, 0.2, 0.3, 0.475, 0.6, 0.75, 0.85, 0.85, 1.0, 0.99, 0.95, 0.8, 0.675, 0.475, 0.275, 0.01, -0.15, -0.3, -0.475, -0.5, -0.6, -0.71, -0.81, -0.9, -1.0, -0.9]),\r\n\t\tConfig._centerWave([-1.0, -0.95, -0.975, -0.9, -0.85, -0.8, -0.775, -0.65, -0.6, -0.5, -0.475, -0.35, -0.275, -0.2, -0.125, -0.05, 0.0, 0.075, 0.125, 0.15, 0.20, 0.21, 0.225, 0.25, 0.225, 0.21, 0.20, 0.19, 0.175, 0.125, 0.10, 0.075, 0.06, 0.05, 0.04, 0.025, 0.04, 0.05, 0.10, 0.15, 0.225, 0.325, 0.425, 0.575, 0.70, 0.85, 0.95, 1.0, 0.9, 0.675, 0.375, 0.2, 0.275, 0.4, 0.5, 0.55, 0.6, 0.625, 0.65, 0.65, 0.65, 0.65, 0.64, 0.6, 0.55, 0.5, 0.4, 0.325, 0.25, 0.15, 0.05, -0.05, -0.15, -0.275, -0.35, -0.45, -0.55, -0.65, -0.7, -0.78, -0.825, -0.9, -0.925, -0.95, -0.975]),\r\n\t\tConfig._centerWave([0.7, 0.0, 0.1, -0.1, -0.2, -0.4, -0.3, -0.7]),\r\n\t\tConfig._centerWave([1.0, -1.0, 4.0, 2.15, 4.1, 5.05, 0.0, -0.05, 1.0]),\r\n\t\tConfig._centerWave([4.5, -1.7, 1.0, -1.7]),\r\n\t\tConfig._centerWave([0.1, 0.4, 0.2, 0.1, -0.1, -1, -0.12]),\r\n\t\tConfig._centerWave([.03, .13, .30, 1.0, 0.0, -.26]),\r\n\t\tConfig._centerWave([2, 1.75, 1.5, 1.25, 1, .75, .5, .25, 0.0, 0.25, 0.5, 0.75, 1, 1.25, 1.5, 1.75]),\r\n\t\tConfig._centerWave([1.0, 1.9, 1.8, 1.7, 1.6, 1.5, 1.4, 1.3, 1.2, 1.1, 1.0]),\r\n\t\tConfig._centerWave([-1.0, -0.9, 0.8, -0.7, 0.6, -0.5, 0.4, -0.3, 0.2, -0.1, 0.0, -0.1, 0.2, -0.3, 0.4, -0.5, 0.6, -0.7, 0.8, -0.9, -1.0]),\r\n\t];\r\n\tstatic readonly pwmwaves: ReadonlyArray<Float64Array> = [\r\n\t\tConfig._centerWave([1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0]),\r\n\t\tConfig._centerWave([1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0]),\r\n\t\tConfig._centerWave([1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0]),\r\n\t\tConfig._centerWave([1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0]),\r\n\t\tConfig._centerWave([1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0]),\r\n\t\tConfig._centerWave([1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0]),\r\n\t\tConfig._centerWave([1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0]),\r\n\t\tConfig._centerWave([1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0]),\r\n\t\tConfig._centerWave([1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0]),\r\n\t\tConfig._centerWave([1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0]),\r\n\t];\r\n\tstatic readonly sineWaveLength: number = 1 << 8; // 256\r\n\tstatic readonly sineWaveMask: number = Config.sineWaveLength - 1;\r\n\tstatic readonly sineWave: Float64Array = Config.generateSineWave();\r\n\t\r\n\tprivate static _centerWave(wave: Array<number>): Float64Array {\r\n\t\tlet sum: number = 0.0;\r\n\t\tfor (let i: number = 0; i < wave.length; i++) sum += wave[i];\r\n\t\tconst average: number = sum / wave.length;\r\n\t\tfor (let i: number = 0; i < wave.length; i++) wave[i] -= average;\r\n\t\treturn new Float64Array(wave);\r\n\t}\r\n\t\r\n\tstatic getDrumWave(index: number): Float32Array {\r\n\t\tlet wave: Float32Array | null = Config._drumWaves[index];\r\n\t\tif (wave == null) {\r\n\t\t\twave = new Float32Array(32768);\r\n\t\t\tConfig._drumWaves[index] = wave;\r\n\t\t\t\r\n\t\t\tif (index == 0) {\r\n\t\t\t\t// The \"retro\" drum uses a \"Linear Feedback Shift Register\" similar to the NES noise channel.\r\n\t\t\t\tlet drumBuffer: number = 1;\r\n\t\t\t\tfor (let i: number = 0; i < 32768; i++) {\r\n\t\t\t\t\twave[i] = (drumBuffer & 1) * 2.0 - 1.0;\r\n\t\t\t\t\tlet newBuffer: number = drumBuffer >> 1;\r\n\t\t\t\t\tif (((drumBuffer + newBuffer) & 1) == 1) {\r\n\t\t\t\t\t\tnewBuffer += 1 << 14;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdrumBuffer = newBuffer;\r\n\t\t\t\t}\r\n\t\t\t} else if (index == 1) {\r\n\t\t\t\t// White noise is just random values for each sample.\r\n\t\t\t\tfor (let i: number = 0; i < 32768; i++) {\r\n\t\t\t\t\twave[i] = Math.random() * 2.0 - 1.0;\r\n\t\t\t\t}\r\n\t\t\t} else if (index == 2) {\r\n\t\t\t\t// \"periodic\" drum.\r\n\t\t\t\tlet drumBuffer: number = 1;\r\n\t\t\t\tfor (let i: number = 0; i < 32768; i++) {\r\n\t\t\t\t\twave[i] = (drumBuffer & 1) * 2.0 - 1.0;\r\n\t\t\t\t\tlet newBuffer: number = drumBuffer >> 1;\r\n\t\t\t\t\tif (((drumBuffer + newBuffer) & 1) == 1) {\r\n\t\t\t\t\t\tnewBuffer += 2 << 14;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdrumBuffer = newBuffer;\r\n\t\t\t\t}\r\n\t\t\t} else if (index == 3) {\r\n\t\t\t\t// \"detuned periodic\" drum.\r\n\t\t\t\tlet drumBuffer: number = 1;\r\n\t\t\t\tfor (let i: number = 0; i < 32767; i++) {\r\n\t\t\t\t\twave[i] = (drumBuffer & 1) * 2.0 - 1.0;\r\n\t\t\t\t\tlet newBuffer: number = drumBuffer >> 2;\r\n\t\t\t\t\tif (((drumBuffer + newBuffer) & 1) == 1) {\r\n\t\t\t\t\t\tnewBuffer += 4 << 14;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdrumBuffer = newBuffer;\r\n\t\t\t\t}\r\n\t\t\t} else if (index == 4) {\r\n\t\t\t\t// \"shine\" drum.\r\n\t\t\t\tlet drumBuffer: number = 1;\r\n\t\t\t\tfor (let i: number = 0; i < 32768; i++) {\r\n\t\t\t\t\twave[i] = (drumBuffer & 1) * 2.0 - 1.0;\r\n\t\t\t\t\tlet newBuffer: number = drumBuffer >> 1;\r\n\t\t\t\t\tif (((drumBuffer + newBuffer) & 1) == 1) {\r\n\t\t\t\t\t\tnewBuffer += 10 << 2;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdrumBuffer = newBuffer;\r\n\t\t\t\t}\r\n\t\t\t} else if (index == 5) {\r\n\t\t\t\t// \"hollow\" drums, designed in frequency space and then converted via FFT:\r\n\t\t\t\tConfig.drawNoiseSpectrum(wave, 10, 11, 1, 1, 0);\r\n\t\t\t\tConfig.drawNoiseSpectrum(wave, 11, 14, -2, -2, 0);\r\n\t\t\t\tinverseRealFourierTransform(wave);\r\n\t\t\t\tscaleElementsByFactor(wave, 1.0 / Math.sqrt(wave.length));\r\n\t\t\t} else if (index == 6) {\r\n\t\t\t\t// \"deep\" drum, designed in frequency space and then converted via FFT:\r\n\t\t\t\tConfig.drawNoiseSpectrum(wave, 1, 10, 1, 1, 0);\r\n\t\t\t\tConfig.drawNoiseSpectrum(wave, 20, 14, -2, -2, 0);\r\n\t\t\t\tinverseRealFourierTransform(wave);\r\n\t\t\t\tscaleElementsByFactor(wave, 1.0 / Math.sqrt(wave.length));\r\n\t\t\t} else if (index == 7) {\r\n\t\t\t\t// \"cutter\" drum.\r\n\t\t\t\tlet drumBuffer: number = 1;\r\n\t\t\t\tfor (let i: number = 0; i < 32768; i++) {\r\n\t\t\t\t\twave[i] = (drumBuffer & 1) * 4.0 * Math.random();\r\n\t\t\t\t\tlet newBuffer: number = drumBuffer >> 1;\r\n\t\t\t\t\tif (((drumBuffer + newBuffer) & 1) == 1) {\r\n\t\t\t\t\t\tnewBuffer += 15 << 2;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdrumBuffer = newBuffer;\r\n\t\t\t\t}\r\n\t\t\t} else if (index == 8) {\r\n\t\t\t\t// \"metallic\" drum.\r\n\t\t\t\tlet drumBuffer: number = 1;\r\n\t\t\t\tfor (let i: number = 0; i < 32768; i++) {\r\n\t\t\t\t\twave[i] = (drumBuffer & 1) / 2.0 + 0.5;\r\n\t\t\t\t\tlet newBuffer: number = drumBuffer >> 1;\r\n\t\t\t\t\tif (((drumBuffer + newBuffer) & 1) == 1) {\r\n\t\t\t\t\t\tnewBuffer -= 10 << 2;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdrumBuffer = newBuffer;\r\n\t\t\t\t}\r\n\t\t\t} else if (index == 9) {\r\n\t\t\t\t// \"snare\" drum.\r\n\t\t\t\tfor (let i: number = 0; i < 32768; i++) {\r\n\t\t\t\t\twave[i] = Math.random() * 2.0 - 1.0;\r\n\t\t\t\t}\r\n\t\t\t/*\r\n\t\t\t} else if (index == 10) {\r\n\t\t\t\t// \"tom-tom\" drums, designed in frequency space and then converted via FFT:\r\n\t\t\t\tConfig.drawNoiseSpectrum(wave, 10, 14, 0, -4, 0);\r\n\t\t\t\tinverseRealFourierTransform(wave);\r\n\t\t\t\tscaleElementsByFactor(wave, 1.0 / Math.sqrt(wave.length));\r\n\t\t\t} else if (index == 11) {\r\n\t\t\t\t// \"cymbal\" drums, designed in frequency space and then converted via FFT:\r\n\t\t\t\tConfig.drawNoiseSpectrum(wave, 9, 9.4, -1, -1, -0.5);\r\n\t\t\t\tConfig.drawNoiseSpectrum(wave, 9.7, 10, -1, -1, -0.5);\r\n\t\t\t\tConfig.drawNoiseSpectrum(wave, 10.3, 10.6, -1, -1, -0.5);\r\n\t\t\t\tConfig.drawNoiseSpectrum(wave, 10.9, 11.1, -1, -1, -0.5);\r\n\t\t\t\tConfig.drawNoiseSpectrum(wave, 11.3, 11.4, 0, 0, -0.5);\r\n\t\t\t\tConfig.drawNoiseSpectrum(wave, 11.5, 11.7, 1.5, 1.5, -0.5);\r\n\t\t\t\tConfig.drawNoiseSpectrum(wave, 11.7, 12, -1, -1, -0.5);\r\n\t\t\t\tConfig.drawNoiseSpectrum(wave, 12, 12.1, 2, 2, -0.5);\r\n\t\t\t\tConfig.drawNoiseSpectrum(wave, 12.1, 12.6, 0, 2, -0.5);\r\n\t\t\t\tConfig.drawNoiseSpectrum(wave, 12.6, 13, 0, 0, -0.5);\r\n\t\t\t\tConfig.drawNoiseSpectrum(wave, 13, 14, 1, -3, -0.5);\r\n\t\t\t\tinverseRealFourierTransform(wave);\r\n\t\t\t\tscaleElementsByFactor(wave, 1.0 / Math.sqrt(wave.length));\r\n\t\t\t} else if (index == 12) {\r\n\t\t\t\t// \"bass\" drums, designed in frequency space and then converted via FFT:\r\n\t\t\t\tConfig.drawNoiseSpectrum(wave, 7, 8, -2, 4, 0);\r\n\t\t\t\tConfig.drawNoiseSpectrum(wave, 8, 9, 4, -2, 0);\r\n\t\t\t\tConfig.drawNoiseSpectrum(wave, 9, 14, -2, -6, 0);\r\n\t\t\t\tinverseRealFourierTransform(wave);\r\n\t\t\t\tscaleElementsByFactor(wave, 1.0 / Math.sqrt(wave.length));\r\n\t\t\t*/\r\n\t\t\t} else {\r\n\t\t\t\tthrow new Error(\"Unrecognized drum index: \" + index);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\treturn wave;\r\n\t}\r\n\t\r\n\tprivate static drawNoiseSpectrum(wave: Float32Array, lowOctave: number, highOctave: number, lowPower: number, highPower: number, overalSlope: number): void {\r\n\t\tconst referenceOctave: number = 11;\r\n\t\tconst referenceIndex: number = 1 << referenceOctave;\r\n\t\tconst lowIndex: number = Math.pow(2, lowOctave) | 0;\r\n\t\tconst highIndex: number = Math.pow(2, highOctave) | 0;\r\n\t\tconst log2: number = Math.log(2);\r\n\t\tfor (let i: number = lowIndex; i < highIndex; i++) {\r\n\t\t\tlet amplitude: number = Math.pow(2, lowPower + (highPower - lowPower) * (Math.log(i) / log2 - lowOctave) / (highOctave - lowOctave));\r\n\t\t\tamplitude *= Math.pow(i / referenceIndex, overalSlope);\r\n\t\t\tconst radians: number = Math.random() * Math.PI * 2.0;\r\n\t\t\twave[i] = Math.cos(radians) * amplitude;\r\n\t\t\twave[32768 - i] = Math.sin(radians) * amplitude;\r\n\t\t}\r\n\t}\r\n\t\r\n\tprivate static generateSineWave(): Float64Array {\r\n\t\tconst wave: Float64Array = new Float64Array(Config.sineWaveLength + 1);\r\n\t\tfor (let i: number = 0; i < Config.sineWaveLength + 1; i++) {\r\n\t\t\twave[i] = Math.sin(i * Math.PI * 2.0 / Config.sineWaveLength);\r\n\t\t}\r\n\t\treturn wave;\r\n\t}\r\n}\r\n\r\n// Pardon the messy type casting. This allows accessing array members by numerical index or string name.\r\nexport function toNameMap<T extends BeepBoxOption>(array: Array<Pick<T, Exclude<keyof T, \"index\">>>): DictionaryArray<T> {\r\n\tconst dictionary: Dictionary<T> = {};\r\n\tfor (let i: number = 0; i < array.length; i++) {\r\n\t\tconst value: any = array[i];\r\n\t\tvalue.index = i;\r\n\t\tdictionary[value.name] = <T> value;\r\n\t}\r\n\tconst result: DictionaryArray<T> = <DictionaryArray<T>> <any> array;\r\n\tresult.dictionary = dictionary;\r\n\treturn result;\r\n}","// Copyright (C) John Nesky, distributed under the MIT license.\n\nexport function applyElementArgs<T extends HTMLElement | SVGElement | DocumentFragment>(element: T, args: Array<any>): T {\n\tfor (const arg of args) {\n\t\tif (arg instanceof Node) {\n\t\t\telement.appendChild(arg);\n\t\t} else if (typeof arg === \"string\") {\n\t\t\telement.appendChild(document.createTextNode(arg));\n\t\t} else if (typeof arg === \"function\") {\n\t\t\tapplyElementArgs(element, [arg()]);\n\t\t} else if (Array.isArray(arg)) {\n\t\t\tapplyElementArgs(element, arg);\n\t\t} else if (arg && typeof Symbol !== \"undefined\" && typeof arg[Symbol.iterator] === \"function\") {\n\t\t\tapplyElementArgs(element, [...arg]);\n\t\t} else if (arg && arg.constructor === Object && element instanceof Element) {\n\t\t\t// If the argument is a literal {} Object\n\t\t\tfor (const key of Object.keys(arg)) {\n\t\t\t\tconst value = arg[key];\n\t\t\t\t/*if (key === \"classList\") {\n\t\t\t\t\tif (typeof value === \"string\") {\n\t\t\t\t\t\telement.classList.add(...value.split(\" \"));\n\t\t\t\t\t} else if (Array.isArray(arg) || (value && typeof Symbol !== \"undefined\" && typeof value[Symbol.iterator] === \"function\")) {\n\t\t\t\t\t\telement.classList.add(...value);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.warn(\"Invalid classList value \\\"\" + value + \"\\\" on \" + element.tagName + \" element.\");\n\t\t\t\t\t}\n\t\t\t\t} else*/ if (key === \"class\" /* || key === \"className\" */) {\n\t\t\t\t\tif (typeof value === \"string\") {\n\t\t\t\t\t\telement.setAttribute(\"class\", value);\n\t\t\t\t\t} else if (Array.isArray(arg) || (value && typeof Symbol !== \"undefined\" && typeof value[Symbol.iterator] === \"function\")) {\n\t\t\t\t\t\telement.setAttribute(\"class\", [...value].join(\" \"));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.warn(\"Invalid \" + key + \" value \\\"\" + value + \"\\\" on \" + element.tagName + \" element.\");\n\t\t\t\t\t}\n\t\t\t\t} else if (key === \"style\") {\n\t\t\t\t\tif (value && value.constructor === Object) {\n\t\t\t\t\t\tfor (const styleKey of Object.keys(value)) {\n\t\t\t\t\t\t\tif (styleKey in (<HTMLElement | SVGElement>element).style) {\n\t\t\t\t\t\t\t\t// In practice, camelCase and kebab-case properties both work as properties on CSSStyleDeclaration objects.\n\t\t\t\t\t\t\t\t(<any> element).style[styleKey] = value[styleKey];\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// CSS variables start with -- and must be set with setProperty.\n\t\t\t\t\t\t\t\t(<HTMLElement | SVGElement>element).style.setProperty(styleKey, value[styleKey]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\telement.setAttribute(key, value);\n\t\t\t\t\t}\n\t\t\t\t} else if (typeof(value) === \"function\") {\n\t\t\t\t\t// If value is a callback, set as a property instead trying to coerce to string.\n\t\t\t\t\t(<any>element)[key] = value;\n\t\t\t\t} else if (typeof(value) === \"boolean\") {\n\t\t\t\t\t// If value is boolean, set attribute if true, remove if false.\n\t\t\t\t\tif (value) element.setAttribute(key, \"\");\n\t\t\t\t\telse element.removeAttribute(key);\n\t\t\t\t} else {\n\t\t\t\t\t// Default to setting attribute, as if writing html directly.\n\t\t\t\t\telement.setAttribute(key, value);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\t// Just convert unrecognized objects to text and append them.\n\t\t\telement.appendChild(document.createTextNode(arg));\n\t\t}\n\t}\n\treturn element;\n}\n\nexport const svgNS: string = \"http://www.w3.org/2000/svg\";\n\nexport function parseHTML(...args: Array<any>): DocumentFragment {\n\treturn document.createRange().createContextualFragment(args.join());\n}\n\n//let svgParser: SVGSVGElement | null = null;\nexport function parseSVG(...args: Array<any>): DocumentFragment {\n\tconst fragment: DocumentFragment = document.createDocumentFragment();\n\t\n\t// Internet Explorer doesn't support the first method here, so I commented it out and used a slightly more complex one involving DOMParser below.\n\t/*\n\tif (svgParser === null) svgParser = <SVGSVGElement>document.createElementNS(svgNS, \"svg\");\n\tsvgParser.innerHTML = args.join();\n\twhile (svgParser.firstChild !== null) fragment.appendChild(svgParser.firstChild);\n\t*/\n\tconst svgParser: Element = new DOMParser().parseFromString(\"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\">\" + args.join() + \"</svg>\", \"image/svg+xml\").documentElement;\n\twhile (svgParser.firstChild !== null) {\n\t\tdocument.importNode(svgParser.firstChild, true);\n\t\tfragment.appendChild(svgParser.firstChild);\n\t}\n\t\n\treturn fragment;\n}\n\nexport function replaceScriptWith(...args: Array<any>): void {\n\tlet currentScript: HTMLScriptElement | SVGScriptElement | null = document.currentScript;\n\tif (currentScript == null) { // double-equals to intentionally include undefined in Internet Explorer.\n\t\t\n\t\t// Internet Explorer doens't support currentScript, try this method instead:\n\t\tif (document.readyState === \"loading\") {\n\t\t\tconst scripts: HTMLCollectionOf<HTMLScriptElement> = document.getElementsByTagName(\"script\");\n\t\t\tcurrentScript = scripts[scripts.length - 1];\n\t\t}\n\t\t\n\t\tif (currentScript == null) {\n\t\t\tconsole.warn(\"Couldn't replace script because no script is currently being parsed and executed, maybe this is happening in a callback function or event handler instead?\");\n\t\t\treturn;\n\t\t}\n\t}\n\tif (currentScript.parentNode === null) {\n\t\tconsole.warn(\"Couldn't replace script element because it is not attached to a parent anymore, did you try to replace the same script more than once?\");\n\t\treturn;\n\t}\n\tcurrentScript.parentNode.replaceChild(applyElementArgs(document.createDocumentFragment(), args), currentScript);\n}\n\nexport function applyToElement<T extends HTMLElement | SVGElement | DocumentFragment>(element: T, ...args: Array<any>): T {\n\tif (!(element instanceof Element || element instanceof DocumentFragment)) {\n\t\tconsole.warn(\"Couldn't apply to provided argument because it's not an element or DocumentFragment.\");\n\t\treturn element;\n\t}\n\treturn applyElementArgs(element, args);\n}\n","// Copyright (C) John Nesky, distributed under the MIT license.\n\nimport {applyElementArgs, svgNS, parseHTML, parseSVG, replaceScriptWith, applyToElement} from \"./elements-base.js\";\nexport {replaceScriptWith, applyToElement};\n\ninterface HTMLElementFactory {\n\t(...args: Array<string>): DocumentFragment;\n\t//readonly [key: string]: (...args: Array<any>) => HTMLElement;\n\ta(...args: Array<any>): HTMLAnchorElement;\n\tabbr(...args: Array<any>): HTMLElement;\n\taddress(...args: Array<any>): HTMLElement;\n\tarea(...args: Array<any>): HTMLAreaElement;\n\tarticle(...args: Array<any>): HTMLElement;\n\taside(...args: Array<any>): HTMLElement;\n\taudio(...args: Array<any>): HTMLAudioElement;\n\tb(...args: Array<any>): HTMLElement;\n\tbase(...args: Array<any>): HTMLBaseElement;\n\tbdi(...args: Array<any>): HTMLElement;\n\tbdo(...args: Array<any>): HTMLElement;\n\tblockquote(...args: Array<any>): HTMLQuoteElement;\n\tbr(...args: Array<any>): HTMLBRElement;\n\tbutton(...args: Array<any>): HTMLButtonElement;\n\tcanvas(...args: Array<any>): HTMLCanvasElement;\n\tcaption(...args: Array<any>): HTMLTableCaptionElement;\n\tcite(...args: Array<any>): HTMLElement;\n\tcode(...args: Array<any>): HTMLElement;\n\tcol(...args: Array<any>): HTMLTableColElement;\n\tcolgroup(...args: Array<any>): HTMLTableColElement;\n\tdatalist(...args: Array<any>): HTMLDataListElement;\n\tdd(...args: Array<any>): HTMLElement;\n\tdel(...args: Array<any>): HTMLModElement;\n\tdetails(...args: Array<any>): HTMLDetailsElement;\n\tdfn(...args: Array<any>): HTMLElement;\n\tdialog(...args: Array<any>): HTMLDialogElement;\n\tdiv(...args: Array<any>): HTMLDivElement;\n\tdl(...args: Array<any>): HTMLDListElement;\n\tdt(...args: Array<any>): HTMLElement;\n\tem(...args: Array<any>): HTMLElement;\n\tembed(...args: Array<any>): HTMLEmbedElement;\n\tfieldset(...args: Array<any>): HTMLFieldSetElement;\n\tfigcaption(...args: Array<any>): HTMLElement;\n\tfigure(...args: Array<any>): HTMLElement;\n\tfooter(...args: Array<any>): HTMLElement;\n\tform(...args: Array<any>): HTMLFormElement;\n\th1(...args: Array<any>): HTMLHeadingElement;\n\th2(...args: Array<any>): HTMLHeadingElement;\n\th3(...args: Array<any>): HTMLHeadingElement;\n\th4(...args: Array<any>): HTMLHeadingElement;\n\th5(...args: Array<any>): HTMLHeadingElement;\n\th6(...args: Array<any>): HTMLHeadingElement;\n\theader(...args: Array<any>): HTMLElement;\n\thr(...args: Array<any>): HTMLHRElement;\n\ti(...args: Array<any>): HTMLElement;\n\tiframe(...args: Array<any>): HTMLIFrameElement;\n\timg(...args: Array<any>): HTMLImageElement;\n\tinput(...args: Array<any>): HTMLInputElement;\n\tins(...args: Array<any>): HTMLModElement;\n\tkbd(...args: Array<any>): HTMLElement;\n\tlabel(...args: Array<any>): HTMLLabelElement;\n\tlegend(...args: Array<any>): HTMLLegendElement;\n\tli(...args: Array<any>): HTMLLIElement;\n\tlink(...args: Array<any>): HTMLLinkElement;\n\tmain(...args: Array<any>): HTMLElement;\n\tmap(...args: Array<any>): HTMLMapElement;\n\tmark(...args: Array<any>): HTMLElement;\n\tmenu(...args: Array<any>): HTMLMenuElement;\n\tmenuitem(...args: Array<any>): HTMLUnknownElement;\n\tmeta(...args: Array<any>): HTMLMetaElement;\n\tmeter(...args: Array<any>): HTMLMeterElement;\n\tnav(...args: Array<any>): HTMLElement;\n\tnoscript(...args: Array<any>): HTMLElement;\n\tobject(...args: Array<any>): HTMLObjectElement;\n\tol(...args: Array<any>): HTMLOListElement;\n\toptgroup(...args: Array<any>): HTMLOptGroupElement;\n\toption(...args: Array<any>): HTMLOptionElement;\n\toutput(...args: Array<any>): HTMLOutputElement;\n\tp(...args: Array<any>): HTMLParagraphElement;\n\tparam(...args: Array<any>): HTMLParamElement;\n\tpicture(...args: Array<any>): HTMLPictureElement;\n\tpre(...args: Array<any>): HTMLPreElement;\n\tprogress(...args: Array<any>): HTMLProgressElement;\n\tq(...args: Array<any>): HTMLQuoteElement;\n\trp(...args: Array<any>): HTMLElement;\n\trt(...args: Array<any>): HTMLElement;\n\truby(...args: Array<any>): HTMLElement;\n\ts(...args: Array<any>): HTMLElement;\n\tsamp(...args: Array<any>): HTMLElement;\n\tscript(...args: Array<any>): HTMLScriptElement;\n\tsection(...args: Array<any>): HTMLElement;\n\tselect(...args: Array<any>): HTMLSelectElement;\n\tsmall(...args: Array<any>): HTMLElement;\n\tsource(...args: Array<any>): HTMLSourceElement;\n\tspan(...args: Array<any>): HTMLSpanElement;\n\tstrong(...args: Array<any>): HTMLElement;\n\tstyle(...args: Array<any>): HTMLStyleElement;\n\tsub(...args: Array<any>): HTMLElement;\n\tsummary(...args: Array<any>): HTMLElement;\n\tsup(...args: Array<any>): HTMLElement;\n\ttable(...args: Array<any>): HTMLTableElement;\n\ttbody(...args: Array<any>): HTMLTableSectionElement;\n\ttd(...args: Array<any>): HTMLTableCellElement;\n\ttemplate(...args: Array<any>): HTMLTemplateElement;\n\ttextarea(...args: Array<any>): HTMLTextAreaElement;\n\ttfoot(...args: Array<any>): HTMLTableSectionElement;\n\tth(...args: Array<any>): HTMLTableCellElement;\n\tthead(...args: Array<any>): HTMLTableSectionElement;\n\ttime(...args: Array<any>): HTMLTimeElement;\n\ttitle(...args: Array<any>): HTMLTitleElement;\n\ttr(...args: Array<any>): HTMLTableRowElement;\n\ttrack(...args: Array<any>): HTMLTrackElement;\n\tu(...args: Array<any>): HTMLElement;\n\tul(...args: Array<any>): HTMLUListElement;\n\tvar(...args: Array<any>): HTMLElement;\n\tvideo(...args: Array<any>): HTMLVideoElement;\n\twbr(...args: Array<any>): HTMLElement;\n}\n\ninterface SVGElementFactory {\n\t(...args: Array<string>): DocumentFragment;\n\t//readonly [key: string]: (...args: Array<any>) => SVGElement;\n\ta(...args: Array<any>): SVGAElement;\n\taltGlyph(...args: Array<any>): SVGElement;\n\taltGlyphDef(...args: Array<any>): SVGElement;\n\taltGlyphItem(...args: Array<any>): SVGElement;\n\tanimate(...args: Array<any>): SVGAnimateElement;\n\tanimateMotion(...args: Array<any>): SVGAnimateMotionElement;\n\tanimateTransform(...args: Array<any>): SVGAnimateTransformElement;\n\tcircle(...args: Array<any>): SVGCircleElement;\n\tclipPath(...args: Array<any>): SVGClipPathElement;\n\t\"color-profile\"(...args: Array<any>): SVGElement;\n\tcolor_profile(...args: Array<any>): SVGElement;\n\tcursor(...args: Array<any>): SVGElement;\n\tdefs(...args: Array<any>): SVGDefsElement;\n\tdesc(...args: Array<any>): SVGDescElement;\n\tdiscard(...args: Array<any>): SVGElement;\n\tellipse(...args: Array<any>): SVGEllipseElement;\n\tfeBlend(...args: Array<any>): SVGFEBlendElement;\n\tfeColorMatrix(...args: Array<any>): SVGFEColorMatrixElement;\n\tfeComponentTransfer(...args: Array<any>): SVGFEComponentTransferElement;\n\tfeComposite(...args: Array<any>): SVGFECompositeElement;\n\tfeConvolveMatrix(...args: Array<any>): SVGFEConvolveMatrixElement;\n\tfeDiffuseLighting(...args: Array<any>): SVGFEDiffuseLightingElement;\n\tfeDisplacementMap(...args: Array<any>): SVGFEDisplacementMapElement;\n\tfeDistantLight(...args: Array<any>): SVGFEDistantLightElement;\n\tfeDropShadow(...args: Array<any>): SVGElement;\n\tfeFlood(...args: Array<any>): SVGFEFloodElement;\n\tfeFuncA(...args: Array<any>): SVGFEFuncAElement;\n\tfeFuncB(...args: Array<any>): SVGFEFuncBElement;\n\tfeFuncG(...args: Array<any>): SVGFEFuncGElement;\n\tfeFuncR(...args: Array<any>): SVGFEFuncRElement;\n\tfeGaussianBlur(...args: Array<any>): SVGFEGaussianBlurElement;\n\tfeImage(...args: Array<any>): SVGFEImageElement;\n\tfeMerge(...args: Array<any>): SVGFEMergeElement;\n\tfeMergeNode(...args: Array<any>): SVGFEMergeNodeElement;\n\tfeMorphology(...args: Array<any>): SVGFEMorphologyElement;\n\tfeOffset(...args: Array<any>): SVGFEOffsetElement;\n\tfePointLight(...args: Array<any>): SVGFEPointLightElement;\n\tfeSpecularLighting(...args: Array<any>): SVGFESpecularLightingElement;\n\tfeSpotLight(...args: Array<any>): SVGFESpotLightElement;\n\tfeTile(...args: Array<any>): SVGFETileElement;\n\tfeTurbulence(...args: Array<any>): SVGFETurbulenceElement;\n\tfilter(...args: Array<any>): SVGFilterElement;\n\tfont(...args: Array<any>): SVGElement;\n\t\"font-face\"(...args: Array<any>): SVGElement;\n\tfont_face(...args: Array<any>): SVGElement;\n\t\"font-face-format\"(...args: Array<any>): SVGElement;\n\tfont_face_format(...args: Array<any>): SVGElement;\n\t\"font-face-name\"(...args: Array<any>): SVGElement;\n\tfont_face_name(...args: Array<any>): SVGElement;\n\t\"font-face-src\"(...args: Array<any>): SVGElement;\n\tfont_face_src(...args: Array<any>): SVGElement;\n\t\"font-face-uri\"(...args: Array<any>): SVGElement;\n\tfont_face_uri(...args: Array<any>): SVGElement;\n\tforeignObject(...args: Array<any>): SVGForeignObjectElement;\n\tg(...args: Array<any>): SVGGElement;\n\tglyph(...args: Array<any>): SVGElement;\n\tglyphRef(...args: Array<any>): SVGElement;\n\thkern(...args: Array<any>): SVGElement;\n\timage(...args: Array<any>): SVGImageElement;\n\tline(...args: Array<any>): SVGLineElement;\n\tlinearGradient(...args: Array<any>): SVGLinearGradientElement;\n\tmarker(...args: Array<any>): SVGMarkerElement;\n\tmask(...args: Array<any>): SVGMaskElement;\n\tmetadata(...args: Array<any>): SVGMetadataElement;\n\t\"missing-glyph\"(...args: Array<any>): SVGElement;\n\tmissing_glyph(...args: Array<any>): SVGElement;\n\tmpath(...args: Array<any>): SVGElement;\n\tpath(...args: Array<any>): SVGPathElement;\n\tpattern(...args: Array<any>): SVGPatternElement;\n\tpolygon(...args: Array<any>): SVGPolygonElement;\n\tpolyline(...args: Array<any>): SVGPolylineElement;\n\tradialGradient(...args: Array<any>): SVGRadialGradientElement;\n\trect(...args: Array<any>): SVGRectElement;\n\tscript(...args: Array<any>): SVGScriptElement;\n\tset(...args: Array<any>): SVGElement;\n\tstop(...args: Array<any>): SVGStopElement;\n\tstyle(...args: Array<any>): SVGStyleElement;\n\tsvg(...args: Array<any>): SVGSVGElement;\n\tswitch(...args: Array<any>): SVGSwitchElement;\n\tsymbol(...args: Array<any>): SVGSymbolElement;\n\ttext(...args: Array<any>): SVGTextElement;\n\ttextPath(...args: Array<any>): SVGTextPathElement;\n\ttitle(...args: Array<any>): SVGTitleElement;\n\ttref(...args: Array<any>): SVGElement;\n\ttspan(...args: Array<any>): SVGTSpanElement;\n\tuse(...args: Array<any>): SVGUseElement;\n\tview(...args: Array<any>): SVGViewElement;\n\tvkern(...args: Array<any>): SVGElement;\n}\n\nexport const HTML: HTMLElementFactory = <HTMLElementFactory> <unknown> parseHTML;\nexport const SVG: SVGElementFactory = <SVGElementFactory> <unknown> parseSVG;\n\nfor (const name of \"a abbr address area article aside audio b base bdi bdo blockquote br button canvas caption cite code col colgroup datalist dd del details dfn dialog div dl dt em embed fieldset figcaption figure footer form h1 h2 h3 h4 h5 h6 header hr i iframe img input ins kbd label legend li link main map mark menu menuitem meta meter nav noscript object ol optgroup option output p param picture pre progress q rp rt ruby s samp script section select small source span strong style sub summary sup table tbody td template textarea tfoot th thead time title tr track u ul var video wbr\".split(\" \")) {\n\t(<any>HTML)[name] = (...args: Array<any>) => applyElementArgs(document.createElement(name), args);\n}\nfor (const name of \"a altGlyph altGlyphDef altGlyphItem animate animateMotion animateTransform circle clipPath color-profile cursor defs desc discard ellipse feBlend feColorMatrix feComponentTransfer feComposite feConvolveMatrix feDiffuseLighting feDisplacementMap feDistantLight feDropShadow feFlood feFuncA feFuncB feFuncG feFuncR feGaussianBlur feImage feMerge feMergeNode feMorphology feOffset fePointLight feSpecularLighting feSpotLight feTile feTurbulence filter font font-face font-face-format font-face-name font-face-src font-face-uri foreignObject g glyph glyphRef hkern image line linearGradient marker mask metadata missing-glyph mpath path pattern polygon polyline radialGradient rect script set stop style svg switch symbol text textPath title tref tspan use view vkern\".split(\" \")) {\n\t(<any>SVG)[name] = (...args: Array<any>) => applyElementArgs(<SVGElement> document.createElementNS(svgNS, name), args);\n\tif (/-/.test(name)) {\n\t\tconst snakeCaseName = name.replace(/-/g, \"_\");\n\t\t(<any>SVG)[snakeCaseName] = (...args: Array<any>) => applyElementArgs(<SVGElement> document.createElementNS(svgNS, name), args);\n\t}\n}\n","\texport function clamp(min: number, max: number, val: number): number {\r\n\t\tmax = max - 1;\r\n\t\tif (val <= max) {\r\n\t\t\tif (val >= min) return val;\r\n\t\t\telse return min;\r\n\t\t} else {\r\n\t\t\treturn max;\r\n\t\t}\r\n\t}","    import { SongTagCode, CharCode, } from \"./tagCodes\";\r\n    import { Config, Dictionary, InstrumentType } from \"./SynthConfig\";\r\n\timport { clamp } from \"./usefulFunctions\";\r\n    \r\n    export class BitFieldReader {\r\n        private _bits: number[] = [];\r\n        private _readIndex: number = 0;\r\n        \r\n        constructor(base64CharCodeToInt: ReadonlyArray<number>, source: string, startIndex: number, stopIndex: number) {\r\n            for (let i: number = startIndex; i < stopIndex; i++) {\r\n                const value: number = base64CharCodeToInt[source.charCodeAt(i)];\r\n                this._bits.push((value >> 5) & 0x1);\r\n                this._bits.push((value >> 4) & 0x1);\r\n                this._bits.push((value >> 3) & 0x1);\r\n                this._bits.push((value >> 2) & 0x1);\r\n                this._bits.push((value >> 1) & 0x1);\r\n                this._bits.push( value       & 0x1);\r\n            }\r\n        }\r\n        \r\n        public read(bitCount: number): number {\r\n            let result: number = 0;\r\n            while (bitCount > 0) {\r\n                result = result << 1;\r\n                result += this._bits[this._readIndex++];\r\n                bitCount--;\r\n            }\r\n            return result;\r\n        }\r\n        \r\n        public readLongTail(minValue: number, minBits: number): number {\r\n            let result: number = minValue;\r\n            let numBits: number = minBits;\r\n            while (this._bits[this._readIndex++]) {\r\n                result += 1 << numBits;\r\n                numBits++;\r\n            }\r\n            while (numBits > 0) {\r\n                numBits--;\r\n                if (this._bits[this._readIndex++]) {\r\n                    result += 1 << numBits;\r\n                }\r\n            }\r\n            return result;\r\n        }\r\n        \r\n        public readPartDuration(): number {\r\n            return this.readLongTail(1, 2);\r\n        }\r\n        \r\n        public readPinCount(): number {\r\n            return this.readLongTail(1, 0);\r\n        }\r\n        \r\n        public readPitchInterval(): number {\r\n            if (this.read(1)) {\r\n                return -this.readLongTail(1, 3);\r\n            } else {\r\n                return this.readLongTail(1, 3);\r\n            }\r\n        }\r\n    }\r\n    \r\n    export class BitFieldWriter {\r\n        private _bits: number[] = [];\r\n        \r\n        public write(bitCount: number, value: number): void {\r\n            bitCount--;\r\n            while (bitCount >= 0) {\r\n                this._bits.push((value >>> bitCount) & 1);\r\n                bitCount--;\r\n            }\r\n        }\r\n        \r\n        public writeLongTail(minValue: number, minBits: number, value: number): void {\r\n            if (value < minValue) throw new Error(\"value out of bounds\");\r\n            value -= minValue;\r\n            let numBits: number = minBits;\r\n            while (value >= (1 << numBits)) {\r\n                this._bits.push(1);\r\n                value -= 1 << numBits;\r\n                numBits++;\r\n            }\r\n            this._bits.push(0);\r\n            while (numBits > 0) {\r\n                numBits--;\r\n                this._bits.push((value >>> numBits) & 1);\r\n            }\r\n        }\r\n        \r\n        public writePartDuration(value: number): void {\r\n            this.writeLongTail(1, 2, value);\r\n        }\r\n        \r\n        public writePinCount(value: number): void {\r\n            this.writeLongTail(1, 0, value);\r\n        }\r\n        \r\n        public writePitchInterval(value: number): void {\r\n            if (value < 0) {\r\n                this.write(1, 1); // sign\r\n                this.writeLongTail(1, 3, -value);\r\n            } else {\r\n                this.write(1, 0); // sign\r\n                this.writeLongTail(1, 3, value);\r\n            }\r\n        }\r\n        \r\n        public concat(other: BitFieldWriter): void {\r\n            this._bits = this._bits.concat(other._bits);\r\n        }\r\n        \r\n        public encodeBase64(base64IntToCharCode: ReadonlyArray<number>, buffer: number[]): number[] {\r\n            for (let i: number = 0; i < this._bits.length; i += 6) {\r\n                const value: number = (this._bits[i] << 5) | (this._bits[i+1] << 4) | (this._bits[i+2] << 3) | (this._bits[i+3] << 2) | (this._bits[i+4] << 1) | this._bits[i+5];\r\n                buffer.push(base64IntToCharCode[value]);\r\n            }\r\n            return buffer;\r\n        }\r\n        \r\n        public lengthBase64(): number {\r\n            return Math.ceil(this._bits.length / 6);\r\n        }\r\n    }\r\n\r\n\texport class Operator {\r\n\t\tpublic frequency: number = 0;\r\n\t\tpublic amplitude: number = 0;\r\n\t\tpublic envelope: number = 0;\r\n\t\t\r\n\t\tconstructor(index: number) {\r\n\t\t\tthis.reset(index);\r\n\t\t}\r\n\t\t\r\n\t\tpublic reset(index: number): void {\r\n\t\t\tthis.frequency = 0;\r\n\t\t\tthis.amplitude = (index <= 1) ? Config.operatorAmplitudeMax : 0;\r\n\t\t\tthis.envelope = 1;\r\n\t\t}\r\n\t\t\r\n\t\tpublic copy(other: Operator): void {\r\n\t\t\tthis.frequency = other.frequency;\r\n\t\t\tthis.amplitude = other.amplitude;\r\n\t\t\tthis.envelope = other.envelope;\r\n\t\t}\r\n\t}   \r\n\r\n    export interface NotePin {\r\n\t\tinterval: number;\r\n\t\ttime: number;\r\n\t\tvolume: number;\r\n\t}\r\n\t\r\n\texport function makeNotePin(interval: number, time: number, volume: number): NotePin {\r\n\t\treturn {interval: interval, time: time, volume: volume};\r\n\t}\r\n\t\r\n\texport interface Note {\r\n\t\tpitches: number[];\r\n\t\tpins: NotePin[];\r\n\t\tstart: number;\r\n\t\tend: number;\r\n\t}\r\n\t\r\n\texport function makeNote(pitch: number, start: number, end: number, volume: number, fadeout: boolean = false) {\r\n\t\treturn {\r\n\t\t\tpitches: [pitch],\r\n\t\t\tpins: [makeNotePin(0, 0, volume), makeNotePin(0, end - start, fadeout ? 0 : volume)],\r\n\t\t\tstart: start,\r\n\t\t\tend: end,\r\n\t\t};\r\n\t}\r\n\r\nexport class Instrument {\r\n\t\tpublic type: InstrumentType = 0;\r\n\t\tpublic wave: number = 1;\r\n\t\tpublic filter: number = 1;\r\n\t\tpublic transition: number = 1;\r\n\t\tpublic effect: number = 0;\r\n\t\tpublic harm: number = 0;\r\n\t\tpublic fmChorus: number = 1;\r\n\t\tpublic imute: number = 0;\r\n\t\tpublic octoff: number = 0;\r\n\t\tpublic chorus: number = 0;\r\n\t\tpublic volume: number = 0;\r\n\t\tpublic ipan: number = 4;\r\n\t\tpublic algorithm: number = 0;\r\n\t\tpublic feedbackType: number = 0;\r\n\t\tpublic feedbackAmplitude: number = 0;\r\n\t\tpublic feedbackEnvelope: number = 1;\r\n\t\tpublic readonly operators: Operator[] = [];\r\n\t\t\r\n\t\tconstructor() {\r\n\t\t\tfor (let i = 0; i < Config.operatorCount; i++) {\r\n\t\t\t\tthis.operators.push(new Operator(i));\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tpublic reset(): void {\r\n\t\t\tthis.type = 0;\r\n\t\t\tthis.wave = 1;\r\n\t\t\tthis.filter = 1;\r\n\t\t\tthis.transition = 1;\r\n\t\t\tthis.effect = 0;\r\n\t\t\tthis.harm = 0;\r\n\t\t\tthis.fmChorus = 1;\r\n\t\t\tthis.imute = 0;\r\n\t\t\tthis.ipan = 4;\r\n\t\t\tthis.octoff = 0;\r\n\t\t\tthis.chorus = 0;\r\n\t\t\tthis.volume = 0;\r\n\t\t\tthis.algorithm = 0;\r\n\t\t\tthis.feedbackType = 0;\r\n\t\t\tthis.feedbackAmplitude = 0;\r\n\t\t\tthis.feedbackEnvelope = 1;\r\n\t\t\tfor (let i: number = 0; i < this.operators.length; i++) {\r\n\t\t\t\tthis.operators[i].reset(i);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tpublic setTypeAndReset(type: InstrumentType): void {\r\n\t\t\tthis.type = type;\r\n\t\t\tswitch (type) {\r\n\t\t\t\tcase InstrumentType.chip:\r\n\t\t\t\t\tthis.wave = 1;\r\n\t\t\t\t\tthis.filter = 1;\r\n\t\t\t\t\tthis.transition = 1;\r\n\t\t\t\t\tthis.effect = 0;\r\n\t\t\t\t\tthis.harm = 0;\r\n\t\t\t\t\tthis.imute = 0;\r\n\t\t\t\t\tthis.ipan = 4;\r\n\t\t\t\t\tthis.octoff = 0;\r\n\t\t\t\t\tthis.chorus = 0;\r\n\t\t\t\t\tthis.volume = 0;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t// @TODO: Investigate whether this being incorrect leads to\r\n\t\t\t\t// any observable issues.\r\n\t\t\t\tcase InstrumentType.fm:\r\n\t\t\t\t\tthis.wave = 1;\r\n\t\t\t\t\tthis.transition = 1;\r\n\t\t\t\t\tthis.volume = 0;\r\n\t\t\t\t\tthis.imute = 0;\r\n\t\t\t\t\tthis.ipan = 4;\r\n\t\t\t\t\tthis.harm = 0;\r\n\t\t\t\t\tthis.octoff = 0;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase InstrumentType.noise:\r\n\t\t\t\t\tthis.transition = 1;\r\n\t\t\t\t\tthis.octoff = 0;\r\n\t\t\t\t\tthis.fmChorus = 1;\r\n\t\t\t\t\tthis.ipan = 4;\r\n\t\t\t\t\tthis.effect = 0;\r\n\t\t\t\t\tthis.algorithm = 0;\r\n\t\t\t\t\tthis.feedbackType = 0;\r\n\t\t\t\t\tthis.feedbackAmplitude = 0;\r\n\t\t\t\t\tthis.feedbackEnvelope = 1;\r\n\t\t\t\t\tthis.volume = 0;\r\n\t\t\t\t\tfor (let i: number = 0; i < this.operators.length; i++) {\r\n\t\t\t\t\t\tthis.operators[i].reset(i);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase InstrumentType.pwm:\r\n\t\t\t\t\tthis.wave = 1;\r\n\t\t\t\t\tthis.filter = 1;\r\n\t\t\t\t\tthis.transition = 1;\r\n\t\t\t\t\tthis.effect = 0;\r\n\t\t\t\t\tthis.harm = 0;\r\n\t\t\t\t\tthis.imute = 0;\r\n\t\t\t\t\tthis.ipan = 4;\r\n\t\t\t\t\tthis.octoff = 0;\r\n\t\t\t\t\tthis.chorus = 0;\r\n\t\t\t\t\tthis.volume = 0;\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tpublic copy(other: Instrument): void {\r\n\t\t\tthis.type = other.type;\r\n\t\t\tthis.wave = other.wave;\r\n\t\t\tthis.filter = other.filter;\r\n\t\t\tthis.transition = other.transition;\r\n\t\t\tthis.effect = other.effect;\r\n\t\t\tthis.chorus = other.chorus;\r\n\t\t\tthis.volume = other.volume;\r\n\t\t\tthis.harm = other.harm;\r\n\t\t\tthis.fmChorus = other.fmChorus;\r\n\t\t\tthis.imute = other.imute;\r\n\t\t\tthis.ipan = other.ipan;\r\n\t\t\tthis.octoff = other.octoff;\r\n\t\t\tthis.algorithm = other.algorithm;\r\n\t\t\tthis.feedbackType = other.feedbackType;\r\n\t\t\tthis.feedbackAmplitude = other.feedbackAmplitude;\r\n\t\t\tthis.feedbackEnvelope = other.feedbackEnvelope;\r\n\t\t\tfor (let i: number = 0; i < this.operators.length; i++) {\r\n\t\t\t\tthis.operators[i].copy(other.operators[i]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/*public getChord(): Chord {\r\n\t\t\treturn this.type == InstrumentType.noise ? Config.harmDisplay[2] : Config.harmDisplay[this.harm];\r\n\t\t}*/\r\n\t}\r\n\r\n    export class Channel {\r\n\t\tpublic octave: number = 0;\r\n\t\tpublic readonly instruments: Instrument[] = [];\r\n\t\tpublic readonly patterns: Pattern[] = [];\r\n\t\tpublic readonly bars: number[] = [];\r\n\t}\r\n\t\r\n\texport class Pattern {\r\n\t\tpublic notes: Note[] = [];\r\n\t\tpublic instrument: number = 0;\r\n\t\t\r\n\t\tpublic cloneNotes(): Note[] {\r\n\t\t\tconst result: Note[] = [];\r\n\t\t\tfor (const oldNote of this.notes) {\r\n\t\t\t\tconst newNote: Note = makeNote(-1, oldNote.start, oldNote.end, 3);\r\n\t\t\t\tnewNote.pitches = oldNote.pitches.concat();\r\n\t\t\t\tnewNote.pins = [];\r\n\t\t\t\tfor (const oldPin of oldNote.pins) {\r\n\t\t\t\t\tnewNote.pins.push(makeNotePin(oldPin.interval, oldPin.time, oldPin.volume));\r\n\t\t\t\t}\r\n\t\t\t\tresult.push(newNote);\r\n\t\t\t}\r\n\t\t\treturn result;\r\n\t\t}\r\n\t\t\r\n\t\tpublic reset(): void {\r\n\t\t\tthis.notes.length = 0;\r\n\t\t\tthis.instrument = 0;\r\n\t\t}\r\n\t}\r\n\r\n    export class Song {\r\n\t\tprivate static readonly _format: string = \"NepBox\";\r\n\r\n\t\tprivate static readonly _oldestBeepboxVersion: number = 2;\r\n\t\tprivate static readonly _latestBeepboxVersion: number = 6;\r\n\t\tprivate static readonly _oldestNepBoxVersion: number = 1;\r\n\t\tprivate static readonly _latestNepBoxVersion: number = 1;\r\n\t\tprivate static readonly _variant = 0x6E; //\"N\" ~ nepbox\r\n\r\n\t\tprivate static readonly _base64CharCodeToInt: ReadonlyArray<number> = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,62,62,0,0,1,2,3,4,5,6,7,8,9,0,0,0,0,0,0,0,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,0,0,0,0,63,0,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,0,0,0,0,0]; // 62 could be represented by either \"-\" or \".\" for historical reasons. New songs should use \"-\".\r\n\t\tprivate static readonly _base64IntToCharCode: ReadonlyArray<number> = [48,49,50,51,52,53,54,55,56,57,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,45,95];\r\n\t\t\r\n\t\tpublic scale: number;\r\n\t\tpublic setSongTheme: string;\r\n\t\tpublic key: number;\r\n\t\tpublic mix: number;\r\n\t\tpublic sampleRate: number;\r\n\t\tpublic tempo: number;\r\n\t\tpublic reverb: number;\r\n\t\tpublic blend: number;\r\n\t\tpublic riff: number;\r\n\t\tpublic detune: number;\r\n\t\tpublic muff: number;\r\n\t\tpublic beatsPerBar: number;\r\n\t\tpublic barCount: number;\r\n\t\tpublic patternsPerChannel: number;\r\n\t\tpublic partsPerBeat: number;\r\n\t\tpublic instrumentsPerChannel: number;\r\n\t\tpublic loopStart: number;\r\n\t\tpublic loopLength: number;\r\n\t\tpublic pitchChannelCount: number;\r\n\t\tpublic drumChannelCount: number;\r\n\t\tpublic readonly channels: Channel[] = [];\r\n\t\t\r\n\t\tconstructor(string?: string) {\r\n\t\t\tif (string != undefined) {\r\n\t\t\t\tthis.fromBase64String(string);\r\n\t\t\t} else {\r\n\t\t\t\tthis.initToDefault(true);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tpublic getChannelCount(): number {\r\n\t\t\treturn this.pitchChannelCount + this.drumChannelCount;\r\n\t\t}\r\n\r\n\t\tpublic getChannelUnusedCount(): number {\r\n\t\t\treturn (Config.pitchChannelCountMax + Config.drumChannelCountMax) - (this.pitchChannelCount + this.drumChannelCount);\r\n\t\t}\r\n\r\n\t\tpublic getTimeSig(): string {\r\n\t\t\treturn this.beatsPerBar + \"/\" + this.partsPerBeat + \" with \" + this.barCount + \" bars.\";\r\n\t\t}\r\n\r\n\t\tpublic getScaleNKey(): string {\r\n\t\t\treturn ' \"' + Config.scales[this.scale].name + '\" and your key is ' + Config.keys[this.key].name;\r\n\t\t}\r\n\t\t\r\n\t\tpublic getChannelIsDrum(channel: number): boolean {\r\n\t\t\treturn (channel >= this.pitchChannelCount);\r\n\t\t}\r\n\t\t\r\n\t\tpublic getChannelColorDim(channel: number): string {\r\n\t\t\treturn channel < this.pitchChannelCount ? Config.pitchChannelColorsDim[channel] : Config.drumChannelColorsDim[channel - this.pitchChannelCount];\r\n\t\t}\r\n\t\tpublic getChannelColorBright(channel: number): string {\r\n\t\t\treturn channel < this.pitchChannelCount ? Config.pitchChannelColorsBright[channel] : Config.drumChannelColorsBright[channel - this.pitchChannelCount];\r\n\t\t}\r\n\t\tpublic getNoteColorDim(channel: number): string {\r\n\t\t\treturn channel < this.pitchChannelCount ? Config.pitchNoteColorsDim[channel] : Config.drumNoteColorsDim[channel - this.pitchChannelCount];\r\n\t\t}\r\n\t\tpublic getNoteColorBright(channel: number): string {\r\n\t\t\treturn channel < this.pitchChannelCount ? Config.pitchNoteColorsBright[channel] : Config.drumNoteColorsBright[channel - this.pitchChannelCount];\r\n\t\t}\r\n\t\t\r\n\t\tpublic initToDefault(andResetChannels: boolean = true): void {\r\n\t\t\tthis.scale = 0;\r\n\t\t\tthis.setSongTheme = \"none\";\r\n\t\t\tthis.key = Config.keys.map(key=>key.name).indexOf(\"C\");\r\n\t\t\tthis.mix = 1;\r\n\t\t\tthis.sampleRate = 2;\r\n\t\t\tthis.loopStart = 0;\r\n\t\t\tthis.loopLength = 4;\r\n\t\t\tthis.tempo = 151;\r\n\t\t\tthis.reverb = 0;\r\n\t\t\tthis.blend = 0;\r\n\t\t\tthis.riff = 0;\r\n\t\t\tthis.detune = 0;\r\n\t\t\tthis.muff = 0;\r\n\t\t\tthis.beatsPerBar = 8;\r\n\t\t\tthis.barCount = 16;\r\n\t\t\tthis.patternsPerChannel = 8;\r\n\t\t\tthis.partsPerBeat = 4;\r\n\t\t\tthis.instrumentsPerChannel = 1;\r\n\t\t\t\r\n\t\t\tif (andResetChannels) {\r\n\t\t\t\tthis.pitchChannelCount = 4;\r\n\t\t\t\tthis.drumChannelCount = 1;\r\n\t\t\t\tfor (let channelIndex = 0; channelIndex < this.getChannelCount(); channelIndex++) {\r\n\t\t\t\t\tif (this.channels.length <= channelIndex) {\r\n\t\t\t\t\t\tthis.channels[channelIndex] = new Channel();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconst channel: Channel = this.channels[channelIndex];\r\n\t\t\t\t\tchannel.octave = 4 - channelIndex; // [4, 3, 2, 1, 0]; Descending octaves with drums at zero in last channel.\r\n\t\t\t\t\r\n\t\t\t\t\tfor (let pattern = 0; pattern < this.patternsPerChannel; pattern++) {\r\n\t\t\t\t\t\tif (channel.patterns.length <= pattern) {\r\n\t\t\t\t\t\t\tchannel.patterns[pattern] = new Pattern();\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tchannel.patterns[pattern].reset();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tchannel.patterns.length = this.patternsPerChannel;\r\n\t\t\t\t\r\n\t\t\t\t\tfor (let instrument = 0; instrument < this.instrumentsPerChannel; instrument++) {\r\n\t\t\t\t\t\tif (channel.instruments.length <= instrument) {\r\n\t\t\t\t\t\t\tchannel.instruments[instrument] = new Instrument();\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tchannel.instruments[instrument].reset();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tchannel.instruments.length = this.instrumentsPerChannel;\r\n\t\t\t\t\r\n\t\t\t\t\tfor (let bar = 0; bar < this.barCount; bar++) {\r\n\t\t\t\t\t\tchannel.bars[bar] = bar < 4 ? 1 : 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tchannel.bars.length = this.barCount;\r\n\t\t\t\t}\r\n\t\t\t\tthis.channels.length = this.getChannelCount();\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tpublic toBase64String(): string {\r\n\t\t\tlet bits: BitFieldWriter;\r\n\t\t\tlet buffer: number[] = [];\r\n\t\t\t\r\n\t\t\tconst base64IntToCharCode: ReadonlyArray<number> = Song._base64IntToCharCode;\r\n\t\t\t\r\n\t\t\tbuffer.push(Song._variant);\r\n\t\t\tbuffer.push(base64IntToCharCode[Song._latestNepBoxVersion]);\r\n\r\n\r\n\r\n\t\t\tbuffer.push(SongTagCode.channelCount, base64IntToCharCode[this.pitchChannelCount], base64IntToCharCode[this.drumChannelCount]);\r\n\r\n\t\t\tbuffer.push(SongTagCode.setSongTheme);\r\n\t\t\tvar encodedSongTheme: string = encodeURIComponent(this.setSongTheme);\r\n        \tbuffer.push(base64IntToCharCode[encodedSongTheme.length >> 6], base64IntToCharCode[encodedSongTheme.length & 0x3f]);\r\n\t\t\t// Actual encoded string follows\r\n\t\t\tfor (let i: number = 0; i < encodedSongTheme.length; i++) {\r\n\t\t\t\tbuffer.push(encodedSongTheme.charCodeAt(i));\r\n\t\t\t}\r\n\r\n\t\t\tbuffer.push(SongTagCode.scale, base64IntToCharCode[this.scale]);\r\n\t\t\tbuffer.push(SongTagCode.mix, base64IntToCharCode[this.mix]);\r\n\t\t\tbuffer.push(SongTagCode.sampleRate, base64IntToCharCode[this.sampleRate]);\r\n\t\t\tbuffer.push(SongTagCode.key, base64IntToCharCode[this.key]);\r\n\t\t\tbuffer.push(SongTagCode.loopStart, base64IntToCharCode[this.loopStart >> 6], base64IntToCharCode[this.loopStart & 0x3f]);\r\n\t\t\tbuffer.push(SongTagCode.loopEnd, base64IntToCharCode[(this.loopLength - 1) >> 6], base64IntToCharCode[(this.loopLength - 1) & 0x3f]);\r\n\t\t\tbuffer.push(SongTagCode.tempo, base64IntToCharCode[this.tempo >> 6], base64IntToCharCode[this.tempo & 63]);\r\n\t\t\tbuffer.push(SongTagCode.reverb, base64IntToCharCode[this.reverb]);\r\n\t\t\tbuffer.push(SongTagCode.blend, base64IntToCharCode[this.blend]);\r\n\t\t\tbuffer.push(SongTagCode.riff, base64IntToCharCode[this.riff]);\r\n\t\t\tbuffer.push(SongTagCode.detune, base64IntToCharCode[this.detune]);\r\n\t\t\tbuffer.push(SongTagCode.muff, base64IntToCharCode[this.muff]);\r\n\t\t\tbuffer.push(SongTagCode.beatCount, base64IntToCharCode[this.beatsPerBar - 1]);\r\n\t\t\tbuffer.push(SongTagCode.barCount, base64IntToCharCode[(this.barCount - 1) >> 6], base64IntToCharCode[(this.barCount - 1) & 0x3f]);\r\n\t\t\tbuffer.push(SongTagCode.patternCount, base64IntToCharCode[this.patternsPerChannel - 1]);\r\n\t\t\tbuffer.push(SongTagCode.instrumentCount, base64IntToCharCode[this.instrumentsPerChannel - 1]);\r\n\t\t\tbuffer.push(SongTagCode.rhythm, base64IntToCharCode[Config.partCounts.indexOf(this.partsPerBeat)]);\r\n\t\t\t\r\n\t\t\tbuffer.push(SongTagCode.channelOctave);\r\n\t\t\tfor (let channel: number = 0; channel < this.getChannelCount(); channel++) {\r\n\t\t\t\tbuffer.push(base64IntToCharCode[this.channels[channel].octave]);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tfor (let channel: number = 0; channel < this.getChannelCount(); channel++) {\r\n\t\t\t\tfor (let i: number = 0; i < this.instrumentsPerChannel; i++) {\r\n\t\t\t\t\tconst instrument: Instrument = this.channels[channel].instruments[i];\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (channel < this.pitchChannelCount) {\r\n\t\t\t\t\t\tbuffer.push(SongTagCode.startInstrument, base64IntToCharCode[instrument.type]);\r\n\t\t\t\t\t\tif (instrument.type == InstrumentType.chip) {\r\n\t\t\t\t\t\t\t// chip\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.wave, base64IntToCharCode[instrument.wave]);\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.filter, base64IntToCharCode[instrument.filter]);\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.transition, base64IntToCharCode[instrument.transition]);\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.effect, base64IntToCharCode[instrument.effect]);\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.harm, base64IntToCharCode[instrument.harm]);\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.imute, base64IntToCharCode[instrument.imute]);\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.ipan, base64IntToCharCode[instrument.ipan]);\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.octoff, base64IntToCharCode[instrument.octoff]);\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.chorus,base64IntToCharCode[instrument.chorus]);\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.volume, base64IntToCharCode[instrument.volume]);\r\n\t\t\t\t\t\t} else if (instrument.type == InstrumentType.fm) {\r\n\t\t\t\t\t\t\t// FM\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.transition, base64IntToCharCode[instrument.transition]);\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.effect, base64IntToCharCode[instrument.effect]);\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.octoff, base64IntToCharCode[instrument.octoff]);\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.fmChorus, base64IntToCharCode[instrument.fmChorus]);\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.imute, base64IntToCharCode[instrument.imute]);\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.ipan, base64IntToCharCode[instrument.ipan]);\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.algorithm, base64IntToCharCode[instrument.algorithm]);\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.feedbackType, base64IntToCharCode[instrument.feedbackType]);\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.feedbackAmplitude, base64IntToCharCode[instrument.feedbackAmplitude]);\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.feedbackEnvelope, base64IntToCharCode[instrument.feedbackEnvelope]);\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.volume, base64IntToCharCode[instrument.volume]);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.operatorFrequencies);\r\n\t\t\t\t\t\t\tfor (let o: number = 0; o < Config.operatorCount; o++) {\r\n\t\t\t\t\t\t\t\tbuffer.push(base64IntToCharCode[instrument.operators[o].frequency]);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.operatorAmplitudes);\r\n\t\t\t\t\t\t\tfor (let o: number = 0; o < Config.operatorCount; o++) {\r\n\t\t\t\t\t\t\t\tbuffer.push(base64IntToCharCode[instrument.operators[o].amplitude]);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.operatorEnvelopes);\r\n\t\t\t\t\t\t\tfor (let o: number = 0; o < Config.operatorCount; o++) {\r\n\t\t\t\t\t\t\t\tbuffer.push(base64IntToCharCode[instrument.operators[o].envelope]);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else if (instrument.type == InstrumentType.pwm) {\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.wave, base64IntToCharCode[instrument.wave]);\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.filter, base64IntToCharCode[instrument.filter]);\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.transition, base64IntToCharCode[instrument.transition]);\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.effect, base64IntToCharCode[instrument.effect]);\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.harm, base64IntToCharCode[instrument.harm]);\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.imute, base64IntToCharCode[instrument.imute]);\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.ipan, base64IntToCharCode[instrument.ipan]);\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.octoff, base64IntToCharCode[instrument.octoff]);\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.chorus, base64IntToCharCode[instrument.chorus]);\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.volume, base64IntToCharCode[instrument.volume]);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthrow new Error(\"Unknown instrument type.\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// NOISE\r\n\t\t\t\t\t\tbuffer.push(SongTagCode.startInstrument, base64IntToCharCode[InstrumentType.noise]);\r\n\t\t\t\t\t\tbuffer.push(SongTagCode.wave, base64IntToCharCode[instrument.wave]);\r\n\t\t\t\t\t\tbuffer.push(SongTagCode.transition, base64IntToCharCode[instrument.transition]);\r\n\t\t\t\t\t\tbuffer.push(SongTagCode.volume, base64IntToCharCode[instrument.volume]);\r\n\t\t\t\t\t\tbuffer.push(SongTagCode.imute, base64IntToCharCode[instrument.imute]);\r\n\t\t\t\t\t\tbuffer.push(SongTagCode.harm, base64IntToCharCode[instrument.harm]);\r\n\t\t\t\t\t\tbuffer.push(SongTagCode.octoff, base64IntToCharCode[instrument.octoff]);\r\n\t\t\t\t\t\tbuffer.push(SongTagCode.ipan, base64IntToCharCode[instrument.ipan]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tbuffer.push(SongTagCode.bars);\r\n\t\t\tbits = new BitFieldWriter();\r\n\t\t\tlet neededBits: number = 0;\r\n\t\t\twhile ((1 << neededBits) < this.patternsPerChannel + 1) neededBits++;\r\n\t\t\tfor (let channel: number = 0; channel < this.getChannelCount(); channel++) for (let i: number = 0; i < this.barCount; i++) {\r\n\t\t\t\tbits.write(neededBits, this.channels[channel].bars[i]);\r\n\t\t\t}\r\n\t\t\tbits.encodeBase64(base64IntToCharCode, buffer);\r\n\t\t\t\r\n\t\t\tbuffer.push(SongTagCode.patterns);\r\n\t\t\tbits = new BitFieldWriter();\r\n\t\t\tlet neededInstrumentBits: number = 0;\r\n\t\t\twhile ((1 << neededInstrumentBits) < this.instrumentsPerChannel) neededInstrumentBits++;\r\n\t\t\tfor (let channel: number = 0; channel < this.getChannelCount(); channel++) {\r\n\t\t\t\tconst isDrum: boolean = this.getChannelIsDrum(channel);\r\n\t\t\t\tconst octaveOffset: number = isDrum ? 0 : this.channels[channel].octave * 12;\r\n\t\t\t\tlet lastPitch: number = (isDrum ? 4 : 12) + octaveOffset;\r\n\t\t\t\tconst recentPitches: number[] = isDrum ? [4,6,7,2,3,8,0,10] : [12, 19, 24, 31, 36, 7, 0];\r\n\t\t\t\tconst recentShapes: string[] = [];\r\n\t\t\t\tfor (let i: number = 0; i < recentPitches.length; i++) {\r\n\t\t\t\t\trecentPitches[i] += octaveOffset;\r\n\t\t\t\t}\r\n\t\t\t\tfor (const p of this.channels[channel].patterns) {\r\n\t\t\t\t\tbits.write(neededInstrumentBits, p.instrument);\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (p.notes.length > 0) {\r\n\t\t\t\t\t\tbits.write(1, 1);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tlet curPart: number = 0;\r\n\t\t\t\t\t\tfor (const t of p.notes) {\r\n\t\t\t\t\t\t\tif (t.start > curPart) {\r\n\t\t\t\t\t\t\t\tbits.write(2, 0); // rest\r\n\t\t\t\t\t\t\t\tbits.writePartDuration(t.start - curPart);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tconst shapeBits: BitFieldWriter = new BitFieldWriter();\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t// 0: 1 pitch, 10: 2 pitches, 110: 3 pitches, 111: 4 pitches\r\n\t\t\t\t\t\t\tfor (let i: number = 1; i < t.pitches.length; i++) shapeBits.write(1,1);\r\n\t\t\t\t\t\t\tif (t.pitches.length < 4) shapeBits.write(1,0);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tshapeBits.writePinCount(t.pins.length - 1);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tshapeBits.write(2, t.pins[0].volume); // volume\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tlet shapePart: number = 0;\r\n\t\t\t\t\t\t\tlet startPitch: number = t.pitches[0];\r\n\t\t\t\t\t\t\tlet currentPitch: number = startPitch;\r\n\t\t\t\t\t\t\tconst pitchBends: number[] = [];\r\n\t\t\t\t\t\t\tfor (let i: number = 1; i < t.pins.length; i++) {\r\n\t\t\t\t\t\t\t\tconst pin: NotePin = t.pins[i];\r\n\t\t\t\t\t\t\t\tconst nextPitch: number = startPitch + pin.interval;\r\n\t\t\t\t\t\t\t\tif (currentPitch != nextPitch) {\r\n\t\t\t\t\t\t\t\t\tshapeBits.write(1, 1);\r\n\t\t\t\t\t\t\t\t\tpitchBends.push(nextPitch);\r\n\t\t\t\t\t\t\t\t\tcurrentPitch = nextPitch;\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tshapeBits.write(1, 0);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tshapeBits.writePartDuration(pin.time - shapePart);\r\n\t\t\t\t\t\t\t\tshapePart = pin.time;\r\n\t\t\t\t\t\t\t\tshapeBits.write(2, pin.volume);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tconst shapeString: string = String.fromCharCode.apply(null, shapeBits.encodeBase64(base64IntToCharCode, []));\r\n\t\t\t\t\t\t\tconst shapeIndex: number = recentShapes.indexOf(shapeString);\r\n\t\t\t\t\t\t\tif (shapeIndex == -1) {\r\n\t\t\t\t\t\t\t\tbits.write(2, 1); // new shape\r\n\t\t\t\t\t\t\t\tbits.concat(shapeBits);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tbits.write(1, 1); // old shape\r\n\t\t\t\t\t\t\t\tbits.writeLongTail(0, 0, shapeIndex);\r\n\t\t\t\t\t\t\t\trecentShapes.splice(shapeIndex, 1);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\trecentShapes.unshift(shapeString);\r\n\t\t\t\t\t\t\tif (recentShapes.length > 10) recentShapes.pop();\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tconst allPitches: number[] = t.pitches.concat(pitchBends);\r\n\t\t\t\t\t\t\tfor (let i: number = 0; i < allPitches.length; i++) {\r\n\t\t\t\t\t\t\t\tconst pitch: number = allPitches[i];\r\n\t\t\t\t\t\t\t\tconst pitchIndex: number = recentPitches.indexOf(pitch);\r\n\t\t\t\t\t\t\t\tif (pitchIndex == -1) {\r\n\t\t\t\t\t\t\t\t\tlet interval: number = 0;\r\n\t\t\t\t\t\t\t\t\tlet pitchIter: number = lastPitch;\r\n\t\t\t\t\t\t\t\t\tif (pitchIter < pitch) {\r\n\t\t\t\t\t\t\t\t\t\twhile (pitchIter != pitch) {\r\n\t\t\t\t\t\t\t\t\t\t\tpitchIter++;\r\n\t\t\t\t\t\t\t\t\t\t\tif (recentPitches.indexOf(pitchIter) == -1) interval++;\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\twhile (pitchIter != pitch) {\r\n\t\t\t\t\t\t\t\t\t\t\tpitchIter--;\r\n\t\t\t\t\t\t\t\t\t\t\tif (recentPitches.indexOf(pitchIter) == -1) interval--;\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tbits.write(1, 0);\r\n\t\t\t\t\t\t\t\t\tbits.writePitchInterval(interval);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tbits.write(1, 1);\r\n\t\t\t\t\t\t\t\t\tbits.write(3, pitchIndex);\r\n\t\t\t\t\t\t\t\t\trecentPitches.splice(pitchIndex, 1);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\trecentPitches.unshift(pitch);\r\n\t\t\t\t\t\t\t\tif (recentPitches.length > 8) recentPitches.pop();\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (i == t.pitches.length - 1) {\r\n\t\t\t\t\t\t\t\t\tlastPitch = t.pitches[0];\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tlastPitch = pitch;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tcurPart = t.end;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif (curPart < this.beatsPerBar * this.partsPerBeat) {\r\n\t\t\t\t\t\t\tbits.write(2, 0); // rest\r\n\t\t\t\t\t\t\tbits.writePartDuration(this.beatsPerBar * this.partsPerBeat - curPart);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tbits.write(1, 0);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tlet stringLength: number = bits.lengthBase64();\r\n\t\t\tlet digits: number[] = [];\r\n\t\t\twhile (stringLength > 0) {\r\n\t\t\t\tdigits.unshift(base64IntToCharCode[stringLength & 0x3f]);\r\n\t\t\t\tstringLength = stringLength >> 6;\r\n\t\t\t}\r\n\t\t\tbuffer.push(base64IntToCharCode[digits.length]);\r\n\t\t\tArray.prototype.push.apply(buffer, digits); // append digits to buffer.\r\n\t\t\tbits.encodeBase64(base64IntToCharCode, buffer);\r\n\t\t\t\r\n\t\t\t// HACK: This breaks for strings longer than 65535. \r\n\t\t\tif (buffer.length >= 65535) throw new Error(\"Song hash code too long.\");\r\n\t\t\treturn String.fromCharCode.apply(null, buffer);\r\n\t\t}\r\n\t\t\r\n\t\tpublic fromBase64String(compressed: string): void {\r\n\t\t\tif (compressed == null || compressed == \"\") {\r\n\t\t\t\tthis.initToDefault(true);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tlet charIndex: number = 0;\r\n\t\t\t// skip whitespace.\r\n\t\t\twhile (compressed.charCodeAt(charIndex) <= CharCode.SPACE) charIndex++;\r\n\t\t\t// skip hash mark.\r\n\t\t\tif (compressed.charCodeAt(charIndex) == CharCode.HASH) charIndex++;\r\n\t\t\t// if it starts with curly brace, treat it as JSON.\r\n\t\t\tif (compressed.charCodeAt(charIndex) == CharCode.LEFT_CURLY_BRACE) {\r\n\t\t\t\tthis.fromJsonObject(JSON.parse(charIndex == 0 ? compressed : compressed.substring(charIndex)));\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst variantTest: number = compressed.charCodeAt(charIndex);\r\n        \tlet fromOld: boolean;\r\n        \tlet fromNepBox: boolean;\r\n\r\n\t\t\t// Detect variant here. If version doesn't match known variant, assume it is a vanilla string which does not report variant.\r\n\t\t\tif (variantTest == 0x6E) { //\"n\"\r\n\t\t\t\tfromOld = false;\r\n\t\t\t\tfromNepBox = true;\r\n\t\t\t\tcharIndex++;\r\n\t\t\t} else {\r\n\t\t\t\tfromOld = true;\r\n\t\t\t\tfromNepBox = false;\r\n\t\t\t}\r\n\r\n\t\t\tconst version: number = Song._base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\r\n\t\t\tif (fromOld && (version == -1 || version > Song._latestBeepboxVersion || version < Song._oldestBeepboxVersion)) return;\r\n\t\t\tif (fromNepBox && (version == -1 || version > Song._latestNepBoxVersion || version < Song._oldestNepBoxVersion)) return;\r\n\t\t\t//const beforeTwo:   boolean = version < 2;\r\n\t\t\tconst beforeThree: boolean = version < 3;\r\n\t\t\tconst beforeFour:  boolean = version < 4;\r\n\t\t\tconst beforeFive:  boolean = version < 5;\r\n\t\t\tconst beforeSix:   boolean = version < 6;\r\n\t\t\tconst base64CharCodeToInt: ReadonlyArray<number> = Song._base64CharCodeToInt;\r\n\t\t\tthis.initToDefault((fromOld && beforeSix) || (fromNepBox));\r\n\t\t\t\r\n\t\t\tif (fromOld && beforeThree) {\r\n\t\t\t\t// Originally, the only instrument transition was \"seamless\" and the only drum wave was \"retro\".\r\n\t\t\t\tfor (const channel of this.channels) channel.instruments[0].transition = 0;\r\n\t\t\t\tthis.channels[3].instruments[0].wave = 0;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tlet instrumentChannelIterator: number = 0;\r\n\t\t\tlet instrumentIndexIterator: number = -1;\r\n\t\t\t\r\n\t\t\twhile (charIndex < compressed.length) {\r\n\t\t\t\tconst command: number = compressed.charCodeAt(charIndex++);\r\n\t\t\t\tlet channel: number;\r\n\t\t\t\tif (command == SongTagCode.channelCount) {\r\n\t\t\t\t\tthis.pitchChannelCount = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\r\n\t\t\t\t\tthis.drumChannelCount  = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\r\n\t\t\t\t\tthis.pitchChannelCount = clamp(Config.pitchChannelCountMin, Config.pitchChannelCountMax + 1, this.pitchChannelCount);\r\n\t\t\t\t\tthis.drumChannelCount = clamp(Config.drumChannelCountMin, Config.drumChannelCountMax + 1, this.drumChannelCount);\r\n\t\t\t\t\tfor (let channelIndex = this.channels.length; channelIndex < this.getChannelCount(); channelIndex++) {\r\n\t\t\t\t\t\tthis.channels[channelIndex] = new Channel();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.channels.length = this.getChannelCount();\r\n\t\t\t\t} else if (command == SongTagCode.scale) {\r\n\t\t\t\t\tthis.scale = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\r\n\t\t\t\t\tif ((fromOld && beforeThree) && this.scale == 10) this.scale = 11;\r\n\t\t\t\t} else if (command == SongTagCode.mix) {\r\n\t\t\t\t\tthis.mix = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\r\n\t\t\t\t} else if (command == SongTagCode.key) {\r\n\t\t\t\t\t\tthis.key = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\r\n\t\t\t\t} else if (command == SongTagCode.setSongTheme) {\r\n\t\t\t\t\tif (fromOld) {\r\n\t\t\t\t\t\tvar themeIndex = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\r\n\t\t\t\t\t\tvar themes = [\"none\", \"modbox2\", \"artic\", \"Cinnamon Roll\", \"Ocean\", \"rainbow\", \"float\", \"windows\", \"grassland\", \"dessert\", \"kahootiest\", \"beambit\", \"egg\", \"Poniryoshka\", \"gameboy\", \"woodkid\", \"midnight\", \"snedbox\", \"unnamed\", \"piano\", \"halloween\", \"frozen\"];\r\n\t\t\t\t\t\tthis.setSongTheme = themes[themeIndex];\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tvar songThemeLength = (base64CharCodeToInt[compressed.charCodeAt(charIndex++)] << 6) + base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\r\n\t\t\t\t\t\tthis.setSongTheme = decodeURIComponent(compressed.substring(charIndex, charIndex + songThemeLength));\r\n\t\t\t\t\t\tcharIndex += songThemeLength;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (command == SongTagCode.loopStart) {\r\n\t\t\t\t\tif (fromOld && beforeFive) {\r\n\t\t\t\t\t\tthis.loopStart = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.loopStart = (base64CharCodeToInt[compressed.charCodeAt(charIndex++)] << 6) + base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (command == SongTagCode.loopEnd) {\r\n\t\t\t\t\tif (fromOld && beforeFive) {\r\n\t\t\t\t\t\tthis.loopLength = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.loopLength = (base64CharCodeToInt[compressed.charCodeAt(charIndex++)] << 6) + base64CharCodeToInt[compressed.charCodeAt(charIndex++)] + 1;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (command == SongTagCode.tempo) {\r\n\t\t\t\t\tif (fromOld) {\r\n\t\t\t\t\t\tif (beforeFour) {\r\n\t\t\t\t\t\t\tthis.tempo = [1, 4, 7, 10][base64CharCodeToInt[compressed.charCodeAt(charIndex++)]];\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.tempo = [88, 95, 103, 111, 120, 130, 140, 151, 163, 176, 190, 206, 222, 240, 259][base64CharCodeToInt[compressed.charCodeAt(charIndex++)]];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.tempo = (base64CharCodeToInt[compressed.charCodeAt(charIndex++)] << 6) + base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.tempo = clamp(Config.tempoMin, Config.tempoMax, this.tempo);\r\n\t\t\t\t} else if (command == SongTagCode.reverb) {\r\n\t\t\t\t\tthis.reverb = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\r\n\t\t\t\t\tthis.reverb = clamp(0, Config.reverbRange, this.reverb);\r\n\t\t\t\t} else if (command == SongTagCode.blend) {\r\n\t\t\t\t\tthis.blend = clamp(0, Config.blendRange, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t} else if (command == SongTagCode.riff) {\r\n\t\t\t\t\tthis.riff = clamp(0, Config.riffRange, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t} else if (command == SongTagCode.sampleRate) {\r\n\t\t\t\t\tthis.sampleRate = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\r\n\t\t\t\t} else if (command == SongTagCode.detune) {\r\n\t\t\t\t\tthis.detune = clamp(0, Config.detuneRange, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t} else if (command == SongTagCode.muff) {\r\n\t\t\t\t\tthis.muff = clamp(0, Config.muffRange, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t} else if (command == SongTagCode.beatCount) {\r\n\t\t\t\t\tif (fromOld && beforeThree) {\r\n\t\t\t\t\t\tthis.beatsPerBar = [6, 7, 8, 9, 10][base64CharCodeToInt[compressed.charCodeAt(charIndex++)]];\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.beatsPerBar = base64CharCodeToInt[compressed.charCodeAt(charIndex++)] + 1;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.beatsPerBar = Math.max(Config.beatsPerBarMin, Math.min(Config.beatsPerBarMax, this.beatsPerBar));\r\n\t\t\t\t} else if (command == SongTagCode.barCount) {\r\n\t\t\t\t\tthis.barCount = (base64CharCodeToInt[compressed.charCodeAt(charIndex++)] << 6) + base64CharCodeToInt[compressed.charCodeAt(charIndex++)] + 1;\r\n\t\t\t\t\tthis.barCount = Math.max(Config.barCountMin, Math.min(Config.barCountMax, this.barCount));\r\n\t\t\t\t\tfor (let channel = 0; channel < this.getChannelCount(); channel++) {\r\n\t\t\t\t\t\tfor (let bar = this.channels[channel].bars.length; bar < this.barCount; bar++) {\r\n\t\t\t\t\t\t\tthis.channels[channel].bars[bar] = 1;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.channels[channel].bars.length = this.barCount;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (command == SongTagCode.patternCount) {\r\n\t\t\t\t\tthis.patternsPerChannel = base64CharCodeToInt[compressed.charCodeAt(charIndex++)] + 1;\r\n\t\t\t\t\tthis.patternsPerChannel = Math.max(1, Math.min(Config.barCountMax, this.patternsPerChannel));\r\n\t\t\t\t\tfor (let channel = 0; channel < this.getChannelCount(); channel++) {\r\n\t\t\t\t\t\tfor (let pattern = this.channels[channel].patterns.length; pattern < this.patternsPerChannel; pattern++) {\r\n\t\t\t\t\t\t\tthis.channels[channel].patterns[pattern] = new Pattern();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.channels[channel].patterns.length = this.patternsPerChannel;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (command == SongTagCode.instrumentCount) {\r\n\t\t\t\t\tthis.instrumentsPerChannel = base64CharCodeToInt[compressed.charCodeAt(charIndex++)] + 1;\r\n\t\t\t\t\tthis.instrumentsPerChannel = Math.max(Config.instrumentsPerChannelMin, Math.min(Config.instrumentsPerChannelMax, this.instrumentsPerChannel));\r\n\t\t\t\t\tfor (let channel = 0; channel < this.getChannelCount(); channel++) {\r\n\t\t\t\t\t\tfor (let instrument = this.channels[channel].instruments.length; instrument < this.instrumentsPerChannel; instrument++) {\r\n\t\t\t\t\t\t\tthis.channels[channel].instruments[instrument] = new Instrument();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.channels[channel].instruments.length = this.instrumentsPerChannel;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (command == SongTagCode.rhythm) {\r\n\t\t\t\t\tthis.partsPerBeat = Config.partCounts[base64CharCodeToInt[compressed.charCodeAt(charIndex++)]];\r\n\t\t\t\t} else if (command == SongTagCode.channelOctave) {\r\n\t\t\t\t\tif (fromOld && beforeThree) {\r\n\t\t\t\t\t\tchannel = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\r\n\t\t\t\t\t\tthis.channels[channel].octave = clamp(0, 5, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tfor (channel = 0; channel < this.getChannelCount(); channel++) {\r\n\t\t\t\t\t\t\tthis.channels[channel].octave = clamp(0, 5, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (command == SongTagCode.startInstrument) {\r\n\t\t\t\t\tinstrumentIndexIterator++;\r\n\t\t\t\t\tif (instrumentIndexIterator >= this.instrumentsPerChannel) {\r\n\t\t\t\t\t\tinstrumentChannelIterator++;\r\n\t\t\t\t\t\tinstrumentIndexIterator = 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconst isPitchChannel: boolean = instrumentChannelIterator < this.pitchChannelCount;\r\n\t\t\t\t\tconst instrument: Instrument = this.channels[instrumentChannelIterator].instruments[instrumentIndexIterator];\r\n\t\t\t\t\tconst rawInstrumentType: number = clamp(0, 4, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t\tlet instrumentType: number = rawInstrumentType;\r\n\t\t\t\t\tif (instrumentType == InstrumentType.noise && isPitchChannel) {\r\n\t\t\t\t\t\tinstrumentType = InstrumentType.pwm;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tinstrument.setTypeAndReset(instrumentType);\r\n\t\t\t\t} else if (command == SongTagCode.wave) {\r\n\t\t\t\t\tif (fromOld && beforeThree) {\r\n\t\t\t\t\t\tchannel = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\r\n\t\t\t\t\t\tthis.channels[channel].instruments[0].wave = clamp(0, Config.waveNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t\t} else if (fromOld && beforeSix) {\r\n\t\t\t\t\t\tfor (channel = 0; channel < this.getChannelCount(); channel++) {\r\n\t\t\t\t\t\t\tconst isDrums = (channel >= this.pitchChannelCount);\r\n\t\t\t\t\t\t\tfor (let i: number = 0; i < this.instrumentsPerChannel; i++) {\r\n\t\t\t\t\t\t\t\tthis.channels[channel].instruments[i].wave = clamp(0, isDrums ? Config.drumNames.length : Config.waveNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconst isDrums = (instrumentChannelIterator >= this.pitchChannelCount);\r\n\t\t\t\t\t\tthis.channels[instrumentChannelIterator].instruments[instrumentIndexIterator].wave = clamp(0, isDrums ? Config.drumNames.length : Config.waveNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (command == SongTagCode.filter) {\r\n\t\t\t\t\tif (fromOld && beforeThree) {\r\n\t\t\t\t\t\tchannel = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\r\n\t\t\t\t\t\tthis.channels[channel].instruments[0].filter = [1, 3, 4, 5][clamp(0, Config.filterNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)])];\r\n\t\t\t\t\t} else if (fromOld && beforeSix) {\r\n\t\t\t\t\t\tfor (channel = 0; channel < this.getChannelCount(); channel++) {\r\n\t\t\t\t\t\t\tfor (let i: number = 0; i < this.instrumentsPerChannel; i++) {\r\n\t\t\t\t\t\t\t\tthis.channels[channel].instruments[i].filter = clamp(0, Config.filterNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)] + 1);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.channels[instrumentChannelIterator].instruments[instrumentIndexIterator].filter = clamp(0, Config.filterNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (command == SongTagCode.transition) {\r\n\t\t\t\t\tif (fromOld && beforeThree) {\r\n\t\t\t\t\t\tchannel = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\r\n\t\t\t\t\t\tthis.channels[channel].instruments[0].transition = clamp(0, Config.transitionNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t\t} else if (fromOld && beforeSix) {\r\n\t\t\t\t\t\tfor (channel = 0; channel < this.getChannelCount(); channel++) {\r\n\t\t\t\t\t\t\tfor (let i: number = 0; i < this.instrumentsPerChannel; i++) {\r\n\t\t\t\t\t\t\t\tthis.channels[channel].instruments[i].transition = clamp(0, Config.transitionNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.channels[instrumentChannelIterator].instruments[instrumentIndexIterator].transition = clamp(0, Config.transitionNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (command == SongTagCode.effect) {\r\n\t\t\t\t\tif (fromOld && beforeThree) {\r\n\t\t\t\t\t\tchannel = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\r\n\t\t\t\t\t\tlet effect: number = clamp(0, Config.effectNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t\t\tif (effect == 1) effect = 3;\r\n\t\t\t\t\t\telse if (effect == 3) effect = 5;\r\n\t\t\t\t\t\tthis.channels[channel].instruments[0].effect = effect;\r\n\t\t\t\t\t} else if (fromOld && beforeSix) {\r\n\t\t\t\t\t\tfor (channel = 0; channel < this.getChannelCount(); channel++) {\r\n\t\t\t\t\t\t\tfor (let i: number = 0; i < this.instrumentsPerChannel; i++) {\r\n\t\t\t\t\t\t\t\tthis.channels[channel].instruments[i].effect = clamp(0, Config.effectNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.channels[instrumentChannelIterator].instruments[instrumentIndexIterator].effect = clamp(0, Config.effectNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (command == SongTagCode.chorus) {\r\n\t\t\t\t\tif (fromOld && beforeThree) {\r\n\t\t\t\t\t\tchannel = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\r\n\t\t\t\t\t\tthis.channels[channel].instruments[0].chorus = clamp(0, Config.chorusNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t\t} else if (fromOld && beforeSix) {\r\n\t\t\t\t\t\tfor (channel = 0; channel < this.getChannelCount(); channel++) {\r\n\t\t\t\t\t\t\tfor (let i: number = 0; i < this.instrumentsPerChannel; i++) {\r\n\t\t\t\t\t\t\t\tthis.channels[channel].instruments[i].chorus = clamp(0, Config.chorusNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.channels[instrumentChannelIterator].instruments[instrumentIndexIterator].chorus = clamp(0, Config.chorusNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (command == SongTagCode.harm) {\r\n\t\t\t\t\t// Harmony was added in this commit: https://github.com/ModdedBeepbox/modded-beepbox-2.3/commit/cd1cc3d1891eda506e77e7619822ec2a48f375f2\r\n\t\t\t\t\t// _latestVersion was 5 in that commit, so the beforeThree\r\n\t\t\t\t\t// if in the reading code shouldn't ever run. Thus, it has\r\n\t\t\t\t\t// been omitted here.\r\n\t\t\t\t\tif (fromOld && beforeSix) {\r\n\t\t\t\t\t\tfor (channel = 0; channel < this.getChannelCount(); channel++) {\r\n\t\t\t\t\t\t\tfor (let i: number = 0; i < this.instrumentsPerChannel; i++) {\r\n\t\t\t\t\t\t\t\tthis.channels[channel].instruments[i].harm = clamp(0, Config.harmNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.channels[instrumentChannelIterator].instruments[instrumentIndexIterator].harm = clamp(0, Config.harmNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (command == SongTagCode.fmChorus) {\r\n\t\t\t\t\t// FM chorus was added in this commit: https://github.com/ModdedBeepbox/beta/commit/5c47acd9e5892709596d81df987a496f468b7115\r\n\t\t\t\t\t// Smaller diff: https://github.com/ModdedBeepbox/beta/compare/5427a7c491aae9fef15576bbc33a0d43ca18f758..5c47acd9e5892709596d81df987a496f468b7115\r\n\t\t\t\t\t// _latestVersion remained 6 before and after this, and the\r\n\t\t\t\t\t// tag code was never used for anything else previously, so\r\n\t\t\t\t\t// no backwards compatibility code is needed here.\r\n\t\t\t\t\tthis.channels[instrumentChannelIterator].instruments[instrumentIndexIterator].fmChorus = clamp(0, Config.fmChorusNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t} else if (command == SongTagCode.imute) {\r\n\t\t\t\t\t// Muting was added in this commit: https://github.com/ModdedBeepbox/3.0/commit/f177e34831ab85c58e0492ae47a5df80e709d9b4\r\n\t\t\t\t\t// _latestVersion remained 6 before and after this, and the\r\n\t\t\t\t\t// tag code was never used for anything else previously, so\r\n\t\t\t\t\t// no backwards compatibility code is needed here.\r\n\t\t\t\t\tthis.channels[instrumentChannelIterator].instruments[instrumentIndexIterator].imute = clamp(0, Config.imuteNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t} else if (command == SongTagCode.ipan) {\r\n\t\t\t\t\t// @TODO: Add SongTagCode.oldIpan = CharCode.M? Normally it\r\n\t\t\t\t\t// will be ignored if present on songs made before Oct 22, 2018\r\n\t\t\t\t\t// or so.\r\n\t\t\t\t\tthis.channels[instrumentChannelIterator].instruments[instrumentIndexIterator].ipan = clamp(0, Config.ipanValues.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t} else if (command == SongTagCode.octoff) {\r\n\t\t\t\t\t// Octave offset was first added in this commit: https://github.com/ModdedBeepbox/3.0/commit/54bdad302110cbde72b18f041091e53e3c35c189 (see BeepBox_files/5_channel.js)\r\n\t\t\t\t\t// It used CharCode.VERTICAL_LINE as the tag code value.\r\n\t\t\t\t\t// Later, it was changed to use CharCode.B in this commit: https://github.com/ModdedBeepbox/3.0/commit/84b9a7608c22addf01af2acebee6d5f6c65a5122\r\n\t\t\t\t\t// _latestVersion was 5, and the only major difference here\r\n\t\t\t\t\t// is that the octave offsets were pushed for every channel\r\n\t\t\t\t\t// one after another.\r\n\t\t\t\t\t// The beforeThree if was never needed.\r\n\t\t\t\t\tif (fromOld && beforeSix) {\r\n\t\t\t\t\t\tfor (channel = 0; channel < this.getChannelCount(); channel++) {\r\n\t\t\t\t\t\t\tfor (let i: number = 0; i < this.instrumentsPerChannel; i++) {\r\n\t\t\t\t\t\t\t\tthis.channels[channel].instruments[i].octoff = clamp(0, Config.octoffNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.channels[instrumentChannelIterator].instruments[instrumentIndexIterator].octoff = clamp(0, Config.octoffNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (command == SongTagCode.volume) {\r\n\t\t\t\t\tif (fromOld && beforeThree) {\r\n\t\t\t\t\t\tchannel = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\r\n\t\t\t\t\t\tthis.channels[channel].instruments[0].volume = clamp(0, Config.volumeNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t\t} else if (fromOld && beforeSix) {\r\n\t\t\t\t\t\tfor (channel = 0; channel < this.getChannelCount(); channel++) {\r\n\t\t\t\t\t\t\tfor (let i: number = 0; i < this.instrumentsPerChannel; i++) {\r\n\t\t\t\t\t\t\t\tthis.channels[channel].instruments[i].volume = clamp(0, Config.volumeNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.channels[instrumentChannelIterator].instruments[instrumentIndexIterator].volume = clamp(0, Config.volumeNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (command == SongTagCode.algorithm) {\r\n\t\t\t\t\tthis.channels[instrumentChannelIterator].instruments[instrumentIndexIterator].algorithm = clamp(0, Config.operatorAlgorithmNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t} else if (command == SongTagCode.feedbackType) {\r\n\t\t\t\t\tthis.channels[instrumentChannelIterator].instruments[instrumentIndexIterator].feedbackType = clamp(0, Config.operatorFeedbackNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t} else if (command == SongTagCode.feedbackAmplitude) {\r\n\t\t\t\t\tthis.channels[instrumentChannelIterator].instruments[instrumentIndexIterator].feedbackAmplitude = clamp(0, Config.operatorAmplitudeMax + 1, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t} else if (command == SongTagCode.feedbackEnvelope) {\r\n\t\t\t\t\tthis.channels[instrumentChannelIterator].instruments[instrumentIndexIterator].feedbackEnvelope = clamp(0, Config.operatorEnvelopeNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t} else if (command == SongTagCode.operatorFrequencies) {\r\n\t\t\t\t\tfor (let o: number = 0; o < Config.operatorCount; o++) {\r\n\t\t\t\t\t\tthis.channels[instrumentChannelIterator].instruments[instrumentIndexIterator].operators[o].frequency = clamp(0, Config.operatorFrequencyNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (command == SongTagCode.operatorAmplitudes) {\r\n\t\t\t\t\tfor (let o: number = 0; o < Config.operatorCount; o++) {\r\n\t\t\t\t\t\tthis.channels[instrumentChannelIterator].instruments[instrumentIndexIterator].operators[o].amplitude = clamp(0, Config.operatorAmplitudeMax + 1, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (command == SongTagCode.operatorEnvelopes) {\r\n\t\t\t\t\tfor (let o: number = 0; o < Config.operatorCount; o++) {\r\n\t\t\t\t\t\tthis.channels[instrumentChannelIterator].instruments[instrumentIndexIterator].operators[o].envelope = clamp(0, Config.operatorEnvelopeNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (command == SongTagCode.bars) {\r\n\t\t\t\t\tlet subStringLength: number;\r\n\t\t\t\t\tif (fromOld && beforeThree) {\r\n\t\t\t\t\t\tchannel = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\r\n\t\t\t\t\t\tconst barCount: number = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\r\n\t\t\t\t\t\tsubStringLength = Math.ceil(barCount * 0.5);\r\n\t\t\t\t\t\tconst bits: BitFieldReader = new BitFieldReader(base64CharCodeToInt, compressed, charIndex, charIndex + subStringLength);\r\n\t\t\t\t\t\tfor (let i: number = 0; i < barCount; i++) {\r\n\t\t\t\t\t\t\tthis.channels[channel].bars[i] = bits.read(3) + 1;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if (fromOld && beforeFive) {\r\n\t\t\t\t\t\tlet neededBits: number = 0;\r\n\t\t\t\t\t\twhile ((1 << neededBits) < this.patternsPerChannel) neededBits++;\r\n\t\t\t\t\t\tsubStringLength = Math.ceil(this.getChannelCount() * this.barCount * neededBits / 6);\r\n\t\t\t\t\t\tconst bits: BitFieldReader = new BitFieldReader(base64CharCodeToInt, compressed, charIndex, charIndex + subStringLength);\r\n\t\t\t\t\t\tfor (channel = 0; channel < this.getChannelCount(); channel++) {\r\n\t\t\t\t\t\t\tfor (let i: number = 0; i < this.barCount; i++) {\r\n\t\t\t\t\t\t\t\tthis.channels[channel].bars[i] = bits.read(neededBits) + 1;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tlet neededBits: number = 0;\r\n\t\t\t\t\t\twhile ((1 << neededBits) < this.patternsPerChannel + 1) neededBits++;\r\n\t\t\t\t\t\tsubStringLength = Math.ceil(this.getChannelCount() * this.barCount * neededBits / 6);\r\n\t\t\t\t\t\tconst bits: BitFieldReader = new BitFieldReader(base64CharCodeToInt, compressed, charIndex, charIndex + subStringLength);\r\n\t\t\t\t\t\tfor (channel = 0; channel < this.getChannelCount(); channel++) {\r\n\t\t\t\t\t\t\tfor (let i: number = 0; i < this.barCount; i++) {\r\n\t\t\t\t\t\t\t\tthis.channels[channel].bars[i] = bits.read(neededBits);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcharIndex += subStringLength;\r\n\t\t\t\t} else if (command == SongTagCode.patterns) {\r\n\t\t\t\t\tlet bitStringLength: number = 0;\r\n\t\t\t\t\tif (fromOld && beforeThree) {\r\n\t\t\t\t\t\tchannel = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// The old format used the next character to represent the number of patterns in the channel, which is usually eight, the default. \r\n\t\t\t\t\t\tcharIndex++; //let patternCount: number = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbitStringLength = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\r\n\t\t\t\t\t\tbitStringLength = bitStringLength << 6;\r\n\t\t\t\t\t\tbitStringLength += base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tchannel = 0;\r\n\t\t\t\t\t\tlet bitStringLengthLength: number = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\r\n\t\t\t\t\t\twhile (bitStringLengthLength > 0) {\r\n\t\t\t\t\t\t\tbitStringLength = bitStringLength << 6;\r\n\t\t\t\t\t\t\tbitStringLength += base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\r\n\t\t\t\t\t\t\tbitStringLengthLength--;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tconst bits: BitFieldReader = new BitFieldReader(base64CharCodeToInt, compressed, charIndex, charIndex + bitStringLength);\r\n\t\t\t\t\tcharIndex += bitStringLength;\r\n\t\t\t\t\t\r\n\t\t\t\t\tlet neededInstrumentBits: number = 0;\r\n\t\t\t\t\twhile ((1 << neededInstrumentBits) < this.instrumentsPerChannel) neededInstrumentBits++;\r\n\t\t\t\t\twhile (true) {\r\n\t\t\t\t\t\tconst isDrum: boolean = this.getChannelIsDrum(channel);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tconst octaveOffset: number = isDrum ? 0 : this.channels[channel].octave * 12;\r\n\t\t\t\t\t\tlet note: Note | null = null;\r\n\t\t\t\t\t\tlet pin: NotePin | null = null;\r\n\t\t\t\t\t\tlet lastPitch: number = (isDrum ? 4 : 12) + octaveOffset;\r\n\t\t\t\t\t\tconst recentPitches: number[] = isDrum ? [4,6,7,2,3,8,0,10] : [12, 19, 24, 31, 36, 7, 0];\r\n\t\t\t\t\t\tconst recentShapes: any[] = [];\r\n\t\t\t\t\t\tfor (let i: number = 0; i < recentPitches.length; i++) {\r\n\t\t\t\t\t\t\trecentPitches[i] += octaveOffset;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tfor (let i: number = 0; i < this.patternsPerChannel; i++) {\r\n\t\t\t\t\t\t\tconst newPattern: Pattern = this.channels[channel].patterns[i];\r\n\t\t\t\t\t\t\tnewPattern.reset();\r\n\t\t\t\t\t\t\tnewPattern.instrument = bits.read(neededInstrumentBits);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (((fromOld && !beforeThree) || fromNepBox) && bits.read(1) == 0) continue;\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tlet curPart: number = 0;\r\n\t\t\t\t\t\t\tconst newNotes: Note[] = newPattern.notes;\r\n\t\t\t\t\t\t\twhile (curPart < this.beatsPerBar * this.partsPerBeat) {\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tconst useOldShape: boolean = bits.read(1) == 1;\r\n\t\t\t\t\t\t\t\tlet newNote: boolean = false;\r\n\t\t\t\t\t\t\t\tlet shapeIndex: number = 0;\r\n\t\t\t\t\t\t\t\tif (useOldShape) {\r\n\t\t\t\t\t\t\t\t\tshapeIndex = bits.readLongTail(0, 0);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tnewNote = bits.read(1) == 1;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (!useOldShape && !newNote) {\r\n\t\t\t\t\t\t\t\t\tconst restLength: number = bits.readPartDuration();\r\n\t\t\t\t\t\t\t\t\tcurPart += restLength;\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tlet shape: any;\r\n\t\t\t\t\t\t\t\t\tlet pinObj: any;\r\n\t\t\t\t\t\t\t\t\tlet pitch: number;\r\n\t\t\t\t\t\t\t\t\tif (useOldShape) {\r\n\t\t\t\t\t\t\t\t\t\tshape = recentShapes[shapeIndex];\r\n\t\t\t\t\t\t\t\t\t\trecentShapes.splice(shapeIndex, 1);\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\tshape = {};\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\tshape.pitchCount = 1;\r\n\t\t\t\t\t\t\t\t\t\twhile (shape.pitchCount < 4 && bits.read(1) == 1) shape.pitchCount++;\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\tshape.pinCount = bits.readPinCount();\r\n\t\t\t\t\t\t\t\t\t\tshape.initialVolume = bits.read(2);\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\tshape.pins = [];\r\n\t\t\t\t\t\t\t\t\t\tshape.length = 0;\r\n\t\t\t\t\t\t\t\t\t\tshape.bendCount = 0;\r\n\t\t\t\t\t\t\t\t\t\tfor (let j: number = 0; j < shape.pinCount; j++) {\r\n\t\t\t\t\t\t\t\t\t\t\tpinObj = {};\r\n\t\t\t\t\t\t\t\t\t\t\tpinObj.pitchBend = bits.read(1) == 1;\r\n\t\t\t\t\t\t\t\t\t\t\tif (pinObj.pitchBend) shape.bendCount++;\r\n\t\t\t\t\t\t\t\t\t\t\tshape.length += bits.readPartDuration();\r\n\t\t\t\t\t\t\t\t\t\t\tpinObj.time = shape.length;\r\n\t\t\t\t\t\t\t\t\t\t\tpinObj.volume = bits.read(2);\r\n\t\t\t\t\t\t\t\t\t\t\tshape.pins.push(pinObj);\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\trecentShapes.unshift(shape);\r\n\t\t\t\t\t\t\t\t\tif (recentShapes.length > 10) recentShapes.pop();\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tnote = makeNote(0,curPart,curPart + shape.length, shape.initialVolume);\r\n\t\t\t\t\t\t\t\t\tnote.pitches = [];\r\n\t\t\t\t\t\t\t\t\tnote.pins.length = 1;\r\n\t\t\t\t\t\t\t\t\tconst pitchBends: number[] = [];\r\n\t\t\t\t\t\t\t\t\tfor (let j: number = 0; j < shape.pitchCount + shape.bendCount; j++) {\r\n\t\t\t\t\t\t\t\t\t\tconst useOldPitch: boolean = bits.read(1) == 1;\r\n\t\t\t\t\t\t\t\t\t\tif (!useOldPitch) {\r\n\t\t\t\t\t\t\t\t\t\t\tconst interval: number = bits.readPitchInterval();\r\n\t\t\t\t\t\t\t\t\t\t\tpitch = lastPitch;\r\n\t\t\t\t\t\t\t\t\t\t\tlet intervalIter: number = interval;\r\n\t\t\t\t\t\t\t\t\t\t\twhile (intervalIter > 0) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tpitch++;\r\n\t\t\t\t\t\t\t\t\t\t\t\twhile (recentPitches.indexOf(pitch) != -1) pitch++;\r\n\t\t\t\t\t\t\t\t\t\t\t\tintervalIter--;\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\twhile (intervalIter < 0) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tpitch--;\r\n\t\t\t\t\t\t\t\t\t\t\t\twhile (recentPitches.indexOf(pitch) != -1) pitch--;\r\n\t\t\t\t\t\t\t\t\t\t\t\tintervalIter++;\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\tconst pitchIndex: number = bits.read(3);\r\n\t\t\t\t\t\t\t\t\t\t\tpitch = recentPitches[pitchIndex];\r\n\t\t\t\t\t\t\t\t\t\t\trecentPitches.splice(pitchIndex, 1);\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\trecentPitches.unshift(pitch);\r\n\t\t\t\t\t\t\t\t\t\tif (recentPitches.length > 8) recentPitches.pop();\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\tif (j < shape.pitchCount) {\r\n\t\t\t\t\t\t\t\t\t\t\tnote.pitches.push(pitch);\r\n\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\tpitchBends.push(pitch);\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\tif (j == shape.pitchCount - 1) {\r\n\t\t\t\t\t\t\t\t\t\t\tlastPitch = note.pitches[0];\r\n\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\tlastPitch = pitch;\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tpitchBends.unshift(note.pitches[0]);\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tfor (const pinObj of shape.pins) {\r\n\t\t\t\t\t\t\t\t\t\tif (pinObj.pitchBend) pitchBends.shift();\r\n\t\t\t\t\t\t\t\t\t\tpin = makeNotePin(pitchBends[0] - note.pitches[0], pinObj.time, pinObj.volume);\r\n\t\t\t\t\t\t\t\t\t\tnote.pins.push(pin);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tcurPart = note.end;\r\n\t\t\t\t\t\t\t\t\tnewNotes.push(note);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif (fromOld && beforeThree) {\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tchannel++;\r\n\t\t\t\t\t\t\tif (channel >= this.getChannelCount()) break;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} // while (true)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tpublic toJsonObject(enableIntro: boolean = true, loopCount: number = 1, enableOutro: boolean = true): Object {\r\n\t\t\tconst channelArray: Object[] = [];\r\n\t\t\tfor (let channel: number = 0; channel < this.getChannelCount(); channel++) {\r\n\t\t\t\tconst instrumentArray: Object[] = [];\r\n\t\t\t\tconst isDrum: boolean = this.getChannelIsDrum(channel);\r\n\t\t\t\tfor (let i: number = 0; i < this.instrumentsPerChannel; i++) {\r\n\t\t\t\t\tconst instrument: Instrument = this.channels[channel].instruments[i];\r\n\t\t\t\t\tif (isDrum) {\r\n\t\t\t\t\t\tinstrumentArray.push({\r\n\t\t\t\t\t\t\ttype: Config.instrumentTypeNames[InstrumentType.noise],\r\n\t\t\t\t\t\t\tvolume: (5 - instrument.volume) * 20,\r\n\t\t\t\t\t\t\timute: Config.imuteNames[instrument.imute],\r\n\t\t\t\t\t\t\twave: Config.drumNames[instrument.wave],\r\n\t\t\t\t\t\t\ttransition: Config.transitionNames[instrument.transition],\r\n\t\t\t\t\t\t\toctoff: Config.octoffNames[instrument.octoff],\r\n\t\t\t\t\t\t\tipan: Config.ipanValues[instrument.ipan],\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (instrument.type == InstrumentType.chip) {\r\n\t\t\t\t\t\t\tinstrumentArray.push({\r\n\t\t\t\t\t\t\t\ttype: Config.instrumentTypeNames[instrument.type],\r\n\t\t\t\t\t\t\t\tvolume: (5 - instrument.volume) * 20,\r\n\t\t\t\t\t\t\t\twave: Config.waveNames[instrument.wave],\r\n\t\t\t\t\t\t\t\ttransition: Config.transitionNames[instrument.transition],\r\n\t\t\t\t\t\t\t\tfilter: Config.filterNames[instrument.filter],\r\n\t\t\t\t\t\t\t\tchorus: Config.chorusNames[instrument.chorus],\r\n\t\t\t\t\t\t\t\teffect: Config.effectNames[instrument.effect],\r\n\t\t\t\t\t\t\t\tharm: Config.harmNames[instrument.harm],\r\n\t\t\t\t\t\t\t\timute: Config.imuteNames[instrument.imute],\r\n\t\t\t\t\t\t\t\toctoff: Config.octoffNames[instrument.octoff],\r\n\t\t\t\t\t\t\t\tipan: Config.ipanValues[instrument.ipan],\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t} else if (instrument.type == InstrumentType.fm) {\r\n\t\t\t\t\t\t\tconst operatorArray: Object[] = [];\r\n\t\t\t\t\t\t\tfor (const operator of instrument.operators) {\r\n\t\t\t\t\t\t\t\toperatorArray.push({\r\n\t\t\t\t\t\t\t\t\tfrequency: Config.operatorFrequencyNames[operator.frequency],\r\n\t\t\t\t\t\t\t\t\tamplitude: operator.amplitude,\r\n\t\t\t\t\t\t\t\t\tenvelope: Config.operatorEnvelopeNames[operator.envelope],\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tinstrumentArray.push({\r\n\t\t\t\t\t\t\t\ttype: Config.instrumentTypeNames[instrument.type],\r\n\t\t\t\t\t\t\t\tvolume: (5 - instrument.volume) * 20,\r\n\t\t\t\t\t\t\t\ttransition: Config.transitionNames[instrument.transition],\r\n\t\t\t\t\t\t\t\teffect: Config.effectNames[instrument.effect],\r\n\t\t\t\t\t\t\t\toctoff: Config.octoffNames[instrument.octoff],\r\n\t\t\t\t\t\t\t\tfmChorus: Config.fmChorusNames[instrument.fmChorus],\r\n\t\t\t\t\t\t\t\talgorithm: Config.operatorAlgorithmNames[instrument.algorithm],\r\n\t\t\t\t\t\t\t\tfeedbackType: Config.operatorFeedbackNames[instrument.feedbackType],\r\n\t\t\t\t\t\t\t\tfeedbackAmplitude: instrument.feedbackAmplitude,\r\n\t\t\t\t\t\t\t\tfeedbackEnvelope: Config.operatorEnvelopeNames[instrument.feedbackEnvelope],\r\n\t\t\t\t\t\t\t\toperators: operatorArray,\r\n\t\t\t\t\t\t\t\tipan: Config.ipanValues[instrument.ipan],\r\n\t\t\t\t\t\t\t\timute: Config.imuteNames[instrument.imute],\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t} else if (instrument.type == InstrumentType.pwm) {\r\n\t\t\t\t\t\t\tinstrumentArray.push({\r\n\t\t\t\t\t\t\t\t// This uses the wrong instrument type in order\r\n\t\t\t\t\t\t\t\t// to make JSON exports compatible with\r\n\t\t\t\t\t\t\t\t// https://thestarworld.github.io/modboxfixed/\r\n\t\t\t\t\t\t\t\ttype: Config.instrumentTypeNames[InstrumentType.noise],\r\n\t\t\t\t\t\t\t\tvolume: (5 - instrument.volume) * 20,\r\n\t\t\t\t\t\t\t\twave: Config.pwmwaveNames[instrument.wave],\r\n\t\t\t\t\t\t\t\ttransition: Config.transitionNames[instrument.transition],\r\n\t\t\t\t\t\t\t\tfilter: Config.filterNames[instrument.filter],\r\n\t\t\t\t\t\t\t\tchorus: Config.chorusNames[instrument.chorus],\r\n\t\t\t\t\t\t\t\teffect: Config.effectNames[instrument.effect],\r\n\t\t\t\t\t\t\t\tharm: Config.harmNames[instrument.harm],\r\n\t\t\t\t\t\t\t\timute: Config.imuteNames[instrument.imute],\r\n\t\t\t\t\t\t\t\toctoff: Config.octoffNames[instrument.octoff],\r\n\t\t\t\t\t\t\t\tipan: Config.ipanValues[instrument.ipan],\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthrow new Error(\"Unrecognized instrument type\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tconst patternArray: Object[] = [];\r\n\t\t\t\tfor (const pattern of this.channels[channel].patterns) {\r\n\t\t\t\t\tconst noteArray: Object[] = [];\r\n\t\t\t\t\tfor (const note of pattern.notes) {\r\n\t\t\t\t\t\tconst pointArray: Object[] = [];\r\n\t\t\t\t\t\tfor (const pin of note.pins) {\r\n\t\t\t\t\t\t\tpointArray.push({\r\n\t\t\t\t\t\t\t\ttick: pin.time + note.start,\r\n\t\t\t\t\t\t\t\tpitchBend: pin.interval,\r\n\t\t\t\t\t\t\t\tvolume: Math.round(pin.volume * 100 / 3),\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tnoteArray.push({\r\n\t\t\t\t\t\t\tpitches: note.pitches,\r\n\t\t\t\t\t\t\tpoints: pointArray,\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tpatternArray.push({\r\n\t\t\t\t\t\tinstrument: pattern.instrument + 1,\r\n\t\t\t\t\t\tnotes: noteArray, \r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tconst sequenceArray: number[] = [];\r\n\t\t\t\tif (enableIntro) for (let i: number = 0; i < this.loopStart; i++) {\r\n\t\t\t\t\tsequenceArray.push(this.channels[channel].bars[i]);\r\n\t\t\t\t}\r\n\t\t\t\tfor (let l: number = 0; l < loopCount; l++) for (let i: number = this.loopStart; i < this.loopStart + this.loopLength; i++) {\r\n\t\t\t\t\tsequenceArray.push(this.channels[channel].bars[i]);\r\n\t\t\t\t}\r\n\t\t\t\tif (enableOutro) for (let i: number = this.loopStart + this.loopLength; i < this.barCount; i++) {\r\n\t\t\t\t\tsequenceArray.push(this.channels[channel].bars[i]);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tchannelArray.push({\r\n\t\t\t\t\ttype: isDrum ? \"drum\" : \"pitch\",\r\n\t\t\t\t\toctaveScrollBar: this.channels[channel].octave,\r\n\t\t\t\t\tinstruments: instrumentArray,\r\n\t\t\t\t\tpatterns: patternArray,\r\n\t\t\t\t\tsequence: sequenceArray,\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\treturn {\r\n\t\t\t\tformat: Song._format,\r\n\t\t\t\tversion: Song._latestNepBoxVersion,\r\n\t\t\t\ttheme: this.setSongTheme,\r\n\t\t\t\tscale: Config.scales[this.scale].name,\r\n\t\t\t\tmix: Config.mixNames[this.mix],\r\n\t\t\t\tsampleRate: Config.sampleRateNames[this.sampleRate],\r\n\t\t\t\tkey: Config.keys[this.key].name,\r\n\t\t\t\tintroBars: this.loopStart,\r\n\t\t\t\tloopBars: this.loopLength,\r\n\t\t\t\tbeatsPerBar: this.beatsPerBar,\r\n\t\t\t\tticksPerBeat: this.partsPerBeat,\r\n\t\t\t\tbeatsPerMinute: this.getBeatsPerMinute(), // represents tempo\r\n\t\t\t\treverb: this.reverb,\r\n\t\t\t\tblend: this.blend,\r\n\t\t\t\triff: this.riff,\r\n\t\t\t\tdetune: this.detune,\r\n\t\t\t\tmuff: this.muff,\r\n\t\t\t\t//outroBars: this.barCount - this.loopStart - this.loopLength; // derive this from bar arrays?\r\n\t\t\t\t//patternCount: this.patternsPerChannel, // derive this from pattern arrays?\r\n\t\t\t\t//instrumentsPerChannel: this.instrumentsPerChannel, //derive this from instrument arrays?\r\n\t\t\t\tchannels: channelArray,\r\n\t\t\t};\r\n\t\t}\r\n\t\t\r\n\t\tpublic fromJsonObject(jsonObject: any): void {\r\n\t\t\tthis.initToDefault(true);\r\n\t\t\tif (!jsonObject) return;\r\n\t\t\tconst format: any = jsonObject.format;\r\n\t\t\tconst version: any = jsonObject.version;\r\n\t\t\tif (version > Song._format) return;\r\n\t\t\t\r\n\t\t\tthis.scale = 11; // default to expert.\r\n\t\t\tif (jsonObject.scale != undefined) {\r\n\t\t\t\tif (format == \"BeepBox\") {\r\n\t\t\t\tconst oldScaleNames: Dictionary<number> = {\"romani :)\": 8, \"romani :(\": 9};\r\n\t\t\t\tconst scale: number = oldScaleNames[jsonObject.scale] != undefined ? oldScaleNames[jsonObject.scale] : Config.scales.map(scale=>scale.name).indexOf(jsonObject.scale);\r\n\t\t\t\tif (scale != -1) this.scale = scale;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.scale = Config.scales.map(scale=>scale.name).indexOf(jsonObject[\"scale\"]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (jsonObject.theme != undefined) {\r\n\t\t\t\tif (format == \"BeepBox\") {\r\n\t\t\t\t\tif ((jsonObject[\"theme\"] != \"Nepbox\") && (jsonObject[\"theme\"] != \"Laffey\") && (jsonObject[\"theme\"] != \"ModBox\")) {\r\n\t\t\t\t\t\tvar themes = [\"none\", \"modbox2\", \"artic\", \"Cinnamon Roll\", \"Ocean\", \"rainbow\", \"float\", \"windows\", \"grassland\", \"dessert\", \"kahootiest\", \"beambit\", \"egg\", \"Poniryoshka\", \"gameboy\", \"woodkid\", \"midnight\", \"snedbox\", \"unnamed\", \"piano\", \"halloween\", \"frozen\"];\r\n\t\t\t\t\t\tvar themeIndex = Config.oldThemeNames.indexOf(jsonObject[\"theme\"]);\r\n\t\t\t\t\t\tthis.setSongTheme = themes[themeIndex];\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tvar themes = [\"none\", \"nepbox\", \"laffey\"];\r\n\t\t\t\t\t\tvar oldThemes = [\"ModBox\", \"Nepbox\", \"Laffey\"];\r\n\t\t\t\t\t\tvar themeIndex = oldThemes.indexOf(jsonObject[\"theme\"]);\r\n\t\t\t\t\t\tthis.setSongTheme = themes[themeIndex];\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\tthis.setSongTheme = jsonObject[\"theme\"];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (jsonObject.mix != undefined) {\r\n\t\t\t\tthis.mix = Config.mixNames.indexOf(jsonObject.mix);\r\n\t\t\t\tif (this.mix == -1) this.mix = 1;\r\n\t\t\t}\r\n\r\n\t\t\tif (jsonObject.sampleRate != undefined) {\r\n\t\t\t\tthis.sampleRate = Config.sampleRateNames.indexOf(jsonObject.sampleRate);\r\n\t\t\t\tif (this.sampleRate == -1) this.sampleRate = 2;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (jsonObject.key != undefined) {\r\n\t\t\t\tif (format == \"BeepBox\") {\r\n\t\t\t\t\tif (typeof(jsonObject.key) == \"number\") {\r\n\t\t\t\t\t\tthis.key = Config.oldKeys.length - 1 - (((jsonObject.key + 1200) >>> 0) % Config.oldKeys.length);\r\n\t\t\t\t\t} else if (typeof(jsonObject.key) == \"string\") {\r\n\t\t\t\t\t\tthis.key = Config.keys.map(key=>key.name).indexOf(jsonObject.key);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.key = Config.keys.map(key=>key.name).indexOf(jsonObject.key);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (jsonObject.beatsPerMinute != undefined) {\r\n\t\t\t\tthis.tempo = jsonObject.beatsPerMinute;\r\n\t\t\t\tthis.tempo = clamp(Config.tempoMin, Config.tempoMax, this.tempo);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (jsonObject.reverb != undefined) {\r\n\t\t\t\tthis.reverb = clamp(0, Config.reverbRange, jsonObject.reverb | 0);\r\n\t\t\t}\r\n\r\n\t\t\tif (jsonObject.blend != undefined) {\r\n\t\t\t\tthis.blend = clamp(0, Config.blendRange, jsonObject.blend | 0);\r\n\t\t\t}\r\n\r\n\t\t\tif (jsonObject.riff != undefined) {\r\n\t\t\t\tthis.riff = clamp(0, Config.riffRange, jsonObject.riff | 0);\r\n\t\t\t}\r\n\r\n\t\t\tif (jsonObject.detune != undefined) {\r\n\t\t\t\tthis.detune = clamp(0, Config.detuneRange, jsonObject.detune | 0);\r\n\t\t\t}\r\n\r\n\t\t\tif (jsonObject.muff != undefined) {\r\n\t\t\t\tthis.muff = clamp(0, Config.muffRange, jsonObject.muff | 0);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (jsonObject.beatsPerBar != undefined) {\r\n\t\t\t\tthis.beatsPerBar = Math.max(Config.beatsPerBarMin, Math.min(Config.beatsPerBarMax, jsonObject.beatsPerBar | 0));\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (jsonObject.ticksPerBeat != undefined) {\r\n\t\t\t\tthis.partsPerBeat = jsonObject.ticksPerBeat | 0;\r\n\t\t\t\tif (Config.partCounts.indexOf(this.partsPerBeat) == -1) {\r\n\t\t\t\t\tthis.partsPerBeat = Config.partCounts[Config.partCounts.length - 1];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tlet maxInstruments: number = 1;\r\n\t\t\tlet maxPatterns: number = 1;\r\n\t\t\tlet maxBars: number = 1;\r\n\t\t\tif (jsonObject.channels) {\r\n\t\t\t\tfor (const channelObject of jsonObject.channels) {\r\n\t\t\t\t\tif (channelObject.instruments) maxInstruments = Math.max(maxInstruments, channelObject.instruments.length | 0);\r\n\t\t\t\t\tif (channelObject.patterns) maxPatterns = Math.max(maxPatterns, channelObject.patterns.length | 0);\r\n\t\t\t\t\tif (channelObject.sequence) maxBars = Math.max(maxBars, channelObject.sequence.length | 0);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.instrumentsPerChannel = maxInstruments;\r\n\t\t\tthis.patternsPerChannel = maxPatterns;\r\n\t\t\tthis.barCount = maxBars;\r\n\t\t\t\r\n\t\t\tif (jsonObject.introBars != undefined) {\r\n\t\t\t\tthis.loopStart = clamp(0, this.barCount, jsonObject.introBars | 0);\r\n\t\t\t}\r\n\t\t\tif (jsonObject.loopBars != undefined) {\r\n\t\t\t\tthis.loopLength = clamp(1, this.barCount - this.loopStart + 1, jsonObject.loopBars | 0);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tlet pitchChannelCount = 0;\r\n\t\t\tlet drumChannelCount = 0;\r\n\t\t\tif (jsonObject.channels) {\r\n\t\t\t\tfor (let channel: number = 0; channel < jsonObject.channels.length; channel++) {\r\n\t\t\t\t\tlet channelObject: any = jsonObject.channels[channel];\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (this.channels.length <= channel) this.channels[channel] = new Channel();\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (channelObject.octaveScrollBar != undefined) {\r\n\t\t\t\t\t\tthis.channels[channel].octave = clamp(0, 5, channelObject.octaveScrollBar | 0);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tfor (let i: number = this.channels[channel].instruments.length; i < this.instrumentsPerChannel; i++) {\r\n\t\t\t\t\t\tthis.channels[channel].instruments[i] = new Instrument();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.channels[channel].instruments.length = this.instrumentsPerChannel;\r\n\t\t\t\t\t\r\n\t\t\t\t\tfor (let i: number = this.channels[channel].patterns.length; i < this.patternsPerChannel; i++) {\r\n\t\t\t\t\t\tthis.channels[channel].patterns[i] = new Pattern();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.channels[channel].patterns.length = this.patternsPerChannel;\r\n\t\t\t\t\t\r\n\t\t\t\t\tfor (let i: number = 0; i < this.barCount; i++) {\r\n\t\t\t\t\t\tthis.channels[channel].bars[i] = 1;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.channels[channel].bars.length = this.barCount;\r\n\t\t\t\t\t\r\n\t\t\t\t\tlet isDrum: boolean = false;\r\n\t\t\t\t\tif (channelObject.type) {\r\n\t\t\t\t\t\tisDrum = (channelObject.type == \"drum\");\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// for older files, assume drums are channel 3.\r\n\t\t\t\t\t\tisDrum = (channel >= 3);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (isDrum) drumChannelCount++; else pitchChannelCount++;\r\n\t\t\t\t\t\r\n\t\t\t\t\tfor (let i: number = 0; i < this.instrumentsPerChannel; i++) {\r\n\t\t\t\t\t\tconst instrument: Instrument = this.channels[channel].instruments[i];\r\n\t\t\t\t\t\tlet instrumentObject: any = undefined;\r\n\t\t\t\t\t\tif (channelObject.instruments) instrumentObject = channelObject.instruments[i];\r\n\t\t\t\t\t\tif (instrumentObject == undefined) instrumentObject = {};\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tconst oldTransitionNames: Dictionary<number> = {\"binary\": 0};\r\n\t\t\t\t\t\tconst transitionObject = instrumentObject.transition || instrumentObject.envelope; // the transition property used to be called envelope, so try that too.\r\n\t\t\t\t\t\tinstrument.transition = oldTransitionNames[transitionObject] != undefined ? oldTransitionNames[transitionObject] : Config.transitionNames.indexOf(transitionObject);\r\n\t\t\t\t\t\tif (instrument.transition == -1) instrument.transition = 1;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif (isDrum) {\r\n\t\t\t\t\t\t\tif (instrumentObject.volume != undefined) {\r\n\t\t\t\t\t\t\t\tinstrument.volume = clamp(0, Config.volumeNames.length, Math.round(5 - (instrumentObject.volume | 0) / 20));\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tinstrument.volume = 0;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tinstrument.wave = Config.drumNames.indexOf(instrumentObject.wave);\r\n\t\t\t\t\t\t\tif (instrument.wave == -1) instrument.wave = 1;\r\n\t\t\t\t\t\t\tinstrument.imute = Config.imuteNames.indexOf(instrumentObject.imute);\r\n\t\t\t\t\t\t\tif (instrument.imute == -1) instrument.imute = 0;\r\n\t\t\t\t\t\t\tinstrument.ipan = Config.ipanValues.indexOf(instrumentObject.ipan);\r\n\t\t\t\t\t\t\tif (instrument.ipan == -1) instrument.ipan = 4;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tinstrument.type = Config.instrumentTypeNames.indexOf(instrumentObject.type);\r\n\t\t\t\t\t\t\tif (instrument.type == null) instrument.type = InstrumentType.chip;\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (instrument.type == InstrumentType.chip) {\r\n\t\t\t\t\t\t\t\tif (instrumentObject.volume != undefined) {\r\n\t\t\t\t\t\t\t\t\tinstrument.volume = clamp(0, Config.volumeNames.length, Math.round(5 - (instrumentObject.volume | 0) / 20));\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tinstrument.volume = 0;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tinstrument.wave = Config.waveNames.indexOf(instrumentObject.wave);\r\n\t\t\t\t\t\t\t\tif (instrument.wave == -1) instrument.wave = 1;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tconst oldFilterNames: Dictionary<number> = {\"sustain sharp\": 1, \"sustain medium\": 2, \"sustain soft\": 3, \"decay sharp\": 4};\r\n\t\t\t\t\t\t\t\tinstrument.filter = oldFilterNames[instrumentObject.filter] != undefined ? oldFilterNames[instrumentObject.filter] : Config.filterNames.indexOf(instrumentObject.filter);\r\n\t\t\t\t\t\t\t\tif (instrument.filter == -1) instrument.filter = 0;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tinstrument.chorus = Config.chorusNames.indexOf(instrumentObject.chorus);\r\n\t\t\t\t\t\t\t\tif (instrument.chorus == -1) instrument.chorus = 0;\r\n\t\t\t\t\t\t\t\tinstrument.effect = Config.effectNames.indexOf(instrumentObject.effect);\r\n\t\t\t\t\t\t\t\tif (instrument.effect == -1) instrument.effect = 0;\r\n\t\t\t\t\t\t\t\tinstrument.harm = Config.harmNames.indexOf(instrumentObject.harm);\r\n\t\t\t\t\t\t\t\tif (instrument.harm == -1) instrument.harm = 0;\r\n\t\t\t\t\t\t\t\tinstrument.octoff = Config.octoffNames.indexOf(instrumentObject.octoff);\r\n\t\t\t\t\t\t\t\tif (instrument.octoff == -1) instrument.octoff = 0;\r\n\t\t\t\t\t\t\t\tinstrument.imute = Config.imuteNames.indexOf(instrumentObject.imute);\r\n\t\t\t\t\t\t\t\tif (instrument.imute == -1) instrument.imute = 0;\r\n\t\t\t\t\t\t\t\tinstrument.ipan = Config.ipanValues.indexOf(instrumentObject.ipan);\r\n\t\t\t\t\t\t\t\tif (instrument.ipan == -1) instrument.ipan = 4;\r\n\t\t\t\t\t\t\t} else if (\r\n\t\t\t\t\t\t\t\tinstrument.type == InstrumentType.pwm\r\n\t\t\t\t\t\t\t\t|| instrument.type == InstrumentType.noise\r\n\t\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\t\tif (instrument.type == InstrumentType.noise) {\r\n\t\t\t\t\t\t\t\t\tinstrument.type = InstrumentType.pwm;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tif (instrumentObject.volume != undefined) {\r\n\t\t\t\t\t\t\t\t\tinstrument.volume = clamp(0, Config.volumeNames.length, Math.round(5 - (instrumentObject.volume | 0) / 20));\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tinstrument.volume = 0;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tinstrument.wave = Config.pwmwaveNames.indexOf(instrumentObject.wave);\r\n\t\t\t\t\t\t\t\tif (instrument.wave == -1) instrument.wave = 1;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tconst oldFilterNames: Dictionary<number> = {\"sustain sharp\": 1, \"sustain medium\": 2, \"sustain soft\": 3, \"decay sharp\": 4};\r\n\t\t\t\t\t\t\t\tinstrument.filter = oldFilterNames[instrumentObject.filter] != undefined ? oldFilterNames[instrumentObject.filter] : Config.filterNames.indexOf(instrumentObject.filter);\r\n\t\t\t\t\t\t\t\tif (instrument.filter == -1) instrument.filter = 0;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tinstrument.chorus = Config.chorusNames.indexOf(instrumentObject.chorus);\r\n\t\t\t\t\t\t\t\tif (instrument.chorus == -1) instrument.chorus = 0;\r\n\t\t\t\t\t\t\t\tinstrument.effect = Config.effectNames.indexOf(instrumentObject.effect);\r\n\t\t\t\t\t\t\t\tif (instrument.effect == -1) instrument.effect = 0;\r\n\t\t\t\t\t\t\t\tinstrument.harm = Config.harmNames.indexOf(instrumentObject.harm);\r\n\t\t\t\t\t\t\t\tif (instrument.harm == -1) instrument.harm = 0;\r\n\t\t\t\t\t\t\t\tinstrument.octoff = Config.octoffNames.indexOf(instrumentObject.octoff);\r\n\t\t\t\t\t\t\t\tif (instrument.octoff == -1) instrument.octoff = 0;\r\n\t\t\t\t\t\t\t\tinstrument.imute = Config.imuteNames.indexOf(instrumentObject.imute);\r\n\t\t\t\t\t\t\t\tif (instrument.imute == -1) instrument.imute = 0;\r\n\t\t\t\t\t\t\t\tinstrument.ipan = Config.ipanValues.indexOf(instrumentObject.ipan);\r\n\t\t\t\t\t\t\t\tif (instrument.ipan == -1) instrument.ipan = 4;\r\n\t\t\t\t\t\t\t} else if (instrument.type == InstrumentType.fm) {\r\n\t\t\t\t\t\t\t\tinstrument.effect = Config.effectNames.indexOf(instrumentObject.effect);\r\n\t\t\t\t\t\t\t\tif (instrument.effect == -1) instrument.effect = 0;\r\n\r\n\t\t\t\t\t\t\t\tinstrument.octoff = Config.octoffNames.indexOf(instrumentObject.octoff);\r\n\t\t\t\t\t\t\t\tif (instrument.octoff == -1) instrument.octoff = 0;\r\n\r\n\t\t\t\t\t\t\t\tinstrument.fmChorus = Config.fmChorusNames.indexOf(instrumentObject.fmChorus);\r\n\t\t\t\t\t\t\t\tif (instrument.fmChorus == -1) instrument.fmChorus = 0;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tinstrument.algorithm = Config.operatorAlgorithmNames.indexOf(instrumentObject.algorithm);\r\n\t\t\t\t\t\t\t\tif (instrument.algorithm == -1) instrument.algorithm = 0;\r\n\t\t\t\t\t\t\t\tinstrument.feedbackType = Config.operatorFeedbackNames.indexOf(instrumentObject.feedbackType);\r\n\t\t\t\t\t\t\t\tif (instrument.feedbackType == -1) instrument.feedbackType = 0;\r\n\t\t\t\t\t\t\t\tif (instrumentObject.feedbackAmplitude != undefined) {\r\n\t\t\t\t\t\t\t\t\tinstrument.feedbackAmplitude = clamp(0, Config.operatorAmplitudeMax + 1, instrumentObject.feedbackAmplitude | 0);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tinstrument.feedbackAmplitude = 0;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tinstrument.feedbackEnvelope = Config.operatorEnvelopeNames.indexOf(instrumentObject.feedbackEnvelope);\r\n\t\t\t\t\t\t\t\tif (instrument.feedbackEnvelope == -1) instrument.feedbackEnvelope = 0;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tfor (let j: number = 0; j < Config.operatorCount; j++) {\r\n\t\t\t\t\t\t\t\t\tconst operator: Operator = instrument.operators[j];\r\n\t\t\t\t\t\t\t\t\tlet operatorObject: any = undefined;\r\n\t\t\t\t\t\t\t\t\tif (instrumentObject.operators) operatorObject = instrumentObject.operators[j];\r\n\t\t\t\t\t\t\t\t\tif (operatorObject == undefined) operatorObject = {};\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\toperator.frequency = Config.operatorFrequencyNames.indexOf(operatorObject.frequency);\r\n\t\t\t\t\t\t\t\t\tif (operator.frequency == -1) operator.frequency = 0;\r\n\t\t\t\t\t\t\t\t\tif (operatorObject.amplitude != undefined) {\r\n\t\t\t\t\t\t\t\t\t\toperator.amplitude = clamp(0, Config.operatorAmplitudeMax + 1, operatorObject.amplitude | 0);\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\toperator.amplitude = 0;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\toperator.envelope = Config.operatorEnvelopeNames.indexOf(operatorObject.envelope);\r\n\t\t\t\t\t\t\t\t\tif (operator.envelope == -1) operator.envelope = 0;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tinstrument.ipan = Config.ipanValues.indexOf(instrumentObject.ipan);\r\n\t\t\t\t\t\t\t\tif (instrument.ipan == -1) instrument.ipan = 4;\r\n\t\t\t\t\t\t\t\tinstrument.imute = Config.imuteNames.indexOf(instrumentObject.imute);\r\n\t\t\t\t\t\t\t\tif (instrument.imute == -1) instrument.imute = 0;\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tthrow new Error(\"Unrecognized instrument type.\");\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t\tfor (let i: number = 0; i < this.patternsPerChannel; i++) {\r\n\t\t\t\t\t\tconst pattern: Pattern = this.channels[channel].patterns[i];\r\n\t\t\t\t\t\r\n\t\t\t\t\t\tlet patternObject: any = undefined;\r\n\t\t\t\t\t\tif (channelObject.patterns) patternObject = channelObject.patterns[i];\r\n\t\t\t\t\t\tif (patternObject == undefined) continue;\r\n\t\t\t\t\t\r\n\t\t\t\t\t\tpattern.instrument = clamp(0, this.instrumentsPerChannel, (patternObject.instrument | 0) - 1);\r\n\t\t\t\t\t\r\n\t\t\t\t\t\tif (patternObject.notes && patternObject.notes.length > 0) {\r\n\t\t\t\t\t\t\tconst maxNoteCount: number = Math.min(this.beatsPerBar * this.partsPerBeat, patternObject.notes.length >>> 0);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t///@TODO: Consider supporting notes specified in any timing order, sorting them and truncating as necessary. \r\n\t\t\t\t\t\t\tlet tickClock: number = 0;\r\n\t\t\t\t\t\t\tfor (let j: number = 0; j < patternObject.notes.length; j++) {\r\n\t\t\t\t\t\t\t\tif (j >= maxNoteCount) break;\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tconst noteObject = patternObject.notes[j];\r\n\t\t\t\t\t\t\t\tif (!noteObject || !noteObject.pitches || !(noteObject.pitches.length >= 1) || !noteObject.points || !(noteObject.points.length >= 2)) {\r\n\t\t\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tconst note: Note = makeNote(0, 0, 0, 0);\r\n\t\t\t\t\t\t\t\tnote.pitches = [];\r\n\t\t\t\t\t\t\t\tnote.pins = [];\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tfor (let k: number = 0; k < noteObject.pitches.length; k++) {\r\n\t\t\t\t\t\t\t\t\tconst pitch: number = noteObject.pitches[k] | 0;\r\n\t\t\t\t\t\t\t\t\tif (note.pitches.indexOf(pitch) != -1) continue;\r\n\t\t\t\t\t\t\t\t\tnote.pitches.push(pitch);\r\n\t\t\t\t\t\t\t\t\tif (note.pitches.length >= 4) break;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tif (note.pitches.length < 1) continue;\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tlet noteClock: number = tickClock;\r\n\t\t\t\t\t\t\t\tlet startInterval: number = 0;\r\n\t\t\t\t\t\t\t\tfor (let k: number = 0; k < noteObject.points.length; k++) {\r\n\t\t\t\t\t\t\t\t\tconst pointObject: any = noteObject.points[k];\r\n\t\t\t\t\t\t\t\t\tif (pointObject == undefined || pointObject.tick == undefined) continue;\r\n\t\t\t\t\t\t\t\t\tconst interval: number = (pointObject.pitchBend == undefined) ? 0 : (pointObject.pitchBend | 0);\r\n\t\t\t\t\t\t\t\t\tconst time: number = pointObject.tick | 0;\r\n\t\t\t\t\t\t\t\t\tconst volume: number = (pointObject.volume == undefined) ? 3 : Math.max(0, Math.min(3, Math.round((pointObject.volume | 0) * 3 / 100)));\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tif (time > this.beatsPerBar * this.partsPerBeat) continue;\r\n\t\t\t\t\t\t\t\t\tif (note.pins.length == 0) {\r\n\t\t\t\t\t\t\t\t\t\tif (time < noteClock) continue;\r\n\t\t\t\t\t\t\t\t\t\tnote.start = time;\r\n\t\t\t\t\t\t\t\t\t\tstartInterval = interval;\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\tif (time <= noteClock) continue;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tnoteClock = time;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tnote.pins.push(makeNotePin(interval - startInterval, time - note.start, volume));\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tif (note.pins.length < 2) continue;\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tnote.end = note.pins[note.pins.length - 1].time + note.start;\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tconst maxPitch: number = isDrum ? Config.drumCount - 1 : Config.maxPitch;\r\n\t\t\t\t\t\t\t\tlet lowestPitch: number = maxPitch;\r\n\t\t\t\t\t\t\t\tlet highestPitch: number = 0;\r\n\t\t\t\t\t\t\t\tfor (let k: number = 0; k < note.pitches.length; k++) {\r\n\t\t\t\t\t\t\t\t\tnote.pitches[k] += startInterval;\r\n\t\t\t\t\t\t\t\t\tif (note.pitches[k] < 0 || note.pitches[k] > maxPitch) {\r\n\t\t\t\t\t\t\t\t\t\tnote.pitches.splice(k, 1);\r\n\t\t\t\t\t\t\t\t\t\tk--;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tif (note.pitches[k] < lowestPitch) lowestPitch = note.pitches[k];\r\n\t\t\t\t\t\t\t\t\tif (note.pitches[k] > highestPitch) highestPitch = note.pitches[k];\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tif (note.pitches.length < 1) continue;\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tfor (let k: number = 0; k < note.pins.length; k++) {\r\n\t\t\t\t\t\t\t\t\tconst pin: NotePin = note.pins[k];\r\n\t\t\t\t\t\t\t\t\tif (pin.interval + lowestPitch < 0) pin.interval = -lowestPitch;\r\n\t\t\t\t\t\t\t\t\tif (pin.interval + highestPitch > maxPitch) pin.interval = maxPitch - highestPitch;\r\n\t\t\t\t\t\t\t\t\tif (k >= 2) {\r\n\t\t\t\t\t\t\t\t\t\tif (pin.interval == note.pins[k-1].interval && \r\n\t\t\t\t\t\t\t\t\t\t\tpin.interval == note.pins[k-2].interval && \r\n\t\t\t\t\t\t\t\t\t\t\tpin.volume == note.pins[k-1].volume && \r\n\t\t\t\t\t\t\t\t\t\t\tpin.volume == note.pins[k-2].volume)\r\n\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\tnote.pins.splice(k-1, 1);\r\n\t\t\t\t\t\t\t\t\t\t\tk--;\r\n\t\t\t\t\t\t\t\t\t\t}    \r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tpattern.notes.push(note);\r\n\t\t\t\t\t\t\t\ttickClock = note.end;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t\tfor (let i: number = 0; i < this.barCount; i++) {\r\n\t\t\t\t\t\tthis.channels[channel].bars[i] = channelObject.sequence ? Math.min(this.patternsPerChannel, channelObject.sequence[i] >>> 0) : 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.pitchChannelCount = pitchChannelCount;\r\n\t\t\tthis.drumChannelCount = drumChannelCount;\r\n\t\t\tthis.channels.length = this.getChannelCount();\r\n\t\t}\r\n\t\t\r\n\t\tpublic getPattern(channel: number, bar: number): Pattern | null {\r\n\t\t\tconst patternIndex: number = this.channels[channel].bars[bar];\r\n\t\t\tif (patternIndex == 0) return null;\r\n\t\t\treturn this.channels[channel].patterns[patternIndex - 1];\r\n\t\t}\r\n\t\t\r\n\t\tpublic getPatternInstrument(channel: number, bar: number): number {\r\n\t\t\tconst pattern: Pattern | null = this.getPattern(channel, bar);\r\n\t\t\treturn pattern == null ? 0 : pattern.instrument;\r\n\t\t}\r\n\r\n\t\tpublic getPatternInstrumentMute(channel: number, bar: number): number {\r\n\t\t\tconst pattern: Pattern | null = this.getPattern(channel, bar);\r\n\t\t\tconst instrumentIndex: number = this.getPatternInstrument(channel, bar);\r\n\t\t\tconst instrument: Instrument = this.channels[channel].instruments[instrumentIndex];\r\n\t\t\treturn pattern == null ? 0 : instrument.imute;\r\n\t\t}\r\n\r\n\t\tpublic getPatternInstrumentVolume(channel: number, bar: number): number {\r\n\t\t\tconst pattern: Pattern | null = this.getPattern(channel, bar);\r\n\t\t\tconst instrumentIndex: number = this.getPatternInstrument(channel, bar);\r\n\t\t\tconst instrument: Instrument = this.channels[channel].instruments[instrumentIndex];\r\n\t\t\treturn pattern == null ? 0 : instrument.volume;\r\n\t\t}\r\n\t\t\r\n\t\tpublic getBeatsPerMinute(): number {\r\n\t\t\treturn this.tempo;\r\n\t\t}\r\n\t\t\r\n\t\tprivate readonly _fingerprint: Array<string | number> = [];\r\n\t\tpublic getChannelFingerprint(bar: number): string {\r\n\t\t\tconst channelCount: number = this.getChannelCount();\r\n\t\t\tlet charCount: number = 0;\r\n\t\t\tfor (let channel: number = 0; channel < channelCount; channel++) {\r\n\t\t\t\tif (channel < this.pitchChannelCount) {\r\n\t\t\t\t\tconst instrumentIndex: number = this.getPatternInstrument(channel, bar);\r\n\t\t\t\t\tconst instrument: Instrument = this.channels[channel].instruments[instrumentIndex];\r\n\t\t\t\t\tif (instrument.type == InstrumentType.chip) {\r\n\t\t\t\t\t\tthis._fingerprint[charCount++] = \"c\";\r\n\t\t\t\t\t} else if (instrument.type == InstrumentType.fm) {\r\n\t\t\t\t\t\tthis._fingerprint[charCount++] = \"f\"\r\n\t\t\t\t\t\tthis._fingerprint[charCount++] = instrument.algorithm;\r\n\t\t\t\t\t\tthis._fingerprint[charCount++] = instrument.feedbackType;\r\n\t\t\t\t\t} else if (instrument.type == InstrumentType.pwm) {\r\n\t\t\t\t\t\tthis._fingerprint[charCount++] = \"p\";\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthrow new Error(\"Unknown instrument type.\");\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis._fingerprint[charCount++] = \"d\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis._fingerprint.length = charCount;\r\n\t\t\treturn this._fingerprint.join(\"\");\r\n\t\t}\r\n\t}","/*\r\nCopyright (C) 2018 John Nesky\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of \r\nthis software and associated documentation files (the \"Software\"), to deal in \r\nthe Software without restriction, including without limitation the rights to \r\nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \r\nof the Software, and to permit persons to whom the Software is furnished to do \r\nso, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all \r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \r\nSOFTWARE.\r\n*/\r\n\r\n\r\n\texport class Change {\r\n\t\tprivate _noop: boolean = true;\r\n\t\t\r\n\t\tprotected _didSomething(): void {\r\n\t\t\tthis._noop = false;\r\n\t\t}\r\n\t\t\r\n\t\tpublic isNoop(): boolean {\r\n\t\t\treturn this._noop;\r\n\t\t}\r\n\r\n\t\tpublic commit(): void {}\r\n\t}\r\n\t\r\n\texport class UndoableChange extends Change {\r\n\t\tprivate _reversed: boolean;\r\n\t\tprivate _doneForwards: boolean;\r\n\t\tconstructor(reversed: boolean) {\r\n\t\t\tsuper();\r\n\t\t\tthis._reversed = reversed;\r\n\t\t\tthis._doneForwards = !reversed;\r\n\t\t}\r\n\t\t\r\n\t\tpublic undo(): void {\r\n\t\t\tif (this._reversed) {\r\n\t\t\t\tthis._doForwards();\r\n\t\t\t\tthis._doneForwards = true;\r\n\t\t\t} else {\r\n\t\t\t\tthis._doBackwards();\r\n\t\t\t\tthis._doneForwards = false;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tpublic redo(): void {\r\n\t\t\tif (this._reversed) {\r\n\t\t\t\tthis._doBackwards();\r\n\t\t\t\tthis._doneForwards = false;\r\n\t\t\t} else {\r\n\t\t\t\tthis._doForwards();\r\n\t\t\t\tthis._doneForwards = true;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t// isDoneForwards() returns whether or not the Change was most recently \r\n\t\t// performed forwards or backwards. If the change created something, do not \r\n\t\t// delete it in the change destructor unless the Change was performed \r\n\t\t// backwards: \r\n\t\tprotected _isDoneForwards(): boolean {\r\n\t\t\treturn this._doneForwards;\r\n\t\t}\r\n\t\t\r\n\t\tprotected _doForwards(): void {\r\n\t\t\tthrow new Error(\"Change.doForwards(): Override me.\");\r\n\t\t}\r\n\t\t\r\n\t\tprotected _doBackwards(): void {\r\n\t\t\tthrow new Error(\"Change.doBackwards(): Override me.\");\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeGroup extends Change {\r\n\t\tconstructor() {\r\n\t\t\tsuper();\r\n\t\t}\r\n\t\t\r\n\t\tpublic append(change: Change): void {\r\n\t\t\tif (change.isNoop()) return;\r\n\t\t\tthis._didSomething();\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeSequence extends UndoableChange {\r\n\t\tprivate _changes: UndoableChange[];\r\n\t\tconstructor(changes?: UndoableChange[]) {\r\n\t\t\tsuper(false);\r\n\t\t\tif (changes == undefined) {\r\n\t\t\t\tthis._changes = [];\r\n\t\t\t} else {\r\n\t\t\t\tthis._changes = changes.concat();\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tpublic append(change: UndoableChange): void {\r\n\t\t\tif (change.isNoop()) return;\r\n\t\t\tthis._changes[this._changes.length] = change;\r\n\t\t\tthis._didSomething();\r\n\t\t}\r\n\t\t\r\n\t\tprotected _doForwards(): void {\r\n\t\t\tfor (let i: number = 0; i < this._changes.length; i++) {\r\n\t\t\t\tthis._changes[i].redo();\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tprotected _doBackwards(): void {\r\n\t\t\tfor (let i: number = this._changes.length-1; i >= 0 ; i--) {\r\n\t\t\t\tthis._changes[i].undo();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n","/*\r\nCopyright (C) 2018 John Nesky\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of \r\nthis software and associated documentation files (the \"Software\"), to deal in \r\nthe Software without restriction, including without limitation the rights to \r\nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \r\nof the Software, and to permit persons to whom the Software is furnished to do \r\nso, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all \r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \r\nSOFTWARE.\r\n*/\r\n\r\nimport { SongDocument } from \"./SongDocument\";\r\nimport { Change, UndoableChange, ChangeSequence, ChangeGroup } from \"./Change\";\r\nimport { NotePin, Note, Song, Pattern, makeNotePin, Instrument, Channel } from \"../synth/song\";\r\nimport { InstrumentType, Config } from \"../synth/SynthConfig\";\r\n\r\n\texport class ChangePins extends UndoableChange {\r\n\t\tprotected _oldStart: number;\r\n\t\tprotected _newStart: number;\r\n\t\tprotected _oldEnd: number;\r\n\t\tprotected _newEnd: number;\r\n\t\tprotected _oldPins: NotePin[];\r\n\t\tprotected _newPins: NotePin[];\r\n\t\tprotected _oldPitches: number[];\r\n\t\tprotected _newPitches: number[];\r\n\t\tconstructor(protected _doc: SongDocument, protected _note: Note) {\r\n\t\t\tsuper(false);\r\n\t\t\tthis._oldStart = this._note.start;\r\n\t\t\tthis._oldEnd   = this._note.end;\r\n\t\t\tthis._newStart = this._note.start;\r\n\t\t\tthis._newEnd   = this._note.end;\r\n\t\t\tthis._oldPins = this._note.pins;\r\n\t\t\tthis._newPins = [];\r\n\t\t\tthis._oldPitches = this._note.pitches;\r\n\t\t\tthis._newPitches = [];\r\n\t\t}\r\n\t\t\r\n\t\tprotected _finishSetup(): void {\r\n\t\t\tfor (let i: number = 0; i < this._newPins.length - 1; ) {\r\n\t\t\t\tif (this._newPins[i].time >= this._newPins[i+1].time) {\r\n\t\t\t\t\tthis._newPins.splice(i, 1);\r\n\t\t\t\t} else {\r\n\t\t\t\t\ti++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tfor (let i: number = 1; i < this._newPins.length - 1; ) {\r\n\t\t\t\tif (this._newPins[i-1].interval == this._newPins[i].interval && \r\n\t\t\t\t    this._newPins[i].interval == this._newPins[i+1].interval && \r\n\t\t\t\t    this._newPins[i-1].volume == this._newPins[i].volume && \r\n\t\t\t\t    this._newPins[i].volume == this._newPins[i+1].volume)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis._newPins.splice(i, 1);\r\n\t\t\t\t} else {\r\n\t\t\t\t\ti++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tconst firstInterval: number = this._newPins[0].interval;\r\n\t\t\tconst firstTime: number = this._newPins[0].time;\r\n\t\t\tfor (let i: number = 0; i < this._oldPitches.length; i++) {\r\n\t\t\t\tthis._newPitches[i] = this._oldPitches[i] + firstInterval;\r\n\t\t\t}\r\n\t\t\tfor (let i: number = 0; i < this._newPins.length; i++) {\r\n\t\t\t\tthis._newPins[i].interval -= firstInterval;\r\n\t\t\t\tthis._newPins[i].time -= firstTime;\r\n\t\t\t}\r\n\t\t\tthis._newStart = this._oldStart + firstTime;\r\n\t\t\tthis._newEnd   = this._newStart + this._newPins[this._newPins.length-1].time;\r\n\t\t\t\r\n\t\t\tthis._doForwards();\r\n\t\t\tthis._didSomething();\r\n\t\t}\r\n\t\t\r\n\t\tprotected _doForwards(): void {\r\n\t\t\tthis._note.pins = this._newPins;\r\n\t\t\tthis._note.pitches = this._newPitches;\r\n\t\t\tthis._note.start = this._newStart;\r\n\t\t\tthis._note.end = this._newEnd;\r\n\t\t\tthis._doc.notifier.changed();\r\n\t\t}\r\n\t\t\r\n\t\tprotected _doBackwards(): void {\r\n\t\t\tthis._note.pins = this._oldPins;\r\n\t\t\tthis._note.pitches = this._oldPitches;\r\n\t\t\tthis._note.start = this._oldStart;\r\n\t\t\tthis._note.end = this._oldEnd;\r\n\t\t\tthis._doc.notifier.changed();\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeInstrumentType extends Change {\r\n\t\tconstructor(doc: SongDocument, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tconst oldValue: number = doc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].type;\r\n\t\t\tif (oldValue != newValue) {\r\n\t\t\t\tdoc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].type = newValue;\r\n\t\t\t\tif (newValue == InstrumentType.chip) {\r\n\t\t\t\t\t// This is technically not necessary, so long as there are\r\n\t\t\t\t\t// more chip waves than pwm waves, but might as well have\r\n\t\t\t\t\t// it here for safety.\r\n\t\t\t\t\tconst instrument: Instrument = doc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()];\r\n\t\t\t\t\tinstrument.wave = Math.max(0, Math.min(Config.waves.length - 1, instrument.wave));\r\n\t\t\t\t} else if (newValue == InstrumentType.pwm) {\r\n\t\t\t\t\t// When going from chip to pwm, if there are more chip\r\n\t\t\t\t\t// waves than pwm waves, .wave can be invalid.\r\n\t\t\t\t\tconst instrument: Instrument = doc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()];\r\n\t\t\t\t\tinstrument.wave = Math.max(0, Math.min(Config.pwmwaves.length - 1, instrument.wave));\r\n\t\t\t\t}\r\n\t\t\t\tdoc.notifier.changed();\r\n\t\t\t\tthis._didSomething();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeTransition extends Change {\r\n\t\tconstructor(doc: SongDocument, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tconst oldValue: number = doc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].transition;\r\n\t\t\tif (oldValue != newValue) {\r\n\t\t\t\tthis._didSomething();\r\n\t\t\t\tdoc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].transition = newValue;\r\n\t\t\t\tdoc.notifier.changed();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangePattern extends Change {\r\n\t\tconstructor(doc: SongDocument, public oldValue: number, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tif (newValue > doc.song.patternsPerChannel) throw new Error(\"invalid pattern\");\r\n\t\t\tdoc.song.channels[doc.channel].bars[doc.bar] = newValue;\r\n\t\t\tdoc.notifier.changed();\r\n\t\t\tif (oldValue != newValue) this._didSomething();\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeBarCount extends Change {\r\n\t\tconstructor(doc: SongDocument, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tif (doc.song.barCount != newValue) {\r\n\t\t\t\tfor (let channel: number = 0; channel < doc.song.getChannelCount(); channel++) {\r\n\t\t\t\t\tfor (let bar: number = doc.song.barCount; bar < newValue; bar++) {\r\n\t\t\t\t\t\tdoc.song.channels[channel].bars[bar] = 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdoc.song.channels[channel].bars.length = newValue;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tlet newBar: number = doc.bar;\r\n\t\t\t\tlet newBarScrollPos: number = doc.barScrollPos;\r\n\t\t\t\tlet newLoopStart: number = doc.song.loopStart;\r\n\t\t\t\tlet newLoopLength: number = doc.song.loopLength;\r\n\t\t\t\tif (doc.song.barCount > newValue) {\r\n\t\t\t\t\tnewBar = Math.min(newBar, newValue - 1);\r\n\t\t\t\t\tnewBarScrollPos = Math.max(0, Math.min(newValue - doc.trackVisibleBars, newBarScrollPos));\r\n\t\t\t\t\tnewLoopLength = Math.min(newValue, newLoopLength);\r\n\t\t\t\t\tnewLoopStart = Math.min(newValue - newLoopLength, newLoopStart);\r\n\t\t\t\t}\r\n\t\t\t\tdoc.bar = newBar;\r\n\t\t\t\tdoc.barScrollPos = newBarScrollPos;\r\n\t\t\t\tdoc.song.loopStart = newLoopStart;\r\n\t\t\t\tdoc.song.loopLength = newLoopLength;\r\n\t\t\t\tdoc.song.barCount = newValue;\r\n\t\t\t\tdoc.notifier.changed();\r\n\t\t\t\t\r\n\t\t\t\tthis._didSomething();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeInsertBars extends Change {\r\n\t\tconstructor(doc: SongDocument, start: number, count: number) {\r\n\t\t\tsuper();\r\n\t\t\t\r\n\t\t\tconst newLength: number = Math.min(Config.barCountMax, doc.song.barCount + count);\r\n\t\t\tcount = newLength - doc.song.barCount;\r\n\t\t\tif (count == 0) return;\r\n\t\t\t\r\n\t\t\tfor (const channel of doc.song.channels) {\r\n\t\t\t\twhile (channel.bars.length < newLength) {\r\n\t\t\t\t\tchannel.bars.splice(start, 0, 0);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tdoc.song.barCount = newLength;\r\n\t\t\t\r\n\t\t\tdoc.bar += count;\r\n\t\t\tdoc.barScrollPos += count;\r\n\t\t\tif (doc.song.loopStart >= start) {\r\n\t\t\t\tdoc.song.loopStart += count;\r\n\t\t\t} else if (doc.song.loopStart + doc.song.loopLength >= start) {\r\n\t\t\t\tdoc.song.loopLength += count;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tdoc.notifier.changed();\r\n\t\t\tthis._didSomething();\r\n\t\t}\r\n\t}\r\n\r\n\texport class ChangeDeleteBars extends Change {\r\n\t\tconstructor(doc: SongDocument, start: number, count: number) {\r\n\t\t\tsuper();\r\n\t\t\t\r\n\t\t\tfor (const channel of doc.song.channels) {\r\n\t\t\t\tchannel.bars.splice(start, count);\r\n\t\t\t\tif (channel.bars.length == 0) channel.bars.push(0);\r\n\t\t\t}\r\n\t\t\tdoc.song.barCount = Math.max(1, doc.song.barCount - count);\r\n\t\t\t\r\n\t\t\tdoc.bar = Math.max(0, doc.bar - count);\r\n\t\t\tdoc.barScrollPos = Math.max(0, doc.barScrollPos - count);\r\n\t\t\tif (doc.song.loopStart >= start) {\r\n\t\t\t\tdoc.song.loopStart = Math.max(0, doc.song.loopStart - count);\r\n\t\t\t} else if (doc.song.loopStart + doc.song.loopLength > start) {\r\n\t\t\t\tdoc.song.loopLength -= count;\r\n\t\t\t}\r\n\t\t\tdoc.song.loopLength = Math.max(1, Math.min(doc.song.barCount - doc.song.loopStart, doc.song.loopLength));\r\n\t\t\t\r\n\t\t\tdoc.notifier.changed();\r\n\t\t\tthis._didSomething();\r\n\t\t}\r\n\t}\r\n\r\n\texport class ChangeChannelCount extends Change {\r\n\t\tconstructor(doc: SongDocument, newPitchChannelCount: number, newDrumChannelCount: number) {\r\n\t\t\tsuper();\r\n\t\t\tif (doc.song.pitchChannelCount != newPitchChannelCount || doc.song.drumChannelCount != newDrumChannelCount) {\r\n\t\t\t\tconst newChannels: Channel[] = [];\r\n\t\t\t\t\r\n\t\t\t\tfor (let i: number = 0; i < newPitchChannelCount; i++) {\r\n\t\t\t\t\tconst channel = i;\r\n\t\t\t\t\tconst oldChannel = i;\r\n\t\t\t\t\tif (i < doc.song.pitchChannelCount) {\r\n\t\t\t\t\t\tnewChannels[channel] = doc.song.channels[oldChannel]\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tnewChannels[channel] = new Channel();\r\n\t\t\t\t\t\tnewChannels[channel].octave = 2;\r\n\t\t\t\t\t\tfor (let j: number = 0; j < doc.song.instrumentsPerChannel; j++) newChannels[channel].instruments[j] = new Instrument();\r\n\t\t\t\t\t\tfor (let j: number = 0; j < doc.song.patternsPerChannel; j++) newChannels[channel].patterns[j] = new Pattern();\r\n\t\t\t\t\t\tfor (let j: number = 0; j < doc.song.barCount; j++) newChannels[channel].bars[j] = 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor (let i: number = 0; i < newDrumChannelCount; i++) {\r\n\t\t\t\t\tconst channel = i + newPitchChannelCount;\r\n\t\t\t\t\tconst oldChannel = i + doc.song.pitchChannelCount;\r\n\t\t\t\t\tif (i < doc.song.drumChannelCount) {\r\n\t\t\t\t\t\tnewChannels[channel] = doc.song.channels[oldChannel]\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tnewChannels[channel] = new Channel();\r\n\t\t\t\t\t\tnewChannels[channel].octave = 0;\r\n\t\t\t\t\t\tfor (let j: number = 0; j < doc.song.instrumentsPerChannel; j++) newChannels[channel].instruments[j] = new Instrument();\r\n\t\t\t\t\t\tfor (let j: number = 0; j < doc.song.patternsPerChannel; j++) newChannels[channel].patterns[j] = new Pattern();\r\n\t\t\t\t\t\tfor (let j: number = 0; j < doc.song.barCount; j++) newChannels[channel].bars[j] = 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tdoc.song.pitchChannelCount = newPitchChannelCount;\r\n\t\t\t\tdoc.song.drumChannelCount = newDrumChannelCount;\r\n\t\t\t\tfor (let channel: number = 0; channel < doc.song.getChannelCount(); channel++) {\r\n\t\t\t\t\tdoc.song.channels[channel] = newChannels[channel];\r\n\t\t\t\t}\r\n\t\t\t\tdoc.song.channels.length = doc.song.getChannelCount();\r\n\t\t\t\t\r\n\t\t\t\tdoc.channel = Math.min(doc.channel, newPitchChannelCount + newDrumChannelCount - 1);\r\n\t\t\t\tdoc.notifier.changed();\r\n\t\t\t\t\r\n\t\t\t\tthis._didSomething();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeBeatsPerBar extends Change {\r\n\t\tconstructor(doc: SongDocument, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tif (doc.song.beatsPerBar != newValue) {\r\n\t\t\t\tif (doc.song.beatsPerBar > newValue) {\r\n\t\t\t\t\tconst sequence: ChangeSequence = new ChangeSequence();\r\n\t\t\t\t\tfor (let i: number = 0; i < doc.song.getChannelCount(); i++) {\r\n\t\t\t\t\t\tfor (let j: number = 0; j < doc.song.channels[i].patterns.length; j++) {\r\n\t\t\t\t\t\t\tsequence.append(new ChangeNoteTruncate(doc, doc.song.channels[i].patterns[j], newValue * doc.song.partsPerBeat, doc.song.beatsPerBar * doc.song.partsPerBeat));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tdoc.song.beatsPerBar = newValue;\r\n\t\t\t\tdoc.notifier.changed();\r\n\t\t\t\tthis._didSomething();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeChannelOrder extends Change {\r\n\t\tconstructor(doc: SongDocument, selectionMin: number, selectionMax: number, offset: number) {\r\n\t\t\tsuper();\r\n\t\t\tdoc.song.channels.splice(selectionMin + offset, 0, ...doc.song.channels.splice(selectionMin, selectionMax - selectionMin + 1));\r\n\t\t\tdoc.notifier.changed();\r\n\t\t\tthis._didSomething();\r\n\t\t}\r\n\t}\r\n\r\n\texport class ChangeAddChannel extends ChangeGroup {\r\n\t\tconstructor(doc: SongDocument, index: number, isNoise: boolean) {\r\n\t\t\tsuper();\r\n\t\t\tconst newPitchChannelCount: number = doc.song.pitchChannelCount + (isNoise ? 0 : 1);\r\n\t\t\tconst newNoiseChannelCount: number = doc.song.drumChannelCount + (isNoise ? 1 : 0);\r\n\t\t\tif (newPitchChannelCount <= Config.pitchChannelCountMax && newNoiseChannelCount <= Config.drumChannelCountMax) {\r\n\t\t\t\tconst addedChannelIndex: number = isNoise ? doc.song.pitchChannelCount + doc.song.drumChannelCount : doc.song.pitchChannelCount;\r\n\t\t\t\tthis.append(new ChangeChannelCount(doc, newPitchChannelCount, newNoiseChannelCount));\r\n\t\t\t\tthis.append(new ChangeChannelOrder(doc, index, addedChannelIndex - 1, 1));\r\n\t\t\t}\r\n\t\t\tdoc.notifier.changed();\r\n\t\t\tthis._didSomething();\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeRemoveChannel extends ChangeGroup {\r\n\t\tconstructor(doc: SongDocument, minIndex: number, maxIndex: number) {\r\n\t\t\tsuper();\r\n\t\t\twhile (maxIndex >= minIndex) {\r\n\t\t\t\tconst isNoise: boolean = doc.song.getChannelIsDrum(maxIndex);\r\n\t\t\t\tdoc.song.channels.splice(maxIndex, 1);\r\n\t\t\t\tif (isNoise) {\r\n\t\t\t\t\tdoc.song.drumChannelCount--;\r\n\t\t\t\t} else {\r\n\t\t\t\t\t\tdoc.song.pitchChannelCount--;\r\n\t\t\t\t}\r\n\t\t\t\tmaxIndex--;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (doc.song.pitchChannelCount < Config.pitchChannelCountMin) {\r\n\t\t\t\tthis.append(new ChangeChannelCount(doc, Config.pitchChannelCountMin, doc.song.drumChannelCount));\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.append(new ChangeChannelBar(doc, Math.max(0, minIndex - 1), doc.bar));\r\n\t\t\t\r\n\t\t\tthis._didSomething();\r\n\t\t\tdoc.notifier.changed();\r\n\t\t}\r\n\t}\r\n\r\n\texport class ChangeChannelBar extends Change {\r\n\t\tconstructor(doc: SongDocument, newChannel: number, newBar: number) {\r\n\t\t\tsuper();\r\n\t\t\tconst oldChannel: number = doc.channel;\r\n\t\t\tconst oldBar: number = doc.bar;\r\n\t\t\tdoc.channel = newChannel;\r\n\t\t\tdoc.bar = newBar;\r\n\t\t\tdoc.barScrollPos = Math.min(doc.bar, Math.max(doc.bar - (doc.trackVisibleBars - 1), doc.barScrollPos));\r\n\t\t\tdoc.notifier.changed();\r\n\t\t\tif (oldChannel != newChannel || oldBar != newBar) {\r\n\t\t\t\tthis._didSomething();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeChorus extends Change {\r\n\t\tconstructor(doc: SongDocument, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tconst oldValue: number = doc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].chorus;\r\n\t\t\tif (oldValue != newValue) {\r\n\t\t\t\tthis._didSomething();\r\n\t\t\t\tdoc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].chorus = newValue;\r\n\t\t\t\tdoc.notifier.changed();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeEffect extends Change {\r\n\t\tconstructor(doc: SongDocument, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tconst oldValue: number = doc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].effect;\r\n\t\t\tif (oldValue != newValue) {\r\n\t\t\t\tdoc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].effect = newValue;\r\n\t\t\t\tdoc.notifier.changed();\r\n\t\t\t\tthis._didSomething();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeHarm extends Change {\r\n\t\tconstructor(doc: SongDocument, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tconst oldValue: number = doc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].harm;\r\n\t\t\tif (oldValue != newValue) {\r\n\t\t\t\tdoc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].harm = newValue;\r\n\t\t\t\tdoc.notifier.changed();\r\n\t\t\t\tthis._didSomething();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\texport class ChangeFMChorus extends Change {\r\n\t\tconstructor(doc: SongDocument, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tconst oldValue: number = doc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].fmChorus;\r\n\t\t\tif (oldValue != newValue) {\r\n\t\t\t\tdoc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].fmChorus = newValue;\r\n\t\t\t\tdoc.notifier.changed();\r\n\t\t\t\tthis._didSomething();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeOctoff extends Change {\r\n\t\tconstructor(doc: SongDocument, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tconst oldValue: number = doc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].octoff;\r\n\t\t\tif (oldValue != newValue) {\r\n\t\t\t\tdoc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].octoff = newValue;\r\n\t\t\t\tdoc.notifier.changed();\r\n\t\t\t\tthis._didSomething();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeImute extends Change {\r\n\t\tconstructor(doc: SongDocument, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tconst oldValue: number = doc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].imute;\r\n\t\t\tif (oldValue != newValue) {\r\n\t\t\t\tdoc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].imute = newValue;\r\n\t\t\t\tdoc.notifier.changed();\r\n\t\t\t\tthis._didSomething();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\texport class ChangeAllImute extends Change {\r\n\t\tconstructor(doc: SongDocument, newValue: number, index: number) {\r\n\t\t\tsuper();\r\n\t\t\tconst oldValue: number = doc.song.channels[doc.channel].instruments[index].imute;\r\n\t\t\tif (oldValue != newValue) {\r\n\t\t\t\tdoc.song.channels[doc.channel].instruments[index].imute = newValue;\r\n\t\t\t\tdoc.notifier.changed();\r\n\t\t\t\tthis._didSomething();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\texport class ChangeSoloChannels extends Change {\r\n\t\tconstructor(doc: SongDocument, newValue: number, curChannel: number, curInstrument: number) {\r\n\t\t\tsuper();\r\n\t\t\tconst oldValue: number = doc.song.channels[curChannel].instruments[curInstrument].imute;\r\n\t\t\tif (oldValue != newValue) {\r\n\t\t\t\tdoc.song.channels[curChannel].instruments[curInstrument].imute = newValue;\r\n\t\t\t\tdoc.notifier.changed();\r\n\t\t\t\tthis._didSomething();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeIpan extends Change {\r\n\t\tconstructor(doc: SongDocument, oldValue: number, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tif (oldValue != newValue) {\r\n\t\t\t\tdoc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].ipan = newValue;\r\n\t\t\t\tdoc.notifier.changed();\r\n\t\t\t\tthis._didSomething();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeFilter extends Change {\r\n\t\tconstructor(doc: SongDocument, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tconst oldValue: number = doc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].filter;\r\n\t\t\tif (oldValue != newValue) {\r\n\t\t\t\tdoc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].filter = newValue;\r\n\t\t\t\tdoc.notifier.changed();\r\n\t\t\t\tthis._didSomething();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeAlgorithm extends Change {\r\n\t\tconstructor(doc: SongDocument, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tconst oldValue: number = doc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].algorithm;\r\n\t\t\tif (oldValue != newValue) {\r\n\t\t\t\tdoc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].algorithm = newValue;\r\n\t\t\t\tdoc.notifier.changed();\r\n\t\t\t\tthis._didSomething();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeFeedbackType extends Change {\r\n\t\tconstructor(doc: SongDocument, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tconst oldValue: number = doc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].feedbackType;\r\n\t\t\tif (oldValue != newValue) {\r\n\t\t\t\tdoc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].feedbackType = newValue;\r\n\t\t\t\tdoc.notifier.changed();\r\n\t\t\t\tthis._didSomething();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeFeedbackEnvelope extends Change {\r\n\t\tconstructor(doc: SongDocument, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tconst oldValue: number = doc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].feedbackEnvelope;\r\n\t\t\tif (oldValue != newValue) {\r\n\t\t\t\tdoc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].feedbackEnvelope = newValue;\r\n\t\t\t\tdoc.notifier.changed();\r\n\t\t\t\tthis._didSomething();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeOperatorEnvelope extends Change {\r\n\t\tconstructor(doc: SongDocument, operatorIndex: number, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tconst oldValue: number = doc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].operators[operatorIndex].envelope;\r\n\t\t\tif (oldValue != newValue) {\r\n\t\t\t\tdoc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].operators[operatorIndex].envelope = newValue;\r\n\t\t\t\tdoc.notifier.changed();\r\n\t\t\t\tthis._didSomething();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeOperatorFrequency extends Change {\r\n\t\tconstructor(doc: SongDocument, operatorIndex: number, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tconst oldValue: number = doc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].operators[operatorIndex].frequency;\r\n\t\t\tif (oldValue != newValue) {\r\n\t\t\t\tdoc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].operators[operatorIndex].frequency = newValue;\r\n\t\t\t\tdoc.notifier.changed();\r\n\t\t\t\tthis._didSomething();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeOperatorAmplitude extends Change {\r\n\t\tconstructor(doc: SongDocument, operatorIndex: number, oldValue: number, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tdoc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].operators[operatorIndex].amplitude = newValue;\r\n\t\t\tdoc.notifier.changed();\r\n\t\t\tif (oldValue != newValue) this._didSomething();\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeFeedbackAmplitude extends Change {\r\n\t\tconstructor(doc: SongDocument, oldValue: number, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tdoc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].feedbackAmplitude = newValue;\r\n\t\t\tdoc.notifier.changed();\r\n\t\t\tif (oldValue != newValue) this._didSomething();\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeInstrumentsPerChannel extends Change {\r\n\t\tconstructor(doc: SongDocument, newInstrumentsPerChannel: number) {\r\n\t\t\tsuper();\r\n\t\t\tif (doc.song.instrumentsPerChannel != newInstrumentsPerChannel) {\r\n\t\t\t\tfor (let channel: number = 0; channel < doc.song.getChannelCount(); channel++) {\r\n\t\t\t\t\tconst sampleInstrument: Instrument = doc.song.channels[channel].instruments[doc.song.instrumentsPerChannel - 1];\r\n\t\t\t\t\tfor (let j: number = doc.song.instrumentsPerChannel; j < newInstrumentsPerChannel; j++) {\r\n\t\t\t\t\t\tconst newInstrument: Instrument = new Instrument();\r\n\t\t\t\t\t\tnewInstrument.copy(sampleInstrument);\r\n\t\t\t\t\t\tdoc.song.channels[channel].instruments[j] = newInstrument;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdoc.song.channels[channel].instruments.length = newInstrumentsPerChannel;\r\n\t\t\t\t\tfor (let j: number = 0; j < doc.song.patternsPerChannel; j++) {\r\n\t\t\t\t\t\tif (doc.song.channels[channel].patterns[j].instrument >= newInstrumentsPerChannel) {\r\n\t\t\t\t\t\t\tdoc.song.channels[channel].patterns[j].instrument = 0;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tdoc.song.instrumentsPerChannel = newInstrumentsPerChannel;\r\n\t\t\t\tdoc.notifier.changed();\r\n\t\t\t\tthis._didSomething();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeKey extends Change {\r\n\t\tconstructor(doc: SongDocument, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tif (doc.song.key != newValue) {\r\n\t\t\t\tdoc.song.key = newValue;\r\n\t\t\t\tdoc.notifier.changed();\r\n\t\t\t\tthis._didSomething();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeSongTheme extends Change {\r\n\t\tconstructor(doc: SongDocument, oldValue: string, newValue: string) {\r\n\t\t\tsuper();\r\n\t\t\tif (newValue.length > 30) {\r\n\t\t\t\tnewValue = newValue.substring(0, 30);\r\n\t\t\t}\r\n\r\n\t\t\tdoc.song.setSongTheme = newValue;\r\n\t\t\tdoc.notifier.changed();\r\n\t\t\tif (oldValue != newValue) this._didSomething();\r\n\t\t}\r\n\t}\r\n\r\n\texport class ChangeLoop extends Change {\r\n\t\tconstructor(private _doc: SongDocument, public oldStart: number, public oldLength: number, public newStart: number, public newLength: number) {\r\n\t\t\tsuper();\r\n\t\t\tthis._doc.song.loopStart = this.newStart;\r\n\t\t\tthis._doc.song.loopLength = this.newLength;\r\n\t\t\tthis._doc.notifier.changed();\r\n\t\t\tif (this.oldStart != this.newStart || this.oldLength != this.newLength) {\r\n\t\t\t\tthis._didSomething();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangePitchAdded extends UndoableChange {\r\n\t\tprivate _doc: SongDocument;\r\n\t\tprivate _note: Note;\r\n\t\tprivate _pitch: number;\r\n\t\tprivate _index: number;\r\n\t\tconstructor(doc: SongDocument, note: Note, pitch: number, index: number, deletion: boolean = false) {\r\n\t\t\tsuper(deletion);\r\n\t\t\tthis._doc = doc;\r\n\t\t\tthis._note = note;\r\n\t\t\tthis._pitch = pitch;\r\n\t\t\tthis._index = index;\r\n\t\t\tthis._didSomething();\r\n\t\t\tthis.redo();\r\n\t\t}\r\n\t\t\r\n\t\tprotected _doForwards(): void {\r\n\t\t\tthis._note.pitches.splice(this._index, 0, this._pitch);\r\n\t\t\tthis._doc.notifier.changed();\r\n\t\t}\r\n\t\t\r\n\t\tprotected _doBackwards(): void {\r\n\t\t\tthis._note.pitches.splice(this._index, 1);\r\n\t\t\tthis._doc.notifier.changed();\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeOctave extends Change {\r\n\t\tconstructor(doc: SongDocument, public oldValue: number, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tdoc.song.channels[doc.channel].octave = newValue;\r\n\t\t\tdoc.notifier.changed();\r\n\t\t\tif (oldValue != newValue) this._didSomething();\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangePartsPerBeat extends ChangeGroup {\r\n\t\tconstructor(doc: SongDocument, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tif (doc.song.partsPerBeat != newValue) {\r\n\t\t\t\tfor (let i: number = 0; i < doc.song.getChannelCount(); i++) {\r\n\t\t\t\t\tfor (let j: number = 0; j < doc.song.channels[i].patterns.length; j++) {\r\n\t\t\t\t\t\tthis.append(new ChangeRhythm(doc, doc.song.channels[i].patterns[j], doc.song.partsPerBeat, newValue));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tdoc.song.partsPerBeat = newValue;\r\n\t\t\t\tdoc.notifier.changed();\r\n\t\t\t\tthis._didSomething();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangePaste extends ChangeGroup {\r\n\t\tconstructor(doc: SongDocument, pattern: Pattern, notes: Note[], newBeatsPerBar: number, newPartsPerBeat: number) {\r\n\t\t\tsuper();\r\n\t\t\tpattern.notes = notes;\r\n\t\t\t\r\n\t\t\tif (doc.song.partsPerBeat != newPartsPerBeat) {\r\n\t\t\t\tthis.append(new ChangeRhythm(doc, pattern, newPartsPerBeat, doc.song.partsPerBeat));\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (doc.song.beatsPerBar != newBeatsPerBar) {\r\n\t\t\t\tthis.append(new ChangeNoteTruncate(doc, pattern, doc.song.beatsPerBar * doc.song.partsPerBeat, newBeatsPerBar * doc.song.partsPerBeat));\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tdoc.notifier.changed();\r\n\t\t\tthis._didSomething();\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangePatternInstrument extends Change {\r\n\t\tconstructor(doc: SongDocument, newValue: number, pattern: Pattern) {\r\n\t\t\tsuper();\r\n\t\t\tif (pattern.instrument != newValue) {\r\n\t\t\t\tpattern.instrument = newValue;\r\n\t\t\t\tdoc.notifier.changed();\r\n\t\t\t\tthis._didSomething();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangePatternsPerChannel extends Change {\r\n\t\tconstructor(doc: SongDocument, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tif (doc.song.patternsPerChannel != newValue) {\r\n\t\t\t\tfor (let i: number = 0; i < doc.song.getChannelCount(); i++) {\r\n\t\t\t\t\tconst channelBars: number[] = doc.song.channels[i].bars;\r\n\t\t\t\t\tconst channelPatterns: Pattern[] = doc.song.channels[i].patterns;\r\n\t\t\t\t\tfor (let j: number = 0; j < channelBars.length; j++) {\r\n\t\t\t\t\t\tif (channelBars[j] > newValue) channelBars[j] = 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfor (let j: number = channelPatterns.length; j < newValue; j++) {\r\n\t\t\t\t\t\tchannelPatterns[j] = new Pattern();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tchannelPatterns.length = newValue;\r\n\t\t\t\t}\r\n\t\t\t\tdoc.song.patternsPerChannel = newValue;\r\n\t\t\t\tdoc.notifier.changed();\r\n\t\t\t\tthis._didSomething();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeEnsurePatternExists extends UndoableChange {\r\n\t\tprivate _doc: SongDocument;\r\n\t\tprivate _bar: number;\r\n\t\tprivate _channel: number;\r\n\t\tprivate _patternIndex: number;\r\n\t\tprivate _patternOldNotes: Note[] | null = null;\r\n\t\tprivate _oldPatternCount: number;\r\n\t\tprivate _newPatternCount: number;\r\n\r\n\t\tconstructor(doc: SongDocument) {\r\n\t\t\tsuper(false);\r\n\t\t\tconst song: Song = doc.song;\r\n\t\t\tif (song.channels[doc.channel].bars[doc.bar] != 0) return;\r\n\r\n\t\t\tthis._doc = doc;\r\n\t\t\tthis._bar = doc.bar;\r\n\t\t\tthis._channel = doc.channel;\r\n\t\t\tthis._oldPatternCount = song.patternsPerChannel;\r\n\t\t\tthis._newPatternCount = song.patternsPerChannel;\r\n\r\n\t\t\tlet firstEmptyUnusedIndex: number | null = null;\r\n\t\t\tlet firstUnusedIndex: number | null = null;\r\n\t\t\tfor (let patternIndex: number = 1; patternIndex <= song.patternsPerChannel; patternIndex++) {\r\n\t\t\t\tlet used = false;\r\n\t\t\t\tfor (let barIndex: number = 0; barIndex < song.barCount; barIndex++) {\r\n\t\t\t\t\tif (song.channels[doc.channel].bars[barIndex] == patternIndex) {\r\n\t\t\t\t\t\tused = true;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (used) continue;\r\n\t\t\t\tif (firstUnusedIndex == null) {\r\n\t\t\t\t\tfirstUnusedIndex = patternIndex;\r\n\t\t\t\t}\r\n\t\t\t\tconst pattern: Pattern = song.channels[doc.channel].patterns[patternIndex - 1];\r\n\t\t\t\tif (pattern.notes.length == 0) {\r\n\t\t\t\t\tfirstEmptyUnusedIndex = patternIndex;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (firstEmptyUnusedIndex != null) {\r\n\t\t\t\tthis._patternIndex = firstEmptyUnusedIndex;\r\n\t\t\t} else if (song.patternsPerChannel < song.barCount) {\r\n\t\t\t\tthis._newPatternCount = song.patternsPerChannel + 1;\r\n\t\t\t\tthis._patternIndex = song.patternsPerChannel + 1;\r\n\t\t\t} else if (firstUnusedIndex != null) {\r\n\t\t\t\tthis._patternIndex = firstUnusedIndex;\r\n\t\t\t\tthis._patternOldNotes = song.channels[doc.channel].patterns[firstUnusedIndex - 1].notes;\r\n\t\t\t} else {\r\n\t\t\t\tthrow new Error();\r\n\t\t\t}\r\n\r\n\t\t\tthis._didSomething();\r\n\t\t\tthis._doForwards();\r\n\t\t}\r\n\r\n\t\tprotected _doForwards(): void {\r\n\t\t\tconst song: Song = this._doc.song;\r\n\t\t\tfor (let j: number = song.patternsPerChannel; j < this._newPatternCount; j++) {\r\n\t\t\t\tfor (let i: number = 0; i < song.getChannelCount(); i++) {\r\n\t\t\t\t\tsong.channels[i].patterns[j] = new Pattern();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tsong.patternsPerChannel = this._newPatternCount;\r\n\t\t\tconst pattern: Pattern = song.channels[this._channel].patterns[this._patternIndex - 1];\r\n\t\t\tpattern.notes = [];\r\n\t\t\tsong.channels[this._channel].bars[this._bar] = this._patternIndex;\r\n\t\t\tthis._doc.notifier.changed();\r\n\t\t}\r\n\r\n\t\tprotected _doBackwards(): void {\r\n\t\t\tconst song: Song = this._doc.song;\r\n\t\t\tconst pattern: Pattern = song.channels[this._channel].patterns[this._patternIndex - 1];\r\n\t\t\tif (this._patternOldNotes != null) pattern.notes = this._patternOldNotes;\r\n\t\t\tsong.channels[this._channel].bars[this._bar] = 0;\r\n\t\t\tfor (let i: number = 0; i < song.getChannelCount(); i++) {\r\n\t\t\t\tsong.channels[i].patterns.length = this._oldPatternCount;\r\n\t\t\t}\r\n\t\t\tsong.patternsPerChannel = this._oldPatternCount;\r\n\t\t\tthis._doc.notifier.changed();\r\n\t\t}\r\n\t}\r\n\r\n\texport class ChangePinTime extends ChangePins {\r\n\t\tconstructor(doc: SongDocument, note: Note, pinIndex: number, shiftedTime: number) {\r\n\t\t\tsuper(doc, note);\r\n\t\t\t\r\n\t\t\tshiftedTime -= this._oldStart;\r\n\t\t\tconst originalTime: number = this._oldPins[pinIndex].time;\r\n\t\t\tconst skipStart: number = Math.min(originalTime, shiftedTime);\r\n\t\t\tconst skipEnd: number = Math.max(originalTime, shiftedTime);\r\n\t\t\tlet setPin: boolean = false;\r\n\t\t\tfor (let i: number = 0; i < this._oldPins.length; i++) {\r\n\t\t\t\tconst oldPin: NotePin = note.pins[i];\r\n\t\t\t\tconst time: number = oldPin.time;\r\n\t\t\t\tif (time < skipStart) {\r\n\t\t\t\t\tthis._newPins.push(makeNotePin(oldPin.interval, time, oldPin.volume));\r\n\t\t\t\t} else if (time > skipEnd) {\r\n\t\t\t\t\tif (!setPin) {\r\n\t\t\t\t\t\tthis._newPins.push(makeNotePin(this._oldPins[pinIndex].interval, shiftedTime, this._oldPins[pinIndex].volume));\r\n\t\t\t\t\t\tsetPin = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis._newPins.push(makeNotePin(oldPin.interval, time, oldPin.volume));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (!setPin) {\r\n\t\t\t\tthis._newPins.push(makeNotePin(this._oldPins[pinIndex].interval, shiftedTime, this._oldPins[pinIndex].volume));\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._finishSetup();\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangePitchBend extends ChangePins {\r\n\t\tconstructor(doc: SongDocument, note: Note, bendStart: number, bendEnd: number, bendTo: number, pitchIndex: number) {\r\n\t\t\tsuper(doc, note);\r\n\t\t\t\r\n\t\t\tbendStart -= this._oldStart;\r\n\t\t\tbendEnd   -= this._oldStart;\r\n\t\t\tbendTo    -= note.pitches[pitchIndex];\r\n\t\t\t\r\n\t\t\tlet setStart: boolean = false;\r\n\t\t\tlet setEnd: boolean   = false;\r\n\t\t\tlet prevInterval: number = 0;\r\n\t\t\tlet prevVolume: number = 3;\r\n\t\t\tlet persist: boolean = true;\r\n\t\t\tlet i: number;\r\n\t\t\tlet direction: number;\r\n\t\t\tlet stop: number;\r\n\t\t\tlet push: (item: NotePin)=>void;\r\n\t\t\tif (bendEnd > bendStart) {\r\n\t\t\t\ti = 0;\r\n\t\t\t\tdirection = 1;\r\n\t\t\t\tstop = note.pins.length;\r\n\t\t\t\tpush = (item: NotePin)=>{ this._newPins.push(item); };\r\n\t\t\t} else {\r\n\t\t\t\ti = note.pins.length - 1;\r\n\t\t\t\tdirection = -1;\r\n\t\t\t\tstop = -1;\r\n\t\t\t\tpush = (item: NotePin)=>{ this._newPins.unshift(item); };\r\n\t\t\t}\r\n\t\t\tfor (; i != stop; i += direction) {\r\n\t\t\t\tconst oldPin: NotePin = note.pins[i];\r\n\t\t\t\tconst time: number = oldPin.time;\r\n\t\t\t\tfor (;;) {\r\n\t\t\t\t\tif (!setStart) {\r\n\t\t\t\t\t\tif (time * direction <= bendStart * direction) {\r\n\t\t\t\t\t\t\tprevInterval = oldPin.interval;\r\n\t\t\t\t\t\t\tprevVolume = oldPin.volume;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (time * direction < bendStart * direction) {\r\n\t\t\t\t\t\t\tpush(makeNotePin(oldPin.interval, time, oldPin.volume));\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tpush(makeNotePin(prevInterval, bendStart, prevVolume));\r\n\t\t\t\t\t\t\tsetStart = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if (!setEnd) {\r\n\t\t\t\t\t\tif (time * direction <= bendEnd * direction) {\r\n\t\t\t\t\t\t\tprevInterval = oldPin.interval;\r\n\t\t\t\t\t\t\tprevVolume = oldPin.volume;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (time * direction < bendEnd * direction) {\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tpush(makeNotePin(bendTo, bendEnd, prevVolume));\r\n\t\t\t\t\t\t\tsetEnd = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (time * direction == bendEnd * direction) {\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tif (oldPin.interval != prevInterval) persist = false;\r\n\t\t\t\t\t\t\tpush(makeNotePin(persist ? bendTo : oldPin.interval, time, oldPin.volume));\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (!setEnd) {\r\n\t\t\t\tpush(makeNotePin(bendTo, bendEnd, prevVolume));\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._finishSetup();\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeRhythm extends ChangeSequence {\r\n\t\tconstructor(doc: SongDocument, bar: Pattern, oldPartsPerBeat: number, newPartsPerBeat: number) {\r\n\t\t\tsuper();\r\n\t\t\tlet changeRhythm: (oldTime:number)=>number;\r\n\t\t\t\r\n\t\t\tif (oldPartsPerBeat > newPartsPerBeat) {\r\n\t\t\t\tchangeRhythm = (oldTime: number)=> Math.ceil(oldTime * newPartsPerBeat / oldPartsPerBeat);\r\n\t\t\t} else if (oldPartsPerBeat < newPartsPerBeat) {\r\n\t\t\t\tchangeRhythm = (oldTime: number)=> Math.floor(oldTime * newPartsPerBeat / oldPartsPerBeat);\r\n\t\t\t} else {\r\n\t\t\t\tthrow new Error(\"ChangeRhythm couldn't handle rhythm change from \" + oldPartsPerBeat + \" to \" + newPartsPerBeat + \".\");\r\n\t\t\t}\r\n\t\t\tlet i: number = 0;\r\n\t\t\twhile (i < bar.notes.length) {\r\n\t\t\t\tconst note: Note = bar.notes[i];\r\n\t\t\t\tif (changeRhythm(note.start) >= changeRhythm(note.end)) {\r\n\t\t\t\t\tthis.append(new ChangeNoteAdded(doc, bar, note, i, true));\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.append(new ChangeRhythmNote(doc, note, changeRhythm));\r\n\t\t\t\t\ti++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeRhythmNote extends ChangePins {\r\n\t\tconstructor(doc: SongDocument, note: Note, changeRhythm: (oldTime:number)=>number) {\r\n\t\t\tsuper(doc, note);\r\n\t\t\t\r\n\t\t\tfor (const oldPin of this._oldPins) {\r\n\t\t\t\tthis._newPins.push(makeNotePin(oldPin.interval, changeRhythm(oldPin.time + this._oldStart) - this._oldStart, oldPin.volume));\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._finishSetup();\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeScale extends Change {\r\n\t\tconstructor(doc: SongDocument, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tif (doc.song.scale != newValue) {\r\n\t\t\t\tdoc.song.scale = newValue;\r\n\t\t\t\tdoc.notifier.changed();\r\n\t\t\t\tthis._didSomething();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeMix extends Change {\r\n\t\tconstructor(doc: SongDocument, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tif (doc.song.mix != newValue) {\r\n\t\t\t\tdoc.song.mix = newValue;\r\n\t\t\t\tdoc.notifier.changed();\r\n\t\t\t\tthis._didSomething();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeSampleRate extends Change {\r\n\t\tconstructor(doc: SongDocument, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tif (doc.song.sampleRate != newValue) {\r\n\t\t\t\tdoc.song.sampleRate = newValue;\r\n\t\t\t\tdoc.notifier.changed();\r\n\t\t\t\tthis._didSomething();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeSong extends Change {\r\n\t\tconstructor(doc: SongDocument, newHash: string) {\r\n\t\t\tsuper();\r\n\t\t\tdoc.song.fromBase64String(newHash);\r\n\t\t\tdoc.channel = Math.min(doc.channel, doc.song.getChannelCount() - 1);\r\n\t\t\tdoc.bar = Math.max(0, Math.min(doc.song.barCount - 1, doc.bar));\r\n\t\t\tdoc.barScrollPos = Math.max(0, Math.min(doc.song.barCount - doc.trackVisibleBars, doc.barScrollPos));\r\n\t\t\tdoc.barScrollPos = Math.min(doc.bar, Math.max(doc.bar - (doc.trackVisibleBars - 1), doc.barScrollPos));\r\n\t\t\tdoc.notifier.changed();\r\n\t\t\tthis._didSomething();\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeTempo extends Change {\r\n\t\tconstructor(doc: SongDocument, oldValue: number, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tdoc.song.tempo = newValue;\r\n\t\t\tdoc.notifier.changed();\r\n\t\t\tif (oldValue != newValue) this._didSomething();\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeReverb extends Change {\r\n\t\tconstructor(doc: SongDocument, oldValue: number, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tdoc.song.reverb = newValue;\r\n\t\t\tdoc.notifier.changed();\r\n\t\t\tif (oldValue != newValue) this._didSomething();\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeBlend extends Change {\r\n\t\tconstructor(doc: SongDocument, oldValue: number, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tdoc.song.blend = newValue;\r\n\t\t\tdoc.notifier.changed();\r\n\t\t\tif (oldValue != newValue) this._didSomething();\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeRiff extends Change {\r\n\t\tconstructor(doc: SongDocument, oldValue: number, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tdoc.song.riff = newValue;\r\n\t\t\tdoc.notifier.changed();\r\n\t\t\tif (oldValue != newValue) this._didSomething();\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeDetune extends Change {\r\n\t\tconstructor(doc: SongDocument, oldValue: number, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tdoc.song.detune = newValue;\r\n\t\t\tdoc.notifier.changed();\r\n\t\t\tif (oldValue != newValue) this._didSomething();\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeMuff extends Change {\r\n\t\tconstructor(doc: SongDocument, oldValue: number, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tdoc.song.muff = newValue;\r\n\t\t\tdoc.notifier.changed();\r\n\t\t\tif (oldValue != newValue) this._didSomething();\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeNoteAdded extends UndoableChange {\r\n\t\tprivate _doc: SongDocument;\r\n\t\tprivate _pattern: Pattern;\r\n\t\tprivate _note: Note;\r\n\t\tprivate _index: number;\r\n\t\tconstructor(doc: SongDocument, pattern: Pattern, note: Note, index: number, deletion: boolean = false) {\r\n\t\t\tsuper(deletion);\r\n\t\t\tthis._doc = doc;\r\n\t\t\tthis._pattern = pattern;\r\n\t\t\tthis._note = note;\r\n\t\t\tthis._index = index;\r\n\t\t\tthis._didSomething();\r\n\t\t\tthis.redo();\r\n\t\t}\r\n\t\t\r\n\t\tprotected _doForwards(): void {\r\n\t\t\tthis._pattern.notes.splice(this._index, 0, this._note);\r\n\t\t\tthis._doc.notifier.changed();\r\n\t\t}\r\n\t\t\r\n\t\tprotected _doBackwards(): void {\r\n\t\t\tthis._pattern.notes.splice(this._index, 1);\r\n\t\t\tthis._doc.notifier.changed();\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeNoteLength extends ChangePins {\r\n\t\tconstructor(doc: SongDocument, note: Note, truncStart: number, truncEnd: number) {\r\n\t\t\tsuper(doc, note);\r\n\t\t\t\r\n\t\t\ttruncStart -= this._oldStart;\r\n\t\t\ttruncEnd   -= this._oldStart;\r\n\t\t\tlet setStart: boolean = false;\r\n\t\t\tlet prevVolume: number = this._oldPins[0].volume;\r\n\t\t\tlet prevInterval: number = this._oldPins[0].interval;\r\n\t\t\tlet pushLastPin: boolean = true;\r\n\t\t\tlet i: number;\r\n\t\t\tfor (i = 0; i < this._oldPins.length; i++) {\r\n\t\t\t\tconst oldPin: NotePin = this._oldPins[i];\r\n\t\t\t\tif (oldPin.time < truncStart) {\r\n\t\t\t\t\tprevVolume = oldPin.volume;\r\n\t\t\t\t\tprevInterval = oldPin.interval;\r\n\t\t\t\t} else if (oldPin.time <= truncEnd) {\r\n\t\t\t\t\tif (oldPin.time > truncStart && !setStart) {\r\n\t\t\t\t\t\tthis._newPins.push(makeNotePin(prevInterval, truncStart, prevVolume));\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis._newPins.push(makeNotePin(oldPin.interval, oldPin.time, oldPin.volume));\r\n\t\t\t\t\tsetStart = true;\r\n\t\t\t\t\tif (oldPin.time == truncEnd) {\r\n\t\t\t\t\t\tpushLastPin = false;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t} \r\n\t\t\t\t\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (pushLastPin) this._newPins.push(makeNotePin(this._oldPins[i].interval, truncEnd, this._oldPins[i].volume));\r\n\t\t\t\r\n\t\t\tthis._finishSetup();\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeNoteTruncate extends ChangeSequence {\r\n\t\tconstructor(doc: SongDocument, pattern: Pattern, start: number, end: number, skipNote?: Note) {\r\n\t\t\tsuper();\r\n\t\t\tlet i: number = 0;\r\n\t\t\twhile (i < pattern.notes.length) {\r\n\t\t\t\tconst note: Note = pattern.notes[i];\r\n\t\t\t\tif (note == skipNote && skipNote != undefined) {\r\n\t\t\t\t\ti++;\r\n\t\t\t\t} else if (note.end <= start) {\r\n\t\t\t\t\ti++;\r\n\t\t\t\t} else if (note.start >= end) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t} else if (note.start < start) {\r\n\t\t\t\t\tthis.append(new ChangeNoteLength(doc, note, note.start, start));\r\n\t\t\t\t\ti++;\r\n\t\t\t\t} else if (note.end > end) {\r\n\t\t\t\t\tthis.append(new ChangeNoteLength(doc, note, end, note.end));\r\n\t\t\t\t\ti++;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.append(new ChangeNoteAdded(doc, pattern, note, i, true));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeTransposeNote extends UndoableChange {\r\n\t\tprotected _doc: SongDocument;\r\n\t\tprotected _note: Note;\r\n\t\tprotected _oldStart: number;\r\n\t\tprotected _newStart: number;\r\n\t\tprotected _oldEnd: number;\r\n\t\tprotected _newEnd: number;\r\n\t\tprotected _oldPins: NotePin[];\r\n\t\tprotected _newPins: NotePin[];\r\n\t\tprotected _oldPitches: number[];\r\n\t\tprotected _newPitches: number[];\r\n\t\tconstructor(doc: SongDocument, note: Note, upward: boolean) {\r\n\t\t\tsuper(false);\r\n\t\t\tthis._doc = doc;\r\n\t\t\tthis._note = note;\r\n\t\t\tthis._oldPins = note.pins;\r\n\t\t\tthis._newPins = [];\r\n\t\t\tthis._oldPitches = note.pitches;\r\n\t\t\tthis._newPitches = [];\r\n\t\t\t\r\n\t\t\tconst maxPitch: number = (doc.song.getChannelIsDrum(doc.channel) ? Config.drumCount - 1 : Config.maxPitch);\r\n\t\t\t\r\n\t\t\tfor (let i: number = 0; i < this._oldPitches.length; i++) {\r\n\t\t\t\tlet pitch: number = this._oldPitches[i];\r\n\t\t\t\tif (upward) {\r\n\t\t\t\t\tfor (let j: number = pitch + 1; j <= maxPitch; j++) {\r\n\t\t\t\t\t\tif (doc.song.getChannelIsDrum(doc.channel) || Config.scales[doc.song.scale].flags[j%12]) {\r\n\t\t\t\t\t\t\tpitch = j;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfor (let j: number = pitch - 1; j >= 0; j--) {\r\n\t\t\t\t\t\tif (doc.song.getChannelIsDrum(doc.channel) || Config.scales[doc.song.scale].flags[j%12]) {\r\n\t\t\t\t\t\t\tpitch = j;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tlet foundMatch: boolean = false;\r\n\t\t\t\tfor (let j: number = 0; j < this._newPitches.length; j++) {\r\n\t\t\t\t\tif (this._newPitches[j] == pitch) {\r\n\t\t\t\t\t\tfoundMatch = true;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (!foundMatch) this._newPitches.push(pitch);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tlet min: number = 0;\r\n\t\t\tlet max: number = maxPitch;\r\n\t\t\t\r\n\t\t\tfor (let i: number = 1; i < this._newPitches.length; i++) {\r\n\t\t\t\tconst diff: number = this._newPitches[0] - this._newPitches[i];\r\n\t\t\t\tif (min < diff) min = diff;\r\n\t\t\t\tif (max > diff + maxPitch) max = diff + maxPitch;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tfor (const oldPin of this._oldPins) {\r\n\t\t\t\tlet interval: number = oldPin.interval + this._oldPitches[0];\r\n\t\t\t\t\r\n\t\t\t\tif (interval < min) interval = min;\r\n\t\t\t\tif (interval > max) interval = max;\r\n\t\t\t\tif (upward) {\r\n\t\t\t\t\tfor (let i: number = interval + 1; i <= max; i++) {\r\n\t\t\t\t\t\tif (doc.song.getChannelIsDrum(doc.channel) || Config.scales[doc.song.scale].flags[i%12]) {\r\n\t\t\t\t\t\t\tinterval = i;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfor (let i: number = interval - 1; i >= min; i--) {\r\n\t\t\t\t\t\tif (doc.song.getChannelIsDrum(doc.channel) || Config.scales[doc.song.scale].flags[i%12]) {\r\n\t\t\t\t\t\t\tinterval = i;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tinterval -= this._newPitches[0];\r\n\t\t\t\tthis._newPins.push(makeNotePin(interval, oldPin.time, oldPin.volume));\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (this._newPins[0].interval != 0) throw new Error(\"wrong pin start interval\");\r\n\t\t\t\r\n\t\t\tfor (let i: number = 1; i < this._newPins.length - 1; ) {\r\n\t\t\t\tif (this._newPins[i-1].interval == this._newPins[i].interval && \r\n\t\t\t\t    this._newPins[i].interval == this._newPins[i+1].interval && \r\n\t\t\t\t    this._newPins[i-1].volume == this._newPins[i].volume && \r\n\t\t\t\t    this._newPins[i].volume == this._newPins[i+1].volume)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis._newPins.splice(i, 1);\r\n\t\t\t\t} else {\r\n\t\t\t\t\ti++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._doForwards();\r\n\t\t\tthis._didSomething();\r\n\t\t}\r\n\t\t\r\n\t\tprotected _doForwards(): void {\r\n\t\t\tthis._note.pins = this._newPins;\r\n\t\t\tthis._note.pitches = this._newPitches;\r\n\t\t\tthis._doc.notifier.changed();\r\n\t\t}\r\n\t\t\r\n\t\tprotected _doBackwards(): void {\r\n\t\t\tthis._note.pins = this._oldPins;\r\n\t\t\tthis._note.pitches = this._oldPitches;\r\n\t\t\tthis._doc.notifier.changed();\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeTranspose extends ChangeSequence {\r\n\t\tconstructor(doc: SongDocument, pattern: Pattern, upward: boolean) {\r\n\t\t\tsuper();\r\n\t\t\tfor (let i: number = 0; i < pattern.notes.length; i++) {\r\n\t\t\t\tthis.append(new ChangeTransposeNote(doc, pattern.notes[i], upward));\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeVolume extends Change {\r\n\t\tconstructor(doc: SongDocument, oldValue: number, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tdoc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].volume = newValue;\r\n\t\t\tdoc.notifier.changed();\r\n\t\t\tif (oldValue != newValue) this._didSomething();\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeVolumeBend extends UndoableChange {\r\n\t\tprivate _doc: SongDocument;\r\n\t\tprivate _note: Note;\r\n\t\tprivate _oldPins: NotePin[];\r\n\t\tprivate _newPins: NotePin[];\r\n\t\tconstructor(doc: SongDocument, note: Note, bendPart: number, bendVolume: number, bendInterval: number) {\r\n\t\t\tsuper(false);\r\n\t\t\tthis._doc = doc;\r\n\t\t\tthis._note = note;\r\n\t\t\tthis._oldPins = note.pins;\r\n\t\t\tthis._newPins = [];\r\n\t\t\t\r\n\t\t\tlet inserted: boolean = false;\r\n\t\t\t\r\n\t\t\tfor (const pin of note.pins) {\r\n\t\t\t\tif (pin.time < bendPart) {\r\n\t\t\t\t\tthis._newPins.push(pin);\r\n\t\t\t\t} else if (pin.time == bendPart) {\r\n\t\t\t\t\tthis._newPins.push(makeNotePin(bendInterval, bendPart, bendVolume));\r\n\t\t\t\t\tinserted = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (!inserted) {\r\n\t\t\t\t\t\tthis._newPins.push(makeNotePin(bendInterval, bendPart, bendVolume));\r\n\t\t\t\t\t\tinserted = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis._newPins.push(pin);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tfor (let i: number = 1; i < this._newPins.length - 1; ) {\r\n\t\t\t\tif (this._newPins[i-1].interval == this._newPins[i].interval && \r\n\t\t\t\t    this._newPins[i].interval == this._newPins[i+1].interval && \r\n\t\t\t\t    this._newPins[i-1].volume == this._newPins[i].volume && \r\n\t\t\t\t    this._newPins[i].volume == this._newPins[i+1].volume)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis._newPins.splice(i, 1);\r\n\t\t\t\t} else {\r\n\t\t\t\t\ti++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._doForwards();\r\n\t\t\tthis._didSomething();\r\n\t\t}\r\n\t\t\r\n\t\tprotected _doForwards(): void {\r\n\t\t\tthis._note.pins = this._newPins;\r\n\t\t\tthis._doc.notifier.changed();\r\n\t\t}\r\n\t\t\r\n\t\tprotected _doBackwards(): void {\r\n\t\t\tthis._note.pins = this._oldPins;\r\n\t\t\tthis._doc.notifier.changed();\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeWave extends Change {\r\n\t\tconstructor(doc: SongDocument, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tif (doc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].wave != newValue) {\r\n\t\t\t\tdoc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].wave = newValue;\r\n\t\t\t\tdoc.notifier.changed();\r\n\t\t\t\tthis._didSomething();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n","// Copyright (c) 2012-2022 John Nesky and contributing authors, distributed under the MIT license, see accompanying the LICENSE.md file.\r\n\r\nimport { HTML } from \"imperative-html/dist/esm/elements-strict\";\r\nimport {DictionaryArray, BeepBoxOption, toNameMap} from \"../synth/SynthConfig\";\r\nimport { Song } from \"../synth/song\";\r\n\r\nexport interface ChannelColors extends BeepBoxOption {\r\n    readonly secondaryChannel: string;\r\n    readonly primaryChannel: string;\r\n    readonly secondaryNote: string;\r\n    readonly primaryNote: string;\r\n}\r\n\r\n\r\nexport class ColorConfig {\r\n\tpublic static colorLookup: Map<number, ChannelColors> = new Map<number, ChannelColors>();\r\n\tpublic static usesPianoScheme: boolean = false;\r\n\tprivate static readonly _themeMap: {[K: string]: string} = {\r\n\t\t\"default\": `\r\n            :root {\r\n\t\t\t\t--page-margin: black;\r\n\t\t\t\t--editor-background: black;\r\n\t\t\t\t--hover-preview: white;\r\n\t\t\t\t--playhead: white;\r\n\t\t\t\t--primary-text: white;\r\n\t\t\t\t--secondary-text: #999;\r\n\t\t\t\t--inverted-text: black;\r\n\t\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t\t--loop-accent: #9900cc;\r\n\t\t\t\t--link-accent: #98f;\r\n\t\t\t\t--ui-widget-background: #363636;\r\n\t\t\t\t--ui-widget-focus: #777;\r\n\t\t\t\t--pitch-background: #444;\r\n\t\t\t\t--tonic: #864;\r\n\t\t\t\t--fifth-note: #468;\r\n                --volume-icon: #777777;\r\n\t\t\t\t--octave-scrollbar: #444;\r\n\t\t\t\t--scrollbar-octave: #864;\r\n\t\t\t\t--channel-box: #444;\r\n\r\n\t\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t\t--pitch10-primary-note:     #d85d00;\r\n\r\n\t\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\r\n\t\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t\t--pitch12-primary-note:     #c26afc;\r\n\r\n\t\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t\t--noise4-primary-note:      #a5ff00;\r\n            }\r\n        `,\r\n\t\t\"nepbox\": `\r\n            :root {\r\n\t\t\t\t--page-margin: black;\r\n\t\t\t\t--editor-background: black;\r\n\t\t\t\t--hover-preview: white;\r\n\t\t\t\t--playhead: white;\r\n\t\t\t\t--primary-text: #00fff5;\r\n\t\t\t\t--secondary-text: #999;\r\n\t\t\t\t--inverted-text: black;\r\n\t\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t\t--loop-accent: #00fff5;\r\n\t\t\t\t--link-accent: #98f;\r\n\t\t\t\t--ui-widget-background: #363636;\r\n\t\t\t\t--ui-widget-focus: #777;\r\n\t\t\t\t--pitch-background: #0a2d44;\r\n\t\t\t\t--tonic: #9150ff;\r\n\t\t\t\t--fifth-note: #990000;\r\n                --volume-icon: #00fff5;\r\n\t\t\t\t--octave-scrollbar: #484848;\r\n\t\t\t\t--scrollbar-octave: #9150ff;\r\n\t\t\t\t--channel-box: #444;\r\n\r\n\t\t\t\t--pitch1-secondary-channel: #c13cbf;\r\n\t\t\t\t--pitch1-primary-channel: #f75dff;\r\n\t\t\t\t--pitch1-secondary-note: #b930a2;\r\n\t\t\t\t--pitch1-primary-note: #fca5ff;\r\n\t\t\t\t--pitch2-secondary-channel: #800000;\r\n\t\t\t\t--pitch2-primary-channel: #f00;\r\n\t\t\t\t--pitch2-secondary-note: #8c2121;\r\n\t\t\t\t--pitch2-primary-note: #ff5252;\r\n\t\t\t\t--pitch3-secondary-channel: #004bb3;\r\n\t\t\t\t--pitch3-primary-channel: #1792ff;\r\n\t\t\t\t--pitch3-secondary-note: #005cb3;\r\n\t\t\t\t--pitch3-primary-note: #00ffe9;\r\n\t\t\t\t--pitch4-secondary-channel: #a48800;\r\n\t\t\t\t--pitch4-primary-channel: #fb0;\r\n\t\t\t\t--pitch4-secondary-note: #9c4100;\r\n\t\t\t\t--pitch4-primary-note: #ffd84e;\r\n\t\t\t\t--pitch5-secondary-channel: #6c0000;\r\n\t\t\t\t--pitch5-primary-channel:   #ff3e3e;\r\n\t\t\t\t--pitch5-secondary-note:    #6c0000;\r\n\t\t\t\t--pitch5-primary-note:      #ff3e3e;\r\n\t\t\t\t--pitch6-secondary-channel:#d25a00;\r\n\t\t\t\t--pitch6-primary-channel:  #fdff00;\r\n\t\t\t\t--pitch6-secondary-note:   #d25a00;\r\n\t\t\t\t--pitch6-primary-note:     #fdff00;\r\n\t\t\t\t--pitch7-secondary-channel: #046000;\r\n\t\t\t\t--pitch7-primary-channel:   #0c79ff;\r\n\t\t\t\t--pitch7-secondary-note:    #046000;\r\n\t\t\t\t--pitch7-primary-note:      #0c79ff;\r\n\t\t\t\t--pitch8-secondary-channel:#3b2bae;\r\n\t\t\t\t--pitch8-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch8-secondary-note:   #3b2bae;\r\n\t\t\t\t--pitch8-primary-note:     #d85d00;\r\n\t\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t\t--pitch10-primary-note:     #d85d00;\r\n\t\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\t\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t\t--pitch12-primary-note:     #c26afc;\r\n\t\t\t\t--noise1-secondary-channel: #868686;\r\n\t\t\t\t--noise1-primary-channel: #fff;\r\n\t\t\t\t--noise1-secondary-note: #868686;\r\n\t\t\t\t--noise1-primary-note: #fff;\r\n\t\t\t\t--noise2-secondary-channel: #805300;\r\n\t\t\t\t--noise2-primary-channel: #ff8c00;\r\n\t\t\t\t--noise2-secondary-note: #6a3500;\r\n\t\t\t\t--noise2-primary-note: #a85400;\r\n\t\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t\t--noise4-primary-note:      #a5ff00;\r\n            }\r\n        `,\r\n\t\t\"laffey\": `\r\n\t\t\t:root {\r\n\t\t\t\t--page-margin: #000;\r\n\t\t\t\t--editor-background: #060606;\r\n\t\t\t\t--hover-preview: #fff;\r\n\t\t\t\t--playhead: rgb(0, 242, 255);\r\n\t\t\t\t--primary-text: #00fff5;\r\n\t\t\t\t--secondary-text: #a82f2f;\r\n\t\t\t\t--inverted-text: #000;\r\n\t\t\t\t--text-selection: rgba(98, 46, 164, .99);\r\n\t\t\t\t--box-selection-fill: #b74a4a;\r\n\r\n\t\t\t\t--loop-accent: #7744FF;\r\n\r\n\t\t\t\t--link-accent: #ff00e1;\r\n\t\t\t\t--ui-widget-background: #484848;\r\n\t\t\t\t--ui-widget-focus: #3e3e3e;\r\n\t\t\t\t--pitch-background: #444444;\r\n\r\n\t\t\t\t--tonic: #dbbeed;\r\n\t\t\t\t--pitch1-background: #1a2182; \r\n\t\t\t\t--pitch2-background: #1a2182; \r\n\t\t\t\t--pitch3-background: #1a2182; \r\n\t\t\t\t--pitch4-background: #1a2182;\r\n\t\t\t\t--pitch5-background: #1a2182; \r\n\t\t\t\t--pitch6-background: #1a2182; \r\n\t\t\t\t--fifth-note: #6b1313;\r\n\t\t\t\t--pitch8-background: #1a2182; \r\n\t\t\t\t--pitch9-background: #1a2182; \r\n\t\t\t\t--pitch10-background: #1a2182; \r\n\t\t\t\t--pitch11-background: #1a2182;\r\n\t\t\t\t--octave-scrollbar: #852929;\r\n\t\t\t\t--scrollbar-octave: #f2b3ff;\r\n\r\n\t\t\t\t--white-piano-key: #bababa;\r\n\t\t\t\t--black-piano-key: #444444;\r\n\r\n\t\t\t\t--noise-channel-limit: 2;\r\n\t\t\t\t--pitch1-secondary-channel: #c13cbf;\r\n\t\t\t\t--pitch1-primary-channel: #f75dff;\r\n\t\t\t\t--pitch1-secondary-note: #b930a2;\r\n\t\t\t\t--pitch1-primary-note: #fca5ff;\r\n\t\t\t\t--pitch2-secondary-channel: #800000;\r\n\t\t\t\t--pitch2-primary-channel: #f00;\r\n\t\t\t\t--pitch2-secondary-note: #8c2121;\r\n\t\t\t\t--pitch2-primary-note: #ff5252;\r\n\t\t\t\t--pitch3-secondary-channel: #004bb3;\r\n\t\t\t\t--pitch3-primary-channel: #1792ff;\r\n\t\t\t\t--pitch3-secondary-note: #005cb3;\r\n\t\t\t\t--pitch3-primary-note: #00ffe9;\r\n\t\t\t\t--pitch4-secondary-channel: #a48800;\r\n\t\t\t\t--pitch4-primary-channel: #fb0;\r\n\t\t\t\t--pitch4-secondary-note: #9c4100;\r\n\t\t\t\t--pitch4-primary-note: #ffd84e;\r\n\t\t\t\t--pitch5-secondary-channel: #6c0000;\r\n\t\t\t\t--pitch5-primary-channel:   #ff3e3e;\r\n\t\t\t\t--pitch5-secondary-note:    #6c0000;\r\n\t\t\t\t--pitch5-primary-note:      #ff3e3e;\r\n\t\t\t\t--pitch6-secondary-channel:#d25a00;\r\n\t\t\t\t--pitch6-primary-channel:  #fdff00;\r\n\t\t\t\t--pitch6-secondary-note:   #d25a00;\r\n\t\t\t\t--pitch6-primary-note:     #fdff00;\r\n\t\t\t\t--pitch7-secondary-channel: #046000;\r\n\t\t\t\t--pitch7-primary-channel:   #0c79ff;\r\n\t\t\t\t--pitch7-secondary-note:    #046000;\r\n\t\t\t\t--pitch7-primary-note:      #0c79ff;\r\n\t\t\t\t--pitch8-secondary-channel:#3b2bae;\r\n\t\t\t\t--pitch8-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch8-secondary-note:   #3b2bae;\r\n\t\t\t\t--pitch8-primary-note:     #d85d00;\r\n\t\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t\t--pitch10-primary-note:     #d85d00;\r\n\t\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\t\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t\t--pitch12-primary-note:     #c26afc;\r\n\t\t\t\t--noise1-secondary-channel: #868686;\r\n\t\t\t\t--noise1-primary-channel: #fff;\r\n\t\t\t\t--noise1-secondary-note: #868686;\r\n\t\t\t\t--noise1-primary-note: #fff;\r\n\t\t\t\t--noise2-secondary-channel: #805300;\r\n\t\t\t\t--noise2-primary-channel: #ff8c00;\r\n\t\t\t\t--noise2-secondary-note: #6a3500;\r\n\t\t\t\t--noise2-primary-note: #a85400;\r\n\t\t\t\t--noise3-secondary-channel: #868686;\r\n\t\t\t\t--noise3-primary-channel: #fff;\r\n\t\t\t\t--noise3-secondary-note: #868686;\r\n\t\t\t\t--noise3-primary-note: #fff;\r\n\t\t\t\t--noise4-secondary-channel: #805300;\r\n\t\t\t\t--noise4-primary-channel: #ff8c00;\r\n\t\t\t\t--noise4-secondary-note: #6a3500;\r\n\t\t\t\t--noise4-primary-note: #a85400;\r\n\t\t\t\t}\r\n\t\t\t`,\r\n\t\t\"modbox2\": `\r\n            :root {\r\n                --page-margin: black;\r\n\t\t\t\t--editor-background: black;\r\n\t\t\t\t--hover-preview: white;\r\n\t\t\t\t--playhead: white;\r\n\t\t\t\t--primary-text: white;\r\n\t\t\t\t--secondary-text: #999;\r\n\t\t\t\t--inverted-text: black;\r\n\t\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t\t--loop-accent: #00ff00;\r\n\t\t\t\t--link-accent: #98f;\r\n\t\t\t\t--ui-widget-background: #363636;\r\n\t\t\t\t--ui-widget-focus: #777;\r\n\t\t\t\t--pitch-background: #444;\r\n\t\t\t\t--tonic: #c4ffa3;\r\n\t\t\t\t--fifth-note: #96fffb;\r\n                --volume-icon: #c4ffa3;\r\n\t\t\t\t--octave-scrollbar: #00ff00;\r\n\t\t\t\t--scrollbar-octave: #fff;\r\n\t\t\t\t--channel-box: #444;\r\n\r\n\t\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t\t--pitch10-primary-note:     #d85d00;\r\n\r\n\t\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\r\n\t\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t\t--pitch12-primary-note:     #c26afc;\r\n\r\n\t\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t\t--noise4-primary-note:      #a5ff00;\r\n            }\r\n\t\t`,\r\n\t\t\"artic\": `\r\n\t\t:root {\r\n\t\t\t\t--page-margin: black;\r\n\t\t\t\t--editor-background: black;\r\n\t\t\t\t--hover-preview: white;\r\n\t\t\t\t--playhead: white;\r\n\t\t\t\t--primary-text: white;\r\n\t\t\t\t--secondary-text: #999;\r\n\t\t\t\t--inverted-text: black;\r\n\t\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t\t--loop-accent: #ffffff;\r\n\t\t\t\t--link-accent: #98f;\r\n\t\t\t\t--ui-widget-background: #363636;\r\n\t\t\t\t--ui-widget-focus: #777;\r\n\t\t\t\t--pitch-background: #444;\r\n\t\t\t\t--tonic: #eafffe;\r\n\t\t\t\t--fifth-note: #b7f1ff;\r\n\t\t\t\t--octave-scrollbar: #a5eeff;\r\n\t\t\t\t--scrollbar-octave: #cefffd;\r\n\t\t\t\t--volume-icon: #42dcff;\t\r\n\r\n\t\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t\t--pitch10-primary-note:     #d85d00;\r\n\t\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\t\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t\t--pitch12-primary-note:     #c26afc;\r\n\t\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t\t--noise4-primary-note:      #a5ff00;\r\n\t\t\t\t}\r\n\t\t`,\r\n\t\t\"Cinnamon Roll\": `\r\n\t\t:root {\r\n\t\t\t\t--page-margin: black;\r\n\t\t\t\t--editor-background: black;\r\n\t\t\t\t--hover-preview: white;\r\n\t\t\t\t--playhead: white;\r\n\t\t\t\t--primary-text: white;\r\n\t\t\t\t--secondary-text: #999;\r\n\t\t\t\t--inverted-text: black;\r\n\t\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t\t--loop-accent: #ba8418;\r\n\t\t\t\t--link-accent: #98f;\r\n\t\t\t\t--ui-widget-background: #363636;\r\n\t\t\t\t--ui-widget-focus: #777;\r\n\t\t\t\t--pitch-background: #444;\r\n\t\t\t\t--pitch1-background: #f5bb00;\r\n\t\t\t\t--pitch2-background: #f5bb00;\r\n\t\t\t\t--pitch3-background: #f5bb00;\r\n\t\t\t\t--pitch4-background: #f5bb00;\r\n\t\t\t\t--pitch5-background: #f5bb00;\r\n\t\t\t\t--pitch6-background: #f5bb00;\r\n\t\t\t\t--pitch8-background: #f5bb00;\r\n\t\t\t\t--pitch9-background: #f5bb00;\r\n\t\t\t\t--pitch10-background: #f5bb00;\r\n\t\t\t\t--pitch11-background: #f5bb00;\r\n\t\t\t\t--pitch12-background: #f5bb00;\r\n\t\t\t\t--tonic: #f5bb00;\r\n\t\t\t\t--fifth-note: #f5bb00;\r\n\t\t\t\t--volume-icon: #ba8418;\t\r\n\r\n\t\t\t\t--octave-scrollbar: #e59900;\r\n\t\t\t\t--scrollbar-octave: #ffff25;\r\n\r\n\t\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t\t--pitch10-primary-note:     #d85d00;\r\n\t\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\t\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t\t--pitch12-primary-note:     #c26afc;\r\n\t\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t\t--noise4-primary-note:      #a5ff00;\r\n\t\t\t\t}\r\n\t\t`,\r\n\t\t\"Ocean\": `\r\n\t\t:root {\r\n\t\t\t\t--page-margin: black;\r\n\t\t\t\t--editor-background: black;\r\n\t\t\t\t--hover-preview: white;\r\n\t\t\t\t--playhead: white;\r\n\t\t\t\t--primary-text: white;\r\n\t\t\t\t--secondary-text: #999;\r\n\t\t\t\t--inverted-text: black;\r\n\t\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t\t--loop-accent: #5982ff;\r\n\t\t\t\t--link-accent: #98f;\r\n\t\t\t\t--ui-widget-background: #363636;\r\n\t\t\t\t--ui-widget-focus: #777;\r\n\t\t\t\t--pitch-background: #444;\r\n\t\t\t\t--tonic: #090b3a;\r\n\t\t\t\t--fifth-note: #3f669b;\r\n\t\t\t\t--volume-icon: #090b3a;\t\r\n\r\n\t\t\t\t--octave-scrollbar: #4449a3;\r\n\t\t\t\t--scrollbar-octave: #3dffdb;\r\n\r\n\t\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t\t--pitch10-primary-note:     #d85d00;\r\n\t\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\t\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t\t--pitch12-primary-note:     #c26afc;\r\n\t\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t\t--noise4-primary-note:      #a5ff00;\r\n\t\t\t\t}\r\n\t\t`,\r\n\t\t\"rainbow\": `\r\n\t\t:root {\r\n\t\t\t\t--page-margin: black;\r\n\t\t\t\t--editor-background: black;\r\n\t\t\t\t--hover-preview: white;\r\n\t\t\t\t--playhead: white;\r\n\t\t\t\t--primary-text: white;\r\n\t\t\t\t--secondary-text: #999;\r\n\t\t\t\t--inverted-text: black;\r\n\t\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t\t--loop-accent: #ff0000;\r\n\t\t\t\t--link-accent: #98f;\r\n\t\t\t\t--ui-widget-background: #363636;\r\n\t\t\t\t--ui-widget-focus: #777;\r\n\r\n\t\t\t\t--pitch-background: #444; \r\n\t\t\t\t--tonic: #ffaaaa; \r\n\t\t\t\t--pitch1-background: #ffceaa; \r\n\t\t\t\t--pitch2-background: #ffdfaa; \r\n\t\t\t\t--pitch3-background: #fff5aa; \r\n\t\t\t\t--pitch4-background: #e8ffaa;\r\n\t\t\t\t--pitch5-background: #bfffb2; \r\n\t\t\t\t--pitch6-background: #b2ffc8; \r\n\t\t\t\t--fifth-note: #b2ffe4; \r\n\t\t\t\t--pitch8-background: #b2f3ff; \r\n\t\t\t\t--pitch9-background: #b2b3ff; \r\n\t\t\t\t--pitch10-background: #e0b2ff; \r\n\t\t\t\t--pitch11-background: #ffafe9; \r\n\t\t\t\t--octave-scrollbar: #43ff00; \r\n\t\t\t\t--volume-icon: #ff00cb;\t\r\n\r\n\t\t\t\t--octave-scrollbar: #43ff00;\r\n\t\t\t\t--scrollbar-octave: #0400ff;\r\n\r\n\t\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t\t--pitch10-primary-note:     #d85d00;\r\n\t\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\t\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t\t--pitch12-primary-note:     #c26afc;\r\n\t\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t\t--noise4-primary-note:      #a5ff00;\r\n\t\t\t\t}\r\n\t\t`,\r\n\t\t\"float\": `\r\n\t\t:root {\r\n\t\t\t\t--page-margin: black;\r\n\t\t\t\t--editor-background: black;\r\n\t\t\t\t--hover-preview: white;\r\n\t\t\t\t--playhead: white;\r\n\t\t\t\t--primary-text: white;\r\n\t\t\t\t--secondary-text: #999;\r\n\t\t\t\t--inverted-text: black;\r\n\t\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t\t--loop-accent: #ff0000;\r\n\t\t\t\t--link-accent: #98f;\r\n\t\t\t\t--ui-widget-background: #363636;\r\n\t\t\t\t--ui-widget-focus: #777;\r\n\t\t\t\t--volume-icon: #878787;\t\r\n\r\n\t\t\t\t--pitch-background: #444; \r\n\t\t\t\t--tonic: #ffffff; \r\n\t\t\t\t--pitch1-background: #ededed;  \r\n\t\t\t\t--pitch2-background: #cecece;  \r\n\t\t\t\t--pitch3-background: #bababa;  \r\n\t\t\t\t--pitch4-background: #afafaf;\r\n\t\t\t\t--pitch5-background: #a5a5a5; \r\n\t\t\t\t--pitch6-background: #999999; \r\n\t\t\t\t--fifth-note: #8e8e8e; \r\n\t\t\t\t--pitch8-background: #828282; \r\n\t\t\t\t--pitch9-background: #777777; \r\n\t\t\t\t--pitch10-background: #565656; \r\n\t\t\t\t--pitch11-background: #282828; \r\n\t\t\t\t--octave-scrollbar: #ffffff; \r\n\t\t\t\t--scrollbar-octave: #c9c9c9;\r\n\r\n\t\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t\t--pitch10-primary-note:     #d85d00;\r\n\t\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\t\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t\t--pitch12-primary-note:     #c26afc;\r\n\t\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t\t--noise4-primary-note:      #a5ff00;\r\n\t\t\t\t}\r\n\t\t`,\r\n\t\t\"windows\": `\r\n\t\t:root {\r\n\t\t\t\t--page-margin: black;\r\n\t\t\t\t--editor-background: black;\r\n\t\t\t\t--hover-preview: white;\r\n\t\t\t\t--playhead: white;\r\n\t\t\t\t--primary-text: white;\r\n\t\t\t\t--secondary-text: #999;\r\n\t\t\t\t--inverted-text: black;\r\n\t\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t\t--loop-accent: #ff0000;\r\n\t\t\t\t--link-accent: #98f;\r\n\t\t\t\t--ui-widget-background: #363636;\r\n\t\t\t\t--ui-widget-focus: #777;\r\n\t\t\t\t--volume-icon: #15a0db;\t\r\n\r\n\t\t\t\t--tonic: #da4e2a;\r\n\t\t\t\t--fifth-note: #5d9511;\r\n\t\t\t\t--pitch-background: #444;\r\n\r\n\t\t\t\t--octave-scrollbar: #295294; \r\n\t\t\t\t--scrollbar-octave: #fdd01d;\r\n\r\n\t\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t\t--pitch10-primary-note:     #d85d00;\r\n\t\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\t\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t\t--pitch12-primary-note:     #c26afc;\r\n\t\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t\t--noise4-primary-note:      #a5ff00;\r\n\t\t\t\t}\r\n\t\t`,\r\n\t\t\"grassland\": `\r\n\t\t:root {\r\n\t\t\t\t--page-margin: black;\r\n\t\t\t\t--editor-background: black;\r\n\t\t\t\t--hover-preview: white;\r\n\t\t\t\t--playhead: white;\r\n\t\t\t\t--primary-text: white;\r\n\t\t\t\t--secondary-text: #999;\r\n\t\t\t\t--inverted-text: black;\r\n\t\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t\t--loop-accent: #a0d168;\r\n\t\t\t\t--link-accent: #98f;\r\n\t\t\t\t--ui-widget-background: #363636;\r\n\t\t\t\t--ui-widget-focus: #777;\r\n\t\t\t\t--volume-icon: #74bc21;\t\r\n\r\n\t\t\t\t--tonic: #20330a;\r\n\t\t\t\t--fifth-note: #74bc21;\r\n\t\t\t\t--pitch-background: #444;\r\n\r\n\t\t\t\t--octave-scrollbar: #74bc21; \r\n\t\t\t\t--scrollbar-octave: #20330a;\r\n\r\n\t\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t\t--pitch10-primary-note:     #d85d00;\r\n\t\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\t\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t\t--pitch12-primary-note:     #c26afc;\r\n\t\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t\t--noise4-primary-note:      #a5ff00;\r\n\t\t\t\t}\r\n\t\t`,\r\n\t\t\"dessert\": `\r\n\t\t:root {\r\n\t\t\t\t--page-margin: black;\r\n\t\t\t\t--editor-background: black;\r\n\t\t\t\t--hover-preview: white;\r\n\t\t\t\t--playhead: white;\r\n\t\t\t\t--primary-text: white;\r\n\t\t\t\t--secondary-text: #999;\r\n\t\t\t\t--inverted-text: black;\r\n\t\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t\t--loop-accent: #ff6254;\r\n\t\t\t\t--link-accent: #98f;\r\n\t\t\t\t--ui-widget-background: #363636;\r\n\t\t\t\t--ui-widget-focus: #777;\r\n\t\t\t\t--volume-icon: #ff0000;\t\r\n\r\n\t\t\t\t--tonic: #fffc5b;\r\n\t\t\t\t--fifth-note: #ff5e3a;\r\n\t\t\t\t--pitch-background: #444;\r\n\r\n\t\t\t\t--octave-scrollbar: #ff5e3a; \r\n\t\t\t\t--scrollbar-octave: #fffc5b;\r\n\r\n\t\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t\t--pitch10-primary-note:     #d85d00;\r\n\t\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\t\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t\t--pitch12-primary-note:     #c26afc;\r\n\t\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t\t--noise4-primary-note:      #a5ff00;\r\n\t\t\t\t}\r\n\t\t`,\r\n\t\t\"kahootiest\": `\r\n\t\t:root {\r\n\t\t\t\t--page-margin: black;\r\n\t\t\t\t--editor-background: black;\r\n\t\t\t\t--hover-preview: white;\r\n\t\t\t\t--playhead: white;\r\n\t\t\t\t--primary-text: white;\r\n\t\t\t\t--secondary-text: #999;\r\n\t\t\t\t--inverted-text: black;\r\n\t\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t\t--loop-accent: #ff3355;\r\n\t\t\t\t--link-accent: #98f;\r\n\t\t\t\t--ui-widget-background: #363636;\r\n\t\t\t\t--ui-widget-focus: #777;\r\n\t\t\t\t--volume-icon: #66bf39;\t\r\n\r\n\t\t\t\t--tonic: #45a3e5;\r\n\t\t\t\t--fifth-note: #864cbf;\r\n\t\t\t\t--pitch-background: #444;\r\n\r\n\t\t\t\t--octave-scrollbar: #eb670f; \r\n\t\t\t\t--scrollbar-octave: #ff3355;\r\n\r\n\t\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t\t--pitch10-primary-note:     #d85d00;\r\n\t\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\t\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t\t--pitch12-primary-note:     #c26afc;\r\n\t\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t\t--noise4-primary-note:      #a5ff00;\r\n\t\t\t\t}\r\n\t\t`,\r\n\t\t\"beambit\": `\r\n\t\t:root {\r\n\t\t\t\t--page-margin: black;\r\n\t\t\t\t--editor-background: black;\r\n\t\t\t\t--hover-preview: white;\r\n\t\t\t\t--playhead: white;\r\n\t\t\t\t--primary-text: white;\r\n\t\t\t\t--secondary-text: #999;\r\n\t\t\t\t--inverted-text: black;\r\n\t\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t\t--loop-accent: #fefe00;\r\n\t\t\t\t--link-accent: #98f;\r\n\t\t\t\t--ui-widget-background: #363636;\r\n\t\t\t\t--ui-widget-focus: #777;\r\n\t\t\t\t--volume-icon: #fefe00;\t\r\n\r\n\t\t\t\t--pitch-background: #444;\r\n\r\n\t\t\t\t--tonic: #fefe00;\r\n\t\t\t\t--pitch1-background: #111111; \r\n\t\t\t\t--pitch2-background: #111111; \r\n\t\t\t\t--pitch3-background: #111111; \r\n\t\t\t\t--pitch4-background: #fa0103;\r\n\t\t\t\t--pitch5-background: #111111; \r\n\t\t\t\t--pitch6-background: #111111; \r\n\t\t\t\t--fifth-note: #111111; \r\n\t\t\t\t--pitch8-background: #0001fc; \r\n\t\t\t\t--pitch9-background: #111111; \r\n\t\t\t\t--pitch10-background: #111111; \r\n\t\t\t\t--pitch11-background: #111111;\r\n\r\n\t\t\t\t--octave-scrollbar: #0001fc; \r\n\t\t\t\t--scrollbar-octave: #fa0103;\r\n\r\n\t\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t\t--pitch10-primary-note:     #d85d00;\r\n\t\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\t\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t\t--pitch12-primary-note:     #c26afc;\r\n\t\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t\t--noise4-primary-note:      #a5ff00;\r\n\t\t\t\t}\r\n\t\t`,\r\n\t\t\"egg\": `\r\n\t\t:root {\r\n\t\t\t\t--page-margin: black;\r\n\t\t\t\t--editor-background: black;\r\n\t\t\t\t--hover-preview: white;\r\n\t\t\t\t--playhead: white;\r\n\t\t\t\t--primary-text: white;\r\n\t\t\t\t--secondary-text: #999;\r\n\t\t\t\t--inverted-text: black;\r\n\t\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t\t--loop-accent: #6b003a;\r\n\t\t\t\t--link-accent: #98f;\r\n\t\t\t\t--ui-widget-background: #363636;\r\n\t\t\t\t--ui-widget-focus: #777;\r\n\t\t\t\t--volume-icon: #f01d7a;\t\r\n\r\n\t\t\t\t--tonic: #fffafa;\r\n\t\t\t\t--fifth-note: #ff91ce;\r\n\t\t\t\t--pitch-background: #444;\r\n\r\n\t\t\t\t--octave-scrollbar: #ffb1f4; \r\n\t\t\t\t--scrollbar-octave: #b4001b;\r\n\r\n\t\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t\t--pitch10-primary-note:     #d85d00;\r\n\t\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\t\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t\t--pitch12-primary-note:     #c26afc;\r\n\t\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t\t--noise4-primary-note:      #a5ff00;\r\n\t\t\t\t}\r\n\t\t`,\r\n\t\t\"Poniryoshka\": `\r\n\t\t:root {\r\n\t\t\t\t--page-margin: black;\r\n\t\t\t\t--editor-background: black;\r\n\t\t\t\t--hover-preview: white;\r\n\t\t\t\t--playhead: white;\r\n\t\t\t\t--primary-text: white;\r\n\t\t\t\t--secondary-text: #999;\r\n\t\t\t\t--inverted-text: black;\r\n\t\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t\t--loop-accent: #4b4b4b;\r\n\t\t\t\t--link-accent: #98f;\r\n\t\t\t\t--ui-widget-background: #363636;\r\n\t\t\t\t--ui-widget-focus: #777;\r\n\t\t\t\t--volume-icon: #ffc100;\t\r\n\r\n\t\t\t\t--tonic: #1a2844;\r\n\t\t\t\t--fifth-note: #dabbe6;\r\n\t\t\t\t--pitch4-background: #faf4c3;\r\n\t\t\t\t--pitch-background: #444;\r\n\r\n\t\t\t\t--octave-scrollbar: #5f4c99; \r\n\t\t\t\t--scrollbar-octave: #ff8291;\r\n\r\n\t\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t\t--pitch10-primary-note:     #d85d00;\r\n\t\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\t\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t\t--pitch12-primary-note:     #c26afc;\r\n\t\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t\t--noise4-primary-note:      #a5ff00;\r\n\t\t\t\t}\r\n\t\t`,\r\n\t\t\"gameboy\": `\r\n\t\t:root {\r\n\t\t\t\t--page-margin: black;\r\n\t\t\t\t--editor-background: black;\r\n\t\t\t\t--hover-preview: white;\r\n\t\t\t\t--playhead: white;\r\n\t\t\t\t--primary-text: white;\r\n\t\t\t\t--secondary-text: #999;\r\n\t\t\t\t--inverted-text: black;\r\n\t\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t\t--loop-accent: #9bbc0f;\r\n\t\t\t\t--link-accent: #98f;\r\n\t\t\t\t--ui-widget-background: #363636;\r\n\t\t\t\t--ui-widget-focus: #777;\r\n\t\t\t\t--volume-icon: #8bac0f;\t\r\n\r\n\t\t\t\t--tonic: #9bbc0f; \r\n\t\t\t\t--pitch1-background: #9bbc0f; \r\n\t\t\t\t--pitch2-background: #9bbc0f; \r\n\t\t\t\t--pitch3-background: #9bbc0f; \r\n\t\t\t\t--pitch4-background: #9bbc0f;\r\n\t\t\t\t--pitch5-background: #9bbc0f; \r\n\t\t\t\t--pitch6-background: #306230; \r\n\t\t\t\t--fifth-note: #306230; \r\n\t\t\t\t--pitch8-background: #306230; \r\n\t\t\t\t--pitch9-background: #0f380f; \r\n\t\t\t\t--pitch10-background: #0f380f; \r\n\t\t\t\t--pitch11-background: #0f380f; \r\n\t\t\t\t--pitch-background: #444;\r\n\r\n\t\t\t\t--octave-scrollbar: #9bbc0f; \r\n\t\t\t\t--scrollbar-octave: #8bac0f;\r\n\r\n\t\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t\t--pitch10-primary-note:     #d85d00;\r\n\t\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\t\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t\t--pitch12-primary-note:     #c26afc;\r\n\t\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t\t--noise4-primary-note:      #a5ff00;\r\n\t\t\t\t}\r\n\t\t`,\r\n\t\t\"woodkid\": `\r\n\t\t:root {\r\n\t\t\t\t--page-margin: black;\r\n\t\t\t\t--editor-background: black;\r\n\t\t\t\t--hover-preview: white;\r\n\t\t\t\t--playhead: white;\r\n\t\t\t\t--primary-text: white;\r\n\t\t\t\t--secondary-text: #999;\r\n\t\t\t\t--inverted-text: black;\r\n\t\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t\t--loop-accent: #e83c4e;\r\n\t\t\t\t--link-accent: #98f;\r\n\t\t\t\t--ui-widget-background: #363636;\r\n\t\t\t\t--ui-widget-focus: #777;\r\n\t\t\t\t--volume-icon: #ef3027;\t\r\n\r\n\t\t\t\t--tonic: #fff6fe;\r\n\t\t\t\t--pitch1-background: #41323b;\r\n\t\t\t\t--pitch2-background: #41323b;\r\n\t\t\t\t--pitch3-background: #41323b;\r\n\t\t\t\t--pitch4-background: #fff6fe;\r\n\t\t\t\t--pitch5-background: #41323b;\r\n\t\t\t\t--pitch6-background: #41323b;\r\n\t\t\t\t--fifth-note: #fff6fe;\r\n\t\t\t\t--pitch8-background: #41323b;\r\n\t\t\t\t--pitch9-background: #41323b;\r\n\t\t\t\t--pitch10-background: #41323b;\r\n\t\t\t\t--pitch11-background: #41323b;\r\n\t\t\t\t--pitch-background: #444;\r\n\r\n\t\t\t\t--octave-scrollbar: #ef3027; \r\n\t\t\t\t--scrollbar-octave: #ffedca;\r\n\r\n\t\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t\t--pitch10-primary-note:     #d85d00;\r\n\t\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\t\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t\t--pitch12-primary-note:     #c26afc;\r\n\t\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t\t--noise4-primary-note:      #a5ff00;\r\n\t\t\t\t}\r\n\t\t`,\r\n\t\t\"midnight\": `\r\n\t\t:root {\r\n\t\t\t\t--page-margin: black;\r\n\t\t\t\t--editor-background: black;\r\n\t\t\t\t--hover-preview: white;\r\n\t\t\t\t--playhead: white;\r\n\t\t\t\t--primary-text: white;\r\n\t\t\t\t--secondary-text: #999;\r\n\t\t\t\t--inverted-text: black;\r\n\t\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t\t--loop-accent: #445566;\r\n\t\t\t\t--link-accent: #98f;\r\n\t\t\t\t--ui-widget-background: #363636;\r\n\t\t\t\t--ui-widget-focus: #777;\r\n\t\t\t\t--volume-icon: #aa5599;\t\r\n\r\n\t\t\t\t--tonic: #222222;\r\n\t\t\t\t--pitch1-background: #222222;\r\n\t\t\t\t--pitch2-background: #222222;\r\n\t\t\t\t--pitch3-background: #222222;\r\n\t\t\t\t--pitch4-background: #222222;\r\n\t\t\t\t--pitch5-background: #222222;\r\n\t\t\t\t--pitch6-background:#222222;\r\n\t\t\t\t--fifth-note: #444444;\r\n\t\t\t\t--pitch8-background: #222222;\r\n\t\t\t\t--pitch9-background: #222222;\r\n\t\t\t\t--pitch10-background: #222222;\r\n\t\t\t\t--pitch11-background: #222222;\r\n\t\t\t\t--pitch-background: #444;\r\n\r\n\t\t\t\t--octave-scrollbar: #444444; \r\n\t\t\t\t--scrollbar-octave: #aa5599;\r\n\r\n\t\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t\t--pitch10-primary-note:     #d85d00;\r\n\t\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\t\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t\t--pitch12-primary-note:     #c26afc;\r\n\t\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t\t--noise4-primary-note:      #a5ff00;\r\n\t\t\t\t}\r\n\t\t`,\r\n\t\t\"snedbox\": `\r\n\t\t:root {\r\n\t\t\t--page-margin: black;\r\n\t\t\t--editor-background: black;\r\n\t\t\t--hover-preview: white;\r\n\t\t\t--playhead: white;\r\n\t\t\t--primary-text: white;\r\n\t\t\t--secondary-text: #999;\r\n\t\t\t--inverted-text: black;\r\n\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t--loop-accent: #a53a3d;\r\n\t\t\t--link-accent: #98f;\r\n\t\t\t--ui-widget-background: #363636;\r\n\t\t\t--ui-widget-focus: #777;\r\n\t\t\t--pitch-background: #444;\r\n\t\t\t--tonic: #864;\r\n\t\t\t--fifth-note: #60389b;\r\n\t\t\t--pitch4-background: #10997e;\r\n\t\t\t--volume-icon: #a53a3d;\r\n\t\t\t--octave-scrollbar: #444;\r\n\t\t\t--scrollbar-octave: #a53a3d;\r\n\t\t\t--channel-box: #444;\r\n\r\n\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t--pitch10-primary-note:     #d85d00;\r\n\r\n\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\r\n\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t--pitch12-primary-note:     #c26afc;\r\n\r\n\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t--noise4-primary-note:      #a5ff00;\r\n\t\t}\r\n\t`,\r\n\t\"unnamed\": `\r\n\t:root {\r\n\t\t\t--page-margin: black;\r\n\t\t\t--editor-background: black;\r\n\t\t\t--hover-preview: white;\r\n\t\t\t--playhead: white;\r\n\t\t\t--primary-text: white;\r\n\t\t\t--secondary-text: #999;\r\n\t\t\t--inverted-text: black;\r\n\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t--loop-accent: #ffffff;\r\n\t\t\t--link-accent: #98f;\r\n\t\t\t--ui-widget-background: #363636;\r\n\t\t\t--ui-widget-focus: #777;\r\n\t\t\t--pitch-background: #444;\r\n\t\t\t--pitch1-background: #ffffa0;\r\n\t\t\t--pitch2-background: #ffffa0;\r\n\t\t\t--pitch3-background: #ffffa0;\r\n\t\t\t--pitch4-background: #ffffa0;\r\n\t\t\t--pitch5-background: #ffffa0;\r\n\t\t\t--pitch6-background: #ffffa0;\r\n\t\t\t--pitch8-background: #ffffa0;\r\n\t\t\t--pitch9-background: #ffffa0;\r\n\t\t\t--pitch10-background: #ffffa0;\r\n\t\t\t--pitch11-background: #ffffa0;\r\n\t\t\t--pitch12-background: #ffffa0;\r\n\t\t\t--tonic: #ffffa0;\r\n\t\t\t--fifth-note: #ffffa0;\r\n\t\t\t--volume-icon: #ffffff;\t\r\n\r\n\t\t\t--octave-scrollbar: #ffffff;\r\n\t\t\t--scrollbar-octave: #ffffff;\r\n\r\n\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t--pitch10-primary-note:     #d85d00;\r\n\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t--pitch12-primary-note:     #c26afc;\r\n\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t--noise4-primary-note:      #a5ff00;\r\n\t\t\t}\r\n\t`,\r\n\t\"piano\": `\r\n\t:root {\r\n\t\t\t--page-margin: black;\r\n\t\t\t--editor-background: black;\r\n\t\t\t--hover-preview: white;\r\n\t\t\t--playhead: white;\r\n\t\t\t--primary-text: white;\r\n\t\t\t--secondary-text: #999;\r\n\t\t\t--inverted-text: black;\r\n\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t--loop-accent: #ffffff;\r\n\t\t\t--link-accent: #98f;\r\n\t\t\t--ui-widget-background: #363636;\r\n\t\t\t--ui-widget-focus: #777;\r\n\r\n\t\t\t--use-piano-scheme: true;\r\n\r\n\t\t\t--pitch-background: #444;\r\n\t\t\t--volume-icon: #ff0000;\t\r\n\r\n\t\t\t--tonic: #ffffff;\r\n\t\t\t--white-tonic: #fff;\r\n\t\t\t--black-tonic: #222;\r\n\t\t\t--fifth-note: #7a7a7a;\r\n\r\n\t\t\t--octave-scrollbar: #211616;\r\n\t\t\t--scrollbar-octave: #ff4c4c;\r\n\t\t\t--pitch-white-key: #bfbfbf;\r\n\t\t\t--pitch-black-key: #7a7a7a;\r\n\r\n\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t--pitch10-primary-note:     #d85d00;\r\n\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t--pitch12-primary-note:     #c26afc;\r\n\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t--noise4-primary-note:      #a5ff00;\r\n\t\t\t}\r\n\t`,\r\n\t\"halloween\": `\r\n\t:root {\r\n\t\t\t\t--page-margin: black;\r\n\t\t\t\t--editor-background: black;\r\n\t\t\t\t--hover-preview: white;\r\n\t\t\t\t--playhead: white;\r\n\t\t\t\t--primary-text: white;\r\n\t\t\t\t--secondary-text: #999;\r\n\t\t\t\t--inverted-text: black;\r\n\t\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t\t--loop-accent: #9e2200;\r\n\t\t\t\t--link-accent: #98f;\r\n\t\t\t\t--ui-widget-background: #363636;\r\n\t\t\t\t--ui-widget-focus: #777;\r\n\t\t\t\t--volume-icon: #9e2200;\t\r\n\r\n\t\t\t\t--tonic: #681701;\r\n\t\t\t\t--pitch1-background: #754a3f;\r\n\t\t\t\t--pitch2-background: #754a3f;\r\n\t\t\t\t--pitch3-background: #754a3f;\r\n\t\t\t\t--pitch4-background: #754a3f;\r\n\t\t\t\t--pitch5-background: #754a3f;\r\n\t\t\t\t--pitch6-background:#754a3f;\r\n\t\t\t\t--fifth-note: #914300;\r\n\t\t\t\t--pitch8-background: #754a3f;\r\n\t\t\t\t--pitch9-background: #754a3f;\r\n\t\t\t\t--pitch10-background: #754a3f;\r\n\t\t\t\t--pitch11-background: #754a3f;\r\n\t\t\t\t--pitch-background: #444;\r\n\r\n\t\t\t\t--octave-scrollbar: #9e2200; \r\n\t\t\t\t--scrollbar-octave: #701800;\r\n\r\n\t\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t\t--pitch10-primary-note:     #d85d00;\r\n\t\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\t\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t\t--pitch12-primary-note:     #c26afc;\r\n\t\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t\t--noise4-primary-note:      #a5ff00;\r\n\t\t\t}\r\n\t`,\r\n\t\"frozen\": `\r\n\t:root {\r\n\t\t\t\t--page-margin: black;\r\n\t\t\t\t--editor-background: black;\r\n\t\t\t\t--hover-preview: white;\r\n\t\t\t\t--playhead: white;\r\n\t\t\t\t--primary-text: white;\r\n\t\t\t\t--secondary-text: #999;\r\n\t\t\t\t--inverted-text: black;\r\n\t\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t\t--loop-accent: #38ef17;\r\n\t\t\t\t--link-accent: #98f;\r\n\t\t\t\t--ui-widget-background: #363636;\r\n\t\t\t\t--ui-widget-focus: #777;\r\n\t\t\t\t--volume-icon: #ed2d2d;\t\r\n\r\n\t\t\t\t--tonic: #88bce8; \r\n\t\t\t\t--pitch1-background: #99c8ef; \r\n\t\t\t\t--pitch2-background: #abd3f4; \r\n\t\t\t\t--pitch3-background: #b8d7f2; \r\n\t\t\t\t--pitch4-background: #cbe0f2;\r\n\t\t\t\t--pitch5-background: #e5f0f9; \r\n\t\t\t\t--pitch6-background: #ffffff; \r\n\t\t\t\t--fifth-note: #e5f0f9; \r\n\t\t\t\t--pitch8-background: #cbe0f2; \r\n\t\t\t\t--pitch9-background: #b8d7f2; \r\n\t\t\t\t--pitch10-background: #abd3f4; \r\n\t\t\t\t--pitch11-background: #99c8ef;\r\n\t\t\t\t--pitch-background: #444;\r\n\r\n\t\t\t\t--octave-scrollbar: #ffffff; \r\n\t\t\t\t--scrollbar-octave: #ed2d2d;\r\n\r\n\t\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t\t--pitch10-primary-note:     #d85d00;\r\n\t\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\t\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t\t--pitch12-primary-note:     #c26afc;\r\n\t\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t\t--noise4-primary-note:      #a5ff00;\r\n\t\t\t}\r\n\t`,\r\n\t}\r\n\r\n    public static readonly pageMargin: string = \"var(--page-margin, black)\";\r\n    public static readonly editorBackground: string = \"var(--editor-background, black)\";\r\n    public static readonly hoverPreview: string = \"var(--hover-preview, white)\";\r\n    public static readonly playhead: string = \"var(--playhead, white)\";\r\n    public static readonly primaryText: string = \"var(--primary-text, white)\";\r\n    public static readonly secondaryText: string = \"var(--secondary-text, #999)\";\r\n    public static readonly invertedText: string = \"var(--inverted-text, black)\";\r\n    public static readonly textSelection: string = \"var(--text-selection, rgba(119,68,255,0.99))\";\r\n    public static readonly boxSelectionFill: string = \"var(--box-selection-fill, rgba(255,255,255,0.2))\";\r\n    public static readonly loopAccent: string = \"var(--loop-accent, #9900cc)\";\r\n    public static readonly linkAccent: string = \"var(--link-accent, #98f)\";\r\n    public static readonly uiWidgetBackground: string = \"var(--ui-widget-background, #444)\";\r\n    public static readonly uiWidgetFocus: string = \"var(--ui-widget-focus)\";\r\n    public static readonly pitchBackground: string = \"var(--pitch-background, #444)\";\r\n    public static readonly tonic: string = \"var(--tonic, #864)\";\r\n    public static readonly fifthNote: string = \"var(--fifth-note, #468)\";\r\n\r\n\tpublic static readonly pitch1Background: string = \"var(--pitch1-background, var(--pitch-background, #444))\";\r\n\tpublic static readonly pitch2Background: string = \"var(--pitch2-background, var(--pitch-background, #444))\";\r\n\tpublic static readonly pitch3Background: string = \"var(--pitch3-background, var(--pitch-background, #444))\";\r\n\tpublic static readonly pitch4Background: string = \"var(--pitch4-background, var(--pitch-background, #444))\";\r\n\tpublic static readonly pitch5Background: string = \"var(--pitch5-background, var(--pitch-background, #444))\";\r\n\tpublic static readonly pitch6Background: string = \"var(--pitch6-background, var(--pitch-background, #444))\";\r\n\t// no need for a 7th since that's the --fifth-note's job\r\n\tpublic static readonly pitch8Background: string = \"var(--pitch8-background, var(--pitch-background, #444))\";\r\n\tpublic static readonly pitch9Background: string = \"var(--pitch9-background, var(--pitch-background, #444))\";\r\n\tpublic static readonly pitch10Background: string = \"var(--pitch10-background, var(--pitch-background, #444))\";\r\n\tpublic static readonly pitch11Background: string = \"var(--pitch11-background, var(--pitch-background, #444))\";\r\n    public static readonly volumeIcon: string = \"var(--volume-icon, #777777)\";\r\n\tpublic static readonly octaveScrollbar: string = \"var(--octave-scrollbar, #444444)\";\r\n\tpublic static readonly scrollbarOctave: string = \"var(--scrollbar-octave, #886644)\";\r\n\tpublic static readonly channelBox: string = \"var(--channel-box, #444444)\";\r\n\tpublic static readonly blackPianoKey: string = \"var(--black-piano-key, #444)\";\r\n\tpublic static readonly whitePianoKey: string = \"var(--white-piano-key, #bbb)\";\r\n\t\r\n\tpublic static readonly pitchChannels: DictionaryArray<ChannelColors> = toNameMap([\r\n        {\r\n            name: \"pitch1\", // cyan\r\n            secondaryChannel: \"var(--pitch1-secondary-channel)\",\r\n            primaryChannel: \"var(--pitch1-primary-channel)\",\r\n            secondaryNote: \"var(--pitch1-secondary-note)\",\r\n            primaryNote: \"var(--pitch1-primary-note)\",\r\n        }, {\r\n            name: \"pitch2\", // yellow\r\n            secondaryChannel: \"var(--pitch2-secondary-channel)\",\r\n            primaryChannel: \"var(--pitch2-primary-channel)\",\r\n            secondaryNote: \"var(--pitch2-secondary-note)\",\r\n            primaryNote: \"var(--pitch2-primary-note)\",\r\n        }, {\r\n            name: \"pitch3\", // orange\r\n            secondaryChannel: \"var(--pitch3-secondary-channel)\",\r\n            primaryChannel: \"var(--pitch3-primary-channel)\",\r\n            secondaryNote: \"var(--pitch3-secondary-note)\",\r\n            primaryNote: \"var(--pitch3-primary-note)\",\r\n        }, {\r\n            name: \"pitch4\", // green\r\n            secondaryChannel: \"var(--pitch4-secondary-channel)\",\r\n            primaryChannel: \"var(--pitch4-primary-channel)\",\r\n            secondaryNote: \"var(--pitch4-secondary-note)\",\r\n            primaryNote: \"var(--pitch4-primary-note)\",\r\n        }, {\r\n            name: \"pitch5\", // magenta\r\n            secondaryChannel: \"var(--pitch5-secondary-channel)\",\r\n            primaryChannel: \"var(--pitch5-primary-channel)\",\r\n            secondaryNote: \"var(--pitch5-secondary-note)\",\r\n            primaryNote: \"var(--pitch5-primary-note)\",\r\n        }, {\r\n            name: \"pitch6\", // blue\r\n            secondaryChannel: \"var(--pitch6-secondary-channel)\",\r\n            primaryChannel: \"var(--pitch6-primary-channel)\",\r\n            secondaryNote: \"var(--pitch6-secondary-note)\",\r\n            primaryNote: \"var(--pitch6-primary-note)\",\r\n        }, {\r\n            name: \"pitch7\", // olive\r\n            secondaryChannel: \"var(--pitch7-secondary-channel)\",\r\n            primaryChannel: \"var(--pitch7-primary-channel)\",\r\n            secondaryNote: \"var(--pitch7-secondary-note)\",\r\n            primaryNote: \"var(--pitch7-primary-note)\",\r\n        }, {\r\n            name: \"pitch8\", // red\r\n            secondaryChannel: \"var(--pitch8-secondary-channel)\",\r\n            primaryChannel: \"var(--pitch8-primary-channel)\",\r\n            secondaryNote: \"var(--pitch8-secondary-note)\",\r\n            primaryNote: \"var(--pitch8-primary-note)\",\r\n        }, {\r\n            name: \"pitch9\", // teal\r\n            secondaryChannel: \"var(--pitch9-secondary-channel)\",\r\n            primaryChannel: \"var(--pitch9-primary-channel)\",\r\n            secondaryNote: \"var(--pitch9-secondary-note)\",\r\n            primaryNote: \"var(--pitch9-primary-note)\",\r\n        }, {\r\n            name: \"pitch10\", // purple\r\n            secondaryChannel: \"var(--pitch10-secondary-channel)\",\r\n            primaryChannel: \"var(--pitch10-primary-channel)\",\r\n            secondaryNote: \"var(--pitch10-secondary-note)\",\r\n            primaryNote: \"var(--pitch10-primary-note)\",\r\n        },\r\n\t\t{\r\n            name: \"pitch11\", // teal\r\n            secondaryChannel: \"var(--pitch11-secondary-channel)\",\r\n            primaryChannel: \"var(--pitch11-primary-channel)\",\r\n            secondaryNote: \"var(--pitch11-secondary-note)\",\r\n            primaryNote: \"var(--pitch11-primary-note)\",\r\n        }, {\r\n            name: \"pitch12\", // purple\r\n            secondaryChannel: \"var(--pitch12-secondary-channel)\",\r\n            primaryChannel: \"var(--pitch12-primary-channel)\",\r\n            secondaryNote: \"var(--pitch12-secondary-note)\",\r\n            primaryNote: \"var(--pitch12-primary-note)\",\r\n        },\r\n    ]);\r\n\tpublic static readonly noiseChannels: DictionaryArray<ChannelColors> = toNameMap([\r\n        {\r\n            name: \"noise1\", // gray\r\n            secondaryChannel: \"var(--noise1-secondary-channel)\",\r\n            primaryChannel: \"var(--noise1-primary-channel)\",\r\n            secondaryNote: \"var(--noise1-secondary-note)\",\r\n            primaryNote: \"var(--noise1-primary-note)\",\r\n        }, {\r\n            name: \"noise2\", // brown\r\n            secondaryChannel: \"var(--noise2-secondary-channel)\",\r\n            primaryChannel: \"var(--noise2-primary-channel)\",\r\n            secondaryNote: \"var(--noise2-secondary-note)\",\r\n            primaryNote: \"var(--noise2-primary-note)\",\r\n        }, {\r\n            name: \"noise3\", // azure\r\n            secondaryChannel: \"var(--noise3-secondary-channel)\",\r\n            primaryChannel: \"var(--noise3-primary-channel)\",\r\n            secondaryNote: \"var(--noise3-secondary-note)\",\r\n            primaryNote: \"var(--noise3-primary-note)\",\r\n        }, {\r\n            name: \"noise4\", // purple\r\n            secondaryChannel: \"var(--noise4-secondary-channel)\",\r\n            primaryChannel: \"var(--noise4-primary-channel)\",\r\n            secondaryNote: \"var(--noise4-secondary-note)\",\r\n            primaryNote: \"var(--noise4-primary-note)\",\r\n        },\r\n    ]);\r\n\r\n\tpublic static getChannelColor(song: Song, channel: number): ChannelColors {\r\n\t\treturn channel < song.pitchChannelCount\r\n\t\t\t? ColorConfig.pitchChannels[channel % ColorConfig.pitchChannels.length]\r\n\t\t\t: ColorConfig.noiseChannels[(channel - song.pitchChannelCount) % ColorConfig.noiseChannels.length];\r\n\t}\r\n\t\tprivate static readonly _styleElement: HTMLStyleElement = document.head.appendChild(HTML.style({type: \"text/css\"}));\r\n\t\t\r\n\tpublic static setTheme(theme: string): void {\r\n\t\tthis._styleElement.textContent = this._themeMap[theme];\r\n\t\tthis.usesPianoScheme = (getComputedStyle(this._styleElement).getPropertyValue(\"--use-piano-scheme\").trim() == \"true\");\r\n\t\tconsole.log(\"use-piano-scheme: \"+this.usesPianoScheme);\r\n\t}\r\n}","/*\r\nCopyright (C) 2018 John Nesky\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of \r\nthis software and associated documentation files (the \"Software\"), to deal in \r\nthe Software without restriction, including without limitation the rights to \r\nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \r\nof the Software, and to permit persons to whom the Software is furnished to do \r\nso, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all \r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \r\nSOFTWARE.\r\n*/\r\n\r\nimport { HTML, SVG } from \"imperative-html/dist/esm/elements-strict\";\r\nimport { SongDocument } from \"./SongDocument\";\r\nimport { Note, NotePin, makeNotePin, makeNote, Pattern } from \"../synth/song\";\r\nimport {Config} from \"../synth/SynthConfig\";\r\nimport { UndoableChange, ChangeSequence } from \"./Change\";\r\nimport { ChangeChannelBar, ChangeNoteAdded, ChangeNoteTruncate, ChangePinTime, ChangeVolumeBend, ChangePitchBend, ChangePitchAdded, ChangeEnsurePatternExists } from \"./changes\";\r\nimport { ColorConfig } from \"./ColorConfig\";\r\n\tconst {div} = HTML;\r\n\r\n\r\n\tfunction prettyNumber(value: number): string {\r\n\t\treturn value.toFixed(2).replace(/\\.?0*$/, \"\");\r\n\t}\r\n\t\r\n\tfunction makeEmptyReplacementElement(node: Node): Node {\r\n\t\tconst clone: Node = node.cloneNode(false);\r\n\t\tnode.parentNode!.replaceChild(clone, node);\r\n\t\treturn clone;\r\n\t}\r\n\t\r\n\tclass PatternCursor {\r\n\t\tpublic valid:        boolean = false;\r\n\t\tpublic prevNote:     Note | null = null;\r\n\t\tpublic curNote:      Note | null = null;\r\n\t\tpublic nextNote:     Note | null = null;\r\n\t\tpublic pitch:        number = 0;\r\n\t\tpublic pitchIndex:   number = -1;\r\n\t\tpublic curIndex:     number = 0;\r\n\t\tpublic start:        number = 0;\r\n\t\tpublic end:          number = 0;\r\n\t\tpublic part:         number = 0;\r\n\t\tpublic notePart:     number = 0;\r\n\t\tpublic nearPinIndex: number = 0;\r\n\t\tpublic pins:         NotePin[] = [];\r\n\t}\r\n\t\r\n\texport class PatternEditor {\r\n\t\tprivate readonly _svgNoteBackground: SVGPatternElement = <SVGPatternElement> SVG.pattern( {id: \"patternEditorNoteBackground\", x: \"0\", y: \"0\", width: \"64\", height: \"156\", patternUnits: \"userSpaceOnUse\"});\r\n\t\tprivate readonly _svgDrumBackground: SVGPatternElement = <SVGPatternElement> SVG.pattern( {id: \"patternEditorDrumBackground\", x: \"0\", y: \"0\", width: \"64\", height: \"40\", patternUnits: \"userSpaceOnUse\"});\r\n\t\tprivate readonly _svgBackground: SVGRectElement = <SVGRectElement> SVG.rect( {x: \"0\", y: \"0\", width: \"512\", height: \"481\", \"pointer-events\": \"none\", fill: \"url(#patternEditorNoteBackground)\"});\r\n\t\tprivate _svgNoteContainer: SVGSVGElement = <SVGSVGElement> SVG.svg();\r\n\t\tprivate readonly _svgPlayhead: SVGRectElement = <SVGRectElement> SVG.rect( {id: \"\", x: \"0\", y: \"0\", width: \"4\", height: \"481\", fill: \"white\", \"pointer-events\": \"none\"});\r\n\t\tprivate readonly _svgPreview: SVGPathElement = <SVGPathElement> SVG.path( {fill: \"none\", stroke: \"white\", \"stroke-width\": \"2\", \"pointer-events\": \"none\"});\r\n\t\tprivate readonly _svg: SVGSVGElement = <SVGSVGElement> SVG.svg( {style: \"touch-action: none; position: absolute;\", width: \"100%\", height: \"100%\", viewBox: \"0 0 512 481\", preserveAspectRatio: \"none\"}, [\r\n\t\t\tSVG.defs( undefined, [\r\n\t\t\t\tthis._svgNoteBackground,\r\n\t\t\t\tthis._svgDrumBackground,\r\n\t\t\t]),\r\n\t\t\tthis._svgBackground,\r\n\t\t\tthis._svgNoteContainer,\r\n\t\t\tthis._svgPreview,\r\n\t\t\tthis._svgPlayhead,\r\n\t\t]);\r\n\t\tpublic readonly container: HTMLDivElement = div({style: \"height: 100%; overflow:hidden; position: relative; flex-grow: 1;\"}, [this._svg]);\r\n\t\t\r\n\t\tprivate readonly _defaultPitchHeight: number = 13;\r\n\t\tprivate readonly _defaultDrumHeight: number = 40;\r\n\t\tprivate readonly _backgroundPitchRows: SVGRectElement[] = [];\r\n\t\tprivate readonly _backgroundDrumRow: SVGRectElement = <SVGRectElement> SVG.rect();\r\n\t\t// The below array is unused.\r\n\t\tpublic readonly _defaultPinChannels: NotePin[][] = [\r\n\t\t\t[makeNotePin(0, 0, 3), makeNotePin(0, 2, 3)],\r\n\t\t\t[makeNotePin(0, 0, 3), makeNotePin(0, 2, 3)],\r\n\t\t\t[makeNotePin(0, 0, 3), makeNotePin(0, 2, 3)],\r\n\t\t\t[makeNotePin(0, 0, 3), makeNotePin(0, 2, 0)],\r\n\t\t];\r\n\t\t\r\n\t\tprivate _editorWidth: number;\r\n\t\tprivate _editorHeight: number = 481;\r\n\t\tprivate _partWidth: number;\r\n\t\tprivate _pitchHeight: number;\r\n\t\tprivate _pitchCount: number;\r\n\t\tprivate _mouseX: number = 0;\r\n\t\tprivate _mouseY: number = 0;\r\n\t\tprivate _mouseDown: boolean = false;\r\n\t\tprivate _mouseOver: boolean = false;\r\n\t\tprivate _mouseDragging: boolean = false;\r\n\t\tprivate _mouseHorizontal: boolean = false;\r\n\t\tprivate _usingTouch: boolean = false;\r\n\t\tprivate _copiedPinChannels: NotePin[][] = [];\r\n\t\tprivate _copiedPins: NotePin[];\r\n\t\tprivate _mouseXStart: number = 0;\r\n\t\tprivate _mouseYStart: number = 0;\r\n\t\tpublic _mouseXPrev: number = 0;\r\n\t\tpublic _mouseYPrev: number = 0;\r\n\t\tprivate _dragTime: number = 0;\r\n\t\tprivate _dragPitch: number = 0;\r\n\t\tprivate _dragVolume: number = 0;\r\n\t\tprivate _dragVisible: boolean = false;\r\n\t\t//private _precise: boolean = false;\r\n\t\t//private _precisionX: number = 0;\r\n\t\tprivate _dragChange: UndoableChange | null = null;\r\n\t\tprivate _cursor: PatternCursor = new PatternCursor();\r\n\t\tprivate _pattern: Pattern | null = null;\r\n\t\tprivate _playheadX: number = 0.0;\r\n\t\tprivate _octaveOffset: number = 0;\r\n\t\tprivate _renderedWidth: number = -1;\r\n\t\tprivate _renderedBeatWidth: number = -1;\r\n\t\tprivate _renderedFifths: boolean = false;\r\n\t\tprivate _renderedACS: boolean = false;\r\n\t\tprivate _renderedPiano: boolean = false;\r\n\t\tprivate _renderedDrums: boolean = false;\r\n\t\tprivate _setKey: number = 1;\r\n\t\tprivate _renderedPartsPerBeat: number = -1;\r\n\t\tprivate _renderedPitchChannelCount: number = -1;\r\n\t\tprivate _renderedDrumChannelCount: number = -1;\r\n\t\tprivate _followPlayheadBar: number = -1;\r\n\t\t\r\n\t\tconstructor(private _doc: SongDocument) {\r\n\t\t\tfor (let i: number = 0; i < 12; i++) {\r\n\t\t\t\tconst y: number = (12 - i) % 12;\r\n\t\t\t\tconst rectangle: SVGRectElement = <SVGRectElement> SVG.rect();\r\n\t\t\t\trectangle.setAttribute(\"x\", \"1\");\r\n\t\t\t\trectangle.setAttribute(\"y\", \"\" + (y * this._defaultPitchHeight + 1));\r\n\t\t\t\trectangle.setAttribute(\"height\", \"\" + (this._defaultPitchHeight - 2));\r\n\t\t\t\trectangle.setAttribute(\"fill\", (i == 0) ? ColorConfig.tonic : ColorConfig.uiWidgetBackground);\r\n\t\t\t\tthis._svgNoteBackground.appendChild(rectangle);\r\n\t\t\t\tthis._backgroundPitchRows[i] = rectangle;\r\n\t\t\t}\r\n\r\n\t\t\tthis._svg.style.backgroundColor = ColorConfig.editorBackground;\r\n\r\n\t\t\tthis._backgroundDrumRow.setAttribute(\"x\", \"1\");\r\n\t\t\tthis._backgroundDrumRow.setAttribute(\"y\", \"1\");\r\n\t\t\tthis._backgroundDrumRow.setAttribute(\"height\", \"\" + (this._defaultDrumHeight - 2));\r\n\t\t\tthis._backgroundDrumRow.setAttribute(\"fill\", \"#444444\");\r\n\t\t\tthis._svgDrumBackground.appendChild(this._backgroundDrumRow);\r\n\t\t\t\r\n\t\t\tthis._doc.notifier.watch(this._documentChanged);\r\n\t\t\tthis._documentChanged();\r\n\t\t\tthis._updateCursorStatus();\r\n\t\t\tthis._updatePreview();\r\n\t\t\twindow.requestAnimationFrame(this._animatePlayhead);\r\n\t\t\tthis._svg.addEventListener(\"mousedown\", this._whenMousePressed);\r\n\t\t\tdocument.addEventListener(\"mousemove\", this._whenMouseMoved);\r\n\t\t\tdocument.addEventListener(\"mouseup\", this._whenCursorReleased);\r\n\t\t\tthis._svg.addEventListener(\"mouseover\", this._whenMouseOver);\r\n\t\t\tthis._svg.addEventListener(\"mouseout\", this._whenMouseOut);\r\n\t\t\t\r\n\t\t\tthis._svg.addEventListener(\"touchstart\", this._whenTouchPressed);\r\n\t\t\tthis._svg.addEventListener(\"touchmove\", this._whenTouchMoved);\r\n\t\t\tthis._svg.addEventListener(\"touchend\", this._whenCursorReleased);\r\n\t\t\tthis._svg.addEventListener(\"touchcancel\", this._whenCursorReleased);\r\n\t\t\t\r\n\t\t\tthis.resetCopiedPins();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _getMaxDivision(): number {\r\n\t\t\tif (this._doc.song.partsPerBeat % 3 == 0) {\r\n\t\t\t\t// Beat is divisible by 3.\r\n\t\t\t\treturn this._doc.song.partsPerBeat / 3;\r\n\t\t\t} else if (this._doc.song.partsPerBeat % 2 == 0) {\r\n\t\t\t\t// Beat is divisible by 2.\r\n\t\t\t\treturn this._doc.song.partsPerBeat / 2;\r\n\t\t\t}\r\n\t\t\treturn this._doc.song.partsPerBeat;\r\n\t\t}\r\n\t\t\r\n\t\tprivate _updateCursorStatus(): void {\r\n\t\t\t//if (this._pattern == null) return;\r\n\t\t\t\r\n\t\t\tthis._cursor = new PatternCursor();\r\n\t\t\t\r\n\t\t\tif (this._mouseX < 0 || this._mouseX > this._editorWidth || this._mouseY < 0 || this._mouseY > this._editorHeight) return;\r\n\t\t\t\r\n\t\t\tthis._cursor.part = Math.floor(Math.max(0, Math.min(this._doc.song.beatsPerBar * this._doc.song.partsPerBeat - 1, this._mouseX / this._partWidth)));\r\n\t\t\t\r\n\t\t\tif (this._pattern != null) {\r\n\t\t\t\tfor (const note of this._pattern.notes) {\r\n\t\t\t\t\tif (note.end <= this._cursor.part) {\r\n\t\t\t\t\t\tthis._cursor.prevNote = note;\r\n\t\t\t\t\t\tthis._cursor.curIndex++;\r\n\t\t\t\t\t} else if (note.start <= this._cursor.part && note.end > this._cursor.part) {\r\n\t\t\t\t\t\tthis._cursor.curNote = note;\r\n\t\t\t\t\t} else if (note.start > this._cursor.part) {\r\n\t\t\t\t\t\tthis._cursor.nextNote = note;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tlet mousePitch: number = this._findMousePitch(this._mouseY);\r\n\t\t\t\r\n\t\t\tif (this._cursor.curNote != null) {\r\n\t\t\t\tthis._cursor.start = this._cursor.curNote.start;\r\n\t\t\t\tthis._cursor.end   = this._cursor.curNote.end;\r\n\t\t\t\tthis._cursor.pins  = this._cursor.curNote.pins;\r\n\t\t\t\t\r\n\t\t\t\tlet interval: number = 0;\r\n\t\t\t\tlet error: number = 0;\r\n\t\t\t\tlet prevPin: NotePin;\r\n\t\t\t\tlet nextPin: NotePin = this._cursor.curNote.pins[0];\r\n\t\t\t\tfor (let j: number = 1; j < this._cursor.curNote.pins.length; j++) {\r\n\t\t\t\t\tprevPin = nextPin;\r\n\t\t\t\t\tnextPin = this._cursor.curNote.pins[j];\r\n\t\t\t\t\tconst leftSide:    number = this._partWidth * (this._cursor.curNote.start + prevPin.time);\r\n\t\t\t\t\tconst rightSide:   number = this._partWidth * (this._cursor.curNote.start + nextPin.time);\r\n\t\t\t\t\tif (this._mouseX > rightSide) continue;\r\n\t\t\t\t\tif (this._mouseX < leftSide) throw new Error();\r\n\t\t\t\t\tconst intervalRatio: number = (this._mouseX - leftSide) / (rightSide - leftSide);\r\n\t\t\t\t\tconst arc: number = Math.sqrt(1.0 / Math.sqrt(4.0) - Math.pow(intervalRatio - 0.5, 2.0)) - 0.5;\r\n\t\t\t\t\tconst bendHeight: number = Math.abs(nextPin.interval - prevPin.interval);\r\n\t\t\t\t\tinterval = prevPin.interval * (1.0 - intervalRatio) + nextPin.interval * intervalRatio;\r\n\t\t\t\t\terror = arc * bendHeight + 1.0;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tlet minInterval: number = Number.MAX_VALUE;\r\n\t\t\t\tlet maxInterval: number = -Number.MAX_VALUE;\r\n\t\t\t\tlet bestDistance: number = Number.MAX_VALUE;\r\n\t\t\t\tfor (const pin of this._cursor.curNote.pins) {\r\n\t\t\t\t\tif (minInterval > pin.interval) minInterval = pin.interval;\r\n\t\t\t\t\tif (maxInterval < pin.interval) maxInterval = pin.interval;\r\n\t\t\t\t\tconst pinDistance: number = Math.abs(this._cursor.curNote.start + pin.time - this._mouseX / this._partWidth);\r\n\t\t\t\t\tif (bestDistance > pinDistance) {\r\n\t\t\t\t\t\tbestDistance = pinDistance;\r\n\t\t\t\t\t\tthis._cursor.nearPinIndex = this._cursor.curNote.pins.indexOf(pin);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tmousePitch -= interval;\r\n\t\t\t\tthis._cursor.pitch = this._snapToPitch(mousePitch, -minInterval, (this._doc.song.getChannelIsDrum(this._doc.channel) ? Config.drumCount - 1 : Config.maxPitch) - maxInterval);\r\n\t\t\t\t\r\n\t\t\t\t// Snap to nearby existing note if present.\r\n\t\t\t\t// @TODO: Do this for all channels? ModBox excludes the 4th\r\n\t\t\t\t// channel for some unknown reason.\r\n\t\t\t\tif (this._doc.channel != 3/*!this._doc.song.getChannelIsDrum(this._doc.channel)*/) {\r\n\t\t\t\t\tlet nearest: number = error;\r\n\t\t\t\t\tfor (let i: number = 0; i < this._cursor.curNote.pitches.length; i++) {\r\n\t\t\t\t\t\tconst distance: number = Math.abs(this._cursor.curNote.pitches[i] - mousePitch + 0.5);\r\n\t\t\t\t\t\tif (distance > nearest) continue;\r\n\t\t\t\t\t\tnearest = distance;\r\n\t\t\t\t\t\tthis._cursor.pitch = this._cursor.curNote.pitches[i];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tfor (let i: number = 0; i < this._cursor.curNote.pitches.length; i++) {\r\n\t\t\t\t\tif (this._cursor.curNote.pitches[i] == this._cursor.pitch) {\r\n\t\t\t\t\t\tthis._cursor.pitchIndex = i;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthis._cursor.pitch = this._snapToPitch(mousePitch, 0, Config.maxPitch);\r\n\t\t\t\tconst defaultLength: number = this._copiedPins[this._copiedPins.length-1].time;\r\n\t\t\t\tconst fullBeats: number = Math.floor(this._cursor.part / this._doc.song.partsPerBeat);\r\n\t\t\t\tconst maxDivision: number = this._getMaxDivision();\r\n\t\t\t\tconst modMouse: number = this._cursor.part % this._doc.song.partsPerBeat;\r\n\t\t\t\tif (defaultLength == 1) {\r\n\t\t\t\t\tthis._cursor.start = this._cursor.part;\r\n\t\t\t\t} else if (defaultLength > this._doc.song.partsPerBeat) {\r\n\t\t\t\t\tthis._cursor.start = fullBeats * this._doc.song.partsPerBeat;\r\n\t\t\t\t} else if (defaultLength == this._doc.song.partsPerBeat) {\r\n\t\t\t\t\tthis._cursor.start = fullBeats * this._doc.song.partsPerBeat;\r\n\t\t\t\t\tif (maxDivision < this._doc.song.partsPerBeat && modMouse > maxDivision) {\r\n\t\t\t\t\t\tthis._cursor.start += Math.floor(modMouse / maxDivision) * maxDivision;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis._cursor.start = fullBeats * this._doc.song.partsPerBeat;\r\n\t\t\t\t\tlet division = this._doc.song.partsPerBeat % defaultLength == 0 ? defaultLength : Math.min(defaultLength, maxDivision);\r\n\t\t\t\t\twhile (division < maxDivision && this._doc.song.partsPerBeat % division != 0) {\r\n\t\t\t\t\t\tdivision++;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis._cursor.start += Math.floor(modMouse / division) * division;\r\n\t\t\t\t}\r\n\t\t\t\tthis._cursor.end = this._cursor.start + defaultLength;\r\n\t\t\t\tlet forceStart: number = 0;\r\n\t\t\t\tlet forceEnd: number = this._doc.song.beatsPerBar * this._doc.song.partsPerBeat;\r\n\t\t\t\tif (this._cursor.prevNote != null) {\r\n\t\t\t\t\tforceStart = this._cursor.prevNote.end;\r\n\t\t\t\t}\r\n\t\t\t\tif (this._cursor.nextNote != null) {\r\n\t\t\t\t\tforceEnd   = this._cursor.nextNote.start;\r\n\t\t\t\t}\r\n\t\t\t\tif (this._cursor.start < forceStart) {\r\n\t\t\t\t\tthis._cursor.start = forceStart;\r\n\t\t\t\t\tthis._cursor.end = this._cursor.start + defaultLength;\r\n\t\t\t\t\tif (this._cursor.end > forceEnd) {\r\n\t\t\t\t\t\tthis._cursor.end = forceEnd;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (this._cursor.end > forceEnd) {\r\n\t\t\t\t\tthis._cursor.end = forceEnd;\r\n\t\t\t\t\tthis._cursor.start = this._cursor.end - defaultLength;\r\n\t\t\t\t\tif (this._cursor.start < forceStart) {\r\n\t\t\t\t\t\tthis._cursor.start = forceStart;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif (this._cursor.end - this._cursor.start == defaultLength) {\r\n\t\t\t\t\tthis._cursor.pins = this._copiedPins;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis._cursor.pins = [];\r\n\t\t\t\t\tfor (const oldPin of this._copiedPins) {\r\n\t\t\t\t\t\tif (oldPin.time <= this._cursor.end - this._cursor.start) {\r\n\t\t\t\t\t\t\tthis._cursor.pins.push(makeNotePin(0, oldPin.time, oldPin.volume));\r\n\t\t\t\t\t\t\tif (oldPin.time == this._cursor.end - this._cursor.start) break;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis._cursor.pins.push(makeNotePin(0, this._cursor.end - this._cursor.start, oldPin.volume));\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._cursor.valid = true;\r\n\t\t}\r\n\t\t\r\n\t\tprivate _findMousePitch(pixelY: number): number {\r\n\t\t\treturn Math.max(0, Math.min(this._pitchCount - 1, this._pitchCount - (pixelY / this._pitchHeight))) + this._octaveOffset;\r\n\t\t}\r\n\t\t\r\n\t\tprivate _snapToPitch(guess: number, min: number, max: number): number {\r\n\t\t\tif (guess < min) guess = min;\r\n\t\t\tif (guess > max) guess = max;\r\n\t\t\tconst scale: ReadonlyArray<boolean> = Config.scales[this._doc.song.scale].flags;\r\n\t\t\tif (scale[Math.floor(guess) % 12] || this._doc.song.getChannelIsDrum(this._doc.channel)) {\r\n\t\t\t\treturn Math.floor(guess);\r\n\t\t\t} else {\r\n\t\t\t\tlet topPitch: number = Math.floor(guess) + 1;\r\n\t\t\t\tlet bottomPitch: number = Math.floor(guess) - 1;\r\n\t\t\t\twhile (!scale[topPitch % 12]) {\r\n\t\t\t\t\ttopPitch++;\r\n\t\t\t\t}\r\n\t\t\t\twhile (!scale[(bottomPitch) % 12]) {\r\n\t\t\t\t\tbottomPitch--;\r\n\t\t\t\t}\r\n\t\t\t\tif (topPitch > max) {\r\n\t\t\t\t\tif (bottomPitch < min) {\r\n\t\t\t\t\t\treturn min;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn bottomPitch;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (bottomPitch < min) {\r\n\t\t\t\t\treturn topPitch;\r\n\t\t\t\t}\r\n\t\t\t\tlet topRange: number = topPitch;\r\n\t\t\t\tlet bottomRange: number = bottomPitch + 1;\r\n\t\t\t\tif (topPitch % 12 == 0 || topPitch % 12 == 7) {\r\n\t\t\t\t\ttopRange -= 0.5;\r\n\t\t\t\t}\r\n\t\t\t\tif (bottomPitch % 12 == 0 || bottomPitch % 12 == 7) {\r\n\t\t\t\t\tbottomRange += 0.5;\r\n\t\t\t\t}\r\n\t\t\t\treturn guess - bottomRange > topRange - guess ? topPitch : bottomPitch;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tprivate _copyPins(note: Note): void {\r\n\t\t\tthis._copiedPins = [];\r\n\t\t\tfor (const oldPin of note.pins) {\r\n\t\t\t\tthis._copiedPins.push(makeNotePin(0, oldPin.time, oldPin.volume));\r\n\t\t\t}\r\n\t\t\tfor (let i: number = 1; i < this._copiedPins.length - 1; ) {\r\n\t\t\t\tif (this._copiedPins[i-1].volume == this._copiedPins[i].volume && \r\n\t\t\t\t    this._copiedPins[i].volume == this._copiedPins[i+1].volume)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis._copiedPins.splice(i, 1);\r\n\t\t\t\t} else {\r\n\t\t\t\t\ti++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis._copiedPinChannels[this._doc.channel] = this._copiedPins;\r\n\t\t}\r\n\t\t\r\n\t\tpublic resetCopiedPins = (): void => {\r\n\t\t\tconst maxDivision: number = this._getMaxDivision();\r\n\t\t\tthis._copiedPinChannels.length = this._doc.song.getChannelCount();\r\n\t\t\tfor (let i: number = 0; i < this._doc.song.pitchChannelCount; i++) {\r\n\t\t\t\tthis._copiedPinChannels[i] = [makeNotePin(0, 0, 3), makeNotePin(0, maxDivision, 3)];\r\n\t\t\t}\r\n\t\t\tfor (let i: number = this._doc.song.pitchChannelCount; i < this._doc.song.getChannelCount(); i++) {\r\n\t\t\t\tthis._copiedPinChannels[i] = [makeNotePin(0, 0, 3), makeNotePin(0, maxDivision, 0)];\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tprivate _animatePlayhead = (timestamp: number): void => {\r\n\t\t\tconst playheadBar: number = Math.floor(this._doc.synth.playhead);\r\n\t\t\tif (this._doc.synth.playing && ((this._pattern != null && this._doc.song.getPattern(this._doc.channel, Math.floor(this._doc.synth.playhead)) == this._pattern) || Math.floor(this._doc.synth.playhead) == this._doc.bar)) {\r\n\t\t\t\tthis._svgPlayhead.setAttribute(\"visibility\", \"visible\");\r\n\t\t\t\tconst modPlayhead: number = this._doc.synth.playhead - playheadBar;\r\n\t\t\t\tif (Math.abs(modPlayhead - this._playheadX) > 0.1) {\r\n\t\t\t\t\tthis._playheadX = modPlayhead;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis._playheadX += (modPlayhead - this._playheadX) * 0.2;\r\n\t\t\t\t}\r\n\t\t\t\tthis._svgPlayhead.setAttribute(\"x\", \"\" + prettyNumber(this._playheadX * this._editorWidth - 2));\r\n\t\t\t} else {\r\n\t\t\t\tthis._svgPlayhead.setAttribute(\"visibility\", \"hidden\"); \r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (this._doc.synth.playing && this._doc.prefs.autoFollow && this._followPlayheadBar != playheadBar) {\r\n\t\t\t\tnew ChangeChannelBar(this._doc, this._doc.channel, playheadBar);\r\n\t\t\t\tthis._doc.notifier.notifyWatchers();\r\n\t\t\t}\r\n\t\t\tthis._followPlayheadBar = playheadBar;\r\n\t\t\twindow.requestAnimationFrame(this._animatePlayhead);\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenMouseOver = (event: MouseEvent): void => {\r\n\t\t\tif (this._mouseOver) return;\r\n\t\t\tthis._mouseOver = true;\r\n\t\t\tthis._usingTouch = false;\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenMouseOut = (event: MouseEvent): void => {\r\n\t\t\tif (!this._mouseOver) return;\r\n\t\t\tthis._mouseOver = false;\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenMousePressed = (event: MouseEvent): void => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tconst boundingRect: ClientRect = this._svg.getBoundingClientRect();\r\n    \t\tthis._mouseX = ((event.clientX || event.pageX) - boundingRect.left) * this._editorWidth / (boundingRect.right - boundingRect.left);\r\n\t\t    this._mouseY = ((event.clientY || event.pageY) - boundingRect.top) * this._editorHeight / (boundingRect.bottom - boundingRect.top);\r\n\t\t    if (isNaN(this._mouseX)) this._mouseX = 0;\r\n\t\t    if (isNaN(this._mouseY)) this._mouseY = 0;\r\n\t\t\tthis._usingTouch = false;\r\n\t\t\tthis._whenCursorPressed();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenTouchPressed = (event: TouchEvent): void => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tconst boundingRect: ClientRect = this._svg.getBoundingClientRect();\r\n\t\t\tthis._mouseX = (event.touches[0].clientX - boundingRect.left) * this._editorWidth / (boundingRect.right - boundingRect.left);\r\n\t\t\tthis._mouseY = (event.touches[0].clientY - boundingRect.top) * this._editorHeight / (boundingRect.bottom - boundingRect.top);\r\n\t\t    if (isNaN(this._mouseX)) this._mouseX = 0;\r\n\t\t    if (isNaN(this._mouseY)) this._mouseY = 0;\r\n\t\t\tthis._usingTouch = true;\r\n\t\t\tthis._whenCursorPressed();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenCursorPressed(): void {\r\n\t\t\tthis._mouseDown = true;\r\n\t\t\tthis._mouseXStart = this._mouseX;\r\n\t\t\tthis._mouseYStart = this._mouseY;\r\n\t\t\tthis._mouseXPrev = this._mouseX;\r\n\t\t\tthis._mouseYPrev = this._mouseY;\r\n\t\t\tthis._updateCursorStatus();\r\n\t\t\tthis._updatePreview();\r\n\t\t\tthis._dragChange = new ChangeSequence();\r\n\t\t\tthis._doc.setProspectiveChange(this._dragChange);\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenMouseMoved = (event: MouseEvent): void => {\r\n\t\t\tconst boundingRect: ClientRect = this._svg.getBoundingClientRect();\r\n    \t\tthis._mouseX = ((event.clientX || event.pageX) - boundingRect.left) * this._editorWidth / (boundingRect.right - boundingRect.left);\r\n\t\t    this._mouseY = ((event.clientY || event.pageY) - boundingRect.top) * this._editorHeight / (boundingRect.bottom - boundingRect.top);\r\n\t\t    if (isNaN(this._mouseX)) this._mouseX = 0;\r\n\t\t    if (isNaN(this._mouseY)) this._mouseY = 0;\r\n\t\t\tthis._usingTouch = false;\r\n\t\t    this._whenCursorMoved();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenTouchMoved = (event: TouchEvent): void => {\r\n\t\t\tif (!this._mouseDown) return;\r\n\t\t\tevent.preventDefault();\r\n\t\t\tconst boundingRect: ClientRect = this._svg.getBoundingClientRect();\r\n\t\t\tthis._mouseX = (event.touches[0].clientX - boundingRect.left) * this._editorWidth / (boundingRect.right - boundingRect.left);\r\n\t\t\tthis._mouseY = (event.touches[0].clientY - boundingRect.top) * this._editorHeight / (boundingRect.bottom - boundingRect.top);\r\n\t\t    if (isNaN(this._mouseX)) this._mouseX = 0;\r\n\t\t    if (isNaN(this._mouseY)) this._mouseY = 0;\r\n\t\t    this._whenCursorMoved();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenCursorMoved(): void {\r\n\t\t\tlet start: number;\r\n\t\t\tlet end: number;\r\n\t\t\t\r\n\t\t\t// HACK: Undoable pattern changes rely on persistent instance\r\n\t\t\t// references. Loading song from hash via undo/redo breaks that,\r\n\t\t\t// so changes are no longer undoable and the cursor status may be\r\n\t\t\t// invalid. Abort further drag changes until the mouse is released.\r\n\t\t\tconst continuousState: boolean = this._doc.lastChangeWas(this._dragChange);\r\n\t\t\t\r\n\t\t\tif (this._mouseDown && this._cursor.valid && continuousState) {\r\n\t\t\t\tif (!this._mouseDragging) {\r\n\t\t\t\t\tconst dx: number = this._mouseX - this._mouseXStart;\r\n\t\t\t\t\tconst dy: number = this._mouseY - this._mouseYStart;\r\n\t\t\t\t\tif (Math.sqrt(dx * dx + dy * dy) > 5) {\r\n\t\t\t\t\t\tthis._mouseDragging = true;\r\n\t\t\t\t\t\tthis._mouseHorizontal = Math.abs(dx) >= Math.abs(dy);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif (this._mouseDragging) {\r\n\t\t\t\t\tif (this._dragChange != null) {\r\n\t\t\t\t\t\tthis._dragChange.undo();\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tconst currentPart: number = Math.floor(this._mouseX / this._partWidth);\r\n\t\t\t\t\tconst sequence: ChangeSequence = new ChangeSequence();\r\n\t\t\t\t\tthis._dragChange = sequence;\r\n\t\t\t\t\tthis._doc.setProspectiveChange(this._dragChange);\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (this._cursor.curNote == null) {\r\n\t\t\t\t\t\tlet backwards: boolean;\r\n\t\t\t\t\t\tlet directLength: number;\r\n\t\t\t\t\t\tif (currentPart < this._cursor.start) {\r\n\t\t\t\t\t\t\tbackwards = true;\r\n\t\t\t\t\t\t\tdirectLength = this._cursor.start - currentPart;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tbackwards = false;\r\n\t\t\t\t\t\t\tdirectLength = currentPart - this._cursor.start + 1;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tlet defaultLength: number = 1;\r\n\t\t\t\t\t\tfor (let i: number = 0; i <= this._doc.song.beatsPerBar * this._doc.song.partsPerBeat; i++) {\r\n\t\t\t\t\t\t\tif (i >= 5 &&\r\n\t\t\t\t\t\t\t    i % this._doc.song.partsPerBeat != 0 &&\r\n\t\t\t\t\t\t\t    i != this._doc.song.partsPerBeat * 3.0 / 2.0 &&\r\n\t\t\t\t\t\t\t    i != this._doc.song.partsPerBeat * 4.0 / 3.0 &&\r\n\t\t\t\t\t\t\t    i != this._doc.song.partsPerBeat * 5.0 / 3.0)\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tconst blessedLength: number = i;\r\n\t\t\t\t\t\t\tif (blessedLength == directLength) {\r\n\t\t\t\t\t\t\t\tdefaultLength = blessedLength;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (blessedLength < directLength) {\r\n\t\t\t\t\t\t\t\tdefaultLength = blessedLength;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (blessedLength > directLength) {\r\n\t\t\t\t\t\t\t\tif (defaultLength < directLength - 1) {\r\n\t\t\t\t\t\t\t\t\tdefaultLength = blessedLength;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t/*\r\n\t\t\t\t\t\tif (defaultLength < directLength) {\r\n\t\t\t\t\t\t\t// See if I can find a better match by snapping to an existing note...\r\n\t\t\t\t\t\t\t// E.G. in another channel\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t*/\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif (backwards) {\r\n\t\t\t\t\t\t\tend = this._cursor.start;\r\n\t\t\t\t\t\t\tstart = end - defaultLength;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tstart = this._cursor.start;\r\n\t\t\t\t\t\t\tend = start + defaultLength;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (start < 0) start = 0;\r\n\t\t\t\t\t\tif (end > this._doc.song.beatsPerBar * this._doc.song.partsPerBeat) end = this._doc.song.beatsPerBar * this._doc.song.partsPerBeat;\r\n\t\t\t\t\t\tif (start < end) {\r\n\t\t\t\t\t\t\tsequence.append(new ChangeEnsurePatternExists(this._doc));\r\n\t\t\t\t\t\t\t\tconst pattern: Pattern | null = this._doc.getCurrentPattern();\r\n\t\t\t\t\t\t\t\tif (pattern == null) throw new Error();\r\n\t\t\t\t\t\t\t\tsequence.append(new ChangeNoteTruncate(this._doc, pattern, start, end));\r\n\t\t\t\t\t\t\tlet i: number;\r\n\t\t\t\t\t\t\tfor (i = 0; i < pattern.notes.length; i++) {\r\n\t\t\t\t\t\t\t\tif (pattern.notes[i].start >= end) break;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tconst theNote: Note = makeNote(this._cursor.pitch, start, end, 3, this._doc.song.getChannelIsDrum(this._doc.channel));\r\n\t\t\t\t\t\t\tsequence.append(new ChangeNoteAdded(this._doc, pattern, theNote, i));\r\n\t\t\t\t\t\t\tthis._copyPins(theNote);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tthis._dragTime = backwards ? start : end;\r\n\t\t\t\t\t\t\tthis._dragPitch = this._cursor.pitch;\r\n\t\t\t\t\t\t\tthis._dragVolume = theNote.pins[backwards ? 0 : 1].volume;\r\n\t\t\t\t\t\t\tthis._dragVisible = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis._pattern = this._doc.getCurrentPattern();\r\n\t\t\t\t\t} else if (this._mouseHorizontal) {\r\n\t\t\t\t\t\tconst shift: number = Math.round((this._mouseX - this._mouseXStart) / this._partWidth);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tconst shiftedPin: NotePin = this._cursor.curNote.pins[this._cursor.nearPinIndex];\r\n\t\t\t\t\t\tlet shiftedTime: number = this._cursor.curNote.start + shiftedPin.time + shift;\r\n\t\t\t\t\t\tif (shiftedTime < 0) shiftedTime = 0;\r\n\t\t\t\t\t\tif (shiftedTime > this._doc.song.beatsPerBar * this._doc.song.partsPerBeat) shiftedTime = this._doc.song.beatsPerBar * this._doc.song.partsPerBeat;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif (this._pattern == null) throw new Error();\r\n\r\n\t\t\t\t\t\tif (shiftedTime <= this._cursor.curNote.start && this._cursor.nearPinIndex == this._cursor.curNote.pins.length - 1 ||\r\n\t\t\t\t\t\t    shiftedTime >= this._cursor.curNote.end   && this._cursor.nearPinIndex == 0)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tsequence.append(new ChangeNoteAdded(this._doc, this._pattern, this._cursor.curNote, this._cursor.curIndex, true));\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tthis._dragVisible = false;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tstart = Math.min(this._cursor.curNote.start, shiftedTime);\r\n\t\t\t\t\t\t\tend   = Math.max(this._cursor.curNote.end,   shiftedTime);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tthis._dragTime = shiftedTime;\r\n\t\t\t\t\t\t\tthis._dragPitch = this._cursor.curNote.pitches[this._cursor.pitchIndex == -1 ? 0 : this._cursor.pitchIndex] + this._cursor.curNote.pins[this._cursor.nearPinIndex].interval;\r\n\t\t\t\t\t\t\tthis._dragVolume = this._cursor.curNote.pins[this._cursor.nearPinIndex].volume;\r\n\t\t\t\t\t\t\tthis._dragVisible = true;\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (this._pattern == null) throw new Error();\r\n\r\n\t\t\t\t\t\t\tsequence.append(new ChangeNoteTruncate(this._doc, this._pattern, start, end, this._cursor.curNote));\r\n\t\t\t\t\t\t\tsequence.append(new ChangePinTime(this._doc, this._cursor.curNote, this._cursor.nearPinIndex, shiftedTime));\r\n\t\t\t\t\t\t\tthis._copyPins(this._cursor.curNote);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if (this._cursor.pitchIndex == -1) {\r\n\t\t\t\t\t\tconst bendPart: number = Math.round(Math.max(this._cursor.curNote.start, Math.min(this._cursor.curNote.end, this._mouseX / this._partWidth))) - this._cursor.curNote.start;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tlet prevPin: NotePin;\r\n\t\t\t\t\t\tlet nextPin: NotePin = this._cursor.curNote.pins[0];\r\n\t\t\t\t\t\tlet bendVolume: number = 0;\r\n\t\t\t\t\t\tlet bendInterval: number = 0;\r\n\t\t\t\t\t\tfor (let i: number = 1; i < this._cursor.curNote.pins.length; i++) {\r\n\t\t\t\t\t\t\tprevPin = nextPin;\r\n\t\t\t\t\t\t\tnextPin = this._cursor.curNote.pins[i];\r\n\t\t\t\t\t\t\tif (bendPart > nextPin.time) continue;\r\n\t\t\t\t\t\t\tif (bendPart < prevPin.time) throw new Error();\r\n\t\t\t\t\t\t\tconst volumeRatio: number = (bendPart - prevPin.time) / (nextPin.time - prevPin.time);\r\n\t\t\t\t\t\t\tbendVolume = Math.round(prevPin.volume * (1.0 - volumeRatio) + nextPin.volume * volumeRatio + ((this._mouseYStart - this._mouseY) / 20.0/*25.0*/));\r\n\t\t\t\t\t\t\tif (bendVolume < 0) bendVolume = 0;\r\n\t\t\t\t\t\t\tif (bendVolume > 3) bendVolume = 3;\r\n\t\t\t\t\t\t\tbendInterval = this._snapToPitch(prevPin.interval * (1.0 - volumeRatio) + nextPin.interval * volumeRatio + this._cursor.curNote.pitches[0], 0, Config.maxPitch) - this._cursor.curNote.pitches[0];\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis._dragTime = this._cursor.curNote.start + bendPart;\r\n\t\t\t\t\t\tthis._dragPitch = this._cursor.curNote.pitches[this._cursor.pitchIndex == -1 ? 0 : this._cursor.pitchIndex] + bendInterval;\r\n\t\t\t\t\t\tthis._dragVolume = bendVolume;\r\n\t\t\t\t\t\tthis._dragVisible = true;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tsequence.append(new ChangeVolumeBend(this._doc, this._cursor.curNote, bendPart, bendVolume, bendInterval));\r\n\t\t\t\t\t\tthis._copyPins(this._cursor.curNote);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis._dragVolume = this._cursor.curNote.pins[this._cursor.nearPinIndex].volume;\r\n\r\n\t\t\t\t\t\tif (this._pattern == null) throw new Error();\r\n\r\n\t\t\t\t\t\tlet bendStart: number;\r\n\t\t\t\t\t\tlet bendEnd: number;\r\n\t\t\t\t\t\tif (this._mouseX >= this._mouseXStart) {\r\n\t\t\t\t\t\t\tbendStart = this._cursor.part;\r\n\t\t\t\t\t\t\tbendEnd   = currentPart + 1;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tbendStart = this._cursor.part + 1;\r\n\t\t\t\t\t\t\tbendEnd   = currentPart;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (bendEnd < 0) bendEnd = 0;\r\n\t\t\t\t\t\tif (bendEnd > this._doc.song.beatsPerBar * this._doc.song.partsPerBeat) bendEnd = this._doc.song.beatsPerBar * this._doc.song.partsPerBeat;\r\n\t\t\t\t\t\tif (bendEnd > this._cursor.curNote.end) {\r\n\t\t\t\t\t\t\tsequence.append(new ChangeNoteTruncate(this._doc, this._pattern, this._cursor.curNote.start, bendEnd, this._cursor.curNote));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (bendEnd < this._cursor.curNote.start) {\r\n\t\t\t\t\t\t\tsequence.append(new ChangeNoteTruncate(this._doc, this._pattern, bendEnd, this._cursor.curNote.end, this._cursor.curNote));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tlet minPitch: number = Number.MAX_VALUE;\r\n\t\t\t\t\t\tlet maxPitch: number = -Number.MAX_VALUE;\r\n\t\t\t\t\t\tfor (const pitch of this._cursor.curNote.pitches) {\r\n\t\t\t\t\t\t\tif (minPitch > pitch) minPitch = pitch;\r\n\t\t\t\t\t\t\tif (maxPitch < pitch) maxPitch = pitch;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tminPitch -= this._cursor.curNote.pitches[this._cursor.pitchIndex];\r\n\t\t\t\t\t\tmaxPitch -= this._cursor.curNote.pitches[this._cursor.pitchIndex];\r\n\t\t\t\t\t\tconst bendTo: number = this._snapToPitch(this._findMousePitch(this._mouseY), -minPitch, (this._doc.song.getChannelIsDrum(this._doc.channel) ? Config.drumCount-1 : Config.maxPitch) - maxPitch);\r\n\t\t\t\t\t\tsequence.append(new ChangePitchBend(this._doc, this._cursor.curNote, bendStart, bendEnd, bendTo, this._cursor.pitchIndex));\r\n\t\t\t\t\t\tthis._copyPins(this._cursor.curNote);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis._dragTime = bendEnd;\r\n\t\t\t\t\t\tthis._dragPitch = bendTo;\r\n\t\t\t\t\t\tthis._dragVisible = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tthis._mouseXPrev = this._mouseX;\r\n\t\t\t\tthis._mouseYPrev = this._mouseY;\r\n\t\t\t} else {\r\n\t\t\t\tthis._updateCursorStatus();\r\n\t\t\t\tthis._updatePreview();\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenCursorReleased = (event: Event): void => {\r\n\t\t\tif (!this._cursor.valid) return;\r\n\t\t\tconst continuousState: boolean = this._doc.lastChangeWas(this._dragChange);\r\n\t\t\tif (this._mouseDragging && continuousState) {\r\n\t\t\t\tif (this._dragChange != null) {\r\n\t\t\t\t\tthis._doc.record(this._dragChange);\r\n\t\t\t\t\tthis._dragChange = null;\r\n\t\t\t\t}\r\n\t\t\t} else if (this._mouseDown && continuousState) {\r\n\t\t\t\tif (this._cursor.curNote == null) {\r\n\t\t\t\t\tconst note: Note = makeNote(this._cursor.pitch, this._cursor.start, this._cursor.end, 3, this._doc.song.getChannelIsDrum(this._doc.channel));\r\n\t\t\t\t\tnote.pins = [];\r\n\t\t\t\t\tfor (const oldPin of this._cursor.pins) {\r\n\t\t\t\t\t\tnote.pins.push(makeNotePin(0, oldPin.time, oldPin.volume));\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconst sequence: ChangeSequence = new ChangeSequence();\r\n\t\t\t\t\tsequence.append(new ChangeEnsurePatternExists(this._doc));\r\n\t\t\t\t\tconst pattern: Pattern | null = this._doc.getCurrentPattern();\r\n\t\t\t\t\tif (pattern == null) throw new Error();\r\n\t\t\t\t\tsequence.append(new ChangeNoteAdded(this._doc, pattern, note, this._cursor.curIndex));\r\n\t\t\t\t\tthis._doc.record(sequence);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (this._pattern == null) throw new Error();\r\n\t\t\t\t\tif (this._cursor.pitchIndex == -1) {\r\n\t\t\t\t\t\tconst sequence: ChangeSequence = new ChangeSequence();\r\n\t\t\t\t\t\tif (this._cursor.curNote.pitches.length == 4) {\r\n\t\t\t\t\t\t\tsequence.append(new ChangePitchAdded(this._doc, this._cursor.curNote, this._cursor.curNote.pitches[0], 0, true));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tsequence.append(new ChangePitchAdded(this._doc, this._cursor.curNote, this._cursor.pitch, this._cursor.curNote.pitches.length));\r\n\t\t\t\t\t\tthis._doc.record(sequence);\r\n\t\t\t\t\t\tthis._copyPins(this._cursor.curNote);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (this._cursor.curNote.pitches.length == 1) {\r\n\t\t\t\t\t\t\tthis._doc.record(new ChangeNoteAdded(this._doc, this._pattern, this._cursor.curNote, this._cursor.curIndex, true));\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis._doc.record(new ChangePitchAdded(this._doc, this._cursor.curNote, this._cursor.pitch, this._cursor.curNote.pitches.indexOf(this._cursor.pitch), true));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._mouseDown = false;\r\n\t\t\tthis._mouseDragging = false;\r\n\t\t\tthis._updateCursorStatus();\r\n\t\t\tthis._updatePreview();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _updatePreview(): void {\r\n\t\t\tif (this._usingTouch) {\r\n\t\t\t\tif (!this._mouseDown || !this._cursor.valid  || !this._mouseDragging || !this._dragVisible) {\r\n\t\t\t\t\tthis._svgPreview.setAttribute(\"visibility\", \"hidden\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis._svgPreview.setAttribute(\"visibility\", \"visible\");\r\n\t\t\t\t\t\r\n\t\t\t\t\tconst x: number = this._partWidth * this._dragTime;\r\n\t\t\t\t\tconst y: number = this._pitchToPixelHeight(this._dragPitch - this._octaveOffset);\r\n\t\t\t\t\tconst radius: number = this._pitchHeight / 2;\r\n\t\t\t\t\tconst width: number = 80;\r\n\t\t\t\t\tconst height: number = 60;\r\n\t\t\t\t\t//this._drawNote(this._svgPreview, this._cursor.pitch, this._cursor.start, this._cursor.pins, this._pitchHeight / 2 + 1, true, this._octaveOffset);\r\n\t\t\t\t\t\r\n\t\t\t\t\tlet pathString: string = \"\";\r\n\t\t\t\t\t\r\n\t\t\t\t\tpathString += \"M \" + prettyNumber(x) + \" \" + prettyNumber(y - radius * (this._dragVolume / 3.0)) + \" \";\r\n\t\t\t\t\tpathString += \"L \" + prettyNumber(x) + \" \" + prettyNumber(y - radius * (this._dragVolume / 3.0) - height) + \" \";\r\n\t\t\t\t\tpathString += \"M \" + prettyNumber(x) + \" \" + prettyNumber(y + radius * (this._dragVolume / 3.0)) + \" \";\r\n\t\t\t\t\tpathString += \"L \" + prettyNumber(x) + \" \" + prettyNumber(y + radius * (this._dragVolume / 3.0) + height) + \" \";\r\n\t\t\t\t\tpathString += \"M \" + prettyNumber(x) + \" \" + prettyNumber(y - radius * (this._dragVolume / 3.0)) + \" \";\r\n\t\t\t\t\tpathString += \"L \" + prettyNumber(x + width) + \" \" + prettyNumber(y - radius * (this._dragVolume / 3.0)) + \" \";\r\n\t\t\t\t\tpathString += \"M \" + prettyNumber(x) + \" \" + prettyNumber(y + radius * (this._dragVolume / 3.0)) + \" \";\r\n\t\t\t\t\tpathString += \"L \" + prettyNumber(x + width) + \" \" + prettyNumber(y + radius * (this._dragVolume / 3.0)) + \" \";\r\n\t\t\t\t\tpathString += \"M \" + prettyNumber(x) + \" \" + prettyNumber(y - radius * (this._dragVolume / 3.0)) + \" \";\r\n\t\t\t\t\tpathString += \"L \" + prettyNumber(x - width) + \" \" + prettyNumber(y - radius * (this._dragVolume / 3.0)) + \" \";\r\n\t\t\t\t\tpathString += \"M \" + prettyNumber(x) + \" \" + prettyNumber(y + radius * (this._dragVolume / 3.0)) + \" \";\r\n\t\t\t\t\tpathString += \"L \" + prettyNumber(x - width) + \" \" + prettyNumber(y + radius * (this._dragVolume / 3.0)) + \" \";\r\n\t\t\t\t\t\r\n\t\t\t\t\tthis._svgPreview.setAttribute(\"d\", pathString);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (!this._mouseOver || this._mouseDown || !this._cursor.valid) {\r\n\t\t\t\t\tthis._svgPreview.setAttribute(\"visibility\", \"hidden\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis._svgPreview.setAttribute(\"visibility\", \"visible\");\r\n\t\t\t\t\tthis._drawNote(this._svgPreview, this._cursor.pitch, this._cursor.start, this._cursor.pins, this._pitchHeight / 2 + 1, true, this._octaveOffset);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\t\r\n\t\tprivate _documentChanged = (): void => {\r\n\t\t\tthis._editorWidth = this._doc.prefs.showLetters ? (this._doc.prefs.showScrollBar ? 460 : 480) : (this._doc.prefs.showScrollBar ? 492 : 512);\r\n\t\t\tthis._pattern = this._doc.getCurrentPattern();\r\n\t\t\tthis._partWidth = this._editorWidth / (this._doc.song.beatsPerBar * this._doc.song.partsPerBeat);\r\n\t\t\tthis._pitchHeight = this._doc.song.getChannelIsDrum(this._doc.channel) ? this._defaultDrumHeight : this._defaultPitchHeight;\r\n\t\t\tthis._pitchCount = this._doc.song.getChannelIsDrum(this._doc.channel) ? Config.drumCount : Config.pitchCount;\r\n\t\t\tthis._octaveOffset = this._doc.song.channels[this._doc.channel].octave * 12;\r\n\t\t\t\r\n\t\t\tif (this._renderedPartsPerBeat != this._doc.song.partsPerBeat || \r\n\t\t\t\tthis._renderedPitchChannelCount != this._doc.song.pitchChannelCount || \r\n\t\t\t\tthis._renderedDrumChannelCount != this._doc.song.drumChannelCount)\r\n\t\t\t{\r\n\t\t\t\tthis._renderedPartsPerBeat = this._doc.song.partsPerBeat;\r\n\t\t\t\tthis._renderedPitchChannelCount = this._doc.song.pitchChannelCount;\r\n\t\t\t\tthis._renderedDrumChannelCount = this._doc.song.drumChannelCount;\r\n\t\t\t\tthis.resetCopiedPins();\r\n\t\t\t}\r\n\t\t\t\r\n\r\n\r\n\t\t\tthis._copiedPins = this._copiedPinChannels[this._doc.channel];\r\n\t\t\t\r\n\t\t\tif (this._renderedWidth != this._editorWidth) {\r\n\t\t\t\tthis._renderedWidth = this._editorWidth;\r\n\t\t\t\t//this._svg.setAttribute(\"width\", \"\" + this._editorWidth);\r\n\t\t\t\tthis._svg.setAttribute(\"viewBox\", \"0 0 \" + this._editorWidth + \" 481\");\r\n\t\t\t\tthis._svgBackground.setAttribute(\"width\", \"\" + this._editorWidth);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tconst beatWidth = this._editorWidth / this._doc.song.beatsPerBar;\r\n\t\t\tif (this._renderedBeatWidth != beatWidth) {\r\n\t\t\t\tthis._renderedBeatWidth = beatWidth;\r\n\t\t\t\tthis._svgNoteBackground.setAttribute(\"width\", \"\" + beatWidth);\r\n\t\t\t\tthis._svgDrumBackground.setAttribute(\"width\", \"\" + beatWidth);\r\n\t\t\t\tthis._backgroundDrumRow.setAttribute(\"width\", \"\" + (beatWidth - 2));\r\n\t\t\t\tfor (let j: number = 0; j < 12; j++) {\r\n\t\t\t\t\tthis._backgroundPitchRows[j].setAttribute(\"width\", \"\" + (beatWidth - 2));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (!this._mouseDown) this._updateCursorStatus();\r\n\t\t\t\r\n\t\t\tthis._svgNoteContainer = <SVGSVGElement> makeEmptyReplacementElement(this._svgNoteContainer);\r\n\t\t\t\r\n\t\t\tthis._updatePreview();\r\n\t\t\r\n\t\t\tfor (let j: number = 0; j < 12; j++) {\r\n\t\t\t\tthis._backgroundPitchRows[j].style.visibility = Config.scales[this._doc.song.scale].flags[j] ? \"visible\" : \"hidden\";\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (this._doc.song.getChannelIsDrum(this._doc.channel)) {\r\n\t\t\t\tif (!this._renderedDrums) {\r\n\t\t\t\t\tthis._renderedDrums = true;\r\n\t\t\t\t\tthis._svgBackground.setAttribute(\"fill\", \"url(#patternEditorDrumBackground)\");\r\n\t\t\t\t\tthis._svgBackground.setAttribute(\"height\", \"\" + (this._defaultDrumHeight * Config.drumCount));\r\n\t\t\t\t\t//this._svg.setAttribute(\"height\", \"\" + (this._defaultDrumHeight * Config.drumCount));\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (this._renderedDrums) {\r\n\t\t\t\t\tthis._renderedDrums = false;\r\n\t\t\t\t\tthis._svgBackground.setAttribute(\"fill\", \"url(#patternEditorNoteBackground)\");\r\n\t\t\t\t\tthis._svgBackground.setAttribute(\"height\", \"\" + this._editorHeight);\r\n\t\t\t\t\t//this._svg.setAttribute(\"height\", \"\" + this._editorHeight);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (this._doc.prefs.showChannels) {\r\n\t\t\t\tfor (let channel: number = this._doc.song.getChannelCount() - 1; channel >= 0; channel--) {\r\n\t\t\t\t\tif (channel == this._doc.channel) continue;\r\n\t\t\t\t\tif (this._doc.song.getChannelIsDrum(channel) != this._doc.song.getChannelIsDrum(this._doc.channel)) continue;\r\n\t\t\t\t\t\r\n\t\t\t\t\tconst pattern2: Pattern | null = this._doc.song.getPattern(channel, this._doc.bar);\r\n\t\t\t\t\tif (pattern2 == null) continue;\r\n\t\t\t\t\tfor (const note of pattern2.notes) {\r\n\t\t\t\t\t\tfor (const pitch of note.pitches) {\r\n\t\t\t\t\t\t\tconst notePath: SVGPathElement = <SVGPathElement> SVG.path();\r\n\t\t\t\t\t\t\tnotePath.setAttribute(\"fill\", ColorConfig.getChannelColor(this._doc.song, channel).secondaryNote);\r\n\t\t\t\t\t\t\tnotePath.setAttribute(\"pointer-events\", \"none\");\r\n\t\t\t\t\t\t\tthis._drawNote(notePath, pitch, note.start, note.pins, this._pitchHeight * 0.19, false, this._doc.song.channels[channel].octave * 12);\r\n\t\t\t\t\t\t\tthis._svgNoteContainer.appendChild(notePath);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (this._pattern != null) {\r\n\t\t\t\tfor (const note of this._pattern.notes) {\r\n\t\t\t\t\tfor (let i: number = 0; i < note.pitches.length; i++) {\r\n\t\t\t\t\t\tconst pitch: number = note.pitches[i];\r\n\t\t\t\t\t\tlet notePath = <SVGPathElement> SVG.path();\r\n\t\t\t\t\t\tnotePath.setAttribute(\"fill\", ColorConfig.getChannelColor(this._doc.song, this._doc.channel).secondaryChannel);\r\n\t\t\t\t\t\tnotePath.setAttribute(\"pointer-events\", \"none\");\r\n\t\t\t\t\t\tthis._drawNote(notePath, pitch, note.start, note.pins, this._pitchHeight / 2 + 1, false, this._octaveOffset);\r\n\t\t\t\t\t\tthis._svgNoteContainer.appendChild(notePath);\r\n\t\t\t\t\t\tnotePath = <SVGPathElement> SVG.path();\r\n\t\t\t\t\t\tnotePath.setAttribute(\"fill\", ColorConfig.getChannelColor(this._doc.song, this._doc.channel).primaryNote);\r\n\t\t\t\t\t\tnotePath.setAttribute(\"pointer-events\", \"none\");\r\n\t\t\t\t\t\tthis._drawNote(notePath, pitch, note.start, note.pins, this._pitchHeight / 2 + 1, true, this._octaveOffset);\r\n\t\t\t\t\t\tthis._svgNoteContainer.appendChild(notePath);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif (note.pitches.length > 1/* && !this._doc.song.getChannelIsDrum(this._doc.channel)*/) {\r\n\t\t\t\t\t\t\t// const instrumentType: InstrumentType = this._doc.song.channels[this._doc.channel].instruments[this._doc.getCurrentInstrument()].type;\r\n\t\t\t\t\t\t\t// if (instrumentType == InstrumentType.fm) {\r\n\t\t\t\t\t\t\t\tlet oscillatorLabel = <SVGTextElement> SVG.text();\r\n\t\t\t\t\t\t\t\toscillatorLabel.setAttribute(\"x\", \"\" + prettyNumber(this._partWidth * note.start + 2));\r\n\t\t\t\t\t\t\t\toscillatorLabel.setAttribute(\"y\", \"\" + prettyNumber(this._pitchToPixelHeight(pitch - this._octaveOffset)));\r\n\t\t\t\t\t\t\t\toscillatorLabel.setAttribute(\"width\", \"30\");\r\n\t\t\t\t\t\t\t\toscillatorLabel.setAttribute(\"fill\", \"black\");\r\n\t\t\t\t\t\t\t\toscillatorLabel.setAttribute(\"text-anchor\", \"start\");\r\n\t\t\t\t\t\t\t\toscillatorLabel.setAttribute(\"dominant-baseline\", \"central\");\r\n\t\t\t\t\t\t\t\toscillatorLabel.setAttribute(\"pointer-events\", \"none\");\r\n\t\t\t\t\t\t\t\toscillatorLabel.textContent = \"\" + (i + 1);\r\n\t\t\t\t\t\t\t\tthis._svgNoteContainer.appendChild(oscillatorLabel);\r\n\t\t\t\t\t\t\t// }\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\r\n\t}\r\n\t\r\n\tpublic render(): void {\r\n\r\n\t\t\tif (this._doc.prefs.showMore == false) {\r\n\r\n\t\t\t\tif (this._renderedFifths != this._doc.prefs.showFifth) {\r\n\t\t\t\t\tthis._renderedFifths = this._doc.prefs.showFifth;\r\n\t\t\t\t\tthis._backgroundPitchRows[7].setAttribute(\"fill\", this._doc.prefs.showFifth ? ColorConfig.fifthNote : ColorConfig.pitchBackground);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this._renderedPiano == true) {\r\n\t\t\t\t\tthis._renderedPiano = false;\r\n\t\t\t\t}\r\n\t\t\tif (this._renderedACS != this._doc.prefs.showMore) {\r\n\t\t\t\tthis._backgroundPitchRows[0].setAttribute(\"fill\", ColorConfig.tonic);\r\n\t\t\t\tthis._backgroundPitchRows[1].setAttribute(\"fill\", this._doc.prefs.showMore ? ColorConfig.pitch1Background : ColorConfig.pitchBackground);\r\n\t\t\t\tthis._backgroundPitchRows[2].setAttribute(\"fill\", this._doc.prefs.showMore ? ColorConfig.pitch2Background : ColorConfig.pitchBackground);\r\n\t\t\t\tthis._backgroundPitchRows[3].setAttribute(\"fill\", this._doc.prefs.showMore ? ColorConfig.pitch3Background : ColorConfig.pitchBackground);\r\n\t\t\t\tthis._backgroundPitchRows[4].setAttribute(\"fill\", this._doc.prefs.showMore ? ColorConfig.pitch4Background : ColorConfig.pitchBackground);\r\n\t\t\t\tthis._backgroundPitchRows[5].setAttribute(\"fill\", this._doc.prefs.showMore ? ColorConfig.pitch5Background : ColorConfig.pitchBackground);\r\n\t\t\t\tthis._backgroundPitchRows[6].setAttribute(\"fill\", this._doc.prefs.showMore ? ColorConfig.pitch6Background : ColorConfig.pitchBackground);\r\n\t\t\t\tthis._backgroundPitchRows[7].setAttribute(\"fill\", this._doc.prefs.showFifth ? ColorConfig.fifthNote : ColorConfig.pitchBackground);\r\n\t\t\t\tthis._backgroundPitchRows[8].setAttribute(\"fill\", this._doc.prefs.showMore ? ColorConfig.pitch8Background : ColorConfig.pitchBackground);\r\n\t\t\t\tthis._backgroundPitchRows[9].setAttribute(\"fill\", this._doc.prefs.showMore ? ColorConfig.pitch9Background : ColorConfig.pitchBackground);\r\n\t\t\t\tthis._backgroundPitchRows[10].setAttribute(\"fill\", this._doc.prefs.showMore ? ColorConfig.pitch10Background : ColorConfig.pitchBackground);\r\n\t\t\t\tthis._backgroundPitchRows[11].setAttribute(\"fill\", this._doc.prefs.showMore ? ColorConfig.pitch11Background : ColorConfig.pitchBackground);\r\n\t\t\t\tthis._renderedACS = this._doc.prefs.showMore;\r\n\t\t\t\tconsole.log(\"this._renderedACS (acs disabled): \"+this._renderedACS);\r\n\t\t\t}\r\n\t\t\tthis._setKey = -1;\r\n\t\t} else {\r\n\t\t\tif (ColorConfig.usesPianoScheme == false) {\r\n\t\t\t\tif (this._renderedACS != this._doc.prefs.showMore || this._renderedPiano == true) {\r\n\t\t\t\t\tthis._backgroundPitchRows[0].setAttribute(\"fill\", this._doc.prefs.showMore ? ColorConfig.tonic : ColorConfig.tonic);\r\n\t\t\t\t\tthis._backgroundPitchRows[1].setAttribute(\"fill\", this._doc.prefs.showMore ? ColorConfig.pitch1Background :  ColorConfig.pitchBackground);\r\n\t\t\t\t\tthis._backgroundPitchRows[2].setAttribute(\"fill\", this._doc.prefs.showMore ? ColorConfig.pitch2Background :  ColorConfig.pitchBackground);\r\n\t\t\t\t\tthis._backgroundPitchRows[3].setAttribute(\"fill\", this._doc.prefs.showMore ? ColorConfig.pitch3Background :  ColorConfig.pitchBackground);\r\n\t\t\t\t\tthis._backgroundPitchRows[4].setAttribute(\"fill\", this._doc.prefs.showMore ? ColorConfig.pitch4Background :  ColorConfig.pitchBackground);\r\n\t\t\t\t\tthis._backgroundPitchRows[5].setAttribute(\"fill\", this._doc.prefs.showMore ? ColorConfig.pitch5Background :  ColorConfig.pitchBackground);\r\n\t\t\t\t\tthis._backgroundPitchRows[6].setAttribute(\"fill\", this._doc.prefs.showMore ? ColorConfig.pitch6Background :  ColorConfig.pitchBackground);\r\n\t\t\t\t\tthis._backgroundPitchRows[7].setAttribute(\"fill\", this._doc.prefs.showFifth ? ColorConfig.fifthNote : ColorConfig.pitchBackground);\r\n\t\t\t\t\tthis._backgroundPitchRows[8].setAttribute(\"fill\", this._doc.prefs.showMore ? ColorConfig.pitch8Background : ColorConfig.pitchBackground);\r\n\t\t\t\t\tthis._backgroundPitchRows[9].setAttribute(\"fill\", this._doc.prefs.showMore ? ColorConfig.pitch9Background : ColorConfig.pitchBackground);\r\n\t\t\t\t\tthis._backgroundPitchRows[10].setAttribute(\"fill\", this._doc.prefs.showMore ? ColorConfig.pitch10Background : ColorConfig.pitchBackground);\r\n\t\t\t\t\tthis._backgroundPitchRows[11].setAttribute(\"fill\", this._doc.prefs.showMore ? ColorConfig.pitch11Background : ColorConfig.pitchBackground);\r\n\t\t\t\t\tthis._renderedACS = this._doc.prefs.showMore;\r\n\t\t\t\t\tconsole.log(\"this._renderedACS (acs enabled): \"+this._renderedACS);\r\n\t\t\t\t} \r\n\t\t\t\tif (this._renderedPiano == true) {\r\n\t\t\t\t\tthis._renderedPiano = false;\r\n\t\t\t\t\tthis._setKey = -1;\r\n\t\t\t\t\tconsole.log(\"this._renderedACS (disabiling piano): \"+this._renderedACS);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (this._setKey != this._doc.song.key) {\r\n\t\t\t\t\t\tthis._setKey = this._doc.song.key;\r\n\t\t\t\t\t\tthis._renderedPiano = true;\r\n\t\t\t\t\t\tconsole.log(\"piano key\"+this._setKey);\r\n\t\t\t\t\t\tif ( (this._setKey == 0 ) || (this._setKey == 2 ) || (this._setKey == 4 ) || (this._setKey == 6 ) || (this._setKey == 7 ) || (this._setKey == 9 ) || (this._setKey == 11 )) {\r\n\t\t\t\t\t\t\tthis._backgroundPitchRows[0].setAttribute(\"fill\", this._doc.prefs.showMore ? \"var(--white-tonic, var(--pitch-white-key, var(--pitch-background)))\" : ColorConfig.pitchBackground);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis._backgroundPitchRows[0].setAttribute(\"fill\", this._doc.prefs.showMore ? \"var(--black-tonic, var(--pitch-black-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif ((this._setKey == 0 ) || (this._setKey == 1 ) || (this._setKey == 3 ) || (this._setKey == 5 )|| (this._setKey == 7 ) ||(this._setKey == 8 ) || (this._setKey == 10)) {\r\n\t\t\t\t\t\t\tthis._backgroundPitchRows[1].setAttribute(\"fill\", this._doc.prefs.showMore ? \"var(--pitch-white-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis._backgroundPitchRows[1].setAttribute(\"fill\", this._doc.prefs.showMore ? \"var(--pitch-black-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif ((this._setKey == 1 )||(this._setKey == 2 )||(this._setKey == 4 )||(this._setKey == 6 )||(this._setKey == 8 )||(this._setKey == 9 )||(this._setKey == 11)) {\r\n\t\t\t\t\t\t\tthis._backgroundPitchRows[2].setAttribute(\"fill\", this._doc.prefs.showMore ? \"var(--pitch-white-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis._backgroundPitchRows[2].setAttribute(\"fill\", this._doc.prefs.showMore ? \"var(--pitch-black-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif ((this._setKey == 0 ) ||(this._setKey == 2 )||(this._setKey == 3 )||(this._setKey == 5 )||(this._setKey == 7 )||(this._setKey == 9 )||(this._setKey == 10)) {\r\n\t\t\t\t\t\t\tthis._backgroundPitchRows[3].setAttribute(\"fill\", this._doc.prefs.showMore ? \"var(--pitch-white-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis._backgroundPitchRows[3].setAttribute(\"fill\", this._doc.prefs.showMore ? \"var(--pitch-black-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif ((this._setKey == 1) ||(this._setKey == 3 )||(this._setKey == 4 )||(this._setKey == 6 )||(this._setKey == 8 )||(this._setKey == 10 )||(this._setKey == 11)) {\r\n\t\t\t\t\t\t\tthis._backgroundPitchRows[4].setAttribute(\"fill\", this._doc.prefs.showMore ? \" var(--pitch-white-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis._backgroundPitchRows[4].setAttribute(\"fill\", this._doc.prefs.showMore ? \" var(--pitch-black-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif ((this._setKey == 0 )||(this._setKey == 2 )||(this._setKey == 4 )||(this._setKey == 5 )||(this._setKey == 7 )||(this._setKey == 9 )||(this._setKey == 11)) {\r\n\t\t\t\t\t\t\tthis._backgroundPitchRows[5].setAttribute(\"fill\", this._doc.prefs.showMore ? \"var(--pitch-white-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis._backgroundPitchRows[5].setAttribute(\"fill\", this._doc.prefs.showMore ? \"var(--pitch-black-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif ((this._setKey == 0 ) ||(this._setKey == 1 )||(this._setKey == 3 )||(this._setKey == 5 )||(this._setKey == 6 )||(this._setKey == 8 )||(this._setKey == 10)) {\r\n\t\t\t\t\t\t\tthis._backgroundPitchRows[6].setAttribute(\"fill\", this._doc.prefs.showMore ? \"var(--pitch-white-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis._backgroundPitchRows[6].setAttribute(\"fill\", this._doc.prefs.showMore ? \"var(--pitch-black-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif ((this._setKey == 1) ||(this._setKey == 2) ||(this._setKey == 4 )||(this._setKey == 6 )||(this._setKey == 7 )||(this._setKey == 9 )||(this._setKey == 11)) {\r\n\t\t\t\t\t\t\tif (this._doc.prefs.showFifth == true) {\r\n\t\t\t\t\t\t\t\tthis._backgroundPitchRows[7].setAttribute(\"fill\", this._doc.prefs.showMore ? \"var(--white-fifth-note, var(--pitch-white-key, var(--pitch-background)))\" : ColorConfig.pitchBackground);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tthis._backgroundPitchRows[7].setAttribute(\"fill\", this._doc.prefs.showMore ? \" var(--pitch-white-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tif (this._doc.prefs.showFifth == true) {\r\n\t\t\t\t\t\t\t\tthis._backgroundPitchRows[7].setAttribute(\"fill\", this._doc.prefs.showMore ? \"var(--black-fifth-note, var(--pitch-black-key, var(--pitch-background)))\" : ColorConfig.pitchBackground);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tthis._backgroundPitchRows[7].setAttribute(\"fill\", this._doc.prefs.showMore ? \"var(--pitch-black-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif ((this._setKey == 0 ) || (this._setKey == 2 ) || (this._setKey == 3 ) || (this._setKey == 5) || (this._setKey == 7) || (this._setKey == 8) || (this._setKey == 10)) {\r\n\t\t\t\t\t\t\tthis._backgroundPitchRows[8].setAttribute(\"fill\", this._doc.prefs.showMore ? \"var(--pitch-white-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis._backgroundPitchRows[8].setAttribute(\"fill\", this._doc.prefs.showMore ? \"var(--pitch-black-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif ((this._setKey == 1 )|| (this._setKey ==3 )||(this._setKey == 4 )||(this._setKey == 6 )||(this._setKey == 8 )||(this._setKey == 9 )||(this._setKey == 11)) {\r\n\t\t\t\t\t\t\tthis._backgroundPitchRows[9].setAttribute(\"fill\", this._doc.prefs.showMore ? \"var(--pitch-white-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis._backgroundPitchRows[9].setAttribute(\"fill\", this._doc.prefs.showMore ? \"var(--pitch-black-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif ((this._setKey == 0) ||(this._setKey == 2 )||(this._setKey == 4 )||(this._setKey == 5 )||(this._setKey == 7 )||(this._setKey == 9) ||(this._setKey == 10)) {\r\n\t\t\t\t\t\t\tthis._backgroundPitchRows[10].setAttribute(\"fill\", this._doc.prefs.showMore ? \"var(--pitch-white-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis._backgroundPitchRows[10].setAttribute(\"fill\", this._doc.prefs.showMore ? \"var(--pitch-black-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif ((this._setKey == 1 )||(this._setKey == 3 )||(this._setKey == 5 )||(this._setKey == 6 )||(this._setKey == 8 )||(this._setKey == 10 )||(this._setKey == 11)) {\r\n\t\t\t\t\t\t\tthis._backgroundPitchRows[11].setAttribute(\"fill\", this._doc.prefs.showMore ? \"var(--pitch-white-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis._backgroundPitchRows[11].setAttribute(\"fill\", this._doc.prefs.showMore ? \"var(--pitch-black-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\tif (this._renderedACS != this._doc.prefs.showMore) {\r\n\t\t\t\t\tthis._renderedACS = this._doc.prefs.showMore;\r\n\t\t\t\t\tconsole.log(\"this._renderedACS (in piano): \"+this._renderedACS);\r\n\t\t\t\t\t}\r\n\t\t\t\t} \r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t\tprivate _drawNote(svgElement: SVGPathElement, pitch: number, start: number, pins: NotePin[], radius: number, showVolume: boolean, offset: number): void {\r\n\t\t\tlet nextPin: NotePin = pins[0];\r\n\t\t\tlet pathString: string = \"M \" + prettyNumber(this._partWidth * (start + nextPin.time) + 1) + \" \" + prettyNumber(this._pitchToPixelHeight(pitch - offset) + radius * (showVolume ? nextPin.volume / 3.0 : 1.0)) + \" \";\r\n\t\t\tfor (let i: number = 1; i < pins.length; i++) {\r\n\t\t\t\tlet prevPin: NotePin = nextPin;\r\n\t\t\t\tnextPin = pins[i];\r\n\t\t\t\tlet prevSide: number = this._partWidth * (start + prevPin.time) + (i == 1 ? 1 : 0);\r\n\t\t\t\tlet nextSide: number = this._partWidth * (start + nextPin.time) - (i == pins.length - 1 ? 1 : 0);\r\n\t\t\t\tlet prevHeight: number = this._pitchToPixelHeight(pitch + prevPin.interval - offset);\r\n\t\t\t\tlet nextHeight: number = this._pitchToPixelHeight(pitch + nextPin.interval - offset);\r\n\t\t\t\tlet prevVolume: number = showVolume ? prevPin.volume / 3.0 : 1.0;\r\n\t\t\t\tlet nextVolume: number = showVolume ? nextPin.volume / 3.0 : 1.0;\r\n\t\t\t\tpathString += \"L \" + prettyNumber(prevSide) + \" \" + prettyNumber(prevHeight - radius * prevVolume) + \" \";\r\n\t\t\t\tif (prevPin.interval > nextPin.interval) pathString += \"L \" + prettyNumber(prevSide + 1) + \" \" + prettyNumber(prevHeight - radius * prevVolume) + \" \";\r\n\t\t\t\tif (prevPin.interval < nextPin.interval) pathString += \"L \" + prettyNumber(nextSide - 1) + \" \" + prettyNumber(nextHeight - radius * nextVolume) + \" \";\r\n\t\t\t\tpathString += \"L \" + prettyNumber(nextSide) + \" \" + prettyNumber(nextHeight - radius * nextVolume) + \" \";\r\n\t\t\t}\r\n\t\t\tfor (let i: number = pins.length - 2; i >= 0; i--) {\r\n\t\t\t\tlet prevPin: NotePin = nextPin;\r\n\t\t\t\tnextPin = pins[i];\r\n\t\t\t\tlet prevSide: number = this._partWidth * (start + prevPin.time) - (i == pins.length - 2 ? 1 : 0);\r\n\t\t\t\tlet nextSide: number = this._partWidth * (start + nextPin.time) + (i == 0 ? 1 : 0);\r\n\t\t\t\tlet prevHeight: number = this._pitchToPixelHeight(pitch + prevPin.interval - offset);\r\n\t\t\t\tlet nextHeight: number = this._pitchToPixelHeight(pitch + nextPin.interval - offset);\r\n\t\t\t\tlet prevVolume: number = showVolume ? prevPin.volume / 3.0 : 1.0;\r\n\t\t\t\tlet nextVolume: number = showVolume ? nextPin.volume / 3.0 : 1.0;\r\n\t\t\t\tpathString += \"L \" + prettyNumber(prevSide) + \" \" + prettyNumber(prevHeight + radius * prevVolume) + \" \";\r\n\t\t\t\tif (prevPin.interval < nextPin.interval) pathString += \"L \" + prettyNumber(prevSide - 1) + \" \" + prettyNumber(prevHeight + radius * prevVolume) + \" \";\r\n\t\t\t\tif (prevPin.interval > nextPin.interval) pathString += \"L \" + prettyNumber(nextSide + 1) + \" \" + prettyNumber(nextHeight + radius * nextVolume) + \" \";\r\n\t\t\t\tpathString += \"L \" + prettyNumber(nextSide) + \" \" + prettyNumber(nextHeight + radius * nextVolume) + \" \";\r\n\t\t\t}\r\n\t\t\tpathString += \"z\";\r\n\t\t\t\r\n\t\t\tsvgElement.setAttribute(\"d\", pathString);\r\n\t\t}\r\n\t\t\r\n\t\tprivate _pitchToPixelHeight(pitch: number): number {\r\n\t\t\treturn this._pitchHeight * (this._pitchCount - (pitch) - 0.5);\r\n\t\t}\r\n\t}\r\n\r\n","/*\r\nCopyright (C) 2018 John Nesky\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of \r\nthis software and associated documentation files (the \"Software\"), to deal in \r\nthe Software without restriction, including without limitation the rights to \r\nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \r\nof the Software, and to permit persons to whom the Software is furnished to do \r\nso, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all \r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \r\nSOFTWARE.\r\n*/\r\n\r\nimport { HTML, SVG } from \"imperative-html/dist/esm/elements-strict\";\r\nimport { SongDocument } from \"./SongDocument\";\r\nimport { Pattern } from \"../synth/song\";\r\nimport { ChangePattern, ChangeChannelBar } from \"./changes\";\r\nimport { ColorConfig } from \"./ColorConfig\";\r\n\tconst {select, div, option} = HTML;\r\n\r\n\tclass Box {\r\n\t\tprivate readonly _label: SVGTextElement = SVG.text( {x: 16, y: 23, \"font-family\": \"sans-serif\", \"font-size\": 20, \"text-anchor\": \"middle\", \"font-weight\": \"bold\", fill: ColorConfig.invertedText}, \"1\");\r\n\t\tprivate readonly _rect = <SVGRectElement> SVG.rect( {width: 30, height: 27, x: 1, y: 1});\r\n\t\tprivate readonly _vol1 = <SVGRectElement> SVG.rect( {width: 6, height: 3, x: 24, y: 5});\r\n\t\tprivate readonly _volb = <SVGRectElement> SVG.rect( {width: 6, height: 18, x: 24, y: 5});\r\n\t\tpublic readonly container = <SVGSVGElement> SVG.svg(this._rect, this._volb, this._vol1, this._label);\r\n\t\tprivate _renderedIndex: number = 1;\r\n\t\tprivate _renderedDim: boolean = true;\r\n\t\t//private _renderedMute: boolean = true;\r\n\t\tprivate _renderedSelected: boolean = false;\r\n\t\tprivate _renderedColor: string = \"\";\r\n\t\tconstructor(channel: number, x: number, y: number, color: string, showVolume: boolean) {\r\n\t\t\tthis.container.setAttribute(\"x\", \"\" + (x * 32));\r\n\t\t\tthis.container.setAttribute(\"y\", \"\" + (y * 32));\r\n\t\t\tthis._rect.setAttribute(\"fill\", \"#444444\");\r\n\t\t\tthis._vol1.setAttribute(\"fill\", \"#444444\");\r\n\t\t\tthis._volb.setAttribute(\"fill\", \"#444444\");\r\n\t\t\tthis._label.setAttribute(\"fill\", color);\r\n\t\t}\r\n\t\t\r\n\t\tpublic setSquashed(squashed: boolean, y: number): void {\r\n\t\t\tif (squashed) {\r\n\t\t\t\tthis.container.setAttribute(\"y\", \"\" + (y * 27));\r\n\t\t\t\tthis._rect.setAttribute(\"height\", \"\" + 25);\r\n\t\t\t\tthis._vol1.setAttribute(\"height\", \"\" + 2.7);\r\n\t\t\t\tthis._volb.setAttribute(\"height\", \"\" + 18);\r\n\t\t\t\tthis._label.setAttribute(\"y\", \"\" + 21);\r\n\t\t\t} else {\r\n\t\t\t\tthis.container.setAttribute(\"y\", \"\" + (y * 32));\r\n\t\t\t\tthis._rect.setAttribute(\"height\", \"\" + 30);\r\n\t\t\t\tthis._vol1.setAttribute(\"height\", \"\" + 3);\r\n\t\t\t\tthis._volb.setAttribute(\"height\", \"\" + 18);\r\n\t\t\t\tthis._label.setAttribute(\"y\", \"\" + 23);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tpublic setIndex(index: number, dim: boolean, selected: boolean, y: number, color: string, volume: number, colorB: string, showVolume: boolean, mix: number): void {\r\n\t\t\tif (mix == 2) {\r\n\t\t\t\tthis._vol1.setAttribute(\"height\", \"\" + (18 - volume * 2));\r\n\t\t\t\tthis._vol1.setAttribute(\"y\", \"\" + (5 + volume * 2));\r\n\t\t\t} else {\r\n\t\t\t\tthis._vol1.setAttribute(\"height\", \"\" + (18 - volume * 3.6));\r\n\t\t\t\tthis._vol1.setAttribute(\"y\", \"\" + (5 + volume * 3.6));\r\n\t\t\t}\r\n\t\t\tif (this._renderedIndex != index) {\r\n\t\t\t\tif (!this._renderedSelected && ((index == 0) != (this._renderedIndex == 0))) {\r\n\t\t\t\t\tthis._rect.setAttribute(\"fill\", (index == 0) ? ColorConfig.editorBackground : ColorConfig.channelBox);\r\n\t\t\t\t\tthis._vol1.setAttribute(\"fill\", (index == 0) ? ColorConfig.editorBackground : ColorConfig.channelBox);\r\n\t\t\t\t\tthis._volb.setAttribute(\"fill\", (index == 0) ? ColorConfig.editorBackground : ColorConfig.channelBox);\r\n\t\t\t\t}\r\n\t\t\t\r\n\t\t\t\tthis._renderedIndex = index;\r\n\t\t\t\tthis._label.innerHTML = String(index);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (this._renderedDim != dim || this._renderedColor != color) {\r\n\t\t\t\tthis._renderedDim = dim;\r\n\t\t\t\tif (selected) {\r\n\t\t\t\t\tthis._label.setAttribute(\"fill\", ColorConfig.invertedText);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis._label.setAttribute(\"fill\", color);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (this._renderedSelected != selected || this._renderedColor != color) {\r\n\t\t\t\tthis._renderedSelected = selected;\r\n\t\t\t\tif (selected) {\r\n\t\t\t\t\tthis._rect.setAttribute(\"fill\", color);\r\n\t\t\t\t\tthis._vol1.setAttribute(\"fill\", color);\r\n\t\t\t\t\tthis._volb.setAttribute(\"fill\", color);\r\n\t\t\t\t\tthis._label.setAttribute(\"fill\", ColorConfig.invertedText);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis._rect.setAttribute(\"fill\", (this._renderedIndex == 0) ? ColorConfig.editorBackground : ColorConfig.channelBox);\r\n\t\t\t\t\tthis._vol1.setAttribute(\"fill\", (this._renderedIndex == 0) ? ColorConfig.editorBackground : color);\r\n\t\t\t\t\tthis._volb.setAttribute(\"fill\", (this._renderedIndex == 0) ? ColorConfig.editorBackground : colorB);\r\n\t\t\t\t\tthis._label.setAttribute(\"fill\", color);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (showVolume) {\r\n\t\t\t\tthis._label.setAttribute(\"x\", \"12\");\r\n\t\t\t\tthis._vol1.style.visibility = \"visible\";\r\n\t\t\t\tthis._volb.style.visibility = \"visible\";\r\n\t\t\t} else {\r\n\t\t\t\tthis._label.setAttribute(\"x\", \"16\");\r\n\t\t\t\tthis._vol1.style.visibility = \"hidden\";\r\n\t\t\t\tthis._volb.style.visibility = \"hidden\";\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._renderedColor = color;\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class TrackEditor {\r\n\t\tprivate readonly _barWidth: number = 32;\r\n\t\tprivate readonly _svg = <SVGSVGElement> SVG.svg( {style: \"position: absolute;\", height: 128});\r\n\t\tprivate readonly _select: HTMLSelectElement = select({class: \"trackSelectBox\", style: \"width: 32px; height: 32px; background: none; border: none; appearance: none; color: transparent; position: absolute;\"});\r\n\t\tpublic readonly container: HTMLElement = div({style: \"height: 128px; position: relative; overflow:hidden;\"}, [this._svg, this._select]);\r\n\t\t\r\n\t\tprivate readonly _boxContainer = <SVGGElement> SVG.g();\r\n\t\tprivate readonly _playhead = <SVGRectElement> SVG.rect( {fill: \"white\", x: 0, y: 0, width: 4, height: 128});\r\n\t\tprivate readonly _boxHighlight = <SVGRectElement> SVG.rect( {fill: \"none\", stroke: \"white\", \"stroke-width\": 2, \"pointer-events\": \"none\", x: 1, y: 1, width: 30, height: 30});\r\n\t\tprivate readonly _upHighlight = <SVGPathElement> SVG.path( {fill: \"black\", stroke: \"black\", \"stroke-width\": 1, \"pointer-events\": \"none\"});\r\n\t\tprivate readonly _downHighlight = <SVGPathElement> SVG.path( {fill: \"black\", stroke: \"black\", \"stroke-width\": 1, \"pointer-events\": \"none\"});\r\n\t\t\r\n\t\tprivate readonly _grid: Box[][] = [];\r\n\t\tprivate _mouseX: number = 0;\r\n\t\tprivate _mouseY: number = 0;\r\n\t\tpublic _pattern: Pattern | null = null;\r\n\t\tprivate _mouseOver: boolean = false;\r\n\t\tpublic _digits: string = \"\";\r\n\t\tprivate _editorHeight: number = 128;\r\n\t\tprivate _channelHeight: number = 32;\r\n\t\tprivate _renderedChannelCount: number = 0;\r\n\t\tprivate _renderedBarCount: number = 0;\r\n\t\tprivate _renderedPatternCount: number = 0;\r\n\t\tprivate _renderedPlayhead: number = -1;\r\n\t\tprivate _renderedSquashed: boolean = false;\r\n\t\tprivate _changePattern: ChangePattern | null = null;\r\n\t\t\r\n\t\tconstructor(private _doc: SongDocument) {\r\n\t\t\tthis._svg.appendChild(this._boxContainer);\r\n\t\t\tthis._svg.appendChild(this._boxHighlight);\r\n\t\t\tthis._svg.appendChild(this._upHighlight);\r\n\t\t\tthis._svg.appendChild(this._downHighlight);\r\n\t\t\tthis._svg.appendChild(this._playhead);\r\n\t\t\tthis._svg.style.backgroundColor = ColorConfig.editorBackground;\r\n\r\n\t\t\twindow.requestAnimationFrame(this._animatePlayhead);\r\n\t\t\tthis._svg.addEventListener(\"mousedown\", this._whenMousePressed);\r\n\t\t\tdocument.addEventListener(\"mousemove\", this._whenMouseMoved);\r\n\t\t\tdocument.addEventListener(\"mouseup\", this._whenMouseReleased);\r\n\t\t\tthis._svg.addEventListener(\"mouseover\", this._whenMouseOver);\r\n\t\t\tthis._svg.addEventListener(\"mouseout\", this._whenMouseOut);\r\n\t\t\t\r\n\t\t\tthis._select.addEventListener(\"change\", this._whenSelectChanged);\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenSelectChanged = (): void => {\r\n\t\t\tthis._setPattern(this._select.selectedIndex);\r\n\t\t}\r\n\t\t\r\n\t\tprivate _animatePlayhead = (timestamp: number): void => {\r\n\t\t\tconst playhead = (this._barWidth * this._doc.synth.playhead - 2);\r\n\t\t\tif (this._renderedPlayhead != playhead) {\r\n\t\t\t\tthis._renderedPlayhead = playhead;\r\n\t\t\t\tthis._playhead.setAttribute(\"x\", \"\" + playhead);\r\n\t\t\t}\r\n\t\t\twindow.requestAnimationFrame(this._animatePlayhead);\r\n\t\t}\r\n\t\t\r\n\t\tpublic _setChannelBar(channel: number, bar: number): void {\r\n\t\t\tnew ChangeChannelBar(this._doc, channel, bar);\r\n\t\t\tthis._digits = \"\";\r\n\t\t\tthis._doc.forgetLastChange();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _setPattern(pattern: number): void {\r\n\t\t\tconst currentValue: number = this._doc.song.channels[this._doc.channel].bars[this._doc.bar];\r\n\t\t\tconst canReplaceLastChange: boolean = this._doc.lastChangeWas(this._changePattern);\r\n\t\t\tconst oldValue: number = canReplaceLastChange ? this._changePattern!.oldValue : currentValue;\r\n\t\t\tif (pattern != currentValue) {\r\n\t\t\t\tthis._changePattern = new ChangePattern(this._doc, oldValue, pattern);\r\n\t\t\t\tthis._doc.record(this._changePattern, canReplaceLastChange);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tpublic _nextDigit(digit: string): void {\r\n\t\t\tthis._digits += digit;\r\n\t\t\tlet parsed: number = parseInt(this._digits);\r\n\t\t\tif (parsed <= this._doc.song.patternsPerChannel) {\r\n\t\t\t\tthis._setPattern(parsed);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\t\r\n\t\t\tthis._digits = digit;\r\n\t\t\tparsed = parseInt(this._digits);\r\n\t\t\tif (parsed <= this._doc.song.patternsPerChannel) {\r\n\t\t\t\tthis._setPattern(parsed);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._digits = \"\";\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenMouseOver = (event: MouseEvent): void => {\r\n\t\t\tif (this._mouseOver) return;\r\n\t\t\tthis._mouseOver = true;\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenMouseOut = (event: MouseEvent): void => {\r\n\t\t\tif (!this._mouseOver) return;\r\n\t\t\tthis._mouseOver = false;\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenMousePressed = (event: MouseEvent): void => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tconst boundingRect: ClientRect = this._svg.getBoundingClientRect();\r\n    \t\tthis._mouseX = (event.clientX || event.pageX) - boundingRect.left;\r\n\t\t    this._mouseY = (event.clientY || event.pageY) - boundingRect.top;\r\n\t\t\tconst channel: number = Math.floor(Math.min(this._doc.song.getChannelCount() - 1, Math.max(0, this._mouseY / this._channelHeight)));\r\n\t\t\tconst bar: number = Math.floor(Math.min(this._doc.song.barCount - 1, Math.max(0, this._mouseX / this._barWidth)));\r\n\t\t\tif (this._doc.channel == channel && this._doc.bar == bar) {\r\n\t\t\t\tconst up: boolean = (this._mouseY % this._channelHeight) < this._channelHeight / 2;\r\n\t\t\t\tconst patternCount: number = this._doc.song.patternsPerChannel;\r\n\t\t\t\tthis._setPattern((this._doc.song.channels[channel].bars[bar] + (up ? 1 : patternCount)) % (patternCount + 1));\r\n\t\t\t} else {\r\n\t\t\t\tthis._setChannelBar(channel, bar);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenMouseMoved = (event: MouseEvent): void => {\r\n\t\t\tconst boundingRect: ClientRect = this._svg.getBoundingClientRect();\r\n    \t\tthis._mouseX = (event.clientX || event.pageX) - boundingRect.left;\r\n\t\t    this._mouseY = (event.clientY || event.pageY) - boundingRect.top;\r\n\t\t\tthis._updatePreview();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenMouseReleased = (event: MouseEvent): void => {\r\n\t\t}\r\n\t\t\r\n\t\tprivate _updatePreview(): void {\r\n\t\t\tlet channel: number = Math.floor(Math.min(this._doc.song.getChannelCount() - 1, Math.max(0, this._mouseY / this._channelHeight)));\r\n\t\t\tlet bar: number = Math.floor(Math.min(this._doc.song.barCount - 1, Math.max(0, this._mouseX / this._barWidth)));\r\n\t\t\t\r\n\t\t\tconst wideScreen: boolean = window.innerWidth > 700;\r\n\t\t\tif (!wideScreen) {\r\n\t\t\t\tbar = this._doc.bar;\r\n\t\t\t\tchannel = this._doc.channel;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tconst selected: boolean = (bar == this._doc.bar && channel == this._doc.channel);\r\n\t\t\t\r\n\t\t\tif (this._mouseOver && !selected) {\r\n\t\t\t\tthis._boxHighlight.setAttribute(\"x\", \"\" + (1 + this._barWidth * bar));\r\n\t\t\t\tthis._boxHighlight.setAttribute(\"y\", \"\" + (1 + (this._channelHeight * channel)));\r\n\t\t\t\tthis._boxHighlight.setAttribute(\"height\", \"\" + (this._channelHeight - 2));\r\n\t\t\t\tthis._boxHighlight.style.visibility = \"visible\";\r\n\t\t\t} else {\r\n\t\t\t\tthis._boxHighlight.style.visibility = \"hidden\";\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif ((this._mouseOver || !wideScreen) && selected) {\r\n\t\t\t\tconst up: boolean = (this._mouseY % this._channelHeight) < this._channelHeight / 2;\r\n\t\t\t\tconst center: number = this._barWidth * (bar + 0.8);\r\n\t\t\t\tconst middle: number = this._channelHeight * (channel + 0.5);\r\n\t\t\t\tconst base: number = this._channelHeight * 0.1;\r\n\t\t\t\tconst tip: number = this._channelHeight * 0.4;\r\n\t\t\t\tconst width: number = this._channelHeight * 0.175;\r\n\t\t\t\t\r\n\t\t\t\tthis._upHighlight.setAttribute(\"fill\", up && wideScreen ? \"#fff\" : \"#000\");\r\n\t\t\t\tthis._downHighlight.setAttribute(\"fill\", !up && wideScreen ? \"#fff\" : \"#000\");\r\n\t\t\t\t\r\n\t\t\t\tthis._upHighlight.setAttribute(\"d\", `M ${center} ${middle - tip} L ${center + width} ${middle - base} L ${center - width} ${middle - base} z`);\r\n\t\t\t\tthis._downHighlight.setAttribute(\"d\", `M ${center} ${middle + tip} L ${center + width} ${middle + base} L ${center - width} ${middle + base} z`);\r\n\t\t\t\t\r\n\t\t\t\tthis._upHighlight.style.visibility = \"visible\";\r\n\t\t\t\tthis._downHighlight.style.visibility = \"visible\";\r\n\t\t\t} else {\r\n\t\t\t\tthis._upHighlight.style.visibility = \"hidden\";\r\n\t\t\t\tthis._downHighlight.style.visibility = \"hidden\";\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._select.style.left = (this._barWidth * this._doc.bar) + \"px\";\r\n\t\t\tthis._select.style.top = (this._channelHeight * this._doc.channel) + \"px\";\r\n\t\t\tthis._select.style.height = this._channelHeight + \"px\";\r\n\t\t\t\r\n\t\t\tconst patternCount: number = this._doc.song.patternsPerChannel;\r\n\t\t\tfor (let i: number = this._renderedPatternCount; i < patternCount; i++) {\r\n\t\t\t\tthis._select.appendChild(option({value:i}, i));\r\n\t\t\t}\r\n\t\t\tfor (let i: number = patternCount; i < this._renderedPatternCount; i++) {\r\n\t\t\t\tthis._select.removeChild(<Node> this._select.lastChild);\r\n\t\t\t}\r\n\t\t\tthis._renderedPatternCount = patternCount;\r\n\t\t\tconst selectedPattern: number = this._doc.song.channels[this._doc.channel].bars[this._doc.bar];\r\n\t\t\tif (this._select.selectedIndex != selectedPattern) this._select.selectedIndex = selectedPattern;\r\n\t\t}\r\n\t\t\r\n\t\tpublic render(): void {\r\n\t\t\tthis._pattern = this._doc.getCurrentPattern();\r\n\t\t\t\r\n\t\t\tconst wideScreen: boolean = window.innerWidth > 700;\r\n\t\t\tconst squashed: boolean = !wideScreen || this._doc.song.getChannelCount() > 5/*4*/ || (this._doc.song.barCount > this._doc.trackVisibleBars && this._doc.song.getChannelCount() > 3);\r\n\t\t\tthis._channelHeight = squashed ? 27 : 32;\r\n\t\t\t\r\n\t\t\tif (this._renderedChannelCount != this._doc.song.getChannelCount()) {\r\n\t\t\t\tfor (let y: number = this._renderedChannelCount; y < this._doc.song.getChannelCount(); y++) {\r\n\t\t\t\t\tthis._grid[y] = [];\r\n\t\t\t\t\tfor (let x: number = 0; x < this._renderedBarCount; x++) {\r\n\t\t\t\t\t\t//const box: Box = new Box(y, x, y, this._doc.song.getChannelColorDim(y), this._doc.showVolumeBar);\r\n\t\t\t\t\t\tconst box: Box = new Box(y, x, y, ColorConfig.getChannelColor(this._doc.song, y).secondaryChannel, this._doc.prefs.showVolumeBar);\r\n\t\t\t\t\t\tbox.setSquashed(squashed, y);\r\n\t\t\t\t\t\tthis._boxContainer.appendChild(box.container);\r\n\t\t\t\t\t\tthis._grid[y][x] = box;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tfor (let y: number = this._doc.song.getChannelCount(); y < this._renderedChannelCount; y++) {\r\n\t\t\t\t\tfor (let x: number = 0; x < this._renderedBarCount; x++) {\r\n\t\t\t\t\t\tthis._boxContainer.removeChild(this._grid[y][x].container);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tthis._grid.length = this._doc.song.getChannelCount();\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (this._renderedBarCount < this._doc.song.barCount) {\r\n\t\t\t\tfor (let y: number = 0; y < this._doc.song.getChannelCount(); y++) {\r\n\t\t\t\t\tfor (let x: number = this._renderedBarCount; x < this._doc.song.barCount; x++) {\r\n\t\t\t\t\t\tconst box: Box = new Box(y, x, y, ColorConfig.getChannelColor(this._doc.song, y).secondaryChannel, this._doc.prefs.showVolumeBar);\r\n\t\t\t\t\t\tbox.setSquashed(squashed, y);\r\n\t\t\t\t\t\tthis._boxContainer.appendChild(box.container);\r\n\t\t\t\t\t\tthis._grid[y][x] = box;\r\n\t\t\t\t\t\t//SVG.text( {x: 16, y: 23, \"font-family\": \"sans-serif\", \"font-size\": 20, \"text-anchor\": \"middle\", \"font-weight\": \"bold\", fill: \"red\"});\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfor (let x: number = this._doc.song.barCount; x < this._renderedBarCount; x++) {\r\n\t\t\t\t\t\tthis._boxContainer.removeChild(this._grid[y][x].container);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis._grid[y].length = this._doc.song.barCount;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (this._renderedBarCount != this._doc.song.barCount) {\r\n\t\t\t\tthis._renderedBarCount = this._doc.song.barCount;\r\n\t\t\t\tconst editorWidth = 32 * this._doc.song.barCount;\r\n\t\t\t\tthis.container.style.width = editorWidth + \"px\";\r\n\t\t\t\tthis._svg.setAttribute(\"width\", editorWidth + \"\");\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (this._renderedSquashed != squashed) {\r\n\t\t\t\tfor (let y: number = 0; y < this._doc.song.getChannelCount(); y++) {\r\n\t\t\t\t\tfor (let x: number = 0; x < this._renderedBarCount; x++) {\r\n\t\t\t\t\t\tthis._grid[y][x].setSquashed(squashed, y);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (this._renderedSquashed != squashed || this._renderedChannelCount != this._doc.song.getChannelCount()) {\r\n\t\t\t\tthis._renderedSquashed = squashed;\r\n\t\t\t\tthis._renderedChannelCount = this._doc.song.getChannelCount();\r\n\t\t\t\tthis._editorHeight = this._doc.song.getChannelCount() * this._channelHeight;\r\n\t\t\t\tthis._svg.setAttribute(\"height\", \"\" + this._editorHeight);\r\n\t\t\t\tthis._playhead.setAttribute(\"height\", \"\" + this._editorHeight);\r\n\t\t\t\tthis.container.style.height = this._editorHeight + \"px\";\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tfor (let j: number = 0; j < this._doc.song.getChannelCount(); j++) {\r\n\t\t\t\tfor (let i: number = 0; i < this._renderedBarCount; i++) {\r\n\t\t\t\t\tconst pattern: Pattern | null = this._doc.song.getPattern(j, i);\r\n\t\t\t\t\tconst patternMute: number = this._doc.song.getPatternInstrumentMute(j, i);\r\n\t\t\t\t\tconst patternVolume: number = this._doc.song.getPatternInstrumentVolume(j, i);\r\n\t\t\t\t\tconst selected: boolean = (i == this._doc.bar && j == this._doc.channel);\r\n\t\t\t\t\tconst dim: boolean = (pattern == null || pattern.notes.length == 0);\r\n\t\t\t\t\tconst mute: boolean = patternMute == 1;\r\n\t\t\t\t\tconst volume: number = patternVolume;\r\n\t\t\t\t\tconst box: Box = this._grid[j][i];\r\n\t\t\t\t\tif (i < this._doc.song.barCount) {\r\n\t\t\t\t\t\tbox.setIndex(\r\n\t\t\t\t\t\t\tthis._doc.song.channels[j].bars[i],\r\n\t\t\t\t\t\t\tdim,\r\n\t\t\t\t\t\t\tselected,\r\n\t\t\t\t\t\t\tj,\r\n\t\t\t\t\t\t\tdim && !selected && !mute ? ColorConfig.getChannelColor(this._doc.song, j).secondaryChannel : mute && !selected ? \"#161616\" : ColorConfig.getChannelColor(this._doc.song, j).primaryChannel,\r\n\t\t\t\t\t\t\tvolume,\r\n\t\t\t\t\t\t\tdim && !selected && !mute ? ColorConfig.getChannelColor(this._doc.song, j).secondaryChannel : mute && !selected ? \"#9b9b9b\" : ColorConfig.getChannelColor(this._doc.song, j).secondaryChannel,\r\n\t\t\t\t\t\t\tthis._doc.prefs.showVolumeBar,\r\n\t\t\t\t\t\t\tthis._doc.song.mix\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\tbox.container.style.visibility = \"visible\";\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tbox.container.style.visibility = \"hidden\";\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._updatePreview();\r\n\t\t}\r\n\t}\r\n\r\n","/*\r\nCopyright (C) 2018 John Nesky\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of \r\nthis software and associated documentation files (the \"Software\"), to deal in \r\nthe Software without restriction, including without limitation the rights to \r\nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \r\nof the Software, and to permit persons to whom the Software is furnished to do \r\nso, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all \r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \r\nSOFTWARE.\r\n*/\r\n\r\nimport { HTML, SVG } from \"imperative-html/dist/esm/elements-strict\";\r\nimport { SongDocument } from \"./SongDocument\";\r\nimport { ChangeLoop } from \"./changes\";\r\nimport { ColorConfig } from \"./ColorConfig\";\r\n\tconst {div} = HTML;\r\n\r\n\r\n\tinterface Cursor {\r\n\t\tstartBar: number;\r\n\t\tmode: number;\r\n\t}\r\n\t\r\n\tinterface Endpoints {\r\n\t\tstart: number;\r\n\t\tlength: number;\r\n\t}\r\n\t\r\n\texport class LoopEditor {\r\n\t\tprivate readonly _barWidth: number = 32;\r\n\t\tprivate readonly _editorHeight: number = 20;\r\n\t\tprivate readonly _startMode:   number = 0;\r\n\t\tprivate readonly _endMode:     number = 1;\r\n\t\tprivate readonly _bothMode:    number = 2;\r\n\t\t\r\n\t\tprivate readonly _loop = <SVGPathElement> SVG.path( {fill: \"none\", stroke: ColorConfig.loopAccent, \"stroke-width\": 4});\r\n\t\tprivate readonly _highlight = <SVGPathElement> SVG.path( {fill: \"white\", \"pointer-events\": \"none\"});\r\n\t\t\r\n\t\tprivate readonly _svg = <SVGSVGElement> SVG.svg( {style: \"touch-action: pan-y; position: absolute;\", height: this._editorHeight}, [\r\n\t\t\tthis._loop,\r\n\t\t\tthis._highlight,\r\n\t\t]);\r\n\t\t\r\n\t\tpublic readonly container: HTMLElement = div({style: \"height: 20px; position: relative; margin: 5px 0;\"}, [this._svg]);\r\n\t\t\r\n\t\tprivate _change: ChangeLoop | null = null;\r\n\t\tprivate _cursor: Cursor = {startBar: -1, mode: -1};\r\n\t\tprivate _mouseX: number = 0;\r\n\t\tpublic _mouseY: number = 0;\r\n\t\tprivate _clientStartX: number = 0;\r\n\t\tprivate _clientStartY: number = 0;\r\n\t\tprivate _startedScrolling: boolean = false;\r\n\t\tprivate _draggingHorizontally: boolean = false;\r\n\t\tprivate _mouseDown: boolean = false;\r\n\t\tprivate _mouseOver: boolean = false;\r\n\t\tprivate _renderedLoopStart: number = -1;\r\n\t\tprivate _renderedLoopStop: number = -1;\r\n\t\tprivate _renderedBarCount: number = 0;\r\n\t\t\r\n\t\tconstructor(private _doc: SongDocument) {\r\n\t\t\tthis._updateCursorStatus();\r\n\t\t\tthis._render();\r\n\t\t\tthis._doc.notifier.watch(this._documentChanged);\r\n\t\t\t\r\n\t\t\tthis._svg.style.backgroundColor = ColorConfig.editorBackground;\r\n\r\n\t\t\tthis.container.addEventListener(\"mousedown\", this._whenMousePressed);\r\n\t\t\tdocument.addEventListener(\"mousemove\", this._whenMouseMoved);\r\n\t\t\tdocument.addEventListener(\"mouseup\", this._whenCursorReleased);\r\n\t\t\tthis.container.addEventListener(\"mouseover\", this._whenMouseOver);\r\n\t\t\tthis.container.addEventListener(\"mouseout\", this._whenMouseOut);\r\n\t\t\t\r\n\t\t\tthis.container.addEventListener(\"touchstart\", this._whenTouchPressed);\r\n\t\t\tthis.container.addEventListener(\"touchmove\", this._whenTouchMoved);\r\n\t\t\tthis.container.addEventListener(\"touchend\", this._whenTouchReleased);\r\n\t\t\tthis.container.addEventListener(\"touchcancel\", this._whenTouchReleased);\r\n\t\t}\r\n\t\t\r\n\t\tprivate _updateCursorStatus(): void {\r\n\t\t\tconst bar: number = this._mouseX / this._barWidth;\r\n\t\t\tthis._cursor.startBar = bar;\r\n\t\t\t\r\n\t\t\tif (bar > this._doc.song.loopStart - 0.25 && bar < this._doc.song.loopStart + this._doc.song.loopLength + 0.25) {\r\n\t\t\t\tif (bar - this._doc.song.loopStart < this._doc.song.loopLength * 0.5) {\r\n\t\t\t\t\tthis._cursor.mode = this._startMode;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis._cursor.mode = this._endMode;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthis._cursor.mode = this._bothMode;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tprivate _findEndPoints(middle: number): Endpoints {\r\n\t\t\tlet start: number = Math.round(middle - this._doc.song.loopLength / 2);\r\n\t\t\tlet end: number = start + this._doc.song.loopLength;\r\n\t\t\tif (start < 0) {\r\n\t\t\t\tend -= start;\r\n\t\t\t\tstart = 0;\r\n\t\t\t}\r\n\t\t\tif (end > this._doc.song.barCount) {\r\n\t\t\t\tstart -= end - this._doc.song.barCount;\r\n\t\t\t\tend = this._doc.song.barCount;\r\n\t\t\t}\r\n\t\t\treturn {start: start, length: end - start};\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenMouseOver = (event: MouseEvent): void => {\r\n\t\t\tif (this._mouseOver) return;\r\n\t\t\tthis._mouseOver = true;\r\n\t\t\tthis._updatePreview();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenMouseOut = (event: MouseEvent): void => {\r\n\t\t\tif (!this._mouseOver) return;\r\n\t\t\tthis._mouseOver = false;\r\n\t\t\tthis._updatePreview();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenMousePressed = (event: MouseEvent): void => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tthis._mouseDown = true;\r\n\t\t\tconst boundingRect: ClientRect = this._svg.getBoundingClientRect();\r\n    \t\tthis._mouseX = (event.clientX || event.pageX) - boundingRect.left;\r\n\t\t    this._mouseY = (event.clientY || event.pageY) - boundingRect.top;\r\n\t\t\tthis._updateCursorStatus();\r\n\t\t\tthis._updatePreview();\r\n\t\t\tthis._whenMouseMoved(event);\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenTouchPressed = (event: TouchEvent): void => {\r\n\t\t\t//event.preventDefault();\r\n\t\t\tthis._mouseDown = true;\r\n\t\t\tconst boundingRect: ClientRect = this._svg.getBoundingClientRect();\r\n\t\t\tthis._mouseX = event.touches[0].clientX - boundingRect.left;\r\n\t\t\tthis._mouseY = event.touches[0].clientY - boundingRect.top;\r\n\t\t\tthis._updateCursorStatus();\r\n\t\t\tthis._updatePreview();\r\n\t\t\t//this._whenTouchMoved(event);\r\n\t\t\tthis._clientStartX = event.touches[0].clientX;\r\n\t\t\tthis._clientStartY = event.touches[0].clientY;\r\n\t\t\tthis._draggingHorizontally = false;\r\n\t\t\tthis._startedScrolling = false;\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenMouseMoved = (event: MouseEvent): void => {\r\n\t\t\tconst boundingRect: ClientRect = this._svg.getBoundingClientRect();\r\n    \t\tthis._mouseX = (event.clientX || event.pageX) - boundingRect.left;\r\n\t\t    this._mouseY = (event.clientY || event.pageY) - boundingRect.top;\r\n\t\t    this._whenCursorMoved();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenTouchMoved = (event: TouchEvent): void => {\r\n\t\t\tif (!this._mouseDown) return;\r\n\t\t\tconst boundingRect: ClientRect = this._svg.getBoundingClientRect();\r\n\t\t\tthis._mouseX = event.touches[0].clientX - boundingRect.left;\r\n\t\t\tthis._mouseY = event.touches[0].clientY - boundingRect.top;\r\n\t\t\t\r\n\t\t\tif (!this._draggingHorizontally && !this._startedScrolling) {\r\n\t\t\t\tif (Math.abs(event.touches[0].clientY - this._clientStartY) > 10) {\r\n\t\t\t\t\tthis._startedScrolling = true;\r\n\t\t\t\t} else if (Math.abs(event.touches[0].clientX - this._clientStartX) > 10) {\r\n\t\t\t\t\tthis._draggingHorizontally = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t    if (this._draggingHorizontally) {\r\n\t\t\t\tthis._whenCursorMoved();\r\n\t\t\t\tevent.preventDefault();\r\n\t\t    }\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenCursorMoved(): void {\r\n\t\t\tif (this._mouseDown) {\r\n\t\t\t\tlet oldStart: number = this._doc.song.loopStart;\r\n\t\t\t\tlet oldEnd: number = this._doc.song.loopStart + this._doc.song.loopLength;\r\n\t\t\t\tif (this._change != null && this._doc.lastChangeWas(this._change)) {\r\n\t\t\t\t\toldStart = this._change.oldStart;\r\n\t\t\t\t\toldEnd = oldStart + this._change.oldLength;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tconst bar: number = this._mouseX / this._barWidth;\r\n\t\t\t\tlet start: number;\r\n\t\t\t\tlet end: number;\r\n\t\t\t\tlet temp: number;\r\n\t\t\t\tif (this._cursor.mode == this._startMode) {\r\n\t\t\t\t\tstart = oldStart + Math.round(bar - this._cursor.startBar);\r\n\t\t\t\t\tend = oldEnd;\r\n\t\t\t\t\t// @TODO: clamp before ChangeLoop like ModBox?\r\n\t\t\t\t\tif (start < 0) start = 0;\r\n\t\t\t\t\tif (start >= this._doc.song.barCount) start = this._doc.song.barCount;\r\n\t\t\t\t\tif (start == end) {\r\n\t\t\t\t\t\tstart = end - 1;\r\n\t\t\t\t\t} else if (start > end) {\r\n\t\t\t\t\t\ttemp = start;\r\n\t\t\t\t\t\tstart = end;\r\n\t\t\t\t\t\tend = temp;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis._change = new ChangeLoop(this._doc, oldStart, oldEnd - oldStart, start, end - start);\r\n\t\t\t\t} else if (this._cursor.mode == this._endMode) {\r\n\t\t\t\t\tstart = oldStart;\r\n\t\t\t\t\tend = oldEnd + Math.round(bar - this._cursor.startBar);\r\n\t\t\t\t\t// @TODO: clamp before ChangeLoop like ModBox?\r\n\t\t\t\t\tif (end < 0) end = 0;\r\n\t\t\t\t\tif (end >= this._doc.song.barCount) end = this._doc.song.barCount;\r\n\t\t\t\t\tif (end == start) {\r\n\t\t\t\t\t\tend = start + 1;\r\n\t\t\t\t\t} else if (end < start) {\r\n\t\t\t\t\t\ttemp = start;\r\n\t\t\t\t\t\tstart = end;\r\n\t\t\t\t\t\tend = temp;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis._change = new ChangeLoop(this._doc, oldStart, oldEnd - oldStart, start, end - start);\r\n\t\t\t\t} else if (this._cursor.mode == this._bothMode) {\r\n\t\t\t\t\tconst endPoints: Endpoints = this._findEndPoints(bar);\r\n\t\t\t\t\tthis._change = new ChangeLoop(this._doc, oldStart, oldEnd - oldStart, endPoints.start, endPoints.length);\r\n\t\t\t\t}\r\n\t\t\t\tthis._doc.setProspectiveChange(this._change);\r\n\t\t\t} else {\r\n\t\t\t\tthis._updateCursorStatus();\r\n\t\t\t\tthis._updatePreview();\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenTouchReleased = (event: TouchEvent): void => {\r\n\t\t\tevent.preventDefault();\r\n\t\t    if (!this._startedScrolling) {\r\n\t\t\t\tthis._whenCursorMoved();\r\n\t\t\t\tthis._mouseOver = false;\r\n\t\t\t\tthis._whenCursorReleased(event);\r\n\t\t\t\tthis._updatePreview();\r\n\t\t    }\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenCursorReleased = (event: Event): void => {\r\n\t\t\tif (this._change != null) this._doc.record(this._change);\r\n\t\t\tthis._change = null;\r\n\t\t\tthis._mouseDown = false;\r\n\t\t\tthis._updateCursorStatus();\r\n\t\t\tthis._render();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _updatePreview(): void {\r\n\t\t\tconst showHighlight: boolean = this._mouseOver && !this._mouseDown;\r\n\t\t\tthis._highlight.style.visibility = showHighlight ? \"visible\" : \"hidden\";\r\n\t\t\t\r\n\t\t\tif (showHighlight) {\r\n\t\t\t\tconst radius: number = this._editorHeight / 2;\r\n\t\t\t\t\r\n\t\t\t\tlet highlightStart: number = (this._doc.song.loopStart) * this._barWidth;\r\n\t\t\t\tlet highlightStop: number = (this._doc.song.loopStart + this._doc.song.loopLength) * this._barWidth;\r\n\t\t\t\tif (this._cursor.mode == this._startMode) {\r\n\t\t\t\t\thighlightStop = (this._doc.song.loopStart) * this._barWidth + radius * 2;\r\n\t\t\t\t} else if (this._cursor.mode == this._endMode) {\r\n\t\t\t\t\thighlightStart = (this._doc.song.loopStart + this._doc.song.loopLength) * this._barWidth - radius * 2;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconst endPoints: Endpoints = this._findEndPoints(this._cursor.startBar);\r\n\t\t\t\t\thighlightStart = (endPoints.start) * this._barWidth;\r\n\t\t\t\t\thighlightStop = (endPoints.start + endPoints.length) * this._barWidth;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tthis._highlight.setAttribute(\"d\",\r\n\t\t\t\t\t`M ${highlightStart + radius} ${4} ` +\r\n\t\t\t\t\t`L ${highlightStop - radius} ${4} ` +\r\n\t\t\t\t\t`A ${radius - 4} ${radius - 4} ${0} ${0} ${1} ${highlightStop - radius} ${this._editorHeight - 4} ` +\r\n\t\t\t\t\t`L ${highlightStart + radius} ${this._editorHeight - 4} ` +\r\n\t\t\t\t\t`A ${radius - 4} ${radius - 4} ${0} ${0} ${1} ${highlightStart + radius} ${4} ` +\r\n\t\t\t\t\t`z`\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tprivate _documentChanged = (): void => {\r\n\t\t\tthis._render();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _render(): void {\r\n\t\t\tconst radius: number = this._editorHeight / 2;\r\n\t\t\tconst loopStart: number = (this._doc.song.loopStart) * this._barWidth;\r\n\t\t\tconst loopStop: number = (this._doc.song.loopStart + this._doc.song.loopLength) * this._barWidth;\r\n\t\t\t\r\n\t\t\tif (this._renderedBarCount != this._doc.song.barCount) {\r\n\t\t\t\tthis._renderedBarCount = this._doc.song.barCount;\r\n\t\t\t\tconst editorWidth = 32 * this._doc.song.barCount;\r\n\t\t\t\tthis.container.style.width = editorWidth + \"px\";\r\n\t\t\t\tthis._svg.setAttribute(\"width\", editorWidth + \"\");\r\n\t\t\t}\r\n\r\n\t\t\tif (this._renderedLoopStart != loopStart || this._renderedLoopStop != loopStop) {\r\n\t\t\t\tthis._renderedLoopStart = loopStart;\r\n\t\t\t\tthis._renderedLoopStop = loopStop;\r\n\t\t\t\tthis._loop.setAttribute(\"d\",\r\n\t\t\t\t\t`M ${loopStart + radius} ${2} ` +\r\n\t\t\t\t\t`L ${loopStop - radius} ${2} ` +\r\n\t\t\t\t\t`A ${radius - 2} ${radius - 2} ${0} ${0} ${1} ${loopStop - radius} ${this._editorHeight - 2} ` +\r\n\t\t\t\t\t`L ${loopStart + radius} ${this._editorHeight - 2} ` +\r\n\t\t\t\t\t`A ${radius - 2} ${radius - 2} ${0} ${0} ${1} ${loopStart + radius} ${2} ` +\r\n\t\t\t\t\t`z`\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._updatePreview();\r\n\t\t}\r\n\t}\r\n\r\n","/*\r\nCopyright (C) 2018 John Nesky\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of \r\nthis software and associated documentation files (the \"Software\"), to deal in \r\nthe Software without restriction, including without limitation the rights to \r\nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \r\nof the Software, and to permit persons to whom the Software is furnished to do \r\nso, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all \r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \r\nSOFTWARE.\r\n*/\r\n\r\nimport { HTML, SVG } from \"imperative-html/dist/esm/elements-strict\";\r\nimport { SongDocument } from \"./SongDocument\";\r\nconst {div} = HTML;\r\n\r\n\texport class BarScrollBar {\r\n\t\tprivate readonly _editorWidth: number = 512;\r\n\t\tprivate readonly _editorHeight: number = 20;\r\n\t\t\r\n\t\tprivate readonly _notches = <SVGSVGElement> SVG.svg( {\"pointer-events\": \"none\"});\r\n\t\tprivate readonly _handle = <SVGRectElement> SVG.rect( {fill: \"#444444\", x: 0, y: 2, width: 10, height: this._editorHeight - 4});\r\n\t\tprivate readonly _handleHighlight = <SVGRectElement> SVG.rect( {fill: \"none\", stroke: \"white\", \"stroke-width\": 2, \"pointer-events\": \"none\", x: 0, y: 1, width: 10, height: this._editorHeight - 2});\r\n\t\tprivate readonly _leftHighlight = <SVGPathElement> SVG.path( {fill: \"white\", \"pointer-events\": \"none\"});\r\n\t\tprivate readonly _rightHighlight = <SVGPathElement> SVG.path( {fill: \"white\", \"pointer-events\": \"none\"});\r\n\t\t\r\n\t\tprivate readonly _svg = <SVGSVGElement> SVG.svg( {style: \"background-color: #000000; touch-action: pan-y; position: absolute;\", width: this._editorWidth, height: this._editorHeight}, [\r\n\t\t\tthis._notches,\r\n\t\t\tthis._handle,\r\n\t\t\tthis._handleHighlight,\r\n\t\t\tthis._leftHighlight,\r\n\t\t\tthis._rightHighlight,\r\n\t\t]);\r\n\t\t\r\n\t\tpublic readonly container: HTMLElement = div({class: \"barScrollBar\", style: \"width: 512px; height: 20px; overflow: hidden; position: relative;\"}, [this._svg]);\r\n\t\t\r\n\t\tprivate _mouseX: number = 0;\r\n\t\tpublic _mouseY: number = 0;\r\n\t\tprivate _mouseDown: boolean = false;\r\n\t\tprivate _mouseOver: boolean = false;\r\n\t\tprivate _dragging: boolean = false;\r\n\t\tprivate _dragStart: number;\r\n\t\tprivate _barWidth: number;\r\n\t\tprivate _renderedNotchCount: number = -1;\r\n\t\tprivate _renderedBarPos: number = -1;\r\n\t\t\r\n\t\tconstructor(private _doc: SongDocument, private _trackContainer: HTMLDivElement) {\r\n\t\t\tconst center: number = this._editorHeight * 0.5;\r\n\t\t\tconst base: number = 20;\r\n\t\t\tconst tip: number = 9;\r\n\t\t\tconst arrowHeight: number = 6;\r\n\t\t\tthis._leftHighlight.setAttribute(\"d\", `M ${tip} ${center} L ${base} ${center + arrowHeight} L ${base} ${center - arrowHeight} z`);\r\n\t\t\tthis._rightHighlight.setAttribute(\"d\", `M ${this._editorWidth - tip} ${center} L ${this._editorWidth - base} ${center + arrowHeight} L ${this._editorWidth - base} ${center - arrowHeight} z`);\r\n\t\t\t\r\n\t\t\tthis.container.addEventListener(\"mousedown\", this._whenMousePressed);\r\n\t\t\tdocument.addEventListener(\"mousemove\", this._whenMouseMoved);\r\n\t\t\tdocument.addEventListener(\"mouseup\", this._whenCursorReleased);\r\n\t\t\tthis.container.addEventListener(\"mouseover\", this._whenMouseOver);\r\n\t\t\tthis.container.addEventListener(\"mouseout\", this._whenMouseOut);\r\n\t\t\t\r\n\t\t\tthis.container.addEventListener(\"touchstart\", this._whenTouchPressed);\r\n\t\t\tthis.container.addEventListener(\"touchmove\", this._whenTouchMoved);\r\n\t\t\tthis.container.addEventListener(\"touchend\", this._whenCursorReleased);\r\n\t\t\tthis.container.addEventListener(\"touchcancel\", this._whenCursorReleased);\r\n\t\t\t\r\n\t\t\t// Sorry, bypassing typescript type safety on this function because I want to use the new \"passive\" option.\r\n\t\t\t//this._trackContainer.addEventListener(\"scroll\", this._onScroll, {capture: false, passive: true});\r\n\t\t\t(<Function>this._trackContainer.addEventListener)(\"scroll\", this._onScroll, {capture: false, passive: true});\r\n\t\t}\r\n\t\t\r\n\t\tprivate _onScroll = (event: Event): void => {\r\n\t\t\tthis._doc.barScrollPos = (this._trackContainer.scrollLeft / 32);\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenMouseOver = (event: MouseEvent): void => {\r\n\t\t\tif (this._mouseOver) return;\r\n\t\t\tthis._mouseOver = true;\r\n\t\t\tthis._updatePreview();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenMouseOut = (event: MouseEvent): void => {\r\n\t\t\tif (!this._mouseOver) return;\r\n\t\t\tthis._mouseOver = false;\r\n\t\t\tthis._updatePreview();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenMousePressed = (event: MouseEvent): void => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tthis._mouseDown = true;\r\n\t\t\tconst boundingRect: ClientRect = this._svg.getBoundingClientRect();\r\n    \t\tthis._mouseX = (event.clientX || event.pageX) - boundingRect.left;\r\n\t\t    this._mouseY = (event.clientY || event.pageY) - boundingRect.top;\r\n\t\t\tthis._updatePreview();\r\n\t\t\tif (this._mouseX >= this._doc.barScrollPos * this._barWidth && this._mouseX <= (this._doc.barScrollPos + this._doc.trackVisibleBars) * this._barWidth) {\r\n\t\t\t\tthis._dragging = true;\r\n\t\t\t\tthis._dragStart = this._mouseX;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenTouchPressed = (event: TouchEvent): void => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tthis._mouseDown = true;\r\n\t\t\tconst boundingRect: ClientRect = this._svg.getBoundingClientRect();\r\n\t\t\tthis._mouseX = event.touches[0].clientX - boundingRect.left;\r\n\t\t\tthis._mouseY = event.touches[0].clientY - boundingRect.top;\r\n\t\t\tthis._updatePreview();\r\n\t\t\tif (this._mouseX >= this._doc.barScrollPos * this._barWidth && this._mouseX <= (this._doc.barScrollPos + this._doc.trackVisibleBars) * this._barWidth) {\r\n\t\t\t\tthis._dragging = true;\r\n\t\t\t\tthis._dragStart = this._mouseX;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenMouseMoved = (event: MouseEvent): void => {\r\n\t\t\tconst boundingRect: ClientRect = this._svg.getBoundingClientRect();\r\n    \t\tthis._mouseX = (event.clientX || event.pageX) - boundingRect.left;\r\n\t\t    this._mouseY = (event.clientY || event.pageY) - boundingRect.top;\r\n\t\t    this._whenCursorMoved();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenTouchMoved = (event: TouchEvent): void => {\r\n\t\t\tif (!this._mouseDown) return;\r\n\t\t\tevent.preventDefault();\r\n\t\t\tconst boundingRect: ClientRect = this._svg.getBoundingClientRect();\r\n\t\t\tthis._mouseX = event.touches[0].clientX - boundingRect.left;\r\n\t\t\tthis._mouseY = event.touches[0].clientY - boundingRect.top;\r\n\t\t    this._whenCursorMoved();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenCursorMoved(): void {\r\n\t\t\tif (this._dragging) {\r\n\t\t\t\twhile (this._mouseX - this._dragStart < -this._barWidth * 0.5) {\r\n\t\t\t\t\tif (this._doc.barScrollPos > 0) {\r\n\t\t\t\t\t\tthis._doc.barScrollPos--;\r\n\t\t\t\t\t\tthis._dragStart -= this._barWidth;\r\n\t\t\t\t\t\tthis._doc.notifier.changed();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\twhile (this._mouseX - this._dragStart > this._barWidth * 0.5) {\r\n\t\t\t\t\tif (this._doc.barScrollPos < this._doc.song.barCount - this._doc.trackVisibleBars) {\r\n\t\t\t\t\t\tthis._doc.barScrollPos++;\r\n\t\t\t\t\t\tthis._dragStart += this._barWidth;\r\n\t\t\t\t\t\tthis._doc.notifier.changed();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (this._mouseOver) this._updatePreview();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenCursorReleased = (event: Event): void => {\r\n\t\t\tif (!this._dragging && this._mouseDown) {\r\n\t\t\t\tif (this._mouseX < (this._doc.barScrollPos + 8) * this._barWidth) {\r\n\t\t\t\t\tif (this._doc.barScrollPos > 0) this._doc.barScrollPos--;\r\n\t\t\t\t\tthis._doc.notifier.changed();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (this._doc.barScrollPos < this._doc.song.barCount - this._doc.trackVisibleBars) this._doc.barScrollPos++;\r\n\t\t\t\t\tthis._doc.notifier.changed();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis._mouseDown = false;\r\n\t\t\tthis._dragging = false;\r\n\t\t\tthis._updatePreview();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _updatePreview(): void {\r\n\t\t\tconst showHighlight: boolean = this._mouseOver && !this._mouseDown;\r\n\t\t\tlet showleftHighlight: boolean = false;\r\n\t\t\tlet showRightHighlight: boolean = false;\r\n\t\t\tlet showHandleHighlight: boolean = false;\r\n\t\t\t\r\n\t\t\tif (showHighlight) {\r\n\t\t\t\tif (this._mouseX < this._doc.barScrollPos * this._barWidth) {\r\n\t\t\t\t\tshowleftHighlight = true;\r\n\t\t\t\t} else if (this._mouseX > (this._doc.barScrollPos + this._doc.trackVisibleBars) * this._barWidth) {\r\n\t\t\t\t\tshowRightHighlight = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tshowHandleHighlight = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._leftHighlight.style.visibility = showleftHighlight ? \"visible\" : \"hidden\";\r\n\t\t\tthis._rightHighlight.style.visibility = showRightHighlight ? \"visible\" : \"hidden\";\r\n\t\t\tthis._handleHighlight.style.visibility = showHandleHighlight ? \"visible\" : \"hidden\";\r\n\t\t}\r\n\t\t\r\n\t\tpublic render(): void {\r\n\t\t\tthis._barWidth = (this._editorWidth-1) / Math.max(this._doc.trackVisibleBars, this._doc.song.barCount);\r\n\t\t\t\r\n\t\t\tconst resized: boolean = this._renderedNotchCount != this._doc.song.barCount;\r\n\t\t\tif (resized) {\r\n\t\t\t\tthis._renderedNotchCount = this._doc.song.barCount;\r\n\t\t\t\t\r\n\t\t\t\twhile (this._notches.firstChild) this._notches.removeChild(this._notches.firstChild);\r\n\t\t\t\t\r\n\t\t\t\tfor (let i: number = 0; i <= this._doc.song.barCount; i++) {\r\n\t\t\t\t\tconst lineHeight: number = (i % 16 == 0) ? 0 : ((i % 4 == 0) ? this._editorHeight / 8 : this._editorHeight / 3);\r\n\t\t\t\t\tthis._notches.appendChild(SVG.rect( {fill: \"#444444\", x: i * this._barWidth - 1, y: lineHeight, width: 2, height: this._editorHeight - lineHeight * 2}));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (resized || this._renderedBarPos != this._doc.barScrollPos) {\r\n\t\t\t\tthis._renderedBarPos = this._doc.barScrollPos;\r\n\t\t\t\tthis._handle.setAttribute(\"x\", \"\" + (this._barWidth * this._doc.barScrollPos));\r\n\t\t\t\tthis._handle.setAttribute(\"width\", \"\" + (this._barWidth * this._doc.trackVisibleBars));\r\n\t\t\t\tthis._handleHighlight.setAttribute(\"x\", \"\" + (this._barWidth * this._doc.barScrollPos));\r\n\t\t\t\tthis._handleHighlight.setAttribute(\"width\", \"\" + (this._barWidth * this._doc.trackVisibleBars));\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._updatePreview();\r\n\t\t\t\r\n\t\t\tthis._trackContainer.scrollLeft = this._doc.barScrollPos * 32;\r\n\t\t}\r\n\t}\r\n\r\n","/*\r\nCopyright (C) 2018 John Nesky\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of \r\nthis software and associated documentation files (the \"Software\"), to deal in \r\nthe Software without restriction, including without limitation the rights to \r\nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \r\nof the Software, and to permit persons to whom the Software is furnished to do \r\nso, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all \r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \r\nSOFTWARE.\r\n*/\r\n\r\nimport { HTML, SVG } from \"imperative-html/dist/esm/elements-strict\";\r\nimport { SongDocument } from \"./SongDocument\";\r\nimport { ChangeOctave } from \"./changes\";\r\nimport { ColorConfig } from \"./ColorConfig\";\r\nimport { Piano } from \"./Piano\";\r\n\tconst {div} = HTML;\r\n\r\n\texport class OctaveScrollBar {\r\n\t\tprivate readonly _editorWidth: number = 20;\r\n\t\tprivate readonly _editorHeight: number = 481;\r\n\t\tprivate readonly _notchHeight: number = 4.0;\r\n\t\tprivate readonly _octaveCount: number = 7;\r\n\t\tprivate readonly _octaveHeight: number = (this._editorHeight - this._notchHeight) / this._octaveCount;\r\n\t\tprivate readonly _barHeight: number = (this._octaveHeight * 3 + this._notchHeight);\r\n\t\t\r\n\t\tprivate readonly _handle = <SVGRectElement> SVG.rect( {fill: ColorConfig.octaveScrollbar, x: 2, y: 0, width: this._editorWidth - 4, height: this._barHeight});\r\n\t\tprivate readonly _handleHighlight = <SVGRectElement> SVG.rect( {fill: \"none\", stroke: \"white\", \"stroke-width\": 2, \"pointer-events\": \"none\", x: 1, y: 0, width: this._editorWidth - 2, height: this._barHeight});\r\n\t\tprivate readonly _upHighlight = <SVGPathElement> SVG.path( {fill: \"white\", \"pointer-events\": \"none\"});\r\n\t\tprivate readonly _downHighlight = <SVGPathElement> SVG.path( {fill: \"white\", \"pointer-events\": \"none\"});\r\n\t\t\r\n\t\tprivate readonly _svg = <SVGSVGElement> SVG.svg( {style: \"touch-action: pan-x; position: absolute;\", width: this._editorWidth, height: \"100%\", viewBox: \"0 0 20 481\", preserveAspectRatio: \"none\"});\r\n\t\tpublic readonly container: HTMLDivElement = div({id: \"octaveScrollBarContainer\", style: \"width: 20px; height: 100%; overflow: hidden; position: relative; flex-shrink: 0;\"}, [this._svg]);\r\n\t\t\r\n\t\tpublic _mouseX: number = 0;\r\n\t\tprivate _mouseY: number = 0;\r\n\t\tprivate _mouseDown: boolean = false;\r\n\t\tprivate _mouseOver: boolean = false;\r\n\t\tprivate _dragging: boolean = false;\r\n\t\tprivate _dragStart: number;\r\n\t\tprivate _barBottom: number;\r\n\t\tprivate _renderedBarBottom: number = -1;\r\n\t\tprivate _change: ChangeOctave | null = null;\r\n\t\t\r\n\t\tconstructor(private _doc: SongDocument, private _piano: Piano) {\r\n\t\t\tthis._doc.notifier.watch(this._documentChanged);\r\n\t\t\tthis._documentChanged();\r\n\t\t\t\r\n\t\t\tthis._svg.appendChild(this._handle);\r\n\t\t\t\r\n\t\t\t// notches:\r\n\t\t\tfor (let i: number = 0; i <= this._octaveCount; i++) {\r\n\t\t\t\tthis._svg.appendChild(SVG.rect( {fill: ColorConfig.scrollbarOctave, x: 0, y: i * this._octaveHeight, width: this._editorWidth, height: this._notchHeight}));\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._svg.appendChild(this._handleHighlight);\r\n\t\t\tthis._svg.appendChild(this._upHighlight);\r\n\t\t\tthis._svg.appendChild(this._downHighlight);\r\n\t\t\tthis._svg.style.backgroundColor = ColorConfig.editorBackground;\r\n\t\t\t\r\n\t\t\tconst center: number = this._editorWidth * 0.5;\r\n\t\t\tconst base: number = 20;\r\n\t\t\tconst tip: number = 9;\r\n\t\t\tconst arrowWidth: number = 6;\r\n\t\t\tthis._upHighlight.setAttribute(\"d\", `M ${center} ${tip} L ${center + arrowWidth} ${base} L ${center - arrowWidth} ${base} z`);\r\n\t\t\tthis._downHighlight.setAttribute(\"d\", `M ${center} ${this._editorHeight - tip} L ${center + arrowWidth} ${this._editorHeight - base} L ${center - arrowWidth} ${this._editorHeight - base} z`);\r\n\t\t\t\r\n\t\t\tthis.container.addEventListener(\"mousedown\", this._whenMousePressed);\r\n\t\t\tdocument.addEventListener(\"mousemove\", this._whenMouseMoved);\r\n\t\t\tdocument.addEventListener(\"mouseup\", this._whenCursorReleased);\r\n\t\t\tthis.container.addEventListener(\"mouseover\", this._whenMouseOver);\r\n\t\t\tthis.container.addEventListener(\"mouseout\", this._whenMouseOut);\r\n\t\t\t\r\n\t\t\tthis.container.addEventListener(\"touchstart\", this._whenTouchPressed);\r\n\t\t\tthis.container.addEventListener(\"touchmove\", this._whenTouchMoved);\r\n\t\t\tthis.container.addEventListener(\"touchend\", this._whenCursorReleased);\r\n\t\t\tthis.container.addEventListener(\"touchcancel\", this._whenCursorReleased);\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenMouseOver = (event: MouseEvent): void => {\r\n\t\t\tif (this._mouseOver) return;\r\n\t\t\tthis._mouseOver = true;\r\n\t\t\tthis._updatePreview();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenMouseOut = (event: MouseEvent): void => {\r\n\t\t\tif (!this._mouseOver) return;\r\n\t\t\tthis._mouseOver = false;\r\n\t\t\tthis._updatePreview();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenMousePressed = (event: MouseEvent): void => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tthis._mouseDown = true;\r\n\t\t\tconst boundingRect: ClientRect = this._svg.getBoundingClientRect();\r\n    \t\tthis._mouseX = (event.clientX || event.pageX) - boundingRect.left;\r\n\t\t    this._mouseY = ((event.clientY || event.pageY) - boundingRect.top) * this._editorHeight / (boundingRect.bottom - boundingRect.top);\r\n\t\t    if (isNaN(this._mouseY)) this._mouseY = 0;\r\n\t\t\tif (this._doc.song.getChannelIsDrum(this._doc.channel)) return;\r\n\t\t\tthis._updatePreview();\r\n\t\t\t\r\n\t\t\tif (this._mouseY >= this._barBottom - this._barHeight && this._mouseY <= this._barBottom) {\r\n\t\t\t\tthis._dragging = true;\r\n\t\t\t\tthis._change = null;\r\n\t\t\t\tthis._dragStart = this._mouseY;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenTouchPressed = (event: TouchEvent): void => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tthis._mouseDown = true;\r\n\t\t\tconst boundingRect: ClientRect = this._svg.getBoundingClientRect();\r\n\t\t\tthis._mouseX = event.touches[0].clientX - boundingRect.left;\r\n\t\t\tthis._mouseY = (event.touches[0].clientY - boundingRect.top) * this._editorHeight / (boundingRect.bottom - boundingRect.top);\r\n\t\t    if (isNaN(this._mouseY)) this._mouseY = 0;\r\n\t\t\tif (this._doc.song.getChannelIsDrum(this._doc.channel)) return;\r\n\t\t\tthis._updatePreview();\r\n\t\t\t\r\n\t\t\tif (this._mouseY >= this._barBottom - this._barHeight && this._mouseY <= this._barBottom) {\r\n\t\t\t\tthis._dragging = true;\r\n\t\t\t\tthis._change = null;\r\n\t\t\t\tthis._dragStart = this._mouseY;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenMouseMoved = (event: MouseEvent): void => {\r\n\t\t\tconst boundingRect: ClientRect = this._svg.getBoundingClientRect();\r\n    \t\tthis._mouseX = (event.clientX || event.pageX) - boundingRect.left;\r\n\t\t    this._mouseY = ((event.clientY || event.pageY) - boundingRect.top) * this._editorHeight / (boundingRect.bottom - boundingRect.top);\r\n\t\t    if (isNaN(this._mouseY)) this._mouseY = 0;\r\n\t\t    this._whenCursorMoved();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenTouchMoved = (event: TouchEvent): void => {\r\n\t\t\tif (!this._mouseDown) return;\r\n\t\t\tevent.preventDefault();\r\n\t\t\tconst boundingRect: ClientRect = this._svg.getBoundingClientRect();\r\n\t\t\tthis._mouseX = event.touches[0].clientX - boundingRect.left;\r\n\t\t\tthis._mouseY = (event.touches[0].clientY - boundingRect.top) * this._editorHeight / (boundingRect.bottom - boundingRect.top);\r\n\t\t    if (isNaN(this._mouseY)) this._mouseY = 0;\r\n\t\t    this._whenCursorMoved();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenCursorMoved(): void {\r\n\t\t\tif (this._doc.song.getChannelIsDrum(this._doc.channel)) return;\r\n\t\t\tif (this._dragging) {\r\n\t\t\t\tconst currentOctave: number = this._doc.song.channels[this._doc.channel].octave;\r\n\t\t\t\tconst continuingProspectiveChange: boolean = this._doc.lastChangeWas(this._change);\r\n\t\t\t\tconst oldValue: number = continuingProspectiveChange ? this._change!.oldValue : currentOctave;\r\n\t\t\t\t\r\n\t\t\t\tlet octave: number = currentOctave;\r\n\t\t\t\twhile (this._mouseY - this._dragStart < -this._octaveHeight * 0.5) {\r\n\t\t\t\t\tif (octave < 4) {\r\n\t\t\t\t\t\toctave++;\r\n\t\t\t\t\t\tthis._dragStart -= this._octaveHeight;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\twhile (this._mouseY - this._dragStart > this._octaveHeight * 0.5) {\r\n\t\t\t\t\tif (octave > 0) {\r\n\t\t\t\t\t\toctave--;\r\n\t\t\t\t\t\tthis._dragStart += this._octaveHeight;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tthis._change = new ChangeOctave(this._doc, oldValue, octave);\r\n\t\t\t\tthis._doc.setProspectiveChange(this._change);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (this._mouseOver) this._updatePreview();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenCursorReleased = (event: Event): void => {\r\n\t\t\tif (!this._doc.song.getChannelIsDrum(this._doc.channel) && this._mouseDown) {\r\n\t\t\t\tif (this._dragging) {\r\n\t\t\t\t\tif (this._change != null) this._doc.record(this._change);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconst canReplaceLastChange: boolean = this._doc.lastChangeWas(this._change);\r\n\t\t\t\t\tconst oldValue: number = canReplaceLastChange ? this._change!.oldValue : this._doc.song.channels[this._doc.channel].octave;\r\n\t\t\t\t\tconst currentOctave: number = this._doc.song.channels[this._doc.channel].octave;\r\n\t\t\t\t\r\n\t\t\t\t\tif (this._mouseY < this._barBottom - this._barHeight * 0.5) {\r\n\t\t\t\t\t\tif (currentOctave < 4) {\r\n\t\t\t\t\t\t\tthis._change = new ChangeOctave(this._doc, oldValue, currentOctave + 1);\r\n\t\t\t\t\t\t\tthis._doc.record(this._change, canReplaceLastChange);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (currentOctave > 0) {\r\n\t\t\t\t\t\t\tthis._change = new ChangeOctave(this._doc, oldValue, currentOctave - 1);\r\n\t\t\t\t\t\t\tthis._doc.record(this._change, canReplaceLastChange);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis._mouseDown = false;\r\n\t\t\tthis._dragging = false;\r\n\t\t\tthis._updatePreview();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _updatePreview(): void {\r\n\t\t\tconst showHighlight: boolean = this._mouseOver && !this._mouseDown;\r\n\t\t\tlet showUpHighlight: boolean = false;\r\n\t\t\tlet showDownHighlight: boolean = false;\r\n\t\t\tlet showHandleHighlight: boolean = false;\r\n\t\t\t\r\n\t\t\tif (showHighlight) {\r\n\t\t\t\tif (this._mouseY < this._barBottom - this._barHeight) {\r\n\t\t\t\t\tshowUpHighlight = true;\r\n\t\t\t\t} else if (this._mouseY > this._barBottom) {\r\n\t\t\t\t\tshowDownHighlight = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tshowHandleHighlight = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._upHighlight.style.visibility = showUpHighlight ? \"inherit\" : \"hidden\";\r\n\t\t\tthis._downHighlight.style.visibility = showDownHighlight ? \"inherit\" : \"hidden\";\r\n\t\t\tthis._handleHighlight.style.visibility = showHandleHighlight ? \"inherit\" : \"hidden\";\r\n\t\t}\r\n\t\t\r\n\t\tprivate _documentChanged = (): void => {\r\n\t\t\tthis._barBottom = this._editorHeight - (this._octaveHeight * this._doc.song.channels[this._doc.channel].octave);\r\n\t\t\tthis._render();\r\n\t\t\tthis._piano.forceRender();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _render(): void {\r\n\t\t\tthis._svg.style.visibility = (this._doc.song.getChannelIsDrum(this._doc.channel)) ? \"hidden\" : \"visible\";\r\n\t\t\tif (this._renderedBarBottom != this._barBottom) {\r\n\t\t\t\tthis._renderedBarBottom = this._barBottom;\r\n\t\t\t\tthis._handle.setAttribute(\"y\", \"\" + (this._barBottom - this._barHeight));\r\n\t\t\t\tthis._handleHighlight.setAttribute(\"y\", \"\" + (this._barBottom - this._barHeight));\r\n\t\t\t}\r\n\t\t\tthis._updatePreview();\r\n\t\t}\r\n\t}\r\n\r\n","/*\r\nCopyright (C) 2018 John Nesky\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of \r\nthis software and associated documentation files (the \"Software\"), to deal in \r\nthe Software without restriction, including without limitation the rights to \r\nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \r\nof the Software, and to permit persons to whom the Software is furnished to do \r\nso, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all \r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \r\nSOFTWARE.\r\n*/\r\n\r\nimport { HTML } from \"imperative-html/dist/esm/elements-strict\";\r\nimport { SongDocument } from \"./SongDocument\";\r\nimport { Config } from \"../synth/SynthConfig\";\r\nimport { ColorConfig } from \"./ColorConfig\";\r\n\tconst {canvas, div} = HTML;\r\n\r\n\texport class Piano {\r\n\r\n\t\tprivate readonly _pianoContainer: HTMLDivElement = HTML.div({style: \"width: 100%; height: 100%; display: flex; flex-direction: column-reverse; align-items: stretch;\"});\r\n\t\tprivate readonly _drumContainer: HTMLDivElement = HTML.div({style: \"width: 100%; height: 100%; display: flex; flex-direction: column-reverse; align-items: stretch;\"});\r\n\t\tprivate readonly _preview: HTMLCanvasElement = canvas({width: \"32\", height: \"40\"});\r\n\t\tpublic readonly container: HTMLDivElement = div({style: \"width: 32px; height: 100%; overflow:hidden; position: relative; flex-shrink: 0; touch-action: none;\"}, [\r\n\t\t\tthis._pianoContainer,\r\n\t\t\tthis._drumContainer,\r\n\t\t\tthis._preview,\r\n\t\t]);\r\n\t\tprivate readonly _editorHeight: number = 481;\r\n\t\tprivate readonly _pianoKeys: HTMLDivElement[] = [];\r\n\t\tprivate readonly _pianoLabels: HTMLDivElement[] = [];\r\n\t\t\r\n\t\tprivate _pitchHeight: number;\r\n\t\tprivate _pitchCount: number;\r\n\t\tpublic _mouseX: number = 0;\r\n\t\tprivate _mouseY: number = 0;\r\n\t\tprivate _mouseDown: boolean = false;\r\n\t\tprivate _mouseOver: boolean = false;\r\n\t\tprivate _cursorPitch: number;\r\n\t\t//private _playedPitch: number = -1;\r\n\t\tprivate _renderedScale: number = -1;\r\n\t\tprivate _renderedDrums: boolean = false;\r\n\t\tprivate _renderedKey: number = -1;\r\n\t\tprivate _renderedPitchCount: number = -1;\r\n\t\tprivate readonly _renderedLiveInputPitches: number[] = [];\r\n\t\t\r\n\t\tconstructor(private _doc: SongDocument) {\r\n\t\t\tfor (let i: number = 0; i < Config.drumCount; i++) {\r\n\t\t\t\tconst scale: number = (1.0 - (i / Config.drumCount) * 0.35) * 100;\r\n\t\t\t\tthis._drumContainer.appendChild(HTML.div({class: \"drum-button\", style: `background-size: ${scale}% ${scale}%;`}));\r\n\t\t\t}\r\n\t\t\tthis._doc.notifier.watch(this._documentChanged);\r\n\t\t\tthis._documentChanged();\r\n\t\t\t\r\n\t\t\t//this.container.addEventListener(\"mousedown\", this._whenMousePressed);\r\n\t\t\tdocument.addEventListener(\"mousemove\", this._whenMouseMoved);\r\n\t\t\tdocument.addEventListener(\"mouseup\", this._whenMouseReleased);\r\n\t\t\tthis.container.addEventListener(\"mouseover\", this._whenMouseOver);\r\n\t\t\tthis.container.addEventListener(\"mouseout\", this._whenMouseOut);\r\n\t\t\t\r\n\t\t\t//this.container.addEventListener(\"touchstart\", this._whenTouchPressed);\r\n\t\t\tthis.container.addEventListener(\"touchmove\", this._whenTouchMoved);\r\n\t\t\tthis.container.addEventListener(\"touchend\", this._whenTouchReleased);\r\n\t\t\tthis.container.addEventListener(\"touchcancel\", this._whenTouchReleased);\r\n\t\t}\r\n\t\t\r\n\t\tpublic forceRender(): void {\r\n\t\t\tthis._renderedScale = -1;\r\n\t\t\tthis._documentChanged();\r\n\t\t}\r\n\r\n\t\tprivate _updateCursorPitch(): void {\r\n\t\tconst scale: ReadonlyArray<boolean> = Config.scales[this._doc.song.scale].flags;\r\n\t\tconst mousePitch: number = Math.max(0, Math.min(this._pitchCount-1, this._pitchCount - (this._mouseY / this._pitchHeight)));\r\n\t\tif (scale[Math.floor(mousePitch) % Config.pitchesPerOctave] || this._doc.song.getChannelIsDrum(this._doc.channel)) {\r\n\t\t\tthis._cursorPitch = Math.floor(mousePitch);\r\n\t\t} else {\r\n\t\t\tlet topPitch: number = Math.floor(mousePitch) + 1;\r\n\t\t\tlet bottomPitch: number = Math.floor(mousePitch) - 1;\r\n\t\t\twhile (!scale[topPitch % Config.pitchesPerOctave]) {\r\n\t\t\t\ttopPitch++;\r\n\t\t\t}\r\n\t\t\twhile (!scale[(bottomPitch) % Config.pitchesPerOctave]) {\r\n\t\t\t\tbottomPitch--;\r\n\t\t\t}\r\n\t\t\tlet topRange: number = topPitch;\r\n\t\t\tlet bottomRange: number = bottomPitch + 1;\r\n\t\t\tif (topPitch % Config.pitchesPerOctave == 0 || topPitch % Config.pitchesPerOctave == 7) {\r\n\t\t\t\ttopRange -= 0.5;\r\n\t\t\t}\r\n\t\t\tif (bottomPitch % Config.pitchesPerOctave == 0 || bottomPitch % Config.pitchesPerOctave == 7) {\r\n\t\t\t\tbottomRange += 0.5;\r\n\t\t\t}\r\n\t\t\tthis._cursorPitch = mousePitch - bottomRange > topRange - mousePitch ? topPitch : bottomPitch;\r\n\t\t}\r\n\t}\r\n\r\n\t\t/*private _playLiveInput(): void {\r\n\t\t\tconst currentPitch: number = this._cursorPitch + this._doc.song.channels[this._doc.channel].octave * 12;\r\n\t\t\tif (this._playedPitch == currentPitch) return;\r\n\t\t\tthis._playedPitch = currentPitch;\r\n\t\t\tthis._doc.synth.liveInputDuration = Number.MAX_SAFE_INTEGER;\r\n\t\t\tthis._doc.synth.liveInputPitches = [this._playedPitch];\r\n\t\t\tthis._doc.synth.liveInputStarted = true;\r\n\t\t}*/\r\n\t\t\r\n\t\tprivate _whenMouseOver = (event: MouseEvent): void => {\r\n\t\t\tif (this._mouseOver) return;\r\n\t\t\tthis._mouseOver = true;\r\n\t\t\tthis._updatePreview();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenMouseOut = (event: MouseEvent): void => {\r\n\t\t\tif (!this._mouseOver) return;\r\n\t\t\tthis._mouseOver = false;\r\n\t\t\tthis._updatePreview();\r\n\t\t}\r\n\t\t\r\n\t\t/*private _whenMousePressed = (event: MouseEvent): void => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\t//this._doc.synth.maintainLiveInput();\r\n\t\t\tthis._mouseDown = true;\r\n\t\t\tconst boundingRect: ClientRect = this.container.getBoundingClientRect();\r\n\t\t\t//this._mouseX = (event.clientX || event.pageX) - boundingRect.left;\r\n\t\t\tthis._mouseY = ((event.clientY || event.pageY) - boundingRect.top) * this._editorHeight / (boundingRect.bottom - boundingRect.top);\r\n\t\t\tif (isNaN(this._mouseY)) this._mouseY = 0;\r\n\t\t\tthis._updateCursorPitch();\r\n\t\t\t//this._playLiveInput();\r\n\t\t\tthis._updatePreview();\r\n\t\t}*/\r\n\t\t\r\n\t\tprivate _whenMouseMoved = (event: MouseEvent): void => {\r\n\t\t\tconst boundingRect: ClientRect = this.container.getBoundingClientRect();\r\n    \t\tthis._mouseX = (event.clientX || event.pageX) - boundingRect.left;\r\n\t\t    this._mouseY = ((event.clientY || event.pageY) - boundingRect.top) * this._editorHeight / (boundingRect.bottom - boundingRect.top);\r\n\t\t    if (isNaN(this._mouseY)) this._mouseY = 0;\r\n\t\t\tthis._updateCursorPitch();\r\n\t\t\tthis._doc.synth.pianoPitch[0] = this._cursorPitch + this._doc.song.channels[this._doc.channel].octave * 12;\r\n\t\t\tthis._updatePreview();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenMouseReleased = (event: MouseEvent): void => {\r\n\t\t\tthis._mouseDown = false;\r\n\t\t\tthis._doc.synth.pianoPressed = false;\r\n\t\t\tthis._updatePreview();\r\n\t\t}\r\n\t\t\r\n\t\t/*private _whenTouchPressed = (event: TouchEvent): void => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tthis._mouseDown = true;\r\n\t\t\tconst boundingRect: ClientRect = this.container.getBoundingClientRect();\r\n\t\t\tthis._mouseX = event.touches[0].clientX - boundingRect.left;\r\n\t\t\tthis._mouseY = (event.touches[0].clientY - boundingRect.top) * this._editorHeight / (boundingRect.bottom - boundingRect.top);\r\n\t\t    if (isNaN(this._mouseY)) this._mouseY = 0;\r\n\t\t\tthis._updateCursorPitch();\r\n\t\t\tthis._doc.synth.pianoPressed = true;\r\n\t\t\tthis._doc.synth.pianoPitch[0] = this._cursorPitch + this._doc.song.channels[this._doc.channel].octave * 12;\r\n\t\t}*/\r\n\t\t\r\n\t\tprivate _whenTouchMoved = (event: TouchEvent): void => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tconst boundingRect: ClientRect = this.container.getBoundingClientRect();\r\n\t\t\tthis._mouseX = event.touches[0].clientX - boundingRect.left;\r\n\t\t\tthis._mouseY = (event.touches[0].clientY - boundingRect.top) * this._editorHeight / (boundingRect.bottom - boundingRect.top);\r\n\t\t    if (isNaN(this._mouseY)) this._mouseY = 0;\r\n\t\t\tthis._updateCursorPitch();\r\n\t\t\tthis._doc.synth.pianoPitch[0] = this._cursorPitch + this._doc.song.channels[this._doc.channel].octave * 12;\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenTouchReleased = (event: TouchEvent): void => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tthis._doc.synth.pianoPressed = false;\r\n\t\t}\r\n\t\t\r\n\t\tprivate _updatePreview(): void {\r\n\t\t\tthis._preview.style.visibility = (!this._mouseOver || this._mouseDown) ? \"hidden\" : \"visible\";\r\n\t\t\r\n\t\tif (this._mouseOver && !this._mouseDown) {\r\n\t\t\tconst boundingRect: ClientRect = this.container.getBoundingClientRect();\r\n\t\t\tconst pitchHeight: number = this._pitchHeight / (this._editorHeight / (boundingRect.bottom - boundingRect.top));\r\n\t\t\t\r\n\t\t\tthis._preview.style.left = \"0px\";\r\n\t\t\tthis._preview.style.top = pitchHeight * (this._pitchCount - this._cursorPitch - 1) + \"px\";\r\n\t\t\tthis._preview.style.height = pitchHeight + \"px\";\r\n\t\t}\r\n\t\t\r\n\t\t\tconst octaveOffset: number = this._doc.getBaseVisibleOctave(this._doc.channel) * Config.pitchesPerOctave;\r\n\t\t\tconst container: HTMLDivElement = this._doc.song.getChannelIsDrum(this._doc.channel) ? this._drumContainer : this._pianoContainer;\r\n\t\t\tconst children: HTMLCollection = container.children;\r\n\t\t\tfor (let i: number = 0; i < children.length; i++) {\r\n\t\t\t\tconst child: Element = children[i];\r\n\t\t\t\tif (this._renderedLiveInputPitches.indexOf(i + octaveOffset) == -1) {\r\n\t\t\t\t\tchild.classList.remove(\"pressed\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\tchild.classList.add(\"pressed\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tprivate _documentChanged = (): void => {\r\n\t\t\tconst isDrum: boolean = this._doc.song.getChannelIsDrum(this._doc.channel);\r\n\t\t\tthis._pitchCount = isDrum ? Config.drumCount : this._doc.getVisiblePitchCount();\r\n\t\t\tthis._pitchHeight = this._editorHeight / this._pitchCount;\r\n\t\t\tthis._updateCursorPitch();\r\n\t\t\t//if (this._mouseDown) this._playLiveInput();\r\n\t\t\t\r\n\t\t\tif (!this._doc.prefs.showLetters) return;\r\n\t\t\tif (this._renderedScale == this._doc.song.scale && this._renderedKey == this._doc.song.key && this._renderedDrums == isDrum && this._renderedPitchCount == this._pitchCount) return;\r\n\t\t\t\r\n\t\t\tthis._renderedScale = this._doc.song.scale;\r\n\t\t\tthis._renderedKey = this._doc.song.key;\r\n\t\t\tthis._renderedDrums = isDrum;\r\n\t\t\t\r\n\t\t\tthis._pianoContainer.style.display = isDrum ? \"none\" : \"flex\";\r\n\t\t\tthis._drumContainer.style.display = isDrum ? \"flex\" : \"none\";\r\n\t\t\t\r\n\t\t\tif (!isDrum) {\r\n\t\t\t\tif (this._renderedPitchCount != this._pitchCount) {\r\n\t\t\t\t\tthis._pianoContainer.innerHTML = \"\";\r\n\t\t\t\t\tfor (let i: number = 0; i < this._pitchCount; i++) {\r\n\t\t\t\t\t\tconst pianoLabel: HTMLDivElement = HTML.div({class: \"piano-label\", style: \"font-weight: bold; -webkit-text-stroke-width: 0; font-size: 11px; font-family: sans-serif; position: absolute; padding-left: 15px;\"});\r\n\t\t\t\t\t\tconst pianoKey: HTMLDivElement = HTML.div({class: \"piano-button\", style: \"background: gray;\"}, pianoLabel);\r\n\t\t\t\t\t\tthis._pianoContainer.appendChild(pianoKey);\r\n\t\t\t\t\t\tthis._pianoLabels[i] = pianoLabel;\r\n\t\t\t\t\t\tthis._pianoKeys[i] = pianoKey;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis._pianoLabels.length = this._pitchCount;\r\n\t\t\t\t\tthis._pianoKeys.length = this._pitchCount;\r\n\t\t\t\t\tthis._renderedPitchCount = this._pitchCount;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tfor (let j: number = 0; j < this._pitchCount; j++) {\r\n\t\t\t\t\tconst pitchNameIndex: number = (j + Config.keys[this._doc.song.key].basePitch) % Config.pitchesPerOctave;\r\n\t\t\t\t\tconst isWhiteKey: boolean = Config.keys[pitchNameIndex].isWhiteKey;\r\n\t\t\t\t\tthis._pianoKeys[j].style.background = isWhiteKey ? ColorConfig.whitePianoKey : ColorConfig.blackPianoKey;\r\n\t\t\t\t\tif (!Config.scales[this._doc.song.scale].flags[j % Config.pitchesPerOctave]) {\r\n\t\t\t\t\t\tthis._pianoKeys[j].classList.add(\"disabled\");\r\n\t\t\t\t\t\tthis._pianoLabels[j].style.display = \"none\";\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis._pianoKeys[j].classList.remove(\"disabled\");\r\n\t\t\t\t\t\tthis._pianoLabels[j].style.display = \"\";\r\n\t\t\t\t\t\tconst label: HTMLDivElement = this._pianoLabels[j];\r\n\t\t\t\t\t\tif ((j % 12) == 0) {\r\n\t\t\t\t\t\t\tlabel.style.transform = \"translate(-5px, 0px)\";\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\tlabel.style.transform = \"translate(0px, 0px)\";\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tlabel.style.color = Config.keys[pitchNameIndex].isWhiteKey ? \"black\" : \"white\";\r\n\t\t\t\t\t\tlabel.textContent = Piano.getPitchName(pitchNameIndex, j, this._doc.getBaseVisibleOctave(this._doc.channel));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis._updatePreview();\r\n\t\t}\r\n\t\r\n\t\tpublic static getPitchName(pitchNameIndex: number, scaleIndex: number, baseVisibleOctave: number): string {\r\n\t\tlet text: string;\r\n\r\n\t\tif (Config.keys[pitchNameIndex].isWhiteKey) {\r\n\t\t\ttext = Config.keys[pitchNameIndex].name;\r\n\t\t} else {\r\n\t\t\tconst shiftDir: number = Config.blackKeyNameParents[scaleIndex % Config.pitchesPerOctave];\r\n\t\t\ttext = Config.keys[(pitchNameIndex + Config.pitchesPerOctave + shiftDir) % Config.pitchesPerOctave].name;\r\n\t\t\tif (shiftDir == 1) {\r\n\t\t\t\ttext += \"♭\";\r\n\t\t\t} else if (shiftDir == -1) {\r\n\t\t\t\ttext += \"♯\";\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (scaleIndex % 12 == 0) {\r\n\t\t\ttext += Math.floor(scaleIndex / 12) + baseVisibleOctave;\r\n\t\t}\r\n\r\n\t\treturn text;\r\n\t}\r\n\t\t\r\n\t}\r\n\r\n","/*\r\nCopyright (C) 2018 John Nesky\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of \r\nthis software and associated documentation files (the \"Software\"), to deal in \r\nthe Software without restriction, including without limitation the rights to \r\nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \r\nof the Software, and to permit persons to whom the Software is furnished to do \r\nso, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all \r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \r\nSOFTWARE.\r\n*/\r\n\r\nimport { HTML } from \"imperative-html/dist/esm/elements-strict\";\r\nimport { Prompt } from \"./Prompt\";\r\nimport { SongDocument } from \"./SongDocument\";\r\n\tconst {button, div} = HTML;\r\n\r\n\t\texport class MixPrompt implements Prompt {\r\n\t\tprivate readonly _cancelButton: HTMLButtonElement = button({}, [div(\"Close\")]);\r\n\t\tpublic readonly container: HTMLDivElement = div({class: \"prompt\", style: \"width: 300px;\"}, [\r\n\t\t\tdiv({style: \"font-size: 2em\"}, [div(\"Mixing Styles\")]),\r\n\t\t\tdiv({style: \"text-align: left; margin: 0.5em 0;\"}, [\r\n\t\t\t\tdiv(\"Mixing styles are a way how changing how loud or soft different sounds are and can change the way different sounds blend and mix together. Using different mixing styles can drastically change your song.\")]),\r\n\t\t\tdiv({style: \"text-align: left; margin: 0.5em 0;\"}, [\r\n\t\t\t\tdiv(\"Type A Mixing is akin to mixing in vanilla Beepbox, Sandbox, and most other beepbox mods. In this mixing type, the drums are about twice as loud as in Type B mixing and the sound is generally a bit sharper and blends together differently.\")]),\r\n\t\t\tdiv({style: \"text-align: left; margin: 0.5em 0;\"}, [\r\n\t\t\t\tdiv(\"Type B Mixing is regular Modbox mixing.\")]),\r\n\t\t\tdiv({style: \"text-align: left; margin: 0.5em 0;\"}, [\r\n\t\t\t\tdiv(\"Type C Mixing is like Type B, save for a few upgrades. There are more volume options in Type C mixing, certain waves (acoustic bass, lyre, ramp pulse, and piccolo) are a bit quieter, the flatline wave is a bit louder, and blending works slightly differently.\")]),\r\n\t\t\tdiv({style: \"text-align: left; margin: 0.5em 0;\"}, [\r\n\t\t\t\tdiv(\"Type D Mixing includes slightly quieter drums from Type B, but also includes sharper sounds for regular notes in pitch channels.\")]),\r\n\t\t\tthis._cancelButton,\r\n\t\t]);\t\r\n\t\t\tconstructor(private _doc: SongDocument) {\r\n\t\t\t\tthis._cancelButton.addEventListener(\"click\", this._close);\r\n\t\t\t}\r\n\r\n\t\t\tprivate _close = (): void => { \r\n\t\t\t\tthis._doc.undo();\r\n\t\t\t}\r\n\t\t\t\t\r\n\t\t\tpublic cleanUp = (): void => { \r\n\t\t\t\tthis._cancelButton.removeEventListener(\"click\", this._close);\r\n\t\t\t};\r\n\t\t}\r\n\t","/*\r\nCopyright (C) 2018 John Nesky\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of \r\nthis software and associated documentation files (the \"Software\"), to deal in \r\nthe Software without restriction, including without limitation the rights to \r\nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \r\nof the Software, and to permit persons to whom the Software is furnished to do \r\nso, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all \r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \r\nSOFTWARE.\r\n*/\r\n\r\nimport { HTML } from \"imperative-html/dist/esm/elements-strict\";\r\nimport { Prompt } from \"./Prompt\";\r\nimport { SongDocument } from \"./SongDocument\";\r\n\tconst {button, div} = HTML;\r\n\r\n\texport class ChorusPrompt implements Prompt {\r\n\t\tprivate readonly _cancelButton: HTMLButtonElement = button({}, [div(\"Close\")]);\r\n\t\t\r\n\t\tpublic readonly container: HTMLDivElement = div({class: \"prompt\", style: \"width: 250px;\"}, [\r\n\t\t\tdiv({style: \"font-size: 2em\"}, [div(\"Custom Harmony\")]),\r\n\t\t\tdiv({style: \"text-align: left;\"}, [div(\r\n\t\t\t\t'BeepBox \"chip\" instruments play two waves at once, each with their own pitch.')]),\r\n\t\t\tdiv({style: \"text-align: left;\" }, [div('By placing two notes one above another it will play two indivdual sounds. ' +\r\n\t\t\t'This replaces the \"arpeggio/trill\" effect, and gives you greater control over your harmony. ')]),\r\n\t\t\tdiv({ style: \"text-align: left;\" }, [\r\n\t\t\t\tdiv('In older versions of Modbox, union would not allow notes to harmonize properly and needed a special harmonic chorus in order to work. This has been patched in Modbox 3.1.0. '\r\n\t\t\t\t)]),\r\n\t\t\tthis._cancelButton,\r\n\t\t]);\r\n\t\t\r\n\t\tconstructor(private _doc: SongDocument) {\r\n\t\t\tthis._cancelButton.addEventListener(\"click\", this._close);\r\n\t\t}\r\n\t\t\r\n\t\tprivate _close = (): void => { \r\n\t\t\tthis._doc.undo();\r\n\t\t}\r\n\t\t\r\n\t\tpublic cleanUp = (): void => { \r\n\t\t\tthis._cancelButton.removeEventListener(\"click\", this._close);\r\n\t\t}\r\n\t}\r\n\r\n","/*\r\nCopyright (C) 2018 John Nesky\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of \r\nthis software and associated documentation files (the \"Software\"), to deal in \r\nthe Software without restriction, including without limitation the rights to \r\nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \r\nof the Software, and to permit persons to whom the Software is furnished to do \r\nso, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all \r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \r\nSOFTWARE.\r\n*/\r\n\r\nimport { Config, Dictionary, InstrumentType, EnvelopeType } from \"./SynthConfig\";\r\nimport { Instrument, Song, Note, NotePin, Pattern } from \"./song\";\r\n//import { Deque } from \"./Deque\";\r\n\r\n\tdeclare global {\r\n\t\tinterface Window {\r\n\t\t\tAudioContext: any;\r\n\t\t\twebkitAudioContext: any;\r\n\t\t}\r\n\t}\r\n\r\n\tclass SynthChannel {\r\n\t\tpublic sampleLeft: number = 0.0;\r\n\t\tpublic sampleRight: number = 0.0;\r\n\t\tpublic readonly phases: number[] = [];\r\n\t\tpublic readonly phaseDeltas: number[] = [];\r\n\t\tpublic readonly volumeStarts: number[] = [];\r\n\t\tpublic readonly volumeDeltas: number[] = [];\r\n\t\tpublic readonly volumeLeft: number[] = [];\r\n\t\tpublic readonly volumeRight: number[] = [];\r\n\t\tpublic phaseDeltaScale: number = 0.0;\r\n\t\tpublic filter: number = 0.0;\r\n\t\tpublic filterScale: number = 0.0;\r\n\t\tpublic vibratoScale: number = 0.0;\r\n\t\tpublic harmonyMult: number = 0.0;\r\n\t\tpublic harmonyVolumeMult: number = 1.0;\r\n\t\tpublic feedbackOutputs: number[] = [];\r\n\t\tpublic feedbackMult: number = 0.0;\r\n\t\tpublic feedbackDelta: number = 0.0;\r\n\t\t\r\n\t\tconstructor() {\r\n\t\t\tthis.reset();\r\n\t\t}\r\n\t\t\r\n\t\tpublic reset(): void {\r\n\t\t\tfor (let i: number = 0; i < Config.operatorCount; i++) {\r\n\t\t\t\tthis.phases[i] = 0.0;\r\n\t\t\t\tthis.feedbackOutputs[i] = 0.0;\r\n\t\t\t}\r\n\t\t\tthis.sampleLeft = 0.0;\r\n\t\t\tthis.sampleRight = 0.0;\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class Tone {\r\n\t\tpublic instrument: Instrument;\r\n\t\tpublic readonly pitches: number[] = [0, 0, 0, 0];\r\n\t\tpublic pitchCount: number = 0;\r\n\t\tpublic chordSize: number = 0;\r\n\t\tpublic drumsetPitch: number = 0;\r\n\t\tpublic note: Note | null = null;\r\n\t\tpublic prevNote: Note | null = null;\r\n\t\tpublic nextNote: Note | null = null;\r\n\t\tpublic prevNotePitchIndex: number = 0;\r\n\t\tpublic nextNotePitchIndex: number = 0;\r\n\t\tpublic active: boolean = false;\r\n\t\tpublic noteStart: number = 0;\r\n\t\tpublic noteEnd: number = 0;\r\n\t\tpublic noteLengthTicks: number = 0;\r\n\t\tpublic ticksSinceReleased: number = 0;\r\n\t\tpublic liveInputSamplesHeld: number = 0;\r\n\t\tpublic lastInterval: number = 0;\r\n\t\tpublic lastVolume: number = 0;\r\n\t\tpublic stereoVolume1: number = 0.0;\r\n\t\tpublic stereoVolume2: number = 0.0;\r\n\t\tpublic stereoOffset: number = 0.0;\r\n\t\tpublic stereoDelay: number = 0.0;\r\n\t\tpublic sample: number = 0.0;\r\n\t\tpublic readonly phases: number[] = [];\r\n\t\tpublic readonly phaseDeltas: number[] = [];\r\n\t\tpublic readonly volumeStarts: number[] = [];\r\n\t\tpublic readonly volumeDeltas: number[] = [];\r\n\t\tpublic volumeStart: number = 0.0;\r\n\t\tpublic volumeDelta: number = 0.0;\r\n\t\tpublic phaseDeltaScale: number = 0.0;\r\n\t\tpublic pulseWidth: number = 0.0;\r\n\t\tpublic pulseWidthDelta: number = 0.0;\r\n\t\tpublic filter: number = 0.0;\r\n\t\tpublic filterScale: number = 0.0;\r\n\t\tpublic filterSample0: number = 0.0;\r\n\t\tpublic filterSample1: number = 0.0;\r\n\t\tpublic vibratoScale: number = 0.0;\r\n\t\tpublic intervalMult: number = 0.0;\r\n\t\tpublic intervalVolumeMult: number = 1.0;\r\n\t\tpublic feedbackOutputs: number[] = [];\r\n\t\tpublic feedbackMult: number = 0.0;\r\n\t\tpublic feedbackDelta: number = 0.0;\r\n\t\t\r\n\t\tconstructor() {\r\n\t\t\tthis.reset();\r\n\t\t}\r\n\t\t\r\n\t\tpublic reset(): void {\r\n\t\t\tfor (let i: number = 0; i < Config.operatorCount; i++) {\r\n\t\t\t\tthis.phases[i] = 0.0;\r\n\t\t\t\tthis.feedbackOutputs[i] = 0.0;\r\n\t\t\t}\r\n\t\t\tthis.sample = 0.0;\r\n\t\t\tthis.filterSample0 = 0.0;\r\n\t\t\tthis.filterSample1 = 0.0;\r\n\t\t\tthis.liveInputSamplesHeld = 0.0;\r\n\t\t}\r\n\t}\r\n\r\n\texport class Synth {\r\n\t\t\r\n\t\tprivate static warmUpSynthesizer(song: Song | null): void {\r\n\t\t\t// Don't bother to generate the drum waves unless the song actually\r\n\t\t\t// uses them, since they may require a lot of computation.\r\n\t\t\tif (song != null) {\r\n\t\t\t\tfor (let i: number = 0; i < song.instrumentsPerChannel; i++) {\r\n\t\t\t\t\tfor (let j: number = song.pitchChannelCount; j < song.pitchChannelCount + song.drumChannelCount; j++) {\r\n\t\t\t\t\t\tConfig.getDrumWave(song.channels[j].instruments[i].wave);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tfor (let i: number = 0; i < song.barCount; i++) {\r\n\t\t\t\t\tSynth.getGeneratedSynthesizer(song, i);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tprivate static operatorAmplitudeCurve(amplitude: number): number {\r\n\t\t\treturn (Math.pow(16.0, amplitude / 15.0) - 1.0) / 15.0;\r\n\t\t}\r\n\t\t\r\n\t\tprivate static readonly negativePhaseGuard: number = 1000;\r\n\t\t\r\n\t\tpublic samplesPerSecond: number = 44100;\r\n\t\tprivate effectDuration: number = 0.14;\r\n\t\tprivate effectAngle: number = Math.PI * 2.0 / (this.effectDuration * this.samplesPerSecond);\r\n\t\tpublic effectYMult: number = 2.0 * Math.cos(this.effectAngle);\r\n\t\tpublic limitDecay: number = 1.0 / (2.0 * this.samplesPerSecond);\r\n\t\t\r\n\t\tpublic song: Song | null = null;\r\n\t\tpublic pianoPressed: boolean = false;\r\n\t\tpublic pianoPitch: number[] = [0];\r\n\t\tpublic pianoChannel: number = 0;\r\n\t\tpublic enableIntro: boolean = true;\r\n\t\tpublic enableOutro: boolean = false;\r\n\t\tpublic loopCount: number = -1;\r\n\t\tpublic volume: number = 1.0;\r\n\t\t\r\n\t\tpublic liveInputDuration: number = 0;\r\n\t\tpublic liveInputStarted: boolean = false;\r\n\t\tpublic liveInputPitches: number[] = [];\r\n\t\tpublic liveInputChannel: number = 0;\r\n\t\t\r\n\t\tprivate playheadInternal: number = 0.0;\r\n\t\tprivate bar: number = 0;\r\n\t\tprivate beat: number = 0;\r\n\t\tprivate part: number = 0;\r\n\t\tprivate arpeggio: number = 0;\r\n\t\tprivate arpSampleCountdown: number = 0;\r\n\t\tprivate isPlaying: boolean = false;\r\n\t\tprivate liveInputEndTime: number = 0.0;\r\n\t\tprivate browserAutomaticallyClearsAudioBuffer: boolean = true;\r\n\t\t\r\n\t\tprivate readonly channels: SynthChannel[] = [];\r\n\t\tpublic stillGoing: boolean = false;\r\n\t\tpublic effectPhase: number = 0.0;\r\n\t\tpublic limit: number = 0.0;\r\n\t\t\r\n\t\tprivate delayLineLeft: Float32Array = new Float32Array(16384);\r\n\t\tprivate delayLineRight: Float32Array = new Float32Array(16384);\r\n\t\tpublic delayPosLeft: number = 0;\r\n\t\tpublic delayPosRight: number = 0;\r\n\t\tpublic delayFeedback0Left: number = 0.0;\r\n\t\tpublic delayFeedback0Right: number = 0.0;\r\n\t\tpublic delayFeedback1Left: number = 0.0;\r\n\t\tpublic delayFeedback1Right: number = 0.0;\r\n\t\tpublic delayFeedback2Left: number = 0.0;\r\n\t\tpublic delayFeedback2Right: number = 0.0;\r\n\t\tpublic delayFeedback3Left: number = 0.0;\r\n\t\tpublic delayFeedback3Right: number = 0.0;\r\n\t\t\r\n\t\tprivate audioCtx: any | null = null;\r\n\t\tprivate scriptNode: any | null = null;\r\n\t\t\r\n\t\tpublic get playing(): boolean {\r\n\t\t\treturn this.isPlaying;\r\n\t\t}\r\n\t\t\r\n\t\tpublic get playhead(): number {\r\n\t\t\treturn this.playheadInternal;\r\n\t\t}\r\n\t\t\r\n\t\tpublic set playhead(value: number) {\r\n\t\t\tif (this.song != null) {\r\n\t\t\t\tthis.playheadInternal = Math.max(0, Math.min(this.song.barCount, value));\r\n\t\t\t\tlet remainder: number = this.playheadInternal;\r\n\t\t\t\tthis.bar = Math.floor(remainder);\r\n\t\t\t\tremainder = this.song.beatsPerBar * (remainder - this.bar);\r\n\t\t\t\tthis.beat = Math.floor(remainder);\r\n\t\t\t\tremainder = this.song.partsPerBeat * (remainder - this.beat);\r\n\t\t\t\tthis.part = Math.floor(remainder);\r\n\t\t\t\tremainder = 4 * (remainder - this.part);\r\n\t\t\t\tthis.arpeggio = Math.floor(remainder);\r\n\t\t\t\tconst samplesPerTick: number = this.getSamplesPerArpeggio();\r\n\t\t\t\tremainder = samplesPerTick * (remainder - this.arpeggio);\r\n\t\t\t\tthis.arpSampleCountdown = Math.floor(samplesPerTick - remainder);\r\n\t\t\t\tif (this.bar < this.song.loopStart) {\r\n\t\t\t\t\tthis.enableIntro = true;\r\n\t\t\t\t}\r\n\t\t\t\tif (this.bar > this.song.loopStart + this.song.loopLength) {\r\n\t\t\t\t\tthis.enableOutro = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tpublic get totalSamples(): number {\r\n\t\t\tif (this.song == null) return 0;\r\n\t\t\tconst samplesPerBar: number = this.getSamplesPerArpeggio() * 4 * this.song.partsPerBeat * this.song.beatsPerBar;\r\n\t\t\tlet loopMinCount: number = this.loopCount;\r\n\t\t\tif (loopMinCount < 0) loopMinCount = 1;\r\n\t\t\tlet bars: number = this.song.loopLength * loopMinCount;\r\n\t\t\tif (this.enableIntro) bars += this.song.loopStart;\r\n\t\t\tif (this.enableOutro) bars += this.song.barCount - (this.song.loopStart + this.song.loopLength);\r\n\t\t\treturn bars * samplesPerBar;\r\n\t\t}\r\n\t\t\r\n\t\tpublic get totalSeconds(): number {\r\n\t\t\t// @TODO: Revisit\r\n\t\t\treturn Math.round(this.totalSamples / this.samplesPerSecond);\r\n\t\t}\r\n\t\t\r\n\t\tpublic get totalBars(): number {\r\n\t\t\tif (this.song == null) return 0.0;\r\n\t\t\treturn this.song.barCount;\r\n\t\t}\r\n\t\t\r\n\t\tconstructor(song: any = null) {\r\n\t\t\tif (song != null) this.setSong(song);\r\n\t\t}\r\n\t\t\r\n\t\tpublic setSong(song: any): void {\r\n\t\t\tif (typeof(song) == \"string\") {\r\n\t\t\t\tthis.song = new Song(song);\r\n\t\t\t} else if (song instanceof Song) {\r\n\t\t\t\tthis.song = song;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tprivate spsCalc(): number {\r\n\t\t\tSynth.warmUpSynthesizer(this.song);\r\n\t\t\tif (this.song!.sampleRate == 0) return 44100;\r\n\t\t\telse if (this.song!.sampleRate == 1) return 48000;\r\n\t\t\telse if (this.song!.sampleRate == 2) return this.audioCtx.sampleRate;\r\n\t\t\telse if (this.song!.sampleRate == 3) return this.audioCtx.sampleRate * 4;\r\n\t\t\telse if (this.song!.sampleRate == 4) return this.audioCtx.sampleRate * 2;\r\n\t\t\telse if (this.song!.sampleRate == 5) return this.audioCtx.sampleRate / 2;\r\n\t\t\telse if (this.song!.sampleRate == 6) return this.audioCtx.sampleRate / 4;\r\n\t\t\telse if (this.song!.sampleRate == 7) return this.audioCtx.sampleRate / 8;\r\n\t\t\telse if (this.song!.sampleRate == 8) return this.audioCtx.sampleRate / 16;\r\n\t\t\telse return this.audioCtx.sampleRate;\r\n\t\t}\r\n\r\n\t\tprivate activateAudio(): void {\r\n\t\t\tif (this.audioCtx == null || this.scriptNode == null) {\r\n\t\t\t\tif (this.scriptNode != null) this.deactivateAudio();\r\n\t\t\t\tthis.audioCtx = this.audioCtx || new (window.AudioContext || window.webkitAudioContext);\r\n\t\t\t\tthis.samplesPerSecond = this.spsCalc();\r\n\t\t\t\tthis.scriptNode = this.audioCtx.createScriptProcessor ? this.audioCtx.createScriptProcessor(2048, 0, 2) : this.audioCtx.createJavaScriptNode(2048, 0, 2); \r\n\t\t\t\tthis.scriptNode.onaudioprocess = this.audioProcessCallback;\r\n\t\t\t\tthis.scriptNode.channelCountMode = 'explicit';\r\n\t\t\t\tthis.scriptNode.channelInterpretation = 'speakers';\r\n\r\n\t\t\t\tthis.effectAngle = Math.PI * 2.0 / (this.effectDuration * this.samplesPerSecond);\r\n\t\t\t\tthis.effectYMult = 2.0 * Math.cos(this.effectAngle);\r\n\t\t\t\tthis.limitDecay = 1.0 / (2.0 * this.samplesPerSecond);\r\n\t\t\t\t\r\n\t\t\t\tthis.scriptNode.connect(this.audioCtx.destination);\r\n\t\t\t}\r\n\t\t\tthis.audioCtx.resume();\r\n\t\t}\r\n\t\t\r\n\t\tprivate deactivateAudio(): void {\r\n\t\t\tif (this.audioCtx != null && this.scriptNode != null) {\r\n\t\t\t\tthis.scriptNode.disconnect(this.audioCtx.destination);\r\n\t\t\t\tthis.scriptNode = null;\r\n\t\t\t\tif (this.audioCtx.close) this.audioCtx.close(); // firefox is missing this function?\r\n\t\t\t\tthis.audioCtx = null;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t\tpublic maintainLiveInput(): void {\r\n\t\t\t\tthis.activateAudio();\r\n\t\t\t\tthis.liveInputEndTime = performance.now() + 10000.0;\r\n\t\t\t}\r\n\r\n\t\tpublic play(): void {\r\n\t\t\tif (this.isPlaying) return;\r\n\t\t\tthis.isPlaying = true;\r\n\t\t\t\r\n\t\t\tSynth.warmUpSynthesizer(this.song);\r\n\t\t\tthis.activateAudio();\r\n\t\t}\r\n\t\t\r\n\t\tpublic pause(): void {\r\n\t\t\tif (!this.isPlaying) return;\r\n\t\t\tthis.isPlaying = false;\r\n\t\t\tthis.deactivateAudio();\r\n\t\t\tthis.scriptNode = null;\r\n\t\t}\r\n\t\t\r\n\t\t/*private determineLiveInputTones(song: Song): void {\r\n\t\t\tconst toneList: Deque<Tone> = this.liveInputTones;\r\n\t\t\tconst pitches: number[] = this.liveInputPitches;\r\n\t\t\tlet toneCount: number = 0;\r\n\t\t\tif (this.liveInputDuration > 0) {\r\n\t\t\t\tconst instrument: Instrument = song.channels[this.liveInputChannel].instruments[song.getPatternInstrument(this.liveInputChannel, this.bar)];\r\n\t\t\t\t\r\n\t\t\t\tif (instrument.getChord().arpeggiates) {\r\n\t\t\t\t\tlet tone: Tone;\r\n\t\t\t\t\tif (toneList.count() == 0) {\r\n\t\t\t\t\t\ttone = this.newTone();\r\n\t\t\t\t\t\ttoneList.pushBack(tone);\r\n\t\t\t\t\t} else if (!instrument.getTransition().isSeamless && this.liveInputStarted) {\r\n\t\t\t\t\t\tthis.releaseTone(this.liveInputChannel, toneList.popFront());\r\n\t\t\t\t\t\ttone = this.newTone();\r\n\t\t\t\t\t\ttoneList.pushBack(tone);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\ttone = toneList.get(0);\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttoneCount = 1;\r\n\t\t\t\t\r\n\t\t\t\t\tfor (let i: number = 0; i < pitches.length; i++) {\r\n\t\t\t\t\t\ttone.pitches[i] = pitches[i];\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttone.pitchCount = pitches.length;\r\n\t\t\t\t\ttone.chordSize = 1;\r\n\t\t\t\t\ttone.instrument = instrument;\r\n\t\t\t\t\ttone.note = tone.prevNote = tone.nextNote = null;\r\n\t\t\t\t} else {\r\n\t\t\t\t\t//const transition: Transition = instrument.getTransition();\r\n\t\t\t\t\tfor (let i: number = 0; i < pitches.length; i++) {\r\n\t\t\t\t\t\t//const strumOffsetParts: number = i * instrument.getChord().strumParts;\r\n\r\n\t\t\t\t\t\tlet tone: Tone;\r\n\t\t\t\t\t\tif (toneList.count() <= i) {\r\n\t\t\t\t\t\t\ttone = this.newTone();\r\n\t\t\t\t\t\t\ttoneList.pushBack(tone);\r\n\t\t\t\t\t\t} else if (!instrument.getTransition().isSeamless && this.liveInputStarted) {\r\n\t\t\t\t\t\t\tthis.releaseTone(this.liveInputChannel, toneList.get(i));\r\n\t\t\t\t\t\t\ttone = this.newTone();\r\n\t\t\t\t\t\t\ttoneList.set(i, tone);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\ttone = toneList.get(i);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\ttoneCount++;\r\n\r\n\t\t\t\t\t\ttone.pitches[0] = pitches[i];\r\n\t\t\t\t\t\ttone.pitchCount = 1;\r\n\t\t\t\t\t\ttone.chordSize = pitches.length;\r\n\t\t\t\t\t\ttone.instrument = instrument;\r\n\t\t\t\t\t\ttone.note = tone.prevNote = tone.nextNote = null;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\twhile (toneList.count() > toneCount) {\r\n\t\t\t\tthis.releaseTone(this.liveInputChannel, toneList.popBack());\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.liveInputStarted = false;\r\n\t\t}*/\r\n\r\n\t\tpublic snapToStart(): void {\r\n\t\t\tthis.bar = 0;\r\n\t\t\tthis.enableIntro = true;\r\n\t\t\tthis.snapToBar();\r\n\t\t}\r\n\t\t\r\n\t\tpublic snapToBar(bar?: number): void {\r\n\t\t\tif (bar !== undefined) this.bar = bar;\r\n\t\t\tthis.playheadInternal = this.bar;\r\n\t\t\tthis.beat = 0;\r\n\t\t\tthis.part = 0;\r\n\t\t\tthis.arpeggio = 0;\r\n\t\t\tthis.arpSampleCountdown = 0;\r\n\t\t\tthis.effectPhase = 0.0;\r\n\t\t\t\r\n\t\t\tfor (const channel of this.channels) channel.reset();\r\n\t\t\t\r\n\t\t\tthis.delayPosLeft = 0;\r\n\t\t\tthis.delayPosRight = 0;\r\n\t\t\tthis.delayFeedback0Left = 0.0;\r\n\t\t\tthis.delayFeedback0Right = 0.0;\r\n\t\t\tthis.delayFeedback1Left = 0.0;\r\n\t\t\tthis.delayFeedback1Right = 0.0;\r\n\t\t\tthis.delayFeedback2Left = 0.0;\r\n\t\t\tthis.delayFeedback2Right = 0.0;\r\n\t\t\tthis.delayFeedback3Left = 0.0;\r\n\t\t\tthis.delayFeedback3Right = 0.0;\r\n\t\t\tfor (let i: number = 0; i < this.delayLineLeft.length; i++) this.delayLineLeft[i] = 0.0;\r\n\t\t\tfor (let i: number = 0; i < this.delayLineRight.length; i++) this.delayLineRight[i] = 0.0;\r\n\t\t}\r\n\t\t\r\n\t\tpublic nextBar(): void {\r\n\t\t\tif (!this.song) return;\r\n\t\t\tconst oldBar: number = this.bar;\r\n\t\t\tthis.bar++;\r\n\t\t\tif (this.enableOutro) {\r\n\t\t\t\tif (this.bar >= this.song.barCount) {\r\n\t\t\t\t\tthis.bar = this.enableIntro ? 0 : this.song.loopStart;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (this.bar >= this.song.loopStart + this.song.loopLength || this.bar >= this.song.barCount) {\r\n\t\t\t\t\tthis.bar = this.song.loopStart;\r\n\t\t\t\t}\r\n \t\t\t}\r\n\t\t\tthis.playheadInternal += this.bar - oldBar;\r\n\t\t}\r\n\t\t\r\n\t\tpublic prevBar(): void {\r\n\t\t\tif (!this.song) return;\r\n\t\t\tconst oldBar: number = this.bar;\r\n\t\t\tthis.bar--;\r\n\t\t\tif (this.bar < 0) {\r\n\t\t\t\tthis.bar = this.song.loopStart + this.song.loopLength - 1;\r\n\t\t\t}\r\n\t\t\tif (this.bar >= this.song.barCount) {\r\n\t\t\t\tthis.bar = this.song.barCount - 1;\r\n\t\t\t}\r\n\t\t\tif (this.bar < this.song.loopStart) {\r\n\t\t\t\tthis.enableIntro = true;\r\n\t\t\t}\r\n\t\t\tif (!this.enableOutro && this.bar >= this.song.loopStart + this.song.loopLength) {\r\n\t\t\t\tthis.bar = this.song.loopStart + this.song.loopLength - 1;\r\n\t\t\t}\r\n\t\t\tthis.playheadInternal += this.bar - oldBar;\r\n\t\t}\r\n\t\t\r\n\t\tprivate audioProcessCallback = (audioProcessingEvent: any): void => {\r\n\t\t\tconst outputBuffer = audioProcessingEvent.outputBuffer;\r\n\t\t\tconst outputDataL: Float32Array = outputBuffer.getChannelData(0);\r\n\t\t\tconst outputDataR: Float32Array = outputBuffer.getChannelData(1);\r\n\r\n\t\t\tif (this.browserAutomaticallyClearsAudioBuffer && (outputDataL[0] != 0.0 || outputDataR[0] != 0.0 || outputDataL[outputBuffer.length-1] != 0.0 || outputDataR[outputBuffer.length-1] != 0.0)) {\r\n\t\t\t// If the buffer is ever initially nonzero, then this must be an older browser that doesn't automatically clear the audio buffer.\r\n\t\t\tthis.browserAutomaticallyClearsAudioBuffer = false;\r\n\t\t\t}\r\n\t\t\tif (!this.browserAutomaticallyClearsAudioBuffer) {\r\n\t\t\t\t// If this browser does not clear the buffer automatically, do so manually before continuing.\r\n\t\t\t\tconst length: number = outputBuffer.length;\r\n\t\t\t\tfor (let i: number = 0; i < length; i++) {\r\n\t\t\t\t\toutputDataL[i] = 0.0;\r\n\t\t\t\t\toutputDataR[i] = 0.0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (!this.isPlaying && performance.now() >= this.liveInputEndTime) { \r\n\t\t\t\tthis.deactivateAudio();\r\n\t\t\t} else {\r\n\t\t\t\tthis.synthesize(outputDataL, outputDataR, outputBuffer.length, this.isPlaying);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tpublic synthesize(dataLeft: Float32Array, dataRight: Float32Array, bufferLength: number, playSong: boolean = true): void {\r\n\t\t\tif (this.song == null) {\r\n\t\t\t\tfor (let i: number = 0; i < bufferLength; i++) {\r\n\t\t\t\t\tdataLeft[i] = 0.0;\r\n\t\t\t\t\tdataRight[i] = 0.0;\r\n\t\t\t\t}\r\n\t\t\t\tthis.deactivateAudio();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tconst channelCount: number = this.song.getChannelCount();\r\n\t\t\tfor (let i: number = this.channels.length; i < channelCount; i++) {\r\n\t\t\t\tthis.channels[i] = new SynthChannel();\r\n\t\t\t}\r\n\t\t\tthis.channels.length = channelCount;\r\n\t\t\t\r\n\t\t\tconst samplesPerTick: number = this.getSamplesPerArpeggio();\r\n\t\t\tlet bufferIndex: number = 0;\r\n\t\t\tlet ended: boolean = false;\r\n\t\t\t\r\n\t\t\t// Check the bounds of the playhead:\r\n\t\t\tif (this.arpSampleCountdown == 0 || this.arpSampleCountdown > samplesPerTick) {\r\n\t\t\t\tthis.arpSampleCountdown = samplesPerTick;\r\n\t\t\t}\r\n\t\t\tif (playSong) {\r\n\t\t\t\tif (this.part >= this.song.partsPerBeat) {\r\n\t\t\t\t\tthis.beat++;\r\n\t\t\t\t\tthis.part = 0;\r\n\t\t\t\t\tthis.arpeggio = 0;\r\n\t\t\t\t\tthis.arpSampleCountdown = samplesPerTick;\r\n\t\t\t\t}\r\n\t\t\t\tif (this.beat >= this.song.beatsPerBar) {\r\n\t\t\t\t\tthis.bar++;\r\n\t\t\t\t\tthis.beat = 0;\r\n\t\t\t\t\tthis.part = 0;\r\n\t\t\t\t\tthis.arpeggio = 0;\r\n\t\t\t\t\tthis.arpSampleCountdown = samplesPerTick;\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (this.loopCount == -1) {\r\n\t\t\t\t\t\tif (this.bar < this.song.loopStart && !this.enableIntro) this.bar = this.song.loopStart;\r\n\t\t\t\t\t\tif (this.bar >= this.song.loopStart + this.song.loopLength && !this.enableOutro) this.bar = this.song.loopStart;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (this.bar >= this.song.barCount) {\r\n\t\t\t\t\tif (this.enableOutro) {\r\n\t\t\t\t\t\tthis.bar = 0;\r\n\t\t\t\t\t\tthis.enableIntro = true;\r\n\t\t\t\t\t\tended = true;\r\n\t\t\t\t\t\tthis.pause();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.bar = this.song.loopStart;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (this.bar >= this.song.loopStart) {\r\n\t\t\t\t\tthis.enableIntro = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n \t\t\twhile (true) {\r\n\t\t\t\tif (ended) {\r\n\t\t\t\t\twhile (bufferIndex < bufferLength) {\r\n\t\t\t\t\t\tdataLeft[bufferIndex] = 0.0;\r\n\t\t\t\t\t\tdataRight[bufferIndex] = 0.0;\r\n\t\t\t\t\t\tbufferIndex++;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tconst generatedSynthesizer: Function = Synth.getGeneratedSynthesizer(this.song, this.bar);\r\n\t\t\t\tbufferIndex = generatedSynthesizer(this, this.song, dataLeft, dataRight, bufferLength, bufferIndex, samplesPerTick);\r\n\t\t\t\t\r\n\t\t\t\tconst finishedBuffer: boolean = (bufferIndex == -1);\r\n\t\t\t\tif (finishedBuffer) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// bar changed, reset for next bar:\r\n\t\t\t\t\tthis.beat = 0;\r\n\t\t\t\t\tthis.effectPhase = 0.0;\r\n\t\t\t\t\tthis.bar++;\r\n\t\t\t\t\tif (this.bar < this.song.loopStart) {\r\n\t\t\t\t\t\tif (!this.enableIntro) this.bar = this.song.loopStart;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.enableIntro = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (this.bar >= this.song.loopStart + this.song.loopLength) {\r\n\t\t\t\t\t\tif (this.loopCount > 0) this.loopCount--;\r\n\t\t\t\t\t\tif (this.loopCount > 0 || !this.enableOutro) {\r\n\t\t\t\t\t\t\tthis.bar = this.song.loopStart;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (this.bar >= this.song.barCount) {\r\n\t\t\t\t\t\tthis.bar = 0;\r\n\t\t\t\t\t\tthis.enableIntro = true;\r\n\t\t\t\t\t\tended = true;\r\n\t\t\t\t\t\tthis.pause();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.playheadInternal = (((this.arpeggio + 1.0 - this.arpSampleCountdown / samplesPerTick) / 4.0 + this.part) / this.song.partsPerBeat + this.beat) / this.song.beatsPerBar + this.bar;\r\n\t\t}\r\n\r\n\t\tprivate static computeOperatorEnvelope(envelope: number, time: number, beats: number, customVolume: number): number {\r\n\t\t\tswitch(Config.operatorEnvelopeType[envelope]) {\r\n\t\t\t\tcase EnvelopeType.custom: return customVolume;\r\n\t\t\t\tcase EnvelopeType.steady: return 1.0;\r\n\t\t\t\tcase EnvelopeType.pluck:\r\n\t\t\t\t\tlet curve: number = 1.0 / (1.0 + time * Config.operatorEnvelopeSpeed[envelope]);\r\n\t\t\t\t\tif (Config.operatorEnvelopeInverted[envelope]) {\r\n\t\t\t\t\t\treturn 1.0 - curve;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn curve;\r\n\t\t\t\t\t}\r\n\t\t\t\tcase EnvelopeType.tremolo: \r\n\t\t\t\t\tif (Config.operatorSpecialCustomVolume[envelope]) {\r\n\t\t\t\t\t\treturn 0.5 - Math.cos(beats * 2.0 * Math.PI * (customVolume * 4)) * 0.5;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn 0.5 - Math.cos(beats * 2.0 * Math.PI * Config.operatorEnvelopeSpeed[envelope]) * 0.5;\r\n\t\t\t\t\t}\r\n\t\t\t\tcase EnvelopeType.punch: \r\n\t\t\t\t\treturn Math.max(1.0, 2.0 - time * 10.0);\r\n\t\t\t\tcase EnvelopeType.flare:\r\n\t\t\t\t\tif (Config.operatorSpecialCustomVolume[envelope]) {\r\n\t\t\t\t\t\tconst attack: number = 0.25 / Math.sqrt(customVolume);\r\n\t\t\t\t\t\treturn time < attack ? time / attack : 1.0 / (1.0 + (time - attack) * (customVolume * 16));\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconst speed: number = Config.operatorEnvelopeSpeed[envelope];\r\n\t\t\t\t\t\tconst attack: number = 0.25 / Math.sqrt(speed);\r\n\t\t\t\t\t\treturn time < attack ? time / attack : 1.0 / (1.0 + (time - attack) * speed);\r\n\t\t\t\t\t}\r\n\t\t\t\tcase EnvelopeType.flute:\r\n\t\t\t\t\treturn Math.max(-1.0 - time, -2.0 + time);\r\n\t\t\t\tdefault: throw new Error(\"Unrecognized operator envelope type.\");\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tpublic static computeChannelInstrument(synth: Synth, song: Song, channel: number, time: number, sampleTime: number, samplesPerTick: number, samples: number): void {\r\n\t\t\tconst isDrum: boolean = song.getChannelIsDrum(channel);\r\n\t\t\tconst synthChannel: SynthChannel = synth.channels[channel];\r\n\t\t\tconst pattern: Pattern | null = song.getPattern(channel, synth.bar);\r\n\t\t\tconst instrument: Instrument = song.channels[channel].instruments[pattern == null ? 0 : pattern.instrument];\r\n\t\t\tconst pianoMode = (synth.pianoPressed && channel == synth.pianoChannel);\r\n\t\t\tconst basePitch: number = isDrum ? Config.drumBasePitches[instrument.wave] : Config.keys[song.key].basePitch;\r\n\t\t\tconst intervalScale: number = isDrum ? Config.drumInterval : 1;\r\n\t\t\tconst pitchDamping: number = isDrum ? (Config.drumWaveIsSoft[instrument.wave] ? 24.0 : 60.0) : 48.0;\r\n\t\t\tconst secondsPerPart: number = 4.0 * samplesPerTick / synth.samplesPerSecond;\r\n\t\t\tconst beatsPerPart: number = 1.0 / song.partsPerBeat;\r\n\t\t\t\r\n\t\t\tsynthChannel.phaseDeltaScale = 0.0;\r\n\t\t\tsynthChannel.filter = 1.0;\r\n\t\t\tsynthChannel.filterScale = 1.0;\r\n\t\t\tsynthChannel.vibratoScale = 0.0;\r\n\t\t\tsynthChannel.harmonyMult = 1.0;\r\n\t\t\tsynthChannel.harmonyVolumeMult = 1.0;\r\n\t\t\t\r\n\t\t\tlet partsSinceStart: number = 0.0;\r\n\t\t\tlet arpeggio: number = synth.arpeggio;\r\n\t\t\tlet arpSampleCountdown: number = synth.arpSampleCountdown;\r\n\t\t\t\r\n\t\t\tlet pitches: number[] | null = null;\r\n\t\t\tlet resetPhases: boolean = true;\r\n\t\t\t\r\n\t\t\tlet intervalStart: number = 0.0;\r\n\t\t\tlet intervalEnd: number = 0.0;\r\n\t\t\tlet transitionVolumeStart: number = 1.0;\r\n\t\t\tlet transitionVolumeEnd: number = 1.0;\r\n\t\t\tlet envelopeVolumeStart: number = 0.0;\r\n\t\t\tlet envelopeVolumeEnd: number = 0.0;\r\n\t\t\t// TODO: probably part time can be calculated independently of any notes?\r\n\t\t\tlet partTimeStart: number = 0.0;\r\n\t\t\tlet partTimeEnd:   number = 0.0;\r\n\t\t\tlet decayTimeStart: number = 0.0;\r\n\t\t\tlet decayTimeEnd:   number = 0.0;\r\n\t\t\t\r\n\t\t\tfor (let i: number = 0; i < Config.operatorCount; i++) {\r\n\t\t\t\tsynthChannel.phaseDeltas[i] = 0.0;\r\n\t\t\t\tsynthChannel.volumeStarts[i] = 0.0;\r\n\t\t\t\tsynthChannel.volumeDeltas[i] = 0.0;\r\n\t\t\t\tsynthChannel.volumeLeft[0] = 0.0;\r\n\t\t\t\tsynthChannel.volumeRight[0] = 0.0;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (pianoMode) {\r\n\t\t\t\tpitches = synth.pianoPitch;\r\n\t\t\t\ttransitionVolumeStart = transitionVolumeEnd = 1;\r\n\t\t\t\tenvelopeVolumeStart = envelopeVolumeEnd = 1;\r\n\t\t\t\tresetPhases = false;\r\n\t\t\t\t// TODO: track time since live piano note started for transition, envelope, decays, delayed vibrato, etc.\r\n\t\t\t} else if (pattern != null) {\r\n\t\t\t\tlet note: Note | null = null;\r\n\t\t\t\tlet prevNote: Note | null = null;\r\n\t\t\t\tlet nextNote: Note | null = null;\r\n\t\t\t\tfor (let i: number = 0; i < pattern.notes.length; i++) {\r\n\t\t\t\t\tif (pattern.notes[i].end <= time) {\r\n\t\t\t\t\t\tprevNote = pattern.notes[i];\r\n\t\t\t\t\t} else if (pattern.notes[i].start <= time && pattern.notes[i].end > time) {\r\n\t\t\t\t\t\tnote = pattern.notes[i];\r\n\t\t\t\t\t} else if (pattern.notes[i].start > time) {\r\n\t\t\t\t\t\tnextNote = pattern.notes[i];\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (note != null && prevNote != null && prevNote.end != note.start) prevNote = null;\r\n\t\t\t\tif (note != null && nextNote != null && nextNote.start != note.end) nextNote = null;\r\n\t\t\t\t\r\n\t\t\t\tif (note != null) {\r\n\t\t\t\t\tpitches = note.pitches;\r\n\t\t\t\t\tpartsSinceStart = time - note.start;\r\n\t\t\t\t\t\r\n\t\t\t\t\tlet endPinIndex: number;\r\n\t\t\t\t\tfor (endPinIndex = 1; endPinIndex < note.pins.length - 1; endPinIndex++) {\r\n\t\t\t\t\t\tif (note.pins[endPinIndex].time + note.start > time) break;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconst startPin: NotePin = note.pins[endPinIndex-1];\r\n\t\t\t\t\tconst endPin: NotePin = note.pins[endPinIndex];\r\n\t\t\t\t\tconst noteStart: number = note.start * 4;\r\n\t\t\t\t\tconst noteEnd:   number = note.end   * 4;\r\n\t\t\t\t\tconst pinStart: number  = (note.start + startPin.time) * 4;\r\n\t\t\t\t\tconst pinEnd:   number  = (note.start +   endPin.time) * 4;\r\n\t\t\t\t\t\r\n\t\t\t\t\tconst tickTimeStart: number = time * 4 + arpeggio;\r\n\t\t\t\t\tconst tickTimeEnd:   number = time * 4 + arpeggio + 1;\r\n\t\t\t\t\tconst pinRatioStart: number = (tickTimeStart - pinStart) / (pinEnd - pinStart);\r\n\t\t\t\t\tconst pinRatioEnd:   number = (tickTimeEnd   - pinStart) / (pinEnd - pinStart);\r\n\t\t\t\t\tlet envelopeVolumeTickStart: number = startPin.volume + (endPin.volume - startPin.volume) * pinRatioStart;\r\n\t\t\t\t\tlet envelopeVolumeTickEnd:   number = startPin.volume + (endPin.volume - startPin.volume) * pinRatioEnd;\r\n\t\t\t\t\tlet transitionVolumeTickStart: number = 1.0;\r\n\t\t\t\t\tlet transitionVolumeTickEnd:   number = 1.0;\r\n\t\t\t\t\tlet intervalTickStart: number = startPin.interval + (endPin.interval - startPin.interval) * pinRatioStart;\r\n\t\t\t\t\tlet intervalTickEnd:   number = startPin.interval + (endPin.interval - startPin.interval) * pinRatioEnd;\r\n\t\t\t\t\tlet partTimeTickStart: number = startPin.time + (endPin.time - startPin.time) * pinRatioStart;\r\n\t\t\t\t\tlet partTimeTickEnd:   number = startPin.time + (endPin.time - startPin.time) * pinRatioEnd;\r\n\t\t\t\t\tlet decayTimeTickStart: number = partTimeTickStart;\r\n\t\t\t\t\tlet decayTimeTickEnd:   number = partTimeTickEnd;\r\n\t\t\t\t\t\r\n\t\t\t\t\tconst startRatio: number = 1.0 - (arpSampleCountdown + samples) / samplesPerTick;\r\n\t\t\t\t\tconst endRatio:   number = 1.0 - (arpSampleCountdown)           / samplesPerTick;\r\n\t\t\t\t\tresetPhases = (tickTimeStart + startRatio - noteStart == 0.0);\r\n\t\t\t\t\t\r\n\t\t\t\t\tconst transition: number = instrument.transition;\r\n\t\t\t\t\tif (tickTimeStart == noteStart) {\r\n\t\t\t\t\t\tif (transition == 0) {\r\n\t\t\t\t\t\t\t// seamless start\r\n\t\t\t\t\t\t\tresetPhases = false;\r\n\t\t\t\t\t\t} else if (transition == 2) {\r\n\t\t\t\t\t\t\t// smooth start\r\n\t\t\t\t\t\t\ttransitionVolumeTickStart = 0.0;\r\n\t\t\t\t\t\t} else if (transition == 3) {\r\n\t\t\t\t\t\t\t// slide start\r\n\t\t\t\t\t\t\tif (prevNote == null) {\r\n\t\t\t\t\t\t\t\ttransitionVolumeTickStart = 0.0;\r\n\t\t\t\t\t\t\t} else if (prevNote.pins[prevNote.pins.length-1].volume == 0 || note.pins[0].volume == 0) {\r\n\t\t\t\t\t\t\t\ttransitionVolumeTickStart = 0.0;\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tintervalTickStart = (prevNote.pitches[0] + prevNote.pins[prevNote.pins.length-1].interval - note.pitches[0]) * 0.5;\r\n\t\t\t\t\t\t\t\tdecayTimeTickStart = prevNote.pins[prevNote.pins.length-1].time * 0.5;\r\n\t\t\t\t\t\t\t\tresetPhases = false;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else if (transition == 4) {\r\n\t\t\t\t\t\t\t// trill start\r\n\t\t\t\t\t\t\ttransitionVolumeTickEnd = 0.0;\r\n\t\t\t\t\t\t} else if (transition == 5) {\r\n\t\t\t\t\t\t\t// click start\r\n\t\t\t\t\t\t\tintervalTickStart = 100.0;\r\n\t\t\t\t\t\t} else if (transition == 6) {\r\n\t\t\t\t\t\t\t// bow start\r\n\t\t\t\t\t\t\tintervalTickStart = -1.0;\r\n\t\t\t\t\t\t} else if (transition == 7) {\r\n\t\t\t\t\t\t\t// blip start\r\n\t\t\t\t\t\t\ttransitionVolumeTickStart = 6.0;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (tickTimeEnd == noteEnd) {\r\n\t\t\t\t\t\tif (transition == 0) {\r\n\t\t\t\t\t\t\t// seamless ending: fade out, unless adjacent to another note or at end of bar.\r\n\t\t\t\t\t\t\tif (nextNote == null && note.start + endPin.time != song.partsPerBeat * song.beatsPerBar) {\r\n\t\t\t\t\t\t\t\ttransitionVolumeTickEnd = 0.0;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else if (transition == 1 || transition == 2) {\r\n\t\t\t\t\t\t\t// sudden/smooth ending\r\n\t\t\t\t\t\t\ttransitionVolumeTickEnd = 0.0;\r\n\t\t\t\t\t\t} else if (transition == 3) {\r\n\t\t\t\t\t\t\t// slide ending\r\n\t\t\t\t\t\t\tif (nextNote == null) {\r\n\t\t\t\t\t\t\t\ttransitionVolumeTickEnd = 0.0;\r\n\t\t\t\t\t\t\t} else if (note.pins[note.pins.length-1].volume == 0 || nextNote.pins[0].volume == 0) {\r\n\t\t\t\t\t\t\t\ttransitionVolumeTickEnd = 0.0;\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tintervalTickEnd = (nextNote.pitches[0] - note.pitches[0] + note.pins[note.pins.length-1].interval) * 0.5;\r\n\t\t\t\t\t\t\t\tdecayTimeTickEnd *= 0.5;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tintervalStart = intervalTickStart + (intervalTickEnd - intervalTickStart) * startRatio;\r\n\t\t\t\t\tintervalEnd   = intervalTickStart + (intervalTickEnd - intervalTickStart) * endRatio;\r\n\t\t\t\t\tenvelopeVolumeStart = synth.volumeConversion(envelopeVolumeTickStart + (envelopeVolumeTickEnd - envelopeVolumeTickStart) * startRatio);\r\n\t\t\t\t\tenvelopeVolumeEnd   = synth.volumeConversion(envelopeVolumeTickStart + (envelopeVolumeTickEnd - envelopeVolumeTickStart) * endRatio);\r\n\t\t\t\t\ttransitionVolumeStart = transitionVolumeTickStart + (transitionVolumeTickEnd - transitionVolumeTickStart) * startRatio;\r\n\t\t\t\t\ttransitionVolumeEnd   = transitionVolumeTickStart + (transitionVolumeTickEnd - transitionVolumeTickStart) * endRatio;\r\n\t\t\t\t\tpartTimeStart = note.start + partTimeTickStart + (partTimeTickEnd - partTimeTickStart) * startRatio;\r\n\t\t\t\t\tpartTimeEnd   = note.start + partTimeTickStart + (partTimeTickEnd - partTimeTickStart) * endRatio;\r\n\t\t\t\t\tdecayTimeStart = decayTimeTickStart + (decayTimeTickEnd - decayTimeTickStart) * startRatio;\r\n\t\t\t\t\tdecayTimeEnd   = decayTimeTickStart + (decayTimeTickEnd - decayTimeTickStart) * endRatio;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (pitches != null) {\r\n\t\t\t\tif (!isDrum && instrument.type == InstrumentType.fm) {\r\n\t\t\t\t\t// phase modulation!\r\n\t\t\t\t\t\r\n\t\t\t\t\tlet sineVolumeBoost: number = 1.0;\r\n\t\t\t\t\tlet totalCarrierVolume: number = 0.0;\r\n\t\t\t\t\t\r\n\t\t\t\t\tconst carrierCount: number = Config.operatorCarrierCounts[instrument.algorithm];\r\n\t\t\t\t\tfor (let i: number = 0; i < Config.operatorCount; i++) {\r\n\t\t\t\t\t\tconst isCarrier: boolean = i < Config.operatorCarrierCounts[instrument.algorithm];\r\n\t\t\t\t\t\tconst associatedCarrierIndex: number = Config.operatorAssociatedCarrier[instrument.algorithm][i] - 1;\r\n\t\t\t\t\t\tconst pitch: number = pitches[(i < pitches.length) ? i : ((associatedCarrierIndex < pitches.length) ? associatedCarrierIndex : 0)] + Config.octoffValues[instrument.octoff] + (song.detune / 24);\r\n\t\t\t\t\t\tconst freqMult = Config.operatorFrequencies[instrument.operators[i].frequency];\r\n\t\t\t\t\t\tconst chorusInterval = Config.operatorCarrierChorus[Config.fmChorusNames[instrument.fmChorus]][associatedCarrierIndex];\r\n\t\t\t\t\t\tconst startPitch: number = (pitch + intervalStart) * intervalScale + chorusInterval;\r\n\t\t\t\t\t\tconst startFreq: number = freqMult * (synth.frequencyFromPitch(basePitch + startPitch)) + Config.operatorHzOffsets[instrument.operators[i].frequency];\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tsynthChannel.phaseDeltas[i] = startFreq * sampleTime * Config.sineWaveLength;\r\n\t\t\t\t\t\tif (resetPhases) synthChannel.reset();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tconst amplitudeCurve: number = Synth.operatorAmplitudeCurve(instrument.operators[i].amplitude);\r\n\t\t\t\t\t\t// const amplitudeMult: number = amplitudeCurve * Config.operatorAmplitudeSigns[instrument.operators[i].frequency];\r\n\t\t\t\t\t\t// @TODO: Revisit\r\n\t\t\t\t\t\tlet amplitudeMult: number = 0;\r\n\t\t\t\t\t\tif ((Config.volumeValues[instrument.volume] != -1.0 && song.mix == 2) || (Config.volumeMValues[instrument.volume] != -1.0 && song.mix != 2)) {\r\n\t\t\t\t\t\t\tif (song.mix == 2) {\r\n\t\t\t\t\t\t\t\tamplitudeMult = isCarrier ? (amplitudeCurve * Config.operatorAmplitudeSigns[instrument.operators[i].frequency]) * (1 - Config.volumeValues[instrument.volume] / 2.3) : (amplitudeCurve * Config.operatorAmplitudeSigns[instrument.operators[i].frequency]);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tamplitudeMult = (amplitudeCurve * Config.operatorAmplitudeSigns[instrument.operators[i].frequency]) * (1 - Config.volumeMValues[instrument.volume] / 2.3);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else if (Config.volumeValues[instrument.volume] != -1.0) {\r\n\t\t\t\t\t\t\tamplitudeMult = 0;\r\n\t\t\t\t\t\t} else if (Config.volumeMValues[instrument.volume] != -1.0) {\r\n\t\t\t\t\t\t\tamplitudeMult = 0;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tlet volumeStart: number = amplitudeMult * Config.imuteValues[instrument.imute];\r\n\t\t\t\t\t\tlet volumeEnd: number = amplitudeMult * Config.imuteValues[instrument.imute];\r\n\t\t\t\t\t\tsynthChannel.volumeLeft[0] = Math.min(1, 1 + Config.ipanValues[instrument.ipan]);\r\n\t\t\t\t\t\tsynthChannel.volumeRight[0] = Math.min(1, 1 - Config.ipanValues[instrument.ipan]);\r\n\t\t\t\t\t\tif (i < carrierCount) {\r\n\t\t\t\t\t\t\t// carrier\r\n\t\t\t\t\t\t\tconst volumeMult: number = 0.03;\r\n\t\t\t\t\t\t\t// The commented out portion in the line below fixes\r\n\t\t\t\t\t\t\t// the crackling heard when using FM chorus. It seems\r\n\t\t\t\t\t\t\t// that it was accidentally omitted in BeepBox 2.3.\r\n\t\t\t\t\t\t\tconst endPitch: number = (pitch + intervalEnd) * intervalScale/* + chorusInterval */;\r\n\t\t\t\t\t\t\tlet pitchVolumeStart: number = 0;\r\n\t\t\t\t\t\t\tlet pitchVolumeEnd: number = 0;\r\n\t\t\t\t\t\t\tif (song.mix == 3) {\r\n\t\t\t\t\t\t\t\tpitchVolumeStart = Math.pow(5.0, -startPitch / pitchDamping);\r\n\t\t\t\t\t\t\t\tpitchVolumeEnd   = Math.pow(5.0,   -endPitch / pitchDamping);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tpitchVolumeStart = Math.pow(2.0, -startPitch / pitchDamping);\r\n\t\t\t\t\t\t\t\tpitchVolumeEnd   = Math.pow(2.0,   -endPitch / pitchDamping);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tvolumeStart *= pitchVolumeStart * volumeMult * transitionVolumeStart;\r\n\t\t\t\t\t\t\tvolumeEnd *= pitchVolumeEnd * volumeMult * transitionVolumeEnd;\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\ttotalCarrierVolume += amplitudeCurve;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// modulator\r\n\t\t\t\t\t\t\tvolumeStart *= Config.sineWaveLength * 1.5;\r\n\t\t\t\t\t\t\tvolumeEnd *= Config.sineWaveLength * 1.5;\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tsineVolumeBoost *= 1.0 - Math.min(1.0, instrument.operators[i].amplitude / 15);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tconst envelope: number = instrument.operators[i].envelope;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tvolumeStart *= Synth.computeOperatorEnvelope(envelope, secondsPerPart * decayTimeStart, beatsPerPart * partTimeStart, envelopeVolumeStart);\r\n\t\t\t\t\t\tvolumeEnd *= Synth.computeOperatorEnvelope(envelope, secondsPerPart * decayTimeEnd, beatsPerPart * partTimeEnd, envelopeVolumeEnd);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tsynthChannel.volumeStarts[i] = volumeStart;\r\n\t\t\t\t\t\tsynthChannel.volumeDeltas[i] = (volumeEnd - volumeStart) / samples;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tconst feedbackAmplitude: number = Config.sineWaveLength * 0.3 * instrument.feedbackAmplitude / 15.0;\r\n\t\t\t\t\tlet feedbackStart: number = feedbackAmplitude * Synth.computeOperatorEnvelope(instrument.feedbackEnvelope, secondsPerPart * decayTimeStart, beatsPerPart * partTimeStart, envelopeVolumeStart);\r\n\t\t\t\t\tlet feedbackEnd: number = feedbackAmplitude * Synth.computeOperatorEnvelope(instrument.feedbackEnvelope, secondsPerPart * decayTimeEnd, beatsPerPart * partTimeEnd, envelopeVolumeEnd);\r\n\t\t\t\t\tsynthChannel.feedbackMult = feedbackStart;\r\n\t\t\t\t\tsynthChannel.feedbackDelta = (feedbackEnd - synthChannel.feedbackMult) / samples;\r\n\t\t\t\t\t\r\n\t\t\t\t\tsineVolumeBoost *= 1.0 - instrument.feedbackAmplitude / 15.0;\r\n\t\t\t\t\t\r\n\t\t\t\t\tsineVolumeBoost *= 1.0 - Math.min(1.0, Math.max(0.0, totalCarrierVolume - 1) / 2.0);\r\n\t\t\t\t\tfor (let i: number = 0; i < carrierCount; i++) {\r\n\t\t\t\t\t\tsynthChannel.volumeStarts[i] *= 1.0 + sineVolumeBoost * 3.0;\r\n\t\t\t\t\t\tsynthChannel.volumeDeltas[i] *= 1.0 + sineVolumeBoost * 3.0;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlet pitch: number = pitches[0];\r\n\t\t\t\t\t// if (Config.chorusHarmonizes[instrument.chorus]) {\r\n\t\t\t\t\t// \tlet harmonyOffset: number = 0.0;\r\n\t\t\t\t\t// \tif (pitches.length == 2) {\r\n\t\t\t\t\t// \t\tharmonyOffset = pitches[1] - pitches[0];\r\n\t\t\t\t\t// \t} else if (pitches.length == 3) {\r\n\t\t\t\t\t// \t\tharmonyOffset = pitches[(arpeggio >> 1) + 1] - pitches[0];\r\n\t\t\t\t\t// \t} else if (pitches.length == 4) {\r\n\t\t\t\t\t// \t\tharmonyOffset = pitches[(arpeggio == 3 ? 1 : arpeggio) + 1] - pitches[0];\r\n\t\t\t\t\t// \t}\r\n\t\t\t\t\t// \tsynthChannel.harmonyMult = Math.pow(2.0, harmonyOffset / 12.0);\r\n\t\t\t\t\t// \tsynthChannel.harmonyVolumeMult = Math.pow(2.0, -harmonyOffset / pitchDamping)\r\n\t\t\t\t\t// } else {\r\n\t\t\t\t\t// \tif (pitches.length == 2) {\r\n\t\t\t\t\t// \t\tpitch = pitches[arpeggio >> 1];\r\n\t\t\t\t\t// \t} else if (pitches.length == 3) {\r\n\t\t\t\t\t// \t\tpitch = pitches[arpeggio == 3 ? 1 : arpeggio];\r\n\t\t\t\t\t// \t} else if (pitches.length == 4) {\r\n\t\t\t\t\t// \t\tpitch = pitches[arpeggio];\r\n\t\t\t\t\t// \t}\r\n\t\t\t\t\t// }\r\n\t\t\t\t\tif (!isDrum) {\r\n\t\t\t\t\t\tif (Config.harmNames[instrument.harm] == 1) {\r\n\t\t\t\t\t\t\t// duet\r\n\t\t\t\t\t\t\tlet harmonyOffset: number = 0.0;\r\n\t\t\t\t\t\t\tif (pitches.length == 2) {\r\n\t\t\t\t\t\t\t\tharmonyOffset = pitches[1] - pitches[0];\r\n\t\t\t\t\t\t\t} else if (pitches.length == 3) {\r\n\t\t\t\t\t\t\t\tharmonyOffset = pitches[(arpeggio >> 1) + 1] - pitches[0];\r\n\t\t\t\t\t\t\t} else if (pitches.length == 4) {\r\n\t\t\t\t\t\t\t\tharmonyOffset = pitches[(arpeggio == 3 ? 1 : arpeggio) + 1] - pitches[0];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tsynthChannel.harmonyMult = Math.pow(2.0, harmonyOffset / 12.0);\r\n\t\t\t\t\t\t\tsynthChannel.harmonyVolumeMult = Math.pow(2.0, -harmonyOffset / pitchDamping)\r\n\t\t\t\t\t\t} else if (Config.harmNames[instrument.harm] == 2) {\r\n\t\t\t\t\t\t\t// chord\r\n\t\t\t\t\t\t\tlet harmonyOffset: number = 0.0;\r\n\t\t\t\t\t\t\tif (pitches.length == 2) {\r\n\t\t\t\t\t\t\t\tharmonyOffset = pitches[1] - pitches[0];\r\n\t\t\t\t\t\t\t} else if (pitches.length == 3) {\r\n\t\t\t\t\t\t\t\tharmonyOffset = pitches[2] - pitches[0];\r\n\t\t\t\t\t\t\t} else if (pitches.length == 4) {\r\n\t\t\t\t\t\t\t\tharmonyOffset = pitches[(arpeggio == 3 ? 2 : arpeggio) + 1] - pitches[0];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tsynthChannel.harmonyMult = Math.pow(2.0, harmonyOffset / 12.0);\r\n\t\t\t\t\t\t\tsynthChannel.harmonyVolumeMult = Math.pow(2.0, -harmonyOffset / pitchDamping)\r\n\t\t\t\t\t\t} else if (Config.harmNames[instrument.harm] == 3) {\r\n\t\t\t\t\t\t\t// seventh\r\n\t\t\t\t\t\t\tlet harmonyOffset: number = 0.0;\r\n\t\t\t\t\t\t\tif (pitches.length == 2) {\r\n\t\t\t\t\t\t\t\tharmonyOffset = pitches[1] - pitches[0];\r\n\t\t\t\t\t\t\t} else if (pitches.length == 3) {\r\n\t\t\t\t\t\t\t\tharmonyOffset = pitches[2] - pitches[0];\r\n\t\t\t\t\t\t\t} else if (pitches.length == 4) {\r\n\t\t\t\t\t\t\t\tharmonyOffset = pitches[3] - pitches[0];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tsynthChannel.harmonyMult = Math.pow(2.0, harmonyOffset / 12.0);\r\n\t\t\t\t\t\t\tsynthChannel.harmonyVolumeMult = Math.pow(2.0, -harmonyOffset / pitchDamping)\r\n\t\t\t\t\t\t} else if (Config.harmNames[instrument.harm] == 4) {\r\n\t\t\t\t\t\t\t// half arpeggio\r\n\t\t\t\t\t\t\tlet harmonyOffset: number = 0.0;\r\n\t\t\t\t\t\t\tif (pitches.length == 2) {\r\n\t\t\t\t\t\t\t\tharmonyOffset = pitches[1] - pitches[0];\r\n\t\t\t\t\t\t\t} else if (pitches.length == 3) {\r\n\t\t\t\t\t\t\t\tharmonyOffset = pitches[(arpeggio >> 1) + 1] - pitches[0];\r\n\t\t\t\t\t\t\t} else if (pitches.length == 4) {\r\n\t\t\t\t\t\t\t\tharmonyOffset = pitches[(arpeggio >> 1) + 2] - pitches[0];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tsynthChannel.harmonyMult = Math.pow(2.0, harmonyOffset / 12.0);\r\n\t\t\t\t\t\t\tsynthChannel.harmonyVolumeMult = Math.pow(2.0, -harmonyOffset / pitchDamping)\r\n\t\t\t\t\t\t} else if (Config.harmNames[instrument.harm] == 5) {\r\n\t\t\t\t\t\t\t// arp-chord\r\n\t\t\t\t\t\t\tlet harmonyOffset: number = 0.0;\r\n\t\t\t\t\t\t\tif (pitches.length == 2) {\r\n\t\t\t\t\t\t\t\tharmonyOffset = pitches[1] - pitches[0];\r\n\t\t\t\t\t\t\t} else if (pitches.length == 3) {\r\n\t\t\t\t\t\t\t\tharmonyOffset = pitches[2] - pitches[0];\r\n\t\t\t\t\t\t\t} else if (pitches.length == 4) {\r\n\t\t\t\t\t\t\t\tharmonyOffset = pitches[(arpeggio == 3 ? 2 : arpeggio)] - pitches[0];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tsynthChannel.harmonyMult = Math.pow(2.0, harmonyOffset / 12.0);\r\n\t\t\t\t\t\t\tsynthChannel.harmonyVolumeMult = Math.pow(2.0, -harmonyOffset / pitchDamping)\r\n\t\t\t\t\t\t} else if (Config.harmNames[instrument.harm] == 0) {\r\n\t\t\t\t\t\t\t// arpeggio\r\n\t\t\t\t\t\t\tif (pitches.length == 2) {\r\n\t\t\t\t\t\t\t\tpitch = pitches[arpeggio >> 1];\r\n\t\t\t\t\t\t\t} else if (pitches.length == 3) {\r\n\t\t\t\t\t\t\t\tpitch = pitches[arpeggio == 3 ? 1 : arpeggio];\r\n\t\t\t\t\t\t\t} else if (pitches.length == 4) {\r\n\t\t\t\t\t\t\t\tpitch = pitches[arpeggio];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (Config.harmNames[instrument.harm] == 0) {\r\n\t\t\t\t\t\t\t// arpeggio\r\n\t\t\t\t\t\t\tif (pitches.length == 1) {\r\n\t\t\t\t\t\t\t\tpitch = pitches[0] + Config.octoffValues[instrument.octoff];\r\n\t\t\t\t\t\t\t} else if (pitches.length == 2) {\r\n\t\t\t\t\t\t\t\tpitch = pitches[arpeggio >> 1] + Config.octoffValues[instrument.octoff];\r\n\t\t\t\t\t\t\t} else if (pitches.length == 3) {\r\n\t\t\t\t\t\t\t\tpitch = pitches[arpeggio == 3 ? 1 : arpeggio] + Config.octoffValues[instrument.octoff];\r\n\t\t\t\t\t\t\t} else if (pitches.length == 4) {\r\n\t\t\t\t\t\t\t\tpitch = pitches[arpeggio] + Config.octoffValues[instrument.octoff];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else if (Config.harmNames[instrument.harm] == 1) {\r\n\t\t\t\t\t\t\t// duet\r\n\t\t\t\t\t\t\tif (pitches.length == 1) {\r\n\t\t\t\t\t\t\t\tpitch = pitches[0] + Config.octoffValues[instrument.octoff];\r\n\t\t\t\t\t\t\t} else if (pitches.length == 2) {\r\n\t\t\t\t\t\t\t\tpitch = (pitches[1] + pitches[0]) / 2 + Config.octoffValues[instrument.octoff];\r\n\t\t\t\t\t\t\t} else if (pitches.length == 3) {\r\n\t\t\t\t\t\t\t\tpitch = (pitches[(arpeggio >> 1) + 1] + pitches[0]) / 2 + Config.octoffValues[instrument.octoff];\r\n\t\t\t\t\t\t\t} else if (pitches.length == 4) {\r\n\t\t\t\t\t\t\t\tpitch = (pitches[(arpeggio == 3 ? 1 : arpeggio) + 1] + pitches[0]) / 2 + Config.octoffValues[instrument.octoff];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else if (Config.harmNames[instrument.harm] == 2) {\r\n\t\t\t\t\t\t\t// chord\r\n\t\t\t\t\t\t\tif (pitches.length == 1) {\r\n\t\t\t\t\t\t\t\tpitch = pitches[0] + Config.octoffValues[instrument.octoff];\r\n\t\t\t\t\t\t\t} else if (pitches.length == 2) {\r\n\t\t\t\t\t\t\t\tpitch = (pitches[1] + pitches[0]) / 2 + Config.octoffValues[instrument.octoff];\r\n\t\t\t\t\t\t\t} else if (pitches.length == 3) {\r\n\t\t\t\t\t\t\t\tpitch = (pitches[2] + pitches[0]) / 2 + Config.octoffValues[instrument.octoff];\r\n\t\t\t\t\t\t\t} else if (pitches.length == 4) {\r\n\t\t\t\t\t\t\t\tpitch = (pitches[(arpeggio == 3 ? 2 : arpeggio) + 1] + pitches[0]) / 2 + Config.octoffValues[instrument.octoff];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else if (Config.harmNames[instrument.harm] == 3) {\r\n\t\t\t\t\t\t\t// seventh\r\n\t\t\t\t\t\t\tif (pitches.length == 1) {\r\n\t\t\t\t\t\t\t\tpitch = pitches[0] + Config.octoffValues[instrument.octoff];\r\n\t\t\t\t\t\t\t} else if (pitches.length == 2) {\r\n\t\t\t\t\t\t\t\tpitch = (pitches[1] + pitches[0]) / 2 + Config.octoffValues[instrument.octoff];\r\n\t\t\t\t\t\t\t} else if (pitches.length == 3) {\r\n\t\t\t\t\t\t\t\tpitch = (pitches[2] + pitches[0]) / 2 + Config.octoffValues[instrument.octoff];\r\n\t\t\t\t\t\t\t} else if (pitches.length == 4) {\r\n\t\t\t\t\t\t\t\tpitch = (pitches[3] + pitches[0]) / 2 + Config.octoffValues[instrument.octoff];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else if (Config.harmNames[instrument.harm] == 4) {\r\n\t\t\t\t\t\t\t// half arpeggio\r\n\t\t\t\t\t\t\tif (pitches.length == 1) {\r\n\t\t\t\t\t\t\t\tpitch = pitches[0] + Config.octoffValues[instrument.octoff];\r\n\t\t\t\t\t\t\t} else if (pitches.length == 2) {\r\n\t\t\t\t\t\t\t\tpitch = (pitches[1] + pitches[0]) / 2 + Config.octoffValues[instrument.octoff];\r\n\t\t\t\t\t\t\t} else if (pitches.length == 3) {\r\n\t\t\t\t\t\t\t\tpitch = (pitches[(arpeggio >> 1) + 1] + pitches[0]) / 2 + Config.octoffValues[instrument.octoff];\r\n\t\t\t\t\t\t\t} else if (pitches.length == 4) {\r\n\t\t\t\t\t\t\t\tpitch = pitches[(arpeggio >> 1) + 2] + pitches[0] + Config.octoffValues[instrument.octoff];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tconst startPitch: number = (pitch + intervalStart) * intervalScale;\r\n\t\t\t\t\tconst endPitch: number = (pitch + intervalEnd) * intervalScale;\r\n\t\t\t\t\tconst startFreq: number = synth.frequencyFromPitch(basePitch + startPitch);\r\n\t\t\t\t\tconst pitchVolumeStart: number = Math.pow(2.0, -startPitch / pitchDamping);\r\n\t\t\t\t\tconst pitchVolumeEnd: number   = Math.pow(2.0,   -endPitch / pitchDamping);\r\n\t\t\t\t\tif (isDrum && Config.drumWaveIsSoft[instrument.wave]) {\r\n\t\t\t\t\t\tsynthChannel.filter = Math.min(1.0, startFreq * sampleTime * Config.drumPitchFilterMult[instrument.wave]);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet settingsVolumeMult: number;\r\n\t\t\t\t\tif (!isDrum) {\r\n\t\t\t\t\t\tconst filterScaleRate: number = Config.filterDecays[instrument.filter];\r\n\t\t\t\t\t\tsynthChannel.filter = Math.pow(2, -filterScaleRate * secondsPerPart * decayTimeStart);\r\n\t\t\t\t\t\tconst endFilter: number = Math.pow(2, -filterScaleRate * secondsPerPart * decayTimeEnd);\r\n\t\t\t\t\t\tsynthChannel.filterScale = Math.pow(endFilter / synthChannel.filter, 1.0 / samples);\r\n\t\t\t\t\t\tsettingsVolumeMult = 0.27 * 0.5 * Config.waveVolumes[instrument.wave] * Config.filterVolumes[instrument.filter] * Config.chorusVolumes[instrument.chorus];\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (song.mix == 0) {\r\n\t\t\t\t\t\t\tsettingsVolumeMult = 0.19 * Config.drumVolumes[instrument.wave];\r\n\t\t\t\t\t\t} else if (song.mix == 3) {\r\n\t\t\t\t\t\t\tsettingsVolumeMult = 0.12 * Config.drumVolumes[instrument.wave];\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tsettingsVolumeMult = 0.09 * Config.drumVolumes[instrument.wave];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (resetPhases && !isDrum) {\r\n\t\t\t\t\t\tsynthChannel.reset();\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tsynthChannel.phaseDeltas[0] = startFreq * sampleTime;\r\n\t\t\t\t\t\r\n\t\t\t\t\tlet instrumentVolumeMult: number = 0;\r\n\t\t\t\t\tif (song.mix == 2) {\r\n\t\t\t\t\t\tinstrumentVolumeMult = (instrument.volume == 9) ? 0.0 : Math.pow(3, -Config.volumeValues[instrument.volume]) * Config.imuteValues[instrument.imute];\r\n\t\t\t\t\t} else if (song.mix == 1) {\r\n\t\t\t\t\t\tinstrumentVolumeMult = (instrument.volume >= 5) ? 0.0 : Math.pow(3, -Config.volumeMValues[instrument.volume]) * Config.imuteValues[instrument.imute];\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tinstrumentVolumeMult = (instrument.volume >= 5) ? 0.0 : Math.pow(2, -Config.volumeMValues[instrument.volume]) * Config.imuteValues[instrument.imute];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tsynthChannel.volumeStarts[0] = transitionVolumeStart * envelopeVolumeStart * pitchVolumeStart * settingsVolumeMult * instrumentVolumeMult;\r\n\t\t\t\t\tconst volumeEnd: number = transitionVolumeEnd * envelopeVolumeEnd * pitchVolumeEnd * settingsVolumeMult * instrumentVolumeMult;\r\n\t\t\t\t\tsynthChannel.volumeDeltas[0] = (volumeEnd - synthChannel.volumeStarts[0]) / samples;\r\n\t\t\t\t\tsynthChannel.volumeLeft[0] = Math.min(1, 1 + Config.ipanValues[instrument.ipan]);\r\n\t\t\t\t\tsynthChannel.volumeRight[0] = Math.min(1, 1 - Config.ipanValues[instrument.ipan]);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tsynthChannel.phaseDeltaScale = Math.pow(2.0, ((intervalEnd - intervalStart) * intervalScale / 12.0) / samples);\r\n\t\t\t\tsynthChannel.vibratoScale = (partsSinceStart < Config.effectVibratoDelays[instrument.effect]) ? 0.0 : Math.pow(2.0, Config.effectVibratos[instrument.effect] / 12.0) - 1.0;\r\n\t\t\t} else {\r\n\t\t\t\t// @TODO: ModBox doesn't have this guard around .reset, why?\r\n\t\t\t\t// if (!isDrum) {\r\n\t\t\t\t\tsynthChannel.reset();\r\n\t\t\t\t// }\r\n\t\t\t\tfor (let i: number = 0; i < Config.operatorCount; i++) {\r\n\t\t\t\t\tsynthChannel.phaseDeltas[0] = 0.0;\r\n\t\t\t\t\tsynthChannel.volumeStarts[0] = 0.0;\r\n\t\t\t\t\tsynthChannel.volumeDeltas[0] = 0.0;\r\n\t\t\t\t\tsynthChannel.volumeLeft[0] = 0.0;\r\n\t\t\t\t\tsynthChannel.volumeRight[0] = 0.0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tprivate static readonly generatedSynthesizers: Dictionary<Function> = {};\r\n\t\t\r\n\t\tprivate static getGeneratedSynthesizer(song: Song, bar: number): Function {\r\n\t\t\tconst fingerprint: string = song.getChannelFingerprint(bar);\r\n\t\t\tif (Synth.generatedSynthesizers[fingerprint] == undefined) {\r\n\t\t\t\tconst synthSource: string[] = [];\r\n\t\t\t\tconst instruments: Instrument[] = [];\r\n\t\t\t\tfor (let channel = 0; channel < song.pitchChannelCount; channel++) {\r\n\t\t\t\t\tinstruments[channel] = song.channels[channel].instruments[song.getPatternInstrument(channel, bar)];\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tfor (const line of Synth.synthSourceTemplate) {\r\n\t\t\t\t\tif (line.indexOf(\"#\") != -1) {\r\n\t\t\t\t\t\tif (line.indexOf(\"// PITCH\") != -1) {\r\n\t\t\t\t\t\t\tfor (let channel = 0; channel < song.pitchChannelCount; channel++) {\r\n\t\t\t\t\t\t\t\tsynthSource.push(line.replace(/#/g, channel + \"\"));\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else if (line.indexOf(\"// JCHIP\") != -1) {\r\n\t\t\t\t\t\t\tfor (let channel = 0; channel < song.pitchChannelCount; channel++) {\r\n\t\t\t\t\t\t\t\tif (instruments[channel].type == InstrumentType.chip) {\r\n\t\t\t\t\t\t\t\t\tsynthSource.push(line.replace(/#/g, channel + \"\"));\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else if (line.indexOf(\"// CHIP\") != -1) {\r\n\t\t\t\t\t\t\tfor (let channel = 0; channel < song.pitchChannelCount; channel++) {\r\n\t\t\t\t\t\t\t\tif (instruments[channel].type == InstrumentType.chip) {\r\n\t\t\t\t\t\t\t\t\tsynthSource.push(line.replace(/#/g, channel + \"\"));\r\n\t\t\t\t\t\t\t\t} else if (instruments[channel].type == InstrumentType.pwm) {\r\n\t\t\t\t\t\t\t\t\tsynthSource.push(line.replace(/#/g, channel + \"\"));\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else if (line.indexOf(\"// FM\") != -1) {\r\n\t\t\t\t\t\t\tfor (let channel = 0; channel < song.pitchChannelCount; channel++) {\r\n\t\t\t\t\t\t\t\tif (instruments[channel].type == InstrumentType.fm) {\r\n\t\t\t\t\t\t\t\t\tif (line.indexOf(\"$\") != -1) {\r\n\t\t\t\t\t\t\t\t\t\tfor (let j = 0; j < Config.operatorCount; j++) {\r\n\t\t\t\t\t\t\t\t\t\t\tsynthSource.push(line.replace(/#/g, channel + \"\").replace(/\\$/g, j + \"\"));\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\tsynthSource.push(line.replace(/#/g, channel + \"\"));\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else if (line.indexOf(\"// PWM\") != -1) {\r\n\t\t\t\t\t\t\tfor (let channel = 0; channel < song.pitchChannelCount; channel++) {\r\n\t\t\t\t\t\t\t\tif (instruments[channel].type == InstrumentType.pwm) {\r\n\t\t\t\t\t\t\t\t\tsynthSource.push(line.replace(/#/g, channel + \"\"));\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else if (line.indexOf(\"// CARRIER OUTPUTS\") != -1) {\r\n\t\t\t\t\t\t\tfor (let channel = 0; channel < song.pitchChannelCount; channel++) {\r\n\t\t\t\t\t\t\t\tif (instruments[channel].type == InstrumentType.fm) {\r\n\t\t\t\t\t\t\t\t\tconst outputs: string[] = [];\r\n\t\t\t\t\t\t\t\t\tfor (let j = 0; j < Config.operatorCarrierCounts[instruments[channel].algorithm]; j++) {\r\n\t\t\t\t\t\t\t\t\t\toutputs.push(\"channel\" + channel + \"Operator\" + j + \"Scaled\");\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tsynthSource.push(line.replace(/#/g, channel + \"\").replace(\"/*channel\" + channel + \"Operator$Scaled*/\", outputs.join(\" + \")));\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else if (line.indexOf(\"// NOISE\") != -1) {\r\n\t\t\t\t\t\t\tfor (let channel = song.pitchChannelCount; channel < song.pitchChannelCount + song.drumChannelCount; channel++) {\r\n\t\t\t\t\t\t\t\tsynthSource.push(line.replace(/#/g, channel + \"\"));\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else if (line.indexOf(\"// ALL\") != -1) {\r\n\t\t\t\t\t\t\tfor (let channel = 0; channel < song.pitchChannelCount + song.drumChannelCount; channel++) {\r\n\t\t\t\t\t\t\t\tsynthSource.push(line.replace(/#/g, channel + \"\"));\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthrow new Error(\"Missing channel type annotation for line: \" + line);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if (line.indexOf(\"// INSERT OPERATOR COMPUTATION HERE\") != -1) {\r\n\t\t\t\t\t\tfor (let j = Config.operatorCount - 1; j >= 0; j--) {\r\n\t\t\t\t\t\t\tfor (const operatorLine of Synth.operatorSourceTemplate) {\r\n\t\t\t\t\t\t\t\tfor (let channel = 0; channel < song.pitchChannelCount; channel++) {\r\n\t\t\t\t\t\t\t\t\tif (instruments[channel].type == InstrumentType.fm) {\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\tif (operatorLine.indexOf(\"/* + channel#Operator@Scaled*/\") != -1) {\r\n\t\t\t\t\t\t\t\t\t\t\tlet modulators = \"\";\r\n\t\t\t\t\t\t\t\t\t\t\tfor (const modulatorNumber of Config.operatorModulatedBy[instruments[channel].algorithm][j]) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tmodulators += \" + channel\" + channel + \"Operator\" + (modulatorNumber - 1) + \"Scaled\";\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tconst feedbackIndices: ReadonlyArray<number> = Config.operatorFeedbackIndices[instruments[channel].feedbackType][j];\r\n\t\t\t\t\t\t\t\t\t\t\tif (feedbackIndices.length > 0) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tmodulators += \" + channel\" + channel + \"FeedbackMult * (\";\r\n\t\t\t\t\t\t\t\t\t\t\t\tconst feedbacks: string[] = [];\r\n\t\t\t\t\t\t\t\t\t\t\t\tfor (const modulatorNumber of feedbackIndices) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tfeedbacks.push(\"channel\" + channel + \"Operator\" + (modulatorNumber - 1) + \"Output\");\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\tmodulators += feedbacks.join(\" + \") + \")\";\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\tsynthSource.push(operatorLine.replace(/#/g, channel + \"\").replace(/\\$/g, j + \"\").replace(\"/* + channel\" + channel + \"Operator@Scaled*/\", modulators));\r\n\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\tsynthSource.push(operatorLine.replace(/#/g, channel + \"\").replace(/\\$/g, j + \"\"));\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tsynthSource.push(line);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t//console.log(synthSource.join(\"\\n\"));\r\n\t\t\t\t\r\n\t\t\t\tSynth.generatedSynthesizers[fingerprint] = new Function(\"synth\", \"song\", \"dataLeft\", \"dataRight\", \"bufferLength\", \"bufferIndex\", \"samplesPerTick\", synthSource.join(\"\\n\"));\r\n\t\t\t}\r\n\t\t\treturn Synth.generatedSynthesizers[fingerprint];\r\n\t\t}\r\n\r\n\t\tprivate static synthSourceTemplate: string[] = (`\r\n\t\t\tvar sampleTime = 1.0 / synth.samplesPerSecond;\r\n\t\t\tvar effectYMult = +synth.effectYMult;\r\n\t\t\tvar limitDecay = +synth.limitDecay;\r\n\t\t\tvar volume = +synth.volume;\r\n\t\t\tvar delayLineLeft = synth.delayLineLeft;\r\n\t\t\tvar delayLineRight = synth.delayLineRight;\r\n\t\t\tvar reverb = Math.pow(song.reverb / beepbox.Config.reverbRange, 0.667) * 0.425;\r\n\t\t\tvar blend = Math.pow(song.blend / beepbox.Config.blendRange, 0.667) * 0.425;\r\n\t\t\tvar mix = song.mix;\r\n\t\t\tvar muff = Math.pow(song.muff / beepbox.Config.muffRange, 0.667) * 0.425;\r\n\t\t\tvar detune = song.detune;\r\n\t\t\tvar riff = Math.pow(song.riff / beepbox.Config.riffRange, 0.667) * 0.425; \r\n\t\t\tvar sineWave = beepbox.Config.sineWave;\r\n\t\t\t\r\n\t\t\t// Initialize instruments based on current pattern.\r\n\t\t\tvar instrumentChannel# = song.getPatternInstrument(#, synth.bar); // ALL\r\n\t\t\tvar instrument# = song.channels[#].instruments[instrumentChannel#]; // ALL\r\n\t\t\tvar channel#Wave = (mix <= 1) ? beepbox.Config.waves[instrument#.wave] : beepbox.Config.wavesMixC[instrument#.wave]; // CHIP\r\n\t\t\tvar channel#Wave = beepbox.Config.getDrumWave(instrument#.wave); // NOISE\r\n\t\t\tvar channel#WaveLength = channel#Wave.length; // CHIP\r\n\t\t\tvar channel#Wave = beepbox.Config.pwmwaves[instrument#.wave]; // PWM\r\n\t\t\tvar channel#WaveLength = channel#Wave.length; // PWM\r\n\t\t\tvar channel#FilterBase = (song.mix == 2) ? Math.pow(2 - (blend * 2) + (muff * 2), -beepbox.Config.filterBases[instrument#.filter]) : Math.pow(2, -beepbox.Config.filterBases[instrument#.filter] + (blend * 4) - (muff * 4)); // CHIP\r\n\t\t\tvar channel#TremoloScale = beepbox.Config.effectTremolos[instrument#.effect]; // PITCH\r\n\t\t\t\r\n\t\t\twhile (bufferIndex < bufferLength) {\r\n\t\t\t\t\r\n\t\t\t\tvar samples;\r\n\t\t\t\tvar samplesLeftInBuffer = bufferLength - bufferIndex;\r\n\t\t\t\tif (synth.arpSampleCountdown <= samplesLeftInBuffer) {\r\n\t\t\t\t\tsamples = synth.arpSampleCountdown;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tsamples = samplesLeftInBuffer;\r\n\t\t\t\t}\r\n\t\t\t\tsynth.arpSampleCountdown -= samples;\r\n\t\t\t\t\r\n\t\t\t\tvar time = synth.part + synth.beat * song.partsPerBeat;\r\n\t\t\t\t\r\n\t\t\t\tbeepbox.Synth.computeChannelInstrument(synth, song, #, time, sampleTime, samplesPerTick, samples); // ALL\r\n\t\t\t\tvar synthChannel# = synth.channels[#]; // ALL\r\n\t\t\t\t\r\n\t\t\t\tvar channel#ChorusA = Math.pow(2.0, (beepbox.Config.chorusOffsets[instrument#.chorus] + beepbox.Config.chorusIntervals[instrument#.chorus] + beepbox.Config.octoffValues[instrument#.octoff] + (detune / 24) * ((riff * beepbox.Config.chorusRiffApp[instrument#.chorus]) + 1)) / 12.0); // CHIP\r\n\t\t\t\tvar channel#ChorusB = Math.pow(2.0, (beepbox.Config.chorusOffsets[instrument#.chorus] - beepbox.Config.chorusIntervals[instrument#.chorus] + beepbox.Config.octoffValues[instrument#.octoff] + (detune / 24) * ((riff * beepbox.Config.chorusRiffApp[instrument#.chorus]) + 1)) / 12.0); // CHIP\r\n\t\t\t\tvar channel#ChorusSign = synthChannel#.harmonyVolumeMult * (beepbox.Config.chorusSigns[instrument#.chorus]); // CHIP\r\n\t\t\t\tchannel#ChorusB *= synthChannel#.harmonyMult; // CHIP\r\n\t\t\t\tvar channel#ChorusDeltaRatio = channel#ChorusB / channel#ChorusA * ((riff * beepbox.Config.chorusRiffApp[instrument#.chorus]) + 1); // CHIP\r\n\t\t\t\t\r\n\t\t\t\tvar channel#PhaseDelta = synthChannel#.phaseDeltas[0] * channel#ChorusA * ((riff * beepbox.Config.chorusRiffApp[instrument#.chorus]) + 1); // CHIP\r\n\t\t\t\tvar channel#PhaseDelta = synthChannel#.phaseDeltas[0] / 32768.0; // NOISE\r\n\t\t\t\tvar channel#PhaseDeltaScale = synthChannel#.phaseDeltaScale; // ALL\r\n\t\t\t\tvar channel#Volume = synthChannel#.volumeStarts[0]; // CHIP\r\n\t\t\t\tvar channel#Volume = synthChannel#.volumeStarts[0]; // NOISE\r\n\t\t\t\tvar channel#VolumeLeft = synthChannel#.volumeLeft[0]; // ALL\r\n\t\t\t\tvar channel#VolumeRight = synthChannel#.volumeRight[0]; // ALL\r\n\t\t\t\tvar channel#VolumeDelta = synthChannel#.volumeDeltas[0]; // CHIP\r\n\t\t\t\tvar channel#VolumeDelta = synthChannel#.volumeDeltas[0]; // NOISE\r\n\t\t\t\tvar channel#Filter = synthChannel#.filter * channel#FilterBase; // CHIP\r\n\t\t\t\tvar channel#Filter = synthChannel#.filter; // NOISE\r\n\t\t\t\tvar channel#FilterScale = synthChannel#.filterScale; // CHIP\r\n\t\t\t\tvar channel#VibratoScale = synthChannel#.vibratoScale; // PITCH\r\n\t\t\t\t\r\n\t\t\t\tvar effectY     = Math.sin(synth.effectPhase);\r\n\t\t\t\tvar prevEffectY = Math.sin(synth.effectPhase - synth.effectAngle);\r\n\t\t\t\t\r\n\t\t\t\tvar channel#PhaseA = synth.channels[#].phases[0] % 1; // CHIP\r\n\t\t\t\tvar channel#PhaseB = synth.channels[#].phases[1] % 1; // CHIP\r\n\t\t\t\tvar channel#Phase  = synth.channels[#].phases[0] % 1; // NOISE\r\n\t\t\t\t\r\n\t\t\t\tvar channel#Operator$Phase       = ((synth.channels[#].phases[$] % 1) + ` + Synth.negativePhaseGuard + `) * ` + Config.sineWaveLength + `; // FM\r\n\t\t\t\tvar channel#Operator$PhaseDelta  = synthChannel#.phaseDeltas[$]; // FM\r\n\t\t\t\tvar channel#Operator$OutputMult  = synthChannel#.volumeStarts[$]; // FM\r\n\t\t\t\tvar channel#Operator$OutputDelta = synthChannel#.volumeDeltas[$]; // FM\r\n\t\t\t\tvar channel#Operator$Output      = synthChannel#.feedbackOutputs[$]; // FM\r\n\t\t\t\tvar channel#FeedbackMult         = synthChannel#.feedbackMult; // FM\r\n\t\t\t\tvar channel#FeedbackDelta        = synthChannel#.feedbackDelta; // FM\r\n\t\t\t\t\r\n\t\t\t\tvar channel#SampleLeft = +synth.channels[#].sampleLeft; // ALL\r\n\t\t\t\tvar channel#SampleRight = +synth.channels[#].sampleRight; // ALL\r\n\t\t\t\t\r\n\t\t\t\tvar delayPosLeft = 0|synth.delayPosLeft;\r\n\t\t\t\tvar delayFeedback0Left = +synth.delayFeedback0Left;\r\n\t\t\t\tvar delayFeedback1Left = +synth.delayFeedback1Left;\r\n\t\t\t\tvar delayFeedback2Left = +synth.delayFeedback2Left;\r\n\t\t\t\tvar delayFeedback3Left = +synth.delayFeedback3Left;\r\n\t\t\t\tvar delayPosRight = 0|synth.delayPosRight;\r\n\t\t\t\tvar delayFeedback0Right = +synth.delayFeedback0Right;\r\n\t\t\t\tvar delayFeedback1Right = +synth.delayFeedback1Right;\r\n\t\t\t\tvar delayFeedback2Right = +synth.delayFeedback2Right;\r\n\t\t\t\tvar delayFeedback3Right = +synth.delayFeedback3Right;\r\n\t\t\t\tvar limit = +synth.limit;\r\n\t\t\t\t\r\n\t\t\t\twhile (samples) {\r\n\t\t\t\t\tvar channel#Vibrato = 1.0 + channel#VibratoScale * effectY; // PITCH\r\n\t\t\t\t\tvar channel#Tremolo = 1.0 + channel#TremoloScale * (effectY - 1.0); // PITCH\r\n\t\t\t\t\tvar temp = effectY;\r\n\t\t\t\t\teffectY = effectYMult * effectY - prevEffectY;\r\n\t\t\t\t\tprevEffectY = temp;\r\n\t\t\t\t\t\r\n\t\t\t\t\tchannel#SampleLeft += ((channel#Wave[0|(channel#PhaseA * channel#WaveLength)] + channel#Wave[0|(channel#PhaseB * channel#WaveLength)] * channel#ChorusSign) * channel#Volume * channel#Tremolo - channel#SampleLeft) * channel#Filter * channel#VolumeLeft; // CHIP \r\n\t\t\t\t\tchannel#SampleLeft += (channel#Wave[0|(channel#Phase * 32768.0)] * channel#Volume - channel#SampleLeft) * channel#Filter * channel#VolumeLeft; // NOISE\r\n\t\t\t\t\tchannel#SampleRight += ((channel#Wave[0|(channel#PhaseA * channel#WaveLength)] + channel#Wave[0|(channel#PhaseB * channel#WaveLength)] * channel#ChorusSign) * channel#Volume * channel#Tremolo - channel#SampleRight) * channel#Filter * channel#VolumeRight; // CHIP \r\n\t\t\t\t\tchannel#SampleRight += (channel#Wave[0|(channel#Phase * 32768.0)] * channel#Volume - channel#SampleRight) * channel#Filter * channel#VolumeRight; // NOISE\r\n\t\t\t\t\tchannel#Volume += channel#VolumeDelta; // CHIP\r\n\t\t\t\t\tchannel#Volume += channel#VolumeDelta; // NOISE\r\n\t\t\t\t\tchannel#PhaseA += channel#PhaseDelta * channel#Vibrato; // CHIP\r\n\t\t\t\t\tchannel#PhaseB += channel#PhaseDelta * channel#Vibrato * channel#ChorusDeltaRatio; // CHIP\r\n\t\t\t\t\tchannel#Phase += channel#PhaseDelta; // NOISE\r\n\t\t\t\t\tchannel#Filter *= channel#FilterScale; // CHIP\r\n\t\t\t\t\tchannel#PhaseA -= 0|channel#PhaseA; // CHIP\r\n\t\t\t\t\tchannel#PhaseB -= 0|channel#PhaseB; // CHIP\r\n\t\t\t\t\tchannel#Phase -= 0|channel#Phase; // NOISE\r\n\t\t\t\t\tchannel#PhaseDelta *= channel#PhaseDeltaScale; // CHIP\r\n\t\t\t\t\tchannel#PhaseDelta *= channel#PhaseDeltaScale; // NOISE\r\n\t\t\t\t\t\r\n\t\t\t\t\t// INSERT OPERATOR COMPUTATION HERE\r\n\t\t\t\t\tchannel#SampleLeft = channel#Tremolo * (/*channel#Operator$Scaled*/) * channel#VolumeLeft; // CARRIER OUTPUTS\r\n\t\t\t\t\tchannel#SampleRight = channel#Tremolo * (/*channel#Operator$Scaled*/) * channel#VolumeRight; // CARRIER OUTPUTS\r\n\t\t\t\t\tchannel#FeedbackMult += channel#FeedbackDelta; // FM\r\n\t\t\t\t\tchannel#Operator$OutputMult += channel#Operator$OutputDelta; // FM\r\n\t\t\t\t\tchannel#Operator$Phase += channel#Operator$PhaseDelta * channel#Vibrato; // FM\r\n\t\t\t\t\tchannel#Operator$PhaseDelta *= channel#PhaseDeltaScale; // FM\r\n\t\t\t\t\t\r\n\t\t\t\t\t// Reverb, implemented using a feedback delay network with a Hadamard matrix and lowpass filters.\r\n\t\t\t\t\t// good ratios:    0.555235 + 0.618033 + 0.818 +   1.0 = 2.991268\r\n\t\t\t\t\t// Delay lengths:  3041     + 3385     + 4481  +  5477 = 16384 = 2^14\r\n\t\t\t\t\t// Buffer offsets: 3041    -> 6426   -> 10907 -> 16384\r\n\t\t\t\t\tvar delayPos1Left = (delayPosLeft +  3041) & 0x3FFF;\r\n\t\t\t\t\tvar delayPos2Left = (delayPosLeft +  6426) & 0x3FFF;\r\n\t\t\t\t\tvar delayPos3Left = (delayPosLeft + 10907) & 0x3FFF;\r\n\t\t\t\t\tvar delaySampleLeft0 = (delayLineLeft[delayPosLeft]\r\n\t\t\t\t\t\t+ channel#SampleLeft // PITCH\r\n\t\t\t\t\t);\r\n\t\t\t\t\tvar delayPos1Right = (delayPosRight +  3041) & 0x3FFF;\r\n\t\t\t\t\tvar delayPos2Right = (delayPosRight +  6426) & 0x3FFF;\r\n\t\t\t\t\tvar delayPos3Right = (delayPosRight + 10907) & 0x3FFF;\r\n\t\t\t\t\tvar delaySampleRight0 = (delayLineRight[delayPosRight]\r\n\t\t\t\t\t\t+ channel#SampleRight // PITCH\r\n\t\t\t\t\t);\r\n\t\t\t\t\tvar delaySampleLeft1 = delayLineLeft[delayPos1Left];\r\n\t\t\t\t\tvar delaySampleLeft2 = delayLineLeft[delayPos2Left];\r\n\t\t\t\t\tvar delaySampleLeft3 = delayLineLeft[delayPos3Left];\r\n\t\t\t\t\tvar delayTemp0Left = -delaySampleLeft0 + delaySampleLeft1;\r\n\t\t\t\t\tvar delayTemp1Left = -delaySampleLeft0 - delaySampleLeft1;\r\n\t\t\t\t\tvar delayTemp2Left = -delaySampleLeft2 + delaySampleLeft3;\r\n\t\t\t\t\tvar delayTemp3Left = -delaySampleLeft2 - delaySampleLeft3;\r\n\t\t\t\t\tdelayFeedback0Left += ((delayTemp0Left + delayTemp2Left) * reverb - delayFeedback0Left) * 0.5;\r\n\t\t\t\t\tdelayFeedback1Left += ((delayTemp1Left + delayTemp3Left) * reverb - delayFeedback1Left) * 0.5;\r\n\t\t\t\t\tdelayFeedback2Left += ((delayTemp0Left - delayTemp2Left) * reverb - delayFeedback2Left) * 0.5;\r\n\t\t\t\t\tdelayFeedback3Left += ((delayTemp1Left - delayTemp3Left) * reverb - delayFeedback3Left) * 0.5;\r\n\t\t\t\t\tdelayLineLeft[delayPos1Left] = delayFeedback0Left;\r\n\t\t\t\t\tdelayLineLeft[delayPos2Left] = delayFeedback1Left;\r\n\t\t\t\t\tdelayLineLeft[delayPos3Left] = delayFeedback2Left;\r\n\t\t\t\t\tdelayLineLeft[delayPosLeft ] = delayFeedback3Left;\r\n\t\t\t\t\tdelayPosLeft = (delayPosLeft + 1) & 0x3FFF;\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar delaySampleRight1 = delayLineRight[delayPos1Right];\r\n\t\t\t\t\tvar delaySampleRight2 = delayLineRight[delayPos2Right];\r\n\t\t\t\t\tvar delaySampleRight3 = delayLineRight[delayPos3Right];\r\n\t\t\t\t\tvar delayTemp0Right = -delaySampleRight0 + delaySampleRight1;\r\n\t\t\t\t\tvar delayTemp1Right = -delaySampleRight0 - delaySampleRight1;\r\n\t\t\t\t\tvar delayTemp2Right = -delaySampleRight2 + delaySampleRight3;\r\n\t\t\t\t\tvar delayTemp3Right = -delaySampleRight2 - delaySampleRight3;\r\n\t\t\t\t\tdelayFeedback0Right += ((delayTemp0Right + delayTemp2Right) * reverb - delayFeedback0Right) * 0.5;\r\n\t\t\t\t\tdelayFeedback1Right += ((delayTemp1Right + delayTemp3Right) * reverb - delayFeedback1Right) * 0.5;\r\n\t\t\t\t\tdelayFeedback2Right += ((delayTemp0Right - delayTemp2Right) * reverb - delayFeedback2Right) * 0.5;\r\n\t\t\t\t\tdelayFeedback3Right += ((delayTemp1Right - delayTemp3Right) * reverb - delayFeedback3Right) * 0.5;\r\n\t\t\t\t\tdelayLineRight[delayPos1Right] = delayFeedback0Right;\r\n\t\t\t\t\tdelayLineRight[delayPos2Right] = delayFeedback1Right;\r\n\t\t\t\t\tdelayLineRight[delayPos3Right] = delayFeedback2Right;\r\n\t\t\t\t\tdelayLineRight[delayPosRight ] = delayFeedback3Right;\r\n\t\t\t\t\tdelayPosRight = (delayPosRight + 1) & 0x3FFF;\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar sampleLeft = delaySampleLeft0 + delaySampleLeft1 + delaySampleLeft2 + delaySampleLeft3\r\n\t\t\t\t\t\t+ channel#SampleLeft // NOISE\r\n\t\t\t\t\t;\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar sampleRight = delaySampleRight0 + delaySampleRight1 + delaySampleRight2 + delaySampleRight3\r\n\t\t\t\t\t\t+ channel#SampleRight // NOISE\r\n\t\t\t\t\t;\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar abs = sampleLeft < 0.0 ? -sampleLeft : sampleLeft;\r\n\t\t\t\t\tlimit -= limitDecay;\r\n\t\t\t\t\tif (limit < abs) limit = abs;\r\n\t\t\t\t\tsampleLeft /= limit * 0.75 + 0.25;\r\n\t\t\t\t\tsampleLeft *= volume;\r\n\t\t\t\t\tsampleLeft = sampleLeft;\r\n\t\t\t\t\tdataLeft[bufferIndex] = sampleLeft;\r\n\t\t\t\t\tsampleRight /= limit * 0.75 + 0.25;\r\n\t\t\t\t\tsampleRight *= volume;\r\n\t\t\t\t\tsampleRight = sampleRight;\r\n\t\t\t\t\tdataRight[bufferIndex] = sampleRight;\r\n\t\t\t\t\tbufferIndex++;\r\n\t\t\t\t\tsamples--;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tsynthChannel#.phases[0] = channel#PhaseA; // CHIP\r\n\t\t\t\tsynthChannel#.phases[1] = channel#PhaseB; // CHIP\r\n\t\t\t\tsynthChannel#.phases[0] = channel#Phase; // NOISE\r\n\t\t\t\tsynthChannel#.phases[$] = channel#Operator$Phase / ` + Config.sineWaveLength + `; // FM\r\n\t\t\t\tsynthChannel#.feedbackOutputs[$] = channel#Operator$Output; // FM\r\n\t\t\t\tsynthChannel#.sampleLeft = channel#SampleLeft; // ALL\r\n\t\t\t\tsynthChannel#.sampleRight = channel#SampleRight; // ALL\r\n\t\t\t\t\r\n\t\t\t\tsynth.delayPosLeft = delayPosLeft;\r\n\t\t\t\tsynth.delayFeedback0Left = delayFeedback0Left;\r\n\t\t\t\tsynth.delayFeedback1Left = delayFeedback1Left;\r\n\t\t\t\tsynth.delayFeedback2Left = delayFeedback2Left;\r\n\t\t\t\tsynth.delayFeedback3Left = delayFeedback3Left;\r\n\t\t\t\tsynth.delayPosRight = delayPosRight;\r\n\t\t\t\tsynth.delayFeedback0Right = delayFeedback0Right;\r\n\t\t\t\tsynth.delayFeedback1Right = delayFeedback1Right;\r\n\t\t\t\tsynth.delayFeedback2Right = delayFeedback2Right;\r\n\t\t\t\tsynth.delayFeedback3Right = delayFeedback3Right;\r\n\t\t\t\tsynth.limit = limit;\r\n\t\t\t\t\r\n\t\t\t\tif (effectYMult * effectY - prevEffectY > prevEffectY) {\r\n\t\t\t\t\tsynth.effectPhase = Math.asin(effectY);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tsynth.effectPhase = Math.PI - Math.asin(effectY);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif (synth.arpSampleCountdown == 0) {\r\n\t\t\t\t\tsynth.arpeggio++;\r\n\t\t\t\t\tsynth.arpSampleCountdown = samplesPerTick;\r\n\t\t\t\t\tif (synth.arpeggio == 4) {\r\n\t\t\t\t\t\tsynth.arpeggio = 0;\r\n\t\t\t\t\t\tsynth.part++;\r\n\t\t\t\t\t\tif (synth.part == song.partsPerBeat) {\r\n\t\t\t\t\t\t\tsynth.part = 0;\r\n\t\t\t\t\t\t\tsynth.beat++;\r\n\t\t\t\t\t\t\tif (synth.beat == song.beatsPerBar) {\r\n\t\t\t\t\t\t\t\t// The bar ended, may need to regenerate synthesizer.\r\n\t\t\t\t\t\t\t\treturn bufferIndex;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// Indicate that the buffer is finished generating.\r\n\t\t\treturn -1;\r\n\t\t`).split(\"\\n\");\r\n\t\t\r\n\t\tprivate static operatorSourceTemplate: string[] = (`\r\n\t\t\t\t\t\tvar channel#Operator$PhaseMix = channel#Operator$Phase/* + channel#Operator@Scaled*/;\r\n\t\t\t\t\t\tvar channel#Operator$PhaseInt = channel#Operator$PhaseMix|0;\r\n\t\t\t\t\t\tvar channel#Operator$Index    = channel#Operator$PhaseInt & ` + Config.sineWaveMask + `;\r\n\t\t\t\t\t\tvar channel#Operator$Sample   = sineWave[channel#Operator$Index];\r\n\t\t\t\t\t\tchannel#Operator$Output       = channel#Operator$Sample + (sineWave[channel#Operator$Index + 1] - channel#Operator$Sample) * (channel#Operator$PhaseMix - channel#Operator$PhaseInt);\r\n\t\t\t\t\t\tvar channel#Operator$Scaled   = channel#Operator$OutputMult * channel#Operator$Output;\r\n\t\t`).split(\"\\n\");\r\n\t\t\r\n\t\tprivate frequencyFromPitch(pitch: number): number {\r\n\t\t\treturn 440.0 * Math.pow(2.0, (pitch - 69.0) / 12.0);\r\n\t\t}\r\n\t\t\r\n\t\tprivate volumeConversion(noteVolume: number): number {\r\n\t\t\treturn Math.pow(noteVolume / 3.0, 1.5);\r\n\t\t}\r\n\t\t\r\n\t\tprivate getSamplesPerArpeggio(): number {\r\n\t\t\tif (this.song == null) return 0;\r\n\t\t\tconst beatsPerMinute: number = this.song.getBeatsPerMinute();\r\n\t\t\tconst beatsPerSecond: number = beatsPerMinute / 60.0;\r\n\t\t\tconst partsPerSecond: number = beatsPerSecond * this.song.partsPerBeat;\r\n\t\t\tconst arpeggioPerSecond: number = partsPerSecond * 4.0;\r\n\t\t\treturn Math.floor(this.samplesPerSecond / arpeggioPerSecond);\r\n\t\t}\r\n\t}\r\n","/*\r\nCopyright (C) 2018 John Nesky\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of \r\nthis software and associated documentation files (the \"Software\"), to deal in \r\nthe Software without restriction, including without limitation the rights to \r\nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \r\nof the Software, and to permit persons to whom the Software is furnished to do \r\nso, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all \r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \r\nSOFTWARE.\r\n*/\r\n\r\nimport { HTML} from \"imperative-html/dist/esm/elements-strict\";\r\nimport { Prompt } from \"./Prompt\";\r\nimport { SongDocument } from \"./SongDocument\";\r\nimport { Synth } from \"../synth/synth\";\r\n\tconst {button, div, input} = HTML;\r\n\r\n\t// function lerp(low: number, high: number, t: number): number {\r\n\t// \treturn low + t * (high - low);\r\n\t// }\r\n\t\r\n\tfunction save(blob: Blob, name: string): void {\r\n\t\tif ((<any>navigator).msSaveOrOpenBlob) {\r\n\t\t\t(<any>navigator).msSaveOrOpenBlob(blob, name);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\r\n\t\tconst anchor: HTMLAnchorElement = document.createElement(\"a\");\r\n\t\tif (anchor.download != undefined) {\r\n\t\t\tconst url: string = URL.createObjectURL(blob);\r\n\t\t\tsetTimeout(function() { URL.revokeObjectURL(url); }, 60000);\r\n\t\t\tanchor.href = url;\r\n\t\t\tanchor.download = name;\r\n\t\t\t// Chrome bug regression: We need to delay dispatching the click\r\n\t\t\t// event. Seems to be related to going back in the browser history.\r\n\t\t\t// https://bugs.chromium.org/p/chromium/issues/detail?id=825100\r\n\t\t\tsetTimeout(function() { anchor.dispatchEvent(new MouseEvent(\"click\")); }, 0);\r\n\t\t} else {\r\n\t\t\tconst url: string = URL.createObjectURL(blob);\r\n\t\t\tsetTimeout(function() { URL.revokeObjectURL(url); }, 60000);\r\n\t\t\tif (!window.open(url, \"_blank\")) window.location.href = url;\r\n\t\t}\r\n\t}\r\n\r\n\texport class ExportPrompt implements Prompt {\r\n\t\tprivate readonly _fileName: HTMLInputElement = input({type: \"text\", style: \"width: 10em;\", value: \"Modbox-Song\", maxlength: 250});\r\n\t\tprivate readonly _enableIntro: HTMLInputElement = input({type: \"checkbox\"});\r\n\t\tprivate readonly _loopDropDown: HTMLInputElement = input({style:\"width: 2em;\", type: \"number\", min: \"1\", max: \"4\", step: \"1\"});\r\n\t\tprivate readonly _enableOutro: HTMLInputElement = input({type: \"checkbox\"});\r\n\t\tprivate readonly _exportWavButton: HTMLButtonElement = button({}, [div(\"Export to .wav file\")]);\r\n\t\tprivate readonly _exportJsonButton: HTMLButtonElement = button({}, [div(\"Export to .json file\")]);\r\n\t\tprivate readonly _cancelButton: HTMLButtonElement = button({}, [div(\"Cancel\")]);\r\n\t\t\r\n\t\tpublic readonly container: HTMLDivElement = div({class: \"prompt\", style: \"width: 200px;\"}, [\r\n\t\t\tdiv({style: \"font-size: 2em\"}, [div(\"Export Options\")]),\r\n\t\t\tdiv({style: \"display: flex; flex-direction: row; align-items: center; justify-content: space-between;\"}, [\r\n\t\t\t\tdiv(\"File name:\"),\r\n\t\t\t\tthis._fileName,\r\n\t\t\t]),\r\n\t\t\tdiv({style: \"display: table; width: 100%;\"}, [\r\n\t\t\t\tdiv({style: \"display: table-row;\"}, [\r\n\t\t\t\t\tdiv({style: \"display: table-cell;\"}, [div(\"Intro:\")]),\r\n\t\t\t\t\tdiv({style: \"display: table-cell;\"}, [div(\"Loop Count:\")]),\r\n\t\t\t\t\tdiv({style: \"display: table-cell;\"}, [div(\"Outro:\")]),\r\n\t\t\t\t]),\r\n\t\t\t\tdiv({style: \"display: table-row;\"}, [\r\n\t\t\t\t\tdiv({style: \"display: table-cell; vertical-align: middle;\"}, [this._enableIntro]),\r\n\t\t\t\t\tdiv({style: \"display: table-cell; vertical-align: middle;\"}, [this._loopDropDown]),\r\n\t\t\t\t\tdiv({style: \"display: table-cell; vertical-align: middle;\"}, [this._enableOutro]),\r\n\t\t\t\t]),\r\n\t\t\t]),\r\n\t\t\tthis._exportWavButton,\r\n\t\t\tthis._exportJsonButton,\r\n\t\t\tthis._cancelButton,\r\n\t\t]);\r\n\t\t\r\n\t\tconstructor(private _doc: SongDocument) {\r\n\t\t\tthis._loopDropDown.value = \"1\";\r\n\t\t\t\r\n\t\t\tif (this._doc.song.loopStart == 0) {\r\n\t\t\t\tthis._enableIntro.checked = false;\r\n\t\t\t\tthis._enableIntro.disabled = true;\r\n\t\t\t} else {\r\n\t\t\t\tthis._enableIntro.checked = true;\r\n\t\t\t\tthis._enableIntro.disabled = false;\r\n\t\t\t}\r\n\t\t\tif (this._doc.song.loopStart + this._doc.song.loopLength == this._doc.song.barCount) {\r\n\t\t\t\tthis._enableOutro.checked = false;\r\n\t\t\t\tthis._enableOutro.disabled = true;\r\n\t\t\t} else {\r\n\t\t\t\tthis._enableOutro.checked = true;\r\n\t\t\t\tthis._enableOutro.disabled = false;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._fileName.addEventListener(\"input\", ExportPrompt._validateFileName);\r\n\t\t\tthis._loopDropDown.addEventListener(\"blur\", ExportPrompt._validateNumber);\r\n\t\t\tthis._exportWavButton.addEventListener(\"click\", this._whenExportToWav);\r\n\t\t\tthis._exportJsonButton.addEventListener(\"click\", this._whenExportToJson);\r\n\t\t\tthis._cancelButton.addEventListener(\"click\", this._close);\r\n\t\t}\r\n\t\t\r\n\t\tprivate _close = (): void => { \r\n\t\t\tthis._doc.undo();\r\n\t\t}\r\n\t\t\r\n\t\tpublic cleanUp = (): void => { \r\n\t\t\tthis._fileName.removeEventListener(\"input\", ExportPrompt._validateFileName);\r\n\t\t\tthis._loopDropDown.removeEventListener(\"blur\", ExportPrompt._validateNumber);\r\n\t\t\tthis._exportWavButton.removeEventListener(\"click\", this._whenExportToWav);\r\n\t\t\tthis._exportJsonButton.removeEventListener(\"click\", this._whenExportToJson);\r\n\t\t\tthis._cancelButton.removeEventListener(\"click\", this._close);\r\n\t\t}\r\n\t\t\r\n\t\tprivate static _validateFileName(event: Event): void {\r\n\t\t\tconst input: HTMLInputElement = <HTMLInputElement>event.target;\r\n\t\t\tconst deleteChars = /[\\+\\*\\$\\?\\|\\{\\}\\\\\\/<>#%!`&'\"=:@]/gi;\r\n\t\t\tif (deleteChars.test(input.value)) {\r\n\t\t\t\tlet cursorPos: number = <number>input.selectionStart;\r\n\t\t\t\tinput.value = input.value.replace(deleteChars, \"\");\r\n\t\t\t\tcursorPos--;\r\n\t\t\t\tinput.setSelectionRange(cursorPos, cursorPos);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tprivate static _validateNumber(event: Event): void {\r\n\t\t\tconst input: HTMLInputElement = <HTMLInputElement>event.target;\r\n\t\t\tinput.value = Math.floor(Math.max(Number(input.min), Math.min(Number(input.max), Number(input.value)))) + \"\";\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenExportToWav = (): void => {\r\n\t\t\t\r\n\t\t\tconst synth: Synth = new Synth(this._doc.song)\r\n\t\t\tsynth.enableIntro = this._enableIntro.checked;\r\n\t\t\tsynth.enableOutro = this._enableOutro.checked;\r\n\t\t\tsynth.loopCount = Number(this._loopDropDown.value);\r\n\t\t\tif (!synth.enableIntro) {\r\n\t\t\t\tfor (let introIter: number = 0; introIter < this._doc.song.loopStart; introIter++) {\r\n\t\t\t\t\tsynth.nextBar();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tconst sampleFrames: number = synth.totalSamples;\r\n\t\t\tconst recordedSamplesLeft: Float32Array = new Float32Array(sampleFrames);\r\n\t\t\tconst recordedSamplesRight: Float32Array = new Float32Array(sampleFrames);\r\n\t\t\t//const timer: number = performance.now();\r\n\t\t\tsynth.synthesize(recordedSamplesLeft, recordedSamplesRight, sampleFrames);\r\n\t\t\t//console.log(\"export timer\", (performance.now() - timer) / 1000.0);\r\n\t\t\t\r\n\t\t\tconst srcChannelCount: number = 2;\r\n\t\t\tconst wavChannelCount: number = 2;\r\n\t\t\t// const sampleRate: number = 44100;\r\n\t\t\tconst sampleRate: number = synth.samplesPerSecond;\r\n\t\t\tconst bytesPerSample: number = 2;\r\n\t\t\tconst bitsPerSample: number = 8 * bytesPerSample;\r\n\t\t\tconst sampleCount: number = wavChannelCount * sampleFrames;\r\n\t\t\t\r\n\t\t\tconst totalFileSize: number = 44 + sampleCount * bytesPerSample;\r\n\t\t\t\r\n\t\t\tlet index: number = 0;\r\n\t\t\tconst arrayBuffer: ArrayBuffer = new ArrayBuffer(totalFileSize);\r\n\t\t\tconst data: DataView = new DataView(arrayBuffer);\r\n\t\t\tdata.setUint32(index, 0x52494646, false); index += 4;\r\n\t\t\tdata.setUint32(index, 36 + sampleCount * bytesPerSample, true); index += 4; // size of remaining file\r\n\t\t\tdata.setUint32(index, 0x57415645, false); index += 4;\r\n\t\t\tdata.setUint32(index, 0x666D7420, false); index += 4;\r\n\t\t\tdata.setUint32(index, 0x00000010, true); index += 4; // size of following header\r\n\t\t\tdata.setUint16(index, 0x0001, true); index += 2; // not compressed\r\n\t\t\tdata.setUint16(index, wavChannelCount, true); index += 2; // channel count\r\n\t\t\tdata.setUint32(index, sampleRate, true); index += 4; // sample rate\r\n\t\t\tdata.setUint32(index, sampleRate * bytesPerSample * wavChannelCount, true); index += 4; // bytes per second\r\n\t\t\tdata.setUint16(index, bytesPerSample, true); index += 2; // sample rate\r\n\t\t\tdata.setUint16(index, bitsPerSample, true); index += 2; // sample rate\r\n\t\t\tdata.setUint32(index, 0x64617461, false); index += 4;\r\n\t\t\tdata.setUint32(index, sampleCount * bytesPerSample, true); index += 4;\r\n\t\t\tlet stride: number;\r\n\t\t\tlet repeat: number;\r\n\t\t\tif (srcChannelCount == wavChannelCount) {\r\n\t\t\t\tstride = 1;\r\n\t\t\t\trepeat = 1;\r\n\t\t\t} else {\r\n\t\t\t\tstride = srcChannelCount;\r\n\t\t\t\trepeat = wavChannelCount;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tlet valLeft: number;\r\n\t\t\tlet valRight: number;\r\n\t\t\tif (bytesPerSample > 1) {\r\n\t\t\t\t// usually samples are signed. \r\n\t\t\t\tfor (let i: number = 0; i < sampleFrames; i++) {\r\n\t\t\t\t\tvalLeft = Math.floor(recordedSamplesLeft[i * stride] * ((1 << (bitsPerSample - 1)) - 1));\r\n\t\t\t\t\tvalRight = Math.floor(recordedSamplesRight[i * stride] * ((1 << (bitsPerSample - 1)) - 1));\r\n\t\t\t\t\tfor (let k: number = 0; k < repeat; k++) {\r\n\t\t\t\t\t\tif (bytesPerSample == 2) {\r\n\t\t\t\t\t\t\tdata.setInt16(index, valLeft, true); index += 2;\r\n\t\t\t\t\t\t\tdata.setInt16(index, valRight, true); index += 2;\r\n\t\t\t\t\t\t} else if (bytesPerSample == 4) {\r\n\t\t\t\t\t\t\tdata.setInt32(index, valLeft, true); index += 4;\r\n\t\t\t\t\t\t\tdata.setInt32(index, valRight, true); index += 4;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthrow new Error(\"unsupported sample size\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t// 8 bit samples are a special case: they are unsigned.\r\n\t\t\t\tfor (let i: number = 0; i < sampleFrames; i++) {\r\n\t\t\t\t\tvalLeft = Math.floor(recordedSamplesLeft[i*stride] * 127 + 128);\r\n\t\t\t\t\tvalRight = Math.floor(recordedSamplesRight[i*stride] * 127 + 128);\r\n\t\t\t\t\tfor (let k: number = 0; k < repeat; k++) {\r\n\t\t\t\t\t\tdata.setUint8(index, valLeft > 255 ? 255 : (valLeft < 0 ? 0 : valLeft)); index++;\r\n\t\t\t\t\t\tdata.setUint8(index, valRight > 255 ? 255 : (valRight < 0 ? 0 : valRight)); index++;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tconst blob = new Blob([arrayBuffer], {type: \"audio/wav\"});\r\n\t\t\tsave(blob, this._fileName.value.trim() + \".wav\");\r\n\t\t\t\r\n\t\t\tthis._close();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenExportToJson = (): void => {\r\n\t\t\tconst jsonObject: Object = this._doc.song.toJsonObject(this._enableIntro.checked, Number(this._loopDropDown.value), this._enableOutro.checked);\r\n\t\t\tconst jsonString: string = JSON.stringify(jsonObject, null, '\\t');\r\n\t\t\tconst blob = new Blob([jsonString], {type: \"application/json\"});\r\n\t\t\tsave(blob, this._fileName.value.trim() + \".json\");\r\n\t\t\tthis._close();\r\n\t\t}\r\n\t}\r\n\r\n","/*\r\nCopyright (C) 2018 John Nesky\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of \r\nthis software and associated documentation files (the \"Software\"), to deal in \r\nthe Software without restriction, including without limitation the rights to \r\nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \r\nof the Software, and to permit persons to whom the Software is furnished to do \r\nso, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all \r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \r\nSOFTWARE.\r\n*/\r\n\r\nimport { HTML } from \"imperative-html/dist/esm/elements-strict\";\r\nimport { Prompt } from \"./Prompt\";\r\nimport { SongDocument } from \"./SongDocument\";\r\nimport { ChangeSong } from \"./changes\";\r\n\tconst {button, div, input} = HTML;\r\n\r\n\r\n\texport class ImportPrompt implements Prompt {\r\n\t\tprivate readonly _fileInput: HTMLInputElement = input({type: \"file\", accept: \".json,application/json\"});\r\n\t\tprivate readonly _cancelButton: HTMLButtonElement = button({}, [div(\"Cancel\")]);\r\n\t\t\r\n\t\tpublic readonly container: HTMLDivElement = div({class: \"prompt\", style: \"width: 200px;\"}, [\r\n\t\t\tdiv({style: \"font-size: 2em\"}, [div(\"Import\")]),\r\n\t\t\tdiv({style: \"text-align: left;\"}, [div(\"BeepBox songs can be exported and re-imported as .json files. You could also use other means to make .json files for BeepBox as long as they follow the same structure.\")]),\r\n\t\t\tthis._fileInput,\r\n\t\t\tthis._cancelButton,\r\n\t\t]);\r\n\t\t\r\n\t\tconstructor(private _doc: SongDocument) {\r\n\t\t\tthis._fileInput.addEventListener(\"change\", this._whenFileSelected);\r\n\t\t\tthis._cancelButton.addEventListener(\"click\", this._close);\r\n\t\t}\r\n\t\t\r\n\t\tprivate _close = (): void => { \r\n\t\t\tthis._doc.undo();\r\n\t\t}\r\n\t\t\r\n\t\tpublic cleanUp = (): void => { \r\n\t\t\tthis._fileInput.removeEventListener(\"change\", this._whenFileSelected);\r\n\t\t\tthis._cancelButton.removeEventListener(\"click\", this._close);\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenFileSelected = (): void => {\r\n\t\t\tconst file: File = this._fileInput.files![0];\r\n\t\t\tif (!file) return;\r\n\t\t\t\r\n\t\t\tconst reader: FileReader = new FileReader();\r\n\t\t\treader.addEventListener(\"load\", (event: Event): void => {\r\n\t\t\t\tthis._doc.prompt = null;\r\n\t\t\t\tthis._doc.record(new ChangeSong(this._doc, <string>reader.result), true);\r\n\t\t\t});\r\n\t\t\treader.readAsText(file);\r\n\t\t}\r\n\t}\r\n\r\n","/*\r\nCopyright (C) 2018 John Nesky\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of \r\nthis software and associated documentation files (the \"Software\"), to deal in \r\nthe Software without restriction, including without limitation the rights to \r\nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \r\nof the Software, and to permit persons to whom the Software is furnished to do \r\nso, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all \r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \r\nSOFTWARE.\r\n*/\r\n\r\nimport { HTML } from \"imperative-html/dist/esm/elements-strict\";\r\nimport { Prompt } from \"./Prompt\";\r\nimport { SongDocument } from \"./SongDocument\";\r\n\r\n\tconst {button, div, a} = HTML;\r\n\texport class ArchivePrompt implements Prompt {\r\n\t\tprivate readonly _cancelButton: HTMLButtonElement = button({}, div(\"No thanks!\"));\r\n\t\t\r\n\t\tpublic readonly container: HTMLDivElement = div({class: \"prompt\", style: \"width: 250px;\"}, \r\n\t\t\tdiv({ style: \"font-size: 2em\" }, div(\"Archives\")),\r\n\t\t\tdiv({ style: \"text-align: center;\" }, div('These are the Archives. Below are previous versions of Modded Beepbox/Sandbox that you are able to play around with, changelog included. Go nuts!')),\r\n\t\t\tdiv({ style: \"text-align: center;\" }, \r\n\t\t\t\ta({ target: \"_blank\", href: \"https://moddedbeepbox.github.io/beta/mb-archives/1.3.0.htm\" }, div(\"MB 1.3.0\")), div(\" | \"),\r\n\t\t\t\ta({ target: \"_blank\", href: \"https://moddedbeepbox.github.io/beta/mb-archives/1.6.0.htm\" }, div(\"MB 1.6.0\")), div(\" | \"),\r\n\t\t\t\ta({ target: \"_blank\", href: \"https://moddedbeepbox.github.io/beta/mb-archives/1.9.1.htm\" }, div(\"MB 1.9.1\")), div(\" | \"),\r\n\t\t\t\ta({ target: \"_blank\", href: \"https://moddedbeepbox.github.io/beta/mb-archives/2.0.0.htm\" }, div(\"MB v2.0.0\")), div(\" | \"),\r\n\t\t\t\ta({ target: \"_blank\", href: \"https://moddedbeepbox.github.io/beta/mb-archives/2.3.0.htm\" }, div(\"MB v2.2.2\")), div(\" | \"),\r\n\t\t\t\ta({ target: \"_blank\", href: \"https://moddedbeepbox.github.io/beta/mb-archives/2.3.html\" }, div(\"MB v2.3.0\")), div(\" | \"),\r\n\t\t\t\ta({ target: \"_blank\", href: \"https://moddedbeepbox.github.io/beta/mb-archives/3.0.html\" }, div(\"MB v3.0.3\")), div(\" | \"),\r\n\t\t\t\ta({ target: \"_blank\", href: \"https://moddedbeepbox.github.io/beta/sb-archives/1.2.1.htm\" }, div(\"SB v1.2.1\")), div(\" | \"),\r\n\t\t\t\ta({ target: \"_blank\", href: \"https://moddedbeepbox.github.io/beta/sb-archives/1.3.0.htm\" }, div(\"SB v1.3.0\")), div(\" | \"),\r\n\t\t\t\ta({ target: \"_blank\", href: \"https://moddedbeepbox.github.io/beta/sb-archives/1.4.0.htm\" }, div(\"SB v1.4.0\")), div(\" | \"),\r\n\t\t\t\ta({ target: \"_blank\", href: \"https://moddedbeepbox.github.io/beta/sb-archives/2.0.6.1.htm\" }, div(\"SB v2.0.6.1\")), div(\" | \"),\r\n\t\t\t\ta({ target: \"_blank\", href: \"https://moddedbeepbox.github.io/beta/sb-archives/2.1.3.htm\" }, div(\"SB v2.1.3\")), div(\" | \"),\r\n\t\t\t\ta({ target: \"_blank\", href: \"https://moddedbeepbox.github.io/beta/sb-archives/3.0.0.htm\" }, div(\"SB v3.0.0\")), div(\" | \"),\r\n\t\t\t\ta({ target: \"_blank\", href: \"https://moddedbeepbox.github.io/beta/changelogs/mbchangelog.html\" }, div(\"Changelog\")),\r\n\t\t\t),\r\n\t\t\tthis._cancelButton,\r\n\t\t);\r\n\r\n\t\t\tconstructor(private _doc: SongDocument) {\r\n\t\t\t\tthis._cancelButton.addEventListener(\"click\", this._close);\r\n\t\t\t}\r\n\t\t\tprivate _close = (): void => { \r\n\t\t\t\tthis._doc.undo();\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tpublic cleanUp = (): void => { \r\n\t\t\t\tthis._cancelButton.removeEventListener(\"click\", this._close);\r\n            };\r\n    }\r\n","/*\r\nCopyright (C) 2018 John Nesky\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of \r\nthis software and associated documentation files (the \"Software\"), to deal in \r\nthe Software without restriction, including without limitation the rights to \r\nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \r\nof the Software, and to permit persons to whom the Software is furnished to do \r\nso, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all \r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \r\nSOFTWARE.\r\n*/\r\n\r\nimport { HTML } from \"imperative-html/dist/esm/elements-strict\";\r\nimport { SongDocument } from \"./SongDocument\";\r\nimport { Prompt } from \"./Prompt\";\r\n\tconst {button, div} = HTML;\r\n\r\n\texport class SongDataPrompt implements Prompt {\r\n\t\tprivate readonly _cancelButton: HTMLButtonElement = button({}, [div(\"Close\")]);\r\n\t\t\r\n\t\tpublic readonly container: HTMLDivElement = div({class: \"prompt\", style: \"width: 250px;\"}, [\r\n                div({ style: \"font-size: 2em\" }, [div(\"Song Data\")]),\r\n\t\t\t\tdiv({ style: \"text-align: left;\" }, [div('You are on update Modbox 3.3.0-B_1.')]),\r\n\t\t\t\tdiv({ style: \"text-align: left;\" }, [div('Your song is ' + this._doc.synth.totalSeconds + ' seconds long.')]),\r\n\t\t\t\tdiv({ style: \"text-align: left;\" }, [div('Your song runs at ' + this._doc.song.getBeatsPerMinute() + ' beats per minute.')]),\r\n\t\t\t\tdiv({ style: \"text-align: left;\" }, [div('There are currently ' + this._doc.song.getChannelUnusedCount() + ' unused channels in your song out of 16.')]),\r\n\t\t\t\tdiv({ style: \"text-align: left;\" }, [div(this._doc.song.setSongTheme == \"none\" ? 'You are using your personal theme.' :'Your are using the ' + this._doc.song.setSongTheme + ' theme.')]),\r\n\t\t\t\tdiv({ style: \"text-align: left;\" }, [div('Your time signuature is ' + this._doc.song.getTimeSig())]),\r\n\t\t\t\tdiv({ style: \"text-align: left;\" }, [div('Your scale is ' + this._doc.song.getScaleNKey() + '.')]),\r\n\t\t\tthis._cancelButton,\r\n         ]);\r\n\r\n\t\t\tconstructor(private _doc: SongDocument) {\r\n\t\t\t\tthis._cancelButton.addEventListener(\"click\", this._close);\r\n\t\t\t}\r\n\t\t\tprivate _close = (): void => { \r\n\t\t\t\tthis._doc.undo();\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tpublic cleanUp = (): void => { \r\n\t\t\t\tthis._cancelButton.removeEventListener(\"click\", this._close);\r\n            };\r\n    }\r\n","/*\r\nCopyright (C) 2018 John Nesky\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of \r\nthis software and associated documentation files (the \"Software\"), to deal in \r\nthe Software without restriction, including without limitation the rights to \r\nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \r\nof the Software, and to permit persons to whom the Software is furnished to do \r\nso, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all \r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \r\nSOFTWARE.\r\n*/\r\n\r\nimport { HTML } from \"imperative-html/dist/esm/elements-strict\";\r\nimport { SongDocument } from \"./SongDocument\";\r\nimport { Prompt } from \"./Prompt\";\r\nimport { SongEditor } from \"./SongEditor\";\r\nimport { ChangeKey } from \"./changes\";\r\n\tconst {button, div} = HTML;\r\n\texport class RefreshKeyPrompt implements Prompt {\r\n\t\tprivate readonly _refreshButton: HTMLButtonElement = button({}, [div(\"Refresh\")]);\r\n\t\t\r\n\t\tpublic readonly container: HTMLDivElement = div({class: \"prompt\", style: \"width: 200px;\"}, [\r\n\t\t\tdiv({style: \"font-size: 1em\"}, [div(\"Refresh\")]),\r\n\t\t\tdiv({style: \"text-align: left; margin: 0.5em 0;\"}, [\r\n\t\t\t\tdiv(\"Due to you using the Piano theme, you will need to refresh to display the change in key colors.\")]),\r\n\t\t\tdiv({style: \"text-align: left; margin: 0.5em 0;\"}, [\r\n\t\t\t\tdiv(\"You must refresh to continue.\")]),\r\n            this._refreshButton,\r\n         ]);\r\n\r\n\t\t\tconstructor(private _doc: SongDocument, private _songEditor: SongEditor, private _newKeyValue: number) {\r\n\t\t\t\tthis._refreshButton.addEventListener(\"click\", this._saveChangesAndRefresh);\r\n\t\t\t}\r\n\r\n\t\t\tprivate _saveChangesAndRefresh = (): void => {\r\n\t\t\t\tthis._doc.prompt = null;\r\n\t\t\t\tthis._doc.record(new ChangeKey(this._doc, this._newKeyValue));\r\n\t\t\t\tthis._songEditor.refreshNow();\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tpublic cleanUp = (): void => { \r\n\t\t\t\tthis._refreshButton.addEventListener(\"click\", this._saveChangesAndRefresh);\r\n            };\r\n    }\r\n","/*\r\nCopyright (C) 2018 John Nesky\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of \r\nthis software and associated documentation files (the \"Software\"), to deal in \r\nthe Software without restriction, including without limitation the rights to \r\nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \r\nof the Software, and to permit persons to whom the Software is furnished to do \r\nso, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all \r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \r\nSOFTWARE.\r\n*/\r\n\r\nimport { HTML } from \"imperative-html/dist/esm/elements-strict\";\r\nimport { SongDocument } from \"./SongDocument\";\r\nimport { Prompt } from \"./Prompt\";\r\nimport { Config } from \"../synth/SynthConfig\";\r\nimport { ChangeGroup } from \"./Change\";\r\nimport { ChangeBeatsPerBar, ChangeBarCount, ChangePatternsPerChannel, ChangeInstrumentsPerChannel, ChangeChannelCount } from \"./changes\";\r\n\tconst {button, div, input, span} = HTML;\r\n\t\r\n\texport class SongDurationPrompt implements Prompt {\r\n\t\tprivate readonly _beatsStepper: HTMLInputElement = input({style: \"width: 3em; margin-left: 1em;\", type: \"number\", step: \"1\"});\r\n\t\tprivate readonly _barsStepper: HTMLInputElement = input({style: \"width: 3em; margin-left: 1em;\", type: \"number\", step: \"1\"});\r\n\t\tprivate readonly _patternsStepper: HTMLInputElement = input({style: \"width: 3em; margin-left: 1em;\", type: \"number\", step: \"1\"});\r\n\t\tprivate readonly _instrumentsStepper: HTMLInputElement = input({style: \"width: 3em; margin-left: 1em;\", type: \"number\", step: \"1\"});\r\n\t\tprivate readonly _pitchChannelStepper: HTMLInputElement = input({style: \"width: 3em; margin-left: 1em;\", type: \"number\", step: \"1\"});\r\n\t\tprivate readonly _drumChannelStepper: HTMLInputElement = input({style: \"width: 3em; margin-left: 1em;\", type: \"number\", step: \"1\"});\r\n\t\tprivate readonly _okayButton: HTMLButtonElement = button({style: \"width:45%;\"}, [div(\"Okay\")]);\r\n\t\tprivate readonly _cancelButton: HTMLButtonElement = button({style: \"width:45%;\"}, [div(\"Cancel\")]);\r\n\t\t\r\n\t\tpublic readonly container: HTMLDivElement = div({class: \"prompt\", style: \"width: 250px;\"}, [\r\n\t\t\tdiv({style: \"font-size: 2em\"}, [div(\"Custom Song Size\")]),\r\n\t\t\tdiv({style: \"display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;\"}, [\r\n\t\t\t\tdiv({style: \"text-align: right;\"}, [\r\n\t\t\t\t\tdiv(\"Beats per bar:\"),\r\n\t\t\t\t\tspan({style: \"font-size: smaller; color: #888888;\"}, [div(\"(Multiples of 3 or 4 are recommended)\")]),\r\n\t\t\t\t]),\r\n\t\t\t\tthis._beatsStepper,\r\n\t\t\t]),\r\n\t\t\tdiv({style: \"display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;\"}, [\r\n\t\t\t\tdiv({style: \"display: inline-block; text-align: right;\"}, [\r\n\t\t\t\t\tdiv(\"Bars per song:\"),\r\n\t\t\t\t\tspan({style: \"font-size: smaller; color: #888888;\"}, [div(\"(Multiples of 2 or 4 are recommended)\")]),\r\n\t\t\t\t]),\r\n\t\t\t\tthis._barsStepper,\r\n\t\t\t]),\r\n\t\t\tdiv({style: \"display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;\"}, [\r\n\t\t\t\tdiv(\"Patterns per channel:\"),\r\n\t\t\t\tthis._patternsStepper,\r\n\t\t\t]),\r\n\t\t\tdiv({style: \"display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;\"}, [\r\n\t\t\t\tdiv(\"Instruments per channel:\"),\r\n\t\t\t\tthis._instrumentsStepper,\r\n\t\t\t]),\r\n\t\t\tdiv({style: \"display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;\"}, [\r\n\t\t\t\tdiv(\"Number of pitch channels:\"),\r\n\t\t\t\tthis._pitchChannelStepper,\r\n\t\t\t]),\r\n\t\t\tdiv({style: \"display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;\"}, [\r\n\t\t\t\tdiv(\"Number of drum channels:\"),\r\n\t\t\t\tthis._drumChannelStepper,\r\n\t\t\t]),\r\n\t\t\tdiv({style: \"display: flex; flex-direction: row; justify-content: space-between;\"}, [\r\n\t\t\t\tthis._okayButton,\r\n\t\t\t\tthis._cancelButton,\r\n\t\t\t]),\r\n\t\t]);\r\n\t\t\r\n\t\tconstructor(private _doc: SongDocument) {\r\n\t\t\tthis._beatsStepper.value = this._doc.song.beatsPerBar + \"\";\r\n\t\t\tthis._beatsStepper.min = Config.beatsPerBarMin + \"\";\r\n\t\t\tthis._beatsStepper.max = Config.beatsPerBarMax + \"\";\r\n\t\t\t\r\n\t\t\tthis._barsStepper.value = this._doc.song.barCount + \"\";\r\n\t\t\tthis._barsStepper.min = Config.barCountMin + \"\";\r\n\t\t\tthis._barsStepper.max = Config.barCountMax + \"\";\r\n\t\t\t\r\n\t\t\tthis._patternsStepper.value = this._doc.song.patternsPerChannel + \"\";\r\n\t\t\tthis._patternsStepper.min = Config.patternsPerChannelMin + \"\";\r\n\t\t\tthis._patternsStepper.max = Config.patternsPerChannelMax + \"\";\r\n\t\t\t\r\n\t\t\tthis._instrumentsStepper.value = this._doc.song.instrumentsPerChannel + \"\";\r\n\t\t\tthis._instrumentsStepper.min = Config.instrumentsPerChannelMin + \"\";\r\n\t\t\tthis._instrumentsStepper.max = Config.instrumentsPerChannelMax + \"\";\r\n\t\t\t\r\n\t\t\tthis._pitchChannelStepper.value = this._doc.song.pitchChannelCount + \"\";\r\n\t\t\tthis._pitchChannelStepper.min = Config.pitchChannelCountMin + \"\";\r\n\t\t\tthis._pitchChannelStepper.max = Config.pitchChannelCountMax + \"\";\r\n\t\t\t\r\n\t\t\tthis._drumChannelStepper.value = this._doc.song.drumChannelCount + \"\";\r\n\t\t\tthis._drumChannelStepper.min = Config.drumChannelCountMin + \"\";\r\n\t\t\tthis._drumChannelStepper.max = Config.drumChannelCountMax + \"\";\r\n\t\t\t\r\n\t\t\tthis._okayButton.addEventListener(\"click\", this._saveChanges);\r\n\t\t\tthis._cancelButton.addEventListener(\"click\", this._close);\r\n\t\t\tthis._beatsStepper.addEventListener(\"keypress\", SongDurationPrompt._validateKey);\r\n\t\t\tthis._barsStepper.addEventListener(\"keypress\", SongDurationPrompt._validateKey);\r\n\t\t\tthis._patternsStepper.addEventListener(\"keypress\", SongDurationPrompt._validateKey);\r\n\t\t\tthis._instrumentsStepper.addEventListener(\"keypress\", SongDurationPrompt._validateKey);\r\n\t\t\tthis._pitchChannelStepper.addEventListener(\"keypress\", SongDurationPrompt._validateKey);\r\n\t\t\tthis._drumChannelStepper.addEventListener(\"keypress\", SongDurationPrompt._validateKey);\r\n\t\t\tthis._beatsStepper.addEventListener(\"blur\", SongDurationPrompt._validateNumber);\r\n\t\t\tthis._barsStepper.addEventListener(\"blur\", SongDurationPrompt._validateNumber);\r\n\t\t\tthis._patternsStepper.addEventListener(\"blur\", SongDurationPrompt._validateNumber);\r\n\t\t\tthis._instrumentsStepper.addEventListener(\"blur\", SongDurationPrompt._validateNumber);\r\n\t\t\tthis._pitchChannelStepper.addEventListener(\"blur\", SongDurationPrompt._validateNumber);\r\n\t\t\tthis._drumChannelStepper.addEventListener(\"blur\", SongDurationPrompt._validateNumber);\r\n\t\t}\r\n\t\t\r\n\t\tprivate _close = (): void => { \r\n\t\t\tthis._doc.undo();\r\n\t\t}\r\n\t\t\r\n\t\tpublic cleanUp = (): void => { \r\n\t\t\tthis._okayButton.removeEventListener(\"click\", this._saveChanges);\r\n\t\t\tthis._cancelButton.removeEventListener(\"click\", this._close);\r\n\t\t\tthis._beatsStepper.removeEventListener(\"keypress\", SongDurationPrompt._validateKey);\r\n\t\t\tthis._barsStepper.removeEventListener(\"keypress\", SongDurationPrompt._validateKey);\r\n\t\t\tthis._patternsStepper.removeEventListener(\"keypress\", SongDurationPrompt._validateKey);\r\n\t\t\tthis._instrumentsStepper.removeEventListener(\"keypress\", SongDurationPrompt._validateKey);\r\n\t\t\tthis._pitchChannelStepper.removeEventListener(\"keypress\", SongDurationPrompt._validateKey);\r\n\t\t\tthis._drumChannelStepper.removeEventListener(\"keypress\", SongDurationPrompt._validateKey);\r\n\t\t\tthis._beatsStepper.removeEventListener(\"blur\", SongDurationPrompt._validateNumber);\r\n\t\t\tthis._barsStepper.removeEventListener(\"blur\", SongDurationPrompt._validateNumber);\r\n\t\t\tthis._patternsStepper.removeEventListener(\"blur\", SongDurationPrompt._validateNumber);\r\n\t\t\tthis._instrumentsStepper.removeEventListener(\"blur\", SongDurationPrompt._validateNumber);\r\n\t\t\tthis._pitchChannelStepper.removeEventListener(\"blur\", SongDurationPrompt._validateNumber);\r\n\t\t\tthis._drumChannelStepper.removeEventListener(\"blur\", SongDurationPrompt._validateNumber);\r\n\t\t}\r\n\t\t\r\n\t\tprivate static _validateKey(event: KeyboardEvent): boolean {\r\n\t\t\tconst charCode = (event.which) ? event.which : event.keyCode;\r\n\t\t\tif (charCode != 46 && charCode > 31 && (charCode < 48 || charCode > 57)) {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t\r\n\t\tprivate static _validateNumber(event: Event): void {\r\n\t\t\tconst input: HTMLInputElement = <HTMLInputElement>event.target;\r\n\t\t\tinput.value = Math.floor(Math.max(Number(input.min), Math.min(Number(input.max), Number(input.value)))) + \"\";\r\n\t\t}\r\n\t\t\r\n\t\tprivate static _validate(input: HTMLInputElement): number {\r\n\t\t\treturn Math.floor(Number(input.value));\r\n\t\t}\r\n\t\t\r\n\t\tprivate _saveChanges = (): void => {\r\n\t\t\tconst group: ChangeGroup = new ChangeGroup();\r\n\t\t\tgroup.append(new ChangeBeatsPerBar(this._doc, SongDurationPrompt._validate(this._beatsStepper)));\r\n\t\t\tgroup.append(new ChangeBarCount(this._doc, SongDurationPrompt._validate(this._barsStepper)));\r\n\t\t\tgroup.append(new ChangePatternsPerChannel(this._doc, SongDurationPrompt._validate(this._patternsStepper)));\r\n\t\t\tgroup.append(new ChangeInstrumentsPerChannel(this._doc, SongDurationPrompt._validate(this._instrumentsStepper)));\r\n\t\t\tgroup.append(new ChangeChannelCount(this._doc, SongDurationPrompt._validate(this._pitchChannelStepper), SongDurationPrompt._validate(this._drumChannelStepper)));\r\n\t\t\tthis._doc.prompt = null;\r\n\t\t\tthis._doc.record(group, true);\r\n\t\t}\r\n\t}\r\n\r\n","/*\r\nCopyright (C) 2018 John Nesky\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of \r\nthis software and associated documentation files (the \"Software\"), to deal in \r\nthe Software without restriction, including without limitation the rights to \r\nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \r\nof the Software, and to permit persons to whom the Software is furnished to do \r\nso, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all \r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \r\nSOFTWARE.\r\n*/\r\n\r\nimport { HTML} from \"imperative-html/dist/esm/elements-strict\";\r\nimport { Prompt } from \"./Prompt\";\r\nimport { SongDocument } from \"./SongDocument\";\r\n\tconst {button, div, a} = HTML;\r\n\r\n\texport class InstrumentTypePrompt implements Prompt {\r\n\t\tprivate readonly _cancelButton: HTMLButtonElement = button({}, [div(\"Close\")]);\r\n\t\t\r\n\t\tpublic readonly container: HTMLDivElement = div({class: \"prompt\", style: \"width: 300px;\"}, [\r\n\t\t\tdiv({style: \"font-size: 2em\"}, [div(\"FM Synthesis\")]),\r\n\t\t\tdiv({ style: \"text-align: left; margin: 0.5em 0;\" }, [\r\n\t\t\t\tdiv('Popularized by the Sega Genesis and Yamaha keyboards, FM Synthesis is a mysterious but powerful technique for crafting sounds. It may seem confusing, but just play around with the options until you get a feel for it, check out some examples in '),\r\n\t\t\t\ta( { target: \"_blank\", href: \"#6n10s0kbl00e07t5m0a7g07j7i7r1o2T1d2c0A0F1B0V1Q0200Pff00E0411T1d1c0A0F0B0V1Q2800Pf700E0711T1d2c0A0F1B4VaQ0200Pfb00E0911T1d1c2A0F9B3V1Q1000Pfbc0E0191T1d2c0AcF8B5V1Q0259PffffE0000T1d3c1AcF4B5V4Q2600Pff00E0011T1d1c0AbF0B0V1Q2580PfffaE2226T1d1c0A1F0B0V1Q520dPff4dEd41eb4zhmu0p21h5dfxd7ij7XrjfiAjPudUTtUSRsTzudTudJvdUTztTzrpPudUTtUSSYTzudTudJTdUTztTzrvPudUTtUSQ\" }, [div(\"this demo\")]),\r\n\t\t\t\tdiv(\", or find some instruments to use in the Beepbox Discord's FM sheet \"),\r\n\t\t\t\ta( { target: \"_blank\", href: \"https://docs.google.com/spreadsheets/d/1ddbXnrP7yvv5X4oUur9boi3AxcI-Xxz1XIHIAo-wi0s/edit#gid=230623845\" }, [div(\"right here\")]),\r\n\t\t\t\tdiv(\".\")\r\n\t\t\t]),\r\n\t\t\tdiv({style: \"text-align: left; margin: 0.5em 0;\"}, [div(\r\n\t\t\t\t'This FM instrument uses up to four waves, numbered 1, 2, 3, and 4. ' +\r\n\t\t\t\t'Each wave may have its own frequency, volume, and volume envelope to control its effect over time. '\r\n\t\t\t)]),\r\n\t\t\tdiv({style: \"text-align: left; margin: 0.5em 0;\"}, [div(\r\n\t\t\t\t'There are two kinds of waves: \"carrier\" waves play a tone out loud, but \"modulator\" waves distort other waves instead. ' +\r\n\t\t\t\t'Wave 1 is always a carrier and plays a tone, but other waves may distort it. ' +\r\n\t\t\t\t'The \"Algorithm\" setting determines which waves are modulators, and which other waves those modulators distort. '\r\n\t\t\t)]),\r\n\t\t\tdiv({style: \"text-align: left; margin: 0.5em 0;\"}, [div(\r\n\t\t\t\t'Modulators distort in one direction (like 1←2), but you can also use \"Feedback\" to make any wave distort in the opposite direction (1→2), in both directions (1🗘2), or even itself (1⟲). '\r\n\t\t\t)]),\r\n\t\t\tdiv({style: \"text-align: left; margin: 0.5em 0;\"}, [div(\r\n\t\t\t\t'You can set the pitch of each wave independently by adding simultaneous notes, one above another. This often sounds harsh or dissonant, but can make cool sound effects! '\r\n\t\t\t)]),\r\n\t\t\tthis._cancelButton,\r\n\t\t]);\r\n\t\t\r\n\t\tconstructor(private _doc: SongDocument) {\r\n\t\t\tthis._cancelButton.addEventListener(\"click\", this._close);\r\n\t\t}\r\n\t\t\r\n\t\tprivate _close = (): void => { \r\n\t\t\tthis._doc.undo();\r\n\t\t}\r\n\t\t\r\n\t\tpublic cleanUp = (): void => { \r\n\t\t\tthis._cancelButton.removeEventListener(\"click\", this._close);\r\n\t\t}\r\n\t}\r\n\r\n","/*\r\nCopyright (C) 2018 John Nesky\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of \r\nthis software and associated documentation files (the \"Software\"), to deal in \r\nthe Software without restriction, including without limitation the rights to \r\nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \r\nof the Software, and to permit persons to whom the Software is furnished to do \r\nso, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all \r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \r\nSOFTWARE.\r\n*/\r\n\r\nimport { HTML } from \"imperative-html/dist/esm/elements-strict\";\r\nimport { SongDocument } from \"./SongDocument\";\r\nimport { Prompt } from \"./Prompt\";\r\nimport { ColorConfig } from \"./ColorConfig\"; \r\n\tconst {button, div, form, label, input } = HTML;\r\n\r\n\texport class ThemePrompt implements Prompt {\r\n\t\tpublic hasChanged = false;\r\n\t\tprivate readonly _closeButton: HTMLButtonElement = button({style:\"flex: 1; width: 0;\"},\"Close\");\r\n\t\tprivate readonly _previewButton: HTMLButtonElement = button({style:\"flex: 1; width: 0;\"},\"Preview\");\r\n\t\tprivate readonly _previewText: HTMLDivElement = div({style:\"opacity: 0; position:absolute; left: 8px; top: 24px; font-size: 32px; font-weight:bold;\"},\"Previewing...\")\r\n\t\tpublic readonly previewExit: HTMLDivElement = div({style: \"width: 100vw; height: 100vh; position: fixed; left: 0; top: -2vh; display: flex; pointer-events: none;\"},this._previewText);\r\n\t\t\r\n\t\tprivate _form: HTMLFormElement = form({style: \"display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; max-height:265px; overflow-y: scroll; overflow-x: hidden;\"},\r\n\t\t\tlabel({title:\"Default\", class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"default\", style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #606060; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Default\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"NepBox\", class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"nepbox\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #9150ff; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"NepBox\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Laffey\", class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"laffey\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #dbbeed; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Laffey\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"ModBox 2.0\", class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"modbox2\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #c4ffa3; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"ModBox 2.0\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Artic\", class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"artic\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #a5eeff; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Artic\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Cinnamon Roll [!]\", class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"Cinnamon Roll\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #f5bb00; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"CinnaBun [!]\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Ocean\", class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"Ocean\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #4449a3; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Ocean\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Rainbow [!]\", class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"rainbow\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: linear-gradient(140deg, #faa, #ffceaa, #ffdfaa, #fff5aa, #e8ffaa, #bfffb2, #b2ffc8, #b2ffe4, #b2b3ff, #e0b2ff, #ffafe9); border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Rainbow [!]\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Float\", class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"float\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: linear-gradient(140deg, #fff, #282828); border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Float [!]\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({ title:\"Windows\", class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"windows\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #295294; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Windows\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Grassland\",class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"grassland\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #74bc21; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Grassland\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Dessert\",class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"dessert\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #fffc5b; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Dessert\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Kahootiest\",class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"kahootiest\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #864cbf; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Kahoot\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Beam to the Bit [!]\",class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"beambit\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #fa0103; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Beambit [!]\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Pretty Egg\",class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"egg\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #ffb1f4; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Pretty Egg\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Poniryoshka\",class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"Poniryoshka\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #dabbe6; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Poni\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Gameboy [!]\",class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"gameboy\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #306230; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Gameboy [!]\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Woodkid\",class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"woodkid\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #41323b; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Woodkid\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Midnight\",class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"midnight\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #445566; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Midnight\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Snedbox\",class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"snedbox\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #10997e; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Snedbox\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"unnamed\",class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"unnamed\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #ffffa0; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"unnamed\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Piano\",class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"piano\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #bfbfbf; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Piano [!]\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Halloween\",class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"halloween\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #914300; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Halloween\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"FrozenOver❄️\",class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"frozen\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #99c8ef; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Frozen\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t);\r\n\t\t\r\n\t\t\r\n\t\tpublic readonly themeContainer: HTMLDivElement = div({class: \"prompt\", style: \"width: 330px; max-height: 600px;\"}, \r\n                div({ style: \"font-size: 2em\" }, div(\"Themes\")),\r\n\t\t\t\tthis._form,\r\n\t\t\t\tdiv({style:\"display:flex; flex-direction:row; width:100%; gap: 16px;\"},\r\n\t\t\tthis._previewButton,\r\n\t\t\tthis._closeButton),\r\n        );\r\n\t\tpublic readonly container: HTMLDivElement = div({}, \r\n\t\t\tthis.themeContainer,\r\n\t\t\tthis.previewExit,\r\n        );\r\n\r\n\t\t\tconstructor(private _doc: SongDocument) {\r\n\t\t\t\tthis._closeButton.addEventListener(\"click\", this._close);\r\n\t\t\t\tthis._previewButton.addEventListener(\"click\", this._previewTheme);\r\n\t\t\t\tthis.previewExit.addEventListener(\"click\", this._exitPreview);\r\n\t\t\t\tthis._form.addEventListener(\"change\", this._themeChange);\r\n\t\t\t\tif (window.localStorage.getItem(\"modboxTheme\") != null) {\r\n\t\t\t\t\t(<any> this._form.elements)[\"theme\"].value = window.localStorage.getItem(\"modboxTheme\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tprivate _close = (): void => { \r\n\t\t\t\tif (this.hasChanged == false) {\r\n\t\t\t\t\tif (window.localStorage.getItem(\"modboxTheme\")){\r\n\t\t\t\t\t\tColorConfig.setTheme(String(window.localStorage.getItem(\"modboxTheme\")));\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tColorConfig.setTheme(\"default\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis._doc.prompt = null;\r\n\t\t\t\t\tthis._doc.undo(); \r\n\t\t\t\t} else {\r\n\t\t\t\t\twindow.localStorage.setItem(\"modboxTheme\", (<any> this._form.elements)[\"theme\"].value);\r\n\t\t\t\t\tthis._doc.prompt = null;\r\n\t\t\t\t\tthis._doc.undo();\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tprivate _themeChange = (): void => {\r\n\t\t\t\tColorConfig.setTheme((<any> this._form.elements)[\"theme\"].value);\r\n\t\t\t\t\r\n\t\t\t\tif ((<any> this._form.elements)[\"theme\"].value != window.localStorage.getItem(\"modboxTheme\")) {\r\n\t\t\t\tthis.hasChanged = true;\r\n\t\t\t\tthis._closeButton.innerHTML = \"Save\"; \r\n\t\t\t} else {\r\n\t\t\t\tthis.hasChanged = false;\r\n\t\t\t\tthis._closeButton.innerHTML = \"Cancel\"; \r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tprivate _previewTheme = (): void => { \r\n\t\t\t\tthis.themeContainer.style.opacity = \"0\";\r\n\t\t\t\tthis.previewExit.style.pointerEvents = \"\";\r\n\t\t\t\tthis._previewText.style.opacity = \"1\";\r\n\t\t\t}\r\n\r\n\t\t\tprivate _exitPreview = (): void => { \r\n\t\t\t\tthis.themeContainer.style.opacity = \"1\";\r\n\t\t\t\tthis.previewExit.style.pointerEvents = \"none\";\r\n\t\t\t\tthis._previewText.style.opacity = \"0\";\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tpublic cleanUp = (): void => { \r\n\t\t\t\tthis._closeButton.removeEventListener(\"click\", this._close);\r\n            };\r\n    }\r\n","/*\r\nCopyright (C) 2018 John Nesky\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of \r\nthis software and associated documentation files (the \"Software\"), to deal in \r\nthe Software without restriction, including without limitation the rights to \r\nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \r\nof the Software, and to permit persons to whom the Software is furnished to do \r\nso, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all \r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \r\nSOFTWARE.\r\n*/\r\n\r\nimport { HTML } from \"imperative-html/dist/esm/elements-strict\";\r\nimport { SongDocument } from \"./SongDocument\";\r\nimport { Prompt } from \"./Prompt\";\r\nimport { ColorConfig } from \"./ColorConfig\"; \r\nimport { ChangeSongTheme } from \"./changes\";\r\n\tconst {button, div, form, label, input } = HTML;\r\n\r\n\texport class SongThemePrompt implements Prompt {\r\n\t\tpublic hasChanged = false;\r\n\t\tprivate readonly _closeButton: HTMLButtonElement = button({style:\"flex: 1; width: 0;\"},\"Close\");\r\n\t\tprivate readonly _previewButton: HTMLButtonElement = button({style:\"flex: 1; width: 0;\"},\"Preview\");\r\n\t\tprivate readonly _previewText: HTMLDivElement = div({style:\"opacity: 0; position:absolute; left: 8px; top: 24px; font-size: 32px; font-weight:bold;\"},\"Previewing...\")\r\n\t\tpublic readonly previewExit: HTMLDivElement = div({style: \"width: 100vw; height: 100vh; position: fixed; left: 0; top: -2vh; display: flex; pointer-events: none;\"},this._previewText);\r\n\t\t\r\n\t\tprivate _form: HTMLFormElement = form({style: \"display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; max-height:265px; overflow-y: scroll; overflow-x: hidden;\"},\r\n\t\t\tlabel({title:\"None\", class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"none\", style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background:rgb(0, 0, 0); border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"None\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Default\", class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"default\", style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #606060; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Default\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Laffey\", class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"laffey\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #dbbeed; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Laffey\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"NepBox\", class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"nepbox\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #9150ff; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"NepBox\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"ModBox 2.0\", class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"modbox2\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #c4ffa3; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"ModBox 2.0\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Artic\", class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"artic\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #a5eeff; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Artic\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Cinnamon Roll [!]\", class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"Cinnamon Roll\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #f5bb00; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"CinnaBun [!]\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Ocean\", class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"Ocean\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #4449a3; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Ocean\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Rainbow [!]\", class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"rainbow\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: linear-gradient(140deg, #faa, #ffceaa, #ffdfaa, #fff5aa, #e8ffaa, #bfffb2, #b2ffc8, #b2ffe4, #b2b3ff, #e0b2ff, #ffafe9); border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Rainbow [!]\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Float\", class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"float\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: linear-gradient(140deg, #fff, #282828); border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Float [!]\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({ title:\"Windows\", class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"windows\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #295294; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Windows\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Grassland\",class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"grassland\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #74bc21; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Grassland\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Dessert\",class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"dessert\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #fffc5b; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Dessert\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Kahootiest\",class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"kahootiest\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #864cbf; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Kahoot\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Beam to the Bit [!]\",class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"beambit\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #fa0103; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Beambit [!]\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Pretty Egg\",class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"egg\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #ffb1f4; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Pretty Egg\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Poniryoshka\",class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"Poniryoshka\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #dabbe6; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Poni\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Gameboy [!]\",class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"gameboy\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #306230; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Gameboy [!]\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Woodkid\",class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"woodkid\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #41323b; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Woodkid\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Midnight\",class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"midnight\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #445566; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Midnight\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Snedbox\",class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"snedbox\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #10997e; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Snedbox\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"unnamed\",class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"unnamed\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #ffffa0; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"unnamed\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Piano\",class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"piano\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #bfbfbf; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Piano [!]\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Halloween\",class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"halloween\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #914300; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Halloween\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"FrozenOver❄️\",class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"frozen\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #99c8ef; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Frozen\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t);\r\n\t\t\r\n\t\t\r\n\t\tpublic readonly themeContainer: HTMLDivElement = div({class: \"prompt\", style: \"width: 330px; max-height: 600px;\"}, \r\n                div({ style: \"font-size: 2em\" }, div(\"Song Themes\")),\r\n\t\t\t\tthis._form,\r\n\t\t\t\tdiv({style:\"display:flex; flex-direction:row; width:100%; gap: 16px;\"},\r\n\t\t\tthis._previewButton,\r\n\t\t\tthis._closeButton),\r\n        );\r\n\t\tpublic readonly container: HTMLDivElement = div({}, \r\n\t\t\tthis.themeContainer,\r\n\t\t\tthis.previewExit,\r\n        );\r\n\r\n\t\t\tconstructor(private _doc: SongDocument) {\r\n\t\t\t\tthis._closeButton.addEventListener(\"click\", this._close);\r\n\t\t\t\tthis._previewButton.addEventListener(\"click\", this._previewTheme);\r\n\t\t\t\tthis.previewExit.addEventListener(\"click\", this._exitPreview);\r\n\t\t\t\tthis._form.addEventListener(\"change\", this._themeChange);\r\n\t\t\t\tif (this._doc.song.setSongTheme != \"none\") {\r\n\t\t\t\t\t(<any> this._form.elements)[\"theme\"].value = this._doc.song.setSongTheme;\r\n\t\t\t\t} else {\r\n\t\t\t\t\t(<any> this._form.elements)[\"theme\"].value = \"none\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tprivate _close = (): void => { \r\n\t\t\t\tif (this.hasChanged == false) {\r\n\t\t\t\t\tif (this._doc.song.setSongTheme == \"none\") {\r\n\t\t\t\t\t\tif (window.localStorage.getItem(\"modboxTheme\")){\r\n\t\t\t\t\t\t\tColorConfig.setTheme(String(window.localStorage.getItem(\"modboxTheme\")));\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tColorConfig.setTheme(\"default\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tColorConfig.setTheme(this._doc.song.setSongTheme)\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis._doc.prompt = null;\r\n\t\t\t\t\tthis._doc.undo(); \r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis._doc.prompt = null;\r\n\t\t\t\t\tthis._doc.record(new ChangeSongTheme(this._doc, this._doc.song.setSongTheme, (<any> this._form.elements)[\"theme\"].value), true);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tprivate _themeChange = (): void => {\r\n\t\t\t\tif ((<any> this._form.elements)[\"theme\"].value != \"none\") {\r\n\t\t\t\tColorConfig.setTheme((<any> this._form.elements)[\"theme\"].value);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (window.localStorage.getItem(\"modboxTheme\")){\r\n\t\t\t\t\t\tColorConfig.setTheme(String(window.localStorage.getItem(\"modboxTheme\")));\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tColorConfig.setTheme(\"default\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif ((<any> this._form.elements)[\"theme\"].value != this._doc.song.setSongTheme) {\r\n\t\t\t\tthis.hasChanged = true;\r\n\t\t\t\tthis._closeButton.innerHTML = \"Save\"; \r\n\t\t\t} else {\r\n\t\t\t\tthis.hasChanged = false;\r\n\t\t\t\tthis._closeButton.innerHTML = \"Cancel\"; \r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tprivate _previewTheme = (): void => { \r\n\t\t\t\tthis.themeContainer.style.opacity = \"0\";\r\n\t\t\t\tthis.previewExit.style.pointerEvents = \"\";\r\n\t\t\t\tthis._previewText.style.opacity = \"1\";\r\n\t\t\t}\r\n\r\n\t\t\tprivate _exitPreview = (): void => { \r\n\t\t\t\tthis.themeContainer.style.opacity = \"1\";\r\n\t\t\t\tthis.previewExit.style.pointerEvents = \"none\";\r\n\t\t\t\tthis._previewText.style.opacity = \"0\";\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tpublic cleanUp = (): void => { \r\n\t\t\t\tthis._closeButton.removeEventListener(\"click\", this._close);\r\n            };\r\n    }\r\n","// Copyright (c) 2012-2022 John Nesky and contributing authors, distributed under the MIT license, see accompanying the LICENSE.md file.\r\n\r\nimport {HTML} from \"imperative-html/dist/esm/elements-strict\";\r\n//import {ColorConfig} from \"./ColorConfig\";\r\n\r\n// check SongEditor.ts for these\r\n//const fullLayoutColumns = window.localStorage.getItem(\"advancedSettings\") ? \"minmax(0, 1fr) 190px 200px\" : \"minmax(0, 1fr) 190px\";\r\n//const middleLayoutColumns = window.localStorage.getItem(\"advancedSettings\") ? \"190px minmax(0, 1fr) 200px\" : \"190px minmax(0, 1fr)\";\r\n\r\n\r\n\r\nexport class Layout {\r\n\tprivate static readonly _layoutMap: {[K: string]: string} = {\r\n\t\t\"small\": \"\",\r\n\r\n\t\t// Full\r\n\r\n\t\t\"full\": `\\\r\n\t\tbody {\r\n\t\t\tmargin: 0;\r\n\t\t}\r\n\r\n\t\t.centerDiv {\r\n\t\t\twidth: unset !important;\r\n\t\t}\r\n\r\n\t\t#beepboxEditorContainer {\r\n\t\t\twidth: 100% !important;\r\n\t\t\theight: 100vh !important;\r\n\t\t}\r\n\t\t\r\n\t\t.modTitle {\r\n\t\tdisplay: none;\r\n\t\t}\r\n\r\n\t\t.beepboxEditor {\r\n\t\t\twidth: 100%;\r\n\t\t\theight: 100vh;\r\n\t\t\tgrid-template-columns: var(--full-layout-columns);\r\n\t\t\tgrid-template-rows: minmax(0px, min-content) minmax(0px, 1fr) minmax(0, min-content);\r\n\t\t\toverflow-y: hidden;\r\n\t\t}\r\n\r\n\t\t.editorBox {\r\n\t\t\theight: unset !important;\r\n\t\t}\r\n\r\n\t\t.trackContainer {\r\n\t\t\twidth: unset !important;\r\n\t\t\toverflow-x: scroll !important;\r\n\t\t}\r\n\r\n\t\t.beepboxEditor .trackAndMuteContainer {\r\n\t\t\twidth: 100%;\r\n\t\t\tmin-height: 0;\r\n\t\t\tflex: 1;\r\n\t\t\toverflow: auto;\r\n\t\t}\r\n\r\n\t\t.trackArea {\r\n\t\t\toverflow-y: scroll;\r\n\t\t}\r\n\r\n\t\t.barScrollBar {\r\n\t\t\tdisplay: none !important;\r\n\t\t}\r\n\t\t`,\r\n\r\n\t\t// Middle\r\n\r\n\t\t\"middle\": `\\\r\n\t\t\t\tbody {\r\n\t\t\tmargin: 0;\r\n\t\t}\r\n\r\n\t\t.centerDiv {\r\n\t\t\twidth: unset !important;\r\n\t\t}\r\n\r\n\t\t.modTitle {\r\n\t\tdisplay: none;\r\n\t\t}\r\n\r\n\t\t#beepboxEditorContainer {\r\n\t\t\twidth: 100% !important;\r\n\t\t\theight: 100vh !important;\r\n\t\t}\r\n\t\t\r\n\t\t.beepboxEditor {\r\n\t\t\twidth: 100%;\r\n\t\t\theight: 100vh;\r\n\t\t\tgrid-template-areas:\r\n\t\t\t\t\"settings-area      pattern-area  advanced-settings-area\" \r\n\t\t\t\t\"song-settings-area pattern-area  advanced-settings-area\" \r\n\t\t\t\t\"song-settings-area track-area    advanced-settings-area\" !important;\r\n\t\t\tgrid-template-columns: var(--middle-layout-columns);\r\n\t\t\tgrid-template-rows: minmax(0px, min-content) minmax(0px, 1fr) minmax(0, min-content);\r\n\t\t\toverflow-y: hidden;\r\n\t\t}\r\n\r\n\t\t.settings-area {\r\n\t\t\tmargin-left: 0 !important;\r\n\t\t\tmargin-right: 6px !important;\r\n\t\t}\r\n\r\n\t\t.song-settings-area {\r\n\t\t\tmargin-left: 0 !important;\r\n\t\t\tmargin-right: 6px !important;\r\n\t\t}\r\n\r\n\t\t.editorBox {\r\n\t\t\theight: unset !important;\r\n\t\t}\r\n\r\n\t\t.trackContainer {\r\n\t\t\twidth: unset !important;\r\n\t\t\toverflow-x: scroll !important;\r\n\t\t}\r\n\r\n\t\t.trackArea {\r\n\t\t\toverflow-y: scroll;\r\n\t\t}\r\n\r\n\t\t.beepboxEditor .trackAndMuteContainer {\r\n\t\t\twidth: 100%;\r\n\t\t\tmin-height: 0;\r\n\t\t\tflex: 1;\r\n\t\t\toverflow: auto;\r\n\t\t}\r\n\r\n\t\t.barScrollBar {\r\n\t\t\tdisplay: none !important;\r\n\t\t}\r\n\t\t`,\r\n\r\n\t\t// Flow\r\n\r\n\t\t\"flow\": `\\\r\n\t\tbody {\r\n\t\t\tmargin: 0;\r\n\t\t}\r\n\r\n\t\t.beepboxEditor {\r\n\t\t\twidth: 100%;\r\n\t\t\theight: 100vh;\r\n\t\t\tgrid-template-areas:\r\n\t\t\t\t\"settings-area settings-area         \" \r\n\t\t\t\t\"song-settings-area     pattern-area\" \r\n\t\t\t\t\"advanced-settings-area pattern-area\"\r\n\t\t\t\t\"advanced-settings-area track-area  \" !important;\r\n\t\t\tgrid-template-columns: 190px minmax(0, 1fr);\r\n\t\t\tgrid-template-rows: minmax(0px, min-content) minmax(0px, min-content) minmax(0px, 1fr);\r\n\t\t\toverflow-y: hidden;\r\n\t\t}\r\n\r\n\t\t.advanced-settings-area {\r\n\t\toverflow-y: scroll;\r\n\t\t}\r\n\r\n\t\t.centerDiv {\r\n\t\t\twidth: unset !important;\r\n\t\t}\r\n\r\n\t\t#beepboxEditorContainer {\r\n\t\t\twidth: 100% !important;\r\n\t\t\theight: 100vh !important;\r\n\t\t}\r\n\t\t\r\n\t\t.modTitle {\r\n\t\tdisplay: none;\r\n\t\t}\r\n\r\n\t\t.editorBox {\r\n\t\t\theight: unset !important;\r\n\t\t}\r\n\r\n\t\t.trackContainer {\r\n\t\t\twidth: unset !important;\r\n\t\t\toverflow-x: scroll !important;\r\n\t\t}\r\n\r\n\t\t.beepboxEditor .trackAndMuteContainer {\r\n\t\t\twidth: 100%;\r\n\t\t\tmin-height: 0;\r\n\t\t\tflex: 1;\r\n\t\t\toverflow: auto;\r\n\t\t}\r\n\r\n\t\t.trackArea {\r\n\t\t\toverflow-y: scroll;\r\n\t\t}\r\n\r\n\t\t.barScrollBar {\r\n\t\t\tdisplay: none !important;\r\n\t\t}\r\n\r\n\t\t.beepboxEditor .editor-settings {\r\n\t\t\tmargin-right: 6px;\r\n\t\t}\r\n\r\n\t\t.settings-area {\r\n\t\t\twidth: 50% !important;\r\n  \t\t\tgap: 3px !important;\r\n\t\t\tflex-direction: row !important;\r\n\t\t}\r\n\r\n\t\t.settings-area .title {\r\n\t\t\tflex: 1;\r\n\t\t}\r\n\r\n\t\t.settings-area .controller {\r\n\t\t\tflex-direction: row-reverse !important;\r\n\t\t\tflex: 3;\r\n\t\t}\r\n\r\n\t\t.settings-area .controller div {\r\n\t\t\tflex: 1;\r\n\t\t}\r\n\r\n\t\t.settings-area .editor-widgets {\r\n\t\t\tflex: 1;\r\n\t\t}\r\n\r\n\t\t.settings-area .editor-widgets .editor-menus {\r\n\t\t\tflex-direction: row;\r\n\t\t\tgap: 3px;\r\n\t\t\tmargin-top: .2em;\r\n\t\t\twidth: 0 !important;\r\n\t\t}\r\n\r\n\t\t.settings-area .editor-widgets .editor-menus .selectContainer {\r\n\t\t\tdisplay: flex;\r\n  \t\t\tjustify-content: center;\r\n\t\t}\r\n\r\n\t\t.settings-area .editor-widgets .editor-menus svg {\r\n\t\t\tleft: unset !important;\r\n\t\t}\r\n\r\n\t\t.settings-area .editor-widgets .editor-menus .selectContainer select {\r\n\t\t\twidth: 0 !important;\r\n\t\t}\r\n\r\n\t\t.beepboxEditor .selectContainer.menu::after {\r\n\t\t\tcontent: none !important;\r\n\t\t}\r\n\r\n\t\t.beepboxEditor .settings-area .editor-widgets .editor-menus {\r\n\t\t\twidth: 8em !important;\r\n\t\t}\r\n\r\n\t\t`,\r\n\t}\r\n\t\r\n\tprivate static readonly _styleElement: HTMLStyleElement = document.head.appendChild(HTML.style({type: \"text/css\"}));\r\n\t\r\n\tpublic static setLayout(layout: string): void {\r\n\t\tthis._styleElement.textContent = this._layoutMap[layout];\r\n\t}\r\n}\r\n","// Copyright (c) 2012-2022 John Nesky and contributing authors, distributed under the MIT license, see accompanying the LICENSE.md file.\r\n\r\nimport {SongDocument} from \"./SongDocument\";\r\nimport {Layout} from \"./Layout\";\r\nimport {Prompt} from \"./Prompt\";\r\nimport {HTML, SVG} from \"imperative-html/dist/esm/elements-strict\";\r\n\r\nconst {button, label, div, form, input} = HTML;\r\n\r\nexport class LayoutPrompt implements Prompt {\r\n\tprivate readonly _fileInput: HTMLInputElement = input({type: \"file\", accept: \".json,application/json,.mid,.midi,audio/midi,audio/x-midi\"});\r\n\tprivate readonly _okayButton: HTMLButtonElement = button({class: \"okayButton\", style: \"flex:1;\"}, \"Okay\");\r\n\tprivate readonly _cancelButton: HTMLButtonElement = button({style:\"flex: 1; width: 0;\"},\"Cancel\");\r\n\tprivate readonly _form: HTMLFormElement = form({style: \"display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; max-height: 265px; overflow-y: scroll; overflow-x: hidden;\"},\r\n\t\t\tlabel({class: \"layout-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"layout\", value: \"small\"}),\r\n\t\t\t\tSVG(`\\\r\n\t\t\t\t\t<svg viewBox=\"-4 -1 28 22\">\r\n\t\t\t\t\t\t<rect x=\"0\" y=\"0\" width=\"20\" height=\"20\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1\"/>\r\n\t\t\t\t\t\t<rect x=\"2\" y=\"2\" width=\"11\" height=\"10\" fill=\"currentColor\"/>\r\n\t\t\t\t\t\t<rect x=\"14\" y=\"2\" width=\"4\" height=\"16\" fill=\"currentColor\"/>\r\n\t\t\t\t\t\t<rect x=\"2\" y=\"13\" width=\"11\" height=\"5\" fill=\"currentColor\"/>\r\n\t\t\t\t\t</svg>\r\n\t\t\t\t`),\r\n\t\t\t\tdiv(\"Small\"),\r\n\t\t\t),\r\n\t\t\tlabel({class: \"layout-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"layout\", value: \"full\"}),\r\n\t\t\t\tSVG(`\\\r\n\t\t\t\t\t<svg viewBox=\"-1 -1 28 22\">\r\n\t\t\t\t\t\t<rect x=\"0\" y=\"0\" width=\"26\" height=\"20\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1\"/>\r\n\t\t\t\t\t\t<rect x=\"2\" y=\"2\" width=\"12\" height=\"10\" fill=\"currentColor\"/>\r\n\t\t\t\t\t\t<rect x=\"15\" y=\"2\" width=\"4\" height=\"16\" fill=\"currentColor\"/>\r\n\t\t\t\t\t\t<rect x=\"20\" y=\"2\" width=\"4\" height=\"16\" fill=\"currentColor\"/>\r\n\t\t\t\t\t\t<rect x=\"2\" y=\"13\" width=\"12\" height=\"5\" fill=\"currentColor\"/>\r\n\t\t\t\t\t</svg>\r\n\t\t\t\t`),\r\n\t\t\t\tdiv(\"Full\"),\r\n\t\t\t),\r\n\t\t\tlabel({class: \"layout-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"layout\", value: \"middle\"}),\r\n\t\t\t\tSVG(`\\\r\n\t\t\t\t\t<svg viewBox=\"-1 -1 28 22\">\r\n\t\t\t\t\t\t<rect x=\"0\" y=\"0\" width=\"26\" height=\"20\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1\"/>\r\n\t\t\t\t\t\t<rect x=\"7\" y=\"2\" width=\"12\" height=\"10\" fill=\"currentColor\"/>\r\n\t\t\t\t\t\t<rect x=\"2\" y=\"2\" width=\"4\" height=\"16\" fill=\"currentColor\"/>\r\n\t\t\t\t\t\t<rect x=\"20\" y=\"2\" width=\"4\" height=\"16\" fill=\"currentColor\"/>\r\n\t\t\t\t\t\t<rect x=\"7\" y=\"13\" width=\"12\" height=\"5\" fill=\"currentColor\"/>\r\n\t\t\t\t\t</svg>\r\n\t\t\t\t`),\r\n\t\t\t\tdiv(\"Middle\"),\r\n\t\t\t),\r\n\t\t\tlabel({class: \"layout-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"layout\", value: \"flow\"}),\r\n\t\t\t\tSVG(`\\\r\n\t\t\t\t\t<svg viewBox=\"-1 -1 28 22\">\r\n\t\t\t\t\t\t<rect x=\"0\" y=\"0\" width=\"26\" height=\"20\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1\"/>\r\n\t\t\t\t\t\t<rect x=\"7\" y=\"5\" width=\"17\" height=\"7\" fill=\"currentColor\"/>\r\n\t\t\t\t\t\t<rect x=\"2\" y=\"2\" width=\"22\" height=\"2\" fill=\"currentColor\"/>\r\n\t\t\t\t\t\t<rect x=\"2\" y=\"5\" width=\"4\" height=\"13\" fill=\"currentColor\"/>\r\n\t\t\t\t\t\t<rect x=\"7\" y=\"13\" width=\"17\" height=\"5\" fill=\"currentColor\"/>\r\n\t\t\t\t\t</svg>\r\n\t\t\t\t`),\r\n\t\t\t\tdiv(\"Flow\"),\r\n\t\t\t),\r\n\t\t);\r\n\t\r\n\tpublic readonly container: HTMLDivElement = div({class: \"prompt noSelection\", style: \"width: 300px;\"},\r\n\t\tdiv({ style: \"font-size: 2em\" }, div(\"Layouts\")),\r\n\t\tthis._form,\r\n\t\tdiv({style: \"display: flex; flex-direction: row; justify-content: space-between; gap: 3px;\"},\r\n\t\t\tthis._cancelButton,\r\n\t\t\tthis._okayButton,\r\n\t\t),\r\n\t);\r\n\t\r\n\tconstructor(private _doc: SongDocument) {\r\n\t\tthis._fileInput.select();\r\n\t\tsetTimeout(()=>this._fileInput.focus());\r\n\t\t\r\n\t\tthis._okayButton.addEventListener(\"click\", this._confirm);\r\n\t\tthis._cancelButton.addEventListener(\"click\", this._close);\r\n\t\tthis.container.addEventListener(\"keydown\", this._whenKeyPressed);\r\n\t\t\r\n\t\t(<any> this._form.elements)[\"layout\"].value = this._doc.prefs.layout;\r\n\t}\r\n\t\r\n\tprivate _close = (): void => { \r\n\t\tthis._doc.undo();\r\n\t}\r\n\t\r\n\tpublic cleanUp = (): void => { \r\n\t\tthis._okayButton.removeEventListener(\"click\", this._confirm);\r\n\t\tthis._cancelButton.removeEventListener(\"click\", this._close);\r\n\t\tthis.container.removeEventListener(\"keydown\", this._whenKeyPressed);\r\n\t}\r\n\t\r\n\tprivate _whenKeyPressed = (event: KeyboardEvent): void => {\r\n\t\tif ((<Element> event.target).tagName != \"BUTTON\" && event.keyCode == 13) { // Enter key\r\n\t\t\tthis._confirm();\r\n\t\t}\r\n\t}\r\n\t\r\n\tprivate _confirm = (): void => { \r\n\t\twindow.localStorage.setItem(\"layout\", (<any> this._form.elements)[\"layout\"].value)\r\n\t\tthis._doc.prefs.layout = (<any> this._form.elements)[\"layout\"].value;\r\n\t\tLayout.setLayout(this._doc.prefs.layout);\r\n\t\tthis._close();\r\n\t}\r\n}\r\n","/*\r\nCopyright (C) 2018 John Nesky\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of \r\nthis software and associated documentation files (the \"Software\"), to deal in \r\nthe Software without restriction, including without limitation the rights to \r\nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \r\nof the Software, and to permit persons to whom the Software is furnished to do \r\nso, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all \r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \r\nSOFTWARE.\r\n*/\r\n\r\nimport {Prompt} from \"./Prompt\";\r\nimport { SongDocument } from \"./SongDocument\";\r\nimport {Change} from \"./Change\";\r\nimport {PatternEditor} from \"./PatternEditor\";\r\nimport { HTML, SVG } from \"imperative-html/dist/esm/elements-strict\";\r\nimport { Channel, Instrument, Note, Pattern } from \"../synth/song\";\r\nimport { InstrumentType, Config } from \"../synth/SynthConfig\";\r\nimport { TrackEditor } from \"./TrackEditor\";\r\nimport { LoopEditor } from \"./LoopEditor\";\r\nimport { BarScrollBar } from \"./BarScrollBar\";\r\nimport { OctaveScrollBar } from \"./OctaveScrollBar\";\r\nimport { Piano } from \"./Piano\";\r\nimport { ChangeInsertBars, ChangeTransition, ChangeAlgorithm, ChangeBlend, ChangeChannelBar, ChangeChorus, ChangeDetune, ChangeEffect,ChangeFMChorus, ChangeFeedbackAmplitude, ChangeFeedbackEnvelope, ChangeFeedbackType, ChangeFilter, ChangeHarm, ChangeImute, ChangeInstrumentType, ChangeIpan, ChangeKey,  ChangeMix, ChangeMuff, ChangeOctoff, ChangeOperatorAmplitude, ChangeOperatorEnvelope, ChangeOperatorFrequency, ChangePartsPerBeat, ChangePaste, ChangePatternInstrument, ChangeReverb, ChangeRiff, ChangeSampleRate, ChangeScale, ChangeSong, ChangeTempo, ChangeTranspose, ChangeVolume, ChangeWave, ChangeDeleteBars, ChangeRemoveChannel, ChangeEnsurePatternExists } from \"./changes\";\r\nimport { MixPrompt} from \"./MixPrompt\";\r\nimport { ChorusPrompt } from \"./ChorusPrompt\";\r\nimport { ExportPrompt } from \"./ExportPrompt\";\r\nimport { ImportPrompt } from \"./ImportPrompt\";\r\nimport { ArchivePrompt } from \"./ArchivePrompt\";\r\nimport { SongDataPrompt } from \"./SongDataPrompt\";\r\nimport { RefreshKeyPrompt } from \"./RefreshKeyPrompt\";\r\nimport { SongDurationPrompt } from \"./SongDurationPrompt\";\r\nimport { InstrumentTypePrompt } from \"./InstrumentTypePrompt\";\r\nimport { ThemePrompt } from \"./ThemePrompt\";\r\nimport { SongThemePrompt } from \"./SongThemePrompt\";\r\nimport { LayoutPrompt } from \"./LayoutPrompt\";\r\nimport { ColorConfig } from \"./ColorConfig\"; \r\n\r\nconst {button, div, span, select, option, input, a} = HTML;\r\n\t\r\n\texport const isMobile: boolean = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|android|ipad|playbook|silk/i.test(navigator.userAgent);\r\n\t\r\n\tlet songThemeSet = \"none\";\r\n\r\n\tfunction buildOptions(menu: HTMLSelectElement, items: ReadonlyArray<string | number>): HTMLSelectElement {\r\n\t\tfor (let index: number = 0; index < items.length; index++) {\r\n\t\t\tmenu.appendChild(option({value: index}, items[index]));\r\n\t\t}\r\n\t\treturn menu;\r\n\t}\r\n\t\r\n\tfunction buildOptionsWithSpecificValues(menu: HTMLSelectElement, items: ReadonlyArray<string | number>, values: ReadonlyArray<string | number>): HTMLSelectElement {\r\n\t\tif (items.length != values.length) {\r\n\t\t\tthrow new Error(\"items and values don't have the same length\");\r\n\t\t}\r\n\t\tfor (let i: number = 0; i < items.length; i++) {\r\n\t\t\tconst item: string | number = items[i];\r\n\t\t\tconst value: string | number = values[i];\r\n\t\t\tmenu.appendChild(option({value:value}, item));\r\n\t\t}\r\n\t\treturn menu;\r\n\t}\r\n\t\r\n\tfunction setSelectedIndex(menu: HTMLSelectElement, index: number): void {\r\n\t\tif (menu.selectedIndex != index) menu.selectedIndex = index;\r\n\t}\r\n\r\n\tfunction setSelectedValue(menu: HTMLInputElement, index: string): void {\r\n\t\tif (menu.value != index) menu.value = index;\r\n\t}\r\n\t\r\n\tinterface PatternCopy {\r\n\t\tnotes: Note[];\r\n\t\tbeatsPerBar: number;\r\n\t\tpartsPerBeat: number;\r\n\t\tdrums: boolean;\r\n\t}\r\n\t\r\n\tclass Slider {\r\n\t\tprivate _change: Change | null = null;\r\n\t\tprivate _value: number = 0;\r\n\t\tprivate _oldValue: number = 0;\r\n\t\t\r\n\t\tconstructor(public readonly input: HTMLInputElement, private readonly _doc: SongDocument, private readonly _getChange: (oldValue: number, newValue: number)=>Change) {\r\n\t\t\tinput.addEventListener(\"input\", this._whenInput);\r\n\t\t\tinput.addEventListener(\"change\", this._whenChange);\r\n\t\t}\r\n\t\t\r\n\t\tpublic updateValue(value: number): void {\r\n\t\t\tthis._value = value;\r\n\t\t\tthis.input.value = String(value);\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenInput = (): void => {\r\n\t\t\tconst continuingProspectiveChange: boolean = this._doc.lastChangeWas(this._change);\r\n\t\t\tif (!continuingProspectiveChange) this._oldValue = this._value;\r\n\t\t\tthis._change = this._getChange(this._oldValue, parseInt(this.input.value));\r\n\t\t\tthis._doc.setProspectiveChange(this._change);\r\n\t\t};\r\n\t\t\r\n\t\tprivate _whenChange = (): void => {\r\n\t\t\tthis._doc.record(this._change!);\r\n\t\t\tthis._change = null;\r\n\t\t};\r\n\t}\r\n\t\r\n\texport class SongEditor {\r\n\t\tpublic prompt: Prompt | null = null;\r\n\t\t\r\n\t\tpublic readonly _patternEditor: PatternEditor = new PatternEditor(this._doc);\r\n\t\tprivate readonly _trackEditor: TrackEditor = new TrackEditor(this._doc);\r\n\t\tprivate readonly _loopEditor: LoopEditor = new LoopEditor(this._doc);\r\n\t\tprivate readonly _trackContainer: HTMLDivElement = div({class: \"trackContainer\"}, \r\n\t\t\tthis._trackEditor.container,\r\n\t\t\tthis._loopEditor.container,\r\n\t\t);\r\n\t\tprivate readonly _trackVisibleArea: HTMLDivElement = div({style: \"position: absolute; width: 100%; height: 100%; pointer-events: none;\"});\r\n\t\tprivate readonly _barScrollBar: BarScrollBar = new BarScrollBar(this._doc, this._trackContainer);\r\n\t\tprivate readonly _piano: Piano = new Piano(this._doc);\r\n\t\tprivate readonly _octaveScrollBar: OctaveScrollBar = new OctaveScrollBar(this._doc, this._piano);\r\n\t\tprivate readonly _editorBox: HTMLDivElement = div({class: \"editorBox\", style: \"height: 481px; display: flex; flex-direction: row; margin-bottom: 6px;\"}, \r\n\t\t\t\tthis._piano.container,\r\n\t\t\t\tthis._patternEditor.container,\r\n\t\t\t\tthis._octaveScrollBar.container,\r\n\t\t);\r\n\t\t//private readonly _trackVisibleArea: HTMLDivElement = div({style: \"position: absolute; width: 100%; height: 100%; pointer-events: none;\"});\r\n\t\tprivate readonly _trackAndMuteContainer: HTMLDivElement = div({class: \"trackAndMuteContainer prefers-big-scrollbars\"},\r\n\t\t\tthis._trackContainer,\r\n\t\t\tthis._trackVisibleArea,\r\n\t\t);\r\n\t\tprivate readonly _trackEditorBox: HTMLDivElement = div({class:\"track-area\"}, \r\n\t\t\tthis._trackAndMuteContainer,\r\n\t\t\tthis._barScrollBar.container,\r\n\t\t);\r\n\t\tprivate readonly _playButton: HTMLButtonElement = button({style: \"width:0; flex:2;\", type: \"button\"});\r\n\t\tprivate readonly _prevBarButton: HTMLButtonElement = button({class: \"prevBarButton\", style: \"width: 0; margin: 0px; flex:1; margin-left: 0px;\", type: \"button\", title: \"Prev Bar (left bracket)\"});\r\n\t\tprivate readonly _nextBarButton: HTMLButtonElement = button({class: \"nextBarButton\", style: \"width: 0; margin: 0px; flex:1; margin-left: 0px;\", type: \"button\", title: \"Next Bar (right bracket)\"});\r\n\t\tprivate readonly _volumeSlider: HTMLInputElement = input({title: \"main volume\", style: \"flex:1; margin: 0px;\", type: \"range\", min: \"0\", max: \"100\", value: \"50\", step: \"1\"});\r\n\t\tprivate readonly _fileMenu: HTMLSelectElement = select({style: \"width: 100%;\"}, \r\n\t\t\toption({selected: true, disabled: true, hidden: false}, \"File Menu\"),\r\n\t\t\toption({value: \"cleanS\"}, \"New Song\"),\r\n\t\t\toption({value: \"import\"}, \"Import JSON...\"),\r\n\t\t\toption({value: \"export\"}, \"Export Song...\"),\r\n\t\t\toption({value: \"shortenUrl\"}, \"Shorten Song Url...\"),\r\n\t\t\toption({value: \"songdata\"}, \"Song Data...\"),\r\n\t\t\toption({value: \"manual\"}, \"Open Manual...\"),\r\n\t\t);\r\n\t\tprivate readonly _editMenu: HTMLSelectElement = select({style: \"width: 100%;\"}, \r\n\t\t\toption({selected: true, disabled: true, hidden: false}, \"Edit Menu\"),\r\n\t\t\toption({value: \"undo\"}, \"Undo (Z)\"),\r\n\t\t\toption({value: \"redo\"}, \"Redo (Y)\"),\r\n\t\t\toption({value: \"copy\"}, \"Copy Pattern (C)\"),\r\n\t\t\toption({value: \"cut\"}, \"Cut Pattern (X)\"),\r\n\t\t\toption({value: \"paste\"}, \"Paste Pattern (V)\"),\r\n\t\t\toption({value: \"transposeUp\"}, \"Shift Notes Up (+)\"),\r\n\t\t\toption({value: \"transposeDown\"}, \"Shift Notes Down (-)\"),\r\n\t\t\toption({value: \"duration\"}, \"Custom Song Size (Q)\"),\r\n\t\t\toption({value: \"songTheme\"}, \"Set Song Theme...\"),\r\n\t\t);\r\n\t\tprivate readonly _optionsMenu: HTMLSelectElement = select({style: \"width: 100%;\"}, \r\n\t\t\toption({selected: true, disabled: true, hidden: false}, \"Preferences Menu\"),\r\n\t\t\toption({value: \"autoPlay\"}, \"Auto Play On Load\"),\r\n\t\t\toption({value: \"autoFollow\"}, \"Auto Follow Track\"),\r\n\t\t\toption({value: \"showLetters\"}, \"Show Piano\"),\r\n\t\t\toption({value: \"showFifth\"}, \"Highlight 'Fifth' Notes\"),\r\n\t\t\toption({value: \"showMore\"}, \"Advanced Color Scheme\"),\r\n\t\t\toption({value: \"showChannels\"},\"Show All Channels\"),\r\n\t\t\toption({value: \"showScrollBar\"}, \"Octave Scroll Bar\"),\r\n\t\t\toption({value: \"showVolumeBar\"}, \"Show Channel Volume\"),\r\n\t\t\toption({value: \"advancedSettings\"}, \"Enable Advanced Settings\"),\r\n\t\t\toption({value: \"themes\"}, \"Set Theme...\"),\r\n\t\t\toption({value: \"layouts\"}, \"Set Layout...\"),\r\n\t\t);\r\n\t\tprivate readonly _newSongButton: HTMLButtonElement = button({type: \"button\"}, \r\n\t\t\tdiv({},\"New\"),\r\n\t\t\tspan({class: \"fullWidthOnly\"}, div({},\" Song\")),\r\n\t\t\t// Page icon:\r\n\t\t\tSVG.svg( {style: \"flex-shrink: 0; position: absolute; left: 0; top: 50%; margin-top: -1em; pointer-events: none;\", width: \"2em\", height: \"2em\", viewBox: \"-5 -21 26 26\"}, \r\n\t\t\t\tSVG.path({d: \"M 2 0 L 2 -16 L 10 -16 L 14 -12 L 14 0 z M 3 -1 L 13 -1 L 13 -11 L 9 -11 L 9 -15 L 3 -15 z\", fill: \"currentColor\"}),\r\n\t\t\t),\r\n\t\t);\r\n\t\tprivate readonly _songDataButton: HTMLButtonElement = button({type: \"button\"}, \r\n\t\t\tdiv({},\"Song Data\"),\r\n\t\t\tSVG.svg( {style: \"flex-shrink: 0; position: absolute; left: 0; top: 50%; margin-top: -1em; pointer-events: none;\", width: \"2em\", height: \"2em\", viewBox: \"-5 -21 26 26\"}, \r\n\t\t\t\tSVG.path({d: \"M 0 0 L 16 0 L 16 -13 L 10 -13 L 8 -16 L 0 -16 L 0 -13 z\", fill: \"currentColor\"}),\r\n\t\t\t),\r\n\t\t);\r\n\t\tprivate readonly _customizeButton: HTMLButtonElement = button({type: \"button\"}, \r\n\t\t\tspan({ class: \"center\" }, div({},\"Custom Song Size\")),\r\n\t\t\tSVG.svg( {style: \"flex-shrink: 0; position: absolute; left: 0; top: 50%; margin-top: -1em; pointer-events: none;\", width: \"2em\", height: \"2em\", viewBox: \"-13 -13 26 26\"}, \r\n\t\t\t\tSVG.path({d: \"M -8 2 L -2 2 L -2 8 L 2 8 L 2 2 L 8 2 L 8 -2 L 2 -2 L 2 -8 L -2 -8 L -2 -2 L -8 -2 z M 0 2 L -4 -2 L -1 -2 L -1 -8 L 1 -8 L 1 -2 L 4 -2 z M -8 -8 L 8 -8 L 8 -9 L -8 -9 L -8 -8 z\", fill: \"currentColor\"}),\r\n\t\t\t),\r\n\t\t);\r\n\t\tprivate readonly _archiveButton: HTMLButtonElement = button({type: \"button\"}, \r\n\t\t\tspan({ class: \"center\" }, div({},\"Load Mods...\")),\r\n\t\t\tSVG.svg( {style: \"flex-shrink: 0; position: absolute; left: 0; top: 50%; margin-top: -1em; pointer-events: none;\", width: \"2em\", height: \"2em\", viewBox: \"-13 -13 26 26\"}, \r\n\t\t\t\tSVG.path({d: \"M 5.78 -1.6 L 7.93 -0.94 L 7.93 0.94 L 5.78 1.6 L 4.85 3.53 L 5.68 5.61 L 4.21 6.78 L 2.36 5.52 L 0.27 5.99 L -0.85 7.94 L -2.68 7.52 L -2.84 5.28 L -4.52 3.95 L -6.73 4.28 L -7.55 2.59 L -5.9 1.07 L -5.9 -1.07 L -7.55 -2.59 L -6.73 -4.28 L -4.52 -3.95 L -2.84 -5.28 L -2.68 -7.52 L -0.85 -7.94 L 0.27 -5.99 L 2.36 -5.52 L 4.21 -6.78 L 5.68 -5.61 L 4.85 -3.53 M 2.92 0.67 L 2.92 -0.67 L 2.35 -1.87 L 1.3 -2.7 L 0 -3 L -1.3 -2.7 L -2.35 -1.87 L -2.92 -0.67 L -2.92 0.67 L -2.35 1.87 L -1.3 2.7 L -0 3 L 1.3 2.7 L 2.35 1.87 z\", fill: \"currentColor\"}),\r\n\t\t\t),\r\n\t\t);\r\n\t\tprivate readonly _undoButton: HTMLButtonElement = button({type: \"button\", style: \"width: 45%; margin: 0px; margin-top: -2px;\"}, div({},\"Undo\"));\r\n\t\tprivate readonly _redoButton: HTMLButtonElement = button({type: \"button\", style: \"width: 45%; margin: 0px; margin-top: -2px;\"}, div({},\"Redo\"));\r\n\t\tprivate readonly _exportButton: HTMLButtonElement = button({type: \"button\"}, \r\n\t\t\tdiv({},\"Export\"),\r\n\t\t\t// Download icon:\r\n\t\t\tSVG.svg( {style: \"flex-shrink: 0; position: absolute; left: 0; top: 50%; margin-top: -1em; pointer-events: none;\", width: \"2em\", height: \"2em\", viewBox: \"-13 -13 26 26\"}, \r\n\t\t\t\tSVG.path({d: \"M -8 3 L -8 8 L 8 8 L 8 3 L 6 3 L 6 6 L -6 6 L -6 3 z M 0 2 L -4 -2 L -1 -2 L -1 -8 L 1 -8 L 1 -2 L 4 -2 z\", fill: \"currentColor\"}),\r\n\t\t\t),\r\n\t\t);\r\n\t\tprivate readonly _scaleSelect: HTMLSelectElement = buildOptions(select({}), Config.scales.map(scale=>scale.name));\r\n\t\tprivate readonly _mixSelect: HTMLSelectElement = buildOptions(select({}), Config.mixNames);\r\n\t\tprivate readonly _sampleRateSelect: HTMLSelectElement = buildOptions(select({}), Config.sampleRateNames);\r\n\t\tprivate readonly _mixHint: HTMLAnchorElement = <HTMLAnchorElement> a({ class: \"hintButton\" }, div({},\"?\"));\r\n\t\tprivate readonly _archiveHint: HTMLAnchorElement = <HTMLAnchorElement> a({ class: \"hintButton\" }, div({},\"?\"));\r\n\t\tprivate readonly _mixSelectRow: HTMLDivElement = div({class: \"selectRow\"}, this._mixSelect);\r\n\t\t// private readonly _chipHint: HTMLAnchorElement = <HTMLAnchorElement> a( { class: \"hintButton\" }, div({},\"?\"));\r\n\t\tprivate readonly _instrumentTypeHint: HTMLAnchorElement = <HTMLAnchorElement> a( { class: \"hintButton\" }, div({},\"?\"));\r\n\t\tprivate readonly _keySelect: HTMLSelectElement = buildOptions(select({}), Config.keys.map(key=>key.name).reverse());\r\n\t\tprivate readonly _tempoStepper: HTMLInputElement = input({class: \"numberInput\", style:\"margin-left:0.5em\", type:\"number\", min:Config.tempoMin, max: Config.tempoMax});\r\n\t\tprivate readonly _tempoSlider: Slider = new Slider(input({style: \"margin: 0px;\", type: \"range\", min: Config.tempoMin, max: Config.tempoMax, value: \"160\", step: \"1\"}), this._doc, (oldValue: number, newValue: number) => new ChangeTempo(this._doc, oldValue, newValue));\r\n\t\tprivate readonly _reverbSlider: Slider = new Slider(input({style: \"margin: 0px;\", type: \"range\", min: \"0\", max: Config.reverbRange - 1, value: \"0\", step: \"1\"}), this._doc, (oldValue: number, newValue: number) => new ChangeReverb(this._doc, oldValue, newValue));\r\n\t\tprivate readonly _blendSlider: Slider = new Slider(input({style: \"margin: 0px;\", type: \"range\", min: \"0\", max: Config.blendRange - 1, value: \"0\", step: \"1\"}), this._doc, (oldValue: number, newValue: number) => new ChangeBlend(this._doc, oldValue, newValue));\r\n\t\tprivate readonly _riffSlider: Slider = new Slider(input({style: \"margin: 0px;\", type: \"range\", min: \"0\", max: Config.riffRange - 1, value: \"0\", step: \"1\"}), this._doc, (oldValue: number, newValue: number) => new ChangeRiff(this._doc, oldValue, newValue));\r\n\t\tprivate readonly _detuneSlider: Slider = new Slider(input({style: \"margin: 0px;\", type: \"range\", min: \"0\", max: Config.detuneRange - 1, value: \"0\", step: \"1\"}), this._doc, (oldValue: number, newValue: number) => new ChangeDetune(this._doc, oldValue, newValue));\r\n\t\tprivate readonly _muffSlider: Slider = new Slider(input({style: \"margin: 0px;\", type: \"range\", min: \"0\", max: Config.muffRange - 1, value: \"0\", step: \"1\"}), this._doc, (oldValue: number, newValue: number) => new ChangeMuff(this._doc, oldValue, newValue));\r\n\t\tprivate readonly _imuteButton: HTMLButtonElement = button({ style: \"width: 27px; margin-left: 0.5em;\", type: \"button\" });\r\n\t\tprivate readonly _iMmuteButton: HTMLButtonElement = button({ style: \"width: 27px; margin-left: 0.5em;\", type: \"button\" });\r\n\t\tprivate readonly _partSelect: HTMLSelectElement = buildOptions(select({}), Config.partNames);\r\n\t\tprivate readonly _instrumentTypeSelect: HTMLSelectElement = buildOptionsWithSpecificValues(select({}), Config.pitchChannelTypeNames, Config.pitchChannelTypeValues);\r\n\t\tprivate readonly _instrumentTypeSelectRow: HTMLDivElement = div({class: \"selectRow\"}, span({}, div({style:\"display:flex;\"},\"Type: \", this._instrumentTypeHint)), div({class: \"selectContainer\"}, this._instrumentTypeSelect));\r\n\t\tprivate readonly _algorithmSelect: HTMLSelectElement = buildOptions(select({}), Config.operatorAlgorithmNames);\r\n\t\tprivate readonly _algorithmSelectRow: HTMLDivElement = div({class: \"selectRow\"}, span({}, div({},\"Algorithm: \")), div({class: \"selectContainer\"}, this._algorithmSelect));\r\n\t\tprivate readonly _instrumentSelect: HTMLSelectElement = select({});\r\n\t\tprivate readonly _instrumentInput: HTMLInputElement = input({class: \"numberInput\", type:\"number\", min:1});\r\n\t\tprivate readonly _instrumentSelectRow: HTMLDivElement = div({class: \"selectRow\", style: \"display: none;\"}, span({}, div({},\"Instrument: \")), \r\n\t\tdiv({class: \"inputContainer\"}, \r\n\t\t\tthis._instrumentInput\r\n\t\t));\r\n\t\tprivate readonly _instrumentVolumeSlider: Slider = new Slider(input({ type: \"range\", min: \"-9\", max: \"0\", value: \"0\", step: \"1\"}), this._doc, (oldValue: number, newValue: number) => new ChangeVolume(this._doc, oldValue, -newValue));\r\n\t\tprivate readonly _instrumentMVolumeSlider: Slider = new Slider(input({ type: \"range\", min: \"-5\", max: \"0\", value: \"0\", step: \"1\"}), this._doc, (oldValue: number, newValue: number) => new ChangeVolume(this._doc, oldValue, -newValue));\r\n\t\tprivate readonly _instrumentVolumeSliderRow: HTMLDivElement = div({class: \"selectRow\"}, span({}, div({},\"Volume: \")), \r\n\t\tdiv({ style:\"display: flex; flex-direction: row;\" },this._instrumentVolumeSlider.input, this._imuteButton));\r\n\t\tprivate readonly _instrumentMVolumeSliderRow: HTMLDivElement = div({class: \"selectRow\"}, span({}, div({},\"Volume: \")), \r\n\t\tdiv({ style:\"display: flex; flex-direction: row;\" },this._instrumentMVolumeSlider.input, this._iMmuteButton));\r\n\t\tprivate readonly _SettingsLabel: HTMLDivElement = div({ style: \"margin: 3px 0; text-align: center; color: rgb(170, 170, 170);\" }, div({},\"Settings\"));\r\n\t\tprivate readonly _advancedInstrumentSettingsLabel: HTMLDivElement = div({ style: \"margin: 3px 0; text-align: center;\" }, div({},\"Advanced Instrument Settings\"));\r\n\t\tprivate readonly _waveSelect: HTMLSelectElement = buildOptions(select({}), Config.waveNames);\r\n\t\tprivate readonly _drumSelect: HTMLSelectElement = buildOptions(select({}), Config.drumNames);\r\n\t\tprivate readonly _pwmwaveSelect: HTMLSelectElement = buildOptions(select({}), Config.pwmwaveNames);\r\n\t\tprivate readonly _waveSelectRow: HTMLDivElement = div({class: \"selectRow\"}, span({}, div({},\"Wave: \")), div({class: \"selectContainer\"}, this._waveSelect, this._pwmwaveSelect, this._drumSelect));\r\n\t\tprivate readonly _transitionSelect: HTMLSelectElement = buildOptions(select({}), Config.transitionNames);\r\n\t\tprivate readonly _filterSelect: HTMLSelectElement = buildOptions(select({}), Config.filterNames);\r\n\t\tprivate readonly _filterSelectRow: HTMLDivElement = div({class: \"selectRow\"}, span({}, div({},\"Filter: \")), div({class: \"selectContainer\"}, this._filterSelect));\r\n\t\tprivate readonly _chorusSelect: HTMLSelectElement = buildOptions(select({}), Config.chorusNames);\r\n\t\tprivate readonly _chorusHint = <HTMLAnchorElement> a( {class: \"hintButton\"}, div({},\"?\"));\r\n\t\tprivate readonly _chorusSelectRow: HTMLElement = div({class: \"selectRow\"}, span({}, div({},\"Chorus: \")), div({class: \"selectContainer\"}, this._chorusSelect));\r\n\t\tprivate readonly _effectSelect: HTMLSelectElement = buildOptions(select({}), Config.effectNames);\r\n\t\tprivate readonly _effectSelectRow: HTMLDivElement = div({class: \"selectRow\"}, span({}, div({},\"Effect: \")), div({class: \"selectContainer\"}, this._effectSelect));\r\n\t\tprivate readonly _harmSelect: HTMLSelectElement = buildOptions(select({}), Config.harmDisplay);\r\n\t\tprivate readonly _harmSelectRow: HTMLDivElement = div({class: \"selectRow\"}, span({}, div({style:\"display:flex;\"},\"Chord: \", this._chorusHint)), div({class: \"selectContainer\"}, this._harmSelect));\r\n\t\tprivate readonly _octoffSelect: HTMLSelectElement = buildOptions(select({}), Config.octoffNames);\r\n\t\tprivate readonly _octoffSelectRow: HTMLDivElement = div({class: \"selectRow\"}, span({}, div({},\"Octave Offset: \")), div({class: \"selectContainer\"}, this._octoffSelect));\r\n\t\tprivate readonly _fmChorusSelect: HTMLSelectElement = buildOptions(select({}), Config.fmChorusDisplay);\r\n\t\tprivate readonly _fmChorusSelectRow: HTMLDivElement = div({class: \"selectRow\"}, span({}, div({},\"FM Chorus: \")), div({class: \"selectContainer\"}, this._fmChorusSelect));\r\n\t\tprivate readonly _ipanSlider: Slider = new Slider(input({ type: \"range\", min: \"-8\", max: \"0\", value: \"0\", step: \"1\"}), this._doc, (oldValue: number, newValue: number) => new ChangeIpan(this._doc, oldValue, -newValue));\r\n\t\tprivate readonly _ipanSliderRow: HTMLDivElement = div({class: \"selectRow\"}, span({}, div({},\"Panning: \")),\r\n\t\tdiv({style:\"display:flex;\"},\r\n\t\t\tspan({style:\"margin-right: 0.5em; align-content: center;\"}, div({},\"L\")), \r\n\t\t\tthis._ipanSlider.input, \r\n\t\t\tspan({style:\"margin-left: 0.5em; align-content: center;\"}, div({},\"R\"))\r\n\t\t));\r\n\t\tprivate readonly _phaseModGroup: HTMLElement = div({style: \"display: flex; flex-direction: column; display: none;\"}, );\r\n\t\tprivate readonly _feedbackTypeSelect: HTMLSelectElement = buildOptions(select({}), Config.operatorFeedbackNames);\r\n\t\tprivate readonly _feedbackRow1: HTMLDivElement = div({class: \"selectRow\"}, span({}, div({},\"Feedback:\")), div({class: \"selectContainer\"}, this._feedbackTypeSelect));\r\n\t\t\r\n\t\tprivate readonly _feedbackAmplitudeSlider: Slider = new Slider(input({style: \"margin: 0px; flex: 1; width: 4em;\", type: \"range\", min: \"0\", max: Config.operatorAmplitudeMax, value: \"0\", step: \"1\", title: \"Feedback Amplitude\"}), this._doc, (oldValue: number, newValue: number) => new ChangeFeedbackAmplitude(this._doc, oldValue, newValue));\r\n\t\tprivate readonly _feedbackEnvelopeSelect: HTMLSelectElement = buildOptions(select({style: \"width: 100%;\", title: \"Feedback Envelope\"}), Config.operatorEnvelopeNames);\r\n\t\tprivate readonly _feedbackRow2: HTMLDivElement = div({class: \"operatorRow\"}, \r\n\t\t\tthis._feedbackAmplitudeSlider.input,\r\n\t\t\tdiv({class: \"selectContainer\", style: \"width:0; margin-left: .3em;\"}, this._feedbackEnvelopeSelect),\r\n\t\t);\r\n\r\n\t\tprivate readonly _songSettingsButton: HTMLButtonElement = button({style:\"flex: 1; border-bottom: solid 2px var(--link-accent);\"}, \"Song\");\r\n\t\tprivate readonly _instSettingsButton: HTMLButtonElement = button({style:\"flex: 1;\"}, \"Instrument\");\r\n\t\tprivate readonly _settingsTabs: HTMLDivElement = div({style:\"display: flex; gap: 3px;\"},\r\n\t\t\t\tthis._songSettingsButton,\r\n\t\t\t\tthis._instSettingsButton\r\n\t\t);\r\n\r\n\t\tprivate readonly _instrumentSettingsGroup: HTMLDivElement = div({style:\"display:none;\"}, \r\n\t\t\tthis._instrumentSelectRow,\r\n\t\t\tthis._instrumentTypeSelectRow,\r\n\t\t\tthis._instrumentMVolumeSliderRow,\r\n\t\t\tthis._instrumentVolumeSliderRow,\r\n\t\t\tthis._waveSelectRow,\r\n\t\t\tdiv({class: \"selectRow\"}, \r\n\t\t\t\tspan({}, div({},\"Transitions: \")),\r\n\t\t\t\tdiv({class: \"selectContainer\"}, this._transitionSelect),\r\n\t\t\t),\r\n\t\t\tthis._filterSelectRow,\r\n\t\t\tthis._chorusSelectRow,\r\n\t\t\tthis._effectSelectRow,\r\n\t\t\tthis._algorithmSelectRow,\r\n\t\t\tthis._phaseModGroup,\r\n\t\t\tthis._feedbackRow1,\r\n\t\t\tthis._feedbackRow2,\r\n\t\t);\r\n\t\tprivate readonly _songSettingsGroup: HTMLDivElement = div({ class: \"editor-song-settings\" }, \r\n\t\t\tdiv({ class: \"selectRow\" }, span({}, div({},\"Scale: \")), div({ class: \"selectContainer\", style: \"margin: 3px 0; text-align: center; color: #ccc;\" }, this._scaleSelect)),\r\n\t\t\tdiv({ class: \"selectRow\" }, span({}, div({},\"Key: \")), div({ class: \"selectContainer\", style: \"margin: 3px 0; text-align: center; color: #ccc;\" }, this._keySelect)),\r\n\t\t\tdiv({ class: \"selectRow\" }, span({}, div({},\"Tempo: \")), \r\n\t\t\tdiv({ style: \"display: flex; flex-direction: row;\" }, this._tempoSlider.input, this._tempoStepper)),\r\n\t\t\tdiv({ class: \"selectRow\" }, span({}, div({},\"Reverb: \")), this._reverbSlider.input),\r\n\t\t\tdiv({ class: \"selectRow\" }, span({}, div({},\"Rhythm: \")), div({ class: \"selectContainer\", style: \"margin: 3px 0; text-align: center; color: #ccc;\" }, this._partSelect)),\r\n\t\t);\r\n\t\tprivate readonly _advancedInstrumentSettingsGroup: HTMLDivElement = div({}, \r\n\t\t\tthis._advancedInstrumentSettingsLabel,\r\n\t\t\tthis._ipanSliderRow,\r\n\t\t\tthis._harmSelectRow,\r\n\t\t\tthis._octoffSelectRow,\r\n\t\t\tthis._fmChorusSelectRow,\r\n\t\t);\r\n\t\tprivate readonly _promptContainer: HTMLDivElement = div({class: \"promptContainer\", id: \"promptContainer\", style: \"display: none;\"});\r\n\t\tprivate readonly _advancedSongSettings: HTMLDivElement = div({ class: \"editor-song-settings\", style: \"margin: 0px 5px;\" }, \r\n\t\t\tdiv({ style: \"margin: 3px 0; text-align: center;\" }, div({},\"Advanced Song Settings\")),\r\n\t\t\tdiv({ class: \"selectRow\" }, span({}, div({style:\"display: flex;\"},\"Mix: \", this._mixHint)), div({ class: \"selectContainer\" }, this._mixSelectRow)),\r\n\t\t\tdiv({ class: \"selectRow\" }, span({}, div({},\"Sample Rate: \")), div({ class: \"selectContainer\" }, this._sampleRateSelect)),\r\n\t\t\tdiv({ class: \"selectRow\" }, span({}, div({},\"Blending: \")), this._blendSlider.input),\r\n\t\t\tdiv({ class: \"selectRow\" }, span({}, div({},\"Riff: \")), this._riffSlider.input),\r\n\t\t\tdiv({ class: \"selectRow\" }, span({}, div({},\"Detune: \")), this._detuneSlider.input),\r\n\t\t\tdiv({ class: \"selectRow\" }, span({}, div({},\"Muff: \")), this._muffSlider.input),\r\n\t\t);\r\n\t\tprivate readonly _advancedSettingsContainer: HTMLDivElement = div({ class: \"advanced-settings-area\", style: \"margin: 0px 5px;\" }, \r\n\t\t\tdiv({ class: \"editor-widgets\" }, \r\n\t\t\t\tdiv({ style: \"text-align: center;\" }, div({},\"Advanced Settings\")),\r\n\t\t\t\tdiv({ style: \"margin: 2px 0; display: flex; flex-direction: row; align-items: center;\" }, ),\r\n\t\t\t\tdiv({ class: \"editor-menus\" }, \r\n\t\t\t\t\tdiv({ style: \"margin: 5px 0; display: flex; flex-direction: row; justify-content: space-between;\" }, \r\n\t\t\t\t\t\tthis._prevBarButton,\r\n\t\t\t\t\t\tthis._undoButton,\r\n\t\t\t\t\t\tthis._redoButton,\r\n\t\t\t\t\t\tthis._nextBarButton,\r\n\t\t\t\t\t),\r\n\t\t\t\t),\r\n\t\t\t\tdiv({ class: \"editor-settings\" }, \r\n\t\t\t\t\tthis._advancedSongSettings,\r\n\t\t\t\t\tdiv({ class: \"editor-instrument-settings\" }, \r\n\t\t\t\t\t\tthis._advancedInstrumentSettingsGroup,\r\n\t\t\t\t\t),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t);\r\n\t\tpublic readonly mainLayer: HTMLDivElement = div({class: \"beepboxEditor\", tabIndex: \"0\"}, \r\n\t\t\tthis._editorBox,\r\n\t\t\tthis._trackEditorBox,\r\n\t\t\tdiv({class: \"settings-area\"}, \r\n\t\t\t\tdiv({ class:\"title\", style: \"align-items: center; display: flex; justify-content: center;\" }, div({},\"Neo NepBox\")),\r\n\t\t\t\tdiv({ class:\"controller\", style: \"margin: 5px 0; gap: 3px; display: flex; flex-direction: column; align-items: center;\" }, \r\n\t\t\t\t\tdiv({ style: \"display:flex; flex-direction:row;\" },\r\n\t\t\t\t\t\tSVG.svg( { width: \"2em\", height: \"2em\", viewBox: \"0 0 26 26\" }, \r\n\t\t\t\t\t\t\tSVG.path({ d: \"M 4 17 L 4 9 L 8 9 L 12 5 L 12 21 L 8 17 z\", fill: ColorConfig.volumeIcon}),\r\n\t\t\t\t\t\t\tSVG.path({ d: \"M 15 11 L 16 10 A 7.2 7.2 0 0 1 16 16 L 15 15 A 5.8 5.8 0 0 0 15 12 z\", fill: ColorConfig.volumeIcon }),\r\n\t\t\t\t\t\t\tSVG.path({ d: \"M 18 8 L 19 7 A 11.5 11.5 0 0 1 19 19 L 18 18 A 10.1 10.1 0 0 0 18 8 z\", fill: ColorConfig.volumeIcon }),\r\n\t\t\t\t\t\t),\r\n\t\t\t\t\t\tthis._volumeSlider,\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({ style: \"display: flex; flex-direction: row; align-items: center; width:100%; gap: 3px;\" }, \r\n\t\t\t\t\t\tthis._playButton,\r\n\t\t\t\t\t\tthis._prevBarButton,\r\n\t\t\t\t\t\tthis._nextBarButton,\r\n\t\t\t\t\t),\r\n\t\t\t\t),\r\n\t\t\t\tdiv({ class: \"editor-widgets\" }, \r\n\t\t\t\t\tdiv({ class: \"editor-menus\" }, \r\n\t\t\t\t\t\tdiv({class: \"selectContainer menu\"}, \r\n\t\t\t\t\t\t\tthis._fileMenu,\r\n\t\t\t\t\t\t\t// File icon:\r\n\t\t\t\t\t\t\tSVG.svg( {style: \"flex-shrink: 0; position: absolute; left: 0; top: 50%; margin-top: -1em; pointer-events: none;\", width: \"2em\", height: \"2em\", viewBox: \"-5 -21 26 26\"}, \r\n\t\t\t\t\t\t\t\tSVG.path({d: \"M 0 0 L 16 0 L 16 -13 L 10 -13 L 8 -16 L 0 -16 L 0 -13 z\", fill: \"currentColor\"}),\r\n\t\t\t\t\t\t\t),\r\n\t\t\t\t\t\t),\r\n\t\t\t\t\t\tdiv({class: \"selectContainer menu\"}, \r\n\t\t\t\t\t\t\tthis._editMenu,\r\n\t\t\t\t\t\t\t// Edit icon:\r\n\t\t\t\t\t\t\tSVG.svg( {style: \"flex-shrink: 0; position: absolute; left: 0; top: 50%; margin-top: -1em; pointer-events: none;\", width: \"2em\", height: \"2em\", viewBox: \"-5 -21 26 26\"}, \r\n\t\t\t\t\t\t\t\tSVG.path({d: \"M 0 0 L 1 -4 L 4 -1 z M 2 -5 L 10 -13 L 13 -10 L 5 -2 zM 11 -14 L 13 -16 L 14 -16 L 16 -14 L 16 -13 L 14 -11 z\", fill: \"currentColor\"}),\r\n\t\t\t\t\t\t\t),\r\n\t\t\t\t\t\t),\r\n\t\t\t\t\t\tdiv({class: \"selectContainer menu\"}, \r\n\t\t\t\t\t\t\tthis._optionsMenu,\r\n\t\t\t\t\t\t\t// Gear icon:\r\n\t\t\t\t\t\t\tSVG.svg( {style: \"flex-shrink: 0; position: absolute; left: 0; top: 50%; margin-top: -1em; pointer-events: none;\", width: \"2em\", height: \"2em\", viewBox: \"-13 -13 26 26\"}, \r\n\t\t\t\t\t\t\t\tSVG.path({d: \"M 5.78 -1.6 L 7.93 -0.94 L 7.93 0.94 L 5.78 1.6 L 4.85 3.53 L 5.68 5.61 L 4.21 6.78 L 2.36 5.52 L 0.27 5.99 L -0.85 7.94 L -2.68 7.52 L -2.84 5.28 L -4.52 3.95 L -6.73 4.28 L -7.55 2.59 L -5.9 1.07 L -5.9 -1.07 L -7.55 -2.59 L -6.73 -4.28 L -4.52 -3.95 L -2.84 -5.28 L -2.68 -7.52 L -0.85 -7.94 L 0.27 -5.99 L 2.36 -5.52 L 4.21 -6.78 L 5.68 -5.61 L 4.85 -3.53 M 2.92 0.67 L 2.92 -0.67 L 2.35 -1.87 L 1.3 -2.7 L 0 -3 L -1.3 -2.7 L -2.35 -1.87 L -2.92 -0.67 L -2.92 0.67 L -2.35 1.87 L -1.3 2.7 L -0 3 L 1.3 2.7 L 2.35 1.87 z\", fill: \"currentColor\"}),\r\n\t\t\t\t\t\t\t),\r\n\t\t\t\t\t\t),\r\n\t\t\t\t\t),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tdiv({ class: \"song-settings-area editor-settings\" }, \r\n\t\t\t\tthis._SettingsLabel,\r\n\t\t\t\tthis._settingsTabs,\r\n\t\t\t\tthis._songSettingsGroup,\r\n\t\t\t\tdiv({class: \"editor-instrument-settings\"}, \r\n\t\t\t\t\tthis._instrumentSettingsGroup,\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tthis._advancedSettingsContainer,\r\n\t\t\tthis._promptContainer,\r\n\t\t);\r\n\t\t\r\n\t\tprivate _wasPlaying: boolean;\r\n\t\tprivate _changeTranspose: ChangeTranspose | null = null;\r\n\t\tprivate readonly _operatorRows: HTMLDivElement[] = []\r\n\t\tprivate readonly _operatorAmplitudeSliders: Slider[] = []\r\n\t\tprivate readonly _operatorEnvelopeSelects: HTMLSelectElement[] = []\r\n\t\tprivate readonly _operatorFrequencySelects: HTMLSelectElement[] = []\r\n\t\t\r\n\t\tconstructor(private _doc: SongDocument) {\r\n\t\t\tthis._doc.notifier.watch(this.whenUpdated);\r\n\t\t\t\r\n\t\t\tthis._phaseModGroup.appendChild(div({class: \"operatorRow\", style: \"height: 1em; margin-top: 0.5em;\"}, \r\n\t\t\t\tdiv({style: \"margin-right: .1em; visibility: hidden;\"}, div({},1 + \".\")),\r\n\t\t\t\tdiv({style: \"width: 3em; margin-right: .3em;\"}, div({},\"Freq:\")),\r\n\t\t\t\tdiv({style: \"width: 4em; margin: 0;\"}, div({},\"Volume:\")),\r\n\t\t\t\tdiv({style: \"width: 5em; margin-left: .3em;\"}, div({},\"Envelope:\")),\r\n\t\t\t));\r\n\t\t\tfor (let i = 0; i < Config.operatorCount; i++) {\r\n\t\t\t\tconst operatorIndex: number = i;\r\n\t\t\t\tconst operatorNumber: HTMLDivElement = div({style: \"margin-right: .1em; color: #999;\"}, div({},i + 1 + \".\"));\r\n\t\t\t\tconst frequencySelect: HTMLSelectElement = buildOptions(select({style: \"width: 100%;\", title: \"Frequency\"}), Config.operatorFrequencyNames);\r\n\t\t\t\tconst amplitudeSlider: Slider = new Slider(input({style: \"margin: 0; width: 4em;\", type: \"range\", min: \"0\", max: Config.operatorAmplitudeMax, value: \"0\", step: \"1\", title: \"Volume\"}), this._doc, (oldValue: number, newValue: number) => new ChangeOperatorAmplitude(this._doc, operatorIndex, oldValue, newValue));\r\n\t\t\t\tconst envelopeSelect: HTMLSelectElement = buildOptions(select({style: \"width: 100%;\", title: \"Envelope\"}), Config.operatorEnvelopeNames);\r\n\t\t\t\tconst row = div({class: \"operatorRow\"}, \r\n\t\t\t\t\toperatorNumber,\r\n\t\t\t\t\tdiv({class: \"selectContainer\", style: \"width: 3em; margin-right: .3em;\"}, frequencySelect),\r\n\t\t\t\t\tamplitudeSlider.input,\r\n\t\t\t\t\tdiv({class: \"selectContainer\", style: \"width: 5em; margin-left: .3em;\"}, envelopeSelect),\r\n\t\t\t\t);\r\n\t\t\t\tthis._phaseModGroup.appendChild(row);\r\n\t\t\t\tthis._operatorRows[i] = row;\r\n\t\t\t\tthis._operatorAmplitudeSliders[i] = amplitudeSlider;\r\n\t\t\t\tthis._operatorEnvelopeSelects[i] = envelopeSelect;\r\n\t\t\t\tthis._operatorFrequencySelects[i] = frequencySelect;\r\n\t\t\t\t\r\n\t\t\t\tenvelopeSelect.addEventListener(\"change\", () => {\r\n\t\t\t\t\tthis._doc.record(new ChangeOperatorEnvelope(this._doc, operatorIndex, envelopeSelect.selectedIndex));\r\n\t\t\t\t});\r\n\t\t\t\tfrequencySelect.addEventListener(\"change\", () => {\r\n\t\t\t\t\tthis._doc.record(new ChangeOperatorFrequency(this._doc, operatorIndex, frequencySelect.selectedIndex));\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._fileMenu.addEventListener(\"change\", this._fileMenuHandler);\r\n\t\t\tthis._editMenu.addEventListener(\"change\", this._editMenuHandler);\r\n\t\t\tthis._optionsMenu.addEventListener(\"change\", this._optionsMenuHandler);\r\n\t\t\tthis._scaleSelect.addEventListener(\"change\", this._whenSetScale);\r\n\t\t\tthis._mixSelect.addEventListener(\"change\", this._whenSetMix);\r\n\t\t\tthis._sampleRateSelect.addEventListener(\"change\", this._whenSetSampleRate);\r\n\t\t\tthis._keySelect.addEventListener(\"change\", this._whenSetKey);\r\n\t\t\tthis._partSelect.addEventListener(\"change\", this._whenSetPartsPerBeat);\r\n\t\t\tthis._instrumentTypeSelect.addEventListener(\"change\", this._whenSetInstrumentType);\r\n\t\t\tthis._algorithmSelect.addEventListener(\"change\", this._whenSetAlgorithm);\r\n\t\t\t//this._instrumentSelect.addEventListener(\"change\", this._whenSetInstrument);\r\n\t\t\tthis._instrumentInput.addEventListener(\"change\", this._whenSetInstrument);\r\n\t\t\tthis._feedbackTypeSelect.addEventListener(\"change\", this._whenSetFeedbackType);\r\n\t\t\tthis._feedbackEnvelopeSelect.addEventListener(\"change\", this._whenSetFeedbackEnvelope);\r\n\t\t\tthis._waveSelect.addEventListener(\"change\", this._whenSetWave);\r\n\t\t\tthis._drumSelect.addEventListener(\"change\", this._whenSetDrum);\r\n\t\t\tthis._pwmwaveSelect.addEventListener(\"change\", this._whenSetPWMWave);\r\n\t\t\tthis._transitionSelect.addEventListener(\"change\", this._whenSetTransition);\r\n\t\t\tthis._filterSelect.addEventListener(\"change\", this._whenSetFilter);\r\n\t\t\tthis._chorusSelect.addEventListener(\"change\", this._whenSetChorus);\r\n\t\t\tthis._effectSelect.addEventListener(\"change\", this._whenSetEffect);\r\n\t\t\tthis._harmSelect.addEventListener(\"change\", this._whenSetHarm);\r\n\t\t\tthis._octoffSelect.addEventListener(\"change\", this._whenSetOctoff);\r\n\t\t\tthis._fmChorusSelect.addEventListener(\"change\", this._whenSetFMChorus);\r\n\t\t\tthis._imuteButton.addEventListener(\"click\", this._muteInstrument);\r\n\t\t\tthis._iMmuteButton.addEventListener(\"click\", this._muteInstrument);\r\n\t\t\tthis._playButton.addEventListener(\"click\", this._togglePlay);\r\n\t\t\tthis._prevBarButton.addEventListener(\"click\", this._whenPrevBarPressed);\r\n\t\t\tthis._nextBarButton.addEventListener(\"click\", this._whenNextBarPressed);\r\n\t\t\tthis._newSongButton.addEventListener(\"click\", this._whenNewSongPressed);\r\n\t\t\tthis._songDataButton.addEventListener(\"click\", this._openSongDataPrompt);\r\n\t\t\tthis._customizeButton.addEventListener(\"click\", this._whenCustomizePressed);\r\n\t\t\tthis._undoButton.addEventListener(\"click\", this._advancedUndo);\r\n\t\t\tthis._redoButton.addEventListener(\"click\", this._advancedRedo);\r\n\t\t\tthis._exportButton.addEventListener(\"click\", this._openExportPrompt);\r\n\t\t\tthis._archiveButton.addEventListener(\"click\", this._openArchivePrompt);\r\n\t\t\tthis._volumeSlider.addEventListener(\"input\", this._setVolumeSlider);\r\n\t\t\t// this._chipHint.addEventListener(\"click\", this._openChipPrompt);\r\n\t\t\tthis._instrumentTypeHint.addEventListener(\"click\", this._openInstrumentTypePrompt);\r\n\t\t\tthis._mixHint.addEventListener(\"click\", this._openMixPrompt);\r\n\t\t\tthis._chorusHint.addEventListener(\"click\", this._openChorusPrompt);\r\n\t\t\tthis._archiveHint.addEventListener(\"click\", this._openArchivePrompt);\r\n\r\n\t\t\tthis._tempoStepper.addEventListener(\"change\", this._whenSetTempo);\r\n\r\n\t\t\tthis._instrumentInput.addEventListener(\"keydown\", this._captureNumberKeys, false);\r\n\t\t\tthis._tempoStepper.addEventListener(\"keydown\", this._captureNumberKeys, false);\r\n\t\t\t\r\n\t\t\tthis._editorBox.addEventListener(\"mousedown\", this._refocusStage);\r\n\t\t\tthis.mainLayer.addEventListener(\"keydown\", this._whenKeyPressed);\r\n\t\t\t\r\n\t\t\tthis._songSettingsButton.addEventListener(\"click\", this._setSongSettings);\r\n\t\t\tthis._instSettingsButton.addEventListener(\"click\", this._setInstSettings);\r\n\r\n\t\t\tif (isMobile) (<HTMLOptionElement> this._optionsMenu.children[1]).disabled = true;\r\n\t\t}\r\n\t\t\r\n\t\tprivate _openPrompt(promptName: string): void {\r\n\t\t\tthis._doc.openPrompt(promptName);\r\n\t\t\tthis._setPrompt(promptName);\r\n\t\t}\r\n\t\t\r\n\t\tprivate _setPrompt(promptName: string | null): void {\r\n\t\t\tif (this.prompt) {\r\n\t\t\t\tif (this._wasPlaying) this._play();\r\n\t\t\t\tthis._wasPlaying = false;\r\n\t\t\t\tthis._promptContainer.style.display = \"none\";\r\n\t\t\t\tthis._promptContainer.removeChild(this.prompt.container);\r\n\t\t\t\tthis.prompt.cleanUp();\r\n\t\t\t\tthis.prompt = null;\r\n\t\t\t\tthis.mainLayer.focus();\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (promptName) {\r\n\t\t\t\tswitch (promptName) {\r\n\t\t\t\t\tcase \"export\":\r\n\t\t\t\t\t\tthis.prompt = new ExportPrompt(this._doc);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"import\":\r\n\t\t\t\t\t\tthis.prompt = new ImportPrompt(this._doc);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"duration\":\r\n\t\t\t\t\t\tthis.prompt = new SongDurationPrompt(this._doc);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"archive\":\r\n\t\t\t\t\t\tthis.prompt = new ArchivePrompt(this._doc);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"instrumentType\":\r\n\t\t\t\t\t\tthis.prompt = new InstrumentTypePrompt(this._doc);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t// case \"chipPrompt\":\r\n\t\t\t\t\t// \tthis.prompt = new ChipPrompt(this._doc, this);\r\n\t\t\t\t\t// \tbreak;\r\n\t\t\t\t\tcase \"mix\":\r\n\t\t\t\t\t\tthis.prompt = new MixPrompt(this._doc);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"chorus\":\r\n\t\t\t\t\t\tthis.prompt = new ChorusPrompt(this._doc);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"songdata\":\r\n\t\t\t\t\t\tthis.prompt = new SongDataPrompt(this._doc);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"refresh key\":\r\n\t\t\t\t\t\tthis.prompt = new RefreshKeyPrompt(this._doc, this, this._keySelect.selectedIndex);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"archive\":\r\n\t\t\t\t\t\tthis.prompt = new ArchivePrompt(this._doc);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"themes\":\r\n\t\t\t\t\t\tthis.prompt = new ThemePrompt(this._doc);\r\n\t\t\t\t\t\tbreak;\t\r\n\t\t\t\t\tcase \"songTheme\":\r\n\t\t\t\t\t\tthis.prompt = new SongThemePrompt(this._doc);\r\n\t\t\t\t\t\tbreak;\t\r\n\t\t\t\t\tcase \"layouts\":\r\n\t\t\t\t\t\tthis.prompt = new LayoutPrompt(this._doc);\r\n\t\t\t\t\t\tbreak;\t\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tthrow new Error(\"Unrecognized prompt type.\");\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif (this.prompt) {\r\n\t\t\t\t\tthis._wasPlaying = this._doc.synth.playing;\r\n\t\t\t\t\tthis._pause();\r\n\t\t\t\t\tthis._promptContainer.style.display = \"\";\r\n\t\t\t\t\tthis._promptContainer.appendChild(this.prompt.container);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tprivate _refocusStage = (): void => {\r\n\t\t\tthis.mainLayer.focus();\r\n\t\t}\r\n\t\t\r\n\t\tpublic whenUpdated = (): void => {\r\n\t\t\tconst trackBounds = this._trackContainer.getBoundingClientRect();\r\n\t\t\tthis._doc.trackVisibleBars = Math.floor((trackBounds.right - trackBounds.left) / 32);\r\n\t\t\tthis._barScrollBar.render();\r\n\t\t\tthis._trackEditor.render();\r\n\t\t\tthis._patternEditor.render();\r\n\r\n\t\t\tif (this._doc.song.setSongTheme != songThemeSet) {\r\n\t\t\t\tif (this._doc.song.setSongTheme == \"none\") {\r\n\t\t\t\t\tif (window.localStorage.getItem(\"modboxTheme\") != null) {\r\n\t\t\t\t\t\tColorConfig.setTheme(String(window.localStorage.getItem(\"modboxTheme\")));\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\twindow.localStorage.setItem(\"modboxTheme\", \"default\");\r\n\t\t\t\t\t\tColorConfig.setTheme(\"default\");\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tColorConfig.setTheme(this._doc.song.setSongTheme);\r\n\t\t\t\t}\r\n\t\t\t\tsongThemeSet = this._doc.song.setSongTheme;\r\n\t\t\t} \r\n\r\n\t\t\tdocument.documentElement.style.setProperty(\"--full-layout-columns\", this._doc.prefs.advancedSettings ? \"minmax(0, 1fr) 190px 200px\": \"minmax(0, 1fr) 190px\");\r\n\t\t\tdocument.documentElement.style.setProperty(\"--middle-layout-columns\", this._doc.prefs.advancedSettings ? \"190px minmax(0, 1fr) 200px\" : \"190px minmax(0, 1fr)\");\r\n\r\n\t\t\tconst optionCommands: ReadonlyArray<string> = [\r\n\t\t\t\t(this._doc.prefs.autoPlay ? \"✓ \" : \"✗ \") + \"Auto Play On Load\",\r\n\t\t\t\t(this._doc.prefs.autoFollow ? \"✓ \" : \"✗ \") + \"Auto Follow Track\",\r\n\t\t\t\t(this._doc.prefs.showLetters ? \"✓ \" : \"✗ \") + \"Show Piano\",\r\n\t\t\t\t(this._doc.prefs.showFifth ? \"✓ \" : \"✗ \") + \"Highlight 'Fifth' Notes\",\r\n\t\t\t\t(this._doc.prefs.showMore ? \"✓ \" : \"✗ \") + \"Advanced Color Scheme\",\r\n\t\t\t\t(this._doc.prefs.showChannels ? \"✓ \" : \"✗ \") + \"Show All Channels\",\r\n\t\t\t\t(this._doc.prefs.showScrollBar ? \"✓ \" : \"✗ \") + \"Octave Scroll Bar\",\r\n\t\t\t\t(this._doc.prefs.showVolumeBar ? \"✓ \" : \"✗ \") + \"Show Channel Volume\",\r\n\t\t\t\t(this._doc.prefs.advancedSettings ? \"✓ \" : \"✗ \") + \"Enable Advanced Settings\",\r\n\t\t\t\t\"  Set Theme...\",\r\n\t\t\t]\r\n\t\t\tfor (let i: number = 0; i < optionCommands.length; i++) {\r\n\t\t\t\tconst option: HTMLOptionElement = <HTMLOptionElement> this._optionsMenu.children[i + 1];\r\n\t\t\t\tif (option.innerText != optionCommands[i]) option.innerText = optionCommands[i];\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tconst channel: Channel = this._doc.song.channels[this._doc.channel];\r\n\t\t\tconst pattern: Pattern | null = this._doc.getCurrentPattern();\r\n\t\t\tconst instrumentIndex: number = this._doc.getCurrentInstrument();\r\n\t\t\tconst instrument: Instrument = channel.instruments[instrumentIndex];\r\n\t\t\tconst wasActive: boolean = this.mainLayer.contains(document.activeElement);\r\n\t\t\tlet activeElement: Element = document.activeElement ? document.activeElement : document.activeElement!;\r\n\r\n            if (this._doc.channel >= this._doc.song.pitchChannelCount + this._doc.song.drumChannelCount) {\r\n                this._piano.forceRender();\r\n            }\r\n\r\n\t\t\tsetSelectedIndex(this._scaleSelect, this._doc.song.scale);\r\n\t\t\tsetSelectedIndex(this._mixSelect, this._doc.song.mix);\r\n\t\t\tsetSelectedIndex(this._sampleRateSelect, this._doc.song.sampleRate);\r\n\t\t\tsetSelectedIndex(this._keySelect, Config.keys.length - 1 - this._doc.song.key);\r\n\t\t\tthis._tempoSlider.updateValue(this._doc.song.tempo);\r\n\t\t\tthis._tempoStepper.value = String(this._doc.song.tempo);\r\n\t\t\tthis._tempoSlider.input.title = this._doc.song.getBeatsPerMinute() + \" beats per minute\";\r\n\t\t\tthis._reverbSlider.updateValue(this._doc.song.reverb);\r\n\t\t\tthis._advancedSettingsContainer.style.display = this._doc.prefs.advancedSettings ? \"\" : \"none\";\r\n\t\t\tthis._blendSlider.updateValue(this._doc.song.blend);\r\n\t\t\tthis._riffSlider.updateValue(this._doc.song.riff);\r\n\t\t\tthis._detuneSlider.updateValue(this._doc.song.detune);\r\n\t\t\tthis._muffSlider.updateValue(this._doc.song.muff);\r\n\t\t\tsetSelectedIndex(this._partSelect, Config.partCounts.indexOf(this._doc.song.partsPerBeat));\r\n\t\t\tif (this._doc.song.getChannelIsDrum(this._doc.channel)) {\r\n\t\t\t\tif (this._doc.song.mix == 2) {\r\n\t\t\t\t\tthis._instrumentVolumeSliderRow.style.display = \"\";\r\n\t\t\t\t\tthis._instrumentMVolumeSliderRow.style.display = \"none\";\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis._instrumentVolumeSliderRow.style.display = \"none\";\r\n\t\t\t\t\tthis._instrumentMVolumeSliderRow.style.display = \"\";\r\n\t\t\t\t}\r\n\t\t\t\tthis._drumSelect.style.display = \"\";\r\n\t\t\t\tthis._waveSelectRow.style.display = \"\";\r\n\t\t\t\tthis._instrumentTypeSelectRow.style.display = \"none\";\r\n\t\t\t\tthis._instrumentTypeSelect.style.display = \"none\";\r\n\t\t\t\tthis._algorithmSelectRow.style.display = \"none\";\r\n\t\t\t\tthis._phaseModGroup.style.display = \"none\";\r\n\t\t\t\tthis._feedbackRow1.style.display = \"none\";\r\n\t\t\t\tthis._feedbackRow2.style.display = \"none\";\r\n\t\t\t\tthis._waveSelect.style.display = \"none\";\r\n\t\t\t\tthis._pwmwaveSelect.style.display = \"none\";\r\n\t\t\t\tthis._filterSelectRow.style.display = \"none\";\r\n\t\t\t\tthis._chorusSelectRow.style.display = \"none\";\r\n\t\t\t\tthis._effectSelectRow.style.display = \"none\";\r\n\t\t\t\tthis._ipanSliderRow.style.display = \"\";\r\n\t\t\t\tthis._harmSelectRow.style.display = \"\";\r\n\t\t\t\tthis._octoffSelectRow.style.display = \"\";\r\n\t\t\t\tthis._fmChorusSelectRow.style.display = \"none\";\r\n\t\t\t} else {\r\n\t\t\t\tthis._instrumentTypeSelectRow.style.display = \"\";\r\n\t\t\t\tthis._instrumentTypeSelect.style.display = \"\";\r\n\t\t\t\tthis._effectSelectRow.style.display = \"\";\r\n\t\t\t\tif (this._doc.song.mix == 2) {\r\n\t\t\t\t\tthis._instrumentVolumeSliderRow.style.display = \"\";\r\n\t\t\t\t\tthis._instrumentMVolumeSliderRow.style.display = \"none\";\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis._instrumentVolumeSliderRow.style.display = \"none\";\r\n\t\t\t\t\tthis._instrumentMVolumeSliderRow.style.display = \"\";\r\n\t\t\t\t}\r\n\t\t\t\tthis._drumSelect.style.display = \"none\";\r\n\t\t\t\t\r\n\t\t\t\tif (instrument.type == InstrumentType.chip) {\r\n\t\t\t\t\tthis._waveSelect.style.display = \"\";\r\n\t\t\t\t\tthis._pwmwaveSelect.style.display = \"none\";\r\n\t\t\t\t\tthis._waveSelectRow.style.display = \"\";\r\n\t\t\t\t\tthis._filterSelectRow.style.display = \"\";\r\n\t\t\t\t\tthis._chorusSelectRow.style.display = \"\";\r\n\t\t\t\t\tthis._harmSelectRow.style.display = \"\";\r\n\t\t\t\t\tthis._algorithmSelectRow.style.display = \"none\";\r\n\t\t\t\t\tthis._phaseModGroup.style.display = \"none\";\r\n\t\t\t\t\tthis._feedbackRow1.style.display = \"none\";\r\n\t\t\t\t\tthis._feedbackRow2.style.display = \"none\";\r\n\t\t\t\t\tthis._ipanSliderRow.style.display = \"\";\r\n\t\t\t\t\tthis._octoffSelectRow.style.display = \"\";\r\n\t\t\t\t\tthis._fmChorusSelectRow.style.display = \"none\";\r\n\t\t\t\t} else if (instrument.type == InstrumentType.pwm) {\r\n\t\t\t\t\tthis._waveSelect.style.display = \"none\";\r\n\t\t\t\t\tthis._pwmwaveSelect.style.display = \"\";\r\n\t\t\t\t\tthis._waveSelectRow.style.display = \"\";\r\n\t\t\t\t\tthis._filterSelectRow.style.display = \"none\"; // @TODO: Unhide?\r\n\t\t\t\t\tthis._chorusSelectRow.style.display = \"none\"; // @TODO: Unhide?\r\n\t\t\t\t\tthis._harmSelectRow.style.display = \"none\";\r\n\t\t\t\t\tthis._algorithmSelectRow.style.display = \"none\";\r\n\t\t\t\t\tthis._phaseModGroup.style.display = \"none\";\r\n\t\t\t\t\tthis._feedbackRow1.style.display = \"none\";\r\n\t\t\t\t\tthis._feedbackRow2.style.display = \"none\";\r\n\t\t\t\t\tthis._ipanSliderRow.style.display = \"\";\r\n\t\t\t\t\tthis._octoffSelectRow.style.display = \"\";\r\n\t\t\t\t\tthis._fmChorusSelectRow.style.display = \"none\";\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis._algorithmSelectRow.style.display = \"\";\r\n\t\t\t\t\tthis._phaseModGroup.style.display = \"\";\r\n\t\t\t\t\tthis._feedbackRow1.style.display = \"\";\r\n\t\t\t\t\tthis._feedbackRow2.style.display = \"\";\r\n\t\t\t\t\tthis._harmSelectRow.style.display = \"none\";\r\n\t\t\t\t\tthis._waveSelectRow.style.display = \"none\";\r\n\t\t\t\t\tthis._filterSelectRow.style.display = \"none\";\r\n\t\t\t\t\tthis._chorusSelectRow.style.display = \"none\";\r\n\t\t\t\t\tthis._ipanSliderRow.style.display = \"\";\r\n\t\t\t\t\tthis._octoffSelectRow.style.display = \"\";\r\n\t\t\t\t\tthis._fmChorusSelectRow.style.display = \"\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._instrumentTypeSelect.value = instrument.type + \"\";\r\n\t\t\tsetSelectedIndex(this._algorithmSelect, instrument.algorithm);\r\n\t\t\t\r\n\t\t\tthis._instrumentSelectRow.style.display = (this._doc.song.instrumentsPerChannel > 1) ? \"\" : \"none\";\r\n\t\t\tthis._instrumentSelectRow.style.visibility = (pattern == null) ? \"hidden\" : \"\";\r\n\t\t\t/*if (this._instrumentSelect.children.length != this._doc.song.instrumentsPerChannel) {\r\n\t\t\t\twhile (this._instrumentSelect.firstChild) this._instrumentSelect.removeChild(this._instrumentSelect.firstChild);\r\n\t\t\t\tconst instrumentList: number[] = [];\r\n\t\t\t\tfor (let i: number = 0; i < this._doc.song.instrumentsPerChannel; i++) {\r\n\t\t\t\t\tinstrumentList.push(i + 1);\r\n\t\t\t\t}\r\n\t\t\t\tbuildOptions(this._instrumentSelect, instrumentList);\r\n\t\t\t}*/\r\n\r\n\t\t\tif (this._instrumentInput.max != String(this._doc.song.instrumentsPerChannel)) {\r\n\t\t\t\tthis._instrumentInput.max = String(this._doc.song.instrumentsPerChannel);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (instrument.imute == 0) {\r\n\t\t\t\tthis._instrumentSettingsGroup.style.color = this._doc.song.getNoteColorBright(this._doc.channel);\r\n\t\t\t\tthis._advancedInstrumentSettingsGroup.style.color = this._doc.song.getNoteColorDim(this._doc.channel);\r\n\t\t\t\tthis._advancedSongSettings.style.color = \"#aaaaaa\";\r\n\t\t\t\tthis._imuteButton.innerText = \"◉\";\r\n\t\t\t\tthis._iMmuteButton.innerText = \"◉\";\r\n\t\t\t} else {\r\n\t\t\t\tthis._instrumentSettingsGroup.style.color = \"#cccccc\";\r\n\t\t\t\tthis._advancedInstrumentSettingsGroup.style.color = \"#aaaaaa\";\r\n\t\t\t\tthis._advancedSongSettings.style.color = \"#aaaaaa\";\r\n\t\t\t\tthis._imuteButton.innerText = \"◎\";\r\n\t\t\t\tthis._iMmuteButton.innerText = \"◎\";\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tsetSelectedIndex(this._waveSelect, instrument.wave);\r\n\t\t\tsetSelectedIndex(this._drumSelect, instrument.wave);\r\n\t\t\tsetSelectedIndex(this._pwmwaveSelect, instrument.wave);\r\n\t\t\tsetSelectedIndex(this._filterSelect, instrument.filter);\r\n\t\t\tsetSelectedIndex(this._transitionSelect, instrument.transition);\r\n\t\t\tsetSelectedIndex(this._effectSelect, instrument.effect);\r\n\t\t\tsetSelectedIndex(this._chorusSelect, instrument.chorus);\r\n\t\t\tsetSelectedIndex(this._harmSelect, instrument.harm);\r\n\t\t\tsetSelectedIndex(this._octoffSelect, instrument.octoff);\r\n\t\t\tsetSelectedIndex(this._fmChorusSelect, instrument.fmChorus);\r\n\t\t\tsetSelectedIndex(this._feedbackTypeSelect, instrument.feedbackType);\r\n\t\t\tthis._feedbackAmplitudeSlider.updateValue(instrument.feedbackAmplitude);\r\n\t\t\tsetSelectedIndex(this._feedbackEnvelopeSelect, instrument.feedbackEnvelope);\r\n\t\t\tthis._feedbackEnvelopeSelect.parentElement!.style.color = (instrument.feedbackAmplitude > 0) ? \"\" : \"#999\";\r\n\t\t\tthis._instrumentVolumeSlider.updateValue(-instrument.volume);\r\n\t\t\tthis._instrumentMVolumeSlider.updateValue(-instrument.volume);\r\n\t\t\tthis._ipanSlider.updateValue(-instrument.ipan);\r\n\t\t\tsetSelectedIndex(this._instrumentSelect, instrumentIndex);\r\n\t\t\tsetSelectedValue(this._instrumentInput, String(instrumentIndex+1));\r\n\t\t\tfor (let i: number = 0; i < Config.operatorCount; i++) {\r\n\t\t\t\tconst isCarrier: boolean = (i < Config.operatorCarrierCounts[instrument.algorithm]);\r\n\t\t\t\tthis._operatorRows[i].style.color = isCarrier ? \"white\" : \"\";\r\n\t\t\t\tsetSelectedIndex(this._operatorFrequencySelects[i], instrument.operators[i].frequency);\r\n\t\t\t\tthis._operatorAmplitudeSliders[i].updateValue(instrument.operators[i].amplitude);\r\n\t\t\t\tsetSelectedIndex(this._operatorEnvelopeSelects[i], instrument.operators[i].envelope);\r\n\t\t\t\tconst operatorName: string = (isCarrier ? \"Voice \" : \"Modulator \") + (i + 1);\r\n\t\t\t\tthis._operatorFrequencySelects[i].title = operatorName + \" Frequency\";\r\n\t\t\t\tthis._operatorAmplitudeSliders[i].input.title = operatorName + (isCarrier ? \" Volume\" : \" Amplitude\");\r\n\t\t\t\tthis._operatorEnvelopeSelects[i].title = operatorName + \" Envelope\";\r\n\t\t\t\tthis._operatorEnvelopeSelects[i].parentElement!.style.color = (instrument.operators[i].amplitude > 0) ? \"\" : \"#999\";\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._piano.container.style.display = this._doc.prefs.showLetters ? \"\" : \"none\";\r\n\t\t\tthis._octaveScrollBar.container.style.display = this._doc.prefs.showScrollBar ? \"\" : \"none\";\r\n\t\t\tthis._barScrollBar.container.style.display = this._doc.song.barCount > this._doc.trackVisibleBars ? \"\" : \"none\";\r\n\t\t\t// this._chipHint.style.display = (instrument.type == InstrumentType.fm) ? \"none\" : \"\";\r\n\t\t\tthis._instrumentTypeHint.style.display = (instrument.type == InstrumentType.fm) ? \"\" : \"none\";\r\n\t\t\tthis._mixHint.style.display = (this._doc.song.mix != 1) ? \"\" : \"none\";\r\n\t\t\tthis._chorusHint.style.display = (Config.harmNames[instrument.harm]) ? \"\" : \"none\";\r\n\t\t\t\r\n\t\t\tlet patternWidth: number = 512;\r\n\t\t\tif (this._doc.prefs.showLetters) patternWidth -= 32;\r\n\t\t\tif (this._doc.prefs.showScrollBar) patternWidth -= 20;\r\n\t\t\tthis._patternEditor.container.style.width = String(patternWidth) + \"px\";\r\n\t\t\t\r\n\t\t\tthis._volumeSlider.value = String(this._doc.prefs.volume);\r\n\t\t\t\r\n\t\t\t// If an interface element was selected, but becomes invisible (e.g. an instrument\r\n\t\t\t// select menu) just select the editor container so keyboard commands still work.\r\n\t\t\tif (wasActive && (activeElement.clientWidth == 0)) {\r\n\t\t\t\tthis._refocusStage();\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._setPrompt(this._doc.prompt);\r\n\t\t\t\r\n\t\t\tif (this._doc.prefs.autoFollow && !this._doc.synth.playing) {\r\n\t\t\t\tthis._doc.synth.snapToBar(this._doc.bar);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tprivate _setSongSettings = (): void => {\r\n\t\t\tthis._songSettingsGroup.style.display = \"flex\";\r\n\t\t\tthis._instrumentSettingsGroup.style.display = \"none\";\r\n\t\t\tthis._songSettingsButton.style.borderBottom = \"solid 2px var(--link-accent)\";\r\n\t\t\tthis._instSettingsButton.style.borderBottom = \"\";\r\n\t\t}\r\n\r\n\t\tprivate _setInstSettings = (): void => {\r\n\t\t\tthis._instrumentSettingsGroup.style.display = \"unset\";\r\n\t\t\tthis._songSettingsGroup.style.display = \"none\";\r\n\t\t\tthis._instSettingsButton.style.borderBottom = \"solid 2px var(--link-accent)\";\r\n\t\t\tthis._songSettingsButton.style.borderBottom = \"\";\r\n\t\t}\r\n\r\n\t\tprivate _muteInstrument = (): void => {\r\n\t\t\tconst channel: Channel = this._doc.song.channels[this._doc.channel];\r\n\t\t\tconst instrumentIndex: number = this._doc.getCurrentInstrument();\r\n\t\t\tconst instrument: Instrument = channel.instruments[instrumentIndex];\r\n\t\t\tconst oldValue: number = instrument.imute;\r\n\t\t\tconst isMuted: boolean = oldValue == 1;\r\n\t\t\tconst newValue: number = isMuted ? 0 : 1;\r\n\t\t\tthis._doc.record(new ChangeImute(this._doc, newValue));\r\n\t\t\tif (instrument.imute == 0) {\r\n\t\t\t\tthis._instrumentSettingsGroup.style.color = this._doc.song.getNoteColorBright(this._doc.channel);\r\n\t\t\t\tthis._advancedInstrumentSettingsGroup.style.color = this._doc.song.getNoteColorDim(this._doc.channel);\r\n\t\t\t\tthis._advancedSongSettings.style.color = \"#aaaaaa\";\r\n\t\t\t\tthis._imuteButton.innerText = \"◉\";\r\n\t\t\t\tthis._iMmuteButton.innerText = \"◉\";\r\n\t\t\t} else {\r\n\t\t\t\tthis._instrumentSettingsGroup.style.color = \"#cccccc\";\r\n\t\t\t\tthis._advancedInstrumentSettingsGroup.style.color = \"#aaaaaa\";\r\n\t\t\t\tthis._advancedSongSettings.style.color = \"#aaaaaa\";\r\n\t\t\t\tthis._imuteButton.innerText = \"◎\";\r\n\t\t\t\tthis._iMmuteButton.innerText = \"◎\";\r\n\t\t\t}\r\n\t\t\tthis.whenUpdated();\r\n\t\t}\r\n\t\t\r\n\t\tpublic updatePlayButton(): void {\r\n\t\t\tif (this._doc.synth.playing) {\r\n\t\t\t\tthis._playButton.classList.remove(\"playButton\");\r\n\t\t\t\tthis._playButton.classList.add(\"pauseButton\");\r\n\t\t\t\tthis._playButton.title = \"Pause (Space)\";\r\n\t\t\t\tthis._playButton.innerText = \"Pause\";\r\n\t\t\t} else {\r\n\t\t\t\tthis._playButton.classList.remove(\"pauseButton\");\r\n\t\t\t\tthis._playButton.classList.add(\"playButton\");\r\n\t\t\t\tthis._playButton.title = \"Play (Space)\";\r\n\t\t\t\tthis._playButton.innerText = \"Play\";\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tpublic _whenSetTempo = ():void => {\r\n\t\t\tthis._doc.record(new ChangeTempo(this._doc, -1, parseInt(this._tempoStepper.value) | 0));\r\n\t\t}\r\n\r\n\t\tprivate _captureNumberKeys = (event: KeyboardEvent): void => {\r\n        // When the number input is in focus, allow some keyboard events to\r\n        // edit the input without accidentally editing the song otherwise.\r\n\t\t\tswitch (event.keyCode) {\r\n\t\t\t\tcase 8: // backspace/delete\r\n\t\t\t\tcase 13: // enter/return\r\n\t\t\t\tcase 38: // up\r\n\t\t\t\tcase 40: // down\r\n\t\t\t\tcase 37: // left\r\n\t\t\t\tcase 39: // right\r\n\t\t\t\tcase 48: // 0\r\n\t\t\t\tcase 49: // 1\r\n\t\t\t\tcase 50: // 2\r\n\t\t\t\tcase 51: // 3\r\n\t\t\t\tcase 52: // 4\r\n\t\t\t\tcase 53: // 5\r\n\t\t\t\tcase 54: // 6\r\n\t\t\t\tcase 55: // 7\r\n\t\t\t\tcase 56: // 8\r\n\t\t\t\tcase 57: // 9\r\n\t\t\t\t\tevent.stopPropagation();\r\n\t\t\t\t\tbreak;\r\n        \t}\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenKeyPressed = (event: KeyboardEvent): void => {\r\n\t\t\tif (this.prompt) {\r\n\t\t\t\tif (event.keyCode == 27) { // ESC key\r\n\t\t\t\t\t// close prompt.\r\n\t\t\t\t\twindow.history.back();\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t//if (event.ctrlKey)\r\n\t\t\t//trace(event.keyCode)\r\n\t\t\tswitch (event.keyCode) {\r\n\t\t\t\tcase 8:\r\n\t\t\t\t\tif (event.ctrlKey) {\r\n\t\t\t\t\t\tif (this._doc.channel > 0) {\r\n\t\t\t\t\t\t\tthis._doc.record(new ChangeRemoveChannel(this._doc, this._doc.channel, this._doc.channel));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis._doc.record(new ChangeDeleteBars(this._doc, this._doc.bar, 1));\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 13: // enter\r\n\t\t\t\t\tif (event.ctrlKey || event.metaKey) {\t\t\r\n\t\t\t\t\t\t\tthis._doc.selection.insertChannel();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis._doc.record(new ChangeInsertBars(this._doc, this._doc.bar+1, 1)); }\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 38: // up\r\n\t\t\t\t\tthis._trackEditor._setChannelBar((this._doc.channel - 1 + this._doc.song.getChannelCount()) % this._doc.song.getChannelCount(), this._doc.bar);\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 40: // down\r\n\t\t\t\tthis._trackEditor._setChannelBar((this._doc.channel + 1) % this._doc.song.getChannelCount(), this._doc.bar);\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 37: // left\r\n\t\t\t\tthis._trackEditor._setChannelBar(this._doc.channel, (this._doc.bar + this._doc.song.barCount - 1) % this._doc.song.barCount);\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 39: // right\r\n\t\t\t\tthis._trackEditor._setChannelBar(this._doc.channel, (this._doc.bar + 1) % this._doc.song.barCount);\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 48: // 0\r\n\t\t\t\tthis._trackEditor._nextDigit(\"0\");\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 49: // 1\r\n\t\t\t\tthis._trackEditor._nextDigit(\"1\");\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 50: // 2\r\n\t\t\t\tthis._trackEditor._nextDigit(\"2\");\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 51: // 3\r\n\t\t\t\tthis._trackEditor._nextDigit(\"3\");\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 52: // 4\r\n\t\t\t\tthis._trackEditor._nextDigit(\"4\");\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 53: // 5\r\n\t\t\t\tthis._trackEditor._nextDigit(\"5\");\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 54: // 6\r\n\t\t\t\tthis._trackEditor._nextDigit(\"6\");\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 55: // 7\r\n\t\t\t\tthis._trackEditor._nextDigit(\"7\");\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 56: // 8\r\n\t\t\t\tthis._trackEditor._nextDigit(\"8\");\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 57: // 9\r\n\t\t\t\tthis._trackEditor._nextDigit(\"9\");\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\tthis._trackEditor._digits = \"\";\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 77: // m\r\n\t\t\t\tif (event.shiftKey) {\r\n\t\t\t\t\tthis._doc.selection.muteAllInstruments();\r\n\t\t\t\t\t} else { \r\n\t\t\t\t\tthis._muteInstrument();\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 83: // s\r\n\t\t\t\tif (event.ctrlKey || event.metaKey) {\r\n\t\t\t\t\tthis._openPrompt(\"export\");\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t}\telse {\r\n\t\t\t\t\tthis._doc.selection.soloChannels(event.shiftKey);\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 79: // o\r\n\t\t\t\tif (event.ctrlKey || event.metaKey) {\r\n\t\t\t\t\tthis._openPrompt(\"import\");\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 32: // space\r\n\t\t\t\t\t//stage.focus = stage;\r\n\t\t\t\t\tthis._togglePlay();\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 90: // z\r\n\t\t\t\t\tif (event.shiftKey) {\r\n\t\t\t\t\t\tthis._doc.redo();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis._doc.undo();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 89: // y\r\n\t\t\t\t\tthis._doc.redo();\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 88: // x\r\n\t\t\t\t\tthis._cut();\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 67: // c\r\n\t\t\t\t\tthis._copy();\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 70: // f\r\n\t\t\t\tif (event.shiftKey) {\r\n\t\t\t\t\tthis._doc.synth.snapToBar(this._doc.song.loopStart);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis._doc.synth.snapToStart();\r\n\t\t\t\t}\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 86: // v\r\n\t\t\t\t\tthis._paste();\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 219: // left brace\r\n\t\t\t\t\tthis._doc.synth.prevBar();\r\n\t\t\t\t\tif (this._doc.prefs.autoFollow) {\r\n\t\t\t\t\t\tnew ChangeChannelBar(this._doc, this._doc.channel, Math.floor(this._doc.synth.playhead));\r\n\t\t\t\t\t}\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 221: // right brace\r\n\t\t\t\t\tthis._doc.synth.nextBar();\r\n\t\t\t\t\tif (this._doc.prefs.autoFollow) {\r\n\t\t\t\t\t\tnew ChangeChannelBar(this._doc, this._doc.channel, Math.floor(this._doc.synth.playhead));\r\n\t\t\t\t\t}\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 189: // -\r\n\t\t\t\tcase 173: // Firefox -\r\n\t\t\t\t\tthis._transpose(false);\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 187: // +\r\n\t\t\t\tcase 61: // Firefox +\r\n\t\t\t\t\tthis._transpose(true);\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 81: // q\r\n\t\t\t\t\tthis._openPrompt(\"duration\");\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenPrevBarPressed = (): void => {\r\n\t\t\tthis._doc.synth.prevBar();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenNextBarPressed = (): void => {\r\n\t\t\tthis._doc.synth.nextBar();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _togglePlay = (): void => {\r\n\t\t\tif (this._doc.synth.playing) {\r\n\t\t\t\tthis._pause();\r\n\t\t\t} else {\r\n\t\t\t\tthis._play();\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tprivate _play(): void {\r\n\t\t\tthis._doc.synth.play();\r\n\t\t\tthis.updatePlayButton();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _pause(): void {\r\n\t\t\tthis._doc.synth.pause();\r\n\t\t\tif (this._doc.prefs.autoFollow) {\r\n\t\t\t\tthis._doc.synth.snapToBar(this._doc.bar);\r\n\t\t\t} else {\r\n\t\t\t\tthis._doc.synth.snapToBar();\r\n\t\t\t}\r\n\t\t\tthis.updatePlayButton();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _setVolumeSlider = (): void => {\r\n\t\t\tthis._doc.setVolume(Number(this._volumeSlider.value));\r\n\t\t\tthis._trackEditor.render();\r\n\t\t}\r\n\r\n\t\tprivate _cut(): void {\r\n\t\t\tconst pattern: Pattern | null = this._doc.getCurrentPattern();\r\n\t\t\tif (pattern == null) return;\r\n\t\t\twindow.localStorage.setItem(\"patternCopy\", JSON.stringify({\r\n\t\t\t\tnotes: pattern.notes,\r\n\t\t\t\tbeatsPerBar: this._doc.song.beatsPerBar,\r\n\t\t\t\tpartsPerBeat: this._doc.song.partsPerBeat,\r\n\t\t\t\tdrums: this._doc.song.getChannelIsDrum(this._doc.channel),\r\n\t\t\t}));\r\n\t\t\tthis._doc.record(new ChangePaste(this._doc, pattern, [], this._doc.song.beatsPerBar, this._doc.song.partsPerBeat));\r\n\t\t}\r\n\t\t\r\n\t\tprivate _copy(): void {\r\n\t\t\tconst pattern: Pattern | null = this._doc.getCurrentPattern();\r\n\t\t\tlet notes: Note[] = [];\r\n\t\t\tif (pattern != null) notes = pattern.notes;\r\n\t\t\t\r\n\t\t\tconst patternCopy: PatternCopy = {\r\n\t\t\t\tnotes: notes,\r\n\t\t\t\tbeatsPerBar: this._doc.song.beatsPerBar,\r\n\t\t\t\tpartsPerBeat: this._doc.song.partsPerBeat,\r\n\t\t\t\tdrums: this._doc.song.getChannelIsDrum(this._doc.channel),\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\twindow.localStorage.setItem(\"patternCopy\", JSON.stringify(patternCopy));\r\n\t\t}\r\n\t\t\r\n\t\tprivate _paste(): void {\r\n\t\t\tconst patternCopy: PatternCopy | null = JSON.parse(String(window.localStorage.getItem(\"patternCopy\")));\r\n\t\t\tif (patternCopy != null && patternCopy.drums == this._doc.song.getChannelIsDrum(this._doc.channel)) {\r\n\t\t\t\tnew ChangeEnsurePatternExists(this._doc);\r\n\t\t\t\tconst pattern: Pattern | null = this._doc.getCurrentPattern();\r\n\t\t\t\tif (pattern == null) throw new Error();\r\n\t\t\t\tthis._doc.record(new ChangePaste(this._doc, pattern, patternCopy.notes, patternCopy.beatsPerBar, patternCopy.partsPerBeat));\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tprivate _transpose(upward: boolean): void {\r\n\t\t\tconst pattern: Pattern | null = this._doc.getCurrentPattern();\r\n\t\t\tif (pattern == null) return;\r\n\t\t\t\r\n\t\t\tconst canReplaceLastChange: boolean = this._doc.lastChangeWas(this._changeTranspose);\r\n\t\t\tthis._changeTranspose = new ChangeTranspose(this._doc, pattern, upward);\r\n\t\t\tthis._doc.record(this._changeTranspose, canReplaceLastChange);\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenNewSongPressed = (): void => {\r\n\t\t\tthis._doc.record(new ChangeSong(this._doc, \"\"));\r\n\t\t\tthis._patternEditor.resetCopiedPins();\r\n\t\t}\r\n\r\n\t\tprivate _whenCustomizePressed = (): void => {\r\n\t\t\tthis._openPrompt(\"duration\");\r\n\t\t}\r\n\r\n\t\tprivate _advancedUndo = (): void => {\r\n\t\t\tthis._doc.undo();\r\n\t\t}\r\n\r\n\t\tprivate _advancedRedo = (): void => {\r\n\t\t\tthis._doc.redo();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _openExportPrompt = (): void => {\r\n\t\t\tthis._openPrompt(\"export\");\r\n\t\t}\r\n\t\t\r\n\t\tprivate _openSongDataPrompt = (): void => {\r\n\t\t\tthis._openPrompt(\"songdata\");\r\n\t\t}\r\n\t\t\r\n\t\tprivate _openInstrumentTypePrompt = (): void => {\r\n\t\t\tthis._openPrompt(\"instrumentType\");\r\n\t\t}\r\n\t\t\r\n\t\t// private _openChipPrompt = (): void => {\r\n\t\t// \tthis._openPrompt(\"chipPrompt\");\r\n\t\t// }\r\n\t\t\r\n\t\tprivate _openMixPrompt = (): void => {\r\n\t\t\tthis._openPrompt(\"mix\");\r\n\t\t}\r\n\t\t\r\n\t\tprivate _openChorusPrompt = (): void => {\r\n\t\t\tthis._openPrompt(\"chorus\");\r\n\t\t}\r\n\t\t\r\n\t\tprivate _openArchivePrompt = (): void => {\r\n\t\t\tthis._openPrompt(\"archive\");\r\n\t\t}\r\n\r\n\t\tpublic refreshNow = (): void => {\r\n\t\t\tsetTimeout(() => { // Prompts seem to get stuck if reloading is done too quickly.\r\n\t\t\t\tlocation.reload();\r\n\t\t\t}, 500);\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenSetScale = (): void => {\r\n\t\t\tthis._doc.record(new ChangeScale(this._doc, this._scaleSelect.selectedIndex));\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenSetMix = (): void => {\r\n\t\t\tthis._doc.record(new ChangeMix(this._doc, this._mixSelect.selectedIndex));\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenSetSampleRate = (): void => {\r\n\t\t\tthis._doc.record(new ChangeSampleRate(this._doc, this._sampleRateSelect.selectedIndex));\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenSetKey = (): void => {\r\n\t\t\tthis._doc.record(new ChangeKey(this._doc, Config.keys.length - 1 - this._keySelect.selectedIndex));\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenSetPartsPerBeat = (): void => {\r\n\t\t\tthis._doc.record(new ChangePartsPerBeat(this._doc, Config.partCounts[this._partSelect.selectedIndex]));\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenSetInstrumentType = (): void => {\r\n\t\t\tthis._doc.record(new ChangeInstrumentType(this._doc, +this._instrumentTypeSelect.value));\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenSetFeedbackType = (): void => {\r\n\t\t\tthis._doc.record(new ChangeFeedbackType(this._doc, this._feedbackTypeSelect.selectedIndex));\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenSetFeedbackEnvelope = (): void => {\r\n\t\t\tthis._doc.record(new ChangeFeedbackEnvelope(this._doc, this._feedbackEnvelopeSelect.selectedIndex));\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenSetAlgorithm = (): void => {\r\n\t\t\tthis._doc.record(new ChangeAlgorithm(this._doc, this._algorithmSelect.selectedIndex));\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenSetInstrument = (): void => {\r\n\t\t\tconst pattern : Pattern | null = this._doc.getCurrentPattern();\r\n\t\t\tif (pattern == null) return;\r\n\t\t\tthis._doc.record(new ChangePatternInstrument(this._doc, Number(this._instrumentInput.value)-1, pattern));\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenSetWave = (): void => {\r\n\t\t\tthis._doc.record(new ChangeWave(this._doc, this._waveSelect.selectedIndex));\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenSetDrum = (): void => {\r\n\t\t\tthis._doc.record(new ChangeWave(this._doc, this._drumSelect.selectedIndex));\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenSetPWMWave = (): void => {\r\n\t\t\tthis._doc.record(new ChangeWave(this._doc, this._pwmwaveSelect.selectedIndex));\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenSetFilter = (): void => {\r\n\t\t\tthis._doc.record(new ChangeFilter(this._doc, this._filterSelect.selectedIndex));\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenSetTransition = (): void => {\r\n\t\t\tthis._doc.record(new ChangeTransition(this._doc, this._transitionSelect.selectedIndex));\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenSetEffect = (): void => {\r\n\t\t\tthis._doc.record(new ChangeEffect(this._doc, this._effectSelect.selectedIndex));\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenSetHarm = (): void => {\r\n\t\t\tthis._doc.record(new ChangeHarm(this._doc, this._harmSelect.selectedIndex));\r\n\t\t}\r\n\r\n\t\tprivate _whenSetFMChorus = (): void => {\r\n\t\t\tthis._doc.record(new ChangeFMChorus(this._doc, this._fmChorusSelect.selectedIndex));\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenSetOctoff = (): void => {\r\n\t\t\tthis._doc.record(new ChangeOctoff(this._doc, this._octoffSelect.selectedIndex));\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenSetChorus = (): void => {\r\n\t\t\tthis._doc.record(new ChangeChorus(this._doc, this._chorusSelect.selectedIndex));\r\n\t\t}\r\n\t\t\r\n\t\tprivate _fileMenuHandler = (event:Event): void => {\r\n\t\t\tswitch (this._fileMenu.value) {\r\n\t\t\t\tcase \"import\":\r\n\t\t\t\t\tthis._openPrompt(\"import\");\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"export\":\r\n\t\t\t\t\tthis._openPrompt(\"export\");\r\n\t\t\t\t\tbreak;\t\r\n\t\t\t\tcase \"cleanS\":\r\n\t\t\t\t\tthis._whenNewSongPressed();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"songdata\":\r\n\t\t\t\t\tthis._openPrompt(\"songdata\");\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"manual\":\r\n\t\t\t\t\twindow.open(\"./manual.html\");\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"shortenUrl\":\r\n\t\t\t\t\twindow.open(\"https://tinyurl.com/api-create.php?url=\" + encodeURIComponent(new URL(\"#\" + this._doc.song.toBase64String(), location.href).href));\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tthis._fileMenu.selectedIndex = 0;\r\n\t\t}\r\n\r\n\t\tprivate _editMenuHandler = (event:Event): void => {\r\n\t\t\tswitch (this._editMenu.value) {\r\n\t\t\t\tcase \"undo\":\r\n\t\t\t\t\tthis._doc.undo();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"redo\":\r\n\t\t\t\t\tthis._doc.redo();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"cut\":\r\n\t\t\t\t\tthis._cut();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"copy\":\r\n\t\t\t\t\tthis._copy();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"paste\":\r\n\t\t\t\t\tthis._paste();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"transposeUp\":\r\n\t\t\t\t\tthis._transpose(true);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"transposeDown\":\r\n\t\t\t\t\tthis._transpose(false);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"duration\":\r\n\t\t\t\t\tthis._openPrompt(\"duration\");\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"archive\":\r\n\t\t\t\t\tthis._openPrompt(\"archive\");\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"songTheme\":\r\n\t\t\t\t\tthis._openPrompt(\"songTheme\");\r\n\t\t\t\t\tbreak;\t\r\n\t\t\t}\r\n\t\t\tthis._editMenu.selectedIndex = 0;\r\n\t\t}\r\n\t\t\r\n\t\tprivate _optionsMenuHandler = (event:Event): void => {\r\n\t\t\tswitch (this._optionsMenu.value) {\r\n\t\t\t\tcase \"autoPlay\":\r\n\t\t\t\t\tthis._doc.prefs.autoPlay = !this._doc.prefs.autoPlay;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"autoFollow\":\r\n\t\t\t\t\tthis._doc.prefs.autoFollow = !this._doc.prefs.autoFollow;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"showLetters\":\r\n\t\t\t\t\tthis._doc.prefs.showLetters = !this._doc.prefs.showLetters;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"showFifth\":\r\n\t\t\t\t\tthis._doc.prefs.showFifth = !this._doc.prefs.showFifth;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"showMore\":\r\n\t\t\t\t\tthis._doc.prefs.showMore = !this._doc.prefs.showMore;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"showChannels\":\r\n\t\t\t\t\tthis._doc.prefs.showChannels = !this._doc.prefs.showChannels;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"showScrollBar\":\r\n\t\t\t\t\tthis._doc.prefs.showScrollBar = !this._doc.prefs.showScrollBar;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"showVolumeBar\":\r\n\t\t\t\t\tthis._doc.prefs.showVolumeBar = !this._doc.prefs.showVolumeBar;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"advancedSettings\":\r\n\t\t\t\t\tthis._doc.prefs.advancedSettings = !this._doc.prefs.advancedSettings;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"themes\":\r\n\t\t\t\t\tthis._openPrompt(\"themes\");\r\n\t\t\t\t\tbreak;\t\r\n\t\t\t\tcase \"layouts\":\r\n\t\t\t\t\tthis._openPrompt(\"layouts\");\r\n\t\t\t\t\tbreak;\t\t\r\n\t\t\t}\r\n\t\t\tthis._optionsMenu.selectedIndex = 0;\r\n\t\t\tthis._doc.notifier.changed();\r\n\t\t\tthis._doc.prefs.save();\r\n\t\t}\r\n\t}\r\n\t\r\n","/*\r\nCopyright (C) 2018 John Nesky\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of \r\nthis software and associated documentation files (the \"Software\"), to deal in \r\nthe Software without restriction, including without limitation the rights to \r\nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \r\nof the Software, and to permit persons to whom the Software is furnished to do \r\nso, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all \r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \r\nSOFTWARE.\r\n*/\r\n\r\n\r\n\texport class ChangeNotifier {\r\n\t\tprivate _watchers: (()=>void)[] = [];\r\n\t\tprivate _dirty: boolean = false;\r\n\t\t\r\n\t\tpublic watch(watcher: ()=>void): void {\r\n\t\t\tif (this._watchers.indexOf(watcher) == -1) {\r\n\t\t\t\tthis._watchers.push(watcher);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tpublic unwatch(watcher: ()=>void): void {\r\n\t\t\tconst index: number = this._watchers.indexOf(watcher);\r\n\t\t\tif (index != -1) {\r\n\t\t\t\tthis._watchers.splice(index, 1);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tpublic changed(): void {\r\n\t\t\tthis._dirty = true;\r\n\t\t}\r\n\t\t\r\n\t\tpublic notifyWatchers(): void {\r\n\t\t\tif (!this._dirty) return;\r\n\t\t\tthis._dirty = false;\r\n\t\t\tfor (const watcher of this._watchers.concat()) {\r\n\t\t\t\twatcher();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n","import {ChangeGroup} from \"./Change\";\r\nimport { ChangeChannelBar, ChangeAddChannel, ChangeSoloChannels, ChangeAllImute } from \"./changes\";\r\nimport { Config } from \"../synth/SynthConfig\";\r\nimport { SongDocument } from \"./SongDocument\";\r\n//import { Channel, Instrument } from \"../synth/synth\";\r\n\r\nexport class Selection {\r\n\r\n    constructor(private _doc: SongDocument) {}\r\n\r\n    public muteAllInstruments(): void {\r\n        let shouldMute: boolean = false;\r\n        if (this._doc.song.channels[this._doc.channel].instruments[0].imute == 0) {\r\n            shouldMute = true;\r\n        }\r\n\r\n        for(let instrumentIndex: number = 0; instrumentIndex < this._doc.song.channels[this._doc.channel].instruments.length; instrumentIndex++) {  \r\n            this._doc.record(new ChangeAllImute(this._doc, Number(shouldMute), instrumentIndex));\r\n        }\r\n\r\n    this._doc.notifier.changed();\r\n}\r\n\r\n    public soloChannels(invert: boolean): void {\r\n\r\n            let mutedCounter: number = 0;\r\n\r\n\t\t\tfor (let channelIndex: number = 0; channelIndex < this._doc.song.channels.length; channelIndex++) {\r\n\t\t\t\tfor(let instrumentIndex: number = 0; instrumentIndex < this._doc.song.channels[channelIndex].instruments.length; instrumentIndex++) {\r\n\r\n                    if (this._doc.song.channels[channelIndex].instruments[instrumentIndex].imute == (invert ? 0 : 1) && channelIndex != this._doc.channel) {\r\n                        mutedCounter++;\r\n                    }\r\n\r\n                    if (channelIndex != this._doc.channel) {\r\n                        this._doc.record(new ChangeSoloChannels(this._doc, Number(!invert), channelIndex, instrumentIndex));\r\n                    } else {\r\n                        this._doc.record(new ChangeSoloChannels(this._doc, Number(invert), channelIndex, instrumentIndex));\r\n                    }\r\n\r\n                    \r\n                }\r\n\t\t\t}\r\n\r\n            if (mutedCounter >= this._doc.song.pitchChannelCount + this._doc.song.drumChannelCount - 1) {\r\n                for (let channelIndex: number = 0; channelIndex < this._doc.song.channels.length; channelIndex++) {\r\n                    for(let instrumentIndex: number = 0; instrumentIndex < this._doc.song.channels[channelIndex].instruments.length; instrumentIndex++) {\r\n                        this._doc.record(new ChangeSoloChannels(this._doc, Number(invert), channelIndex, instrumentIndex));  \r\n                    }\r\n                }\r\n            }\r\n\t\tthis._doc.notifier.changed();\r\n\t}\r\n\r\n    public insertChannel(): void {\r\n\r\n        const group: ChangeGroup = new ChangeGroup();\r\n        const insertIndex: number = this._doc.channel;\r\n        const isNoise: boolean = this._doc.song.getChannelIsDrum(insertIndex);\r\n        group.append(new ChangeAddChannel(this._doc, insertIndex+1, isNoise));\r\n        if (!group.isNoop()) {\r\n            group.append(new ChangeChannelBar(this._doc, insertIndex, this._doc.bar));\r\n            this._doc.record(group);\r\n        }\r\n\r\n        if (!isNoise && this._doc.channel < Config.pitchChannelCountMax-1) {\r\n            this._doc.channel++;\r\n        }\r\n\r\n        if (isNoise && this._doc.channel < Config.drumChannelCountMax + this._doc.song.pitchChannelCount - 1) {\r\n            this._doc.channel++;\r\n        }\r\n\r\n    }\r\n}","export class Preferences {\r\n\r\n    public static readonly defaultVisibleOctaves: number = 3;\r\n\r\n    autoPlay: boolean = localStorage.getItem(\"autoPlay\") == \"true\";\r\n\tautoFollow: boolean = localStorage.getItem(\"autoFollow\") == \"true\";\r\n\tshowFifth: boolean = localStorage.getItem(\"showFifth\") != \"false\";\r\n\tshowMore: boolean = localStorage.getItem(\"showMore\") == \"true\";\r\n\tshowLetters: boolean = localStorage.getItem(\"showLetters\") != \"false\";\r\n\tshowChannels: boolean = localStorage.getItem(\"showChannels\") == \"true\";\r\n\tshowScrollBar: boolean = localStorage.getItem(\"showScrollBar\") != \"false\";\r\n\tshowVolumeBar: boolean = localStorage.getItem(\"showVolumeBar\") == \"true\";\r\n\tadvancedSettings: boolean = localStorage.getItem(\"advancedSettings\") != \"false\";\r\n\tvisibleOctaves: number = localStorage.getItem(\"visibleOctaves\") != null ? Number(localStorage.getItem(\"visibleOctaves\")) : Preferences.defaultVisibleOctaves;\r\n    layout: string = localStorage.getItem(\"layout\") || \"small\";\r\n\tvolume: number = localStorage.getItem(\"volume\") != null ? Number(localStorage.getItem(\"volume\")) : 75;\r\n\r\n    save(): void {\r\n\t\tlocalStorage.setItem(\"autoPlay\", this.autoPlay ? \"true\" : \"false\");\r\n\t\tlocalStorage.setItem(\"autoFollow\", this.autoFollow ? \"true\" : \"false\");\r\n\t\tlocalStorage.setItem(\"showFifth\", this.showFifth ? \"true\" : \"false\");\r\n\t\tlocalStorage.setItem(\"showMore\", this.showMore ? \"true\" : \"false\");\r\n\t\tlocalStorage.setItem(\"showLetters\", this.showLetters ? \"true\" : \"false\");\r\n\t\tlocalStorage.setItem(\"showChannels\", this.showChannels ? \"true\" : \"false\");\r\n\t\tlocalStorage.setItem(\"showScrollBar\", this.showScrollBar ? \"true\" : \"false\");\r\n\t\tlocalStorage.setItem(\"showVolumeBar\", this.showVolumeBar ? \"true\" : \"false\");\r\n\t\tlocalStorage.setItem(\"advancedSettings\", this.advancedSettings ? \"true\" : \"false\");\r\n\t\tlocalStorage.setItem(\"visibleOctaves\", String(this.visibleOctaves));\r\n\t\tlocalStorage.setItem(\"volume\", String(this.volume));\r\n\t}\r\n\r\n}","/*\r\nCopyright (C) 2018 John Nesky\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of \r\nthis software and associated documentation files (the \"Software\"), to deal in \r\nthe Software without restriction, including without limitation the rights to \r\nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \r\nof the Software, and to permit persons to whom the Software is furnished to do \r\nso, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all \r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \r\nSOFTWARE.\r\n*/\r\n\r\nimport { Synth} from \"../synth/synth\";\r\nimport { Song, Pattern  } from \"../synth/song\";\r\nimport { ChangeNotifier } from \"./ChangeNotifier\";\r\nimport { Change } from \"./Change\";\r\nimport { ChangeSong } from \"./changes\";\r\nimport { ColorConfig } from \"./ColorConfig\"; \r\nimport { Layout } from \"./Layout\";\r\nimport {Selection} from \"./Selection.js\";\r\nimport { Config } from \"../synth/SynthConfig\";\r\n\r\nimport { Preferences } from \"./Preferences\";\r\n\r\n\tinterface HistoryState {\r\n\t\tcanUndo: boolean;\r\n\t\tsequenceNumber: number;\r\n\t\tbar: number;\r\n\t\tchannel: number;\r\n\t\tprompt: string | null;\r\n\t}\r\n\t\r\n\texport class SongDocument {\r\n\t\tpublic song: Song;\r\n\t\tpublic synth: Synth;\r\n\t\tpublic notifier: ChangeNotifier = new ChangeNotifier();\r\n\t\tpublic readonly selection: Selection = new Selection(this);\r\n\t\tpublic channel: number = 0;\r\n\t\tpublic bar: number = 0;\r\n\t\tpublic trackVisibleBars: number = 16;\r\n\t\tpublic barScrollPos: number = 0;\r\n\t\tpublic prompt: string | null = null;\r\n\t\tpublic readonly prefs: Preferences = new Preferences();\r\n\t\t\r\n\t\tprivate _recentChange: Change | null = null;\r\n\t\tprivate _sequenceNumber: number = 0;\r\n\t\tprivate _barFromCurrentState: number = 0;\r\n\t\tprivate _channelFromCurrentState: number = 0;\r\n\t\tprivate _shouldPushState: boolean = false;\r\n\t\tprivate _waitingToUpdateState: boolean = false;\r\n\t\t\r\n\t\tconstructor(string?: string) {\r\n\t\t\tthis.song = new Song(string);\r\n\t\t\tthis.synth = new Synth(this.song);\r\n\r\n\t\t\tthis.synth.volume = this._calcVolume();\r\n\t\t\t\r\n\t\t\tif (this.song.setSongTheme == \"none\") {\r\n\t\t\t\tif (window.localStorage.getItem(\"modboxTheme\") != null) {\r\n\t\t\t\t\tColorConfig.setTheme(String(window.localStorage.getItem(\"modboxTheme\")));\r\n\t\t\t\t} else {\r\n\t\t\t\t\twindow.localStorage.setItem(\"modboxTheme\", \"default\");\r\n\t\t\t\t\tColorConfig.setTheme(\"default\");\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tColorConfig.setTheme(this.song.setSongTheme);\r\n\t\t\t}\r\n\r\n\t\t\tif (window.localStorage.getItem(\"layout\") != null) {\r\n\t\t\t\tLayout.setLayout(String(window.localStorage.getItem(\"layout\")));\r\n\t\t\t} else {\r\n\t\t\t\twindow.localStorage.setItem(\"layout\", \"small\");\r\n\t\t\t\tLayout.setLayout(\"small\");\r\n\t\t\t}\r\n\r\n\t\t\tlet state: HistoryState | null = window.history.state;\r\n\t\t\tif (state == null) {\r\n\t\t\t\t// When the page is first loaded, indicate that undo is NOT possible.\r\n\t\t\t\tstate = {canUndo: false, sequenceNumber: 0, bar: 0, channel: 0, prompt: null};\r\n\t\t\t\twindow.history.replaceState(state, \"\", \"#\" + this.song.toBase64String());\r\n\t\t\t}\r\n\t\t\twindow.addEventListener(\"hashchange\", this._whenHistoryStateChanged);\r\n\t\t\twindow.addEventListener(\"popstate\", this._whenHistoryStateChanged);\r\n\t\t\t\r\n\t\t\tthis.bar = state.bar;\r\n\t\t\tthis.channel = state.channel;\r\n\t\t\tthis._barFromCurrentState = state.bar;\r\n\t\t\tthis._channelFromCurrentState = state.channel;\r\n\t\t\tthis.barScrollPos = Math.max(0, this.bar - (this.trackVisibleBars - 6));\r\n\t\t\tthis.prompt = state.prompt;\r\n\t\t\t\r\n\t\t\t// For all input events, catch them when they are about to finish bubbling,\r\n\t\t\t// presumably after all handlers are done updating the model and update the\r\n\t\t\t// view before the screen renders. mouseenter and mouseleave do not bubble,\r\n\t\t\t// but they are immediately followed by mousemove which does. \r\n\t\t\tfor (const eventName of [\"input\", \"change\", \"click\", \"keyup\", \"keydown\", \"mousedown\", \"mousemove\", \"mouseup\", \"touchstart\", \"touchmove\", \"touchend\", \"touchcancel\"]) {\r\n\t\t\t\twindow.addEventListener(eventName, this._cleanDocument);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenHistoryStateChanged = (): void => {\r\n\t\t\tlet state: HistoryState | null = window.history.state;\r\n\t\t\t\r\n\t\t\t// We're listening for both hashchanged and popstate, which often fire together.\r\n\t\t\t// Abort if we've already handled the current state. \r\n\t\t\tif (state && state.sequenceNumber == this._sequenceNumber) return;\r\n\t\t\t\r\n\t\t\tif (state == null) {\r\n\t\t\t\t// The user changed the hash directly.\r\n\t\t\t\tthis._sequenceNumber++;\r\n\t\t\t\tstate = {canUndo: true, sequenceNumber: this._sequenceNumber, bar: this.bar, channel: this.channel, prompt: this.prompt};\r\n\t\t\t\tnew ChangeSong(this, location.hash);\r\n\t\t\t\twindow.history.replaceState(state, \"\", \"#\" + this.song.toBase64String());\r\n\t\t\t} else {\r\n\t\t\t\tif (state.sequenceNumber == this._sequenceNumber - 1) {\r\n\t\t\t\t\t// undo:\r\n\t\t\t\t\tthis.bar = this._barFromCurrentState;\r\n\t\t\t\t\tthis.channel = this._channelFromCurrentState;\r\n\t\t\t\t} else if (state.sequenceNumber != this._sequenceNumber) {\r\n\t\t\t\t\t// redo, or jump multiple steps in history:\r\n\t\t\t\t\tthis.bar = state.bar;\r\n\t\t\t\t\tthis.channel = state.channel;\r\n\t\t\t\t}\r\n\t\t\t\tthis._sequenceNumber = state.sequenceNumber;\r\n\t\t\t\tthis.prompt = state.prompt;\r\n\t\t\t\tnew ChangeSong(this, location.hash);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._barFromCurrentState = state.bar;\r\n\t\t\tthis._channelFromCurrentState = state.channel;\r\n\t\t\t\r\n\t\t\t//this.barScrollPos = Math.min(this.bar, Math.max(this.bar - (this.trackVisibleBars - 1), this.barScrollPos));\r\n\t\t\t\r\n\t\t\tthis.forgetLastChange();\r\n\t\t\tthis.notifier.notifyWatchers();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _cleanDocument = (): void => {\r\n\t\t\tthis.notifier.notifyWatchers();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _updateHistoryState = (): void => {\r\n\t\t\tthis._waitingToUpdateState = false;\r\n\t\t\tconst hash: string = \"#\" + this.song.toBase64String();\r\n\t\t\tlet state: HistoryState;\r\n\t\t\tif (this._shouldPushState) {\r\n\t\t\t\tthis._sequenceNumber++;\r\n\t\t\t\tstate = {canUndo: true, sequenceNumber: this._sequenceNumber, bar: this.bar, channel: this.channel, prompt: this.prompt};\r\n\t\t\t\twindow.history.pushState(state, \"\", hash);\r\n\t\t\t} else {\r\n\t\t\t\tstate = {canUndo: true, sequenceNumber: this._sequenceNumber, bar: this.bar, channel: this.channel, prompt: this.prompt};\r\n\t\t\t\twindow.history.replaceState(state, \"\", hash);\r\n\t\t\t}\r\n\t\t\tthis._barFromCurrentState = state.bar;\r\n\t\t\tthis._channelFromCurrentState = state.channel;\r\n\t\t\tthis._shouldPushState = false;\r\n\t\t}\r\n\t\t\r\n\t\tpublic record(change: Change, replaceState: boolean = false): void {\r\n\t\t\tif (change.isNoop()) {\r\n\t\t\t\tthis._recentChange = null;\r\n\t\t\t\tif (replaceState) {\r\n\t\t\t\t\twindow.history.back();\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthis._recentChange = change;\r\n\t\t\t\tif (!replaceState) {\r\n\t\t\t\t\tthis._shouldPushState = true;\r\n\t\t\t\t}\r\n\t\t\t\tif (!this._waitingToUpdateState) {\r\n\t\t\t\t\twindow.requestAnimationFrame(this._updateHistoryState);\r\n\t\t\t\t\tthis._waitingToUpdateState = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tpublic openPrompt(prompt: string): void {\r\n\t\t\tthis.prompt = prompt;\r\n\t\t\tconst hash: string = \"#\" + this.song.toBase64String();\r\n\t\t\tthis._sequenceNumber++;\r\n\t\t\tconst state = {canUndo: true, sequenceNumber: this._sequenceNumber, bar: this.bar, channel: this.channel, prompt: this.prompt};\r\n\t\t\twindow.history.pushState(state, \"\", hash);\r\n\t\t}\r\n\t\t\r\n\t\tpublic undo(): void {\r\n\t\t\tconst state: HistoryState = window.history.state;\r\n\t\t\tif (state.canUndo) window.history.back();\r\n\t\t}\r\n\t\t\r\n\t\tpublic redo(): void {\r\n\t\t\twindow.history.forward();\r\n\t\t}\r\n\t\t\r\n\t\tpublic setProspectiveChange(change: Change | null): void {\r\n\t\t\tthis._recentChange = change;\r\n\t\t}\r\n\t\t\r\n\t\tpublic forgetLastChange(): void {\r\n\t\t\tthis._recentChange = null;\r\n\t\t}\r\n\t\t\r\n\t\tpublic lastChangeWas(change: Change | null): boolean {\r\n\t\t\treturn change != null && change == this._recentChange;\r\n\t\t}\r\n\t\t\r\n\t\tpublic setVolume(val: number): void {\r\n\t\t\tthis.prefs.volume = val;\r\n\t\t\tthis.prefs.save();\r\n\t\t\tthis.synth.volume = this._calcVolume();\r\n\t\t}\r\n\t\t\r\n\t\tpublic getMobileLayout(): boolean {\r\n\t\t\treturn window.innerWidth <= 710;\r\n\t\t}\r\n\r\n\t\tpublic getFullScreen(): boolean {\r\n\t\t\treturn !this.getMobileLayout() && (this.prefs.layout != \"small\");\r\n\t\t}\r\n\r\n\t\tprivate _calcVolume(): number {\r\n\t\t\treturn Math.min(1.0, Math.pow(this.prefs.volume / 50.0, 0.5)) * Math.pow(2.0, (this.prefs.volume - 75.0) / 25.0);\r\n\t\t}\r\n\t\t\r\n\t\tpublic getCurrentPattern(): Pattern | null {\r\n\t\t\treturn this.song.getPattern(this.channel, this.bar);\r\n\t\t}\r\n\t\t\r\n\t\tpublic getCurrentInstrument(): number {\r\n\t\t\tconst pattern: Pattern | null = this.getCurrentPattern();\r\n\t\t\treturn pattern == null ? 0 : pattern.instrument;\r\n\t\t}\r\n\r\n\t\tpublic getVisibleOctaveCount(): number {\r\n\t\treturn this.prefs.visibleOctaves;\r\n\t\t}\r\n\t\t\r\n\t\tpublic getVisiblePitchCount(): number {\r\n\t\t\treturn this.getVisibleOctaveCount() * Config.pitchesPerOctave + 1;\r\n\t\t}\r\n\r\n\t\tpublic getBaseVisibleOctave(channel: number): number {\r\n\t\treturn this.song.channels[channel].octave;\r\n\t\t}\r\n\t}\r\n\r\n","/*\r\nCopyright (C) 2018 John Nesky\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of \r\nthis software and associated documentation files (the \"Software\"), to deal in \r\nthe Software without restriction, including without limitation the rights to \r\nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \r\nof the Software, and to permit persons to whom the Software is furnished to do \r\nso, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all \r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \r\nSOFTWARE.\r\n*/\r\n\r\nimport {HTML} from \"imperative-html/dist/esm/elements-strict\";\r\nimport { ColorConfig } from \"./ColorConfig\";\r\n\r\ndocument.head.appendChild(HTML.style({ type: \"text/css\" }, `\r\n\r\n:root {\r\n--drum-symbol: url('data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"32\" height=\"40\" viewBox=\"0 0 32 40\"> \\\r\n\t\t\t<defs> \\\r\n\t\t\t\t<linearGradient id=\"gold1\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"0%\"> \\\r\n\t\t\t\t\t<stop offset=\"0%\" stop-color=\"%237e3302\"/> \\\r\n\t\t\t\t\t<stop offset=\"40%\" stop-color=\"%23ffec6b\"/> \\\r\n\t\t\t\t\t<stop offset=\"100%\" stop-color=\"%237e3302\"/> \\\r\n\t\t\t\t</linearGradient> \\\r\n\t\t\t\t<linearGradient id=\"gold2\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"0%\"> \\\r\n\t\t\t\t\t<stop offset=\"0%\" stop-color=\"%23faaf7d\"/> \\\r\n\t\t\t\t\t<stop offset=\"15%\" stop-color=\"%23fffba9\"/> \\\r\n\t\t\t\t\t<stop offset=\"40%\" stop-color=\"%23ffffe3\"/> \\\r\n\t\t\t\t\t<stop offset=\"65%\" stop-color=\"%23fffba9\"/> \\\r\n\t\t\t\t\t<stop offset=\"100%\" stop-color=\"%23faaf7d\"/> \\\r\n\t\t\t\t</linearGradient> \\\r\n\t\t\t\t<radialGradient id=\"gold3\" cx=\"0%\" cy=\"0%\" r=\"100%\"> \\\r\n\t\t\t\t\t<stop offset=\"0%\" stop-color=\"%23ffffe3\"/> \\\r\n\t\t\t\t\t<stop offset=\"50%\" stop-color=\"%23ffec6b\"/> \\\r\n\t\t\t\t\t<stop offset=\"100%\" stop-color=\"%237e3302\"/> \\\r\n\t\t\t\t</radialGradient> \\\r\n\t\t\t\t<linearGradient id=\"red\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"0%\"> \\\r\n\t\t\t\t\t<stop offset=\"0%\" stop-color=\"%23641919\"/> \\\r\n\t\t\t\t\t<stop offset=\"40%\" stop-color=\"%23cd2c2c\"/> \\\r\n\t\t\t\t\t<stop offset=\"100%\" stop-color=\"%23641919\"/> \\\r\n\t\t\t\t</linearGradient> \\\r\n\t\t\t\t<radialGradient id=\"membrane\"> \\\r\n\t\t\t\t\t<stop offset=\"10%\" stop-color=\"%23cccccc\" /> \\\r\n\t\t\t\t\t<stop offset=\"90%\" stop-color=\"%23f6f6f7\" /> \\\r\n\t\t\t\t\t<stop offset=\"100%\" stop-color=\"%23999\" /> \\\r\n\t\t\t\t</radialGradient> \\\r\n\t\t\t</defs> \\\r\n\t\t\t<ellipse cx=\"16\" cy=\"26\" rx=\"16\" ry=\"14\" fill=\"rgba(0,0,0,0.5)\"/> \\\r\n\t\t\t<ellipse cx=\"16\" cy=\"25\" rx=\"16\" ry=\"14\" fill=\"url(%23gold1)\"/> \\\r\n\t\t\t<rect x=\"0\" y=\"23\" width=\"32\" height=\"2\" fill=\"url(%23gold1)\"/> \\\r\n\t\t\t<ellipse cx=\"16\" cy=\"23\" rx=\"16\" ry=\"14\" fill=\"url(%23gold2)\"/> \\\r\n\t\t\t<ellipse cx=\"16\" cy=\"23\" rx=\"15\" ry=\"13\" fill=\"url(%23red)\"/> \\\r\n\t\t\t<rect x=\"1\" y=\"17\" width=\"30\" height=\"6\" fill=\"url(%23red)\"/> \\\r\n\t\t\t<rect x=\"5\" y=\"27\" width=\"1\" height=\"5\" rx=\"0.5\" fill=\"rgba(0,0,0,0.5)\"/> \\\r\n\t\t\t<rect x=\"15\" y=\"31\" width=\"2\" height=\"5\" rx=\"1\" fill=\"rgba(0,0,0,0.5)\"/> \\\r\n\t\t\t<rect x=\"26\" y=\"27\" width=\"1\" height=\"5\" rx=\"0.5\" fill=\"rgba(0,0,0,0.5)\"/> \\\r\n\t\t\t<rect x=\"5\" y=\"26\" width=\"1\" height=\"5\" rx=\"0.5\" fill=\"url(%23gold3)\"/> \\\r\n\t\t\t<rect x=\"15\" y=\"30\" width=\"2\" height=\"5\" rx=\"1\" fill=\"url(%23gold3)\"/> \\\r\n\t\t\t<rect x=\"26\" y=\"26\" width=\"1\" height=\"5\" rx=\"0.5\" fill=\"url(%23gold3)\"/> \\\r\n\t\t\t<ellipse cx=\"16\" cy=\"18\" rx=\"15\" ry=\"13\" fill=\"rgba(0,0,0,0.5)\"/> \\\r\n\t\t\t<ellipse cx=\"16\" cy=\"16\" rx=\"16\" ry=\"14\" fill=\"url(%23gold1)\"/> \\\r\n\t\t\t<rect x=\"0\" y=\"14\" width=\"32\" height=\"2\" fill=\"url(%23gold1)\"/> \\\r\n\t\t\t<ellipse cx=\"16\" cy=\"14\" rx=\"16\" ry=\"14\" fill=\"url(%23gold2)\"/> \\\r\n\t\t\t<ellipse cx=\"16\" cy=\"14\" rx=\"15\" ry=\"13\" fill=\"url(%23membrane)\"/> \\\r\n\t\t</svg>');\r\n\t--piano-key-symbol: url('data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"32\" height=\"15\" preserveAspectRatio=\"none\" viewBox=\"0 -1 32 15\"> \\\r\n\t\t\t<defs> \\\r\n\t\t\t\t<linearGradient id=\"shadow\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"0%\"> \\\r\n\t\t\t\t\t<stop offset=\"0%\" stop-color=\"rgba(0,0,0,0.5)\"/> \\\r\n\t\t\t\t\t<stop offset=\"100%\" stop-color=\"transparent\"/> \\\r\n\t\t\t\t</linearGradient> \\\r\n\t\t\t</defs> \\\r\n\t\t\t<rect x=\"-1\" y=\"1\" width=\"31\" height=\"1\" rx=\"0.6\" fill=\"rgba(255,255,255,0.4)\"/> \\\r\n\t\t\t<path d=\"M -1 11 L 30 11 L 30 2 L 33 -1 L 33 14 L -1 14 z\" fill=\"rgba(0,0,0,0.7)\"/> \\\r\n\t\t\t<rect x=\"-1\" y=\"-1\" width=\"19\" height=\"15\" fill=\"url(%23shadow)\"/> \\\r\n\t\t</svg>');\r\n}\r\n\r\nhtml {\r\nbackground: ${ColorConfig.pageMargin};\r\n}\r\n\r\n.beepboxEditor .drum-button {\r\n\tflex: 1;\r\n\tbackground-color: transparent;\r\n\tbackground-image: var(--drum-symbol);\r\n\tbackground-repeat: no-repeat;\r\n\tbackground-position: center;\r\n}\r\n\r\n.beepboxEditor .piano-button.pressed, .beepboxEditor .drum-button.pressed {\r\n\tfilter: brightness(0.5);\r\n}\r\n\r\n.beepboxEditor .piano-button {\r\n\tflex: 1;\r\n\tposition: relative;\r\n\tdisplay: flex;\r\n\talign-items: center;\r\n}\r\n.beepboxEditor .piano-button::before {\r\n\tcontent: \"\";\r\n\tposition: absolute;\r\n\tleft: 0;\r\n\ttop: 0;\r\n\twidth: 100%;\r\n\theight: 100%;\r\n\tpointer-events: none;\r\n\tbackground-image: var(--piano-key-symbol);\r\n\tbackground-repeat: no-repeat;\r\n\tbackground-position: center;\r\n\tbackground-size: 100% 115.38%;\r\n}\r\n.beepboxEditor .piano-button.disabled::after {\r\n\tcontent: \"\";\r\n\tposition: absolute;\r\n\tright: 0;\r\n\ttop: 0;\r\n\twidth: 70%;\r\n\theight: 100%;\r\n\tpointer-events: none;\r\n\tbackground: ${ColorConfig.editorBackground};\r\n\t-webkit-mask-image: linear-gradient(90deg, transparent 0%, gray 70%, gray 100%);\r\n\t-webkit-mask-repeat: no-repeat;\r\n\t-webkit-mask-position: center;\r\n\tmask-image: linear-gradient(90deg, transparent 0%, gray 70%, gray 100%);\r\n\tmask-repeat: no-repeat;\r\n\tmask-position: center;\r\n}\r\n\r\n.beepboxEditor .piano-button.pressed, .beepboxEditor .drum-button.pressed {\r\n\tfilter: brightness(0.5);\r\n}\r\n\r\n.beepboxEditor {\r\n\tdisplay: grid;\r\n\tgrid-template-areas: \"pattern-area settings-area advanced-settings-area\" \"pattern-area   song-settings-area advanced-settings-area\" \"track-area   song-settings-area advanced-settings-area\";\r\n\t-webkit-touch-callout: none;\r\n\t-webkit-user-select: none;\r\n\t-khtml-user-select: none;\r\n\t-moz-user-select: none;\r\n\t-ms-user-select: none;\r\n\tuser-select: none;\r\n\tposition: relative;\r\n\ttouch-action: manipulation;\r\n\tcursor: default;\r\n\tfont-size: small;\r\n\tbackground: ${ColorConfig.editorBackground};\r\n}\r\n\r\n.beepboxEditor .theme-option input:checked ~ * {\r\n\tcolor: #fff;\r\n}\r\n\r\n.beepboxEditor .theme-option {\r\n\tcolor: #999;\r\n}\r\n\r\n\r\n.hintButton {\r\n\twidth: 0.5em; \r\n\tdisplay: flex; \r\n\talign-items: center;\r\n}\r\n\r\n.beepboxEditor div {\r\n\tmargin: 0;\r\n\tpadding: 0;\r\n}\r\n\r\n.beepboxEditor .promptContainer {\r\n\tposition: absolute;\r\n\ttop: 0;\r\n\tleft: 0;\r\n\twidth: 100%;\r\n\theight: 100%;\r\n\t/*background: rgba(0,0,0,0.5);*/\r\n\tdisplay: flex;\r\n\tjustify-content: center;\r\n\talign-items: center;\r\n}\r\n\r\n.beepboxEditor .prompt {\r\n\tmargin: auto;\r\n\ttext-align: center;\r\n\tbackground: ${ColorConfig.editorBackground};\r\n\tborder-radius: 15px;\r\n\tborder: 4px solid #444;\r\n\tcolor: #fff;\r\n\tpadding: 20px;\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n}\r\n\r\n.beepboxEditor .prompt > *:not(:first-child) {\r\n\tmargin-top: 1.5em;\r\n}\r\n\r\n/* Use psuedo-elements to add cross-browser up & down arrows to select elements: */\r\n.beepboxEditor .selectContainer {\r\n\tposition: relative;\r\n\twidth: 100%;\r\n}\r\n.beepboxEditor .selectContainer:not(.menu)::before {\r\n\tcontent: \"\";\r\n\tposition: absolute;\r\n\tright: 0.3em;\r\n\ttop: 0.4em;\r\n\tborder-bottom: 0.4em solid currentColor;\r\n\tborder-left: 0.3em solid transparent;\r\n\tborder-right: 0.3em solid transparent;\r\n\tpointer-events: none;\r\n}\r\n.beepboxEditor .selectContainer:not(.menu)::after {\r\n\tcontent: \"\";\r\n\tposition: absolute;\r\n\tright: 0.3em;\r\n\tbottom: 0.4em;\r\n\tborder-top: 0.4em solid currentColor;\r\n\tborder-left: 0.3em solid transparent;\r\n\tborder-right: 0.3em solid transparent;\r\n\tpointer-events: none;\r\n}\r\n.beepboxEditor .selectContainer.menu::after {\r\n\tcontent: \"\";\r\n\tposition: absolute;\r\n\tright: 0.7em;\r\n\tmargin: auto;\r\n\ttop: 0;\r\n\tbottom: 0;\r\n\theight: 0;\r\n\tborder-top: 0.4em solid currentColor;\r\n\tborder-left: 0.3em solid transparent;\r\n\tborder-right: 0.3em solid transparent;\r\n\tpointer-events: none;\r\n}\r\n.beepboxEditor select {\r\n\tmargin: 0;\r\n\tpadding: 0 0.3em;\r\n\tdisplay: block;\r\n\theight: 2em;\r\n\tborder: none;\r\n\tborder-radius: 0.4em;\r\n\tbackground: ${ColorConfig.uiWidgetBackground};\r\n\tcolor: inherit;\r\n\tfont-size: inherit;\r\n\tcursor: pointer;\r\n\tfont-family: inherit;\r\n\r\n\twidth:100%;\r\n\r\n\t-webkit-appearance:none;\r\n\t-moz-appearance: none;\r\n\tappearance: none;\r\n}\r\n.beepboxEditor .menu select {\r\n\tpadding: 0 2em;\r\n}\r\n.beepboxEditor select:focus {\r\n\tbackground: ${ColorConfig.uiWidgetFocus};\r\n\toutline: none;\r\n}\r\n.beepboxEditor .menu select {\r\n\ttext-align: center;\r\n\ttext-align-last: center;\r\n}\r\n\r\n/* This makes it look better in firefox on my computer... What about others?\r\n@-moz-document url-prefix() {\r\n\t.beepboxEditor select { padding: 0 2px; }\r\n}\r\n*/\r\n.beepboxEditor button {\r\n\tmargin: 0;\r\n\tposition: relative;\r\n\theight: 2em;\r\n\tborder: none;\r\n\tborder-radius: 0.4em;\r\n\tbackground: ${ColorConfig.uiWidgetBackground};\r\n\tcolor: inherit;\r\n\tfont-size: inherit;\r\n\tfont-family: inherit;\r\n\tcursor: pointer;\r\n}\r\n.beepboxEditor .numberInput {\r\n\twidth: 3em !important;\r\n  \tmargin-left: 1em;\r\n}\r\n.beepboxEditor button:focus {\r\n\tbackground: ${ColorConfig.uiWidgetFocus};\r\n\toutline: none;\r\n}\r\n.beepboxEditor button.playButton, .beepboxEditor button.pauseButton {\r\n\tpadding-left: 2em;\r\n}\r\n.beepboxEditor button.playButton::before {\r\n\tcontent: \"\";\r\n\tposition: absolute;\r\n\tleft: 0.7em;\r\n\ttop: 50%;\r\n\tmargin-top: -0.65em;\r\n\tborder-left: 1em solid currentColor;\r\n\tborder-top: 0.65em solid transparent;\r\n\tborder-bottom: 0.65em solid transparent;\r\n\tpointer-events: none;\r\n}\r\n.beepboxEditor button.pauseButton::before {\r\n\tcontent: \"\";\r\n\tposition: absolute;\r\n\tleft: 0.7em;\r\n\ttop: 50%;\r\n\tmargin-top: -0.65em;\r\n\twidth: 0.3em;\r\n\theight: 1.3em;\r\n\tbackground: currentColor;\r\n\tpointer-events: none;\r\n}\r\n.beepboxEditor button.pauseButton::after {\r\n\tcontent: \"\";\r\n\tposition: absolute;\r\n\tleft: 1.4em;\r\n\ttop: 50%;\r\n\tmargin-top: -0.65em;\r\n\twidth: 0.3em;\r\n\theight: 1.3em;\r\n\tbackground: currentColor;\r\n\tpointer-events: none;\r\n}\r\n\r\n.beepboxEditor button.prevBarButton::before {\r\n\tcontent: \"\";\r\n\tposition: absolute;\r\n\tleft: 50%;\r\n\ttop: 50%;\r\n\tmargin-left: -0.5em;\r\n\tmargin-top: -0.5em;\r\n\twidth: 0.2em;\r\n\theight: 1em;\r\n\tbackground: currentColor;\r\n\tpointer-events: none;\r\n}\r\n.beepboxEditor button.prevBarButton::after {\r\n\tcontent: \"\";\r\n\tposition: absolute;\r\n\tleft: 50%;\r\n\ttop: 50%;\r\n\tmargin-left: -0.3em;\r\n\tmargin-top: -0.5em;\r\n\tborder-right: 0.8em solid currentColor;\r\n\tborder-top: 0.5em solid transparent;\r\n\tborder-bottom: 0.5em solid transparent;\r\n\tpointer-events: none;\r\n}\r\n\r\n.beepboxEditor .song-settings-area {\r\n\tgrid-area: song-settings-area;\r\n}\r\n\r\n.beepboxEditor button.nextBarButton::before {\r\n\tcontent: \"\";\r\n\tposition: absolute;\r\n\tleft: 50%;\r\n\ttop: 50%;\r\n\tmargin-left: -0.5em;\r\n\tmargin-top: -0.5em;\r\n\tborder-left: 0.8em solid currentColor;\r\n\tborder-top: 0.5em solid transparent;\r\n\tborder-bottom: 0.5em solid transparent;\r\n\tpointer-events: none;\r\n}\r\n.beepboxEditor button.nextBarButton::after {\r\n\tcontent: \"\";\r\n\tposition: absolute;\r\n\tleft: 50%;\r\n\ttop: 50%;\r\n\tmargin-left: 0.3em;\r\n\tmargin-top: -0.5em;\r\n\twidth: 0.2em;\r\n\theight: 1em;\r\n\tbackground: currentColor;\r\n\tpointer-events: none;\r\n}\r\n\r\n.beepboxEditor canvas {\r\n\toverflow: hidden;\r\n\tposition: absolute;\r\n\tdisplay: block;\r\n}\r\n\r\n.beepboxEditor .trackContainer {\r\n\toverflow-x: hidden;\r\n}\r\n\r\n.beepboxEditor .trackAndMuteContainer {\r\n\tdisplay: flex;\r\n\talign-items: flex-start;\r\n\twidth: 100%;\r\n\tmin-height: 0;\r\n\tflex: 1;\r\n\toverflow-x: hidden;\r\n\tposition: relative;\r\n}\r\n\r\n.beepboxEditor .selectRow {\r\n\tmargin: 0;\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n\talign-items: center;\r\n\tjustify-content: space-between;\r\n}\r\n\r\n.beepboxEditor .selectRow > span {\r\n\tcolor: ${ColorConfig.secondaryText};\r\n}\r\n\r\n.beepboxEditor .inputRow {\r\n\tmargin: 0;\r\n\theight: 2.5em;\r\n\tdisplay: flex;\r\n\tflex-direction: row;\r\n\talign-items: center;\r\n\tjustify-content: space-between;\r\n}\r\n\r\n.beepboxEditor .inputRow > span {\r\n\tcolor: ${ColorConfig.secondaryText};\r\n}\r\n\r\n.beepboxEditor .operatorRow {\r\n\tmargin: 0;\r\n\theight: 2.5em;\r\n\tdisplay: flex;\r\n\tflex-direction: row;\r\n\talign-items: center;\r\n}\r\n\r\n.beepboxEditor .operatorRow > * {\r\n\tflex-grow: 1;\r\n\tflex-shrink: 1;\r\n}\r\n\r\n.beepboxEditor .settings-area {\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n}\r\n\r\n.beepboxEditor .editor-widgets {\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n}\r\n\r\n.beepboxEditor .editor-menus {\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n}\r\n\r\n.beepboxEditor .editor-settings {\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n\tmargin-left: 6px;\r\n}\r\n\r\n.beepboxEditor .layout-option {\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n\tcursor: pointer;\r\n\tcolor: ${ColorConfig.secondaryText};\r\n\twidth: 25%;\r\n}\r\n\r\n.beepboxEditor .layout-option input {\r\n\tdisplay: none;\r\n}\r\n\r\n.beepboxEditor .layout-option input:checked ~ * {\r\n\tcolor: ${ColorConfig.primaryText};\r\n}\r\n\r\n.beepboxEditor .editor-song-settings {\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n}\r\n\r\n.beepboxEditor .editor-instrument-settings {\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n}\r\n.beepboxEditor .advanced-settings-area {\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n\tgrid-area: advanced-settings-area;\r\n}\r\n\r\n.beepboxEditor .editorBox {\r\n\tgrid-area: pattern-area;\r\n}\r\n\r\n.beepboxEditor .track-area {\r\n\tgrid-area: track-area;\r\n}\r\n\r\n.beepboxEditor .editor-right-menus {\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n}\r\n\r\n.beepboxEditor .editor-right-settings {\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n}\r\n\r\n.beepboxEditor .editor-right-song-settings {\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n}\r\n\r\n.beepboxEditor .editor-right-instrument-settings {\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n}\r\n\r\n.beepboxEditor .editor-right-side-top > *, .beepboxEditor .editor-right-side-bottom > * {\r\n\tflex-shrink: 0;\r\n}\r\n\r\n.beepboxEditor input[type=text], .beepboxEditor input[type=number] {\r\n\tfont-size: inherit;\r\n\tbackground: transparent;\r\n\tborder: 1px solid #777;\r\n\tcolor: white;\r\n}\r\n\r\n.beepboxEditor input[type=checkbox] {\r\n  transform: scale(1.5);\r\n}\r\n\r\n.beepboxEditor input[type=range] {\r\n\t-webkit-appearance: none;\r\n\tcolor: inherit;\r\n\twidth: 100%;\r\n\theight: 2em;\r\n\tfont-size: inherit;\r\n\tmargin: 0;\r\n\tcursor: pointer;\r\n\tbackground-color: ${ColorConfig.editorBackground};\r\n\ttouch-action: pan-y;\r\n}\r\n.beepboxEditor input[type=range]:focus {\r\n\toutline: none;\r\n}\r\n.beepboxEditor input[type=range]::-webkit-slider-runnable-track {\r\n\twidth: 100%;\r\n\theight: 0.5em;\r\n\tcursor: pointer;\r\n\tbackground: ${ColorConfig.uiWidgetBackground};\r\n}\r\n.beepboxEditor input[type=range]::-webkit-slider-thumb {\r\n\theight: 2em;\r\n\twidth: 0.5em;\r\n\tborder-radius: 0.25em;\r\n\tbackground: currentColor;\r\n\tcursor: pointer;\r\n\t-webkit-appearance: none;\r\n\tmargin-top: -0.75em;\r\n}\r\n.beepboxEditor input[type=range]:focus::-webkit-slider-runnable-track {\r\n\tbackground: ${ColorConfig.uiWidgetFocus};\r\n}\r\n.beepboxEditor input[type=range]::-moz-range-track {\r\n\twidth: 100%;\r\n\theight: 0.5em;\r\n\tcursor: pointer;\r\n\tbackground: ${ColorConfig.uiWidgetBackground};\r\n}\r\n.beepboxEditor input[type=range]:focus::-moz-range-track {\r\n\tbackground: ${ColorConfig.uiWidgetFocus};\r\n}\r\n.beepboxEditor input[type=range]::-moz-range-thumb {\r\n\theight: 2em;\r\n\twidth: 0.5em;\r\n\tborder-radius: 0.25em;\r\n\tborder: none;\r\n\tbackground: currentColor;\r\n\tcursor: pointer;\r\n}\r\n.beepboxEditor input[type=range]::-ms-track {\r\n\twidth: 100%;\r\n\theight: 0.5em;\r\n\tcursor: pointer;\r\n\tbackground: ${ColorConfig.uiWidgetBackground};\r\n\tborder-color: transparent;\r\n}\r\n.beepboxEditor input[type=range]:focus::-ms-track {\r\n\tbackground: ${ColorConfig.uiWidgetFocus};\r\n}\r\n.beepboxEditor input[type=range]::-ms-thumb {\r\n\theight: 2em;\r\n\twidth: 0.5em;\r\n\tborder-radius: 0.25em;\r\n\tbackground: currentColor;\r\n\tcursor: pointer;\r\n}\r\n.beepboxEditor .hintButton {\r\n\tborder: 1px solid currentColor;\r\n\tborder-radius: 50%;\r\n\ttext-decoration: none;\r\n\theight: 1em;\r\n\ttext-align: center;\r\n\tmargin-right: .4em;\r\n\tcursor: pointer;\r\n}\r\n\r\n/* wide screen */\r\n@media (min-width: 501px) {\r\n\t#beepboxEditorContainer {\r\n\t\tdisplay: table;\r\n\t}\r\n\t.beepboxEditor {\r\n\t\tflex-direction: row;\r\n\t}\r\n\t.beepboxEditor:focus-within {\r\n\t\toutline: 3px solid #555;\r\n\t}\r\n\t.beepboxEditor .trackContainer {\r\n\t\twidth: 512px;\r\n\t\tgrid-area: track-editor;\r\n\t}\r\n\t.beepboxEditor .trackSelectBox {\r\n\t\tdisplay: none;\r\n\t}\r\n\t.beepboxEditor .playback-controls {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t}\r\n\t.beepboxEditor .playback-bar-controls {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: row;\r\n\t\tmargin: .2em 0;\r\n\t}\r\n\t.beepboxEditor .playback-volume-controls {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: row;\r\n\t\tmargin: .2em 0;\r\n\t\talign-items: center;\r\n\t}\r\n\t.beepboxEditor .pauseButton, .beepboxEditor .playButton {\r\n\t\tflex-grow: 1;\r\n\t}\r\n\t.beepboxEditor .nextBarButton, .beepboxEditor .prevBarButton {\r\n\t\tflex-grow: 1;\r\n\t\tmargin-left: 10px;\r\n\t}\r\n\t.beepboxEditor .settings-area {\r\n\t\tmargin-left: 6px;\r\n\t\twidth: 14em;\r\n\t\tflex-direction: column;\r\n\t\tgrid-area: settings-area;\r\n\t}\r\n\t.beepboxEditor .advanced-settings-area {\r\n\t\tmargin-left: 6px;\r\n\t\twidth: 14em;\r\n\t\tflex-direction: column;\r\n\t}\r\n\t.beepboxEditor .editor-widgets {\r\n\t\tflex-grow: 1;\r\n\t}\r\n\t.beepboxEditor .editor-right-widgets {\r\n\t\tflex-grow: 1;\r\n\t}\r\n\t.beepboxEditor .editor-right-settings input, .beepboxEditor .editor-right-settings select {\r\n\t\twidth: 100%;\r\n\t}\r\n\t.beepboxEditor .editor-menus > * {\r\n\t\tflex-grow: 1;\r\n\t\tmargin: .2em 0;\r\n\t}\r\n\t.beepboxEditor .editor-right-menus > * {\r\n\t\tflex-grow: 1;\r\n\t\tmargin: .2em 0;\r\n\t}\r\n\t.beepboxEditor .editor-menus > button {\r\n\t\tpadding: 0 2em;\r\n\t\twhite-space: nowrap;\r\n\t}\r\n\t.beepboxEditor .editor-right-menus > button {\r\n\t\tpadding: 0 2em;\r\n\t\twhite-space: nowrap;\r\n\t}\r\n}\r\n\r\n/* narrow screen */\r\n@media (max-width: 500px) {\r\n\t.beepboxEditor {\r\n\t\tflex-direction: column;\r\n\t}\r\n\t.beepboxEditor:focus-within {\r\n\t\toutline: none;\r\n\t}\r\n\t.beepboxEditor .editorBox {\r\n\t\tmax-height: 75vh;\r\n\t\tgrid-area: pattern-area;\r\n\t}\r\n\t.beepboxEditor .editor-menus {\r\n\t\tflex-direction: row;\r\n\t}\r\n\t.beepboxEditor .editor-right-menus {\r\n\t\tflex-direction: row;\r\n\t}\r\n\t.beepboxEditor .editor-menus > * {\r\n\t\tflex-grow: 1;\r\n\t\tmargin: .10em;\r\n\t}\r\n\t.beepboxEditor .editor-right-menus > * {\r\n\t\tflex-grow: 1;\r\n\t\tmargin: .2em;\r\n\t}\r\n\t.beepboxEditor .editor-menus > button {\r\n\t\tpadding-left: 2em;\r\n\t\twhite-space: nowrap;\r\n\t}\r\n\t.beepboxEditor .editor-right-menus > button {\r\n\t\tpadding-left: 2em;\r\n\t\twhite-space: nowrap;\r\n\t}\r\n\t.beepboxEditor .trackContainer {\r\n\t\toverflow-x: auto;\r\n\t}\r\n\t.beepboxEditor .barScrollBar {\r\n\t\tdisplay: none;\r\n\t}\r\n\t.beepboxEditor .playback-controls {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: row;\r\n\t\tmargin: .2em 0;\r\n\t}\r\n\t.beepboxEditor .playback-bar-controls {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: row;\r\n\t\tflex-grow: 1;\r\n\t}\r\n\t.beepboxEditor .playback-volume-controls {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: row;\r\n\t\talign-items: center;\r\n\t\tflex-grow: 1;\r\n\t\tmargin: 0 .2em;\r\n\t}\r\n\t.beepboxEditor .settings-area {\r\n\t\tflex-direction: column-reverse;\r\n\t}\r\n\t.beepboxEditor .editor-settings {\r\n\t\tflex-direction: row;\r\n\t\tmargin-left: 6px;\r\n\t}\r\n\t.beepboxEditor .advanced-settings-area {\r\n\t\tflex-direction: column-reverse;\r\n\t}\r\n\t.beepboxEditor .editor-right-settings {\r\n\t\tflex-direction: row;\r\n\t}\r\n\t.beepboxEditor .pauseButton, .beepboxEditor .playButton,\r\n\t.beepboxEditor .nextBarButton, .beepboxEditor .prevBarButton {\r\n\t\tflex-grow: 1;\r\n\t\tmargin: 0 .2em;\r\n\t}\r\n\t.beepboxEditor .editor-song-settings, .beepboxEditor .editor-instrument-settings {\r\n\t\tflex-grow: 1;\r\n\t\tmargin: 0 .2em;\r\n\t}\r\n\t.beepboxEditor .editor-right-song-settings, .beepboxEditor .editor-right-instrument-settings {\r\n\t\tflex-grow: 1;\r\n\t\tmargin: 0 .2em;\r\n\t}\r\n\t.beepboxEditor .editor-settings input, .beepboxEditor .editor-settings .selectContainer {\r\n\t\twidth: 100%;\r\n\t}\r\n\t.beepboxEditor .editor-right-settings input, .beepboxEditor .editor-right-settings .selectContainer {\r\n\t\twidth: 100%;\r\n\t}\r\n\t.beepboxEditor .editor-settings select {\r\n\t\twidth: 100%;\r\n\t}\r\n\t.beepboxEditor .editor-right-settings select {\r\n\t\twidth: 100%;\r\n\t}\r\n\t.fullWidthOnly {\r\n\t\tdisplay: none;\r\n\t}\r\n\tp {\r\n\t\tmargin: 1em 0.5em;\r\n\t}\r\n}\r\n`));\r\n\t\r\n","// Copyright (c) 2012-2022 John Nesky and contributing authors, distributed under the MIT license, see accompanying the LICENSE.md file.\r\n\r\nimport {InstrumentType, Config} from \"../synth/SynthConfig\";\r\nimport {isMobile, SongEditor} from \"./SongEditor\";\r\nimport {Synth} from \"../synth/synth\";\r\nimport {Instrument, Channel, NotePin, Note, Pattern, Song } from \"../synth/song\";\r\nimport {SongDocument} from \"./SongDocument\";\r\nimport {ExportPrompt} from \"./ExportPrompt\";\r\nimport \"./style\"; // Import for the side effects, there's no exports.\r\n\r\nconst doc: SongDocument = new SongDocument(location.hash);\r\nconst editor: SongEditor = new SongEditor(doc);\r\nconst beepboxEditorContainer: HTMLElement = document.getElementById(\"beepboxEditorContainer\")!;\r\nbeepboxEditorContainer.appendChild(editor.mainLayer);\r\neditor.whenUpdated();\r\neditor.mainLayer.focus();\r\n\r\nif (!isMobile && doc.prefs.autoPlay) {\r\n\tfunction autoplay(): void {\r\n\t\tif (!document.hidden) {\r\n\t\t\tdoc.synth.play();\r\n\t\t\teditor.updatePlayButton();\r\n\t\t\twindow.removeEventListener(\"visibilitychange\", autoplay);\r\n\t\t}\r\n\t}\r\n\tif (document.hidden) {\r\n\t\t// Wait until the tab is visible to autoplay:\r\n\t\twindow.addEventListener(\"visibilitychange\", autoplay);\r\n\t} else {\r\n\t\tautoplay();\r\n\t}\r\n}\r\n\r\n// BeepBox uses browser history state as its own undo history. Browsers typically\r\n// remember scroll position for each history state, but BeepBox users would prefer not \r\n// auto scrolling when undoing. Sadly this tweak doesn't work on Edge or IE.\r\nif (\"scrollRestoration\" in history) history.scrollRestoration = \"manual\";\r\n\r\neditor.updatePlayButton();\r\n\r\nif (\"serviceWorker\" in navigator) {\r\n\tnavigator.serviceWorker.register(\"/service_worker.js\", {updateViaCache: \"all\", scope: \"/\"}).catch(() => {});\r\n}\r\n\r\n// When compiling synth.ts as a standalone module named \"beepbox\", expose these classes as members to JavaScript:\r\nexport {InstrumentType, Config, NotePin, Note, Pattern, Instrument, Channel, Song, Synth, SongDocument, SongEditor, ExportPrompt};\r\n"],"mappings":"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","ignoreList":[]}
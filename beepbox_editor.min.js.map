{"version":3,"names":["scaleElementsByFactor","array","factor","i","length","countBits","n","isPowerOf2","Error","Math","round","log","inverseRealFourierTransform","fullArrayLength","totalPasses","pass","subStride","midSubStride","stride","radiansIncrement","PI","cosIncrement","cos","sinIncrement","sin","oscillatorMultiplier","startIndex","startIndexA","midIndexA","startIndexB","midIndexB","stopIndex","realStartA","imagStartB","c","s","cPrev","sPrev","index","indexA0","indexA1","indexB0","indexB1","real0","real1","imag0","imag1","tempA","tempB","cTemp","sTemp","index1","index2","index3","imag2","imag3","bitCount","finalShift","j","temp","reverseIndexBits","Config","_centerWave","wave","sum","average","Float64Array","getDrumWave","_drumWaves","Float32Array","drumBuffer","newBuffer","random","drawNoiseSpectrum","sqrt","lowOctave","highOctave","lowPower","highPower","overalSlope","lowIndex","pow","highIndex","log2","amplitude","radians","generateSineWave","sineWaveLength","toNameMap","dictionary","value","name","result","scales","realName","flags","blackKeyNameParents","pitchNames","oldKeys","keys","isWhiteKey","basePitch","mixNames","sampleRateNames","tempoSteps","reverbRange","blendRange","riffRange","detuneRange","muffRange","beatsPerBarMin","beatsPerBarMax","barCountMin","barCountMax","patternsPerChannelMin","patternsPerChannelMax","instrumentsPerChannelMin","instrumentsPerChannelMax","pitchesPerOctave","drumCount","pitchOctaves","partNames","partCounts","waveNames","waveVolumes","drumNames","drumVolumes","drumBasePitches","drumPitchFilterMult","drumWaveIsSoft","pwmwaveNames","pwmwaveVolumes","filterNames","filterBases","filterDecays","filterVolumes","transitionNames","effectNames","effectVibratos","effectTremolos","effectVibratoDelays","chorusNames","chorusIntervals","chorusOffsets","chorusVolumes","chorusSigns","chorusRiffApp","chorusHarmonizes","harmDisplay","harmNames","fmChorusDisplay","fmChorusNames","imuteNames","imuteValues","octoffNames","octoffValues","volumeNames","volumeValues","volumeMValues","ipanValues","operatorCount","operatorAlgorithmNames","midiAlgorithmNames","operatorModulatedBy","operatorAssociatedCarrier","operatorCarrierCounts","operatorCarrierChorus","operatorAmplitudeMax","operatorFrequencyNames","midiFrequencyNames","operatorFrequencies","operatorHzOffsets","operatorAmplitudeSigns","operatorEnvelopeNames","operatorEnvelopeType","operatorSpecialCustomVolume","operatorEnvelopeSpeed","operatorEnvelopeInverted","operatorFeedbackNames","midiFeedbackNames","operatorFeedbackIndices","pitchChannelTypeNames","pitchChannelTypeValues","drumChannelTypeNames","instrumentTypeNames","oldThemeNames","channelOneBrightColorPallet","channelTwoBrightColorPallet","channelThreeBrightColorPallet","channelFourBrightColorPallet","channelFiveBrightColorPallet","channelSixBrightColorPallet","channelSevenBrightColorPallet","channelEightBrightColorPallet","channelNineBrightColorPallet","channelTenBrightColorPallet","channelElevenBrightColorPallet","channelTwelveBrightColorPallet","channelThirteenBrightColorPallet","channelFourteenBrightColorPallet","channelFifteenBrightColorPallet","channelSixteenBrightColorPallet","channelOneDimColorPallet","channelTwoDimColorPallet","channelThreeDimColorPallet","channelFourDimColorPallet","channelFiveDimColorPallet","channelSixDimColorPallet","channelSevenDimColorPallet","channelEightDimColorPallet","channelNineDimColorPallet","channelTenDimColorPallet","channelElevenDimColorPallet","channelTwelveDimColorPallet","channelThirteenDimColorPallet","channelFourteenDimColorPallet","channelFifteenDimColorPallet","channelSixteenDimColorPallet","pitchChannelColorsDim","pitchChannelColorsBright","pitchNoteColorsDim","pitchNoteColorsBright","drumChannelColorsDim","drumChannelColorsBright","drumNoteColorsDim","drumNoteColorsBright","midiPitchChannelNames","midiDrumChannelNames","midiSustainInstruments","midiDecayInstruments","drumInterval","pitchCount","maxPitch","pitchChannelCountMin","pitchChannelCountMax","drumChannelCountMin","drumChannelCountMax","waves","wavesMixC","pwmwaves","sineWaveMask","sineWave","applyElementArgs","element","args","args_1","__values","args_1_1","next","done","arg","Node","appendChild","document","createTextNode","Array","isArray","Symbol","iterator","__spread","constructor","Object","Element","_d","e_2","_e","key","setAttribute","join","console","warn","tagName","_f","e_3","_g","styleKey","style","setProperty","removeAttribute","svgNS","HTML","_i","arguments","createRange","createContextualFragment","SVG","fragment","createDocumentFragment","svgParser","DOMParser","parseFromString","documentElement","firstChild","importNode","name_1","createElement","_c","split","name_2","createElementNS","test","snakeCaseName","replace","clamp","min","max","val","BitFieldReader","base64CharCodeToInt","source","this","_bits","_readIndex","charCodeAt","push","read","readLongTail","minValue","minBits","numBits","readPartDuration","readPinCount","readPitchInterval","BitFieldWriter","write","writeLongTail","writePartDuration","writePinCount","writePitchInterval","concat","other","encodeBase64","base64IntToCharCode","buffer","lengthBase64","ceil","Operator","frequency","envelope","reset","copy","makeNotePin","interval","time","volume","makeNote","pitch","start","end","fadeout","pitches","pins","Instrument","type","filter","transition","effect","harm","fmChorus","imute","octoff","chorus","ipan","algorithm","feedbackType","feedbackAmplitude","feedbackEnvelope","operators","setTypeAndReset","Channel","octave","instruments","patterns","bars","Pattern","notes","instrument","cloneNotes","oldNote","newNote","oldPin","Song","string","channels","_fingerprint","undefined","fromBase64String","initToDefault","getChannelCount","pitchChannelCount","drumChannelCount","getChannelUnusedCount","getTimeSig","beatsPerBar","partsPerBeat","barCount","getScaleNKey","scale","getChannelIsDrum","channel","getChannelColorDim","getChannelColorBright","getNoteColorDim","getNoteColorBright","andResetChannels","setSongTheme","map","indexOf","mix","sampleRate","loopStart","loopLength","tempo","reverb","blend","riff","detune","muff","patternsPerChannel","instrumentsPerChannel","channelIndex","pattern","bar","toBase64String","bits","_base64IntToCharCode","_variant","_latestNepBoxVersion","encodedSongTheme","encodeURIComponent","o","neededBits","neededInstrumentBits","isDrum","octaveOffset","lastPitch","recentPitches","recentShapes","p","curPart","t","shapeBits","shapePart","startPitch","currentPitch","pitchBends","pin","nextPitch","shapeString","String","fromCharCode","apply","shapeIndex","splice","unshift","pop","allPitches","pitchIndex","pitchIter","stringLength","digits","prototype","compressed","charIndex","fromJsonObject","JSON","parse","substring","fromOld","fromNepBox","version","_base64CharCodeToInt","_latestBeepboxVersion","_oldestBeepboxVersion","_oldestNepBoxVersion","beforeThree","beforeFour","beforeFive","beforeSix","instrumentChannelIterator","instrumentIndexIterator","command","themeIndex","songThemeLength","decodeURIComponent","isPitchChannel","instrumentType","isDrums","subStringLength","bitStringLength","bitStringLengthLength","note","newPattern","newNotes","useOldShape","shape","pinObj","pinCount","initialVolume","bendCount","pitchBend","intervalIter","shift","toJsonObject","enableIntro","loopCount","enableOutro","channelArray","instrumentArray","operatorArray","operator","patternArray","noteArray","pointArray","tick","points","sequenceArray","l","octaveScrollBar","sequence","format","_format","theme","introBars","loopBars","ticksPerBeat","beatsPerMinute","getBeatsPerMinute","jsonObject","oldScaleNames","themes","bpm","LN2","maxInstruments","maxPatterns","maxBars","channelObject","instrumentObject","oldTransitionNames","binary","transitionObject","oldFilterNames","operatorObject","patternObject","maxNoteCount","tickClock","noteObject","k","noteClock","startInterval","pointObject","lowestPitch","highestPitch","getPattern","patternIndex","getPatternInstrument","getPatternInstrumentMute","instrumentIndex","getPatternInstrumentVolume","getChannelFingerprint","channelCount","charCount","Change","_noop","_didSomething","isNoop","commit","UndoableChange","reversed","super","_reversed","_doneForwards","undo","_doForwards","_doBackwards","redo","_isDoneForwards","ChangeGroup","append","change","ChangeSequence","changes","_changes","ChangePins","_doc","_note","_oldStart","_oldEnd","_newStart","_newEnd","_oldPins","_newPins","_oldPitches","_newPitches","_finishSetup","firstInterval","firstTime","notifier","changed","ChangeInstrumentType","doc","newValue","song","getCurrentInstrument","ChangeTransition","ChangePattern","oldValue","ChangeBarCount","newBar","newBarScrollPos","barScrollPos","newLoopStart","newLoopLength","trackVisibleBars","ChangeInsertBars","count","newLength","ChangeDeleteBars","ChangeChannelCount","newPitchChannelCount","newDrumChannelCount","newChannels","oldChannel","ChangeBeatsPerBar","ChangeNoteTruncate","ChangeChannelOrder","selectionMin","selectionMax","offset","ChangeAddChannel","isNoise","newNoiseChannelCount","addedChannelIndex","ChangeRemoveChannel","minIndex","maxIndex","ChangeChannelBar","newChannel","oldBar","ChangeChorus","ChangeEffect","ChangeHarm","ChangeFMChorus","ChangeOctoff","ChangeImute","ChangeAllImute","ChangeSoloChannels","curChannel","curInstrument","ChangeIpan","ChangeFilter","ChangeAlgorithm","ChangeFeedbackType","ChangeFeedbackEnvelope","ChangeOperatorEnvelope","operatorIndex","ChangeOperatorFrequency","ChangeOperatorAmplitude","ChangeFeedbackAmplitude","ChangeInstrumentsPerChannel","newInstrumentsPerChannel","sampleInstrument","newInstrument","ChangeKey","ChangeSongTheme","ChangeLoop","oldStart","oldLength","newStart","ChangePitchAdded","deletion","_pitch","_index","ChangeOctave","ChangePartsPerBeat","ChangeRhythm","ChangePaste","newBeatsPerBar","newPartsPerBeat","ChangePatternInstrument","ChangePatternsPerChannel","channelBars","channelPatterns","ChangeEnsurePatternExists","_patternOldNotes","_bar","_channel","_oldPatternCount","_newPatternCount","firstEmptyUnusedIndex","firstUnusedIndex","used","barIndex","_patternIndex","ChangePinTime","pinIndex","shiftedTime","originalTime","skipStart","skipEnd","setPin","ChangePitchBend","bendStart","bendEnd","bendTo","direction","stop","setStart","setEnd","prevInterval","prevVolume","persist","item","oldPartsPerBeat","changeRhythm","oldTime","floor","ChangeNoteAdded","ChangeRhythmNote","ChangeScale","ChangeMix","ChangeSampleRate","ChangeSong","newHash","ChangeTempo","ChangeReverb","ChangeBlend","ChangeRiff","ChangeDetune","ChangeMuff","_pattern","ChangeNoteLength","truncStart","truncEnd","pushLastPin","skipNote","ChangeTransposeNote","upward","foundMatch","diff","ChangeTranspose","ChangeVolume","ChangeVolumeBend","bendPart","bendVolume","bendInterval","inserted","ChangeWave","ColorConfig","getChannelColor","pitchChannels","noiseChannels","setTheme","_styleElement","textContent","_themeMap","usesPianoScheme","getComputedStyle","getPropertyValue","trim","colorLookup","Map","default","nepbox","laffey","modbox2","artic","Ocean","rainbow","float","windows","grassland","dessert","kahootiest","beambit","egg","Poniryoshka","gameboy","woodkid","midnight","snedbox","unnamed","piano","halloween","frozen","pageMargin","editorBackground","hoverPreview","playhead","primaryText","secondaryText","invertedText","textSelection","boxSelectionFill","loopAccent","linkAccent","uiWidgetBackground","uiWidgetFocus","pitchBackground","tonic","fifthNote","pitch1Background","pitch2Background","pitch3Background","pitch4Background","pitch5Background","pitch6Background","pitch8Background","pitch9Background","pitch10Background","pitch11Background","volumeIcon","octaveScrollbar","scrollbarOctave","channelBox","blackPianoKey","whitePianoKey","secondaryChannel","primaryChannel","secondaryNote","primaryNote","head","div","prettyNumber","toFixed","PatternCursor","valid","prevNote","curNote","nextNote","curIndex","part","notePart","nearPinIndex","PatternEditor","_svgNoteBackground","id","x","y","width","height","patternUnits","_svgDrumBackground","_svgBackground","rect","fill","_svgNoteContainer","svg","_svgPlayhead","_svgPreview","path","stroke","_svg","viewBox","preserveAspectRatio","defs","container","_defaultPitchHeight","_defaultDrumHeight","_backgroundPitchRows","_backgroundDrumRow","_defaultPinChannels","_editorHeight","_mouseX","_mouseY","_mouseDown","_mouseOver","_mouseDragging","_mouseHorizontal","_usingTouch","_copiedPinChannels","_mouseXStart","_mouseYStart","_mouseXPrev","_mouseYPrev","_dragTime","_dragPitch","_dragVolume","_dragVisible","_dragChange","_cursor","_playheadX","_octaveOffset","_renderedWidth","_renderedBeatWidth","_renderedFifths","_renderedACS","_renderedPiano","_renderedDrums","_setKey","_renderedPartsPerBeat","_renderedPitchChannelCount","_renderedDrumChannelCount","_followPlayheadBar","resetCopiedPins","maxDivision","_getMaxDivision","_animatePlayhead","timestamp","playheadBar","synth","playing","modPlayhead","abs","_editorWidth","prefs","autoFollow","notifyWatchers","window","requestAnimationFrame","_whenMouseOver","event","_whenMouseOut","_whenMousePressed","preventDefault","boundingRect","getBoundingClientRect","clientX","pageX","left","right","clientY","pageY","top","bottom","isNaN","_whenCursorPressed","_whenTouchPressed","touches","_whenMouseMoved","_whenCursorMoved","_whenTouchMoved","_whenCursorReleased","continuousState","lastChangeWas","record","getCurrentPattern","_copyPins","_updateCursorStatus","_updatePreview","_documentChanged","showLetters","showScrollBar","_partWidth","_pitchHeight","_pitchCount","_copiedPins","beatWidth","node","clone","cloneNode","parentNode","replaceChild","makeEmptyReplacementElement","visibility","showChannels","pattern2","notePath","_drawNote","oscillatorLabel","text","_pitchToPixelHeight","rectangle","backgroundColor","watch","addEventListener","mousePitch","_findMousePitch","prevPin","error","nextPin","leftSide","rightSide","intervalRatio","arc","bendHeight","minInterval","Number","MAX_VALUE","maxInterval","bestDistance","pinDistance","_snapToPitch","nearest","distance","defaultLength","fullBeats","modMouse","division","forceStart","forceEnd","pixelY","guess","topPitch","bottomPitch","topRange","bottomRange","setProspectiveChange","dx","dy","currentPart","backwards","directLength","blessedLength","theNote","shiftedPin","volumeRatio","minPitch","radius","pathString","render","showMore","showFifth","svgElement","showVolume","prevSide","nextSide","prevHeight","nextHeight","nextVolume","select","option","Box","color","_label","_rect","_vol1","_volb","_renderedIndex","_renderedDim","_renderedSelected","_renderedColor","setSquashed","squashed","setIndex","dim","selected","colorB","innerHTML","TrackEditor","_barWidth","_select","class","_boxContainer","g","_playhead","_boxHighlight","_upHighlight","_downHighlight","_grid","_digits","_channelHeight","_renderedChannelCount","_renderedBarCount","_renderedPatternCount","_renderedPlayhead","_renderedSquashed","_changePattern","_whenSelectChanged","_setPattern","selectedIndex","up","patternCount","_setChannelBar","_whenMouseReleased","forgetLastChange","currentValue","canReplaceLastChange","_nextDigit","digit","parsed","parseInt","wideScreen","innerWidth","center","middle","base","tip","removeChild","lastChild","selectedPattern","box","showVolumeBar","editorWidth","patternMute","patternVolume","mute","LoopEditor","_startMode","_endMode","_bothMode","_loop","_highlight","_change","startBar","mode","_clientStartX","_clientStartY","_startedScrolling","_draggingHorizontally","_renderedLoopStart","_renderedLoopStop","_whenTouchReleased","_render","_findEndPoints","oldEnd","endPoints","showHighlight","highlightStart","highlightStop","loopStop","BarScrollBar","_trackContainer","_notches","_handle","_handleHighlight","_leftHighlight","_rightHighlight","_dragging","_renderedNotchCount","_renderedBarPos","_onScroll","scrollLeft","_dragStart","capture","passive","showleftHighlight","showRightHighlight","showHandleHighlight","resized","lineHeight","OctaveScrollBar","_notchHeight","_octaveCount","_octaveHeight","_barHeight","_renderedBarBottom","_barBottom","currentOctave","showUpHighlight","showDownHighlight","canvas","Piano","_pianoContainer","_drumContainer","_preview","_pianoKeys","_pianoLabels","_renderedScale","_renderedKey","_renderedPitchCount","_renderedLiveInputPitches","_updateCursorPitch","pianoPitch","_cursorPitch","pianoPressed","getVisiblePitchCount","display","pianoLabel","pianoKey","pitchNameIndex","background","classList","remove","label","getPitchName","add","pitchHeight","getBaseVisibleOctave","children","child","scaleIndex","shiftDir","button","MixPrompt","_cancelButton","_close","cleanUp","removeEventListener","ChorusPrompt","SynthChannel","sampleLeft","sampleRight","phases","phaseDeltas","volumeStarts","volumeDeltas","volumeLeft","volumeRight","phaseDeltaScale","filterScale","vibratoScale","harmonyMult","harmonyVolumeMult","feedbackOutputs","feedbackMult","feedbackDelta","Synth","warmUpSynthesizer","getGeneratedSynthesizer","operatorAmplitudeCurve","isPlaying","playheadInternal","remainder","beat","arpeggio","samplesPerTick","getSamplesPerArpeggio","arpSampleCountdown","totalSamples","samplesPerBar","loopMinCount","totalSeconds","samplesPerSecond","totalBars","effectDuration","effectAngle","effectYMult","limitDecay","pianoChannel","liveInputDuration","liveInputStarted","liveInputPitches","liveInputChannel","liveInputEndTime","browserAutomaticallyClearsAudioBuffer","stillGoing","effectPhase","limit","delayLineLeft","delayLineRight","delayPosLeft","delayPosRight","delayFeedback0Left","delayFeedback0Right","delayFeedback1Left","delayFeedback1Right","delayFeedback2Left","delayFeedback2Right","delayFeedback3Left","delayFeedback3Right","audioCtx","scriptNode","audioProcessCallback","audioProcessingEvent","outputBuffer","outputDataL","getChannelData","outputDataR","performance","now","deactivateAudio","synthesize","setSong","spsCalc","activateAudio","AudioContext","webkitAudioContext","createScriptProcessor","createJavaScriptNode","onaudioprocess","channelCountMode","channelInterpretation","connect","destination","resume","disconnect","close","maintainLiveInput","play","pause","snapToStart","snapToBar","nextBar","prevBar","dataLeft","dataRight","bufferLength","playSong","bufferIndex","ended","generatedSynthesizer","computeOperatorEnvelope","beats","customVolume","curve","attack","speed","computeChannelInstrument","sampleTime","samples","synthChannel","pianoMode","intervalScale","pitchDamping","secondsPerPart","beatsPerPart","partsSinceStart","resetPhases","intervalStart","intervalEnd","transitionVolumeStart","transitionVolumeEnd","envelopeVolumeStart","envelopeVolumeEnd","partTimeStart","partTimeEnd","decayTimeStart","decayTimeEnd","endPinIndex","startPin","endPin","noteStart","noteEnd","pinStart","pinEnd","tickTimeStart","tickTimeEnd","pinRatioStart","pinRatioEnd","envelopeVolumeTickStart","envelopeVolumeTickEnd","transitionVolumeTickStart","transitionVolumeTickEnd","intervalTickStart","intervalTickEnd","partTimeTickStart","partTimeTickEnd","decayTimeTickStart","decayTimeTickEnd","startRatio","endRatio","volumeConversion","harmonyOffset","endPitch","startFreq","frequencyFromPitch","pitchVolumeStart","pitchVolumeEnd","settingsVolumeMult","filterScaleRate","endFilter","instrumentVolumeMult","volumeEnd","sineVolumeBoost","totalCarrierVolume","carrierCount","isCarrier","associatedCarrierIndex","freqMult","amplitudeCurve","amplitudeMult","volumeStart","volumeMult","feedbackStart","feedbackEnd","fingerprint","generatedSynthesizers","synthSource","line","synthSourceTemplate","outputs","operatorLine","operatorSourceTemplate","modulators","modulatorNumber","feedbackIndices","feedbacks","Function","noteVolume","arpeggioPerSecond","negativePhaseGuard","input","save","blob","navigator","msSaveOrOpenBlob","anchor","download","url","URL","createObjectURL","setTimeout","revokeObjectURL","href","dispatchEvent","MouseEvent","open","location","ExportPrompt","_fileName","maxlength","_enableIntro","_loopDropDown","step","_enableOutro","_exportWavButton","_exportJsonButton","_validateFileName","_validateNumber","_whenExportToWav","_whenExportToJson","checked","introIter","sampleFrames","recordedSamplesLeft","recordedSamplesRight","sampleCount","arrayBuffer","ArrayBuffer","data","DataView","repeat","valLeft","valRight","setUint32","setUint16","setInt16","Blob","jsonString","stringify","disabled","target","deleteChars","cursorPos","selectionStart","setSelectionRange","ImportPrompt","_fileInput","accept","_whenFileSelected","file","files","reader","FileReader","prompt","readAsText","a","ArchivePrompt","SongDataPrompt","RefreshKeyPrompt","_songEditor","_newKeyValue","_refreshButton","_saveChangesAndRefresh","refreshNow","span","SongDurationPrompt","_beatsStepper","_barsStepper","_patternsStepper","_instrumentsStepper","_pitchChannelStepper","_drumChannelStepper","_okayButton","_saveChanges","_validateKey","group","_validate","charCode","which","keyCode","InstrumentTypePrompt","form","ThemePrompt","hasChanged","_closeButton","_previewButton","_previewText","previewExit","_form","title","themeContainer","localStorage","getItem","setItem","elements","_themeChange","_previewTheme","opacity","pointerEvents","_exitPreview","SongThemePrompt","Layout","setLayout","layout","_layoutMap","small","full","flow","LayoutPrompt","_confirm","_whenKeyPressed","focus","isMobile","userAgent","songThemeSet","buildOptions","menu","items","setSelectedIndex","Slider","_getChange","_value","_oldValue","_whenInput","_whenChange","updateValue","SongEditor","_patternEditor","_trackEditor","_loopEditor","_trackVisibleArea","_barScrollBar","_octaveScrollBar","_piano","_editorBox","_trackAndMuteContainer","_trackEditorBox","_playButton","_prevBarButton","_nextBarButton","_volumeSlider","_fileMenu","hidden","_editMenu","_optionsMenu","_newSongButton","d","_songDataButton","_customizeButton","_archiveButton","_undoButton","_redoButton","_exportButton","_scaleSelect","_mixSelect","_sampleRateSelect","_mixHint","_archiveHint","_mixSelectRow","_instrumentTypeHint","_keySelect","reverse","_tempoSlider","_reverbSlider","_blendSlider","_riffSlider","_detuneSlider","_muffSlider","_imuteButton","_iMmuteButton","_partSelect","_instrumentTypeSelect","values","buildOptionsWithSpecificValues","_instrumentTypeSelectRow","_algorithmSelect","_algorithmSelectRow","_instrumentSelect","_instrumentInput","_instrumentSelectRow","_instrumentVolumeSlider","_instrumentMVolumeSlider","_instrumentVolumeSliderRow","_instrumentMVolumeSliderRow","_SettingsLabel","_advancedInstrumentSettingsLabel","_waveSelect","_drumSelect","_pwmwaveSelect","_waveSelectRow","_transitionSelect","_filterSelect","_filterSelectRow","_chorusSelect","_chorusHint","_chorusSelectRow","_effectSelect","_effectSelectRow","_harmSelect","_harmSelectRow","_octoffSelect","_octoffSelectRow","_fmChorusSelect","_fmChorusSelectRow","_ipanSlider","_ipanSliderRow","_phaseModGroup","_feedbackTypeSelect","_feedbackRow1","_feedbackAmplitudeSlider","_feedbackEnvelopeSelect","_feedbackRow2","_songSettingsButton","_instSettingsButton","_settingsTabs","_instrumentSettingsGroup","_songSettingsGroup","_advancedInstrumentSettingsGroup","_promptContainer","_advancedSongSettings","_advancedSettingsContainer","mainLayer","tabIndex","_changeTranspose","_operatorRows","_operatorAmplitudeSliders","_operatorEnvelopeSelects","_operatorFrequencySelects","_refocusStage","whenUpdated","trackBounds","advancedSettings","optionCommands","autoPlay","innerText","wasActive","contains","activeElement","parentElement","operatorName","patternWidth","clientWidth","_setPrompt","_setSongSettings","borderBottom","_setInstSettings","_muteInstrument","_captureNumberKeys","stopPropagation","history","back","ctrlKey","metaKey","selection","insertChannel","shiftKey","muteAllInstruments","_openPrompt","soloChannels","_togglePlay","_cut","_copy","_paste","_transpose","_whenPrevBarPressed","_whenNextBarPressed","_pause","_play","_setVolumeSlider","setVolume","_whenNewSongPressed","_whenCustomizePressed","_advancedUndo","_advancedRedo","_openExportPrompt","_openSongDataPrompt","_openInstrumentTypePrompt","_openMixPrompt","_openChorusPrompt","_openArchivePrompt","reload","_whenSetScale","_whenSetMix","_whenSetSampleRate","_whenSetKey","_whenSetPartsPerBeat","_whenSetInstrumentType","_whenSetFeedbackType","_whenSetFeedbackEnvelope","_whenSetAlgorithm","_whenSetInstrument","_whenSetWave","_whenSetDrum","_whenSetPWMWave","_whenSetFilter","_whenSetTransition","_whenSetEffect","_whenSetHarm","_whenSetFMChorus","_whenSetOctoff","_whenSetChorus","_fileMenuHandler","_editMenuHandler","_optionsMenuHandler","operatorNumber","frequencySelect","amplitudeSlider","envelopeSelect","row","promptName","openPrompt","_wasPlaying","updatePlayButton","drums","patternCopy","ChangeNotifier","_watchers","_dirty","watcher","unwatch","Selection","shouldMute","invert","mutedCounter","insertIndex","Preferences","visibleOctaves","defaultVisibleOctaves","SongDocument","_recentChange","_sequenceNumber","_barFromCurrentState","_channelFromCurrentState","_shouldPushState","_waitingToUpdateState","_whenHistoryStateChanged","state","sequenceNumber","canUndo","hash","replaceState","_cleanDocument","_updateHistoryState","pushState","_calcVolume","eventName","forward","getMobileLayout","getFullScreen","getVisibleOctaveCount","visibleOctaveCount","editor","getElementById","autoplay","scrollRestoration","serviceWorker","register","updateViaCache","scope","catch"],"sources":["../synth/FFT.ts","../synth/SynthConfig.ts","../node_modules/imperative-html/src/elements-base.ts","../node_modules/imperative-html/src/elements-strict.ts","../synth/usefulFunctions.ts","../synth/song.ts","../editor/Change.ts","../editor/changes.ts","../editor/ColorConfig.ts","../editor/PatternEditor.ts","../editor/TrackEditor.ts","../editor/LoopEditor.ts","../editor/BarScrollBar.ts","../editor/OctaveScrollBar.ts","../editor/Piano.ts","../editor/MixPrompt.ts","../editor/ChorusPrompt.ts","../synth/synth.ts","../editor/ExportPrompt.ts","../editor/ImportPrompt.ts","../editor/ArchivePrompt.ts","../editor/SongDataPrompt.ts","../editor/RefreshKeyPrompt.ts","../editor/SongDurationPrompt.ts","../editor/InstrumentTypePrompt.ts","../editor/ThemePrompt.ts","../editor/SongThemePrompt.ts","../editor/Layout.ts","../editor/LayoutPrompt.ts","../editor/SongEditor.ts","../editor/ChangeNotifier.ts","../editor/Selection.ts","../editor/Preferences.ts","../editor/SongDocument.ts","../editor/style.ts","../editor/main.ts"],"sourcesContent":["/*\r\nCopyright (C) 2018 John Nesky\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of \r\nthis software and associated documentation files (the \"Software\"), to deal in \r\nthe Software without restriction, including without limitation the rights to \r\nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \r\nof the Software, and to permit persons to whom the Software is furnished to do \r\nso, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all \r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \r\nSOFTWARE.\r\n*/\r\n\r\n\r\n\t// interface shared by number[], Float32Array, and other typed arrays in JavaScript.\r\n\tinterface NumberArray {\r\n\t\tlength: number;\r\n\t\t[index: number]: number;\r\n\t}\r\n\t\r\n\t// A basic FFT operation scales the overall magnitude of elements by the\r\n\t// square root of the length of the array, √N. Performing a forward FFT and\r\n\t// then an inverse FFT results in the original array, but multiplied by N.\r\n\t// This helper function can be used to compensate for that. \r\n\texport function scaleElementsByFactor(array: NumberArray, factor: number): void {\r\n\t\tfor (let i: number = 0; i < array.length; i++) {\r\n\t\t\tarray[i] *= factor;\r\n\t\t}\r\n\t}\r\n\t\r\n\tfunction isPowerOf2(n: number): boolean {\r\n\t\treturn !!n && !(n & (n - 1));\r\n\t}\r\n\t\r\n\tfunction countBits(n: number): number {\r\n\t\tif (!isPowerOf2(n)) throw new Error(\"FFT array length must be a power of 2.\");\r\n\t\treturn Math.round(Math.log(n) / Math.log(2));\r\n\t}\r\n\t\r\n\t// Rearranges the elements of the array, swapping the element at an index\r\n\t// with an element at an index that is the bitwise reverse of the first\r\n\t// index in base 2. Useful for computing the FFT.\r\n\tfunction reverseIndexBits(array: NumberArray): void {\r\n\t\tconst fullArrayLength: number = array.length;\r\n\t\tconst bitCount: number = countBits(fullArrayLength);\r\n\t\tif (bitCount > 16) throw new Error(\"FFT array length must not be greater than 2^16.\");\r\n\t\tconst finalShift: number = 16 - bitCount;\r\n\t\tfor (let i: number = 0; i < fullArrayLength; i++) {\r\n\t\t\t// Dear Javascript: Please support bit order reversal intrinsics. Thanks! :D\r\n\t\t\tlet j: number;\r\n\t\t\tj = ((i & 0xaaaa) >> 1) | ((i & 0x5555) << 1);\r\n\t\t\tj = ((j & 0xcccc) >> 2) | ((j & 0x3333) << 2);\r\n\t\t\tj = ((j & 0xf0f0) >> 4) | ((j & 0x0f0f) << 4);\r\n\t\t\tj = ((j           >> 8) | ((j &   0xff) << 8)) >> finalShift;\r\n\t\t\tif (j > i) {\r\n\t\t\t\tlet temp: number = array[i];\r\n\t\t\t\tarray[i] = array[j];\r\n\t\t\t\tarray[j] = temp;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\t/* Commented out functions that BeepBox doesn't use...\r\n\t\r\n\t// Provided for educational purposes. Easier to read than\r\n\t// fastFourierTransform(), but computes the same result.\r\n\t// Takes two parallel arrays representing the real and imaginary elements,\r\n\t// respectively, and returns an array containing two new arrays, which\r\n\t// contain the complex result of the transform.\r\n\texport function discreteFourierTransform(realArray: NumberArray, imagArray: NumberArray): number[][] {\r\n\t\tconst fullArrayLength: number = realArray.length;\r\n\t\tif (fullArrayLength != imagArray.length) throw new Error(\"FFT arrays must be the same length.\");\r\n\t\tconst realOut: number[] = [];\r\n\t\tconst imagOut: number[] = [];\r\n\t\tfor (let i: number = 0; i < fullArrayLength; i++) {\r\n\t\t\trealOut[i] = 0.0;\r\n\t\t\timagOut[i] = 0.0;\r\n\t\t\tfor (let j: number = 0; j < fullArrayLength; j++) {\r\n\t\t\t\tconst radians: number = -6.2831853 * j * i / fullArrayLength;\r\n\t\t\t\tconst c: number = Math.cos(radians);\r\n\t\t\t\tconst s: number = Math.sin(radians);\r\n\t\t\t\trealOut[i] += realArray[j] * c - imagArray[j] * s;\r\n\t\t\t\timagOut[i] += realArray[j] * s + imagArray[j] * c;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn [realOut, imagOut];\r\n\t}\r\n\t\r\n\t// Performs a Fourier transform in O(N log(N)) operations. Overwrites the\r\n\t// input real and imaginary arrays. Can be used for both forward and inverse\r\n\t// transforms: swap the order of the arguments for the inverse.\r\n\texport function fastFourierTransform(realArray: NumberArray, imagArray: NumberArray): void {\r\n\t\tconst fullArrayLength: number = realArray.length;\r\n\t\tif (!isPowerOf2(fullArrayLength)) throw new Error(\"FFT array length must be a power of 2.\");\r\n\t\tif (fullArrayLength < 4) throw new Error(\"FFT array length must be at least 4.\");\r\n\t\tif (fullArrayLength != imagArray.length) throw new Error(\"FFT arrays must be the same length.\");\r\n\t\t\r\n\t\treverseIndexBits(realArray);\r\n\t\treverseIndexBits(imagArray);\r\n\t\t\r\n\t\t// First two passes, with strides of 2 and 4, can be combined and optimized.\r\n\t\tfor (let startIndex: number = 0; startIndex < fullArrayLength; startIndex += 4) {\r\n\t\t\tconst startIndex1: number = startIndex + 1;\r\n\t\t\tconst startIndex2: number = startIndex + 2;\r\n\t\t\tconst startIndex3: number = startIndex + 3;\r\n\t\t\tconst real0: number = realArray[startIndex ];\r\n\t\t\tconst real1: number = realArray[startIndex1];\r\n\t\t\tconst real2: number = realArray[startIndex2];\r\n\t\t\tconst real3: number = realArray[startIndex3];\r\n\t\t\tconst imag0: number = imagArray[startIndex ];\r\n\t\t\tconst imag1: number = imagArray[startIndex1];\r\n\t\t\tconst imag2: number = imagArray[startIndex2];\r\n\t\t\tconst imag3: number = imagArray[startIndex3];\r\n\t\t\tconst realTemp0: number = real0 + real1;\r\n\t\t\tconst realTemp1: number = real0 - real1;\r\n\t\t\tconst realTemp2: number = real2 + real3;\r\n\t\t\tconst realTemp3: number = real2 - real3;\r\n\t\t\tconst imagTemp0: number = imag0 + imag1;\r\n\t\t\tconst imagTemp1: number = imag0 - imag1;\r\n\t\t\tconst imagTemp2: number = imag2 + imag3;\r\n\t\t\tconst imagTemp3: number = imag2 - imag3;\r\n\t\t\trealArray[startIndex ] = realTemp0 + realTemp2;\r\n\t\t\trealArray[startIndex1] = realTemp1 + imagTemp3;\r\n\t\t\trealArray[startIndex2] = realTemp0 - realTemp2;\r\n\t\t\trealArray[startIndex3] = realTemp1 - imagTemp3;\r\n\t\t\timagArray[startIndex ] = imagTemp0 + imagTemp2;\r\n\t\t\timagArray[startIndex1] = imagTemp1 - realTemp3;\r\n\t\t\timagArray[startIndex2] = imagTemp0 - imagTemp2;\r\n\t\t\timagArray[startIndex3] = imagTemp1 + realTemp3;\r\n\t\t}\r\n\t\t\r\n\t\tfor (let stride: number = 8; stride <= fullArrayLength; stride += stride) {\r\n\t\t\tconst halfLength: number = stride >>> 1;\r\n\t\t\tconst radiansIncrement: number = Math.PI * 2.0 / stride;\r\n\t\t\tconst cosIncrement: number = Math.cos(radiansIncrement);\r\n\t\t\tconst sinIncrement: number = Math.sin(radiansIncrement);\r\n\t\t\tconst oscillatorMultiplier: number = 2.0 * cosIncrement;\r\n\t\t\tfor (let startIndex: number = 0; startIndex < fullArrayLength; startIndex += stride) {\r\n\t\t\t\tlet c: number = 1.0;\r\n\t\t\t\tlet s: number = 0.0;\r\n\t\t\t\tlet cPrev: number = cosIncrement;\r\n\t\t\t\tlet sPrev: number = sinIncrement;\r\n\t\t\t\tconst secondHalf: number = startIndex + halfLength;\r\n\t\t\t\tfor (let i: number = startIndex; i < secondHalf; i++) {\r\n\t\t\t\t\tconst j: number = i + halfLength;\r\n\t\t\t\t\tconst real0: number = realArray[i];\r\n\t\t\t\t\tconst imag0: number = imagArray[i];\r\n\t\t\t\t\tconst real1: number = realArray[j] * c - imagArray[j] * s;\r\n\t\t\t\t\tconst imag1: number = realArray[j] * s + imagArray[j] * c;\r\n\t\t\t\t\trealArray[i] = real0 + real1;\r\n\t\t\t\t\timagArray[i] = imag0 + imag1;\r\n\t\t\t\t\trealArray[j] = real0 - real1;\r\n\t\t\t\t\timagArray[j] = imag0 - imag1;\r\n\t\t\t\t\tconst cTemp: number = oscillatorMultiplier * c - cPrev;\r\n\t\t\t\t\tconst sTemp: number = oscillatorMultiplier * s - sPrev;\r\n\t\t\t\t\tcPrev = c;\r\n\t\t\t\t\tsPrev = s;\r\n\t\t\t\t\tc = cTemp;\r\n\t\t\t\t\ts = sTemp;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\t// Computes the Fourier transform from an array of real-valued time-domain\r\n\t// samples. The output is specially formatted for space efficieny: elements\r\n\t// 0 through N/2 represent cosine wave amplitudes in ascending frequency,\r\n\t// and elements N/2+1 through N-1 represent sine wave amplitudes in\r\n\t// descending frequency. Overwrites the input array.\r\n\texport function forwardRealFourierTransform(array: NumberArray): void {\r\n\t\tconst fullArrayLength: number = array.length;\r\n\t\tconst totalPasses: number = countBits(fullArrayLength);\r\n\t\tif (fullArrayLength < 4) throw new Error(\"FFT array length must be at least 4.\");\r\n\t\t\r\n\t\treverseIndexBits(array);\r\n\t\t\r\n\t\t// First and second pass.\r\n\t\tfor (let index: number = 0; index < fullArrayLength; index += 4) {\r\n\t\t\tconst index1: number = index + 1;\r\n\t\t\tconst index2: number = index + 2;\r\n\t\t\tconst index3: number = index + 3;\r\n\t\t\tconst real0: number = array[index ];\r\n\t\t\tconst real1: number = array[index1];\r\n\t\t\tconst real2: number = array[index2];\r\n\t\t\tconst real3: number = array[index3];\r\n\t\t\t// no imaginary elements yet since the input is fully real.\r\n\t\t\tconst tempA: number = real0 + real1;\r\n\t\t\tconst tempB: number = real2 + real3;\r\n\t\t\tarray[index ] = tempA + tempB;\r\n\t\t\tarray[index1] = real0 - real1;\r\n\t\t\tarray[index2] = tempA - tempB;\r\n\t\t\tarray[index3] = real2 - real3;\r\n\t\t}\r\n\t\t\r\n\t\t// Third pass.\r\n\t\tconst sqrt2over2: number = Math.sqrt(2.0) / 2.0;\r\n\t\tfor (let index: number = 0; index < fullArrayLength; index += 8) {\r\n\t\t\tconst index1: number = index + 1;\r\n\t\t\tconst index3: number = index + 3;\r\n\t\t\tconst index4: number = index + 4;\r\n\t\t\tconst index5: number = index + 5;\r\n\t\t\tconst index7: number = index + 7;\r\n\t\t\tconst real0: number = array[index ];\r\n\t\t\tconst real1: number = array[index1];\r\n\t\t\tconst imag3: number = array[index3];\r\n\t\t\tconst real4: number = array[index4];\r\n\t\t\tconst real5: number = array[index5];\r\n\t\t\tconst imag7: number = array[index7];\r\n\t\t\tconst tempA: number = (real5 - imag7) * sqrt2over2;\r\n\t\t\tconst tempB: number = (real5 + imag7) * sqrt2over2;\r\n\t\t\tarray[index ] = real0 + real4;\r\n\t\t\tarray[index1] = real1 + tempA;\r\n\t\t\tarray[index3] = real1 - tempA;\r\n\t\t\tarray[index4] = real0 - real4;\r\n\t\t\tarray[index5] = tempB - imag3;\r\n\t\t\tarray[index7] = tempB + imag3;\r\n\t\t}\r\n\t\t\r\n\t\t// Handle remaining passes.\r\n\t\tfor (let pass: number = 3; pass < totalPasses; pass++) {\r\n\t\t\tconst subStride: number = 1 << pass;\r\n\t\t\tconst midSubStride: number = subStride >> 1;\r\n\t\t\tconst stride: number = subStride << 1;\r\n\t\t\tconst radiansIncrement: number = Math.PI * 2.0 / stride;\r\n\t\t\tconst cosIncrement: number = Math.cos(radiansIncrement);\r\n\t\t\tconst sinIncrement: number = Math.sin(radiansIncrement);\r\n\t\t\tconst oscillatorMultiplier: number = 2.0 * cosIncrement;\r\n\t\t\tfor (let startIndex: number = 0; startIndex < fullArrayLength; startIndex += stride) {\r\n\t\t\t\tconst startIndexA: number = startIndex;\r\n\t\t\t\tconst startIndexB: number = startIndexA + subStride;\r\n\t\t\t\tconst stopIndex: number = startIndexB + subStride;\r\n\t\t\t\tconst realStartA: number = array[startIndexA];\r\n\t\t\t\tconst realStartB: number = array[startIndexB];\r\n\t\t\t\tarray[startIndexA] = realStartA + realStartB;\r\n\t\t\t\tarray[startIndexB] = realStartA - realStartB;\r\n\t\t\t\tlet c: number = cosIncrement;\r\n\t\t\t\tlet s: number = -sinIncrement;\r\n\t\t\t\tlet cPrev: number = 1.0;\r\n\t\t\t\tlet sPrev: number = 0.0;\r\n\t\t\t\tfor (let index: number = 1; index < midSubStride; index++) {\r\n\t\t\t\t\tconst indexA0: number = startIndexA + index;\r\n\t\t\t\t\tconst indexA1: number = startIndexB - index;\r\n\t\t\t\t\tconst indexB0: number = startIndexB + index;\r\n\t\t\t\t\tconst indexB1: number = stopIndex   - index;\r\n\t\t\t\t\tconst real0: number = array[indexA0];\r\n\t\t\t\t\tconst imag0: number = array[indexA1];\r\n\t\t\t\t\tconst real1: number = array[indexB0];\r\n\t\t\t\t\tconst imag1: number = array[indexB1];\r\n\t\t\t\t\tconst tempA: number = real1 * c + imag1 * s;\r\n\t\t\t\t\tconst tempB: number = real1 * s - imag1 * c;\r\n\t\t\t\t\tarray[indexA0] = real0 + tempA;\r\n\t\t\t\t\tarray[indexA1] = real0 - tempA;\r\n\t\t\t\t\tarray[indexB0] =-imag0 - tempB;\r\n\t\t\t\t\tarray[indexB1] = imag0 - tempB;\r\n\t\t\t\t\tconst cTemp: number = oscillatorMultiplier * c - cPrev;\r\n\t\t\t\t\tconst sTemp: number = oscillatorMultiplier * s - sPrev;\r\n\t\t\t\t\tcPrev = c;\r\n\t\t\t\t\tsPrev = s;\r\n\t\t\t\t\tc = cTemp;\r\n\t\t\t\t\ts = sTemp;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t*/\r\n\t\r\n\t// Computes the inverse Fourier transform from a specially formatted array of\r\n\t// scalar values. Elements 0 through N/2 are expected to be the real values of\r\n\t// the corresponding complex elements, representing cosine wave amplitudes in\r\n\t// ascending frequency, and elements N/2+1 through N-1 correspond to the\r\n\t// imaginary values, representing sine wave amplitudes in descending frequency.\r\n\t// Generates real-valued time-domain samples. Overwrites the input array.\r\n\texport function inverseRealFourierTransform(array: NumberArray): void {\r\n\t\tconst fullArrayLength: number = array.length;\r\n\t\tconst totalPasses: number = countBits(fullArrayLength);\r\n\t\tif (fullArrayLength < 4) throw new Error(\"FFT array length must be at least 4.\");\r\n\t\r\n\t\t// Perform all but the last few passes in reverse.\r\n\t\tfor (let pass: number = totalPasses - 1; pass >= 2; pass--) {\r\n\t\t\tconst subStride: number = 1 << pass;\r\n\t\t\tconst midSubStride: number = subStride >> 1;\r\n\t\t\tconst stride: number = subStride << 1;\r\n\t\t\tconst radiansIncrement: number = Math.PI * 2.0 / stride;\r\n\t\t\tconst cosIncrement: number = Math.cos(radiansIncrement);\r\n\t\t\tconst sinIncrement: number = Math.sin(radiansIncrement);\r\n\t\t\tconst oscillatorMultiplier: number = 2.0 * cosIncrement;\r\n\t\t\t\r\n\t\t\tfor (let startIndex: number = 0; startIndex < fullArrayLength; startIndex += stride) {\r\n\t\t\t\tconst startIndexA: number = startIndex;\r\n\t\t\t\tconst midIndexA: number = startIndexA + midSubStride;\r\n\t\t\t\tconst startIndexB: number = startIndexA + subStride;\r\n\t\t\t\tconst midIndexB: number = startIndexB + midSubStride;\r\n\t\t\t\tconst stopIndex: number = startIndexB + subStride;\r\n\t\t\t\tconst realStartA: number = array[startIndexA];\r\n\t\t\t\tconst imagStartB: number = array[startIndexB];\r\n\t\t\t\tarray[startIndexA] = realStartA + imagStartB;\r\n\t\t\t\tarray[midIndexA] *= 2;\r\n\t\t\t\tarray[startIndexB] = realStartA - imagStartB;\r\n\t\t\t\tarray[midIndexB] *= 2;\r\n\t\t\t\tlet c: number = cosIncrement;\r\n\t\t\t\tlet s: number = -sinIncrement;\r\n\t\t\t\tlet cPrev: number = 1.0;\r\n\t\t\t\tlet sPrev: number = 0.0;\r\n\t\t\t\tfor (let index: number = 1; index < midSubStride; index++) {\r\n\t\t\t\t\tconst indexA0: number = startIndexA + index;\r\n\t\t\t\t\tconst indexA1: number = startIndexB - index;\r\n\t\t\t\t\tconst indexB0: number = startIndexB + index;\r\n\t\t\t\t\tconst indexB1: number = stopIndex   - index;\r\n\t\t\t\t\tconst real0: number = array[indexA0];\r\n\t\t\t\t\tconst real1: number = array[indexA1];\r\n\t\t\t\t\tconst imag0: number = array[indexB0];\r\n\t\t\t\t\tconst imag1: number = array[indexB1];\r\n\t\t\t\t\tconst tempA: number = real0 - real1;\r\n\t\t\t\t\tconst tempB: number = imag0 + imag1;\r\n\t\t\t\t\tarray[indexA0] = real0 + real1;\r\n\t\t\t\t\tarray[indexA1] = imag1 - imag0;\r\n\t\t\t\t\tarray[indexB0] = tempA * c - tempB * s;\r\n\t\t\t\t\tarray[indexB1] = tempB * c + tempA * s;\r\n\t\t\t\t\tconst cTemp: number = oscillatorMultiplier * c - cPrev;\r\n\t\t\t\t\tconst sTemp: number = oscillatorMultiplier * s - sPrev;\r\n\t\t\t\t\tcPrev = c;\r\n\t\t\t\t\tsPrev = s;\r\n\t\t\t\t\tc = cTemp;\r\n\t\t\t\t\ts = sTemp;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t/*\r\n\t\t// Commented out this block (and compensated with an extra pass above)\r\n\t\t// because it's slower in my testing so far.\r\n\t\t// Pass with stride 8.\r\n\t\tconst sqrt2over2: number = Math.sqrt(2.0) / 2.0;\r\n\t\tfor (let index: number = 0; index < fullArrayLength; index += 8) {\r\n\t\t\tconst index1: number = index + 1;\r\n\t\t\tconst index2: number = index + 2;\r\n\t\t\tconst index3: number = index + 3;\r\n\t\t\tconst index4: number = index + 4;\r\n\t\t\tconst index5: number = index + 5;\r\n\t\t\tconst index6: number = index + 6;\r\n\t\t\tconst index7: number = index + 7;\r\n\t\t\tconst real0: number = array[index ];\r\n\t\t\tconst real1: number = array[index1];\r\n\t\t\tconst real2: number = array[index2];\r\n\t\t\tconst real3: number = array[index3];\r\n\t\t\tconst imag4: number = array[index4];\r\n\t\t\tconst imag5: number = array[index5];\r\n\t\t\tconst imag6: number = array[index6];\r\n\t\t\tconst imag7: number = array[index7];\r\n\t\t\tconst tempA: number = real1 - real3;\r\n\t\t\tconst tempB: number = imag5 + imag7;\r\n\t\t\tarray[index ] = real0 + imag4;\r\n\t\t\tarray[index1] = real1 + real3;\r\n\t\t\tarray[index2] = real2 * 2;\r\n\t\t\tarray[index3] = imag7 - imag5;\r\n\t\t\tarray[index4] = real0 - imag4;\r\n\t\t\tarray[index5] = (tempA + tempB) * sqrt2over2;\r\n\t\t\tarray[index6] = imag6 * 2;\r\n\t\t\tarray[index7] = (tempB - tempA) * sqrt2over2;\r\n\t\t}\r\n\t\t*/\r\n\t\t// The final passes with strides 4 and 2, combined into one loop.\r\n\t\tfor (let index: number = 0; index < fullArrayLength; index += 4) {\r\n\t\t\tconst index1: number = index + 1;\r\n\t\t\tconst index2: number = index + 2;\r\n\t\t\tconst index3: number = index + 3;\r\n\t\t\tconst real0: number = array[index ];\r\n\t\t\tconst real1: number = array[index1] * 2;\r\n\t\t\tconst imag2: number = array[index2];\r\n\t\t\tconst imag3: number = array[index3] * 2;\r\n\t\t\tconst tempA: number = real0 + imag2;\r\n\t\t\tconst tempB: number = real0 - imag2;\r\n\t\t\tarray[index ] = tempA + real1;\r\n\t\t\tarray[index1] = tempA - real1;\r\n\t\t\tarray[index2] = tempB + imag3;\r\n\t\t\tarray[index3] = tempB - imag3;\r\n\t\t}\r\n\t\t\r\n\t\treverseIndexBits(array);\r\n\t}\r\n\r\n","/*!\r\nCopyright (c) 2012-2022 John Nesky and contributing authors\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of \r\nthis software and associated documentation files (the \"Software\"), to deal in \r\nthe Software without restriction, including without limitation the rights to \r\nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \r\nof the Software, and to permit persons to whom the Software is furnished to do \r\nso, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all \r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \r\nSOFTWARE.\r\n*/\r\n\r\nimport { inverseRealFourierTransform, scaleElementsByFactor } from \"./FFT\";\r\n\r\nexport interface Dictionary<T> {\r\n\t[K: string]: T;\r\n}\r\n\r\nexport interface DictionaryArray<T> extends ReadonlyArray<T> {\r\n\tdictionary: Dictionary<T>;\r\n}\r\n\r\nexport interface BeepBoxOption {\r\n\treadonly index: number;\r\n\treadonly name: string;\r\n}\r\n\r\nexport const enum EnvelopeType {\r\n\tcustom,\r\n\tsteady,\r\n\tpunch,\r\n\tflare,\r\n\tpluck,\r\n\ttremolo,\r\n\tflute,\r\n}\r\n\r\nexport const enum InstrumentType {\r\n\tchip = 0,\r\n\tfm = 1,\r\n\tnoise = 2,\r\n\tpwm = 3,\r\n}\r\n\r\nexport interface Scale extends BeepBoxOption {\r\n\treadonly flags: ReadonlyArray<boolean>;\r\n\treadonly realName: string;\r\n}\r\n\r\nexport interface Key extends BeepBoxOption {\r\n\treadonly isWhiteKey: boolean;\r\n\treadonly basePitch: number;\r\n}\r\n\r\nexport class Config {\r\n\tpublic static readonly scales: DictionaryArray<Scale> = toNameMap([\r\n\t\t{name: \"easy :)\",            realName: \"pentatonic major\",      flags: [true, false,  true, false,  true, false, false,  true, false,  true, false, false]},\r\n\t\t{name: \"easy :(\",            realName: \"pentatonic minor\",      flags: [true, false, false,  true, false,  true, false,  true, false, false,  true, false]},\r\n\t\t{name: \"island :)\",          realName: \"ryukyu\",                flags: [true, false, false, false,  true,  true, false,  true, false, false, false,  true]},\r\n\t\t{name: \"island :(\",          realName: \"pelog selisir\",         flags: [true,  true, false,  true, false, false, false,  true,  true, false, false, false]},\r\n\t\t{name: \"blues :)\",           realName: \"blues major\",           flags: [true, false,  true,  true,  true, false, false,  true, false,  true, false, false]},\r\n\t\t{name: \"blues :(\",           realName: \"blues\",                 flags: [true, false, false,  true, false,  true,  true,  true, false, false,  true, false]},\r\n\t\t{name: \"normal :)\",          realName: \"ionian\",                flags: [true, false,  true, false,  true,  true, false,  true, false,  true, false,  true]},\r\n\t\t{name: \"normal :(\",          realName: \"aeolian\",               flags: [true, false,  true,  true, false,  true, false,  true,  true, false,  true, false]},\r\n\t\t{name: \"dbl harmonic :)\", \t realName: \"double harmonic major\", flags: [true,  true, false, false,  true,  true, false,  true,  true, false, false,  true]},\r\n\t\t{name: \"dbl harmonic :(\",    realName: \"double harmonic minor\", flags: [true, false,  true,  true, false, false,  true,  true,  true, false, false,  true]},\r\n\t\t{name: \"enigma\",             realName: \"whole tone\",            flags: [true, false,  true, false,  true, false,  true, false,  true, false,  true, false]},\r\n\t\t{name: \"expert\",             realName: \"chromatic\",             flags: [true,  true,  true,  true,  true,  true,  true,  true,  true,  true,  true,  true]},\r\n\t\t{name: \"monotonic\",          realName: \"monotonic\",             flags: [true, false, false, false, false, false, false, false, false, false, false, false]},\r\n\t\t{name: \"no dabbing\",         realName: \"no dabbing\",            flags: [true,  true, false,  true,  true,  true,  true,  true,  true, false,  true, false]},\r\n\t]);\r\n\tstatic readonly blackKeyNameParents: ReadonlyArray<number> = [-1, 1, -1, 1, -1, 1, -1, -1, 1, -1, 1, -1];\r\n\tstatic readonly pitchNames: ReadonlyArray<string | null> = [\"C\", null, \"D\", null, \"E\", \"F\", null, \"G\", null, \"A\", null, \"B\"];\r\n\tpublic static readonly oldKeys: ReadonlyArray<string | null> = [\"B\", \"A♯\", \"A\", \"G♯\", \"F♯\", \"F\", \"E\", \"D♯\", \"D\", \"C♯\", \"C\"];\r\n\tpublic static readonly keys: DictionaryArray<Key> = toNameMap([\r\n\t\t{name: \"C\",  isWhiteKey:  true, basePitch: 12}, // C0 has index 12 on the MIDI scale. C7 is 96, and C9 is 120. C10 is barely in the audible range.\r\n\t\t{name: \"C♯\", isWhiteKey: false, basePitch: 13},\r\n\t\t{name: \"D\",  isWhiteKey:  true, basePitch: 14},\r\n\t\t{name: \"D♯\", isWhiteKey: false, basePitch: 15},\r\n\t\t{name: \"E\",  isWhiteKey:  true, basePitch: 16},\r\n\t\t{name: \"F\",  isWhiteKey:  true, basePitch: 17},\r\n\t\t{name: \"F♯\", isWhiteKey: false, basePitch: 18},\r\n\t\t{name: \"G\",  isWhiteKey:  true, basePitch: 19},\r\n\t\t{name: \"G♯\", isWhiteKey: false, basePitch: 20},\r\n\t\t{name: \"A\",  isWhiteKey:  true, basePitch: 21},\r\n\t\t{name: \"A♯\", isWhiteKey: false, basePitch: 22},\r\n\t\t{name: \"B\",  isWhiteKey:  true, basePitch: 23},\r\n\t]);\r\n\tstatic readonly mixNames: ReadonlyArray<string> = [\"Type A (B & S)\", \"Type B (M)\", \"Type C\"];\r\n\tstatic readonly sampleRateNames: ReadonlyArray<string> = [\"44100kHz\", \"48000kHz\", \"default\", \"×4\", \"×2\", \"÷2\", \"÷4\", \"÷8\", \"÷16\"];\r\n\tstatic readonly tempoSteps: number = 24;\r\n\tstatic readonly reverbRange: number = 5;\r\n\tstatic readonly blendRange: number = 4;\r\n\tstatic readonly riffRange: number = 11;\r\n\tstatic readonly detuneRange: number = 24;\r\n\tstatic readonly muffRange: number = 24;\r\n\tstatic readonly beatsPerBarMin: number = 1;\r\n\tstatic readonly beatsPerBarMax: number = 24;\r\n\tstatic readonly barCountMin: number = 1;\r\n\tstatic readonly barCountMax: number = 256;\r\n\tstatic readonly patternsPerChannelMin: number = 1;\r\n\tstatic readonly patternsPerChannelMax: number = 64;\r\n\tstatic readonly instrumentsPerChannelMin: number = 1;\r\n\tstatic readonly instrumentsPerChannelMax: number = 64;\r\n\tstatic readonly pitchesPerOctave: number = 12; // TODO: Use this for converting pitch to frequency.\r\n\tstatic readonly drumCount: number = 12;\r\n\tstatic readonly pitchOctaves: number = 7;\r\n\tstatic readonly partNames: ReadonlyArray<string> = [\"÷3 (triplets)\", \"÷4 (standard)\", \"÷6\", \"÷8\", \"÷16 (arpfest)\", \"÷12\", \"÷9\", \"÷5\", \"÷50\", \"÷24\"];\r\n\tstatic readonly partCounts: ReadonlyArray<number> = [3, 4, 6, 8, 16, 12, 9, 5, 50, 24];\r\n\tstatic readonly waveNames: ReadonlyArray<string> = [\"triangle\", \"square\", \"pulse wide\", \"pulse narrow\", \"sawtooth\", \"double saw\", \"double pulse\", \"spiky\", \"plateau\", \"glitch\", \"10% pulse\", \"sunsoft bass\", \"loud pulse\", \"sax\", \"guitar\", \"sine\", \"atari bass\", \"atari pulse\", \"1% pulse\", \"curved sawtooth\", \"viola\", \"brass\", \"acoustic bass\", \"lyre\", \"ramp pulse\", \"piccolo\", \"squaretooth\", \"flatline\", \"pnryshk a (u5)\", \"pnryshk b (riff)\"];\r\n\tstatic readonly waveVolumes: ReadonlyArray<number> = [1.0,        0.5,      0.5,          0.5,            0.65,       0.5,          0.4,            0.4,     0.94,      0.5,      0.5,         1.0,            0.6,          0.1,   0.25,     1.0,    1.0,          1.0,           1.0,        1.0,               1.0,     1.0,     1.0,             0.2,    0.2,          0.9,       0.9,           1.0,        0.4,                 0.5];\r\n\tstatic readonly drumNames: ReadonlyArray<string> = [\"retro\", \"white\", \"periodic\", \"detuned periodic\", \"shine\", \"hollow\", \"deep\", \"cutter\", \"metallic\", \"snare\"/*, \"tom-tom\", \"cymbal\", \"bass\"*/];\r\n\tstatic readonly drumVolumes: ReadonlyArray<number> = [0.25, 1.0, 0.4, 0.3, 0.3, 1.5, 1.5, 0.25, 1.0, 1.0/*, 1.5, 1.5, 1.5*/];\r\n\tstatic readonly drumBasePitches: ReadonlyArray<number> = [69, 69, 69, 69, 69, 96, 120, 96, 96, 69/*, 96, 90, 126*/];\r\n\tstatic readonly drumPitchFilterMult: ReadonlyArray<number> = [100.0, 8.0, 100.0, 100.0, 100.0, 1.0, 100.0, 100.0, 100.0, 100.0/*, 1.0, 1.0, 1.0*/];\r\n\tstatic readonly drumWaveIsSoft: ReadonlyArray<boolean> = [false, true, false, false, false, true, true, false, false, false/*, true, true, true*/];\r\n\t// Noise waves have too many samples to write by hand, they're generated on-demand by getDrumWave instead.\r\n\tprivate static readonly _drumWaves: Array<Float32Array | null> = [null, null, null, null, null, null, null, null, null, null/*, null, null, null*/];\r\n\tstatic readonly pwmwaveNames: ReadonlyArray<string> = [\"5%\", \"10%\", \"15%\", \"20%\", \"25%\", \"30%\", \"35%\", \"40%\", \"45%\", \"50%\"];\r\n\tstatic readonly pwmwaveVolumes: ReadonlyArray<number> = [1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0];\r\n\tstatic readonly filterNames: ReadonlyArray<string> = [\"none\", \"sustain sharp\", \"sustain medium\", \"sustain soft\", \"decay sharp\", \"decay medium\", \"decay soft\", \"decay drawn\", \"fade sharp\", \"fade medium\", \"fade soft\", \"ring\", \"muffled\", \"submerged\", \"shift\", \"overtone\", \"woosh\", \"undertone\"];\r\n\tstatic readonly filterBases: ReadonlyArray<number> = [0.0, 2.0, 3.5, 5.0, 1.0, 2.5, 4.0, 1.0, 5.0, 7.5, 10.0, -1.0, 4.0, 6.0, 0.0, 1.0, 2.0, 5.0];\r\n\tstatic readonly filterDecays: ReadonlyArray<number> = [0.0, 0.0, 0.0, 0.0, 10.0, 7.0, 4.0, 0.5, -10.0, -7.0, -4.0, 0.2, 0.2, 0.3, 0.0, 0.0, -6.0, 0.0];\r\n\tstatic readonly filterVolumes: ReadonlyArray<number> = [0.2, 0.4, 0.7, 1.0, 0.5, 0.75, 1.0, 0.5, 0.4, 0.7, 1.0, 0.5, 0.75, 0.4, 0.4, 1.0, 0.5, 1.75];\r\n\tstatic readonly transitionNames: ReadonlyArray<string> = [\"seamless\", \"sudden\", \"smooth\", \"slide\", \"trill\", \"click\", \"bow\", \"blip\"];\r\n\tstatic readonly effectNames: ReadonlyArray<string> = [\"none\", \"vibrato light\", \"vibrato delayed\", \"vibrato heavy\", \"tremolo light\", \"tremolo heavy\", \"alien\", \"stutter\", \"strum\"];\r\n\tstatic readonly effectVibratos: ReadonlyArray<number> = [0.0, 0.15, 0.3, 0.45, 0.0, 0.0, 1.0, 0.0, 0.05];\r\n\tstatic readonly effectTremolos: ReadonlyArray<number> = [0.0, 0.0, 0.0, 0.0, 0.25, 0.5, 0.0, 1.0, 0.025];\r\n\tstatic readonly effectVibratoDelays: ReadonlyArray<number> = [0, 0, 3, 0, 0, 0, 0, 0];\r\n\tstatic readonly chorusNames: ReadonlyArray<string> = [\"union\", \"shimmer\", \"hum\", \"honky tonk\", \"dissonant\", \"fifths\", \"octaves\", \"spinner\", \"detune\", \"bowed\", \"rising\", \"vibrate\", \"fourths\", \"bass\", \"dirty\", \"stationary\", \"harmonic (legacy)\", \"recurve\", \"voiced\", \"fluctuate\"];\r\n\tstatic readonly chorusIntervals: ReadonlyArray<number> = [0.0, 0.02, 0.05, 0.1, 0.25, 3.5, 6, 0.02, 0.0, 0.02, 1.0, 3.5, 4, 0, 0.0, 3.5, 0.0, 0.005, 0.25, 12];\r\n\tstatic readonly chorusOffsets: ReadonlyArray<number> = [0.0, 0.0, 0.0, 0.0, 0.0, 3.5, 6, 0.0, 0.25, 0.0, 0.7, 7, 4, -7, 0.1, 0.0, 0.0, 0.0, 3.0, 0.0];\r\n\tstatic readonly chorusVolumes: ReadonlyArray<number> = [0.9, 0.9, 1.0, 1.0, 0.95, 0.95, 0.9, 1.0, 1.0, 1.0, 0.95, 0.975, 0.95, 1.0, 0.975, 0.9, 1.0, 1.0, 0.9, 1.0];\r\n\tstatic readonly chorusSigns: ReadonlyArray<number> = [1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, 1.0, -1.0, 1.0, 1.0];\r\n\tstatic readonly chorusRiffApp: ReadonlyArray<number> = [0.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0];\r\n\tstatic readonly chorusHarmonizes: ReadonlyArray<boolean> = [false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false];\r\n\tstatic readonly harmDisplay: ReadonlyArray<string> = [\"arpeggio\", \"duet\", \"chord\", \"seventh\", \"half arpeggio\", \"arp-chord\"];\r\n\tstatic readonly harmNames: ReadonlyArray<number> = [0, 1, 2, 3, 4, 5];\r\n\tstatic readonly fmChorusDisplay: ReadonlyArray<string> = [\"none\", \"default\", \"detune\", \"honky tonk\", \"consecutive\", \"alt. major thirds\", \"alt. minor thirds\", \"fifths\", \"octaves\"];\r\n\tstatic readonly fmChorusNames: ReadonlyArray<number> = [0, 1, 2, 3, 4, 5, 6, 7, 8];\r\n\tstatic readonly imuteNames: ReadonlyArray<string> = [\"◉\", \"◎\"];\r\n\tstatic readonly imuteValues: ReadonlyArray<number> = [1, 0];\r\n\tstatic readonly octoffNames: ReadonlyArray<string> = [\"none\", \"+2 (2 octaves)\",  \"+1 1/2 (octave and fifth)\",  \"+1 (octave)\",  \"+1/2 (fifth)\", \"-1/2 (fifth)\", \"-1 (octave)\", \"-1 1/2 (octave and fifth)\", \"-2 (2 octaves\"];\r\n\tstatic readonly octoffValues: ReadonlyArray<number> = [0.0, 24.0, 19.0, 12.0, 7.0, -7.0, -12.0, -19.0, -24.0];\r\n\tstatic readonly volumeNames: ReadonlyArray<string> = [\"loudest\", \"loud\", \"medium\", \"quiet\", \"quietest\", \"mute\", \"i\", \"couldnt\", \"be\", \"bothered\"];\r\n\tstatic readonly volumeValues: ReadonlyArray<number> = [0.0, 0.25, 0.5, 0.75, 1.0, 1.25, 1.5, 1.75, 2.0, -1.0];\r\n\tstatic readonly volumeMValues: ReadonlyArray<number> = [0.0, 0.5, 1.0, 1.5, 2.0, -1.0];\r\n\tstatic readonly ipanValues: ReadonlyArray<number> = [-1.0, -0.75, -0.5, -0.25, 0.0, 0.25, 0.5, 0.75, 1.0];\r\n\tstatic readonly operatorCount: number = 4;\r\n\tstatic readonly operatorAlgorithmNames: ReadonlyArray<string> = [\r\n\t\t\"1←(2 3 4)\",\r\n\t\t\"1←(2 3←4)\",\r\n\t\t\"1←2←(3 4)\",\r\n\t\t\"1←(2 3)←4\",\r\n\t\t\"1←2←3←4\",\r\n\t\t\"1←3 2←4\",\r\n\t\t\"1 2←(3 4)\",\r\n\t\t\"1 2←3←4\",\r\n\t\t\"(1 2)←3←4\",\r\n\t\t\"(1 2)←(3 4)\",\r\n\t\t\"1 2 3←4\",\r\n\t\t\"(1 2 3)←4\",\r\n\t\t\"1 2 3 4\",\r\n\t];\r\n\tstatic readonly midiAlgorithmNames: ReadonlyArray<string> = [\"1<(2 3 4)\", \"1<(2 3<4)\", \"1<2<(3 4)\", \"1<(2 3)<4\", \"1<2<3<4\", \"1<3 2<4\", \"1 2<(3 4)\", \"1 2<3<4\", \"(1 2)<3<4\", \"(1 2)<(3 4)\", \"1 2 3<4\", \"(1 2 3)<4\", \"1 2 3 4\"];\r\n\tstatic readonly operatorModulatedBy: ReadonlyArray<ReadonlyArray<ReadonlyArray<number>>> = [\r\n\t\t[[2, 3, 4], [],     [],  []],\r\n\t\t[[2, 3],    [],     [4], []],\r\n\t\t[[2],       [3, 4], [],  []],\r\n\t\t[[2, 3],    [4],    [4], []],\r\n\t\t[[2],       [3],    [4], []],\r\n\t\t[[3],       [4],    [],  []],\r\n\t\t[[],        [3, 4], [],  []],\r\n\t\t[[],        [3],    [4], []],\r\n\t\t[[3],       [3],    [4], []],\r\n\t\t[[3, 4],    [3, 4], [],  []],\r\n\t\t[[],        [],     [4], []],\r\n\t\t[[4],       [4],    [4], []],\r\n\t\t[[],        [],     [],  []],\r\n\t];\r\n\tstatic readonly operatorAssociatedCarrier: ReadonlyArray<ReadonlyArray<number>> = [\r\n\t\t[1, 1, 1, 1],\r\n\t\t[1, 1, 1, 1],\r\n\t\t[1, 1, 1, 1],\r\n\t\t[1, 1, 1, 1],\r\n\t\t[1, 1, 1, 1],\r\n\t\t[1, 2, 1, 2],\r\n\t\t[1, 2, 2, 2],\r\n\t\t[1, 2, 2, 2],\r\n\t\t[1, 2, 2, 2],\r\n\t\t[1, 2, 2, 2],\r\n\t\t[1, 2, 3, 3],\r\n\t\t[1, 2, 3, 3],\r\n\t\t[1, 2, 3, 4],\r\n\t];\r\n\tstatic readonly operatorCarrierCounts: ReadonlyArray<number> = [1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 3, 3, 4];\r\n\tstatic readonly operatorCarrierChorus: ReadonlyArray<ReadonlyArray<number>> = [\r\n\t\t[0.0, 0.0, 0.0, 0.0],\r\n\t\t[0.0, 0.04, -0.073, 0.091],\r\n\t\t[0.5, 0.54, 0.427, 0.591],\r\n\t\t[0.0, 0.26, -0.45, 0.67],\r\n\t\t[0.0, 1.0, 2.0, 3.0],\r\n\t\t[0.0, 4.0, 7.0, 11.0],\r\n\t\t[0.0, 3.0, 7.0, 10.0],\r\n\t\t[0.0, 7.0, 14.0, 21.0],\r\n\t\t[0.0, 12.0, 24.0, 36.0],\r\n\t];\r\n\tstatic readonly operatorAmplitudeMax: number = 15;\r\n\tstatic readonly operatorFrequencyNames: ReadonlyArray<string> = [\"1×\", \"~1×\", \"2×\", \"~2×\", \"3×\", \"4×\", \"5×\", \"6×\", \"7×\", \"8×\", \"9×\", \"10×\", \"11×\", \"13×\", \"16×\", \"20×\"];\r\n\tstatic readonly midiFrequencyNames: ReadonlyArray<string> = [\"1x\", \"~1x\", \"2x\", \"~2x\", \"3x\", \"4x\", \"5x\", \"6x\", \"7x\", \"8x\", \"9x\", \"10x\", \"11x\", \"13x\", \"16x\", \"20x\"];\r\n\tstatic readonly operatorFrequencies: ReadonlyArray<number> =    [1.0, 1.0, 2.0, 2.0, 3.0, 4.0, 5.0, 6.0, 7.0, 8.0, 9.0, 10.0, 11.0, 13.0, 16.0, 20.0];\r\n\tstatic readonly operatorHzOffsets: ReadonlyArray<number> =      [0.0, 1.5, 0.0, -1.3, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0];\r\n\tstatic readonly operatorAmplitudeSigns: ReadonlyArray<number> = [1.0, -1.0, 1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0];\r\n\tstatic readonly operatorEnvelopeNames: ReadonlyArray<string> = [\"custom\", \"steady\", \"punch\", \"flare 1\", \"flare 2\", \"flare 3\", \"pluck 1\", \"pluck 2\", \"pluck 3\", \"swell 1\", \"swell 2\", \"swell 3\", \"tremolo1\", \"tremolo2\", \"tremolo3\", \"custom flare\", \"custom tremolo\", \"flute 1\", \"flute 2\", \"flute 3\"];\r\n\tstatic readonly operatorEnvelopeType: ReadonlyArray<EnvelopeType> = [EnvelopeType.custom, EnvelopeType.steady, EnvelopeType.punch, EnvelopeType.flare, EnvelopeType.flare, EnvelopeType.flare, EnvelopeType.pluck, EnvelopeType.pluck, EnvelopeType.pluck, EnvelopeType.pluck, EnvelopeType.pluck, EnvelopeType.pluck, EnvelopeType.tremolo, EnvelopeType.tremolo, EnvelopeType.tremolo, EnvelopeType.flare, EnvelopeType.tremolo, EnvelopeType.flute, EnvelopeType.flute, EnvelopeType.flute];\r\n\tstatic readonly operatorSpecialCustomVolume: ReadonlyArray<boolean> = [false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, true, true, false, false, false];\r\n\tstatic readonly operatorEnvelopeSpeed: ReadonlyArray<number> = [0.0, 0.0, 0.0, 32.0, 8.0, 2.0, 32.0, 8.0, 2.0, 32.0, 8.0, 2.0, 4.0, 2.0, 1.0, 8.0, 0.0, 16.0, 8.0, 4.0];\r\n\tstatic readonly operatorEnvelopeInverted: ReadonlyArray<boolean> = [false, false, false, false, false, false, false, false, false, true, true, true, false, false, false, false, false, false, false, false];\r\n\tstatic readonly operatorFeedbackNames: ReadonlyArray<string> = [\r\n\t\t\"1⟲\",\r\n\t\t\"2⟲\",\r\n\t\t\"3⟲\",\r\n\t\t\"4⟲\",\r\n\t\t\"1⟲ 2⟲\",\r\n\t\t\"3⟲ 4⟲\",\r\n\t\t\"1⟲ 2⟲ 3⟲ \",\r\n\t\t\"2⟲ 3⟲ 4⟲ \",\r\n\t\t\"1⟲ 2⟲ 3⟲ 4⟲ \",\r\n\t\t\"1→2\",\r\n\t\t\"1→3\",\r\n\t\t\"1→4\",\r\n\t\t\"2→3\",\r\n\t\t\"2→4\",\r\n\t\t\"3→4\",\r\n\t\t\"1→3 2→4\",\r\n\t\t\"1→4 2→3\",\r\n\t\t\"1→2→3→4\",\r\n\t\t\"1🗘2\",\r\n\t\t\"1🗘3\",\r\n\t\t\"1🗘4\",\r\n\t\t\"2🗘3\",\r\n\t\t\"2🗘4\",\r\n\t\t\"3🗘4\",\r\n\t];\r\n\tstatic readonly midiFeedbackNames: ReadonlyArray<string> = [\r\n\t\t\"1\",\r\n\t\t\"2\",\r\n\t\t\"3\",\r\n\t\t\"4\",\r\n\t\t\"1 2\",\r\n\t\t\"3 4\",\r\n\t\t\"1 2 3\",\r\n\t\t\"2 3 4\",\r\n\t\t\"1 2 3 4\",\r\n\t\t\"1>2\",\r\n\t\t\"1>3\",\r\n\t\t\"1>4\",\r\n\t\t\"2>3\",\r\n\t\t\"2>4\",\r\n\t\t\"3>4\",\r\n\t\t\"1>3 2>4\",\r\n\t\t\"1>4 2>3\",\r\n\t\t\"1>2>3>4\",\r\n\t\t\"1-2\",\r\n\t\t\"1-3\",\r\n\t\t\"1-4\",\r\n\t\t\"2-3\",\r\n\t\t\"2-4\",\r\n\t\t\"3-4\",\r\n\t];\r\n\tstatic readonly operatorFeedbackIndices: ReadonlyArray<ReadonlyArray<ReadonlyArray<number>>> = [\r\n\t\t[[1], [], [], []],\r\n\t\t[[], [2], [], []],\r\n\t\t[[], [], [3], []],\r\n\t\t[[], [], [], [4]],\r\n\t\t[[1], [2], [], []],\r\n\t\t[[], [], [3], [4]],\r\n\t\t[[1], [2], [3], []],\r\n\t\t[[], [2], [3], [4]],\r\n\t\t[[1], [2], [3], [4]],\r\n\t\t[[], [1], [], []],\r\n\t\t[[], [], [1], []],\r\n\t\t[[], [], [], [1]],\r\n\t\t[[], [], [2], []],\r\n\t\t[[], [], [], [2]],\r\n\t\t[[], [], [], [3]],\r\n\t\t[[], [], [1], [2]],\r\n\t\t[[], [], [2], [1]],\r\n\t\t[[], [1], [2], [3]],\r\n\t\t[[2], [1], [],  []  ],\r\n\t\t[[3], [],  [1], []  ],\r\n\t\t[[4], [],  [],  [1] ],\r\n\t\t[[],  [3], [2], []  ],\r\n\t\t[[],  [4], [],  [2] ],\r\n\t\t[[],  [],  [4], [3] ],\r\n\t];\r\n\tstatic readonly pitchChannelTypeNames: ReadonlyArray<string> = [\"chip\", \"FM (expert)\", \"PWM (beta)\"];\r\n\tstatic readonly pitchChannelTypeValues: ReadonlyArray<number> = [InstrumentType.chip, InstrumentType.fm, InstrumentType.pwm];\r\n\tstatic readonly drumChannelTypeNames: ReadonlyArray<string> = [\"noise\"];\r\n\tstatic readonly instrumentTypeNames: ReadonlyArray<string> = [\"chip\", \"FM\", \"noise\", \"PWM\"];\r\n\r\n\tstatic readonly oldThemeNames: ReadonlyArray<string> = [\"Default\", \"ModBox 2.0\", \"Artic\", \"Cinnamon Roll [!]\", \"Ocean\", \"Rainbow [!]\", \"Float [!]\", \"Windows\", \"Grassland\", \"Dessert\", \"Kahootiest\", \"Beam to the Bit [!]\", \"Pretty Egg\", \"Poniryoshka\", \"Gameboy [!]\", \"Woodkid\", \"Midnight\", \"Snedbox\", \"unnamed\", \"Piano [!] [↻]\", \"Halloween\", \"FrozenOver❄️\"];\r\n\r\n\tstatic readonly channelOneBrightColorPallet: string      = \"#25f3ff\";\r\n\tstatic readonly channelTwoBrightColorPallet: string      = \"#44ff44\";\r\n\tstatic readonly channelThreeBrightColorPallet: string    = \"#ffff25\";\r\n\tstatic readonly channelFourBrightColorPallet: string     = \"#ff9752\";\r\n\tstatic readonly channelFiveBrightColorPallet: string     = \"#ff90ff\";\r\n\tstatic readonly channelSixBrightColorPallet: string      = \"#9f31ea\";\r\n\tstatic readonly channelSevenBrightColorPallet: string    = \"#2b6aff\";\r\n\tstatic readonly channelEightBrightColorPallet: string    = \"#00ff9f\";\r\n\tstatic readonly channelNineBrightColorPallet: string     = \"#ffbf00\";\r\n\tstatic readonly channelTenBrightColorPallet: string      = \"#d85d00\";\r\n\tstatic readonly channelElevenBrightColorPallet: string   = \"#ff00a1\";\r\n\tstatic readonly channelTwelveBrightColorPallet: string   = \"#c26afc\";\r\n\tstatic readonly channelThirteenBrightColorPallet: string = \"#ff1616\";\r\n\tstatic readonly channelFourteenBrightColorPallet: string = \"#ffffff\";\r\n\tstatic readonly channelFifteenBrightColorPallet: string  = \"#768dfc\";\r\n\tstatic readonly channelSixteenBrightColorPallet: string  = \"#a5ff00\";\r\n\r\n\tstatic readonly channelOneDimColorPallet: string      = \"#0099a1\";\r\n\tstatic readonly channelTwoDimColorPallet: string      = \"#439143\";\r\n\tstatic readonly channelThreeDimColorPallet: string    = \"#a1a100\";\r\n\tstatic readonly channelFourDimColorPallet: string     = \"#c75000\";\r\n\tstatic readonly channelFiveDimColorPallet: string     = \"#d020d0\";\r\n\tstatic readonly channelSixDimColorPallet: string      = \"#552377\";\r\n\tstatic readonly channelSevenDimColorPallet: string    = \"#221b89\";\r\n\tstatic readonly channelEightDimColorPallet: string    = \"#00995f\";\r\n\tstatic readonly channelNineDimColorPallet: string     = \"#d6b03e\";\r\n\tstatic readonly channelTenDimColorPallet: string      = \"#b25915\";\r\n\tstatic readonly channelElevenDimColorPallet: string   = \"#891a60\";\r\n\tstatic readonly channelTwelveDimColorPallet: string   = \"#965cbc\";\r\n\tstatic readonly channelThirteenDimColorPallet: string = \"#991010\";\r\n\tstatic readonly channelFourteenDimColorPallet: string = \"#aaaaaa\";\r\n\tstatic readonly channelFifteenDimColorPallet: string  = \"#5869BD\";\r\n\tstatic readonly channelSixteenDimColorPallet: string  = \"#7c9b42\";\r\n\r\n\tstatic readonly pitchChannelColorsDim: ReadonlyArray<string>    = [Config.channelOneDimColorPallet, Config.channelTwoDimColorPallet, Config.channelThreeDimColorPallet, Config.channelFourDimColorPallet, Config.channelFiveDimColorPallet, Config.channelSixDimColorPallet, Config.channelSevenDimColorPallet, Config.channelEightDimColorPallet, Config.channelNineDimColorPallet, Config.channelTenDimColorPallet, Config.channelElevenDimColorPallet, Config.channelTwelveDimColorPallet];\r\n\tstatic readonly pitchChannelColorsBright: ReadonlyArray<string> = [Config.channelOneBrightColorPallet, Config.channelTwoBrightColorPallet, Config.channelThreeBrightColorPallet, Config.channelFourBrightColorPallet, Config.channelFiveBrightColorPallet, Config.channelSixBrightColorPallet, Config.channelSevenBrightColorPallet, Config.channelEightBrightColorPallet, Config.channelNineBrightColorPallet, Config.channelTenBrightColorPallet, Config.channelElevenBrightColorPallet, Config.channelTwelveBrightColorPallet];\r\n\tstatic readonly pitchNoteColorsDim: ReadonlyArray<string>       = [Config.channelOneDimColorPallet, Config.channelTwoDimColorPallet, Config.channelThreeDimColorPallet, Config.channelFourDimColorPallet, Config.channelFiveDimColorPallet, Config.channelSixDimColorPallet, Config.channelSevenDimColorPallet, Config.channelEightDimColorPallet, Config.channelNineDimColorPallet, Config.channelTenDimColorPallet, Config.channelElevenDimColorPallet, Config.channelTwelveDimColorPallet];\r\n\tstatic readonly pitchNoteColorsBright: ReadonlyArray<string>    = [Config.channelOneBrightColorPallet, Config.channelTwoBrightColorPallet, Config.channelThreeBrightColorPallet, Config.channelFourBrightColorPallet, Config.channelFiveBrightColorPallet, Config.channelSixBrightColorPallet, Config.channelSevenBrightColorPallet, Config.channelEightBrightColorPallet, Config.channelNineBrightColorPallet, Config.channelTenBrightColorPallet, Config.channelElevenBrightColorPallet, Config.channelTwelveBrightColorPallet];\r\n\tstatic readonly drumChannelColorsDim: ReadonlyArray<string>    = [Config.channelThirteenDimColorPallet, Config.channelFourteenDimColorPallet, Config.channelFifteenDimColorPallet, Config.channelSixteenDimColorPallet];\r\n\tstatic readonly drumChannelColorsBright: ReadonlyArray<string> = [Config.channelThirteenBrightColorPallet, Config.channelFourteenBrightColorPallet, Config.channelFifteenBrightColorPallet, Config.channelSixteenBrightColorPallet];\r\n\tstatic readonly drumNoteColorsDim: ReadonlyArray<string>       = [Config.channelThirteenDimColorPallet, Config.channelFourteenDimColorPallet, Config.channelFifteenDimColorPallet, Config.channelSixteenDimColorPallet];\r\n\tstatic readonly drumNoteColorsBright: ReadonlyArray<string>    = [Config.channelThirteenBrightColorPallet, Config.channelFourteenBrightColorPallet, Config.channelFifteenBrightColorPallet, Config.channelSixteenBrightColorPallet];\r\n\r\n\tstatic readonly midiPitchChannelNames: ReadonlyArray<string> = [\"cyan channel\", \"yellow channel\", \"orange channel\", \"green channel\", \"purple channel\", \"blue channel\"];\r\n\tstatic readonly midiDrumChannelNames: ReadonlyArray<string> = [\"gray channel\", \"brown channel\", \"indigo channel\"];\r\n\tstatic readonly midiSustainInstruments: number[] = [\r\n\t\t0x47, // triangle -> clarinet\r\n\t\t0x50, // square -> square wave\r\n\t\t0x46, // pulse wide -> bassoon\r\n\t\t0x44, // pulse narrow -> oboe\r\n\t\t0x51, // sawtooth -> sawtooth wave\r\n\t\t0x51, // double saw -> sawtooth wave\r\n\t\t0x51, // double pulse -> sawtooth wave\r\n\t\t0x51, // spiky -> sawtooth wave\r\n\t\t0x4A, // plateau -> recorder\r\n\t];\r\n\tstatic readonly midiDecayInstruments: number[] = [\r\n\t\t0x2E, // triangle -> harp\r\n\t\t0x2E, // square -> harp\r\n\t\t0x06, // pulse wide -> harpsichord\r\n\t\t0x18, // pulse narrow -> nylon guitar\r\n\t\t0x19, // sawtooth -> steel guitar\r\n\t\t0x19, // double saw -> steel guitar\r\n\t\t0x6A, // double pulse -> shamisen\r\n\t\t0x6A, // spiky -> shamisen\r\n\t\t0x21, // plateau -> fingered bass\r\n\t];\r\n\tstatic readonly drumInterval: number = 6;\r\n\tstatic readonly pitchCount: number = 37;\r\n\tstatic readonly maxPitch: number = 84;\r\n\tstatic readonly pitchChannelCountMin: number = 0;\r\n\tstatic readonly pitchChannelCountMax: number = 12;\r\n\tstatic readonly drumChannelCountMin: number = 0;\r\n\tstatic readonly drumChannelCountMax: number = 4;\r\n\tstatic readonly waves: ReadonlyArray<Float64Array> = [\r\n\t\tConfig._centerWave([1.0/15.0, 3.0/15.0, 5.0/15.0, 7.0/15.0, 9.0/15.0, 11.0/15.0, 13.0/15.0, 15.0/15.0, 15.0/15.0, 13.0/15.0, 11.0/15.0, 9.0/15.0, 7.0/15.0, 5.0/15.0, 3.0/15.0, 1.0/15.0, -1.0/15.0, -3.0/15.0, -5.0/15.0, -7.0/15.0, -9.0/15.0, -11.0/15.0, -13.0/15.0, -15.0/15.0, -15.0/15.0, -13.0/15.0, -11.0/15.0, -9.0/15.0, -7.0/15.0, -5.0/15.0, -3.0/15.0, -1.0/15.0]),\r\n\t\tConfig._centerWave([1.0, -1.0]),\r\n\t\tConfig._centerWave([1.0, -1.0, -1.0, -1.0]),\r\n\t\tConfig._centerWave([1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0]),\r\n\t\tConfig._centerWave([1.0/31.0, 3.0/31.0, 5.0/31.0, 7.0/31.0, 9.0/31.0, 11.0/31.0, 13.0/31.0, 15.0/31.0, 17.0/31.0, 19.0/31.0, 21.0/31.0, 23.0/31.0, 25.0/31.0, 27.0/31.0, 29.0/31.0, 31.0/31.0, -31.0/31.0, -29.0/31.0, -27.0/31.0, -25.0/31.0, -23.0/31.0, -21.0/31.0, -19.0/31.0, -17.0/31.0, -15.0/31.0, -13.0/31.0, -11.0/31.0, -9.0/31.0, -7.0/31.0, -5.0/31.0, -3.0/31.0, -1.0/31.0]),\r\n\t\tConfig._centerWave([0.0, -0.2, -0.4, -0.6, -0.8, -1.0, 1.0, -0.8, -0.6, -0.4, -0.2, 1.0, 0.8, 0.6, 0.4, 0.2]),\r\n\t\tConfig._centerWave([1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0]),\r\n\t\tConfig._centerWave([1.0, -1.0, 1.0, -1.0, 1.0, 0.0]),\r\n\t\tConfig._centerWave([0.0, 0.2, 0.4, 0.5, 0.6, 0.7, 0.8, 0.85, 0.9, 0.95, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.95, 0.9, 0.85, 0.8, 0.7, 0.6, 0.5, 0.4, 0.2, 0.0, -0.2, -0.4, -0.5, -0.6, -0.7, -0.8, -0.85, -0.9, -0.95, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -0.95, -0.9, -0.85, -0.8, -0.7, -0.6, -0.5, -0.4, -0.2]),\r\n\t\tConfig._centerWave([1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0,1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0]),\r\n\t\tConfig._centerWave([1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0]),\r\n\t\tConfig._centerWave([0.0, 0.1875, 0.3125, 0.5625, 0.5, 0.75, 0.875, 1.0, 1.0, 0.6875, 0.5, 0.625, 0.625, 0.5, 0.375, 0.5625, 0.4375, 0.5625, 0.4375, 0.4375, 0.3125, 0.1875, 0.1875, 0.375, 0.5625, 0.5625, 0.5625, 0.5625, 0.5625, 0.4375, 0.25, 0.0]),\r\n\t\tConfig._centerWave([1.0, 0.7, 0.1, 0.1, 0, 0, 0, 0, 0, 0.1, 0.2, 0.15, 0.25, 0.125, 0.215, 0.345, 4.0]),\r\n\t\tConfig._centerWave([1.0 / 15.0, 3.0 / 15.0, 5.0 / 15.0, 9.0, 0.06]),\r\n\t\tConfig._centerWave([-0.5, 3.5, 3.0, -0.5, -0.25, -1.0]),\r\n\t\tConfig._centerWave([0.0, 0.05, 0.125, 0.2, 0.25, 0.3, 0.425, 0.475, 0.525, 0.625, 0.675, 0.725, 0.775, 0.8, 0.825, 0.875, 0.9, 0.925, 0.95, 0.975, 0.98, 0.99, 0.995, 1, 0.995, 0.99, 0.98, 0.975, 0.95, 0.925, 0.9, 0.875, 0.825, 0.8, 0.775, 0.725, 0.675, 0.625, 0.525, 0.475, 0.425, 0.3, 0.25, 0.2, 0.125, 0.05, 0.0, -0.05, -0.125, -0.2, -0.25, -0.3, -0.425, -0.475, -0.525, -0.625, -0.675, -0.725, -0.775, -0.8, -0.825, -0.875, -0.9, -0.925, -0.95, -0.975, -0.98, -0.99, -0.995, -1, -0.995, -0.99, -0.98, -0.975, -0.95, -0.925, -0.9, -0.875, -0.825, -0.8, -0.775, -0.725, -0.675, -0.625, -0.525, -0.475, -0.425, -0.3, -0.25, -0.2, -0.125, -0.05]),\r\n\t\tConfig._centerWave([1.0, 1.0, 1.0, 1.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0]),\r\n\t\tConfig._centerWave([0.0, 0.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0]),\r\n\t\tConfig._centerWave([1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0]),\r\n\t\tConfig._centerWave([1.0, 1.0 / 2.0, 1.0 / 3.0, 1.0 / 4.0]),\r\n\t\tConfig._centerWave([-0.9, -1.0, -0.85, -0.775, -0.7, -0.6, -0.5, -0.4, -0.325, -0.225, -0.2, -0.125, -0.1, -0.11, -0.125, -0.15, -0.175, -0.18, -0.2, -0.21, -0.22, -0.21, -0.2, -0.175, -0.15, -0.1, -0.5, 0.75, 0.11, 0.175, 0.2, 0.25, 0.26, 0.275, 0.26, 0.25, 0.225, 0.2, 0.19, 0.18, 0.19, 0.2, 0.21, 0.22, 0.23, 0.24, 0.25, 0.26, 0.275, 0.28, 0.29, 0.3, 0.29, 0.28, 0.27, 0.26, 0.25, 0.225, 0.2, 0.175, 0.15, 0.1, 0.075, 0.0, -0.01, -0.025, 0.025, 0.075, 0.2, 0.3, 0.475, 0.6, 0.75, 0.85, 0.85, 1.0, 0.99, 0.95, 0.8, 0.675, 0.475, 0.275, 0.01, -0.15, -0.3, -0.475, -0.5, -0.6, -0.71, -0.81, -0.9, -1.0, -0.9]),\r\n\t\tConfig._centerWave([-1.0, -0.95, -0.975, -0.9, -0.85, -0.8, -0.775, -0.65, -0.6, -0.5, -0.475, -0.35, -0.275, -0.2, -0.125, -0.05, 0.0, 0.075, 0.125, 0.15, 0.20, 0.21, 0.225, 0.25, 0.225, 0.21, 0.20, 0.19, 0.175, 0.125, 0.10, 0.075, 0.06, 0.05, 0.04, 0.025, 0.04, 0.05, 0.10, 0.15, 0.225, 0.325, 0.425, 0.575, 0.70, 0.85, 0.95, 1.0, 0.9, 0.675, 0.375, 0.2, 0.275, 0.4, 0.5, 0.55, 0.6, 0.625, 0.65, 0.65, 0.65, 0.65, 0.64, 0.6, 0.55, 0.5, 0.4, 0.325, 0.25, 0.15, 0.05, -0.05, -0.15, -0.275, -0.35, -0.45, -0.55, -0.65, -0.7, -0.78, -0.825, -0.9, -0.925, -0.95, -0.975]),\r\n\t\tConfig._centerWave([1.0, 0.0, 0.1, -0.1, -0.2, -0.4, -0.3, -1.0]),\r\n\t\tConfig._centerWave([1.0, -1.0, 4.0, 2.15, 4.13, 5.15, 0.0, -0.05, 1.0]),\r\n\t\tConfig._centerWave([6.1, -2.9, 1.4, -2.9]),\r\n\t\tConfig._centerWave([1, 4, 2, 1, -0.1, -1, -0.12]),\r\n\t\tConfig._centerWave([0.2, 1.0, 2.6, 1.0, 0.0, -2.4]),\r\n\t\tConfig._centerWave([1.0, 0.9, 0.8, 0.7, 0.6, 0.5, 0.4, 0.3, 0.2, 0.1, 0.0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9]),\r\n\t\tConfig._centerWave([1.0, 0.9, 0.8, 0.7, 0.6, 0.5, 0.4, 0.3, 0.2, 0.1, 0.0]),\r\n\t\tConfig._centerWave([1.0, -0.9, 0.8, -0.7, 0.6, -0.5, 0.4, -0.3, 0.2, -0.1, 0.0, -0.1, 0.2, -0.3, 0.4, -0.5, 0.6, -0.7, 0.8, -0.9, 1.0]),\r\n\t];\r\n\tstatic readonly wavesMixC: ReadonlyArray<Float64Array> = [\r\n\t\tConfig._centerWave([1.0 / 15.0, 3.0 / 15.0, 5.0 / 15.0, 7.0 / 15.0, 9.0 / 15.0, 11.0 / 15.0, 13.0 / 15.0, 15.0 / 15.0, 15.0 / 15.0, 13.0 / 15.0, 11.0 / 15.0, 9.0 / 15.0, 7.0 / 15.0, 5.0 / 15.0, 3.0 / 15.0, 1.0 / 15.0, -1.0 / 15.0, -3.0 / 15.0, -5.0 / 15.0, -7.0 / 15.0, -9.0 / 15.0, -11.0 / 15.0, -13.0 / 15.0, -15.0 / 15.0, -15.0 / 15.0, -13.0 / 15.0, -11.0 / 15.0, -9.0 / 15.0, -7.0 / 15.0, -5.0 / 15.0, -3.0 / 15.0, -1.0 / 15.0]),\r\n\t\tConfig._centerWave([1.0, -1.0]),\r\n\t\tConfig._centerWave([1.0, -1.0, -1.0, -1.0]),\r\n\t\tConfig._centerWave([1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0]),\r\n\t\tConfig._centerWave([1.0 / 31.0, 3.0 / 31.0, 5.0 / 31.0, 7.0 / 31.0, 9.0 / 31.0, 11.0 / 31.0, 13.0 / 31.0, 15.0 / 31.0, 17.0 / 31.0, 19.0 / 31.0, 21.0 / 31.0, 23.0 / 31.0, 25.0 / 31.0, 27.0 / 31.0, 29.0 / 31.0, 31.0 / 31.0, -31.0 / 31.0, -29.0 / 31.0, -27.0 / 31.0, -25.0 / 31.0, -23.0 / 31.0, -21.0 / 31.0, -19.0 / 31.0, -17.0 / 31.0, -15.0 / 31.0, -13.0 / 31.0, -11.0 / 31.0, -9.0 / 31.0, -7.0 / 31.0, -5.0 / 31.0, -3.0 / 31.0, -1.0 / 31.0]),\r\n\t\tConfig._centerWave([0.0, -0.2, -0.4, -0.6, -0.8, -1.0, 1.0, -0.8, -0.6, -0.4, -0.2, 1.0, 0.8, 0.6, 0.4, 0.2]),\r\n\t\tConfig._centerWave([1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0]),\r\n\t\tConfig._centerWave([1.0, -1.0, 1.0, -1.0, 1.0, 0.0]),\r\n\t\tConfig._centerWave([0.0, 0.2, 0.4, 0.5, 0.6, 0.7, 0.8, 0.85, 0.9, 0.95, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.95, 0.9, 0.85, 0.8, 0.7, 0.6, 0.5, 0.4, 0.2, 0.0, -0.2, -0.4, -0.5, -0.6, -0.7, -0.8, -0.85, -0.9, -0.95, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -0.95, -0.9, -0.85, -0.8, -0.7, -0.6, -0.5, -0.4, -0.2]),\r\n\t\tConfig._centerWave([1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0,1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0]),\r\n\t\tConfig._centerWave([1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0]),\r\n\t\tConfig._centerWave([0.0, 0.1875, 0.3125, 0.5625, 0.5, 0.75, 0.875, 1.0, 1.0, 0.6875, 0.5, 0.625, 0.625, 0.5, 0.375, 0.5625, 0.4375, 0.5625, 0.4375, 0.4375, 0.3125, 0.1875, 0.1875, 0.375, 0.5625, 0.5625, 0.5625, 0.5625, 0.5625, 0.4375, 0.25, 0.0]),\r\n\t\tConfig._centerWave([1.0, 0.7, 0.1, 0.1, 0, 0, 0, 0, 0, 0.1, 0.2, 0.15, 0.25, 0.125, 0.215, 0.345, 4.0]),\r\n\t\tConfig._centerWave([1.0 / 15.0, 3.0 / 15.0, 5.0 / 15.0, 9.0, 0.06]),\r\n\t\tConfig._centerWave([-0.5, 3.5, 3.0, -0.5, -0.25, -1.0]),\r\n\t\tConfig._centerWave([0.0, 0.05, 0.125, 0.2, 0.25, 0.3, 0.425, 0.475, 0.525, 0.625, 0.675, 0.725, 0.775, 0.8, 0.825, 0.875, 0.9, 0.925, 0.95, 0.975, 0.98, 0.99, 0.995, 1, 0.995, 0.99, 0.98, 0.975, 0.95, 0.925, 0.9, 0.875, 0.825, 0.8, 0.775, 0.725, 0.675, 0.625, 0.525, 0.475, 0.425, 0.3, 0.25, 0.2, 0.125, 0.05, 0.0, -0.05, -0.125, -0.2, -0.25, -0.3, -0.425, -0.475, -0.525, -0.625, -0.675, -0.725, -0.775, -0.8, -0.825, -0.875, -0.9, -0.925, -0.95, -0.975, -0.98, -0.99, -0.995, -1, -0.995, -0.99, -0.98, -0.975, -0.95, -0.925, -0.9, -0.875, -0.825, -0.8, -0.775, -0.725, -0.675, -0.625, -0.525, -0.475, -0.425, -0.3, -0.25, -0.2, -0.125, -0.05]),\r\n\t\tConfig._centerWave([1.0, 1.0, 1.0, 1.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0]),\r\n\t\tConfig._centerWave([0.0, 0.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0]),\r\n\t\tConfig._centerWave([1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0]),\r\n\t\tConfig._centerWave([1.0, 1.0 / 2.0, 1.0 / 3.0, 1.0 / 4.0]),\r\n\t\tConfig._centerWave([-0.9, -1.0, -0.85, -0.775, -0.7, -0.6, -0.5, -0.4, -0.325, -0.225, -0.2, -0.125, -0.1, -0.11, -0.125, -0.15, -0.175, -0.18, -0.2, -0.21, -0.22, -0.21, -0.2, -0.175, -0.15, -0.1, -0.5, 0.75, 0.11, 0.175, 0.2, 0.25, 0.26, 0.275, 0.26, 0.25, 0.225, 0.2, 0.19, 0.18, 0.19, 0.2, 0.21, 0.22, 0.23, 0.24, 0.25, 0.26, 0.275, 0.28, 0.29, 0.3, 0.29, 0.28, 0.27, 0.26, 0.25, 0.225, 0.2, 0.175, 0.15, 0.1, 0.075, 0.0, -0.01, -0.025, 0.025, 0.075, 0.2, 0.3, 0.475, 0.6, 0.75, 0.85, 0.85, 1.0, 0.99, 0.95, 0.8, 0.675, 0.475, 0.275, 0.01, -0.15, -0.3, -0.475, -0.5, -0.6, -0.71, -0.81, -0.9, -1.0, -0.9]),\r\n\t\tConfig._centerWave([-1.0, -0.95, -0.975, -0.9, -0.85, -0.8, -0.775, -0.65, -0.6, -0.5, -0.475, -0.35, -0.275, -0.2, -0.125, -0.05, 0.0, 0.075, 0.125, 0.15, 0.20, 0.21, 0.225, 0.25, 0.225, 0.21, 0.20, 0.19, 0.175, 0.125, 0.10, 0.075, 0.06, 0.05, 0.04, 0.025, 0.04, 0.05, 0.10, 0.15, 0.225, 0.325, 0.425, 0.575, 0.70, 0.85, 0.95, 1.0, 0.9, 0.675, 0.375, 0.2, 0.275, 0.4, 0.5, 0.55, 0.6, 0.625, 0.65, 0.65, 0.65, 0.65, 0.64, 0.6, 0.55, 0.5, 0.4, 0.325, 0.25, 0.15, 0.05, -0.05, -0.15, -0.275, -0.35, -0.45, -0.55, -0.65, -0.7, -0.78, -0.825, -0.9, -0.925, -0.95, -0.975]),\r\n\t\tConfig._centerWave([0.7, 0.0, 0.1, -0.1, -0.2, -0.4, -0.3, -0.7]),\r\n\t\tConfig._centerWave([1.0, -1.0, 4.0, 2.15, 4.1, 5.05, 0.0, -0.05, 1.0]),\r\n\t\tConfig._centerWave([4.5, -1.7, 1.0, -1.7]),\r\n\t\tConfig._centerWave([0.1, 0.4, 0.2, 0.1, -0.1, -1, -0.12]),\r\n\t\tConfig._centerWave([.03, .13, .30, 1.0, 0.0, -.26]),\r\n\t\tConfig._centerWave([2, 1.75, 1.5, 1.25, 1, .75, .5, .25, 0.0, 0.25, 0.5, 0.75, 1, 1.25, 1.5, 1.75]),\r\n\t\tConfig._centerWave([1.0, 1.9, 1.8, 1.7, 1.6, 1.5, 1.4, 1.3, 1.2, 1.1, 1.0]),\r\n\t\tConfig._centerWave([-1.0, -0.9, 0.8, -0.7, 0.6, -0.5, 0.4, -0.3, 0.2, -0.1, 0.0, -0.1, 0.2, -0.3, 0.4, -0.5, 0.6, -0.7, 0.8, -0.9, -1.0]),\r\n\t];\r\n\tstatic readonly pwmwaves: ReadonlyArray<Float64Array> = [\r\n\t\tConfig._centerWave([1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0]),\r\n\t\tConfig._centerWave([1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0]),\r\n\t\tConfig._centerWave([1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0]),\r\n\t\tConfig._centerWave([1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0]),\r\n\t\tConfig._centerWave([1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0]),\r\n\t\tConfig._centerWave([1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0]),\r\n\t\tConfig._centerWave([1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0]),\r\n\t\tConfig._centerWave([1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0]),\r\n\t\tConfig._centerWave([1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0, -1.0]),\r\n\t\tConfig._centerWave([1.0, 1.0, 1.0, 1.0, 1.0, -1.0, -1.0, -1.0, -1.0, -1.0]),\r\n\t];\r\n\tstatic readonly sineWaveLength: number = 1 << 8; // 256\r\n\tstatic readonly sineWaveMask: number = Config.sineWaveLength - 1;\r\n\tstatic readonly sineWave: Float64Array = Config.generateSineWave();\r\n\t\r\n\tprivate static _centerWave(wave: Array<number>): Float64Array {\r\n\t\tlet sum: number = 0.0;\r\n\t\tfor (let i: number = 0; i < wave.length; i++) sum += wave[i];\r\n\t\tconst average: number = sum / wave.length;\r\n\t\tfor (let i: number = 0; i < wave.length; i++) wave[i] -= average;\r\n\t\treturn new Float64Array(wave);\r\n\t}\r\n\t\r\n\tstatic getDrumWave(index: number): Float32Array {\r\n\t\tlet wave: Float32Array | null = Config._drumWaves[index];\r\n\t\tif (wave == null) {\r\n\t\t\twave = new Float32Array(32768);\r\n\t\t\tConfig._drumWaves[index] = wave;\r\n\t\t\t\r\n\t\t\tif (index == 0) {\r\n\t\t\t\t// The \"retro\" drum uses a \"Linear Feedback Shift Register\" similar to the NES noise channel.\r\n\t\t\t\tlet drumBuffer: number = 1;\r\n\t\t\t\tfor (let i: number = 0; i < 32768; i++) {\r\n\t\t\t\t\twave[i] = (drumBuffer & 1) * 2.0 - 1.0;\r\n\t\t\t\t\tlet newBuffer: number = drumBuffer >> 1;\r\n\t\t\t\t\tif (((drumBuffer + newBuffer) & 1) == 1) {\r\n\t\t\t\t\t\tnewBuffer += 1 << 14;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdrumBuffer = newBuffer;\r\n\t\t\t\t}\r\n\t\t\t} else if (index == 1) {\r\n\t\t\t\t// White noise is just random values for each sample.\r\n\t\t\t\tfor (let i: number = 0; i < 32768; i++) {\r\n\t\t\t\t\twave[i] = Math.random() * 2.0 - 1.0;\r\n\t\t\t\t}\r\n\t\t\t} else if (index == 2) {\r\n\t\t\t\t// \"periodic\" drum.\r\n\t\t\t\tlet drumBuffer: number = 1;\r\n\t\t\t\tfor (let i: number = 0; i < 32768; i++) {\r\n\t\t\t\t\twave[i] = (drumBuffer & 1) * 2.0 - 1.0;\r\n\t\t\t\t\tlet newBuffer: number = drumBuffer >> 1;\r\n\t\t\t\t\tif (((drumBuffer + newBuffer) & 1) == 1) {\r\n\t\t\t\t\t\tnewBuffer += 2 << 14;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdrumBuffer = newBuffer;\r\n\t\t\t\t}\r\n\t\t\t} else if (index == 3) {\r\n\t\t\t\t// \"detuned periodic\" drum.\r\n\t\t\t\tlet drumBuffer: number = 1;\r\n\t\t\t\tfor (let i: number = 0; i < 32767; i++) {\r\n\t\t\t\t\twave[i] = (drumBuffer & 1) * 2.0 - 1.0;\r\n\t\t\t\t\tlet newBuffer: number = drumBuffer >> 2;\r\n\t\t\t\t\tif (((drumBuffer + newBuffer) & 1) == 1) {\r\n\t\t\t\t\t\tnewBuffer += 4 << 14;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdrumBuffer = newBuffer;\r\n\t\t\t\t}\r\n\t\t\t} else if (index == 4) {\r\n\t\t\t\t// \"shine\" drum.\r\n\t\t\t\tlet drumBuffer: number = 1;\r\n\t\t\t\tfor (let i: number = 0; i < 32768; i++) {\r\n\t\t\t\t\twave[i] = (drumBuffer & 1) * 2.0 - 1.0;\r\n\t\t\t\t\tlet newBuffer: number = drumBuffer >> 1;\r\n\t\t\t\t\tif (((drumBuffer + newBuffer) & 1) == 1) {\r\n\t\t\t\t\t\tnewBuffer += 10 << 2;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdrumBuffer = newBuffer;\r\n\t\t\t\t}\r\n\t\t\t} else if (index == 5) {\r\n\t\t\t\t// \"hollow\" drums, designed in frequency space and then converted via FFT:\r\n\t\t\t\tConfig.drawNoiseSpectrum(wave, 10, 11, 1, 1, 0);\r\n\t\t\t\tConfig.drawNoiseSpectrum(wave, 11, 14, -2, -2, 0);\r\n\t\t\t\tinverseRealFourierTransform(wave);\r\n\t\t\t\tscaleElementsByFactor(wave, 1.0 / Math.sqrt(wave.length));\r\n\t\t\t} else if (index == 6) {\r\n\t\t\t\t// \"deep\" drum, designed in frequency space and then converted via FFT:\r\n\t\t\t\tConfig.drawNoiseSpectrum(wave, 1, 10, 1, 1, 0);\r\n\t\t\t\tConfig.drawNoiseSpectrum(wave, 20, 14, -2, -2, 0);\r\n\t\t\t\tinverseRealFourierTransform(wave);\r\n\t\t\t\tscaleElementsByFactor(wave, 1.0 / Math.sqrt(wave.length));\r\n\t\t\t} else if (index == 7) {\r\n\t\t\t\t// \"cutter\" drum.\r\n\t\t\t\tlet drumBuffer: number = 1;\r\n\t\t\t\tfor (let i: number = 0; i < 32768; i++) {\r\n\t\t\t\t\twave[i] = (drumBuffer & 1) * 4.0 * Math.random();\r\n\t\t\t\t\tlet newBuffer: number = drumBuffer >> 1;\r\n\t\t\t\t\tif (((drumBuffer + newBuffer) & 1) == 1) {\r\n\t\t\t\t\t\tnewBuffer += 15 << 2;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdrumBuffer = newBuffer;\r\n\t\t\t\t}\r\n\t\t\t} else if (index == 8) {\r\n\t\t\t\t// \"metallic\" drum.\r\n\t\t\t\tlet drumBuffer: number = 1;\r\n\t\t\t\tfor (let i: number = 0; i < 32768; i++) {\r\n\t\t\t\t\twave[i] = (drumBuffer & 1) / 2.0 + 0.5;\r\n\t\t\t\t\tlet newBuffer: number = drumBuffer >> 1;\r\n\t\t\t\t\tif (((drumBuffer + newBuffer) & 1) == 1) {\r\n\t\t\t\t\t\tnewBuffer -= 10 << 2;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdrumBuffer = newBuffer;\r\n\t\t\t\t}\r\n\t\t\t} else if (index == 9) {\r\n\t\t\t\t// \"snare\" drum.\r\n\t\t\t\tfor (let i: number = 0; i < 32768; i++) {\r\n\t\t\t\t\twave[i] = Math.random() * 2.0 - 1.0;\r\n\t\t\t\t}\r\n\t\t\t/*\r\n\t\t\t} else if (index == 10) {\r\n\t\t\t\t// \"tom-tom\" drums, designed in frequency space and then converted via FFT:\r\n\t\t\t\tConfig.drawNoiseSpectrum(wave, 10, 14, 0, -4, 0);\r\n\t\t\t\tinverseRealFourierTransform(wave);\r\n\t\t\t\tscaleElementsByFactor(wave, 1.0 / Math.sqrt(wave.length));\r\n\t\t\t} else if (index == 11) {\r\n\t\t\t\t// \"cymbal\" drums, designed in frequency space and then converted via FFT:\r\n\t\t\t\tConfig.drawNoiseSpectrum(wave, 9, 9.4, -1, -1, -0.5);\r\n\t\t\t\tConfig.drawNoiseSpectrum(wave, 9.7, 10, -1, -1, -0.5);\r\n\t\t\t\tConfig.drawNoiseSpectrum(wave, 10.3, 10.6, -1, -1, -0.5);\r\n\t\t\t\tConfig.drawNoiseSpectrum(wave, 10.9, 11.1, -1, -1, -0.5);\r\n\t\t\t\tConfig.drawNoiseSpectrum(wave, 11.3, 11.4, 0, 0, -0.5);\r\n\t\t\t\tConfig.drawNoiseSpectrum(wave, 11.5, 11.7, 1.5, 1.5, -0.5);\r\n\t\t\t\tConfig.drawNoiseSpectrum(wave, 11.7, 12, -1, -1, -0.5);\r\n\t\t\t\tConfig.drawNoiseSpectrum(wave, 12, 12.1, 2, 2, -0.5);\r\n\t\t\t\tConfig.drawNoiseSpectrum(wave, 12.1, 12.6, 0, 2, -0.5);\r\n\t\t\t\tConfig.drawNoiseSpectrum(wave, 12.6, 13, 0, 0, -0.5);\r\n\t\t\t\tConfig.drawNoiseSpectrum(wave, 13, 14, 1, -3, -0.5);\r\n\t\t\t\tinverseRealFourierTransform(wave);\r\n\t\t\t\tscaleElementsByFactor(wave, 1.0 / Math.sqrt(wave.length));\r\n\t\t\t} else if (index == 12) {\r\n\t\t\t\t// \"bass\" drums, designed in frequency space and then converted via FFT:\r\n\t\t\t\tConfig.drawNoiseSpectrum(wave, 7, 8, -2, 4, 0);\r\n\t\t\t\tConfig.drawNoiseSpectrum(wave, 8, 9, 4, -2, 0);\r\n\t\t\t\tConfig.drawNoiseSpectrum(wave, 9, 14, -2, -6, 0);\r\n\t\t\t\tinverseRealFourierTransform(wave);\r\n\t\t\t\tscaleElementsByFactor(wave, 1.0 / Math.sqrt(wave.length));\r\n\t\t\t*/\r\n\t\t\t} else {\r\n\t\t\t\tthrow new Error(\"Unrecognized drum index: \" + index);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\treturn wave;\r\n\t}\r\n\t\r\n\tprivate static drawNoiseSpectrum(wave: Float32Array, lowOctave: number, highOctave: number, lowPower: number, highPower: number, overalSlope: number): void {\r\n\t\tconst referenceOctave: number = 11;\r\n\t\tconst referenceIndex: number = 1 << referenceOctave;\r\n\t\tconst lowIndex: number = Math.pow(2, lowOctave) | 0;\r\n\t\tconst highIndex: number = Math.pow(2, highOctave) | 0;\r\n\t\tconst log2: number = Math.log(2);\r\n\t\tfor (let i: number = lowIndex; i < highIndex; i++) {\r\n\t\t\tlet amplitude: number = Math.pow(2, lowPower + (highPower - lowPower) * (Math.log(i) / log2 - lowOctave) / (highOctave - lowOctave));\r\n\t\t\tamplitude *= Math.pow(i / referenceIndex, overalSlope);\r\n\t\t\tconst radians: number = Math.random() * Math.PI * 2.0;\r\n\t\t\twave[i] = Math.cos(radians) * amplitude;\r\n\t\t\twave[32768 - i] = Math.sin(radians) * amplitude;\r\n\t\t}\r\n\t}\r\n\t\r\n\tprivate static generateSineWave(): Float64Array {\r\n\t\tconst wave: Float64Array = new Float64Array(Config.sineWaveLength + 1);\r\n\t\tfor (let i: number = 0; i < Config.sineWaveLength + 1; i++) {\r\n\t\t\twave[i] = Math.sin(i * Math.PI * 2.0 / Config.sineWaveLength);\r\n\t\t}\r\n\t\treturn wave;\r\n\t}\r\n}\r\n\r\n// Pardon the messy type casting. This allows accessing array members by numerical index or string name.\r\nexport function toNameMap<T extends BeepBoxOption>(array: Array<Pick<T, Exclude<keyof T, \"index\">>>): DictionaryArray<T> {\r\n\tconst dictionary: Dictionary<T> = {};\r\n\tfor (let i: number = 0; i < array.length; i++) {\r\n\t\tconst value: any = array[i];\r\n\t\tvalue.index = i;\r\n\t\tdictionary[value.name] = <T> value;\r\n\t}\r\n\tconst result: DictionaryArray<T> = <DictionaryArray<T>> <any> array;\r\n\tresult.dictionary = dictionary;\r\n\treturn result;\r\n}","// Copyright (C) John Nesky, distributed under the MIT license.\n\nexport function applyElementArgs<T extends HTMLElement | SVGElement | DocumentFragment>(element: T, args: Array<any>): T {\n\tfor (const arg of args) {\n\t\tif (arg instanceof Node) {\n\t\t\telement.appendChild(arg);\n\t\t} else if (typeof arg === \"string\") {\n\t\t\telement.appendChild(document.createTextNode(arg));\n\t\t} else if (typeof arg === \"function\") {\n\t\t\tapplyElementArgs(element, [arg()]);\n\t\t} else if (Array.isArray(arg)) {\n\t\t\tapplyElementArgs(element, arg);\n\t\t} else if (arg && typeof Symbol !== \"undefined\" && typeof arg[Symbol.iterator] === \"function\") {\n\t\t\tapplyElementArgs(element, [...arg]);\n\t\t} else if (arg && arg.constructor === Object && element instanceof Element) {\n\t\t\t// If the argument is a literal {} Object\n\t\t\tfor (const key of Object.keys(arg)) {\n\t\t\t\tconst value = arg[key];\n\t\t\t\t/*if (key === \"classList\") {\n\t\t\t\t\tif (typeof value === \"string\") {\n\t\t\t\t\t\telement.classList.add(...value.split(\" \"));\n\t\t\t\t\t} else if (Array.isArray(arg) || (value && typeof Symbol !== \"undefined\" && typeof value[Symbol.iterator] === \"function\")) {\n\t\t\t\t\t\telement.classList.add(...value);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.warn(\"Invalid classList value \\\"\" + value + \"\\\" on \" + element.tagName + \" element.\");\n\t\t\t\t\t}\n\t\t\t\t} else*/ if (key === \"class\" /* || key === \"className\" */) {\n\t\t\t\t\tif (typeof value === \"string\") {\n\t\t\t\t\t\telement.setAttribute(\"class\", value);\n\t\t\t\t\t} else if (Array.isArray(arg) || (value && typeof Symbol !== \"undefined\" && typeof value[Symbol.iterator] === \"function\")) {\n\t\t\t\t\t\telement.setAttribute(\"class\", [...value].join(\" \"));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.warn(\"Invalid \" + key + \" value \\\"\" + value + \"\\\" on \" + element.tagName + \" element.\");\n\t\t\t\t\t}\n\t\t\t\t} else if (key === \"style\") {\n\t\t\t\t\tif (value && value.constructor === Object) {\n\t\t\t\t\t\tfor (const styleKey of Object.keys(value)) {\n\t\t\t\t\t\t\tif (styleKey in (<HTMLElement | SVGElement>element).style) {\n\t\t\t\t\t\t\t\t// In practice, camelCase and kebab-case properties both work as properties on CSSStyleDeclaration objects.\n\t\t\t\t\t\t\t\t(<any> element).style[styleKey] = value[styleKey];\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// CSS variables start with -- and must be set with setProperty.\n\t\t\t\t\t\t\t\t(<HTMLElement | SVGElement>element).style.setProperty(styleKey, value[styleKey]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\telement.setAttribute(key, value);\n\t\t\t\t\t}\n\t\t\t\t} else if (typeof(value) === \"function\") {\n\t\t\t\t\t// If value is a callback, set as a property instead trying to coerce to string.\n\t\t\t\t\t(<any>element)[key] = value;\n\t\t\t\t} else if (typeof(value) === \"boolean\") {\n\t\t\t\t\t// If value is boolean, set attribute if true, remove if false.\n\t\t\t\t\tif (value) element.setAttribute(key, \"\");\n\t\t\t\t\telse element.removeAttribute(key);\n\t\t\t\t} else {\n\t\t\t\t\t// Default to setting attribute, as if writing html directly.\n\t\t\t\t\telement.setAttribute(key, value);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\t// Just convert unrecognized objects to text and append them.\n\t\t\telement.appendChild(document.createTextNode(arg));\n\t\t}\n\t}\n\treturn element;\n}\n\nexport const svgNS: string = \"http://www.w3.org/2000/svg\";\n\nexport function parseHTML(...args: Array<any>): DocumentFragment {\n\treturn document.createRange().createContextualFragment(args.join());\n}\n\n//let svgParser: SVGSVGElement | null = null;\nexport function parseSVG(...args: Array<any>): DocumentFragment {\n\tconst fragment: DocumentFragment = document.createDocumentFragment();\n\t\n\t// Internet Explorer doesn't support the first method here, so I commented it out and used a slightly more complex one involving DOMParser below.\n\t/*\n\tif (svgParser === null) svgParser = <SVGSVGElement>document.createElementNS(svgNS, \"svg\");\n\tsvgParser.innerHTML = args.join();\n\twhile (svgParser.firstChild !== null) fragment.appendChild(svgParser.firstChild);\n\t*/\n\tconst svgParser: Element = new DOMParser().parseFromString(\"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\">\" + args.join() + \"</svg>\", \"image/svg+xml\").documentElement;\n\twhile (svgParser.firstChild !== null) {\n\t\tdocument.importNode(svgParser.firstChild, true);\n\t\tfragment.appendChild(svgParser.firstChild);\n\t}\n\t\n\treturn fragment;\n}\n\nexport function replaceScriptWith(...args: Array<any>): void {\n\tlet currentScript: HTMLScriptElement | SVGScriptElement | null = document.currentScript;\n\tif (currentScript == null) { // double-equals to intentionally include undefined in Internet Explorer.\n\t\t\n\t\t// Internet Explorer doens't support currentScript, try this method instead:\n\t\tif (document.readyState === \"loading\") {\n\t\t\tconst scripts: HTMLCollectionOf<HTMLScriptElement> = document.getElementsByTagName(\"script\");\n\t\t\tcurrentScript = scripts[scripts.length - 1];\n\t\t}\n\t\t\n\t\tif (currentScript == null) {\n\t\t\tconsole.warn(\"Couldn't replace script because no script is currently being parsed and executed, maybe this is happening in a callback function or event handler instead?\");\n\t\t\treturn;\n\t\t}\n\t}\n\tif (currentScript.parentNode === null) {\n\t\tconsole.warn(\"Couldn't replace script element because it is not attached to a parent anymore, did you try to replace the same script more than once?\");\n\t\treturn;\n\t}\n\tcurrentScript.parentNode.replaceChild(applyElementArgs(document.createDocumentFragment(), args), currentScript);\n}\n\nexport function applyToElement<T extends HTMLElement | SVGElement | DocumentFragment>(element: T, ...args: Array<any>): T {\n\tif (!(element instanceof Element || element instanceof DocumentFragment)) {\n\t\tconsole.warn(\"Couldn't apply to provided argument because it's not an element or DocumentFragment.\");\n\t\treturn element;\n\t}\n\treturn applyElementArgs(element, args);\n}\n","// Copyright (C) John Nesky, distributed under the MIT license.\n\nimport {applyElementArgs, svgNS, parseHTML, parseSVG, replaceScriptWith, applyToElement} from \"./elements-base.js\";\nexport {replaceScriptWith, applyToElement};\n\ninterface HTMLElementFactory {\n\t(...args: Array<string>): DocumentFragment;\n\t//readonly [key: string]: (...args: Array<any>) => HTMLElement;\n\ta(...args: Array<any>): HTMLAnchorElement;\n\tabbr(...args: Array<any>): HTMLElement;\n\taddress(...args: Array<any>): HTMLElement;\n\tarea(...args: Array<any>): HTMLAreaElement;\n\tarticle(...args: Array<any>): HTMLElement;\n\taside(...args: Array<any>): HTMLElement;\n\taudio(...args: Array<any>): HTMLAudioElement;\n\tb(...args: Array<any>): HTMLElement;\n\tbase(...args: Array<any>): HTMLBaseElement;\n\tbdi(...args: Array<any>): HTMLElement;\n\tbdo(...args: Array<any>): HTMLElement;\n\tblockquote(...args: Array<any>): HTMLQuoteElement;\n\tbr(...args: Array<any>): HTMLBRElement;\n\tbutton(...args: Array<any>): HTMLButtonElement;\n\tcanvas(...args: Array<any>): HTMLCanvasElement;\n\tcaption(...args: Array<any>): HTMLTableCaptionElement;\n\tcite(...args: Array<any>): HTMLElement;\n\tcode(...args: Array<any>): HTMLElement;\n\tcol(...args: Array<any>): HTMLTableColElement;\n\tcolgroup(...args: Array<any>): HTMLTableColElement;\n\tdatalist(...args: Array<any>): HTMLDataListElement;\n\tdd(...args: Array<any>): HTMLElement;\n\tdel(...args: Array<any>): HTMLModElement;\n\tdetails(...args: Array<any>): HTMLDetailsElement;\n\tdfn(...args: Array<any>): HTMLElement;\n\tdialog(...args: Array<any>): HTMLDialogElement;\n\tdiv(...args: Array<any>): HTMLDivElement;\n\tdl(...args: Array<any>): HTMLDListElement;\n\tdt(...args: Array<any>): HTMLElement;\n\tem(...args: Array<any>): HTMLElement;\n\tembed(...args: Array<any>): HTMLEmbedElement;\n\tfieldset(...args: Array<any>): HTMLFieldSetElement;\n\tfigcaption(...args: Array<any>): HTMLElement;\n\tfigure(...args: Array<any>): HTMLElement;\n\tfooter(...args: Array<any>): HTMLElement;\n\tform(...args: Array<any>): HTMLFormElement;\n\th1(...args: Array<any>): HTMLHeadingElement;\n\th2(...args: Array<any>): HTMLHeadingElement;\n\th3(...args: Array<any>): HTMLHeadingElement;\n\th4(...args: Array<any>): HTMLHeadingElement;\n\th5(...args: Array<any>): HTMLHeadingElement;\n\th6(...args: Array<any>): HTMLHeadingElement;\n\theader(...args: Array<any>): HTMLElement;\n\thr(...args: Array<any>): HTMLHRElement;\n\ti(...args: Array<any>): HTMLElement;\n\tiframe(...args: Array<any>): HTMLIFrameElement;\n\timg(...args: Array<any>): HTMLImageElement;\n\tinput(...args: Array<any>): HTMLInputElement;\n\tins(...args: Array<any>): HTMLModElement;\n\tkbd(...args: Array<any>): HTMLElement;\n\tlabel(...args: Array<any>): HTMLLabelElement;\n\tlegend(...args: Array<any>): HTMLLegendElement;\n\tli(...args: Array<any>): HTMLLIElement;\n\tlink(...args: Array<any>): HTMLLinkElement;\n\tmain(...args: Array<any>): HTMLElement;\n\tmap(...args: Array<any>): HTMLMapElement;\n\tmark(...args: Array<any>): HTMLElement;\n\tmenu(...args: Array<any>): HTMLMenuElement;\n\tmenuitem(...args: Array<any>): HTMLUnknownElement;\n\tmeta(...args: Array<any>): HTMLMetaElement;\n\tmeter(...args: Array<any>): HTMLMeterElement;\n\tnav(...args: Array<any>): HTMLElement;\n\tnoscript(...args: Array<any>): HTMLElement;\n\tobject(...args: Array<any>): HTMLObjectElement;\n\tol(...args: Array<any>): HTMLOListElement;\n\toptgroup(...args: Array<any>): HTMLOptGroupElement;\n\toption(...args: Array<any>): HTMLOptionElement;\n\toutput(...args: Array<any>): HTMLOutputElement;\n\tp(...args: Array<any>): HTMLParagraphElement;\n\tparam(...args: Array<any>): HTMLParamElement;\n\tpicture(...args: Array<any>): HTMLPictureElement;\n\tpre(...args: Array<any>): HTMLPreElement;\n\tprogress(...args: Array<any>): HTMLProgressElement;\n\tq(...args: Array<any>): HTMLQuoteElement;\n\trp(...args: Array<any>): HTMLElement;\n\trt(...args: Array<any>): HTMLElement;\n\truby(...args: Array<any>): HTMLElement;\n\ts(...args: Array<any>): HTMLElement;\n\tsamp(...args: Array<any>): HTMLElement;\n\tscript(...args: Array<any>): HTMLScriptElement;\n\tsection(...args: Array<any>): HTMLElement;\n\tselect(...args: Array<any>): HTMLSelectElement;\n\tsmall(...args: Array<any>): HTMLElement;\n\tsource(...args: Array<any>): HTMLSourceElement;\n\tspan(...args: Array<any>): HTMLSpanElement;\n\tstrong(...args: Array<any>): HTMLElement;\n\tstyle(...args: Array<any>): HTMLStyleElement;\n\tsub(...args: Array<any>): HTMLElement;\n\tsummary(...args: Array<any>): HTMLElement;\n\tsup(...args: Array<any>): HTMLElement;\n\ttable(...args: Array<any>): HTMLTableElement;\n\ttbody(...args: Array<any>): HTMLTableSectionElement;\n\ttd(...args: Array<any>): HTMLTableCellElement;\n\ttemplate(...args: Array<any>): HTMLTemplateElement;\n\ttextarea(...args: Array<any>): HTMLTextAreaElement;\n\ttfoot(...args: Array<any>): HTMLTableSectionElement;\n\tth(...args: Array<any>): HTMLTableCellElement;\n\tthead(...args: Array<any>): HTMLTableSectionElement;\n\ttime(...args: Array<any>): HTMLTimeElement;\n\ttitle(...args: Array<any>): HTMLTitleElement;\n\ttr(...args: Array<any>): HTMLTableRowElement;\n\ttrack(...args: Array<any>): HTMLTrackElement;\n\tu(...args: Array<any>): HTMLElement;\n\tul(...args: Array<any>): HTMLUListElement;\n\tvar(...args: Array<any>): HTMLElement;\n\tvideo(...args: Array<any>): HTMLVideoElement;\n\twbr(...args: Array<any>): HTMLElement;\n}\n\ninterface SVGElementFactory {\n\t(...args: Array<string>): DocumentFragment;\n\t//readonly [key: string]: (...args: Array<any>) => SVGElement;\n\ta(...args: Array<any>): SVGAElement;\n\taltGlyph(...args: Array<any>): SVGElement;\n\taltGlyphDef(...args: Array<any>): SVGElement;\n\taltGlyphItem(...args: Array<any>): SVGElement;\n\tanimate(...args: Array<any>): SVGAnimateElement;\n\tanimateMotion(...args: Array<any>): SVGAnimateMotionElement;\n\tanimateTransform(...args: Array<any>): SVGAnimateTransformElement;\n\tcircle(...args: Array<any>): SVGCircleElement;\n\tclipPath(...args: Array<any>): SVGClipPathElement;\n\t\"color-profile\"(...args: Array<any>): SVGElement;\n\tcolor_profile(...args: Array<any>): SVGElement;\n\tcursor(...args: Array<any>): SVGElement;\n\tdefs(...args: Array<any>): SVGDefsElement;\n\tdesc(...args: Array<any>): SVGDescElement;\n\tdiscard(...args: Array<any>): SVGElement;\n\tellipse(...args: Array<any>): SVGEllipseElement;\n\tfeBlend(...args: Array<any>): SVGFEBlendElement;\n\tfeColorMatrix(...args: Array<any>): SVGFEColorMatrixElement;\n\tfeComponentTransfer(...args: Array<any>): SVGFEComponentTransferElement;\n\tfeComposite(...args: Array<any>): SVGFECompositeElement;\n\tfeConvolveMatrix(...args: Array<any>): SVGFEConvolveMatrixElement;\n\tfeDiffuseLighting(...args: Array<any>): SVGFEDiffuseLightingElement;\n\tfeDisplacementMap(...args: Array<any>): SVGFEDisplacementMapElement;\n\tfeDistantLight(...args: Array<any>): SVGFEDistantLightElement;\n\tfeDropShadow(...args: Array<any>): SVGElement;\n\tfeFlood(...args: Array<any>): SVGFEFloodElement;\n\tfeFuncA(...args: Array<any>): SVGFEFuncAElement;\n\tfeFuncB(...args: Array<any>): SVGFEFuncBElement;\n\tfeFuncG(...args: Array<any>): SVGFEFuncGElement;\n\tfeFuncR(...args: Array<any>): SVGFEFuncRElement;\n\tfeGaussianBlur(...args: Array<any>): SVGFEGaussianBlurElement;\n\tfeImage(...args: Array<any>): SVGFEImageElement;\n\tfeMerge(...args: Array<any>): SVGFEMergeElement;\n\tfeMergeNode(...args: Array<any>): SVGFEMergeNodeElement;\n\tfeMorphology(...args: Array<any>): SVGFEMorphologyElement;\n\tfeOffset(...args: Array<any>): SVGFEOffsetElement;\n\tfePointLight(...args: Array<any>): SVGFEPointLightElement;\n\tfeSpecularLighting(...args: Array<any>): SVGFESpecularLightingElement;\n\tfeSpotLight(...args: Array<any>): SVGFESpotLightElement;\n\tfeTile(...args: Array<any>): SVGFETileElement;\n\tfeTurbulence(...args: Array<any>): SVGFETurbulenceElement;\n\tfilter(...args: Array<any>): SVGFilterElement;\n\tfont(...args: Array<any>): SVGElement;\n\t\"font-face\"(...args: Array<any>): SVGElement;\n\tfont_face(...args: Array<any>): SVGElement;\n\t\"font-face-format\"(...args: Array<any>): SVGElement;\n\tfont_face_format(...args: Array<any>): SVGElement;\n\t\"font-face-name\"(...args: Array<any>): SVGElement;\n\tfont_face_name(...args: Array<any>): SVGElement;\n\t\"font-face-src\"(...args: Array<any>): SVGElement;\n\tfont_face_src(...args: Array<any>): SVGElement;\n\t\"font-face-uri\"(...args: Array<any>): SVGElement;\n\tfont_face_uri(...args: Array<any>): SVGElement;\n\tforeignObject(...args: Array<any>): SVGForeignObjectElement;\n\tg(...args: Array<any>): SVGGElement;\n\tglyph(...args: Array<any>): SVGElement;\n\tglyphRef(...args: Array<any>): SVGElement;\n\thkern(...args: Array<any>): SVGElement;\n\timage(...args: Array<any>): SVGImageElement;\n\tline(...args: Array<any>): SVGLineElement;\n\tlinearGradient(...args: Array<any>): SVGLinearGradientElement;\n\tmarker(...args: Array<any>): SVGMarkerElement;\n\tmask(...args: Array<any>): SVGMaskElement;\n\tmetadata(...args: Array<any>): SVGMetadataElement;\n\t\"missing-glyph\"(...args: Array<any>): SVGElement;\n\tmissing_glyph(...args: Array<any>): SVGElement;\n\tmpath(...args: Array<any>): SVGElement;\n\tpath(...args: Array<any>): SVGPathElement;\n\tpattern(...args: Array<any>): SVGPatternElement;\n\tpolygon(...args: Array<any>): SVGPolygonElement;\n\tpolyline(...args: Array<any>): SVGPolylineElement;\n\tradialGradient(...args: Array<any>): SVGRadialGradientElement;\n\trect(...args: Array<any>): SVGRectElement;\n\tscript(...args: Array<any>): SVGScriptElement;\n\tset(...args: Array<any>): SVGElement;\n\tstop(...args: Array<any>): SVGStopElement;\n\tstyle(...args: Array<any>): SVGStyleElement;\n\tsvg(...args: Array<any>): SVGSVGElement;\n\tswitch(...args: Array<any>): SVGSwitchElement;\n\tsymbol(...args: Array<any>): SVGSymbolElement;\n\ttext(...args: Array<any>): SVGTextElement;\n\ttextPath(...args: Array<any>): SVGTextPathElement;\n\ttitle(...args: Array<any>): SVGTitleElement;\n\ttref(...args: Array<any>): SVGElement;\n\ttspan(...args: Array<any>): SVGTSpanElement;\n\tuse(...args: Array<any>): SVGUseElement;\n\tview(...args: Array<any>): SVGViewElement;\n\tvkern(...args: Array<any>): SVGElement;\n}\n\nexport const HTML: HTMLElementFactory = <HTMLElementFactory> <unknown> parseHTML;\nexport const SVG: SVGElementFactory = <SVGElementFactory> <unknown> parseSVG;\n\nfor (const name of \"a abbr address area article aside audio b base bdi bdo blockquote br button canvas caption cite code col colgroup datalist dd del details dfn dialog div dl dt em embed fieldset figcaption figure footer form h1 h2 h3 h4 h5 h6 header hr i iframe img input ins kbd label legend li link main map mark menu menuitem meta meter nav noscript object ol optgroup option output p param picture pre progress q rp rt ruby s samp script section select small source span strong style sub summary sup table tbody td template textarea tfoot th thead time title tr track u ul var video wbr\".split(\" \")) {\n\t(<any>HTML)[name] = (...args: Array<any>) => applyElementArgs(document.createElement(name), args);\n}\nfor (const name of \"a altGlyph altGlyphDef altGlyphItem animate animateMotion animateTransform circle clipPath color-profile cursor defs desc discard ellipse feBlend feColorMatrix feComponentTransfer feComposite feConvolveMatrix feDiffuseLighting feDisplacementMap feDistantLight feDropShadow feFlood feFuncA feFuncB feFuncG feFuncR feGaussianBlur feImage feMerge feMergeNode feMorphology feOffset fePointLight feSpecularLighting feSpotLight feTile feTurbulence filter font font-face font-face-format font-face-name font-face-src font-face-uri foreignObject g glyph glyphRef hkern image line linearGradient marker mask metadata missing-glyph mpath path pattern polygon polyline radialGradient rect script set stop style svg switch symbol text textPath title tref tspan use view vkern\".split(\" \")) {\n\t(<any>SVG)[name] = (...args: Array<any>) => applyElementArgs(<SVGElement> document.createElementNS(svgNS, name), args);\n\tif (/-/.test(name)) {\n\t\tconst snakeCaseName = name.replace(/-/g, \"_\");\n\t\t(<any>SVG)[snakeCaseName] = (...args: Array<any>) => applyElementArgs(<SVGElement> document.createElementNS(svgNS, name), args);\n\t}\n}\n","\texport function clamp(min: number, max: number, val: number): number {\r\n\t\tmax = max - 1;\r\n\t\tif (val <= max) {\r\n\t\t\tif (val >= min) return val;\r\n\t\t\telse return min;\r\n\t\t} else {\r\n\t\t\treturn max;\r\n\t\t}\r\n\t}","    import { SongTagCode, CharCode, } from \"./tagCodes\";\r\n    import { Config, Dictionary, InstrumentType } from \"./SynthConfig\";\r\n\timport { clamp } from \"./usefulFunctions\";\r\n    \r\n    export class BitFieldReader {\r\n        private _bits: number[] = [];\r\n        private _readIndex: number = 0;\r\n        \r\n        constructor(base64CharCodeToInt: ReadonlyArray<number>, source: string, startIndex: number, stopIndex: number) {\r\n            for (let i: number = startIndex; i < stopIndex; i++) {\r\n                const value: number = base64CharCodeToInt[source.charCodeAt(i)];\r\n                this._bits.push((value >> 5) & 0x1);\r\n                this._bits.push((value >> 4) & 0x1);\r\n                this._bits.push((value >> 3) & 0x1);\r\n                this._bits.push((value >> 2) & 0x1);\r\n                this._bits.push((value >> 1) & 0x1);\r\n                this._bits.push( value       & 0x1);\r\n            }\r\n        }\r\n        \r\n        public read(bitCount: number): number {\r\n            let result: number = 0;\r\n            while (bitCount > 0) {\r\n                result = result << 1;\r\n                result += this._bits[this._readIndex++];\r\n                bitCount--;\r\n            }\r\n            return result;\r\n        }\r\n        \r\n        public readLongTail(minValue: number, minBits: number): number {\r\n            let result: number = minValue;\r\n            let numBits: number = minBits;\r\n            while (this._bits[this._readIndex++]) {\r\n                result += 1 << numBits;\r\n                numBits++;\r\n            }\r\n            while (numBits > 0) {\r\n                numBits--;\r\n                if (this._bits[this._readIndex++]) {\r\n                    result += 1 << numBits;\r\n                }\r\n            }\r\n            return result;\r\n        }\r\n        \r\n        public readPartDuration(): number {\r\n            return this.readLongTail(1, 2);\r\n        }\r\n        \r\n        public readPinCount(): number {\r\n            return this.readLongTail(1, 0);\r\n        }\r\n        \r\n        public readPitchInterval(): number {\r\n            if (this.read(1)) {\r\n                return -this.readLongTail(1, 3);\r\n            } else {\r\n                return this.readLongTail(1, 3);\r\n            }\r\n        }\r\n    }\r\n    \r\n    export class BitFieldWriter {\r\n        private _bits: number[] = [];\r\n        \r\n        public write(bitCount: number, value: number): void {\r\n            bitCount--;\r\n            while (bitCount >= 0) {\r\n                this._bits.push((value >>> bitCount) & 1);\r\n                bitCount--;\r\n            }\r\n        }\r\n        \r\n        public writeLongTail(minValue: number, minBits: number, value: number): void {\r\n            if (value < minValue) throw new Error(\"value out of bounds\");\r\n            value -= minValue;\r\n            let numBits: number = minBits;\r\n            while (value >= (1 << numBits)) {\r\n                this._bits.push(1);\r\n                value -= 1 << numBits;\r\n                numBits++;\r\n            }\r\n            this._bits.push(0);\r\n            while (numBits > 0) {\r\n                numBits--;\r\n                this._bits.push((value >>> numBits) & 1);\r\n            }\r\n        }\r\n        \r\n        public writePartDuration(value: number): void {\r\n            this.writeLongTail(1, 2, value);\r\n        }\r\n        \r\n        public writePinCount(value: number): void {\r\n            this.writeLongTail(1, 0, value);\r\n        }\r\n        \r\n        public writePitchInterval(value: number): void {\r\n            if (value < 0) {\r\n                this.write(1, 1); // sign\r\n                this.writeLongTail(1, 3, -value);\r\n            } else {\r\n                this.write(1, 0); // sign\r\n                this.writeLongTail(1, 3, value);\r\n            }\r\n        }\r\n        \r\n        public concat(other: BitFieldWriter): void {\r\n            this._bits = this._bits.concat(other._bits);\r\n        }\r\n        \r\n        public encodeBase64(base64IntToCharCode: ReadonlyArray<number>, buffer: number[]): number[] {\r\n            for (let i: number = 0; i < this._bits.length; i += 6) {\r\n                const value: number = (this._bits[i] << 5) | (this._bits[i+1] << 4) | (this._bits[i+2] << 3) | (this._bits[i+3] << 2) | (this._bits[i+4] << 1) | this._bits[i+5];\r\n                buffer.push(base64IntToCharCode[value]);\r\n            }\r\n            return buffer;\r\n        }\r\n        \r\n        public lengthBase64(): number {\r\n            return Math.ceil(this._bits.length / 6);\r\n        }\r\n    }\r\n\r\n\texport class Operator {\r\n\t\tpublic frequency: number = 0;\r\n\t\tpublic amplitude: number = 0;\r\n\t\tpublic envelope: number = 0;\r\n\t\t\r\n\t\tconstructor(index: number) {\r\n\t\t\tthis.reset(index);\r\n\t\t}\r\n\t\t\r\n\t\tpublic reset(index: number): void {\r\n\t\t\tthis.frequency = 0;\r\n\t\t\tthis.amplitude = (index <= 1) ? Config.operatorAmplitudeMax : 0;\r\n\t\t\tthis.envelope = 1;\r\n\t\t}\r\n\t\t\r\n\t\tpublic copy(other: Operator): void {\r\n\t\t\tthis.frequency = other.frequency;\r\n\t\t\tthis.amplitude = other.amplitude;\r\n\t\t\tthis.envelope = other.envelope;\r\n\t\t}\r\n\t}   \r\n\r\n    export interface NotePin {\r\n\t\tinterval: number;\r\n\t\ttime: number;\r\n\t\tvolume: number;\r\n\t}\r\n\t\r\n\texport function makeNotePin(interval: number, time: number, volume: number): NotePin {\r\n\t\treturn {interval: interval, time: time, volume: volume};\r\n\t}\r\n\t\r\n\texport interface Note {\r\n\t\tpitches: number[];\r\n\t\tpins: NotePin[];\r\n\t\tstart: number;\r\n\t\tend: number;\r\n\t}\r\n\t\r\n\texport function makeNote(pitch: number, start: number, end: number, volume: number, fadeout: boolean = false) {\r\n\t\treturn {\r\n\t\t\tpitches: [pitch],\r\n\t\t\tpins: [makeNotePin(0, 0, volume), makeNotePin(0, end - start, fadeout ? 0 : volume)],\r\n\t\t\tstart: start,\r\n\t\t\tend: end,\r\n\t\t};\r\n\t}\r\n\r\nexport class Instrument {\r\n\t\tpublic type: InstrumentType = 0;\r\n\t\tpublic wave: number = 1;\r\n\t\tpublic filter: number = 1;\r\n\t\tpublic transition: number = 1;\r\n\t\tpublic effect: number = 0;\r\n\t\tpublic harm: number = 0;\r\n\t\tpublic fmChorus: number = 1;\r\n\t\tpublic imute: number = 0;\r\n\t\tpublic octoff: number = 0;\r\n\t\tpublic chorus: number = 0;\r\n\t\tpublic volume: number = 0;\r\n\t\tpublic ipan: number = 4;\r\n\t\tpublic algorithm: number = 0;\r\n\t\tpublic feedbackType: number = 0;\r\n\t\tpublic feedbackAmplitude: number = 0;\r\n\t\tpublic feedbackEnvelope: number = 1;\r\n\t\tpublic readonly operators: Operator[] = [];\r\n\t\t\r\n\t\tconstructor() {\r\n\t\t\tfor (let i = 0; i < Config.operatorCount; i++) {\r\n\t\t\t\tthis.operators.push(new Operator(i));\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tpublic reset(): void {\r\n\t\t\tthis.type = 0;\r\n\t\t\tthis.wave = 1;\r\n\t\t\tthis.filter = 1;\r\n\t\t\tthis.transition = 1;\r\n\t\t\tthis.effect = 0;\r\n\t\t\tthis.harm = 0;\r\n\t\t\tthis.fmChorus = 1;\r\n\t\t\tthis.imute = 0;\r\n\t\t\tthis.ipan = 4;\r\n\t\t\tthis.octoff = 0;\r\n\t\t\tthis.chorus = 0;\r\n\t\t\tthis.volume = 0;\r\n\t\t\tthis.algorithm = 0;\r\n\t\t\tthis.feedbackType = 0;\r\n\t\t\tthis.feedbackAmplitude = 0;\r\n\t\t\tthis.feedbackEnvelope = 1;\r\n\t\t\tfor (let i: number = 0; i < this.operators.length; i++) {\r\n\t\t\t\tthis.operators[i].reset(i);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tpublic setTypeAndReset(type: InstrumentType): void {\r\n\t\t\tthis.type = type;\r\n\t\t\tswitch (type) {\r\n\t\t\t\tcase InstrumentType.chip:\r\n\t\t\t\t\tthis.wave = 1;\r\n\t\t\t\t\tthis.filter = 1;\r\n\t\t\t\t\tthis.transition = 1;\r\n\t\t\t\t\tthis.effect = 0;\r\n\t\t\t\t\tthis.harm = 0;\r\n\t\t\t\t\tthis.imute = 0;\r\n\t\t\t\t\tthis.ipan = 4;\r\n\t\t\t\t\tthis.octoff = 0;\r\n\t\t\t\t\tthis.chorus = 0;\r\n\t\t\t\t\tthis.volume = 0;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t// @TODO: Investigate whether this being incorrect leads to\r\n\t\t\t\t// any observable issues.\r\n\t\t\t\tcase InstrumentType.fm:\r\n\t\t\t\t\tthis.wave = 1;\r\n\t\t\t\t\tthis.transition = 1;\r\n\t\t\t\t\tthis.volume = 0;\r\n\t\t\t\t\tthis.imute = 0;\r\n\t\t\t\t\tthis.ipan = 4;\r\n\t\t\t\t\tthis.harm = 0;\r\n\t\t\t\t\tthis.octoff = 0;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase InstrumentType.noise:\r\n\t\t\t\t\tthis.transition = 1;\r\n\t\t\t\t\tthis.octoff = 0;\r\n\t\t\t\t\tthis.fmChorus = 1;\r\n\t\t\t\t\tthis.ipan = 4;\r\n\t\t\t\t\tthis.effect = 0;\r\n\t\t\t\t\tthis.algorithm = 0;\r\n\t\t\t\t\tthis.feedbackType = 0;\r\n\t\t\t\t\tthis.feedbackAmplitude = 0;\r\n\t\t\t\t\tthis.feedbackEnvelope = 1;\r\n\t\t\t\t\tthis.volume = 0;\r\n\t\t\t\t\tfor (let i: number = 0; i < this.operators.length; i++) {\r\n\t\t\t\t\t\tthis.operators[i].reset(i);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase InstrumentType.pwm:\r\n\t\t\t\t\tthis.wave = 1;\r\n\t\t\t\t\tthis.filter = 1;\r\n\t\t\t\t\tthis.transition = 1;\r\n\t\t\t\t\tthis.effect = 0;\r\n\t\t\t\t\tthis.harm = 0;\r\n\t\t\t\t\tthis.imute = 0;\r\n\t\t\t\t\tthis.ipan = 4;\r\n\t\t\t\t\tthis.octoff = 0;\r\n\t\t\t\t\tthis.chorus = 0;\r\n\t\t\t\t\tthis.volume = 0;\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tpublic copy(other: Instrument): void {\r\n\t\t\tthis.type = other.type;\r\n\t\t\tthis.wave = other.wave;\r\n\t\t\tthis.filter = other.filter;\r\n\t\t\tthis.transition = other.transition;\r\n\t\t\tthis.effect = other.effect;\r\n\t\t\tthis.chorus = other.chorus;\r\n\t\t\tthis.volume = other.volume;\r\n\t\t\tthis.harm = other.harm;\r\n\t\t\tthis.fmChorus = other.fmChorus;\r\n\t\t\tthis.imute = other.imute;\r\n\t\t\tthis.ipan = other.ipan;\r\n\t\t\tthis.octoff = other.octoff;\r\n\t\t\tthis.algorithm = other.algorithm;\r\n\t\t\tthis.feedbackType = other.feedbackType;\r\n\t\t\tthis.feedbackAmplitude = other.feedbackAmplitude;\r\n\t\t\tthis.feedbackEnvelope = other.feedbackEnvelope;\r\n\t\t\tfor (let i: number = 0; i < this.operators.length; i++) {\r\n\t\t\t\tthis.operators[i].copy(other.operators[i]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/*public getChord(): Chord {\r\n\t\t\treturn this.type == InstrumentType.noise ? Config.harmDisplay[2] : Config.harmDisplay[this.harm];\r\n\t\t}*/\r\n\t}\r\n\r\n    export class Channel {\r\n\t\tpublic octave: number = 0;\r\n\t\tpublic readonly instruments: Instrument[] = [];\r\n\t\tpublic readonly patterns: Pattern[] = [];\r\n\t\tpublic readonly bars: number[] = [];\r\n\t}\r\n\t\r\n\texport class Pattern {\r\n\t\tpublic notes: Note[] = [];\r\n\t\tpublic instrument: number = 0;\r\n\t\t\r\n\t\tpublic cloneNotes(): Note[] {\r\n\t\t\tconst result: Note[] = [];\r\n\t\t\tfor (const oldNote of this.notes) {\r\n\t\t\t\tconst newNote: Note = makeNote(-1, oldNote.start, oldNote.end, 3);\r\n\t\t\t\tnewNote.pitches = oldNote.pitches.concat();\r\n\t\t\t\tnewNote.pins = [];\r\n\t\t\t\tfor (const oldPin of oldNote.pins) {\r\n\t\t\t\t\tnewNote.pins.push(makeNotePin(oldPin.interval, oldPin.time, oldPin.volume));\r\n\t\t\t\t}\r\n\t\t\t\tresult.push(newNote);\r\n\t\t\t}\r\n\t\t\treturn result;\r\n\t\t}\r\n\t\t\r\n\t\tpublic reset(): void {\r\n\t\t\tthis.notes.length = 0;\r\n\t\t\tthis.instrument = 0;\r\n\t\t}\r\n\t}\r\n\r\n    export class Song {\r\n\t\tprivate static readonly _format: string = \"NepBox\";\r\n\r\n\t\tprivate static readonly _oldestBeepboxVersion: number = 2;\r\n\t\tprivate static readonly _latestBeepboxVersion: number = 6;\r\n\t\tprivate static readonly _oldestNepBoxVersion: number = 1;\r\n\t\tprivate static readonly _latestNepBoxVersion: number = 1;\r\n\t\tprivate static readonly _variant = 0x6E; //\"N\" ~ nepbox\r\n\r\n\t\tprivate static readonly _base64CharCodeToInt: ReadonlyArray<number> = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,62,62,0,0,1,2,3,4,5,6,7,8,9,0,0,0,0,0,0,0,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,0,0,0,0,63,0,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,0,0,0,0,0]; // 62 could be represented by either \"-\" or \".\" for historical reasons. New songs should use \"-\".\r\n\t\tprivate static readonly _base64IntToCharCode: ReadonlyArray<number> = [48,49,50,51,52,53,54,55,56,57,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,45,95];\r\n\t\t\r\n\t\tpublic scale: number;\r\n\t\tpublic setSongTheme: string;\r\n\t\tpublic key: number;\r\n\t\tpublic mix: number;\r\n\t\tpublic sampleRate: number;\r\n\t\tpublic tempo: number;\r\n\t\tpublic reverb: number;\r\n\t\tpublic blend: number;\r\n\t\tpublic riff: number;\r\n\t\tpublic detune: number;\r\n\t\tpublic muff: number;\r\n\t\tpublic beatsPerBar: number;\r\n\t\tpublic barCount: number;\r\n\t\tpublic patternsPerChannel: number;\r\n\t\tpublic partsPerBeat: number;\r\n\t\tpublic instrumentsPerChannel: number;\r\n\t\tpublic loopStart: number;\r\n\t\tpublic loopLength: number;\r\n\t\tpublic pitchChannelCount: number;\r\n\t\tpublic drumChannelCount: number;\r\n\t\tpublic readonly channels: Channel[] = [];\r\n\t\t\r\n\t\tconstructor(string?: string) {\r\n\t\t\tif (string != undefined) {\r\n\t\t\t\tthis.fromBase64String(string);\r\n\t\t\t} else {\r\n\t\t\t\tthis.initToDefault(true);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tpublic getChannelCount(): number {\r\n\t\t\treturn this.pitchChannelCount + this.drumChannelCount;\r\n\t\t}\r\n\r\n\t\tpublic getChannelUnusedCount(): number {\r\n\t\t\treturn (Config.pitchChannelCountMax + Config.drumChannelCountMax) - (this.pitchChannelCount + this.drumChannelCount);\r\n\t\t}\r\n\r\n\t\tpublic getTimeSig(): string {\r\n\t\t\treturn this.beatsPerBar + \"/\" + this.partsPerBeat + \" with \" + this.barCount + \" bars.\";\r\n\t\t}\r\n\r\n\t\tpublic getScaleNKey(): string {\r\n\t\t\treturn ' \"' + Config.scales[this.scale].name + '\" and your key is ' + Config.keys[this.key].name;\r\n\t\t}\r\n\t\t\r\n\t\tpublic getChannelIsDrum(channel: number): boolean {\r\n\t\t\treturn (channel >= this.pitchChannelCount);\r\n\t\t}\r\n\t\t\r\n\t\tpublic getChannelColorDim(channel: number): string {\r\n\t\t\treturn channel < this.pitchChannelCount ? Config.pitchChannelColorsDim[channel] : Config.drumChannelColorsDim[channel - this.pitchChannelCount];\r\n\t\t}\r\n\t\tpublic getChannelColorBright(channel: number): string {\r\n\t\t\treturn channel < this.pitchChannelCount ? Config.pitchChannelColorsBright[channel] : Config.drumChannelColorsBright[channel - this.pitchChannelCount];\r\n\t\t}\r\n\t\tpublic getNoteColorDim(channel: number): string {\r\n\t\t\treturn channel < this.pitchChannelCount ? Config.pitchNoteColorsDim[channel] : Config.drumNoteColorsDim[channel - this.pitchChannelCount];\r\n\t\t}\r\n\t\tpublic getNoteColorBright(channel: number): string {\r\n\t\t\treturn channel < this.pitchChannelCount ? Config.pitchNoteColorsBright[channel] : Config.drumNoteColorsBright[channel - this.pitchChannelCount];\r\n\t\t}\r\n\t\t\r\n\t\tpublic initToDefault(andResetChannels: boolean = true): void {\r\n\t\t\tthis.scale = 0;\r\n\t\t\tthis.setSongTheme = \"none\";\r\n\t\t\tthis.key = Config.keys.map(key=>key.name).indexOf(\"C\");\r\n\t\t\tthis.mix = 1;\r\n\t\t\tthis.sampleRate = 2;\r\n\t\t\tthis.loopStart = 0;\r\n\t\t\tthis.loopLength = 4;\r\n\t\t\tthis.tempo = 7;\r\n\t\t\tthis.reverb = 0;\r\n\t\t\tthis.blend = 0;\r\n\t\t\tthis.riff = 0;\r\n\t\t\tthis.detune = 0;\r\n\t\t\tthis.muff = 0;\r\n\t\t\tthis.beatsPerBar = 8;\r\n\t\t\tthis.barCount = 16;\r\n\t\t\tthis.patternsPerChannel = 8;\r\n\t\t\tthis.partsPerBeat = 4;\r\n\t\t\tthis.instrumentsPerChannel = 1;\r\n\t\t\t\r\n\t\t\tif (andResetChannels) {\r\n\t\t\t\tthis.pitchChannelCount = 4;\r\n\t\t\t\tthis.drumChannelCount = 1;\r\n\t\t\t\tfor (let channelIndex = 0; channelIndex < this.getChannelCount(); channelIndex++) {\r\n\t\t\t\t\tif (this.channels.length <= channelIndex) {\r\n\t\t\t\t\t\tthis.channels[channelIndex] = new Channel();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconst channel: Channel = this.channels[channelIndex];\r\n\t\t\t\t\tchannel.octave = 4 - channelIndex; // [4, 3, 2, 1, 0]; Descending octaves with drums at zero in last channel.\r\n\t\t\t\t\r\n\t\t\t\t\tfor (let pattern = 0; pattern < this.patternsPerChannel; pattern++) {\r\n\t\t\t\t\t\tif (channel.patterns.length <= pattern) {\r\n\t\t\t\t\t\t\tchannel.patterns[pattern] = new Pattern();\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tchannel.patterns[pattern].reset();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tchannel.patterns.length = this.patternsPerChannel;\r\n\t\t\t\t\r\n\t\t\t\t\tfor (let instrument = 0; instrument < this.instrumentsPerChannel; instrument++) {\r\n\t\t\t\t\t\tif (channel.instruments.length <= instrument) {\r\n\t\t\t\t\t\t\tchannel.instruments[instrument] = new Instrument();\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tchannel.instruments[instrument].reset();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tchannel.instruments.length = this.instrumentsPerChannel;\r\n\t\t\t\t\r\n\t\t\t\t\tfor (let bar = 0; bar < this.barCount; bar++) {\r\n\t\t\t\t\t\tchannel.bars[bar] = bar < 4 ? 1 : 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tchannel.bars.length = this.barCount;\r\n\t\t\t\t}\r\n\t\t\t\tthis.channels.length = this.getChannelCount();\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tpublic toBase64String(): string {\r\n\t\t\tlet bits: BitFieldWriter;\r\n\t\t\tlet buffer: number[] = [];\r\n\t\t\t\r\n\t\t\tconst base64IntToCharCode: ReadonlyArray<number> = Song._base64IntToCharCode;\r\n\t\t\t\r\n\t\t\tbuffer.push(Song._variant);\r\n\t\t\tbuffer.push(base64IntToCharCode[Song._latestNepBoxVersion]);\r\n\r\n\r\n\r\n\t\t\tbuffer.push(SongTagCode.channelCount, base64IntToCharCode[this.pitchChannelCount], base64IntToCharCode[this.drumChannelCount]);\r\n\r\n\t\t\tbuffer.push(SongTagCode.setSongTheme);\r\n\t\t\tvar encodedSongTheme: string = encodeURIComponent(this.setSongTheme);\r\n        \tbuffer.push(base64IntToCharCode[encodedSongTheme.length >> 6], base64IntToCharCode[encodedSongTheme.length & 0x3f]);\r\n\t\t\t// Actual encoded string follows\r\n\t\t\tfor (let i: number = 0; i < encodedSongTheme.length; i++) {\r\n\t\t\t\tbuffer.push(encodedSongTheme.charCodeAt(i));\r\n\t\t\t}\r\n\r\n\t\t\tbuffer.push(SongTagCode.scale, base64IntToCharCode[this.scale]);\r\n\t\t\tbuffer.push(SongTagCode.mix, base64IntToCharCode[this.mix]);\r\n\t\t\tbuffer.push(SongTagCode.sampleRate, base64IntToCharCode[this.sampleRate]);\r\n\t\t\tbuffer.push(SongTagCode.key, base64IntToCharCode[this.key]);\r\n\t\t\tbuffer.push(SongTagCode.loopStart, base64IntToCharCode[this.loopStart >> 6], base64IntToCharCode[this.loopStart & 0x3f]);\r\n\t\t\tbuffer.push(SongTagCode.loopEnd, base64IntToCharCode[(this.loopLength - 1) >> 6], base64IntToCharCode[(this.loopLength - 1) & 0x3f]);\r\n\t\t\tbuffer.push(SongTagCode.tempo, base64IntToCharCode[this.tempo]);\r\n\t\t\tbuffer.push(SongTagCode.reverb, base64IntToCharCode[this.reverb]);\r\n\t\t\tbuffer.push(SongTagCode.blend, base64IntToCharCode[this.blend]);\r\n\t\t\tbuffer.push(SongTagCode.riff, base64IntToCharCode[this.riff]);\r\n\t\t\tbuffer.push(SongTagCode.detune, base64IntToCharCode[this.detune]);\r\n\t\t\tbuffer.push(SongTagCode.muff, base64IntToCharCode[this.muff]);\r\n\t\t\tbuffer.push(SongTagCode.beatCount, base64IntToCharCode[this.beatsPerBar - 1]);\r\n\t\t\tbuffer.push(SongTagCode.barCount, base64IntToCharCode[(this.barCount - 1) >> 6], base64IntToCharCode[(this.barCount - 1) & 0x3f]);\r\n\t\t\tbuffer.push(SongTagCode.patternCount, base64IntToCharCode[this.patternsPerChannel - 1]);\r\n\t\t\tbuffer.push(SongTagCode.instrumentCount, base64IntToCharCode[this.instrumentsPerChannel - 1]);\r\n\t\t\tbuffer.push(SongTagCode.rhythm, base64IntToCharCode[Config.partCounts.indexOf(this.partsPerBeat)]);\r\n\t\t\t\r\n\t\t\tbuffer.push(SongTagCode.channelOctave);\r\n\t\t\tfor (let channel: number = 0; channel < this.getChannelCount(); channel++) {\r\n\t\t\t\tbuffer.push(base64IntToCharCode[this.channels[channel].octave]);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tfor (let channel: number = 0; channel < this.getChannelCount(); channel++) {\r\n\t\t\t\tfor (let i: number = 0; i < this.instrumentsPerChannel; i++) {\r\n\t\t\t\t\tconst instrument: Instrument = this.channels[channel].instruments[i];\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (channel < this.pitchChannelCount) {\r\n\t\t\t\t\t\tbuffer.push(SongTagCode.startInstrument, base64IntToCharCode[instrument.type]);\r\n\t\t\t\t\t\tif (instrument.type == InstrumentType.chip) {\r\n\t\t\t\t\t\t\t// chip\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.wave, base64IntToCharCode[instrument.wave]);\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.filter, base64IntToCharCode[instrument.filter]);\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.transition, base64IntToCharCode[instrument.transition]);\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.effect, base64IntToCharCode[instrument.effect]);\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.harm, base64IntToCharCode[instrument.harm]);\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.imute, base64IntToCharCode[instrument.imute]);\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.ipan, base64IntToCharCode[instrument.ipan]);\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.octoff, base64IntToCharCode[instrument.octoff]);\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.chorus,base64IntToCharCode[instrument.chorus]);\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.volume, base64IntToCharCode[instrument.volume]);\r\n\t\t\t\t\t\t} else if (instrument.type == InstrumentType.fm) {\r\n\t\t\t\t\t\t\t// FM\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.transition, base64IntToCharCode[instrument.transition]);\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.effect, base64IntToCharCode[instrument.effect]);\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.octoff, base64IntToCharCode[instrument.octoff]);\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.fmChorus, base64IntToCharCode[instrument.fmChorus]);\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.imute, base64IntToCharCode[instrument.imute]);\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.ipan, base64IntToCharCode[instrument.ipan]);\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.algorithm, base64IntToCharCode[instrument.algorithm]);\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.feedbackType, base64IntToCharCode[instrument.feedbackType]);\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.feedbackAmplitude, base64IntToCharCode[instrument.feedbackAmplitude]);\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.feedbackEnvelope, base64IntToCharCode[instrument.feedbackEnvelope]);\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.volume, base64IntToCharCode[instrument.volume]);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.operatorFrequencies);\r\n\t\t\t\t\t\t\tfor (let o: number = 0; o < Config.operatorCount; o++) {\r\n\t\t\t\t\t\t\t\tbuffer.push(base64IntToCharCode[instrument.operators[o].frequency]);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.operatorAmplitudes);\r\n\t\t\t\t\t\t\tfor (let o: number = 0; o < Config.operatorCount; o++) {\r\n\t\t\t\t\t\t\t\tbuffer.push(base64IntToCharCode[instrument.operators[o].amplitude]);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.operatorEnvelopes);\r\n\t\t\t\t\t\t\tfor (let o: number = 0; o < Config.operatorCount; o++) {\r\n\t\t\t\t\t\t\t\tbuffer.push(base64IntToCharCode[instrument.operators[o].envelope]);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else if (instrument.type == InstrumentType.pwm) {\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.wave, base64IntToCharCode[instrument.wave]);\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.filter, base64IntToCharCode[instrument.filter]);\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.transition, base64IntToCharCode[instrument.transition]);\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.effect, base64IntToCharCode[instrument.effect]);\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.harm, base64IntToCharCode[instrument.harm]);\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.imute, base64IntToCharCode[instrument.imute]);\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.ipan, base64IntToCharCode[instrument.ipan]);\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.octoff, base64IntToCharCode[instrument.octoff]);\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.chorus, base64IntToCharCode[instrument.chorus]);\r\n\t\t\t\t\t\t\tbuffer.push(SongTagCode.volume, base64IntToCharCode[instrument.volume]);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthrow new Error(\"Unknown instrument type.\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// NOISE\r\n\t\t\t\t\t\tbuffer.push(SongTagCode.startInstrument, base64IntToCharCode[InstrumentType.noise]);\r\n\t\t\t\t\t\tbuffer.push(SongTagCode.wave, base64IntToCharCode[instrument.wave]);\r\n\t\t\t\t\t\tbuffer.push(SongTagCode.transition, base64IntToCharCode[instrument.transition]);\r\n\t\t\t\t\t\tbuffer.push(SongTagCode.volume, base64IntToCharCode[instrument.volume]);\r\n\t\t\t\t\t\tbuffer.push(SongTagCode.imute, base64IntToCharCode[instrument.imute]);\r\n\t\t\t\t\t\tbuffer.push(SongTagCode.harm, base64IntToCharCode[instrument.harm]);\r\n\t\t\t\t\t\tbuffer.push(SongTagCode.octoff, base64IntToCharCode[instrument.octoff]);\r\n\t\t\t\t\t\tbuffer.push(SongTagCode.ipan, base64IntToCharCode[instrument.ipan]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tbuffer.push(SongTagCode.bars);\r\n\t\t\tbits = new BitFieldWriter();\r\n\t\t\tlet neededBits: number = 0;\r\n\t\t\twhile ((1 << neededBits) < this.patternsPerChannel + 1) neededBits++;\r\n\t\t\tfor (let channel: number = 0; channel < this.getChannelCount(); channel++) for (let i: number = 0; i < this.barCount; i++) {\r\n\t\t\t\tbits.write(neededBits, this.channels[channel].bars[i]);\r\n\t\t\t}\r\n\t\t\tbits.encodeBase64(base64IntToCharCode, buffer);\r\n\t\t\t\r\n\t\t\tbuffer.push(SongTagCode.patterns);\r\n\t\t\tbits = new BitFieldWriter();\r\n\t\t\tlet neededInstrumentBits: number = 0;\r\n\t\t\twhile ((1 << neededInstrumentBits) < this.instrumentsPerChannel) neededInstrumentBits++;\r\n\t\t\tfor (let channel: number = 0; channel < this.getChannelCount(); channel++) {\r\n\t\t\t\tconst isDrum: boolean = this.getChannelIsDrum(channel);\r\n\t\t\t\tconst octaveOffset: number = isDrum ? 0 : this.channels[channel].octave * 12;\r\n\t\t\t\tlet lastPitch: number = (isDrum ? 4 : 12) + octaveOffset;\r\n\t\t\t\tconst recentPitches: number[] = isDrum ? [4,6,7,2,3,8,0,10] : [12, 19, 24, 31, 36, 7, 0];\r\n\t\t\t\tconst recentShapes: string[] = [];\r\n\t\t\t\tfor (let i: number = 0; i < recentPitches.length; i++) {\r\n\t\t\t\t\trecentPitches[i] += octaveOffset;\r\n\t\t\t\t}\r\n\t\t\t\tfor (const p of this.channels[channel].patterns) {\r\n\t\t\t\t\tbits.write(neededInstrumentBits, p.instrument);\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (p.notes.length > 0) {\r\n\t\t\t\t\t\tbits.write(1, 1);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tlet curPart: number = 0;\r\n\t\t\t\t\t\tfor (const t of p.notes) {\r\n\t\t\t\t\t\t\tif (t.start > curPart) {\r\n\t\t\t\t\t\t\t\tbits.write(2, 0); // rest\r\n\t\t\t\t\t\t\t\tbits.writePartDuration(t.start - curPart);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tconst shapeBits: BitFieldWriter = new BitFieldWriter();\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t// 0: 1 pitch, 10: 2 pitches, 110: 3 pitches, 111: 4 pitches\r\n\t\t\t\t\t\t\tfor (let i: number = 1; i < t.pitches.length; i++) shapeBits.write(1,1);\r\n\t\t\t\t\t\t\tif (t.pitches.length < 4) shapeBits.write(1,0);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tshapeBits.writePinCount(t.pins.length - 1);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tshapeBits.write(2, t.pins[0].volume); // volume\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tlet shapePart: number = 0;\r\n\t\t\t\t\t\t\tlet startPitch: number = t.pitches[0];\r\n\t\t\t\t\t\t\tlet currentPitch: number = startPitch;\r\n\t\t\t\t\t\t\tconst pitchBends: number[] = [];\r\n\t\t\t\t\t\t\tfor (let i: number = 1; i < t.pins.length; i++) {\r\n\t\t\t\t\t\t\t\tconst pin: NotePin = t.pins[i];\r\n\t\t\t\t\t\t\t\tconst nextPitch: number = startPitch + pin.interval;\r\n\t\t\t\t\t\t\t\tif (currentPitch != nextPitch) {\r\n\t\t\t\t\t\t\t\t\tshapeBits.write(1, 1);\r\n\t\t\t\t\t\t\t\t\tpitchBends.push(nextPitch);\r\n\t\t\t\t\t\t\t\t\tcurrentPitch = nextPitch;\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tshapeBits.write(1, 0);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tshapeBits.writePartDuration(pin.time - shapePart);\r\n\t\t\t\t\t\t\t\tshapePart = pin.time;\r\n\t\t\t\t\t\t\t\tshapeBits.write(2, pin.volume);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tconst shapeString: string = String.fromCharCode.apply(null, shapeBits.encodeBase64(base64IntToCharCode, []));\r\n\t\t\t\t\t\t\tconst shapeIndex: number = recentShapes.indexOf(shapeString);\r\n\t\t\t\t\t\t\tif (shapeIndex == -1) {\r\n\t\t\t\t\t\t\t\tbits.write(2, 1); // new shape\r\n\t\t\t\t\t\t\t\tbits.concat(shapeBits);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tbits.write(1, 1); // old shape\r\n\t\t\t\t\t\t\t\tbits.writeLongTail(0, 0, shapeIndex);\r\n\t\t\t\t\t\t\t\trecentShapes.splice(shapeIndex, 1);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\trecentShapes.unshift(shapeString);\r\n\t\t\t\t\t\t\tif (recentShapes.length > 10) recentShapes.pop();\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tconst allPitches: number[] = t.pitches.concat(pitchBends);\r\n\t\t\t\t\t\t\tfor (let i: number = 0; i < allPitches.length; i++) {\r\n\t\t\t\t\t\t\t\tconst pitch: number = allPitches[i];\r\n\t\t\t\t\t\t\t\tconst pitchIndex: number = recentPitches.indexOf(pitch);\r\n\t\t\t\t\t\t\t\tif (pitchIndex == -1) {\r\n\t\t\t\t\t\t\t\t\tlet interval: number = 0;\r\n\t\t\t\t\t\t\t\t\tlet pitchIter: number = lastPitch;\r\n\t\t\t\t\t\t\t\t\tif (pitchIter < pitch) {\r\n\t\t\t\t\t\t\t\t\t\twhile (pitchIter != pitch) {\r\n\t\t\t\t\t\t\t\t\t\t\tpitchIter++;\r\n\t\t\t\t\t\t\t\t\t\t\tif (recentPitches.indexOf(pitchIter) == -1) interval++;\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\twhile (pitchIter != pitch) {\r\n\t\t\t\t\t\t\t\t\t\t\tpitchIter--;\r\n\t\t\t\t\t\t\t\t\t\t\tif (recentPitches.indexOf(pitchIter) == -1) interval--;\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tbits.write(1, 0);\r\n\t\t\t\t\t\t\t\t\tbits.writePitchInterval(interval);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tbits.write(1, 1);\r\n\t\t\t\t\t\t\t\t\tbits.write(3, pitchIndex);\r\n\t\t\t\t\t\t\t\t\trecentPitches.splice(pitchIndex, 1);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\trecentPitches.unshift(pitch);\r\n\t\t\t\t\t\t\t\tif (recentPitches.length > 8) recentPitches.pop();\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (i == t.pitches.length - 1) {\r\n\t\t\t\t\t\t\t\t\tlastPitch = t.pitches[0];\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tlastPitch = pitch;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tcurPart = t.end;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif (curPart < this.beatsPerBar * this.partsPerBeat) {\r\n\t\t\t\t\t\t\tbits.write(2, 0); // rest\r\n\t\t\t\t\t\t\tbits.writePartDuration(this.beatsPerBar * this.partsPerBeat - curPart);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tbits.write(1, 0);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tlet stringLength: number = bits.lengthBase64();\r\n\t\t\tlet digits: number[] = [];\r\n\t\t\twhile (stringLength > 0) {\r\n\t\t\t\tdigits.unshift(base64IntToCharCode[stringLength & 0x3f]);\r\n\t\t\t\tstringLength = stringLength >> 6;\r\n\t\t\t}\r\n\t\t\tbuffer.push(base64IntToCharCode[digits.length]);\r\n\t\t\tArray.prototype.push.apply(buffer, digits); // append digits to buffer.\r\n\t\t\tbits.encodeBase64(base64IntToCharCode, buffer);\r\n\t\t\t\r\n\t\t\t// HACK: This breaks for strings longer than 65535. \r\n\t\t\tif (buffer.length >= 65535) throw new Error(\"Song hash code too long.\");\r\n\t\t\treturn String.fromCharCode.apply(null, buffer);\r\n\t\t}\r\n\t\t\r\n\t\tpublic fromBase64String(compressed: string): void {\r\n\t\t\tif (compressed == null || compressed == \"\") {\r\n\t\t\t\tthis.initToDefault(true);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tlet charIndex: number = 0;\r\n\t\t\t// skip whitespace.\r\n\t\t\twhile (compressed.charCodeAt(charIndex) <= CharCode.SPACE) charIndex++;\r\n\t\t\t// skip hash mark.\r\n\t\t\tif (compressed.charCodeAt(charIndex) == CharCode.HASH) charIndex++;\r\n\t\t\t// if it starts with curly brace, treat it as JSON.\r\n\t\t\tif (compressed.charCodeAt(charIndex) == CharCode.LEFT_CURLY_BRACE) {\r\n\t\t\t\tthis.fromJsonObject(JSON.parse(charIndex == 0 ? compressed : compressed.substring(charIndex)));\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst variantTest: number = compressed.charCodeAt(charIndex);\r\n        \tlet fromOld: boolean;\r\n        \tlet fromNepBox: boolean;\r\n\r\n\t\t\t// Detect variant here. If version doesn't match known variant, assume it is a vanilla string which does not report variant.\r\n\t\t\tif (variantTest == 0x6E) { //\"n\"\r\n\t\t\t\tfromOld = false;\r\n\t\t\t\tfromNepBox = true;\r\n\t\t\t\tcharIndex++;\r\n\t\t\t} else {\r\n\t\t\t\tfromOld = true;\r\n\t\t\t\tfromNepBox = false;\r\n\t\t\t}\r\n\r\n\t\t\tconst version: number = Song._base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\r\n\t\t\tif (fromOld && (version == -1 || version > Song._latestBeepboxVersion || version < Song._oldestBeepboxVersion)) return;\r\n\t\t\tif (fromNepBox && (version == -1 || version > Song._latestNepBoxVersion || version < Song._oldestNepBoxVersion)) return;\r\n\t\t\t//const beforeTwo:   boolean = version < 2;\r\n\t\t\tconst beforeThree: boolean = version < 3;\r\n\t\t\tconst beforeFour:  boolean = version < 4;\r\n\t\t\tconst beforeFive:  boolean = version < 5;\r\n\t\t\tconst beforeSix:   boolean = version < 6;\r\n\t\t\tconst base64CharCodeToInt: ReadonlyArray<number> = Song._base64CharCodeToInt;\r\n\t\t\tthis.initToDefault((fromOld && beforeSix) || (fromNepBox));\r\n\t\t\t\r\n\t\t\tif (fromOld && beforeThree) {\r\n\t\t\t\t// Originally, the only instrument transition was \"seamless\" and the only drum wave was \"retro\".\r\n\t\t\t\tfor (const channel of this.channels) channel.instruments[0].transition = 0;\r\n\t\t\t\tthis.channels[3].instruments[0].wave = 0;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tlet instrumentChannelIterator: number = 0;\r\n\t\t\tlet instrumentIndexIterator: number = -1;\r\n\t\t\t\r\n\t\t\twhile (charIndex < compressed.length) {\r\n\t\t\t\tconst command: number = compressed.charCodeAt(charIndex++);\r\n\t\t\t\tlet channel: number;\r\n\t\t\t\tif (command == SongTagCode.channelCount) {\r\n\t\t\t\t\tthis.pitchChannelCount = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\r\n\t\t\t\t\tthis.drumChannelCount  = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\r\n\t\t\t\t\tthis.pitchChannelCount = clamp(Config.pitchChannelCountMin, Config.pitchChannelCountMax + 1, this.pitchChannelCount);\r\n\t\t\t\t\tthis.drumChannelCount = clamp(Config.drumChannelCountMin, Config.drumChannelCountMax + 1, this.drumChannelCount);\r\n\t\t\t\t\tfor (let channelIndex = this.channels.length; channelIndex < this.getChannelCount(); channelIndex++) {\r\n\t\t\t\t\t\tthis.channels[channelIndex] = new Channel();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.channels.length = this.getChannelCount();\r\n\t\t\t\t} else if (command == SongTagCode.scale) {\r\n\t\t\t\t\tthis.scale = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\r\n\t\t\t\t\tif ((fromOld && beforeThree) && this.scale == 10) this.scale = 11;\r\n\t\t\t\t} else if (command == SongTagCode.mix) {\r\n\t\t\t\t\tthis.mix = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\r\n\t\t\t\t} else if (command == SongTagCode.key) {\r\n\t\t\t\t\t\tthis.key = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\r\n\t\t\t\t} else if (command == SongTagCode.setSongTheme) {\r\n\t\t\t\t\tif (fromOld) {\r\n\t\t\t\t\t\tvar themeIndex = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\r\n\t\t\t\t\t\tvar themes = [\"none\", \"modbox2\", \"artic\", \"Cinnamon Roll\", \"Ocean\", \"rainbow\", \"float\", \"windows\", \"grassland\", \"dessert\", \"kahootiest\", \"beambit\", \"egg\", \"Poniryoshka\", \"gameboy\", \"woodkid\", \"midnight\", \"snedbox\", \"unnamed\", \"piano\", \"halloween\", \"frozen\"];\r\n\t\t\t\t\t\tthis.setSongTheme = themes[themeIndex];\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tvar songThemeLength = (base64CharCodeToInt[compressed.charCodeAt(charIndex++)] << 6) + base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\r\n\t\t\t\t\t\tthis.setSongTheme = decodeURIComponent(compressed.substring(charIndex, charIndex + songThemeLength));\r\n\t\t\t\t\t\tcharIndex += songThemeLength;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (command == SongTagCode.loopStart) {\r\n\t\t\t\t\tif (fromOld && beforeFive) {\r\n\t\t\t\t\t\tthis.loopStart = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.loopStart = (base64CharCodeToInt[compressed.charCodeAt(charIndex++)] << 6) + base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (command == SongTagCode.loopEnd) {\r\n\t\t\t\t\tif (fromOld && beforeFive) {\r\n\t\t\t\t\t\tthis.loopLength = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.loopLength = (base64CharCodeToInt[compressed.charCodeAt(charIndex++)] << 6) + base64CharCodeToInt[compressed.charCodeAt(charIndex++)] + 1;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (command == SongTagCode.tempo) {\r\n\t\t\t\t\tif (fromOld && beforeFour) {\r\n\t\t\t\t\t\tthis.tempo = [1, 4, 7, 10][base64CharCodeToInt[compressed.charCodeAt(charIndex++)]];\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.tempo = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.tempo = clamp(0, Config.tempoSteps, this.tempo);\r\n\t\t\t\t} else if (command == SongTagCode.reverb) {\r\n\t\t\t\t\tthis.reverb = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\r\n\t\t\t\t\tthis.reverb = clamp(0, Config.reverbRange, this.reverb);\r\n\t\t\t\t} else if (command == SongTagCode.blend) {\r\n\t\t\t\t\tthis.blend = clamp(0, Config.blendRange, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t} else if (command == SongTagCode.riff) {\r\n\t\t\t\t\tthis.riff = clamp(0, Config.riffRange, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t} else if (command == SongTagCode.sampleRate) {\r\n\t\t\t\t\tthis.sampleRate = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\r\n\t\t\t\t} else if (command == SongTagCode.detune) {\r\n\t\t\t\t\tthis.detune = clamp(0, Config.detuneRange, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t} else if (command == SongTagCode.muff) {\r\n\t\t\t\t\tthis.muff = clamp(0, Config.muffRange, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t} else if (command == SongTagCode.beatCount) {\r\n\t\t\t\t\tif (fromOld && beforeThree) {\r\n\t\t\t\t\t\tthis.beatsPerBar = [6, 7, 8, 9, 10][base64CharCodeToInt[compressed.charCodeAt(charIndex++)]];\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.beatsPerBar = base64CharCodeToInt[compressed.charCodeAt(charIndex++)] + 1;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.beatsPerBar = Math.max(Config.beatsPerBarMin, Math.min(Config.beatsPerBarMax, this.beatsPerBar));\r\n\t\t\t\t} else if (command == SongTagCode.barCount) {\r\n\t\t\t\t\tthis.barCount = (base64CharCodeToInt[compressed.charCodeAt(charIndex++)] << 6) + base64CharCodeToInt[compressed.charCodeAt(charIndex++)] + 1;\r\n\t\t\t\t\tthis.barCount = Math.max(Config.barCountMin, Math.min(Config.barCountMax, this.barCount));\r\n\t\t\t\t\tfor (let channel = 0; channel < this.getChannelCount(); channel++) {\r\n\t\t\t\t\t\tfor (let bar = this.channels[channel].bars.length; bar < this.barCount; bar++) {\r\n\t\t\t\t\t\t\tthis.channels[channel].bars[bar] = 1;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.channels[channel].bars.length = this.barCount;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (command == SongTagCode.patternCount) {\r\n\t\t\t\t\tthis.patternsPerChannel = base64CharCodeToInt[compressed.charCodeAt(charIndex++)] + 1;\r\n\t\t\t\t\tthis.patternsPerChannel = Math.max(1, Math.min(Config.barCountMax, this.patternsPerChannel));\r\n\t\t\t\t\tfor (let channel = 0; channel < this.getChannelCount(); channel++) {\r\n\t\t\t\t\t\tfor (let pattern = this.channels[channel].patterns.length; pattern < this.patternsPerChannel; pattern++) {\r\n\t\t\t\t\t\t\tthis.channels[channel].patterns[pattern] = new Pattern();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.channels[channel].patterns.length = this.patternsPerChannel;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (command == SongTagCode.instrumentCount) {\r\n\t\t\t\t\tthis.instrumentsPerChannel = base64CharCodeToInt[compressed.charCodeAt(charIndex++)] + 1;\r\n\t\t\t\t\tthis.instrumentsPerChannel = Math.max(Config.instrumentsPerChannelMin, Math.min(Config.instrumentsPerChannelMax, this.instrumentsPerChannel));\r\n\t\t\t\t\tfor (let channel = 0; channel < this.getChannelCount(); channel++) {\r\n\t\t\t\t\t\tfor (let instrument = this.channels[channel].instruments.length; instrument < this.instrumentsPerChannel; instrument++) {\r\n\t\t\t\t\t\t\tthis.channels[channel].instruments[instrument] = new Instrument();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.channels[channel].instruments.length = this.instrumentsPerChannel;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (command == SongTagCode.rhythm) {\r\n\t\t\t\t\tthis.partsPerBeat = Config.partCounts[base64CharCodeToInt[compressed.charCodeAt(charIndex++)]];\r\n\t\t\t\t} else if (command == SongTagCode.channelOctave) {\r\n\t\t\t\t\tif (fromOld && beforeThree) {\r\n\t\t\t\t\t\tchannel = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\r\n\t\t\t\t\t\tthis.channels[channel].octave = clamp(0, 5, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tfor (channel = 0; channel < this.getChannelCount(); channel++) {\r\n\t\t\t\t\t\t\tthis.channels[channel].octave = clamp(0, 5, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (command == SongTagCode.startInstrument) {\r\n\t\t\t\t\tinstrumentIndexIterator++;\r\n\t\t\t\t\tif (instrumentIndexIterator >= this.instrumentsPerChannel) {\r\n\t\t\t\t\t\tinstrumentChannelIterator++;\r\n\t\t\t\t\t\tinstrumentIndexIterator = 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconst isPitchChannel: boolean = instrumentChannelIterator < this.pitchChannelCount;\r\n\t\t\t\t\tconst instrument: Instrument = this.channels[instrumentChannelIterator].instruments[instrumentIndexIterator];\r\n\t\t\t\t\tconst rawInstrumentType: number = clamp(0, 4, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t\tlet instrumentType: number = rawInstrumentType;\r\n\t\t\t\t\tif (instrumentType == InstrumentType.noise && isPitchChannel) {\r\n\t\t\t\t\t\tinstrumentType = InstrumentType.pwm;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tinstrument.setTypeAndReset(instrumentType);\r\n\t\t\t\t} else if (command == SongTagCode.wave) {\r\n\t\t\t\t\tif (fromOld && beforeThree) {\r\n\t\t\t\t\t\tchannel = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\r\n\t\t\t\t\t\tthis.channels[channel].instruments[0].wave = clamp(0, Config.waveNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t\t} else if (fromOld && beforeSix) {\r\n\t\t\t\t\t\tfor (channel = 0; channel < this.getChannelCount(); channel++) {\r\n\t\t\t\t\t\t\tconst isDrums = (channel >= this.pitchChannelCount);\r\n\t\t\t\t\t\t\tfor (let i: number = 0; i < this.instrumentsPerChannel; i++) {\r\n\t\t\t\t\t\t\t\tthis.channels[channel].instruments[i].wave = clamp(0, isDrums ? Config.drumNames.length : Config.waveNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconst isDrums = (instrumentChannelIterator >= this.pitchChannelCount);\r\n\t\t\t\t\t\tthis.channels[instrumentChannelIterator].instruments[instrumentIndexIterator].wave = clamp(0, isDrums ? Config.drumNames.length : Config.waveNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (command == SongTagCode.filter) {\r\n\t\t\t\t\tif (fromOld && beforeThree) {\r\n\t\t\t\t\t\tchannel = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\r\n\t\t\t\t\t\tthis.channels[channel].instruments[0].filter = [1, 3, 4, 5][clamp(0, Config.filterNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)])];\r\n\t\t\t\t\t} else if (fromOld && beforeSix) {\r\n\t\t\t\t\t\tfor (channel = 0; channel < this.getChannelCount(); channel++) {\r\n\t\t\t\t\t\t\tfor (let i: number = 0; i < this.instrumentsPerChannel; i++) {\r\n\t\t\t\t\t\t\t\tthis.channels[channel].instruments[i].filter = clamp(0, Config.filterNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)] + 1);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.channels[instrumentChannelIterator].instruments[instrumentIndexIterator].filter = clamp(0, Config.filterNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (command == SongTagCode.transition) {\r\n\t\t\t\t\tif (fromOld && beforeThree) {\r\n\t\t\t\t\t\tchannel = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\r\n\t\t\t\t\t\tthis.channels[channel].instruments[0].transition = clamp(0, Config.transitionNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t\t} else if (fromOld && beforeSix) {\r\n\t\t\t\t\t\tfor (channel = 0; channel < this.getChannelCount(); channel++) {\r\n\t\t\t\t\t\t\tfor (let i: number = 0; i < this.instrumentsPerChannel; i++) {\r\n\t\t\t\t\t\t\t\tthis.channels[channel].instruments[i].transition = clamp(0, Config.transitionNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.channels[instrumentChannelIterator].instruments[instrumentIndexIterator].transition = clamp(0, Config.transitionNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (command == SongTagCode.effect) {\r\n\t\t\t\t\tif (fromOld && beforeThree) {\r\n\t\t\t\t\t\tchannel = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\r\n\t\t\t\t\t\tlet effect: number = clamp(0, Config.effectNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t\t\tif (effect == 1) effect = 3;\r\n\t\t\t\t\t\telse if (effect == 3) effect = 5;\r\n\t\t\t\t\t\tthis.channels[channel].instruments[0].effect = effect;\r\n\t\t\t\t\t} else if (fromOld && beforeSix) {\r\n\t\t\t\t\t\tfor (channel = 0; channel < this.getChannelCount(); channel++) {\r\n\t\t\t\t\t\t\tfor (let i: number = 0; i < this.instrumentsPerChannel; i++) {\r\n\t\t\t\t\t\t\t\tthis.channels[channel].instruments[i].effect = clamp(0, Config.effectNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.channels[instrumentChannelIterator].instruments[instrumentIndexIterator].effect = clamp(0, Config.effectNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (command == SongTagCode.chorus) {\r\n\t\t\t\t\tif (fromOld && beforeThree) {\r\n\t\t\t\t\t\tchannel = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\r\n\t\t\t\t\t\tthis.channels[channel].instruments[0].chorus = clamp(0, Config.chorusNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t\t} else if (fromOld && beforeSix) {\r\n\t\t\t\t\t\tfor (channel = 0; channel < this.getChannelCount(); channel++) {\r\n\t\t\t\t\t\t\tfor (let i: number = 0; i < this.instrumentsPerChannel; i++) {\r\n\t\t\t\t\t\t\t\tthis.channels[channel].instruments[i].chorus = clamp(0, Config.chorusNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.channels[instrumentChannelIterator].instruments[instrumentIndexIterator].chorus = clamp(0, Config.chorusNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (command == SongTagCode.harm) {\r\n\t\t\t\t\t// Harmony was added in this commit: https://github.com/ModdedBeepbox/modded-beepbox-2.3/commit/cd1cc3d1891eda506e77e7619822ec2a48f375f2\r\n\t\t\t\t\t// _latestVersion was 5 in that commit, so the beforeThree\r\n\t\t\t\t\t// if in the reading code shouldn't ever run. Thus, it has\r\n\t\t\t\t\t// been omitted here.\r\n\t\t\t\t\tif (fromOld && beforeSix) {\r\n\t\t\t\t\t\tfor (channel = 0; channel < this.getChannelCount(); channel++) {\r\n\t\t\t\t\t\t\tfor (let i: number = 0; i < this.instrumentsPerChannel; i++) {\r\n\t\t\t\t\t\t\t\tthis.channels[channel].instruments[i].harm = clamp(0, Config.harmNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.channels[instrumentChannelIterator].instruments[instrumentIndexIterator].harm = clamp(0, Config.harmNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (command == SongTagCode.fmChorus) {\r\n\t\t\t\t\t// FM chorus was added in this commit: https://github.com/ModdedBeepbox/beta/commit/5c47acd9e5892709596d81df987a496f468b7115\r\n\t\t\t\t\t// Smaller diff: https://github.com/ModdedBeepbox/beta/compare/5427a7c491aae9fef15576bbc33a0d43ca18f758..5c47acd9e5892709596d81df987a496f468b7115\r\n\t\t\t\t\t// _latestVersion remained 6 before and after this, and the\r\n\t\t\t\t\t// tag code was never used for anything else previously, so\r\n\t\t\t\t\t// no backwards compatibility code is needed here.\r\n\t\t\t\t\tthis.channels[instrumentChannelIterator].instruments[instrumentIndexIterator].fmChorus = clamp(0, Config.fmChorusNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t} else if (command == SongTagCode.imute) {\r\n\t\t\t\t\t// Muting was added in this commit: https://github.com/ModdedBeepbox/3.0/commit/f177e34831ab85c58e0492ae47a5df80e709d9b4\r\n\t\t\t\t\t// _latestVersion remained 6 before and after this, and the\r\n\t\t\t\t\t// tag code was never used for anything else previously, so\r\n\t\t\t\t\t// no backwards compatibility code is needed here.\r\n\t\t\t\t\tthis.channels[instrumentChannelIterator].instruments[instrumentIndexIterator].imute = clamp(0, Config.imuteNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t} else if (command == SongTagCode.ipan) {\r\n\t\t\t\t\t// @TODO: Add SongTagCode.oldIpan = CharCode.M? Normally it\r\n\t\t\t\t\t// will be ignored if present on songs made before Oct 22, 2018\r\n\t\t\t\t\t// or so.\r\n\t\t\t\t\tthis.channels[instrumentChannelIterator].instruments[instrumentIndexIterator].ipan = clamp(0, Config.ipanValues.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t} else if (command == SongTagCode.octoff) {\r\n\t\t\t\t\t// Octave offset was first added in this commit: https://github.com/ModdedBeepbox/3.0/commit/54bdad302110cbde72b18f041091e53e3c35c189 (see BeepBox_files/5_channel.js)\r\n\t\t\t\t\t// It used CharCode.VERTICAL_LINE as the tag code value.\r\n\t\t\t\t\t// Later, it was changed to use CharCode.B in this commit: https://github.com/ModdedBeepbox/3.0/commit/84b9a7608c22addf01af2acebee6d5f6c65a5122\r\n\t\t\t\t\t// _latestVersion was 5, and the only major difference here\r\n\t\t\t\t\t// is that the octave offsets were pushed for every channel\r\n\t\t\t\t\t// one after another.\r\n\t\t\t\t\t// The beforeThree if was never needed.\r\n\t\t\t\t\tif (fromOld && beforeSix) {\r\n\t\t\t\t\t\tfor (channel = 0; channel < this.getChannelCount(); channel++) {\r\n\t\t\t\t\t\t\tfor (let i: number = 0; i < this.instrumentsPerChannel; i++) {\r\n\t\t\t\t\t\t\t\tthis.channels[channel].instruments[i].octoff = clamp(0, Config.octoffNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.channels[instrumentChannelIterator].instruments[instrumentIndexIterator].octoff = clamp(0, Config.octoffNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (command == SongTagCode.volume) {\r\n\t\t\t\t\tif (fromOld && beforeThree) {\r\n\t\t\t\t\t\tchannel = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\r\n\t\t\t\t\t\tthis.channels[channel].instruments[0].volume = clamp(0, Config.volumeNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t\t} else if (fromOld && beforeSix) {\r\n\t\t\t\t\t\tfor (channel = 0; channel < this.getChannelCount(); channel++) {\r\n\t\t\t\t\t\t\tfor (let i: number = 0; i < this.instrumentsPerChannel; i++) {\r\n\t\t\t\t\t\t\t\tthis.channels[channel].instruments[i].volume = clamp(0, Config.volumeNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.channels[instrumentChannelIterator].instruments[instrumentIndexIterator].volume = clamp(0, Config.volumeNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (command == SongTagCode.algorithm) {\r\n\t\t\t\t\tthis.channels[instrumentChannelIterator].instruments[instrumentIndexIterator].algorithm = clamp(0, Config.operatorAlgorithmNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t} else if (command == SongTagCode.feedbackType) {\r\n\t\t\t\t\tthis.channels[instrumentChannelIterator].instruments[instrumentIndexIterator].feedbackType = clamp(0, Config.operatorFeedbackNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t} else if (command == SongTagCode.feedbackAmplitude) {\r\n\t\t\t\t\tthis.channels[instrumentChannelIterator].instruments[instrumentIndexIterator].feedbackAmplitude = clamp(0, Config.operatorAmplitudeMax + 1, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t} else if (command == SongTagCode.feedbackEnvelope) {\r\n\t\t\t\t\tthis.channels[instrumentChannelIterator].instruments[instrumentIndexIterator].feedbackEnvelope = clamp(0, Config.operatorEnvelopeNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t} else if (command == SongTagCode.operatorFrequencies) {\r\n\t\t\t\t\tfor (let o: number = 0; o < Config.operatorCount; o++) {\r\n\t\t\t\t\t\tthis.channels[instrumentChannelIterator].instruments[instrumentIndexIterator].operators[o].frequency = clamp(0, Config.operatorFrequencyNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (command == SongTagCode.operatorAmplitudes) {\r\n\t\t\t\t\tfor (let o: number = 0; o < Config.operatorCount; o++) {\r\n\t\t\t\t\t\tthis.channels[instrumentChannelIterator].instruments[instrumentIndexIterator].operators[o].amplitude = clamp(0, Config.operatorAmplitudeMax + 1, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (command == SongTagCode.operatorEnvelopes) {\r\n\t\t\t\t\tfor (let o: number = 0; o < Config.operatorCount; o++) {\r\n\t\t\t\t\t\tthis.channels[instrumentChannelIterator].instruments[instrumentIndexIterator].operators[o].envelope = clamp(0, Config.operatorEnvelopeNames.length, base64CharCodeToInt[compressed.charCodeAt(charIndex++)]);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (command == SongTagCode.bars) {\r\n\t\t\t\t\tlet subStringLength: number;\r\n\t\t\t\t\tif (fromOld && beforeThree) {\r\n\t\t\t\t\t\tchannel = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\r\n\t\t\t\t\t\tconst barCount: number = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\r\n\t\t\t\t\t\tsubStringLength = Math.ceil(barCount * 0.5);\r\n\t\t\t\t\t\tconst bits: BitFieldReader = new BitFieldReader(base64CharCodeToInt, compressed, charIndex, charIndex + subStringLength);\r\n\t\t\t\t\t\tfor (let i: number = 0; i < barCount; i++) {\r\n\t\t\t\t\t\t\tthis.channels[channel].bars[i] = bits.read(3) + 1;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if (fromOld && beforeFive) {\r\n\t\t\t\t\t\tlet neededBits: number = 0;\r\n\t\t\t\t\t\twhile ((1 << neededBits) < this.patternsPerChannel) neededBits++;\r\n\t\t\t\t\t\tsubStringLength = Math.ceil(this.getChannelCount() * this.barCount * neededBits / 6);\r\n\t\t\t\t\t\tconst bits: BitFieldReader = new BitFieldReader(base64CharCodeToInt, compressed, charIndex, charIndex + subStringLength);\r\n\t\t\t\t\t\tfor (channel = 0; channel < this.getChannelCount(); channel++) {\r\n\t\t\t\t\t\t\tfor (let i: number = 0; i < this.barCount; i++) {\r\n\t\t\t\t\t\t\t\tthis.channels[channel].bars[i] = bits.read(neededBits) + 1;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tlet neededBits: number = 0;\r\n\t\t\t\t\t\twhile ((1 << neededBits) < this.patternsPerChannel + 1) neededBits++;\r\n\t\t\t\t\t\tsubStringLength = Math.ceil(this.getChannelCount() * this.barCount * neededBits / 6);\r\n\t\t\t\t\t\tconst bits: BitFieldReader = new BitFieldReader(base64CharCodeToInt, compressed, charIndex, charIndex + subStringLength);\r\n\t\t\t\t\t\tfor (channel = 0; channel < this.getChannelCount(); channel++) {\r\n\t\t\t\t\t\t\tfor (let i: number = 0; i < this.barCount; i++) {\r\n\t\t\t\t\t\t\t\tthis.channels[channel].bars[i] = bits.read(neededBits);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcharIndex += subStringLength;\r\n\t\t\t\t} else if (command == SongTagCode.patterns) {\r\n\t\t\t\t\tlet bitStringLength: number = 0;\r\n\t\t\t\t\tif (fromOld && beforeThree) {\r\n\t\t\t\t\t\tchannel = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// The old format used the next character to represent the number of patterns in the channel, which is usually eight, the default. \r\n\t\t\t\t\t\tcharIndex++; //let patternCount: number = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tbitStringLength = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\r\n\t\t\t\t\t\tbitStringLength = bitStringLength << 6;\r\n\t\t\t\t\t\tbitStringLength += base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tchannel = 0;\r\n\t\t\t\t\t\tlet bitStringLengthLength: number = base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\r\n\t\t\t\t\t\twhile (bitStringLengthLength > 0) {\r\n\t\t\t\t\t\t\tbitStringLength = bitStringLength << 6;\r\n\t\t\t\t\t\t\tbitStringLength += base64CharCodeToInt[compressed.charCodeAt(charIndex++)];\r\n\t\t\t\t\t\t\tbitStringLengthLength--;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tconst bits: BitFieldReader = new BitFieldReader(base64CharCodeToInt, compressed, charIndex, charIndex + bitStringLength);\r\n\t\t\t\t\tcharIndex += bitStringLength;\r\n\t\t\t\t\t\r\n\t\t\t\t\tlet neededInstrumentBits: number = 0;\r\n\t\t\t\t\twhile ((1 << neededInstrumentBits) < this.instrumentsPerChannel) neededInstrumentBits++;\r\n\t\t\t\t\twhile (true) {\r\n\t\t\t\t\t\tconst isDrum: boolean = this.getChannelIsDrum(channel);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tconst octaveOffset: number = isDrum ? 0 : this.channels[channel].octave * 12;\r\n\t\t\t\t\t\tlet note: Note | null = null;\r\n\t\t\t\t\t\tlet pin: NotePin | null = null;\r\n\t\t\t\t\t\tlet lastPitch: number = (isDrum ? 4 : 12) + octaveOffset;\r\n\t\t\t\t\t\tconst recentPitches: number[] = isDrum ? [4,6,7,2,3,8,0,10] : [12, 19, 24, 31, 36, 7, 0];\r\n\t\t\t\t\t\tconst recentShapes: any[] = [];\r\n\t\t\t\t\t\tfor (let i: number = 0; i < recentPitches.length; i++) {\r\n\t\t\t\t\t\t\trecentPitches[i] += octaveOffset;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tfor (let i: number = 0; i < this.patternsPerChannel; i++) {\r\n\t\t\t\t\t\t\tconst newPattern: Pattern = this.channels[channel].patterns[i];\r\n\t\t\t\t\t\t\tnewPattern.reset();\r\n\t\t\t\t\t\t\tnewPattern.instrument = bits.read(neededInstrumentBits);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (((fromOld && !beforeThree) || fromNepBox) && bits.read(1) == 0) continue;\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tlet curPart: number = 0;\r\n\t\t\t\t\t\t\tconst newNotes: Note[] = newPattern.notes;\r\n\t\t\t\t\t\t\twhile (curPart < this.beatsPerBar * this.partsPerBeat) {\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tconst useOldShape: boolean = bits.read(1) == 1;\r\n\t\t\t\t\t\t\t\tlet newNote: boolean = false;\r\n\t\t\t\t\t\t\t\tlet shapeIndex: number = 0;\r\n\t\t\t\t\t\t\t\tif (useOldShape) {\r\n\t\t\t\t\t\t\t\t\tshapeIndex = bits.readLongTail(0, 0);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tnewNote = bits.read(1) == 1;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tif (!useOldShape && !newNote) {\r\n\t\t\t\t\t\t\t\t\tconst restLength: number = bits.readPartDuration();\r\n\t\t\t\t\t\t\t\t\tcurPart += restLength;\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tlet shape: any;\r\n\t\t\t\t\t\t\t\t\tlet pinObj: any;\r\n\t\t\t\t\t\t\t\t\tlet pitch: number;\r\n\t\t\t\t\t\t\t\t\tif (useOldShape) {\r\n\t\t\t\t\t\t\t\t\t\tshape = recentShapes[shapeIndex];\r\n\t\t\t\t\t\t\t\t\t\trecentShapes.splice(shapeIndex, 1);\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\tshape = {};\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\tshape.pitchCount = 1;\r\n\t\t\t\t\t\t\t\t\t\twhile (shape.pitchCount < 4 && bits.read(1) == 1) shape.pitchCount++;\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\tshape.pinCount = bits.readPinCount();\r\n\t\t\t\t\t\t\t\t\t\tshape.initialVolume = bits.read(2);\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\tshape.pins = [];\r\n\t\t\t\t\t\t\t\t\t\tshape.length = 0;\r\n\t\t\t\t\t\t\t\t\t\tshape.bendCount = 0;\r\n\t\t\t\t\t\t\t\t\t\tfor (let j: number = 0; j < shape.pinCount; j++) {\r\n\t\t\t\t\t\t\t\t\t\t\tpinObj = {};\r\n\t\t\t\t\t\t\t\t\t\t\tpinObj.pitchBend = bits.read(1) == 1;\r\n\t\t\t\t\t\t\t\t\t\t\tif (pinObj.pitchBend) shape.bendCount++;\r\n\t\t\t\t\t\t\t\t\t\t\tshape.length += bits.readPartDuration();\r\n\t\t\t\t\t\t\t\t\t\t\tpinObj.time = shape.length;\r\n\t\t\t\t\t\t\t\t\t\t\tpinObj.volume = bits.read(2);\r\n\t\t\t\t\t\t\t\t\t\t\tshape.pins.push(pinObj);\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\trecentShapes.unshift(shape);\r\n\t\t\t\t\t\t\t\t\tif (recentShapes.length > 10) recentShapes.pop();\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tnote = makeNote(0,curPart,curPart + shape.length, shape.initialVolume);\r\n\t\t\t\t\t\t\t\t\tnote.pitches = [];\r\n\t\t\t\t\t\t\t\t\tnote.pins.length = 1;\r\n\t\t\t\t\t\t\t\t\tconst pitchBends: number[] = [];\r\n\t\t\t\t\t\t\t\t\tfor (let j: number = 0; j < shape.pitchCount + shape.bendCount; j++) {\r\n\t\t\t\t\t\t\t\t\t\tconst useOldPitch: boolean = bits.read(1) == 1;\r\n\t\t\t\t\t\t\t\t\t\tif (!useOldPitch) {\r\n\t\t\t\t\t\t\t\t\t\t\tconst interval: number = bits.readPitchInterval();\r\n\t\t\t\t\t\t\t\t\t\t\tpitch = lastPitch;\r\n\t\t\t\t\t\t\t\t\t\t\tlet intervalIter: number = interval;\r\n\t\t\t\t\t\t\t\t\t\t\twhile (intervalIter > 0) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tpitch++;\r\n\t\t\t\t\t\t\t\t\t\t\t\twhile (recentPitches.indexOf(pitch) != -1) pitch++;\r\n\t\t\t\t\t\t\t\t\t\t\t\tintervalIter--;\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\twhile (intervalIter < 0) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tpitch--;\r\n\t\t\t\t\t\t\t\t\t\t\t\twhile (recentPitches.indexOf(pitch) != -1) pitch--;\r\n\t\t\t\t\t\t\t\t\t\t\t\tintervalIter++;\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\tconst pitchIndex: number = bits.read(3);\r\n\t\t\t\t\t\t\t\t\t\t\tpitch = recentPitches[pitchIndex];\r\n\t\t\t\t\t\t\t\t\t\t\trecentPitches.splice(pitchIndex, 1);\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\trecentPitches.unshift(pitch);\r\n\t\t\t\t\t\t\t\t\t\tif (recentPitches.length > 8) recentPitches.pop();\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\tif (j < shape.pitchCount) {\r\n\t\t\t\t\t\t\t\t\t\t\tnote.pitches.push(pitch);\r\n\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\tpitchBends.push(pitch);\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\tif (j == shape.pitchCount - 1) {\r\n\t\t\t\t\t\t\t\t\t\t\tlastPitch = note.pitches[0];\r\n\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\tlastPitch = pitch;\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tpitchBends.unshift(note.pitches[0]);\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tfor (const pinObj of shape.pins) {\r\n\t\t\t\t\t\t\t\t\t\tif (pinObj.pitchBend) pitchBends.shift();\r\n\t\t\t\t\t\t\t\t\t\tpin = makeNotePin(pitchBends[0] - note.pitches[0], pinObj.time, pinObj.volume);\r\n\t\t\t\t\t\t\t\t\t\tnote.pins.push(pin);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tcurPart = note.end;\r\n\t\t\t\t\t\t\t\t\tnewNotes.push(note);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif (fromOld && beforeThree) {\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tchannel++;\r\n\t\t\t\t\t\t\tif (channel >= this.getChannelCount()) break;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} // while (true)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tpublic toJsonObject(enableIntro: boolean = true, loopCount: number = 1, enableOutro: boolean = true): Object {\r\n\t\t\tconst channelArray: Object[] = [];\r\n\t\t\tfor (let channel: number = 0; channel < this.getChannelCount(); channel++) {\r\n\t\t\t\tconst instrumentArray: Object[] = [];\r\n\t\t\t\tconst isDrum: boolean = this.getChannelIsDrum(channel);\r\n\t\t\t\tfor (let i: number = 0; i < this.instrumentsPerChannel; i++) {\r\n\t\t\t\t\tconst instrument: Instrument = this.channels[channel].instruments[i];\r\n\t\t\t\t\tif (isDrum) {\r\n\t\t\t\t\t\tinstrumentArray.push({\r\n\t\t\t\t\t\t\ttype: Config.instrumentTypeNames[InstrumentType.noise],\r\n\t\t\t\t\t\t\tvolume: (5 - instrument.volume) * 20,\r\n\t\t\t\t\t\t\timute: Config.imuteNames[instrument.imute],\r\n\t\t\t\t\t\t\twave: Config.drumNames[instrument.wave],\r\n\t\t\t\t\t\t\ttransition: Config.transitionNames[instrument.transition],\r\n\t\t\t\t\t\t\toctoff: Config.octoffNames[instrument.octoff],\r\n\t\t\t\t\t\t\tipan: Config.ipanValues[instrument.ipan],\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (instrument.type == InstrumentType.chip) {\r\n\t\t\t\t\t\t\tinstrumentArray.push({\r\n\t\t\t\t\t\t\t\ttype: Config.instrumentTypeNames[instrument.type],\r\n\t\t\t\t\t\t\t\tvolume: (5 - instrument.volume) * 20,\r\n\t\t\t\t\t\t\t\twave: Config.waveNames[instrument.wave],\r\n\t\t\t\t\t\t\t\ttransition: Config.transitionNames[instrument.transition],\r\n\t\t\t\t\t\t\t\tfilter: Config.filterNames[instrument.filter],\r\n\t\t\t\t\t\t\t\tchorus: Config.chorusNames[instrument.chorus],\r\n\t\t\t\t\t\t\t\teffect: Config.effectNames[instrument.effect],\r\n\t\t\t\t\t\t\t\tharm: Config.harmNames[instrument.harm],\r\n\t\t\t\t\t\t\t\timute: Config.imuteNames[instrument.imute],\r\n\t\t\t\t\t\t\t\toctoff: Config.octoffNames[instrument.octoff],\r\n\t\t\t\t\t\t\t\tipan: Config.ipanValues[instrument.ipan],\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t} else if (instrument.type == InstrumentType.fm) {\r\n\t\t\t\t\t\t\tconst operatorArray: Object[] = [];\r\n\t\t\t\t\t\t\tfor (const operator of instrument.operators) {\r\n\t\t\t\t\t\t\t\toperatorArray.push({\r\n\t\t\t\t\t\t\t\t\tfrequency: Config.operatorFrequencyNames[operator.frequency],\r\n\t\t\t\t\t\t\t\t\tamplitude: operator.amplitude,\r\n\t\t\t\t\t\t\t\t\tenvelope: Config.operatorEnvelopeNames[operator.envelope],\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tinstrumentArray.push({\r\n\t\t\t\t\t\t\t\ttype: Config.instrumentTypeNames[instrument.type],\r\n\t\t\t\t\t\t\t\tvolume: (5 - instrument.volume) * 20,\r\n\t\t\t\t\t\t\t\ttransition: Config.transitionNames[instrument.transition],\r\n\t\t\t\t\t\t\t\teffect: Config.effectNames[instrument.effect],\r\n\t\t\t\t\t\t\t\toctoff: Config.octoffNames[instrument.octoff],\r\n\t\t\t\t\t\t\t\tfmChorus: Config.fmChorusNames[instrument.fmChorus],\r\n\t\t\t\t\t\t\t\talgorithm: Config.operatorAlgorithmNames[instrument.algorithm],\r\n\t\t\t\t\t\t\t\tfeedbackType: Config.operatorFeedbackNames[instrument.feedbackType],\r\n\t\t\t\t\t\t\t\tfeedbackAmplitude: instrument.feedbackAmplitude,\r\n\t\t\t\t\t\t\t\tfeedbackEnvelope: Config.operatorEnvelopeNames[instrument.feedbackEnvelope],\r\n\t\t\t\t\t\t\t\toperators: operatorArray,\r\n\t\t\t\t\t\t\t\tipan: Config.ipanValues[instrument.ipan],\r\n\t\t\t\t\t\t\t\timute: Config.imuteNames[instrument.imute],\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t} else if (instrument.type == InstrumentType.pwm) {\r\n\t\t\t\t\t\t\tinstrumentArray.push({\r\n\t\t\t\t\t\t\t\t// This uses the wrong instrument type in order\r\n\t\t\t\t\t\t\t\t// to make JSON exports compatible with\r\n\t\t\t\t\t\t\t\t// https://thestarworld.github.io/modboxfixed/\r\n\t\t\t\t\t\t\t\ttype: Config.instrumentTypeNames[InstrumentType.noise],\r\n\t\t\t\t\t\t\t\tvolume: (5 - instrument.volume) * 20,\r\n\t\t\t\t\t\t\t\twave: Config.pwmwaveNames[instrument.wave],\r\n\t\t\t\t\t\t\t\ttransition: Config.transitionNames[instrument.transition],\r\n\t\t\t\t\t\t\t\tfilter: Config.filterNames[instrument.filter],\r\n\t\t\t\t\t\t\t\tchorus: Config.chorusNames[instrument.chorus],\r\n\t\t\t\t\t\t\t\teffect: Config.effectNames[instrument.effect],\r\n\t\t\t\t\t\t\t\tharm: Config.harmNames[instrument.harm],\r\n\t\t\t\t\t\t\t\timute: Config.imuteNames[instrument.imute],\r\n\t\t\t\t\t\t\t\toctoff: Config.octoffNames[instrument.octoff],\r\n\t\t\t\t\t\t\t\tipan: Config.ipanValues[instrument.ipan],\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthrow new Error(\"Unrecognized instrument type\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tconst patternArray: Object[] = [];\r\n\t\t\t\tfor (const pattern of this.channels[channel].patterns) {\r\n\t\t\t\t\tconst noteArray: Object[] = [];\r\n\t\t\t\t\tfor (const note of pattern.notes) {\r\n\t\t\t\t\t\tconst pointArray: Object[] = [];\r\n\t\t\t\t\t\tfor (const pin of note.pins) {\r\n\t\t\t\t\t\t\tpointArray.push({\r\n\t\t\t\t\t\t\t\ttick: pin.time + note.start,\r\n\t\t\t\t\t\t\t\tpitchBend: pin.interval,\r\n\t\t\t\t\t\t\t\tvolume: Math.round(pin.volume * 100 / 3),\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tnoteArray.push({\r\n\t\t\t\t\t\t\tpitches: note.pitches,\r\n\t\t\t\t\t\t\tpoints: pointArray,\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tpatternArray.push({\r\n\t\t\t\t\t\tinstrument: pattern.instrument + 1,\r\n\t\t\t\t\t\tnotes: noteArray, \r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tconst sequenceArray: number[] = [];\r\n\t\t\t\tif (enableIntro) for (let i: number = 0; i < this.loopStart; i++) {\r\n\t\t\t\t\tsequenceArray.push(this.channels[channel].bars[i]);\r\n\t\t\t\t}\r\n\t\t\t\tfor (let l: number = 0; l < loopCount; l++) for (let i: number = this.loopStart; i < this.loopStart + this.loopLength; i++) {\r\n\t\t\t\t\tsequenceArray.push(this.channels[channel].bars[i]);\r\n\t\t\t\t}\r\n\t\t\t\tif (enableOutro) for (let i: number = this.loopStart + this.loopLength; i < this.barCount; i++) {\r\n\t\t\t\t\tsequenceArray.push(this.channels[channel].bars[i]);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tchannelArray.push({\r\n\t\t\t\t\ttype: isDrum ? \"drum\" : \"pitch\",\r\n\t\t\t\t\toctaveScrollBar: this.channels[channel].octave,\r\n\t\t\t\t\tinstruments: instrumentArray,\r\n\t\t\t\t\tpatterns: patternArray,\r\n\t\t\t\t\tsequence: sequenceArray,\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\treturn {\r\n\t\t\t\tformat: Song._format,\r\n\t\t\t\tversion: Song._latestNepBoxVersion,\r\n\t\t\t\ttheme: this.setSongTheme,\r\n\t\t\t\tscale: Config.scales[this.scale].name,\r\n\t\t\t\tmix: Config.mixNames[this.mix],\r\n\t\t\t\tsampleRate: Config.sampleRateNames[this.sampleRate],\r\n\t\t\t\tkey: Config.keys[this.key].name,\r\n\t\t\t\tintroBars: this.loopStart,\r\n\t\t\t\tloopBars: this.loopLength,\r\n\t\t\t\tbeatsPerBar: this.beatsPerBar,\r\n\t\t\t\tticksPerBeat: this.partsPerBeat,\r\n\t\t\t\tbeatsPerMinute: this.getBeatsPerMinute(), // represents tempo\r\n\t\t\t\treverb: this.reverb,\r\n\t\t\t\tblend: this.blend,\r\n\t\t\t\triff: this.riff,\r\n\t\t\t\tdetune: this.detune,\r\n\t\t\t\tmuff: this.muff,\r\n\t\t\t\t//outroBars: this.barCount - this.loopStart - this.loopLength; // derive this from bar arrays?\r\n\t\t\t\t//patternCount: this.patternsPerChannel, // derive this from pattern arrays?\r\n\t\t\t\t//instrumentsPerChannel: this.instrumentsPerChannel, //derive this from instrument arrays?\r\n\t\t\t\tchannels: channelArray,\r\n\t\t\t};\r\n\t\t}\r\n\t\t\r\n\t\tpublic fromJsonObject(jsonObject: any): void {\r\n\t\t\tthis.initToDefault(true);\r\n\t\t\tif (!jsonObject) return;\r\n\t\t\tconst format: any = jsonObject.format;\r\n\t\t\tconst version: any = jsonObject.version;\r\n\t\t\tif (version > Song._format) return;\r\n\t\t\t\r\n\t\t\tthis.scale = 11; // default to expert.\r\n\t\t\tif (jsonObject.scale != undefined) {\r\n\t\t\t\tif (format == \"BeepBox\") {\r\n\t\t\t\tconst oldScaleNames: Dictionary<number> = {\"romani :)\": 8, \"romani :(\": 9};\r\n\t\t\t\tconst scale: number = oldScaleNames[jsonObject.scale] != undefined ? oldScaleNames[jsonObject.scale] : Config.scales.map(scale=>scale.name).indexOf(jsonObject.scale);\r\n\t\t\t\tif (scale != -1) this.scale = scale;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.scale = Config.scales.map(scale=>scale.name).indexOf(jsonObject[\"scale\"]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (jsonObject.theme != undefined) {\r\n\t\t\t\tif (format == \"BeepBox\") {\r\n\t\t\t\t\tif ((jsonObject[\"theme\"] != \"Nepbox\") && (jsonObject[\"theme\"] != \"Laffey\") && (jsonObject[\"theme\"] != \"ModBox\")) {\r\n\t\t\t\t\t\tvar themes = [\"none\", \"modbox2\", \"artic\", \"Cinnamon Roll\", \"Ocean\", \"rainbow\", \"float\", \"windows\", \"grassland\", \"dessert\", \"kahootiest\", \"beambit\", \"egg\", \"Poniryoshka\", \"gameboy\", \"woodkid\", \"midnight\", \"snedbox\", \"unnamed\", \"piano\", \"halloween\", \"frozen\"];\r\n\t\t\t\t\t\tvar themeIndex = Config.oldThemeNames.indexOf(jsonObject[\"theme\"]);\r\n\t\t\t\t\t\tthis.setSongTheme = themes[themeIndex];\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tvar themes = [\"none\", \"nepbox\", \"laffey\"];\r\n\t\t\t\t\t\tvar oldThemes = [\"ModBox\", \"Nepbox\", \"Laffey\"];\r\n\t\t\t\t\t\tvar themeIndex = oldThemes.indexOf(jsonObject[\"theme\"]);\r\n\t\t\t\t\t\tthis.setSongTheme = themes[themeIndex];\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\tthis.setSongTheme = jsonObject[\"theme\"];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (jsonObject.mix != undefined) {\r\n\t\t\t\tthis.mix = Config.mixNames.indexOf(jsonObject.mix);\r\n\t\t\t\tif (this.mix == -1) this.mix = 1;\r\n\t\t\t}\r\n\r\n\t\t\tif (jsonObject.sampleRate != undefined) {\r\n\t\t\t\tthis.sampleRate = Config.sampleRateNames.indexOf(jsonObject.sampleRate);\r\n\t\t\t\tif (this.sampleRate == -1) this.sampleRate = 2;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (jsonObject.key != undefined) {\r\n\t\t\t\tif (format == \"BeepBox\") {\r\n\t\t\t\t\tif (typeof(jsonObject.key) == \"number\") {\r\n\t\t\t\t\t\tthis.key = Config.oldKeys.length - 1 - (((jsonObject.key + 1200) >>> 0) % Config.oldKeys.length);\r\n\t\t\t\t\t} else if (typeof(jsonObject.key) == \"string\") {\r\n\t\t\t\t\t\tthis.key = Config.keys.map(key=>key.name).indexOf(jsonObject.key);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.key = Config.keys.map(key=>key.name).indexOf(jsonObject.key);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (jsonObject.beatsPerMinute != undefined) {\r\n\t\t\t\tconst bpm: number = jsonObject.beatsPerMinute | 0;\r\n\t\t\t\tthis.tempo = Math.round(4.0 + 9.0 * Math.log(bpm / 120) / Math.LN2);\r\n\t\t\t\tthis.tempo = clamp(0, Config.tempoSteps, this.tempo);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (jsonObject.reverb != undefined) {\r\n\t\t\t\tthis.reverb = clamp(0, Config.reverbRange, jsonObject.reverb | 0);\r\n\t\t\t}\r\n\r\n\t\t\tif (jsonObject.blend != undefined) {\r\n\t\t\t\tthis.blend = clamp(0, Config.blendRange, jsonObject.blend | 0);\r\n\t\t\t}\r\n\r\n\t\t\tif (jsonObject.riff != undefined) {\r\n\t\t\t\tthis.riff = clamp(0, Config.riffRange, jsonObject.riff | 0);\r\n\t\t\t}\r\n\r\n\t\t\tif (jsonObject.detune != undefined) {\r\n\t\t\t\tthis.detune = clamp(0, Config.detuneRange, jsonObject.detune | 0);\r\n\t\t\t}\r\n\r\n\t\t\tif (jsonObject.muff != undefined) {\r\n\t\t\t\tthis.muff = clamp(0, Config.muffRange, jsonObject.muff | 0);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (jsonObject.beatsPerBar != undefined) {\r\n\t\t\t\tthis.beatsPerBar = Math.max(Config.beatsPerBarMin, Math.min(Config.beatsPerBarMax, jsonObject.beatsPerBar | 0));\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (jsonObject.ticksPerBeat != undefined) {\r\n\t\t\t\tthis.partsPerBeat = jsonObject.ticksPerBeat | 0;\r\n\t\t\t\tif (Config.partCounts.indexOf(this.partsPerBeat) == -1) {\r\n\t\t\t\t\tthis.partsPerBeat = Config.partCounts[Config.partCounts.length - 1];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tlet maxInstruments: number = 1;\r\n\t\t\tlet maxPatterns: number = 1;\r\n\t\t\tlet maxBars: number = 1;\r\n\t\t\tif (jsonObject.channels) {\r\n\t\t\t\tfor (const channelObject of jsonObject.channels) {\r\n\t\t\t\t\tif (channelObject.instruments) maxInstruments = Math.max(maxInstruments, channelObject.instruments.length | 0);\r\n\t\t\t\t\tif (channelObject.patterns) maxPatterns = Math.max(maxPatterns, channelObject.patterns.length | 0);\r\n\t\t\t\t\tif (channelObject.sequence) maxBars = Math.max(maxBars, channelObject.sequence.length | 0);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.instrumentsPerChannel = maxInstruments;\r\n\t\t\tthis.patternsPerChannel = maxPatterns;\r\n\t\t\tthis.barCount = maxBars;\r\n\t\t\t\r\n\t\t\tif (jsonObject.introBars != undefined) {\r\n\t\t\t\tthis.loopStart = clamp(0, this.barCount, jsonObject.introBars | 0);\r\n\t\t\t}\r\n\t\t\tif (jsonObject.loopBars != undefined) {\r\n\t\t\t\tthis.loopLength = clamp(1, this.barCount - this.loopStart + 1, jsonObject.loopBars | 0);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tlet pitchChannelCount = 0;\r\n\t\t\tlet drumChannelCount = 0;\r\n\t\t\tif (jsonObject.channels) {\r\n\t\t\t\tfor (let channel: number = 0; channel < jsonObject.channels.length; channel++) {\r\n\t\t\t\t\tlet channelObject: any = jsonObject.channels[channel];\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (this.channels.length <= channel) this.channels[channel] = new Channel();\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (channelObject.octaveScrollBar != undefined) {\r\n\t\t\t\t\t\tthis.channels[channel].octave = clamp(0, 5, channelObject.octaveScrollBar | 0);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tfor (let i: number = this.channels[channel].instruments.length; i < this.instrumentsPerChannel; i++) {\r\n\t\t\t\t\t\tthis.channels[channel].instruments[i] = new Instrument();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.channels[channel].instruments.length = this.instrumentsPerChannel;\r\n\t\t\t\t\t\r\n\t\t\t\t\tfor (let i: number = this.channels[channel].patterns.length; i < this.patternsPerChannel; i++) {\r\n\t\t\t\t\t\tthis.channels[channel].patterns[i] = new Pattern();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.channels[channel].patterns.length = this.patternsPerChannel;\r\n\t\t\t\t\t\r\n\t\t\t\t\tfor (let i: number = 0; i < this.barCount; i++) {\r\n\t\t\t\t\t\tthis.channels[channel].bars[i] = 1;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.channels[channel].bars.length = this.barCount;\r\n\t\t\t\t\t\r\n\t\t\t\t\tlet isDrum: boolean = false;\r\n\t\t\t\t\tif (channelObject.type) {\r\n\t\t\t\t\t\tisDrum = (channelObject.type == \"drum\");\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// for older files, assume drums are channel 3.\r\n\t\t\t\t\t\tisDrum = (channel >= 3);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (isDrum) drumChannelCount++; else pitchChannelCount++;\r\n\t\t\t\t\t\r\n\t\t\t\t\tfor (let i: number = 0; i < this.instrumentsPerChannel; i++) {\r\n\t\t\t\t\t\tconst instrument: Instrument = this.channels[channel].instruments[i];\r\n\t\t\t\t\t\tlet instrumentObject: any = undefined;\r\n\t\t\t\t\t\tif (channelObject.instruments) instrumentObject = channelObject.instruments[i];\r\n\t\t\t\t\t\tif (instrumentObject == undefined) instrumentObject = {};\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tconst oldTransitionNames: Dictionary<number> = {\"binary\": 0};\r\n\t\t\t\t\t\tconst transitionObject = instrumentObject.transition || instrumentObject.envelope; // the transition property used to be called envelope, so try that too.\r\n\t\t\t\t\t\tinstrument.transition = oldTransitionNames[transitionObject] != undefined ? oldTransitionNames[transitionObject] : Config.transitionNames.indexOf(transitionObject);\r\n\t\t\t\t\t\tif (instrument.transition == -1) instrument.transition = 1;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif (isDrum) {\r\n\t\t\t\t\t\t\tif (instrumentObject.volume != undefined) {\r\n\t\t\t\t\t\t\t\tinstrument.volume = clamp(0, Config.volumeNames.length, Math.round(5 - (instrumentObject.volume | 0) / 20));\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tinstrument.volume = 0;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tinstrument.wave = Config.drumNames.indexOf(instrumentObject.wave);\r\n\t\t\t\t\t\t\tif (instrument.wave == -1) instrument.wave = 1;\r\n\t\t\t\t\t\t\tinstrument.imute = Config.imuteNames.indexOf(instrumentObject.imute);\r\n\t\t\t\t\t\t\tif (instrument.imute == -1) instrument.imute = 0;\r\n\t\t\t\t\t\t\tinstrument.ipan = Config.ipanValues.indexOf(instrumentObject.ipan);\r\n\t\t\t\t\t\t\tif (instrument.ipan == -1) instrument.ipan = 4;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tinstrument.type = Config.instrumentTypeNames.indexOf(instrumentObject.type);\r\n\t\t\t\t\t\t\tif (instrument.type == null) instrument.type = InstrumentType.chip;\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (instrument.type == InstrumentType.chip) {\r\n\t\t\t\t\t\t\t\tif (instrumentObject.volume != undefined) {\r\n\t\t\t\t\t\t\t\t\tinstrument.volume = clamp(0, Config.volumeNames.length, Math.round(5 - (instrumentObject.volume | 0) / 20));\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tinstrument.volume = 0;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tinstrument.wave = Config.waveNames.indexOf(instrumentObject.wave);\r\n\t\t\t\t\t\t\t\tif (instrument.wave == -1) instrument.wave = 1;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tconst oldFilterNames: Dictionary<number> = {\"sustain sharp\": 1, \"sustain medium\": 2, \"sustain soft\": 3, \"decay sharp\": 4};\r\n\t\t\t\t\t\t\t\tinstrument.filter = oldFilterNames[instrumentObject.filter] != undefined ? oldFilterNames[instrumentObject.filter] : Config.filterNames.indexOf(instrumentObject.filter);\r\n\t\t\t\t\t\t\t\tif (instrument.filter == -1) instrument.filter = 0;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tinstrument.chorus = Config.chorusNames.indexOf(instrumentObject.chorus);\r\n\t\t\t\t\t\t\t\tif (instrument.chorus == -1) instrument.chorus = 0;\r\n\t\t\t\t\t\t\t\tinstrument.effect = Config.effectNames.indexOf(instrumentObject.effect);\r\n\t\t\t\t\t\t\t\tif (instrument.effect == -1) instrument.effect = 0;\r\n\t\t\t\t\t\t\t\tinstrument.harm = Config.harmNames.indexOf(instrumentObject.harm);\r\n\t\t\t\t\t\t\t\tif (instrument.harm == -1) instrument.harm = 0;\r\n\t\t\t\t\t\t\t\tinstrument.octoff = Config.octoffNames.indexOf(instrumentObject.octoff);\r\n\t\t\t\t\t\t\t\tif (instrument.octoff == -1) instrument.octoff = 0;\r\n\t\t\t\t\t\t\t\tinstrument.imute = Config.imuteNames.indexOf(instrumentObject.imute);\r\n\t\t\t\t\t\t\t\tif (instrument.imute == -1) instrument.imute = 0;\r\n\t\t\t\t\t\t\t\tinstrument.ipan = Config.ipanValues.indexOf(instrumentObject.ipan);\r\n\t\t\t\t\t\t\t\tif (instrument.ipan == -1) instrument.ipan = 4;\r\n\t\t\t\t\t\t\t} else if (\r\n\t\t\t\t\t\t\t\tinstrument.type == InstrumentType.pwm\r\n\t\t\t\t\t\t\t\t|| instrument.type == InstrumentType.noise\r\n\t\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\t\tif (instrument.type == InstrumentType.noise) {\r\n\t\t\t\t\t\t\t\t\tinstrument.type = InstrumentType.pwm;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tif (instrumentObject.volume != undefined) {\r\n\t\t\t\t\t\t\t\t\tinstrument.volume = clamp(0, Config.volumeNames.length, Math.round(5 - (instrumentObject.volume | 0) / 20));\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tinstrument.volume = 0;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tinstrument.wave = Config.pwmwaveNames.indexOf(instrumentObject.wave);\r\n\t\t\t\t\t\t\t\tif (instrument.wave == -1) instrument.wave = 1;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tconst oldFilterNames: Dictionary<number> = {\"sustain sharp\": 1, \"sustain medium\": 2, \"sustain soft\": 3, \"decay sharp\": 4};\r\n\t\t\t\t\t\t\t\tinstrument.filter = oldFilterNames[instrumentObject.filter] != undefined ? oldFilterNames[instrumentObject.filter] : Config.filterNames.indexOf(instrumentObject.filter);\r\n\t\t\t\t\t\t\t\tif (instrument.filter == -1) instrument.filter = 0;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tinstrument.chorus = Config.chorusNames.indexOf(instrumentObject.chorus);\r\n\t\t\t\t\t\t\t\tif (instrument.chorus == -1) instrument.chorus = 0;\r\n\t\t\t\t\t\t\t\tinstrument.effect = Config.effectNames.indexOf(instrumentObject.effect);\r\n\t\t\t\t\t\t\t\tif (instrument.effect == -1) instrument.effect = 0;\r\n\t\t\t\t\t\t\t\tinstrument.harm = Config.harmNames.indexOf(instrumentObject.harm);\r\n\t\t\t\t\t\t\t\tif (instrument.harm == -1) instrument.harm = 0;\r\n\t\t\t\t\t\t\t\tinstrument.octoff = Config.octoffNames.indexOf(instrumentObject.octoff);\r\n\t\t\t\t\t\t\t\tif (instrument.octoff == -1) instrument.octoff = 0;\r\n\t\t\t\t\t\t\t\tinstrument.imute = Config.imuteNames.indexOf(instrumentObject.imute);\r\n\t\t\t\t\t\t\t\tif (instrument.imute == -1) instrument.imute = 0;\r\n\t\t\t\t\t\t\t\tinstrument.ipan = Config.ipanValues.indexOf(instrumentObject.ipan);\r\n\t\t\t\t\t\t\t\tif (instrument.ipan == -1) instrument.ipan = 4;\r\n\t\t\t\t\t\t\t} else if (instrument.type == InstrumentType.fm) {\r\n\t\t\t\t\t\t\t\tinstrument.effect = Config.effectNames.indexOf(instrumentObject.effect);\r\n\t\t\t\t\t\t\t\tif (instrument.effect == -1) instrument.effect = 0;\r\n\r\n\t\t\t\t\t\t\t\tinstrument.octoff = Config.octoffNames.indexOf(instrumentObject.octoff);\r\n\t\t\t\t\t\t\t\tif (instrument.octoff == -1) instrument.octoff = 0;\r\n\r\n\t\t\t\t\t\t\t\tinstrument.fmChorus = Config.fmChorusNames.indexOf(instrumentObject.fmChorus);\r\n\t\t\t\t\t\t\t\tif (instrument.fmChorus == -1) instrument.fmChorus = 0;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tinstrument.algorithm = Config.operatorAlgorithmNames.indexOf(instrumentObject.algorithm);\r\n\t\t\t\t\t\t\t\tif (instrument.algorithm == -1) instrument.algorithm = 0;\r\n\t\t\t\t\t\t\t\tinstrument.feedbackType = Config.operatorFeedbackNames.indexOf(instrumentObject.feedbackType);\r\n\t\t\t\t\t\t\t\tif (instrument.feedbackType == -1) instrument.feedbackType = 0;\r\n\t\t\t\t\t\t\t\tif (instrumentObject.feedbackAmplitude != undefined) {\r\n\t\t\t\t\t\t\t\t\tinstrument.feedbackAmplitude = clamp(0, Config.operatorAmplitudeMax + 1, instrumentObject.feedbackAmplitude | 0);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tinstrument.feedbackAmplitude = 0;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tinstrument.feedbackEnvelope = Config.operatorEnvelopeNames.indexOf(instrumentObject.feedbackEnvelope);\r\n\t\t\t\t\t\t\t\tif (instrument.feedbackEnvelope == -1) instrument.feedbackEnvelope = 0;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tfor (let j: number = 0; j < Config.operatorCount; j++) {\r\n\t\t\t\t\t\t\t\t\tconst operator: Operator = instrument.operators[j];\r\n\t\t\t\t\t\t\t\t\tlet operatorObject: any = undefined;\r\n\t\t\t\t\t\t\t\t\tif (instrumentObject.operators) operatorObject = instrumentObject.operators[j];\r\n\t\t\t\t\t\t\t\t\tif (operatorObject == undefined) operatorObject = {};\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\toperator.frequency = Config.operatorFrequencyNames.indexOf(operatorObject.frequency);\r\n\t\t\t\t\t\t\t\t\tif (operator.frequency == -1) operator.frequency = 0;\r\n\t\t\t\t\t\t\t\t\tif (operatorObject.amplitude != undefined) {\r\n\t\t\t\t\t\t\t\t\t\toperator.amplitude = clamp(0, Config.operatorAmplitudeMax + 1, operatorObject.amplitude | 0);\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\toperator.amplitude = 0;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\toperator.envelope = Config.operatorEnvelopeNames.indexOf(operatorObject.envelope);\r\n\t\t\t\t\t\t\t\t\tif (operator.envelope == -1) operator.envelope = 0;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tinstrument.ipan = Config.ipanValues.indexOf(instrumentObject.ipan);\r\n\t\t\t\t\t\t\t\tif (instrument.ipan == -1) instrument.ipan = 4;\r\n\t\t\t\t\t\t\t\tinstrument.imute = Config.imuteNames.indexOf(instrumentObject.imute);\r\n\t\t\t\t\t\t\t\tif (instrument.imute == -1) instrument.imute = 0;\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tthrow new Error(\"Unrecognized instrument type.\");\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t\tfor (let i: number = 0; i < this.patternsPerChannel; i++) {\r\n\t\t\t\t\t\tconst pattern: Pattern = this.channels[channel].patterns[i];\r\n\t\t\t\t\t\r\n\t\t\t\t\t\tlet patternObject: any = undefined;\r\n\t\t\t\t\t\tif (channelObject.patterns) patternObject = channelObject.patterns[i];\r\n\t\t\t\t\t\tif (patternObject == undefined) continue;\r\n\t\t\t\t\t\r\n\t\t\t\t\t\tpattern.instrument = clamp(0, this.instrumentsPerChannel, (patternObject.instrument | 0) - 1);\r\n\t\t\t\t\t\r\n\t\t\t\t\t\tif (patternObject.notes && patternObject.notes.length > 0) {\r\n\t\t\t\t\t\t\tconst maxNoteCount: number = Math.min(this.beatsPerBar * this.partsPerBeat, patternObject.notes.length >>> 0);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t///@TODO: Consider supporting notes specified in any timing order, sorting them and truncating as necessary. \r\n\t\t\t\t\t\t\tlet tickClock: number = 0;\r\n\t\t\t\t\t\t\tfor (let j: number = 0; j < patternObject.notes.length; j++) {\r\n\t\t\t\t\t\t\t\tif (j >= maxNoteCount) break;\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tconst noteObject = patternObject.notes[j];\r\n\t\t\t\t\t\t\t\tif (!noteObject || !noteObject.pitches || !(noteObject.pitches.length >= 1) || !noteObject.points || !(noteObject.points.length >= 2)) {\r\n\t\t\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tconst note: Note = makeNote(0, 0, 0, 0);\r\n\t\t\t\t\t\t\t\tnote.pitches = [];\r\n\t\t\t\t\t\t\t\tnote.pins = [];\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tfor (let k: number = 0; k < noteObject.pitches.length; k++) {\r\n\t\t\t\t\t\t\t\t\tconst pitch: number = noteObject.pitches[k] | 0;\r\n\t\t\t\t\t\t\t\t\tif (note.pitches.indexOf(pitch) != -1) continue;\r\n\t\t\t\t\t\t\t\t\tnote.pitches.push(pitch);\r\n\t\t\t\t\t\t\t\t\tif (note.pitches.length >= 4) break;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tif (note.pitches.length < 1) continue;\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tlet noteClock: number = tickClock;\r\n\t\t\t\t\t\t\t\tlet startInterval: number = 0;\r\n\t\t\t\t\t\t\t\tfor (let k: number = 0; k < noteObject.points.length; k++) {\r\n\t\t\t\t\t\t\t\t\tconst pointObject: any = noteObject.points[k];\r\n\t\t\t\t\t\t\t\t\tif (pointObject == undefined || pointObject.tick == undefined) continue;\r\n\t\t\t\t\t\t\t\t\tconst interval: number = (pointObject.pitchBend == undefined) ? 0 : (pointObject.pitchBend | 0);\r\n\t\t\t\t\t\t\t\t\tconst time: number = pointObject.tick | 0;\r\n\t\t\t\t\t\t\t\t\tconst volume: number = (pointObject.volume == undefined) ? 3 : Math.max(0, Math.min(3, Math.round((pointObject.volume | 0) * 3 / 100)));\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tif (time > this.beatsPerBar * this.partsPerBeat) continue;\r\n\t\t\t\t\t\t\t\t\tif (note.pins.length == 0) {\r\n\t\t\t\t\t\t\t\t\t\tif (time < noteClock) continue;\r\n\t\t\t\t\t\t\t\t\t\tnote.start = time;\r\n\t\t\t\t\t\t\t\t\t\tstartInterval = interval;\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\tif (time <= noteClock) continue;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tnoteClock = time;\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tnote.pins.push(makeNotePin(interval - startInterval, time - note.start, volume));\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tif (note.pins.length < 2) continue;\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tnote.end = note.pins[note.pins.length - 1].time + note.start;\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tconst maxPitch: number = isDrum ? Config.drumCount - 1 : Config.maxPitch;\r\n\t\t\t\t\t\t\t\tlet lowestPitch: number = maxPitch;\r\n\t\t\t\t\t\t\t\tlet highestPitch: number = 0;\r\n\t\t\t\t\t\t\t\tfor (let k: number = 0; k < note.pitches.length; k++) {\r\n\t\t\t\t\t\t\t\t\tnote.pitches[k] += startInterval;\r\n\t\t\t\t\t\t\t\t\tif (note.pitches[k] < 0 || note.pitches[k] > maxPitch) {\r\n\t\t\t\t\t\t\t\t\t\tnote.pitches.splice(k, 1);\r\n\t\t\t\t\t\t\t\t\t\tk--;\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tif (note.pitches[k] < lowestPitch) lowestPitch = note.pitches[k];\r\n\t\t\t\t\t\t\t\t\tif (note.pitches[k] > highestPitch) highestPitch = note.pitches[k];\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tif (note.pitches.length < 1) continue;\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tfor (let k: number = 0; k < note.pins.length; k++) {\r\n\t\t\t\t\t\t\t\t\tconst pin: NotePin = note.pins[k];\r\n\t\t\t\t\t\t\t\t\tif (pin.interval + lowestPitch < 0) pin.interval = -lowestPitch;\r\n\t\t\t\t\t\t\t\t\tif (pin.interval + highestPitch > maxPitch) pin.interval = maxPitch - highestPitch;\r\n\t\t\t\t\t\t\t\t\tif (k >= 2) {\r\n\t\t\t\t\t\t\t\t\t\tif (pin.interval == note.pins[k-1].interval && \r\n\t\t\t\t\t\t\t\t\t\t\tpin.interval == note.pins[k-2].interval && \r\n\t\t\t\t\t\t\t\t\t\t\tpin.volume == note.pins[k-1].volume && \r\n\t\t\t\t\t\t\t\t\t\t\tpin.volume == note.pins[k-2].volume)\r\n\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\tnote.pins.splice(k-1, 1);\r\n\t\t\t\t\t\t\t\t\t\t\tk--;\r\n\t\t\t\t\t\t\t\t\t\t}    \r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tpattern.notes.push(note);\r\n\t\t\t\t\t\t\t\ttickClock = note.end;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t\tfor (let i: number = 0; i < this.barCount; i++) {\r\n\t\t\t\t\t\tthis.channels[channel].bars[i] = channelObject.sequence ? Math.min(this.patternsPerChannel, channelObject.sequence[i] >>> 0) : 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.pitchChannelCount = pitchChannelCount;\r\n\t\t\tthis.drumChannelCount = drumChannelCount;\r\n\t\t\tthis.channels.length = this.getChannelCount();\r\n\t\t}\r\n\t\t\r\n\t\tpublic getPattern(channel: number, bar: number): Pattern | null {\r\n\t\t\tconst patternIndex: number = this.channels[channel].bars[bar];\r\n\t\t\tif (patternIndex == 0) return null;\r\n\t\t\treturn this.channels[channel].patterns[patternIndex - 1];\r\n\t\t}\r\n\t\t\r\n\t\tpublic getPatternInstrument(channel: number, bar: number): number {\r\n\t\t\tconst pattern: Pattern | null = this.getPattern(channel, bar);\r\n\t\t\treturn pattern == null ? 0 : pattern.instrument;\r\n\t\t}\r\n\r\n\t\tpublic getPatternInstrumentMute(channel: number, bar: number): number {\r\n\t\t\tconst pattern: Pattern | null = this.getPattern(channel, bar);\r\n\t\t\tconst instrumentIndex: number = this.getPatternInstrument(channel, bar);\r\n\t\t\tconst instrument: Instrument = this.channels[channel].instruments[instrumentIndex];\r\n\t\t\treturn pattern == null ? 0 : instrument.imute;\r\n\t\t}\r\n\r\n\t\tpublic getPatternInstrumentVolume(channel: number, bar: number): number {\r\n\t\t\tconst pattern: Pattern | null = this.getPattern(channel, bar);\r\n\t\t\tconst instrumentIndex: number = this.getPatternInstrument(channel, bar);\r\n\t\t\tconst instrument: Instrument = this.channels[channel].instruments[instrumentIndex];\r\n\t\t\treturn pattern == null ? 0 : instrument.volume;\r\n\t\t}\r\n\t\t\r\n\t\tpublic getBeatsPerMinute(): number {\r\n\t\t\treturn Math.round(120.0 * Math.pow(2.0, (-4.0 + this.tempo) / 9.0));\r\n\t\t}\r\n\t\t\r\n\t\tprivate readonly _fingerprint: Array<string | number> = [];\r\n\t\tpublic getChannelFingerprint(bar: number): string {\r\n\t\t\tconst channelCount: number = this.getChannelCount();\r\n\t\t\tlet charCount: number = 0;\r\n\t\t\tfor (let channel: number = 0; channel < channelCount; channel++) {\r\n\t\t\t\tif (channel < this.pitchChannelCount) {\r\n\t\t\t\t\tconst instrumentIndex: number = this.getPatternInstrument(channel, bar);\r\n\t\t\t\t\tconst instrument: Instrument = this.channels[channel].instruments[instrumentIndex];\r\n\t\t\t\t\tif (instrument.type == InstrumentType.chip) {\r\n\t\t\t\t\t\tthis._fingerprint[charCount++] = \"c\";\r\n\t\t\t\t\t} else if (instrument.type == InstrumentType.fm) {\r\n\t\t\t\t\t\tthis._fingerprint[charCount++] = \"f\"\r\n\t\t\t\t\t\tthis._fingerprint[charCount++] = instrument.algorithm;\r\n\t\t\t\t\t\tthis._fingerprint[charCount++] = instrument.feedbackType;\r\n\t\t\t\t\t} else if (instrument.type == InstrumentType.pwm) {\r\n\t\t\t\t\t\tthis._fingerprint[charCount++] = \"p\";\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthrow new Error(\"Unknown instrument type.\");\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis._fingerprint[charCount++] = \"d\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis._fingerprint.length = charCount;\r\n\t\t\treturn this._fingerprint.join(\"\");\r\n\t\t}\r\n\t}","/*\r\nCopyright (C) 2018 John Nesky\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of \r\nthis software and associated documentation files (the \"Software\"), to deal in \r\nthe Software without restriction, including without limitation the rights to \r\nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \r\nof the Software, and to permit persons to whom the Software is furnished to do \r\nso, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all \r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \r\nSOFTWARE.\r\n*/\r\n\r\n\r\n\texport class Change {\r\n\t\tprivate _noop: boolean = true;\r\n\t\t\r\n\t\tprotected _didSomething(): void {\r\n\t\t\tthis._noop = false;\r\n\t\t}\r\n\t\t\r\n\t\tpublic isNoop(): boolean {\r\n\t\t\treturn this._noop;\r\n\t\t}\r\n\r\n\t\tpublic commit(): void {}\r\n\t}\r\n\t\r\n\texport class UndoableChange extends Change {\r\n\t\tprivate _reversed: boolean;\r\n\t\tprivate _doneForwards: boolean;\r\n\t\tconstructor(reversed: boolean) {\r\n\t\t\tsuper();\r\n\t\t\tthis._reversed = reversed;\r\n\t\t\tthis._doneForwards = !reversed;\r\n\t\t}\r\n\t\t\r\n\t\tpublic undo(): void {\r\n\t\t\tif (this._reversed) {\r\n\t\t\t\tthis._doForwards();\r\n\t\t\t\tthis._doneForwards = true;\r\n\t\t\t} else {\r\n\t\t\t\tthis._doBackwards();\r\n\t\t\t\tthis._doneForwards = false;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tpublic redo(): void {\r\n\t\t\tif (this._reversed) {\r\n\t\t\t\tthis._doBackwards();\r\n\t\t\t\tthis._doneForwards = false;\r\n\t\t\t} else {\r\n\t\t\t\tthis._doForwards();\r\n\t\t\t\tthis._doneForwards = true;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t// isDoneForwards() returns whether or not the Change was most recently \r\n\t\t// performed forwards or backwards. If the change created something, do not \r\n\t\t// delete it in the change destructor unless the Change was performed \r\n\t\t// backwards: \r\n\t\tprotected _isDoneForwards(): boolean {\r\n\t\t\treturn this._doneForwards;\r\n\t\t}\r\n\t\t\r\n\t\tprotected _doForwards(): void {\r\n\t\t\tthrow new Error(\"Change.doForwards(): Override me.\");\r\n\t\t}\r\n\t\t\r\n\t\tprotected _doBackwards(): void {\r\n\t\t\tthrow new Error(\"Change.doBackwards(): Override me.\");\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeGroup extends Change {\r\n\t\tconstructor() {\r\n\t\t\tsuper();\r\n\t\t}\r\n\t\t\r\n\t\tpublic append(change: Change): void {\r\n\t\t\tif (change.isNoop()) return;\r\n\t\t\tthis._didSomething();\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeSequence extends UndoableChange {\r\n\t\tprivate _changes: UndoableChange[];\r\n\t\tconstructor(changes?: UndoableChange[]) {\r\n\t\t\tsuper(false);\r\n\t\t\tif (changes == undefined) {\r\n\t\t\t\tthis._changes = [];\r\n\t\t\t} else {\r\n\t\t\t\tthis._changes = changes.concat();\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tpublic append(change: UndoableChange): void {\r\n\t\t\tif (change.isNoop()) return;\r\n\t\t\tthis._changes[this._changes.length] = change;\r\n\t\t\tthis._didSomething();\r\n\t\t}\r\n\t\t\r\n\t\tprotected _doForwards(): void {\r\n\t\t\tfor (let i: number = 0; i < this._changes.length; i++) {\r\n\t\t\t\tthis._changes[i].redo();\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tprotected _doBackwards(): void {\r\n\t\t\tfor (let i: number = this._changes.length-1; i >= 0 ; i--) {\r\n\t\t\t\tthis._changes[i].undo();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n","/*\r\nCopyright (C) 2018 John Nesky\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of \r\nthis software and associated documentation files (the \"Software\"), to deal in \r\nthe Software without restriction, including without limitation the rights to \r\nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \r\nof the Software, and to permit persons to whom the Software is furnished to do \r\nso, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all \r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \r\nSOFTWARE.\r\n*/\r\n\r\nimport { SongDocument } from \"./SongDocument\";\r\nimport { Change, UndoableChange, ChangeSequence, ChangeGroup } from \"./Change\";\r\nimport { NotePin, Note, Song, Pattern, makeNotePin, Instrument, Channel } from \"../synth/song\";\r\nimport { InstrumentType, Config } from \"../synth/SynthConfig\";\r\n\r\n\texport class ChangePins extends UndoableChange {\r\n\t\tprotected _oldStart: number;\r\n\t\tprotected _newStart: number;\r\n\t\tprotected _oldEnd: number;\r\n\t\tprotected _newEnd: number;\r\n\t\tprotected _oldPins: NotePin[];\r\n\t\tprotected _newPins: NotePin[];\r\n\t\tprotected _oldPitches: number[];\r\n\t\tprotected _newPitches: number[];\r\n\t\tconstructor(protected _doc: SongDocument, protected _note: Note) {\r\n\t\t\tsuper(false);\r\n\t\t\tthis._oldStart = this._note.start;\r\n\t\t\tthis._oldEnd   = this._note.end;\r\n\t\t\tthis._newStart = this._note.start;\r\n\t\t\tthis._newEnd   = this._note.end;\r\n\t\t\tthis._oldPins = this._note.pins;\r\n\t\t\tthis._newPins = [];\r\n\t\t\tthis._oldPitches = this._note.pitches;\r\n\t\t\tthis._newPitches = [];\r\n\t\t}\r\n\t\t\r\n\t\tprotected _finishSetup(): void {\r\n\t\t\tfor (let i: number = 0; i < this._newPins.length - 1; ) {\r\n\t\t\t\tif (this._newPins[i].time >= this._newPins[i+1].time) {\r\n\t\t\t\t\tthis._newPins.splice(i, 1);\r\n\t\t\t\t} else {\r\n\t\t\t\t\ti++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tfor (let i: number = 1; i < this._newPins.length - 1; ) {\r\n\t\t\t\tif (this._newPins[i-1].interval == this._newPins[i].interval && \r\n\t\t\t\t    this._newPins[i].interval == this._newPins[i+1].interval && \r\n\t\t\t\t    this._newPins[i-1].volume == this._newPins[i].volume && \r\n\t\t\t\t    this._newPins[i].volume == this._newPins[i+1].volume)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis._newPins.splice(i, 1);\r\n\t\t\t\t} else {\r\n\t\t\t\t\ti++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tconst firstInterval: number = this._newPins[0].interval;\r\n\t\t\tconst firstTime: number = this._newPins[0].time;\r\n\t\t\tfor (let i: number = 0; i < this._oldPitches.length; i++) {\r\n\t\t\t\tthis._newPitches[i] = this._oldPitches[i] + firstInterval;\r\n\t\t\t}\r\n\t\t\tfor (let i: number = 0; i < this._newPins.length; i++) {\r\n\t\t\t\tthis._newPins[i].interval -= firstInterval;\r\n\t\t\t\tthis._newPins[i].time -= firstTime;\r\n\t\t\t}\r\n\t\t\tthis._newStart = this._oldStart + firstTime;\r\n\t\t\tthis._newEnd   = this._newStart + this._newPins[this._newPins.length-1].time;\r\n\t\t\t\r\n\t\t\tthis._doForwards();\r\n\t\t\tthis._didSomething();\r\n\t\t}\r\n\t\t\r\n\t\tprotected _doForwards(): void {\r\n\t\t\tthis._note.pins = this._newPins;\r\n\t\t\tthis._note.pitches = this._newPitches;\r\n\t\t\tthis._note.start = this._newStart;\r\n\t\t\tthis._note.end = this._newEnd;\r\n\t\t\tthis._doc.notifier.changed();\r\n\t\t}\r\n\t\t\r\n\t\tprotected _doBackwards(): void {\r\n\t\t\tthis._note.pins = this._oldPins;\r\n\t\t\tthis._note.pitches = this._oldPitches;\r\n\t\t\tthis._note.start = this._oldStart;\r\n\t\t\tthis._note.end = this._oldEnd;\r\n\t\t\tthis._doc.notifier.changed();\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeInstrumentType extends Change {\r\n\t\tconstructor(doc: SongDocument, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tconst oldValue: number = doc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].type;\r\n\t\t\tif (oldValue != newValue) {\r\n\t\t\t\tdoc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].type = newValue;\r\n\t\t\t\tif (newValue == InstrumentType.chip) {\r\n\t\t\t\t\t// This is technically not necessary, so long as there are\r\n\t\t\t\t\t// more chip waves than pwm waves, but might as well have\r\n\t\t\t\t\t// it here for safety.\r\n\t\t\t\t\tconst instrument: Instrument = doc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()];\r\n\t\t\t\t\tinstrument.wave = Math.max(0, Math.min(Config.waves.length - 1, instrument.wave));\r\n\t\t\t\t} else if (newValue == InstrumentType.pwm) {\r\n\t\t\t\t\t// When going from chip to pwm, if there are more chip\r\n\t\t\t\t\t// waves than pwm waves, .wave can be invalid.\r\n\t\t\t\t\tconst instrument: Instrument = doc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()];\r\n\t\t\t\t\tinstrument.wave = Math.max(0, Math.min(Config.pwmwaves.length - 1, instrument.wave));\r\n\t\t\t\t}\r\n\t\t\t\tdoc.notifier.changed();\r\n\t\t\t\tthis._didSomething();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeTransition extends Change {\r\n\t\tconstructor(doc: SongDocument, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tconst oldValue: number = doc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].transition;\r\n\t\t\tif (oldValue != newValue) {\r\n\t\t\t\tthis._didSomething();\r\n\t\t\t\tdoc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].transition = newValue;\r\n\t\t\t\tdoc.notifier.changed();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangePattern extends Change {\r\n\t\tconstructor(doc: SongDocument, public oldValue: number, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tif (newValue > doc.song.patternsPerChannel) throw new Error(\"invalid pattern\");\r\n\t\t\tdoc.song.channels[doc.channel].bars[doc.bar] = newValue;\r\n\t\t\tdoc.notifier.changed();\r\n\t\t\tif (oldValue != newValue) this._didSomething();\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeBarCount extends Change {\r\n\t\tconstructor(doc: SongDocument, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tif (doc.song.barCount != newValue) {\r\n\t\t\t\tfor (let channel: number = 0; channel < doc.song.getChannelCount(); channel++) {\r\n\t\t\t\t\tfor (let bar: number = doc.song.barCount; bar < newValue; bar++) {\r\n\t\t\t\t\t\tdoc.song.channels[channel].bars[bar] = 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdoc.song.channels[channel].bars.length = newValue;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tlet newBar: number = doc.bar;\r\n\t\t\t\tlet newBarScrollPos: number = doc.barScrollPos;\r\n\t\t\t\tlet newLoopStart: number = doc.song.loopStart;\r\n\t\t\t\tlet newLoopLength: number = doc.song.loopLength;\r\n\t\t\t\tif (doc.song.barCount > newValue) {\r\n\t\t\t\t\tnewBar = Math.min(newBar, newValue - 1);\r\n\t\t\t\t\tnewBarScrollPos = Math.max(0, Math.min(newValue - doc.trackVisibleBars, newBarScrollPos));\r\n\t\t\t\t\tnewLoopLength = Math.min(newValue, newLoopLength);\r\n\t\t\t\t\tnewLoopStart = Math.min(newValue - newLoopLength, newLoopStart);\r\n\t\t\t\t}\r\n\t\t\t\tdoc.bar = newBar;\r\n\t\t\t\tdoc.barScrollPos = newBarScrollPos;\r\n\t\t\t\tdoc.song.loopStart = newLoopStart;\r\n\t\t\t\tdoc.song.loopLength = newLoopLength;\r\n\t\t\t\tdoc.song.barCount = newValue;\r\n\t\t\t\tdoc.notifier.changed();\r\n\t\t\t\t\r\n\t\t\t\tthis._didSomething();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeInsertBars extends Change {\r\n\t\tconstructor(doc: SongDocument, start: number, count: number) {\r\n\t\t\tsuper();\r\n\t\t\t\r\n\t\t\tconst newLength: number = Math.min(Config.barCountMax, doc.song.barCount + count);\r\n\t\t\tcount = newLength - doc.song.barCount;\r\n\t\t\tif (count == 0) return;\r\n\t\t\t\r\n\t\t\tfor (const channel of doc.song.channels) {\r\n\t\t\t\twhile (channel.bars.length < newLength) {\r\n\t\t\t\t\tchannel.bars.splice(start, 0, 0);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tdoc.song.barCount = newLength;\r\n\t\t\t\r\n\t\t\tdoc.bar += count;\r\n\t\t\tdoc.barScrollPos += count;\r\n\t\t\tif (doc.song.loopStart >= start) {\r\n\t\t\t\tdoc.song.loopStart += count;\r\n\t\t\t} else if (doc.song.loopStart + doc.song.loopLength >= start) {\r\n\t\t\t\tdoc.song.loopLength += count;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tdoc.notifier.changed();\r\n\t\t\tthis._didSomething();\r\n\t\t}\r\n\t}\r\n\r\n\texport class ChangeDeleteBars extends Change {\r\n\t\tconstructor(doc: SongDocument, start: number, count: number) {\r\n\t\t\tsuper();\r\n\t\t\t\r\n\t\t\tfor (const channel of doc.song.channels) {\r\n\t\t\t\tchannel.bars.splice(start, count);\r\n\t\t\t\tif (channel.bars.length == 0) channel.bars.push(0);\r\n\t\t\t}\r\n\t\t\tdoc.song.barCount = Math.max(1, doc.song.barCount - count);\r\n\t\t\t\r\n\t\t\tdoc.bar = Math.max(0, doc.bar - count);\r\n\t\t\tdoc.barScrollPos = Math.max(0, doc.barScrollPos - count);\r\n\t\t\tif (doc.song.loopStart >= start) {\r\n\t\t\t\tdoc.song.loopStart = Math.max(0, doc.song.loopStart - count);\r\n\t\t\t} else if (doc.song.loopStart + doc.song.loopLength > start) {\r\n\t\t\t\tdoc.song.loopLength -= count;\r\n\t\t\t}\r\n\t\t\tdoc.song.loopLength = Math.max(1, Math.min(doc.song.barCount - doc.song.loopStart, doc.song.loopLength));\r\n\t\t\t\r\n\t\t\tdoc.notifier.changed();\r\n\t\t\tthis._didSomething();\r\n\t\t}\r\n\t}\r\n\r\n\texport class ChangeChannelCount extends Change {\r\n\t\tconstructor(doc: SongDocument, newPitchChannelCount: number, newDrumChannelCount: number) {\r\n\t\t\tsuper();\r\n\t\t\tif (doc.song.pitchChannelCount != newPitchChannelCount || doc.song.drumChannelCount != newDrumChannelCount) {\r\n\t\t\t\tconst newChannels: Channel[] = [];\r\n\t\t\t\t\r\n\t\t\t\tfor (let i: number = 0; i < newPitchChannelCount; i++) {\r\n\t\t\t\t\tconst channel = i;\r\n\t\t\t\t\tconst oldChannel = i;\r\n\t\t\t\t\tif (i < doc.song.pitchChannelCount) {\r\n\t\t\t\t\t\tnewChannels[channel] = doc.song.channels[oldChannel]\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tnewChannels[channel] = new Channel();\r\n\t\t\t\t\t\tnewChannels[channel].octave = 2;\r\n\t\t\t\t\t\tfor (let j: number = 0; j < doc.song.instrumentsPerChannel; j++) newChannels[channel].instruments[j] = new Instrument();\r\n\t\t\t\t\t\tfor (let j: number = 0; j < doc.song.patternsPerChannel; j++) newChannels[channel].patterns[j] = new Pattern();\r\n\t\t\t\t\t\tfor (let j: number = 0; j < doc.song.barCount; j++) newChannels[channel].bars[j] = 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor (let i: number = 0; i < newDrumChannelCount; i++) {\r\n\t\t\t\t\tconst channel = i + newPitchChannelCount;\r\n\t\t\t\t\tconst oldChannel = i + doc.song.pitchChannelCount;\r\n\t\t\t\t\tif (i < doc.song.drumChannelCount) {\r\n\t\t\t\t\t\tnewChannels[channel] = doc.song.channels[oldChannel]\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tnewChannels[channel] = new Channel();\r\n\t\t\t\t\t\tnewChannels[channel].octave = 0;\r\n\t\t\t\t\t\tfor (let j: number = 0; j < doc.song.instrumentsPerChannel; j++) newChannels[channel].instruments[j] = new Instrument();\r\n\t\t\t\t\t\tfor (let j: number = 0; j < doc.song.patternsPerChannel; j++) newChannels[channel].patterns[j] = new Pattern();\r\n\t\t\t\t\t\tfor (let j: number = 0; j < doc.song.barCount; j++) newChannels[channel].bars[j] = 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tdoc.song.pitchChannelCount = newPitchChannelCount;\r\n\t\t\t\tdoc.song.drumChannelCount = newDrumChannelCount;\r\n\t\t\t\tfor (let channel: number = 0; channel < doc.song.getChannelCount(); channel++) {\r\n\t\t\t\t\tdoc.song.channels[channel] = newChannels[channel];\r\n\t\t\t\t}\r\n\t\t\t\tdoc.song.channels.length = doc.song.getChannelCount();\r\n\t\t\t\t\r\n\t\t\t\tdoc.channel = Math.min(doc.channel, newPitchChannelCount + newDrumChannelCount - 1);\r\n\t\t\t\tdoc.notifier.changed();\r\n\t\t\t\t\r\n\t\t\t\tthis._didSomething();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeBeatsPerBar extends Change {\r\n\t\tconstructor(doc: SongDocument, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tif (doc.song.beatsPerBar != newValue) {\r\n\t\t\t\tif (doc.song.beatsPerBar > newValue) {\r\n\t\t\t\t\tconst sequence: ChangeSequence = new ChangeSequence();\r\n\t\t\t\t\tfor (let i: number = 0; i < doc.song.getChannelCount(); i++) {\r\n\t\t\t\t\t\tfor (let j: number = 0; j < doc.song.channels[i].patterns.length; j++) {\r\n\t\t\t\t\t\t\tsequence.append(new ChangeNoteTruncate(doc, doc.song.channels[i].patterns[j], newValue * doc.song.partsPerBeat, doc.song.beatsPerBar * doc.song.partsPerBeat));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tdoc.song.beatsPerBar = newValue;\r\n\t\t\t\tdoc.notifier.changed();\r\n\t\t\t\tthis._didSomething();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeChannelOrder extends Change {\r\n\t\tconstructor(doc: SongDocument, selectionMin: number, selectionMax: number, offset: number) {\r\n\t\t\tsuper();\r\n\t\t\tdoc.song.channels.splice(selectionMin + offset, 0, ...doc.song.channels.splice(selectionMin, selectionMax - selectionMin + 1));\r\n\t\t\tdoc.notifier.changed();\r\n\t\t\tthis._didSomething();\r\n\t\t}\r\n\t}\r\n\r\n\texport class ChangeAddChannel extends ChangeGroup {\r\n\t\tconstructor(doc: SongDocument, index: number, isNoise: boolean) {\r\n\t\t\tsuper();\r\n\t\t\tconst newPitchChannelCount: number = doc.song.pitchChannelCount + (isNoise ? 0 : 1);\r\n\t\t\tconst newNoiseChannelCount: number = doc.song.drumChannelCount + (isNoise ? 1 : 0);\r\n\t\t\tif (newPitchChannelCount <= Config.pitchChannelCountMax && newNoiseChannelCount <= Config.drumChannelCountMax) {\r\n\t\t\t\tconst addedChannelIndex: number = isNoise ? doc.song.pitchChannelCount + doc.song.drumChannelCount : doc.song.pitchChannelCount;\r\n\t\t\t\tthis.append(new ChangeChannelCount(doc, newPitchChannelCount, newNoiseChannelCount));\r\n\t\t\t\tthis.append(new ChangeChannelOrder(doc, index, addedChannelIndex - 1, 1));\r\n\t\t\t}\r\n\t\t\tdoc.notifier.changed();\r\n\t\t\tthis._didSomething();\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeRemoveChannel extends ChangeGroup {\r\n\t\tconstructor(doc: SongDocument, minIndex: number, maxIndex: number) {\r\n\t\t\tsuper();\r\n\t\t\twhile (maxIndex >= minIndex) {\r\n\t\t\t\tconst isNoise: boolean = doc.song.getChannelIsDrum(maxIndex);\r\n\t\t\t\tdoc.song.channels.splice(maxIndex, 1);\r\n\t\t\t\tif (isNoise) {\r\n\t\t\t\t\tdoc.song.drumChannelCount--;\r\n\t\t\t\t} else {\r\n\t\t\t\t\t\tdoc.song.pitchChannelCount--;\r\n\t\t\t\t}\r\n\t\t\t\tmaxIndex--;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (doc.song.pitchChannelCount < Config.pitchChannelCountMin) {\r\n\t\t\t\tthis.append(new ChangeChannelCount(doc, Config.pitchChannelCountMin, doc.song.drumChannelCount));\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.append(new ChangeChannelBar(doc, Math.max(0, minIndex - 1), doc.bar));\r\n\t\t\t\r\n\t\t\tthis._didSomething();\r\n\t\t\tdoc.notifier.changed();\r\n\t\t}\r\n\t}\r\n\r\n\texport class ChangeChannelBar extends Change {\r\n\t\tconstructor(doc: SongDocument, newChannel: number, newBar: number) {\r\n\t\t\tsuper();\r\n\t\t\tconst oldChannel: number = doc.channel;\r\n\t\t\tconst oldBar: number = doc.bar;\r\n\t\t\tdoc.channel = newChannel;\r\n\t\t\tdoc.bar = newBar;\r\n\t\t\tdoc.barScrollPos = Math.min(doc.bar, Math.max(doc.bar - (doc.trackVisibleBars - 1), doc.barScrollPos));\r\n\t\t\tdoc.notifier.changed();\r\n\t\t\tif (oldChannel != newChannel || oldBar != newBar) {\r\n\t\t\t\tthis._didSomething();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeChorus extends Change {\r\n\t\tconstructor(doc: SongDocument, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tconst oldValue: number = doc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].chorus;\r\n\t\t\tif (oldValue != newValue) {\r\n\t\t\t\tthis._didSomething();\r\n\t\t\t\tdoc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].chorus = newValue;\r\n\t\t\t\tdoc.notifier.changed();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeEffect extends Change {\r\n\t\tconstructor(doc: SongDocument, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tconst oldValue: number = doc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].effect;\r\n\t\t\tif (oldValue != newValue) {\r\n\t\t\t\tdoc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].effect = newValue;\r\n\t\t\t\tdoc.notifier.changed();\r\n\t\t\t\tthis._didSomething();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeHarm extends Change {\r\n\t\tconstructor(doc: SongDocument, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tconst oldValue: number = doc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].harm;\r\n\t\t\tif (oldValue != newValue) {\r\n\t\t\t\tdoc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].harm = newValue;\r\n\t\t\t\tdoc.notifier.changed();\r\n\t\t\t\tthis._didSomething();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\texport class ChangeFMChorus extends Change {\r\n\t\tconstructor(doc: SongDocument, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tconst oldValue: number = doc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].fmChorus;\r\n\t\t\tif (oldValue != newValue) {\r\n\t\t\t\tdoc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].fmChorus = newValue;\r\n\t\t\t\tdoc.notifier.changed();\r\n\t\t\t\tthis._didSomething();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeOctoff extends Change {\r\n\t\tconstructor(doc: SongDocument, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tconst oldValue: number = doc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].octoff;\r\n\t\t\tif (oldValue != newValue) {\r\n\t\t\t\tdoc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].octoff = newValue;\r\n\t\t\t\tdoc.notifier.changed();\r\n\t\t\t\tthis._didSomething();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeImute extends Change {\r\n\t\tconstructor(doc: SongDocument, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tconst oldValue: number = doc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].imute;\r\n\t\t\tif (oldValue != newValue) {\r\n\t\t\t\tdoc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].imute = newValue;\r\n\t\t\t\tdoc.notifier.changed();\r\n\t\t\t\tthis._didSomething();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\texport class ChangeAllImute extends Change {\r\n\t\tconstructor(doc: SongDocument, newValue: number, index: number) {\r\n\t\t\tsuper();\r\n\t\t\tconst oldValue: number = doc.song.channels[doc.channel].instruments[index].imute;\r\n\t\t\tif (oldValue != newValue) {\r\n\t\t\t\tdoc.song.channels[doc.channel].instruments[index].imute = newValue;\r\n\t\t\t\tdoc.notifier.changed();\r\n\t\t\t\tthis._didSomething();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\texport class ChangeSoloChannels extends Change {\r\n\t\tconstructor(doc: SongDocument, newValue: number, curChannel: number, curInstrument: number) {\r\n\t\t\tsuper();\r\n\t\t\tconst oldValue: number = doc.song.channels[curChannel].instruments[curInstrument].imute;\r\n\t\t\tif (oldValue != newValue) {\r\n\t\t\t\tdoc.song.channels[curChannel].instruments[curInstrument].imute = newValue;\r\n\t\t\t\tdoc.notifier.changed();\r\n\t\t\t\tthis._didSomething();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeIpan extends Change {\r\n\t\tconstructor(doc: SongDocument, oldValue: number, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tif (oldValue != newValue) {\r\n\t\t\t\tdoc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].ipan = newValue;\r\n\t\t\t\tdoc.notifier.changed();\r\n\t\t\t\tthis._didSomething();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeFilter extends Change {\r\n\t\tconstructor(doc: SongDocument, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tconst oldValue: number = doc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].filter;\r\n\t\t\tif (oldValue != newValue) {\r\n\t\t\t\tdoc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].filter = newValue;\r\n\t\t\t\tdoc.notifier.changed();\r\n\t\t\t\tthis._didSomething();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeAlgorithm extends Change {\r\n\t\tconstructor(doc: SongDocument, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tconst oldValue: number = doc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].algorithm;\r\n\t\t\tif (oldValue != newValue) {\r\n\t\t\t\tdoc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].algorithm = newValue;\r\n\t\t\t\tdoc.notifier.changed();\r\n\t\t\t\tthis._didSomething();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeFeedbackType extends Change {\r\n\t\tconstructor(doc: SongDocument, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tconst oldValue: number = doc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].feedbackType;\r\n\t\t\tif (oldValue != newValue) {\r\n\t\t\t\tdoc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].feedbackType = newValue;\r\n\t\t\t\tdoc.notifier.changed();\r\n\t\t\t\tthis._didSomething();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeFeedbackEnvelope extends Change {\r\n\t\tconstructor(doc: SongDocument, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tconst oldValue: number = doc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].feedbackEnvelope;\r\n\t\t\tif (oldValue != newValue) {\r\n\t\t\t\tdoc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].feedbackEnvelope = newValue;\r\n\t\t\t\tdoc.notifier.changed();\r\n\t\t\t\tthis._didSomething();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeOperatorEnvelope extends Change {\r\n\t\tconstructor(doc: SongDocument, operatorIndex: number, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tconst oldValue: number = doc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].operators[operatorIndex].envelope;\r\n\t\t\tif (oldValue != newValue) {\r\n\t\t\t\tdoc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].operators[operatorIndex].envelope = newValue;\r\n\t\t\t\tdoc.notifier.changed();\r\n\t\t\t\tthis._didSomething();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeOperatorFrequency extends Change {\r\n\t\tconstructor(doc: SongDocument, operatorIndex: number, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tconst oldValue: number = doc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].operators[operatorIndex].frequency;\r\n\t\t\tif (oldValue != newValue) {\r\n\t\t\t\tdoc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].operators[operatorIndex].frequency = newValue;\r\n\t\t\t\tdoc.notifier.changed();\r\n\t\t\t\tthis._didSomething();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeOperatorAmplitude extends Change {\r\n\t\tconstructor(doc: SongDocument, operatorIndex: number, oldValue: number, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tdoc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].operators[operatorIndex].amplitude = newValue;\r\n\t\t\tdoc.notifier.changed();\r\n\t\t\tif (oldValue != newValue) this._didSomething();\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeFeedbackAmplitude extends Change {\r\n\t\tconstructor(doc: SongDocument, oldValue: number, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tdoc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].feedbackAmplitude = newValue;\r\n\t\t\tdoc.notifier.changed();\r\n\t\t\tif (oldValue != newValue) this._didSomething();\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeInstrumentsPerChannel extends Change {\r\n\t\tconstructor(doc: SongDocument, newInstrumentsPerChannel: number) {\r\n\t\t\tsuper();\r\n\t\t\tif (doc.song.instrumentsPerChannel != newInstrumentsPerChannel) {\r\n\t\t\t\tfor (let channel: number = 0; channel < doc.song.getChannelCount(); channel++) {\r\n\t\t\t\t\tconst sampleInstrument: Instrument = doc.song.channels[channel].instruments[doc.song.instrumentsPerChannel - 1];\r\n\t\t\t\t\tfor (let j: number = doc.song.instrumentsPerChannel; j < newInstrumentsPerChannel; j++) {\r\n\t\t\t\t\t\tconst newInstrument: Instrument = new Instrument();\r\n\t\t\t\t\t\tnewInstrument.copy(sampleInstrument);\r\n\t\t\t\t\t\tdoc.song.channels[channel].instruments[j] = newInstrument;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tdoc.song.channels[channel].instruments.length = newInstrumentsPerChannel;\r\n\t\t\t\t\tfor (let j: number = 0; j < doc.song.patternsPerChannel; j++) {\r\n\t\t\t\t\t\tif (doc.song.channels[channel].patterns[j].instrument >= newInstrumentsPerChannel) {\r\n\t\t\t\t\t\t\tdoc.song.channels[channel].patterns[j].instrument = 0;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tdoc.song.instrumentsPerChannel = newInstrumentsPerChannel;\r\n\t\t\t\tdoc.notifier.changed();\r\n\t\t\t\tthis._didSomething();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeKey extends Change {\r\n\t\tconstructor(doc: SongDocument, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tif (doc.song.key != newValue) {\r\n\t\t\t\tdoc.song.key = newValue;\r\n\t\t\t\tdoc.notifier.changed();\r\n\t\t\t\tthis._didSomething();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeSongTheme extends Change {\r\n\t\tconstructor(doc: SongDocument, oldValue: string, newValue: string) {\r\n\t\t\tsuper();\r\n\t\t\tif (newValue.length > 30) {\r\n\t\t\t\tnewValue = newValue.substring(0, 30);\r\n\t\t\t}\r\n\r\n\t\t\tdoc.song.setSongTheme = newValue;\r\n\t\t\tdoc.notifier.changed();\r\n\t\t\tif (oldValue != newValue) this._didSomething();\r\n\t\t}\r\n\t}\r\n\r\n\texport class ChangeLoop extends Change {\r\n\t\tconstructor(private _doc: SongDocument, public oldStart: number, public oldLength: number, public newStart: number, public newLength: number) {\r\n\t\t\tsuper();\r\n\t\t\tthis._doc.song.loopStart = this.newStart;\r\n\t\t\tthis._doc.song.loopLength = this.newLength;\r\n\t\t\tthis._doc.notifier.changed();\r\n\t\t\tif (this.oldStart != this.newStart || this.oldLength != this.newLength) {\r\n\t\t\t\tthis._didSomething();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangePitchAdded extends UndoableChange {\r\n\t\tprivate _doc: SongDocument;\r\n\t\tprivate _note: Note;\r\n\t\tprivate _pitch: number;\r\n\t\tprivate _index: number;\r\n\t\tconstructor(doc: SongDocument, note: Note, pitch: number, index: number, deletion: boolean = false) {\r\n\t\t\tsuper(deletion);\r\n\t\t\tthis._doc = doc;\r\n\t\t\tthis._note = note;\r\n\t\t\tthis._pitch = pitch;\r\n\t\t\tthis._index = index;\r\n\t\t\tthis._didSomething();\r\n\t\t\tthis.redo();\r\n\t\t}\r\n\t\t\r\n\t\tprotected _doForwards(): void {\r\n\t\t\tthis._note.pitches.splice(this._index, 0, this._pitch);\r\n\t\t\tthis._doc.notifier.changed();\r\n\t\t}\r\n\t\t\r\n\t\tprotected _doBackwards(): void {\r\n\t\t\tthis._note.pitches.splice(this._index, 1);\r\n\t\t\tthis._doc.notifier.changed();\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeOctave extends Change {\r\n\t\tconstructor(doc: SongDocument, public oldValue: number, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tdoc.song.channels[doc.channel].octave = newValue;\r\n\t\t\tdoc.notifier.changed();\r\n\t\t\tif (oldValue != newValue) this._didSomething();\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangePartsPerBeat extends ChangeGroup {\r\n\t\tconstructor(doc: SongDocument, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tif (doc.song.partsPerBeat != newValue) {\r\n\t\t\t\tfor (let i: number = 0; i < doc.song.getChannelCount(); i++) {\r\n\t\t\t\t\tfor (let j: number = 0; j < doc.song.channels[i].patterns.length; j++) {\r\n\t\t\t\t\t\tthis.append(new ChangeRhythm(doc, doc.song.channels[i].patterns[j], doc.song.partsPerBeat, newValue));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tdoc.song.partsPerBeat = newValue;\r\n\t\t\t\tdoc.notifier.changed();\r\n\t\t\t\tthis._didSomething();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangePaste extends ChangeGroup {\r\n\t\tconstructor(doc: SongDocument, pattern: Pattern, notes: Note[], newBeatsPerBar: number, newPartsPerBeat: number) {\r\n\t\t\tsuper();\r\n\t\t\tpattern.notes = notes;\r\n\t\t\t\r\n\t\t\tif (doc.song.partsPerBeat != newPartsPerBeat) {\r\n\t\t\t\tthis.append(new ChangeRhythm(doc, pattern, newPartsPerBeat, doc.song.partsPerBeat));\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (doc.song.beatsPerBar != newBeatsPerBar) {\r\n\t\t\t\tthis.append(new ChangeNoteTruncate(doc, pattern, doc.song.beatsPerBar * doc.song.partsPerBeat, newBeatsPerBar * doc.song.partsPerBeat));\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tdoc.notifier.changed();\r\n\t\t\tthis._didSomething();\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangePatternInstrument extends Change {\r\n\t\tconstructor(doc: SongDocument, newValue: number, pattern: Pattern) {\r\n\t\t\tsuper();\r\n\t\t\tif (pattern.instrument != newValue) {\r\n\t\t\t\tpattern.instrument = newValue;\r\n\t\t\t\tdoc.notifier.changed();\r\n\t\t\t\tthis._didSomething();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangePatternsPerChannel extends Change {\r\n\t\tconstructor(doc: SongDocument, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tif (doc.song.patternsPerChannel != newValue) {\r\n\t\t\t\tfor (let i: number = 0; i < doc.song.getChannelCount(); i++) {\r\n\t\t\t\t\tconst channelBars: number[] = doc.song.channels[i].bars;\r\n\t\t\t\t\tconst channelPatterns: Pattern[] = doc.song.channels[i].patterns;\r\n\t\t\t\t\tfor (let j: number = 0; j < channelBars.length; j++) {\r\n\t\t\t\t\t\tif (channelBars[j] > newValue) channelBars[j] = 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfor (let j: number = channelPatterns.length; j < newValue; j++) {\r\n\t\t\t\t\t\tchannelPatterns[j] = new Pattern();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tchannelPatterns.length = newValue;\r\n\t\t\t\t}\r\n\t\t\t\tdoc.song.patternsPerChannel = newValue;\r\n\t\t\t\tdoc.notifier.changed();\r\n\t\t\t\tthis._didSomething();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeEnsurePatternExists extends UndoableChange {\r\n\t\tprivate _doc: SongDocument;\r\n\t\tprivate _bar: number;\r\n\t\tprivate _channel: number;\r\n\t\tprivate _patternIndex: number;\r\n\t\tprivate _patternOldNotes: Note[] | null = null;\r\n\t\tprivate _oldPatternCount: number;\r\n\t\tprivate _newPatternCount: number;\r\n\r\n\t\tconstructor(doc: SongDocument) {\r\n\t\t\tsuper(false);\r\n\t\t\tconst song: Song = doc.song;\r\n\t\t\tif (song.channels[doc.channel].bars[doc.bar] != 0) return;\r\n\r\n\t\t\tthis._doc = doc;\r\n\t\t\tthis._bar = doc.bar;\r\n\t\t\tthis._channel = doc.channel;\r\n\t\t\tthis._oldPatternCount = song.patternsPerChannel;\r\n\t\t\tthis._newPatternCount = song.patternsPerChannel;\r\n\r\n\t\t\tlet firstEmptyUnusedIndex: number | null = null;\r\n\t\t\tlet firstUnusedIndex: number | null = null;\r\n\t\t\tfor (let patternIndex: number = 1; patternIndex <= song.patternsPerChannel; patternIndex++) {\r\n\t\t\t\tlet used = false;\r\n\t\t\t\tfor (let barIndex: number = 0; barIndex < song.barCount; barIndex++) {\r\n\t\t\t\t\tif (song.channels[doc.channel].bars[barIndex] == patternIndex) {\r\n\t\t\t\t\t\tused = true;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (used) continue;\r\n\t\t\t\tif (firstUnusedIndex == null) {\r\n\t\t\t\t\tfirstUnusedIndex = patternIndex;\r\n\t\t\t\t}\r\n\t\t\t\tconst pattern: Pattern = song.channels[doc.channel].patterns[patternIndex - 1];\r\n\t\t\t\tif (pattern.notes.length == 0) {\r\n\t\t\t\t\tfirstEmptyUnusedIndex = patternIndex;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (firstEmptyUnusedIndex != null) {\r\n\t\t\t\tthis._patternIndex = firstEmptyUnusedIndex;\r\n\t\t\t} else if (song.patternsPerChannel < song.barCount) {\r\n\t\t\t\tthis._newPatternCount = song.patternsPerChannel + 1;\r\n\t\t\t\tthis._patternIndex = song.patternsPerChannel + 1;\r\n\t\t\t} else if (firstUnusedIndex != null) {\r\n\t\t\t\tthis._patternIndex = firstUnusedIndex;\r\n\t\t\t\tthis._patternOldNotes = song.channels[doc.channel].patterns[firstUnusedIndex - 1].notes;\r\n\t\t\t} else {\r\n\t\t\t\tthrow new Error();\r\n\t\t\t}\r\n\r\n\t\t\tthis._didSomething();\r\n\t\t\tthis._doForwards();\r\n\t\t}\r\n\r\n\t\tprotected _doForwards(): void {\r\n\t\t\tconst song: Song = this._doc.song;\r\n\t\t\tfor (let j: number = song.patternsPerChannel; j < this._newPatternCount; j++) {\r\n\t\t\t\tfor (let i: number = 0; i < song.getChannelCount(); i++) {\r\n\t\t\t\t\tsong.channels[i].patterns[j] = new Pattern();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tsong.patternsPerChannel = this._newPatternCount;\r\n\t\t\tconst pattern: Pattern = song.channels[this._channel].patterns[this._patternIndex - 1];\r\n\t\t\tpattern.notes = [];\r\n\t\t\tsong.channels[this._channel].bars[this._bar] = this._patternIndex;\r\n\t\t\tthis._doc.notifier.changed();\r\n\t\t}\r\n\r\n\t\tprotected _doBackwards(): void {\r\n\t\t\tconst song: Song = this._doc.song;\r\n\t\t\tconst pattern: Pattern = song.channels[this._channel].patterns[this._patternIndex - 1];\r\n\t\t\tif (this._patternOldNotes != null) pattern.notes = this._patternOldNotes;\r\n\t\t\tsong.channels[this._channel].bars[this._bar] = 0;\r\n\t\t\tfor (let i: number = 0; i < song.getChannelCount(); i++) {\r\n\t\t\t\tsong.channels[i].patterns.length = this._oldPatternCount;\r\n\t\t\t}\r\n\t\t\tsong.patternsPerChannel = this._oldPatternCount;\r\n\t\t\tthis._doc.notifier.changed();\r\n\t\t}\r\n\t}\r\n\r\n\texport class ChangePinTime extends ChangePins {\r\n\t\tconstructor(doc: SongDocument, note: Note, pinIndex: number, shiftedTime: number) {\r\n\t\t\tsuper(doc, note);\r\n\t\t\t\r\n\t\t\tshiftedTime -= this._oldStart;\r\n\t\t\tconst originalTime: number = this._oldPins[pinIndex].time;\r\n\t\t\tconst skipStart: number = Math.min(originalTime, shiftedTime);\r\n\t\t\tconst skipEnd: number = Math.max(originalTime, shiftedTime);\r\n\t\t\tlet setPin: boolean = false;\r\n\t\t\tfor (let i: number = 0; i < this._oldPins.length; i++) {\r\n\t\t\t\tconst oldPin: NotePin = note.pins[i];\r\n\t\t\t\tconst time: number = oldPin.time;\r\n\t\t\t\tif (time < skipStart) {\r\n\t\t\t\t\tthis._newPins.push(makeNotePin(oldPin.interval, time, oldPin.volume));\r\n\t\t\t\t} else if (time > skipEnd) {\r\n\t\t\t\t\tif (!setPin) {\r\n\t\t\t\t\t\tthis._newPins.push(makeNotePin(this._oldPins[pinIndex].interval, shiftedTime, this._oldPins[pinIndex].volume));\r\n\t\t\t\t\t\tsetPin = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis._newPins.push(makeNotePin(oldPin.interval, time, oldPin.volume));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (!setPin) {\r\n\t\t\t\tthis._newPins.push(makeNotePin(this._oldPins[pinIndex].interval, shiftedTime, this._oldPins[pinIndex].volume));\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._finishSetup();\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangePitchBend extends ChangePins {\r\n\t\tconstructor(doc: SongDocument, note: Note, bendStart: number, bendEnd: number, bendTo: number, pitchIndex: number) {\r\n\t\t\tsuper(doc, note);\r\n\t\t\t\r\n\t\t\tbendStart -= this._oldStart;\r\n\t\t\tbendEnd   -= this._oldStart;\r\n\t\t\tbendTo    -= note.pitches[pitchIndex];\r\n\t\t\t\r\n\t\t\tlet setStart: boolean = false;\r\n\t\t\tlet setEnd: boolean   = false;\r\n\t\t\tlet prevInterval: number = 0;\r\n\t\t\tlet prevVolume: number = 3;\r\n\t\t\tlet persist: boolean = true;\r\n\t\t\tlet i: number;\r\n\t\t\tlet direction: number;\r\n\t\t\tlet stop: number;\r\n\t\t\tlet push: (item: NotePin)=>void;\r\n\t\t\tif (bendEnd > bendStart) {\r\n\t\t\t\ti = 0;\r\n\t\t\t\tdirection = 1;\r\n\t\t\t\tstop = note.pins.length;\r\n\t\t\t\tpush = (item: NotePin)=>{ this._newPins.push(item); };\r\n\t\t\t} else {\r\n\t\t\t\ti = note.pins.length - 1;\r\n\t\t\t\tdirection = -1;\r\n\t\t\t\tstop = -1;\r\n\t\t\t\tpush = (item: NotePin)=>{ this._newPins.unshift(item); };\r\n\t\t\t}\r\n\t\t\tfor (; i != stop; i += direction) {\r\n\t\t\t\tconst oldPin: NotePin = note.pins[i];\r\n\t\t\t\tconst time: number = oldPin.time;\r\n\t\t\t\tfor (;;) {\r\n\t\t\t\t\tif (!setStart) {\r\n\t\t\t\t\t\tif (time * direction <= bendStart * direction) {\r\n\t\t\t\t\t\t\tprevInterval = oldPin.interval;\r\n\t\t\t\t\t\t\tprevVolume = oldPin.volume;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (time * direction < bendStart * direction) {\r\n\t\t\t\t\t\t\tpush(makeNotePin(oldPin.interval, time, oldPin.volume));\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tpush(makeNotePin(prevInterval, bendStart, prevVolume));\r\n\t\t\t\t\t\t\tsetStart = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if (!setEnd) {\r\n\t\t\t\t\t\tif (time * direction <= bendEnd * direction) {\r\n\t\t\t\t\t\t\tprevInterval = oldPin.interval;\r\n\t\t\t\t\t\t\tprevVolume = oldPin.volume;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (time * direction < bendEnd * direction) {\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tpush(makeNotePin(bendTo, bendEnd, prevVolume));\r\n\t\t\t\t\t\t\tsetEnd = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (time * direction == bendEnd * direction) {\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tif (oldPin.interval != prevInterval) persist = false;\r\n\t\t\t\t\t\t\tpush(makeNotePin(persist ? bendTo : oldPin.interval, time, oldPin.volume));\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (!setEnd) {\r\n\t\t\t\tpush(makeNotePin(bendTo, bendEnd, prevVolume));\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._finishSetup();\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeRhythm extends ChangeSequence {\r\n\t\tconstructor(doc: SongDocument, bar: Pattern, oldPartsPerBeat: number, newPartsPerBeat: number) {\r\n\t\t\tsuper();\r\n\t\t\tlet changeRhythm: (oldTime:number)=>number;\r\n\t\t\t\r\n\t\t\tif (oldPartsPerBeat > newPartsPerBeat) {\r\n\t\t\t\tchangeRhythm = (oldTime: number)=> Math.ceil(oldTime * newPartsPerBeat / oldPartsPerBeat);\r\n\t\t\t} else if (oldPartsPerBeat < newPartsPerBeat) {\r\n\t\t\t\tchangeRhythm = (oldTime: number)=> Math.floor(oldTime * newPartsPerBeat / oldPartsPerBeat);\r\n\t\t\t} else {\r\n\t\t\t\tthrow new Error(\"ChangeRhythm couldn't handle rhythm change from \" + oldPartsPerBeat + \" to \" + newPartsPerBeat + \".\");\r\n\t\t\t}\r\n\t\t\tlet i: number = 0;\r\n\t\t\twhile (i < bar.notes.length) {\r\n\t\t\t\tconst note: Note = bar.notes[i];\r\n\t\t\t\tif (changeRhythm(note.start) >= changeRhythm(note.end)) {\r\n\t\t\t\t\tthis.append(new ChangeNoteAdded(doc, bar, note, i, true));\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.append(new ChangeRhythmNote(doc, note, changeRhythm));\r\n\t\t\t\t\ti++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeRhythmNote extends ChangePins {\r\n\t\tconstructor(doc: SongDocument, note: Note, changeRhythm: (oldTime:number)=>number) {\r\n\t\t\tsuper(doc, note);\r\n\t\t\t\r\n\t\t\tfor (const oldPin of this._oldPins) {\r\n\t\t\t\tthis._newPins.push(makeNotePin(oldPin.interval, changeRhythm(oldPin.time + this._oldStart) - this._oldStart, oldPin.volume));\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._finishSetup();\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeScale extends Change {\r\n\t\tconstructor(doc: SongDocument, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tif (doc.song.scale != newValue) {\r\n\t\t\t\tdoc.song.scale = newValue;\r\n\t\t\t\tdoc.notifier.changed();\r\n\t\t\t\tthis._didSomething();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeMix extends Change {\r\n\t\tconstructor(doc: SongDocument, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tif (doc.song.mix != newValue) {\r\n\t\t\t\tdoc.song.mix = newValue;\r\n\t\t\t\tdoc.notifier.changed();\r\n\t\t\t\tthis._didSomething();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeSampleRate extends Change {\r\n\t\tconstructor(doc: SongDocument, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tif (doc.song.sampleRate != newValue) {\r\n\t\t\t\tdoc.song.sampleRate = newValue;\r\n\t\t\t\tdoc.notifier.changed();\r\n\t\t\t\tthis._didSomething();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeSong extends Change {\r\n\t\tconstructor(doc: SongDocument, newHash: string) {\r\n\t\t\tsuper();\r\n\t\t\tdoc.song.fromBase64String(newHash);\r\n\t\t\tdoc.channel = Math.min(doc.channel, doc.song.getChannelCount() - 1);\r\n\t\t\tdoc.bar = Math.max(0, Math.min(doc.song.barCount - 1, doc.bar));\r\n\t\t\tdoc.barScrollPos = Math.max(0, Math.min(doc.song.barCount - doc.trackVisibleBars, doc.barScrollPos));\r\n\t\t\tdoc.barScrollPos = Math.min(doc.bar, Math.max(doc.bar - (doc.trackVisibleBars - 1), doc.barScrollPos));\r\n\t\t\tdoc.notifier.changed();\r\n\t\t\tthis._didSomething();\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeTempo extends Change {\r\n\t\tconstructor(doc: SongDocument, oldValue: number, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tdoc.song.tempo = newValue;\r\n\t\t\tdoc.notifier.changed();\r\n\t\t\tif (oldValue != newValue) this._didSomething();\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeReverb extends Change {\r\n\t\tconstructor(doc: SongDocument, oldValue: number, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tdoc.song.reverb = newValue;\r\n\t\t\tdoc.notifier.changed();\r\n\t\t\tif (oldValue != newValue) this._didSomething();\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeBlend extends Change {\r\n\t\tconstructor(doc: SongDocument, oldValue: number, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tdoc.song.blend = newValue;\r\n\t\t\tdoc.notifier.changed();\r\n\t\t\tif (oldValue != newValue) this._didSomething();\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeRiff extends Change {\r\n\t\tconstructor(doc: SongDocument, oldValue: number, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tdoc.song.riff = newValue;\r\n\t\t\tdoc.notifier.changed();\r\n\t\t\tif (oldValue != newValue) this._didSomething();\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeDetune extends Change {\r\n\t\tconstructor(doc: SongDocument, oldValue: number, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tdoc.song.detune = newValue;\r\n\t\t\tdoc.notifier.changed();\r\n\t\t\tif (oldValue != newValue) this._didSomething();\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeMuff extends Change {\r\n\t\tconstructor(doc: SongDocument, oldValue: number, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tdoc.song.muff = newValue;\r\n\t\t\tdoc.notifier.changed();\r\n\t\t\tif (oldValue != newValue) this._didSomething();\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeNoteAdded extends UndoableChange {\r\n\t\tprivate _doc: SongDocument;\r\n\t\tprivate _pattern: Pattern;\r\n\t\tprivate _note: Note;\r\n\t\tprivate _index: number;\r\n\t\tconstructor(doc: SongDocument, pattern: Pattern, note: Note, index: number, deletion: boolean = false) {\r\n\t\t\tsuper(deletion);\r\n\t\t\tthis._doc = doc;\r\n\t\t\tthis._pattern = pattern;\r\n\t\t\tthis._note = note;\r\n\t\t\tthis._index = index;\r\n\t\t\tthis._didSomething();\r\n\t\t\tthis.redo();\r\n\t\t}\r\n\t\t\r\n\t\tprotected _doForwards(): void {\r\n\t\t\tthis._pattern.notes.splice(this._index, 0, this._note);\r\n\t\t\tthis._doc.notifier.changed();\r\n\t\t}\r\n\t\t\r\n\t\tprotected _doBackwards(): void {\r\n\t\t\tthis._pattern.notes.splice(this._index, 1);\r\n\t\t\tthis._doc.notifier.changed();\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeNoteLength extends ChangePins {\r\n\t\tconstructor(doc: SongDocument, note: Note, truncStart: number, truncEnd: number) {\r\n\t\t\tsuper(doc, note);\r\n\t\t\t\r\n\t\t\ttruncStart -= this._oldStart;\r\n\t\t\ttruncEnd   -= this._oldStart;\r\n\t\t\tlet setStart: boolean = false;\r\n\t\t\tlet prevVolume: number = this._oldPins[0].volume;\r\n\t\t\tlet prevInterval: number = this._oldPins[0].interval;\r\n\t\t\tlet pushLastPin: boolean = true;\r\n\t\t\tlet i: number;\r\n\t\t\tfor (i = 0; i < this._oldPins.length; i++) {\r\n\t\t\t\tconst oldPin: NotePin = this._oldPins[i];\r\n\t\t\t\tif (oldPin.time < truncStart) {\r\n\t\t\t\t\tprevVolume = oldPin.volume;\r\n\t\t\t\t\tprevInterval = oldPin.interval;\r\n\t\t\t\t} else if (oldPin.time <= truncEnd) {\r\n\t\t\t\t\tif (oldPin.time > truncStart && !setStart) {\r\n\t\t\t\t\t\tthis._newPins.push(makeNotePin(prevInterval, truncStart, prevVolume));\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis._newPins.push(makeNotePin(oldPin.interval, oldPin.time, oldPin.volume));\r\n\t\t\t\t\tsetStart = true;\r\n\t\t\t\t\tif (oldPin.time == truncEnd) {\r\n\t\t\t\t\t\tpushLastPin = false;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t} \r\n\t\t\t\t\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (pushLastPin) this._newPins.push(makeNotePin(this._oldPins[i].interval, truncEnd, this._oldPins[i].volume));\r\n\t\t\t\r\n\t\t\tthis._finishSetup();\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeNoteTruncate extends ChangeSequence {\r\n\t\tconstructor(doc: SongDocument, pattern: Pattern, start: number, end: number, skipNote?: Note) {\r\n\t\t\tsuper();\r\n\t\t\tlet i: number = 0;\r\n\t\t\twhile (i < pattern.notes.length) {\r\n\t\t\t\tconst note: Note = pattern.notes[i];\r\n\t\t\t\tif (note == skipNote && skipNote != undefined) {\r\n\t\t\t\t\ti++;\r\n\t\t\t\t} else if (note.end <= start) {\r\n\t\t\t\t\ti++;\r\n\t\t\t\t} else if (note.start >= end) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t} else if (note.start < start) {\r\n\t\t\t\t\tthis.append(new ChangeNoteLength(doc, note, note.start, start));\r\n\t\t\t\t\ti++;\r\n\t\t\t\t} else if (note.end > end) {\r\n\t\t\t\t\tthis.append(new ChangeNoteLength(doc, note, end, note.end));\r\n\t\t\t\t\ti++;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.append(new ChangeNoteAdded(doc, pattern, note, i, true));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeTransposeNote extends UndoableChange {\r\n\t\tprotected _doc: SongDocument;\r\n\t\tprotected _note: Note;\r\n\t\tprotected _oldStart: number;\r\n\t\tprotected _newStart: number;\r\n\t\tprotected _oldEnd: number;\r\n\t\tprotected _newEnd: number;\r\n\t\tprotected _oldPins: NotePin[];\r\n\t\tprotected _newPins: NotePin[];\r\n\t\tprotected _oldPitches: number[];\r\n\t\tprotected _newPitches: number[];\r\n\t\tconstructor(doc: SongDocument, note: Note, upward: boolean) {\r\n\t\t\tsuper(false);\r\n\t\t\tthis._doc = doc;\r\n\t\t\tthis._note = note;\r\n\t\t\tthis._oldPins = note.pins;\r\n\t\t\tthis._newPins = [];\r\n\t\t\tthis._oldPitches = note.pitches;\r\n\t\t\tthis._newPitches = [];\r\n\t\t\t\r\n\t\t\tconst maxPitch: number = (doc.song.getChannelIsDrum(doc.channel) ? Config.drumCount - 1 : Config.maxPitch);\r\n\t\t\t\r\n\t\t\tfor (let i: number = 0; i < this._oldPitches.length; i++) {\r\n\t\t\t\tlet pitch: number = this._oldPitches[i];\r\n\t\t\t\tif (upward) {\r\n\t\t\t\t\tfor (let j: number = pitch + 1; j <= maxPitch; j++) {\r\n\t\t\t\t\t\tif (doc.song.getChannelIsDrum(doc.channel) || Config.scales[doc.song.scale].flags[j%12]) {\r\n\t\t\t\t\t\t\tpitch = j;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfor (let j: number = pitch - 1; j >= 0; j--) {\r\n\t\t\t\t\t\tif (doc.song.getChannelIsDrum(doc.channel) || Config.scales[doc.song.scale].flags[j%12]) {\r\n\t\t\t\t\t\t\tpitch = j;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tlet foundMatch: boolean = false;\r\n\t\t\t\tfor (let j: number = 0; j < this._newPitches.length; j++) {\r\n\t\t\t\t\tif (this._newPitches[j] == pitch) {\r\n\t\t\t\t\t\tfoundMatch = true;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (!foundMatch) this._newPitches.push(pitch);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tlet min: number = 0;\r\n\t\t\tlet max: number = maxPitch;\r\n\t\t\t\r\n\t\t\tfor (let i: number = 1; i < this._newPitches.length; i++) {\r\n\t\t\t\tconst diff: number = this._newPitches[0] - this._newPitches[i];\r\n\t\t\t\tif (min < diff) min = diff;\r\n\t\t\t\tif (max > diff + maxPitch) max = diff + maxPitch;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tfor (const oldPin of this._oldPins) {\r\n\t\t\t\tlet interval: number = oldPin.interval + this._oldPitches[0];\r\n\t\t\t\t\r\n\t\t\t\tif (interval < min) interval = min;\r\n\t\t\t\tif (interval > max) interval = max;\r\n\t\t\t\tif (upward) {\r\n\t\t\t\t\tfor (let i: number = interval + 1; i <= max; i++) {\r\n\t\t\t\t\t\tif (doc.song.getChannelIsDrum(doc.channel) || Config.scales[doc.song.scale].flags[i%12]) {\r\n\t\t\t\t\t\t\tinterval = i;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tfor (let i: number = interval - 1; i >= min; i--) {\r\n\t\t\t\t\t\tif (doc.song.getChannelIsDrum(doc.channel) || Config.scales[doc.song.scale].flags[i%12]) {\r\n\t\t\t\t\t\t\tinterval = i;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tinterval -= this._newPitches[0];\r\n\t\t\t\tthis._newPins.push(makeNotePin(interval, oldPin.time, oldPin.volume));\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (this._newPins[0].interval != 0) throw new Error(\"wrong pin start interval\");\r\n\t\t\t\r\n\t\t\tfor (let i: number = 1; i < this._newPins.length - 1; ) {\r\n\t\t\t\tif (this._newPins[i-1].interval == this._newPins[i].interval && \r\n\t\t\t\t    this._newPins[i].interval == this._newPins[i+1].interval && \r\n\t\t\t\t    this._newPins[i-1].volume == this._newPins[i].volume && \r\n\t\t\t\t    this._newPins[i].volume == this._newPins[i+1].volume)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis._newPins.splice(i, 1);\r\n\t\t\t\t} else {\r\n\t\t\t\t\ti++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._doForwards();\r\n\t\t\tthis._didSomething();\r\n\t\t}\r\n\t\t\r\n\t\tprotected _doForwards(): void {\r\n\t\t\tthis._note.pins = this._newPins;\r\n\t\t\tthis._note.pitches = this._newPitches;\r\n\t\t\tthis._doc.notifier.changed();\r\n\t\t}\r\n\t\t\r\n\t\tprotected _doBackwards(): void {\r\n\t\t\tthis._note.pins = this._oldPins;\r\n\t\t\tthis._note.pitches = this._oldPitches;\r\n\t\t\tthis._doc.notifier.changed();\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeTranspose extends ChangeSequence {\r\n\t\tconstructor(doc: SongDocument, pattern: Pattern, upward: boolean) {\r\n\t\t\tsuper();\r\n\t\t\tfor (let i: number = 0; i < pattern.notes.length; i++) {\r\n\t\t\t\tthis.append(new ChangeTransposeNote(doc, pattern.notes[i], upward));\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeVolume extends Change {\r\n\t\tconstructor(doc: SongDocument, oldValue: number, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tdoc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].volume = newValue;\r\n\t\t\tdoc.notifier.changed();\r\n\t\t\tif (oldValue != newValue) this._didSomething();\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeVolumeBend extends UndoableChange {\r\n\t\tprivate _doc: SongDocument;\r\n\t\tprivate _note: Note;\r\n\t\tprivate _oldPins: NotePin[];\r\n\t\tprivate _newPins: NotePin[];\r\n\t\tconstructor(doc: SongDocument, note: Note, bendPart: number, bendVolume: number, bendInterval: number) {\r\n\t\t\tsuper(false);\r\n\t\t\tthis._doc = doc;\r\n\t\t\tthis._note = note;\r\n\t\t\tthis._oldPins = note.pins;\r\n\t\t\tthis._newPins = [];\r\n\t\t\t\r\n\t\t\tlet inserted: boolean = false;\r\n\t\t\t\r\n\t\t\tfor (const pin of note.pins) {\r\n\t\t\t\tif (pin.time < bendPart) {\r\n\t\t\t\t\tthis._newPins.push(pin);\r\n\t\t\t\t} else if (pin.time == bendPart) {\r\n\t\t\t\t\tthis._newPins.push(makeNotePin(bendInterval, bendPart, bendVolume));\r\n\t\t\t\t\tinserted = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (!inserted) {\r\n\t\t\t\t\t\tthis._newPins.push(makeNotePin(bendInterval, bendPart, bendVolume));\r\n\t\t\t\t\t\tinserted = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis._newPins.push(pin);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tfor (let i: number = 1; i < this._newPins.length - 1; ) {\r\n\t\t\t\tif (this._newPins[i-1].interval == this._newPins[i].interval && \r\n\t\t\t\t    this._newPins[i].interval == this._newPins[i+1].interval && \r\n\t\t\t\t    this._newPins[i-1].volume == this._newPins[i].volume && \r\n\t\t\t\t    this._newPins[i].volume == this._newPins[i+1].volume)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis._newPins.splice(i, 1);\r\n\t\t\t\t} else {\r\n\t\t\t\t\ti++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._doForwards();\r\n\t\t\tthis._didSomething();\r\n\t\t}\r\n\t\t\r\n\t\tprotected _doForwards(): void {\r\n\t\t\tthis._note.pins = this._newPins;\r\n\t\t\tthis._doc.notifier.changed();\r\n\t\t}\r\n\t\t\r\n\t\tprotected _doBackwards(): void {\r\n\t\t\tthis._note.pins = this._oldPins;\r\n\t\t\tthis._doc.notifier.changed();\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class ChangeWave extends Change {\r\n\t\tconstructor(doc: SongDocument, newValue: number) {\r\n\t\t\tsuper();\r\n\t\t\tif (doc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].wave != newValue) {\r\n\t\t\t\tdoc.song.channels[doc.channel].instruments[doc.getCurrentInstrument()].wave = newValue;\r\n\t\t\t\tdoc.notifier.changed();\r\n\t\t\t\tthis._didSomething();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n","// Copyright (c) 2012-2022 John Nesky and contributing authors, distributed under the MIT license, see accompanying the LICENSE.md file.\r\n\r\nimport { HTML } from \"imperative-html/dist/esm/elements-strict\";\r\nimport {DictionaryArray, BeepBoxOption, toNameMap} from \"../synth/SynthConfig\";\r\nimport { Song } from \"../synth/song\";\r\n\r\nexport interface ChannelColors extends BeepBoxOption {\r\n    readonly secondaryChannel: string;\r\n    readonly primaryChannel: string;\r\n    readonly secondaryNote: string;\r\n    readonly primaryNote: string;\r\n}\r\n\r\n\r\nexport class ColorConfig {\r\n\tpublic static colorLookup: Map<number, ChannelColors> = new Map<number, ChannelColors>();\r\n\tpublic static usesPianoScheme: boolean = false;\r\n\tprivate static readonly _themeMap: {[K: string]: string} = {\r\n\t\t\"default\": `\r\n            :root {\r\n\t\t\t\t--page-margin: black;\r\n\t\t\t\t--editor-background: black;\r\n\t\t\t\t--hover-preview: white;\r\n\t\t\t\t--playhead: white;\r\n\t\t\t\t--primary-text: white;\r\n\t\t\t\t--secondary-text: #999;\r\n\t\t\t\t--inverted-text: black;\r\n\t\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t\t--loop-accent: #9900cc;\r\n\t\t\t\t--link-accent: #98f;\r\n\t\t\t\t--ui-widget-background: #363636;\r\n\t\t\t\t--ui-widget-focus: #777;\r\n\t\t\t\t--pitch-background: #444;\r\n\t\t\t\t--tonic: #864;\r\n\t\t\t\t--fifth-note: #468;\r\n                --volume-icon: #777777;\r\n\t\t\t\t--octave-scrollbar: #444;\r\n\t\t\t\t--scrollbar-octave: #864;\r\n\t\t\t\t--channel-box: #444;\r\n\r\n\t\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t\t--pitch10-primary-note:     #d85d00;\r\n\r\n\t\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\r\n\t\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t\t--pitch12-primary-note:     #c26afc;\r\n\r\n\t\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t\t--noise4-primary-note:      #a5ff00;\r\n            }\r\n        `,\r\n\t\t\"nepbox\": `\r\n            :root {\r\n\t\t\t\t--page-margin: black;\r\n\t\t\t\t--editor-background: black;\r\n\t\t\t\t--hover-preview: white;\r\n\t\t\t\t--playhead: white;\r\n\t\t\t\t--primary-text: #00fff5;\r\n\t\t\t\t--secondary-text: #999;\r\n\t\t\t\t--inverted-text: black;\r\n\t\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t\t--loop-accent: #00fff5;\r\n\t\t\t\t--link-accent: #98f;\r\n\t\t\t\t--ui-widget-background: #363636;\r\n\t\t\t\t--ui-widget-focus: #777;\r\n\t\t\t\t--pitch-background: #0a2d44;\r\n\t\t\t\t--tonic: #9150ff;\r\n\t\t\t\t--fifth-note: #990000;\r\n                --volume-icon: #00fff5;\r\n\t\t\t\t--octave-scrollbar: #484848;\r\n\t\t\t\t--scrollbar-octave: #9150ff;\r\n\t\t\t\t--channel-box: #444;\r\n\r\n\t\t\t\t--pitch1-secondary-channel: #c13cbf;\r\n\t\t\t\t--pitch1-primary-channel: #f75dff;\r\n\t\t\t\t--pitch1-secondary-note: #b930a2;\r\n\t\t\t\t--pitch1-primary-note: #fca5ff;\r\n\t\t\t\t--pitch2-secondary-channel: #800000;\r\n\t\t\t\t--pitch2-primary-channel: #f00;\r\n\t\t\t\t--pitch2-secondary-note: #8c2121;\r\n\t\t\t\t--pitch2-primary-note: #ff5252;\r\n\t\t\t\t--pitch3-secondary-channel: #004bb3;\r\n\t\t\t\t--pitch3-primary-channel: #1792ff;\r\n\t\t\t\t--pitch3-secondary-note: #005cb3;\r\n\t\t\t\t--pitch3-primary-note: #00ffe9;\r\n\t\t\t\t--pitch4-secondary-channel: #a48800;\r\n\t\t\t\t--pitch4-primary-channel: #fb0;\r\n\t\t\t\t--pitch4-secondary-note: #9c4100;\r\n\t\t\t\t--pitch4-primary-note: #ffd84e;\r\n\t\t\t\t--pitch5-secondary-channel: #6c0000;\r\n\t\t\t\t--pitch5-primary-channel:   #ff3e3e;\r\n\t\t\t\t--pitch5-secondary-note:    #6c0000;\r\n\t\t\t\t--pitch5-primary-note:      #ff3e3e;\r\n\t\t\t\t--pitch6-secondary-channel:#d25a00;\r\n\t\t\t\t--pitch6-primary-channel:  #fdff00;\r\n\t\t\t\t--pitch6-secondary-note:   #d25a00;\r\n\t\t\t\t--pitch6-primary-note:     #fdff00;\r\n\t\t\t\t--pitch7-secondary-channel: #046000;\r\n\t\t\t\t--pitch7-primary-channel:   #0c79ff;\r\n\t\t\t\t--pitch7-secondary-note:    #046000;\r\n\t\t\t\t--pitch7-primary-note:      #0c79ff;\r\n\t\t\t\t--pitch8-secondary-channel:#3b2bae;\r\n\t\t\t\t--pitch8-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch8-secondary-note:   #3b2bae;\r\n\t\t\t\t--pitch8-primary-note:     #d85d00;\r\n\t\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t\t--pitch10-primary-note:     #d85d00;\r\n\t\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\t\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t\t--pitch12-primary-note:     #c26afc;\r\n\t\t\t\t--noise1-secondary-channel: #868686;\r\n\t\t\t\t--noise1-primary-channel: #fff;\r\n\t\t\t\t--noise1-secondary-note: #868686;\r\n\t\t\t\t--noise1-primary-note: #fff;\r\n\t\t\t\t--noise2-secondary-channel: #805300;\r\n\t\t\t\t--noise2-primary-channel: #ff8c00;\r\n\t\t\t\t--noise2-secondary-note: #6a3500;\r\n\t\t\t\t--noise2-primary-note: #a85400;\r\n\t\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t\t--noise4-primary-note:      #a5ff00;\r\n            }\r\n        `,\r\n\t\t\"laffey\": `\r\n\t\t\t:root {\r\n\t\t\t\t--page-margin: #000;\r\n\t\t\t\t--editor-background: #060606;\r\n\t\t\t\t--hover-preview: #fff;\r\n\t\t\t\t--playhead: rgb(0, 242, 255);\r\n\t\t\t\t--primary-text: #00fff5;\r\n\t\t\t\t--secondary-text: #a82f2f;\r\n\t\t\t\t--inverted-text: #000;\r\n\t\t\t\t--text-selection: rgba(98, 46, 164, .99);\r\n\t\t\t\t--box-selection-fill: #b74a4a;\r\n\r\n\t\t\t\t--loop-accent: #7744FF;\r\n\r\n\t\t\t\t--link-accent: #ff00e1;\r\n\t\t\t\t--ui-widget-background: #484848;\r\n\t\t\t\t--ui-widget-focus: #3e3e3e;\r\n\t\t\t\t--pitch-background: #444444;\r\n\r\n\t\t\t\t--tonic: #dbbeed;\r\n\t\t\t\t--pitch1-background: #1a2182; \r\n\t\t\t\t--pitch2-background: #1a2182; \r\n\t\t\t\t--pitch3-background: #1a2182; \r\n\t\t\t\t--pitch4-background: #1a2182;\r\n\t\t\t\t--pitch5-background: #1a2182; \r\n\t\t\t\t--pitch6-background: #1a2182; \r\n\t\t\t\t--fifth-note: #6b1313;\r\n\t\t\t\t--pitch8-background: #1a2182; \r\n\t\t\t\t--pitch9-background: #1a2182; \r\n\t\t\t\t--pitch10-background: #1a2182; \r\n\t\t\t\t--pitch11-background: #1a2182;\r\n\t\t\t\t--octave-scrollbar: #852929;\r\n\t\t\t\t--scrollbar-octave: #f2b3ff;\r\n\r\n\t\t\t\t--white-piano-key: #bababa;\r\n\t\t\t\t--black-piano-key: #444444;\r\n\r\n\t\t\t\t--noise-channel-limit: 2;\r\n\t\t\t\t--pitch1-secondary-channel: #c13cbf;\r\n\t\t\t\t--pitch1-primary-channel: #f75dff;\r\n\t\t\t\t--pitch1-secondary-note: #b930a2;\r\n\t\t\t\t--pitch1-primary-note: #fca5ff;\r\n\t\t\t\t--pitch2-secondary-channel: #800000;\r\n\t\t\t\t--pitch2-primary-channel: #f00;\r\n\t\t\t\t--pitch2-secondary-note: #8c2121;\r\n\t\t\t\t--pitch2-primary-note: #ff5252;\r\n\t\t\t\t--pitch3-secondary-channel: #004bb3;\r\n\t\t\t\t--pitch3-primary-channel: #1792ff;\r\n\t\t\t\t--pitch3-secondary-note: #005cb3;\r\n\t\t\t\t--pitch3-primary-note: #00ffe9;\r\n\t\t\t\t--pitch4-secondary-channel: #a48800;\r\n\t\t\t\t--pitch4-primary-channel: #fb0;\r\n\t\t\t\t--pitch4-secondary-note: #9c4100;\r\n\t\t\t\t--pitch4-primary-note: #ffd84e;\r\n\t\t\t\t--pitch5-secondary-channel: #6c0000;\r\n\t\t\t\t--pitch5-primary-channel:   #ff3e3e;\r\n\t\t\t\t--pitch5-secondary-note:    #6c0000;\r\n\t\t\t\t--pitch5-primary-note:      #ff3e3e;\r\n\t\t\t\t--pitch6-secondary-channel:#d25a00;\r\n\t\t\t\t--pitch6-primary-channel:  #fdff00;\r\n\t\t\t\t--pitch6-secondary-note:   #d25a00;\r\n\t\t\t\t--pitch6-primary-note:     #fdff00;\r\n\t\t\t\t--pitch7-secondary-channel: #046000;\r\n\t\t\t\t--pitch7-primary-channel:   #0c79ff;\r\n\t\t\t\t--pitch7-secondary-note:    #046000;\r\n\t\t\t\t--pitch7-primary-note:      #0c79ff;\r\n\t\t\t\t--pitch8-secondary-channel:#3b2bae;\r\n\t\t\t\t--pitch8-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch8-secondary-note:   #3b2bae;\r\n\t\t\t\t--pitch8-primary-note:     #d85d00;\r\n\t\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t\t--pitch10-primary-note:     #d85d00;\r\n\t\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\t\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t\t--pitch12-primary-note:     #c26afc;\r\n\t\t\t\t--noise1-secondary-channel: #868686;\r\n\t\t\t\t--noise1-primary-channel: #fff;\r\n\t\t\t\t--noise1-secondary-note: #868686;\r\n\t\t\t\t--noise1-primary-note: #fff;\r\n\t\t\t\t--noise2-secondary-channel: #805300;\r\n\t\t\t\t--noise2-primary-channel: #ff8c00;\r\n\t\t\t\t--noise2-secondary-note: #6a3500;\r\n\t\t\t\t--noise2-primary-note: #a85400;\r\n\t\t\t\t--noise3-secondary-channel: #868686;\r\n\t\t\t\t--noise3-primary-channel: #fff;\r\n\t\t\t\t--noise3-secondary-note: #868686;\r\n\t\t\t\t--noise3-primary-note: #fff;\r\n\t\t\t\t--noise4-secondary-channel: #805300;\r\n\t\t\t\t--noise4-primary-channel: #ff8c00;\r\n\t\t\t\t--noise4-secondary-note: #6a3500;\r\n\t\t\t\t--noise4-primary-note: #a85400;\r\n\t\t\t\t}\r\n\t\t\t`,\r\n\t\t\"modbox2\": `\r\n            :root {\r\n                --page-margin: black;\r\n\t\t\t\t--editor-background: black;\r\n\t\t\t\t--hover-preview: white;\r\n\t\t\t\t--playhead: white;\r\n\t\t\t\t--primary-text: white;\r\n\t\t\t\t--secondary-text: #999;\r\n\t\t\t\t--inverted-text: black;\r\n\t\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t\t--loop-accent: #00ff00;\r\n\t\t\t\t--link-accent: #98f;\r\n\t\t\t\t--ui-widget-background: #363636;\r\n\t\t\t\t--ui-widget-focus: #777;\r\n\t\t\t\t--pitch-background: #444;\r\n\t\t\t\t--tonic: #c4ffa3;\r\n\t\t\t\t--fifth-note: #96fffb;\r\n                --volume-icon: #c4ffa3;\r\n\t\t\t\t--octave-scrollbar: #00ff00;\r\n\t\t\t\t--scrollbar-octave: #fff;\r\n\t\t\t\t--channel-box: #444;\r\n\r\n\t\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t\t--pitch10-primary-note:     #d85d00;\r\n\r\n\t\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\r\n\t\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t\t--pitch12-primary-note:     #c26afc;\r\n\r\n\t\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t\t--noise4-primary-note:      #a5ff00;\r\n            }\r\n\t\t`,\r\n\t\t\"artic\": `\r\n\t\t:root {\r\n\t\t\t\t--page-margin: black;\r\n\t\t\t\t--editor-background: black;\r\n\t\t\t\t--hover-preview: white;\r\n\t\t\t\t--playhead: white;\r\n\t\t\t\t--primary-text: white;\r\n\t\t\t\t--secondary-text: #999;\r\n\t\t\t\t--inverted-text: black;\r\n\t\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t\t--loop-accent: #ffffff;\r\n\t\t\t\t--link-accent: #98f;\r\n\t\t\t\t--ui-widget-background: #363636;\r\n\t\t\t\t--ui-widget-focus: #777;\r\n\t\t\t\t--pitch-background: #444;\r\n\t\t\t\t--tonic: #eafffe;\r\n\t\t\t\t--fifth-note: #b7f1ff;\r\n\t\t\t\t--octave-scrollbar: #a5eeff;\r\n\t\t\t\t--scrollbar-octave: #cefffd;\r\n\t\t\t\t--volume-icon: #42dcff;\t\r\n\r\n\t\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t\t--pitch10-primary-note:     #d85d00;\r\n\t\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\t\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t\t--pitch12-primary-note:     #c26afc;\r\n\t\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t\t--noise4-primary-note:      #a5ff00;\r\n\t\t\t\t}\r\n\t\t`,\r\n\t\t\"Cinnamon Roll\": `\r\n\t\t:root {\r\n\t\t\t\t--page-margin: black;\r\n\t\t\t\t--editor-background: black;\r\n\t\t\t\t--hover-preview: white;\r\n\t\t\t\t--playhead: white;\r\n\t\t\t\t--primary-text: white;\r\n\t\t\t\t--secondary-text: #999;\r\n\t\t\t\t--inverted-text: black;\r\n\t\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t\t--loop-accent: #ba8418;\r\n\t\t\t\t--link-accent: #98f;\r\n\t\t\t\t--ui-widget-background: #363636;\r\n\t\t\t\t--ui-widget-focus: #777;\r\n\t\t\t\t--pitch-background: #444;\r\n\t\t\t\t--pitch1-background: #f5bb00;\r\n\t\t\t\t--pitch2-background: #f5bb00;\r\n\t\t\t\t--pitch3-background: #f5bb00;\r\n\t\t\t\t--pitch4-background: #f5bb00;\r\n\t\t\t\t--pitch5-background: #f5bb00;\r\n\t\t\t\t--pitch6-background: #f5bb00;\r\n\t\t\t\t--pitch8-background: #f5bb00;\r\n\t\t\t\t--pitch9-background: #f5bb00;\r\n\t\t\t\t--pitch10-background: #f5bb00;\r\n\t\t\t\t--pitch11-background: #f5bb00;\r\n\t\t\t\t--pitch12-background: #f5bb00;\r\n\t\t\t\t--tonic: #f5bb00;\r\n\t\t\t\t--fifth-note: #f5bb00;\r\n\t\t\t\t--volume-icon: #ba8418;\t\r\n\r\n\t\t\t\t--octave-scrollbar: #e59900;\r\n\t\t\t\t--scrollbar-octave: #ffff25;\r\n\r\n\t\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t\t--pitch10-primary-note:     #d85d00;\r\n\t\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\t\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t\t--pitch12-primary-note:     #c26afc;\r\n\t\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t\t--noise4-primary-note:      #a5ff00;\r\n\t\t\t\t}\r\n\t\t`,\r\n\t\t\"Ocean\": `\r\n\t\t:root {\r\n\t\t\t\t--page-margin: black;\r\n\t\t\t\t--editor-background: black;\r\n\t\t\t\t--hover-preview: white;\r\n\t\t\t\t--playhead: white;\r\n\t\t\t\t--primary-text: white;\r\n\t\t\t\t--secondary-text: #999;\r\n\t\t\t\t--inverted-text: black;\r\n\t\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t\t--loop-accent: #5982ff;\r\n\t\t\t\t--link-accent: #98f;\r\n\t\t\t\t--ui-widget-background: #363636;\r\n\t\t\t\t--ui-widget-focus: #777;\r\n\t\t\t\t--pitch-background: #444;\r\n\t\t\t\t--tonic: #090b3a;\r\n\t\t\t\t--fifth-note: #3f669b;\r\n\t\t\t\t--volume-icon: #090b3a;\t\r\n\r\n\t\t\t\t--octave-scrollbar: #4449a3;\r\n\t\t\t\t--scrollbar-octave: #3dffdb;\r\n\r\n\t\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t\t--pitch10-primary-note:     #d85d00;\r\n\t\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\t\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t\t--pitch12-primary-note:     #c26afc;\r\n\t\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t\t--noise4-primary-note:      #a5ff00;\r\n\t\t\t\t}\r\n\t\t`,\r\n\t\t\"rainbow\": `\r\n\t\t:root {\r\n\t\t\t\t--page-margin: black;\r\n\t\t\t\t--editor-background: black;\r\n\t\t\t\t--hover-preview: white;\r\n\t\t\t\t--playhead: white;\r\n\t\t\t\t--primary-text: white;\r\n\t\t\t\t--secondary-text: #999;\r\n\t\t\t\t--inverted-text: black;\r\n\t\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t\t--loop-accent: #ff0000;\r\n\t\t\t\t--link-accent: #98f;\r\n\t\t\t\t--ui-widget-background: #363636;\r\n\t\t\t\t--ui-widget-focus: #777;\r\n\r\n\t\t\t\t--pitch-background: #444; \r\n\t\t\t\t--tonic: #ffaaaa; \r\n\t\t\t\t--pitch1-background: #ffceaa; \r\n\t\t\t\t--pitch2-background: #ffdfaa; \r\n\t\t\t\t--pitch3-background: #fff5aa; \r\n\t\t\t\t--pitch4-background: #e8ffaa;\r\n\t\t\t\t--pitch5-background: #bfffb2; \r\n\t\t\t\t--pitch6-background: #b2ffc8; \r\n\t\t\t\t--fifth-note: #b2ffe4; \r\n\t\t\t\t--pitch8-background: #b2f3ff; \r\n\t\t\t\t--pitch9-background: #b2b3ff; \r\n\t\t\t\t--pitch10-background: #e0b2ff; \r\n\t\t\t\t--pitch11-background: #ffafe9; \r\n\t\t\t\t--octave-scrollbar: #43ff00; \r\n\t\t\t\t--volume-icon: #ff00cb;\t\r\n\r\n\t\t\t\t--octave-scrollbar: #43ff00;\r\n\t\t\t\t--scrollbar-octave: #0400ff;\r\n\r\n\t\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t\t--pitch10-primary-note:     #d85d00;\r\n\t\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\t\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t\t--pitch12-primary-note:     #c26afc;\r\n\t\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t\t--noise4-primary-note:      #a5ff00;\r\n\t\t\t\t}\r\n\t\t`,\r\n\t\t\"float\": `\r\n\t\t:root {\r\n\t\t\t\t--page-margin: black;\r\n\t\t\t\t--editor-background: black;\r\n\t\t\t\t--hover-preview: white;\r\n\t\t\t\t--playhead: white;\r\n\t\t\t\t--primary-text: white;\r\n\t\t\t\t--secondary-text: #999;\r\n\t\t\t\t--inverted-text: black;\r\n\t\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t\t--loop-accent: #ff0000;\r\n\t\t\t\t--link-accent: #98f;\r\n\t\t\t\t--ui-widget-background: #363636;\r\n\t\t\t\t--ui-widget-focus: #777;\r\n\t\t\t\t--volume-icon: #878787;\t\r\n\r\n\t\t\t\t--pitch-background: #444; \r\n\t\t\t\t--tonic: #ffffff; \r\n\t\t\t\t--pitch1-background: #ededed;  \r\n\t\t\t\t--pitch2-background: #cecece;  \r\n\t\t\t\t--pitch3-background: #bababa;  \r\n\t\t\t\t--pitch4-background: #afafaf;\r\n\t\t\t\t--pitch5-background: #a5a5a5; \r\n\t\t\t\t--pitch6-background: #999999; \r\n\t\t\t\t--fifth-note: #8e8e8e; \r\n\t\t\t\t--pitch8-background: #828282; \r\n\t\t\t\t--pitch9-background: #777777; \r\n\t\t\t\t--pitch10-background: #565656; \r\n\t\t\t\t--pitch11-background: #282828; \r\n\t\t\t\t--octave-scrollbar: #ffffff; \r\n\t\t\t\t--scrollbar-octave: #c9c9c9;\r\n\r\n\t\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t\t--pitch10-primary-note:     #d85d00;\r\n\t\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\t\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t\t--pitch12-primary-note:     #c26afc;\r\n\t\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t\t--noise4-primary-note:      #a5ff00;\r\n\t\t\t\t}\r\n\t\t`,\r\n\t\t\"windows\": `\r\n\t\t:root {\r\n\t\t\t\t--page-margin: black;\r\n\t\t\t\t--editor-background: black;\r\n\t\t\t\t--hover-preview: white;\r\n\t\t\t\t--playhead: white;\r\n\t\t\t\t--primary-text: white;\r\n\t\t\t\t--secondary-text: #999;\r\n\t\t\t\t--inverted-text: black;\r\n\t\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t\t--loop-accent: #ff0000;\r\n\t\t\t\t--link-accent: #98f;\r\n\t\t\t\t--ui-widget-background: #363636;\r\n\t\t\t\t--ui-widget-focus: #777;\r\n\t\t\t\t--volume-icon: #15a0db;\t\r\n\r\n\t\t\t\t--tonic: #da4e2a;\r\n\t\t\t\t--fifth-note: #5d9511;\r\n\t\t\t\t--pitch-background: #444;\r\n\r\n\t\t\t\t--octave-scrollbar: #295294; \r\n\t\t\t\t--scrollbar-octave: #fdd01d;\r\n\r\n\t\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t\t--pitch10-primary-note:     #d85d00;\r\n\t\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\t\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t\t--pitch12-primary-note:     #c26afc;\r\n\t\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t\t--noise4-primary-note:      #a5ff00;\r\n\t\t\t\t}\r\n\t\t`,\r\n\t\t\"grassland\": `\r\n\t\t:root {\r\n\t\t\t\t--page-margin: black;\r\n\t\t\t\t--editor-background: black;\r\n\t\t\t\t--hover-preview: white;\r\n\t\t\t\t--playhead: white;\r\n\t\t\t\t--primary-text: white;\r\n\t\t\t\t--secondary-text: #999;\r\n\t\t\t\t--inverted-text: black;\r\n\t\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t\t--loop-accent: #a0d168;\r\n\t\t\t\t--link-accent: #98f;\r\n\t\t\t\t--ui-widget-background: #363636;\r\n\t\t\t\t--ui-widget-focus: #777;\r\n\t\t\t\t--volume-icon: #74bc21;\t\r\n\r\n\t\t\t\t--tonic: #20330a;\r\n\t\t\t\t--fifth-note: #74bc21;\r\n\t\t\t\t--pitch-background: #444;\r\n\r\n\t\t\t\t--octave-scrollbar: #74bc21; \r\n\t\t\t\t--scrollbar-octave: #20330a;\r\n\r\n\t\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t\t--pitch10-primary-note:     #d85d00;\r\n\t\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\t\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t\t--pitch12-primary-note:     #c26afc;\r\n\t\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t\t--noise4-primary-note:      #a5ff00;\r\n\t\t\t\t}\r\n\t\t`,\r\n\t\t\"dessert\": `\r\n\t\t:root {\r\n\t\t\t\t--page-margin: black;\r\n\t\t\t\t--editor-background: black;\r\n\t\t\t\t--hover-preview: white;\r\n\t\t\t\t--playhead: white;\r\n\t\t\t\t--primary-text: white;\r\n\t\t\t\t--secondary-text: #999;\r\n\t\t\t\t--inverted-text: black;\r\n\t\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t\t--loop-accent: #ff6254;\r\n\t\t\t\t--link-accent: #98f;\r\n\t\t\t\t--ui-widget-background: #363636;\r\n\t\t\t\t--ui-widget-focus: #777;\r\n\t\t\t\t--volume-icon: #ff0000;\t\r\n\r\n\t\t\t\t--tonic: #fffc5b;\r\n\t\t\t\t--fifth-note: #ff5e3a;\r\n\t\t\t\t--pitch-background: #444;\r\n\r\n\t\t\t\t--octave-scrollbar: #ff5e3a; \r\n\t\t\t\t--scrollbar-octave: #fffc5b;\r\n\r\n\t\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t\t--pitch10-primary-note:     #d85d00;\r\n\t\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\t\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t\t--pitch12-primary-note:     #c26afc;\r\n\t\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t\t--noise4-primary-note:      #a5ff00;\r\n\t\t\t\t}\r\n\t\t`,\r\n\t\t\"kahootiest\": `\r\n\t\t:root {\r\n\t\t\t\t--page-margin: black;\r\n\t\t\t\t--editor-background: black;\r\n\t\t\t\t--hover-preview: white;\r\n\t\t\t\t--playhead: white;\r\n\t\t\t\t--primary-text: white;\r\n\t\t\t\t--secondary-text: #999;\r\n\t\t\t\t--inverted-text: black;\r\n\t\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t\t--loop-accent: #ff3355;\r\n\t\t\t\t--link-accent: #98f;\r\n\t\t\t\t--ui-widget-background: #363636;\r\n\t\t\t\t--ui-widget-focus: #777;\r\n\t\t\t\t--volume-icon: #66bf39;\t\r\n\r\n\t\t\t\t--tonic: #45a3e5;\r\n\t\t\t\t--fifth-note: #864cbf;\r\n\t\t\t\t--pitch-background: #444;\r\n\r\n\t\t\t\t--octave-scrollbar: #eb670f; \r\n\t\t\t\t--scrollbar-octave: #ff3355;\r\n\r\n\t\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t\t--pitch10-primary-note:     #d85d00;\r\n\t\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\t\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t\t--pitch12-primary-note:     #c26afc;\r\n\t\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t\t--noise4-primary-note:      #a5ff00;\r\n\t\t\t\t}\r\n\t\t`,\r\n\t\t\"beambit\": `\r\n\t\t:root {\r\n\t\t\t\t--page-margin: black;\r\n\t\t\t\t--editor-background: black;\r\n\t\t\t\t--hover-preview: white;\r\n\t\t\t\t--playhead: white;\r\n\t\t\t\t--primary-text: white;\r\n\t\t\t\t--secondary-text: #999;\r\n\t\t\t\t--inverted-text: black;\r\n\t\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t\t--loop-accent: #fefe00;\r\n\t\t\t\t--link-accent: #98f;\r\n\t\t\t\t--ui-widget-background: #363636;\r\n\t\t\t\t--ui-widget-focus: #777;\r\n\t\t\t\t--volume-icon: #fefe00;\t\r\n\r\n\t\t\t\t--pitch-background: #444;\r\n\r\n\t\t\t\t--tonic: #fefe00;\r\n\t\t\t\t--pitch1-background: #111111; \r\n\t\t\t\t--pitch2-background: #111111; \r\n\t\t\t\t--pitch3-background: #111111; \r\n\t\t\t\t--pitch4-background: #fa0103;\r\n\t\t\t\t--pitch5-background: #111111; \r\n\t\t\t\t--pitch6-background: #111111; \r\n\t\t\t\t--fifth-note: #111111; \r\n\t\t\t\t--pitch8-background: #0001fc; \r\n\t\t\t\t--pitch9-background: #111111; \r\n\t\t\t\t--pitch10-background: #111111; \r\n\t\t\t\t--pitch11-background: #111111;\r\n\r\n\t\t\t\t--octave-scrollbar: #0001fc; \r\n\t\t\t\t--scrollbar-octave: #fa0103;\r\n\r\n\t\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t\t--pitch10-primary-note:     #d85d00;\r\n\t\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\t\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t\t--pitch12-primary-note:     #c26afc;\r\n\t\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t\t--noise4-primary-note:      #a5ff00;\r\n\t\t\t\t}\r\n\t\t`,\r\n\t\t\"egg\": `\r\n\t\t:root {\r\n\t\t\t\t--page-margin: black;\r\n\t\t\t\t--editor-background: black;\r\n\t\t\t\t--hover-preview: white;\r\n\t\t\t\t--playhead: white;\r\n\t\t\t\t--primary-text: white;\r\n\t\t\t\t--secondary-text: #999;\r\n\t\t\t\t--inverted-text: black;\r\n\t\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t\t--loop-accent: #6b003a;\r\n\t\t\t\t--link-accent: #98f;\r\n\t\t\t\t--ui-widget-background: #363636;\r\n\t\t\t\t--ui-widget-focus: #777;\r\n\t\t\t\t--volume-icon: #f01d7a;\t\r\n\r\n\t\t\t\t--tonic: #fffafa;\r\n\t\t\t\t--fifth-note: #ff91ce;\r\n\t\t\t\t--pitch-background: #444;\r\n\r\n\t\t\t\t--octave-scrollbar: #ffb1f4; \r\n\t\t\t\t--scrollbar-octave: #b4001b;\r\n\r\n\t\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t\t--pitch10-primary-note:     #d85d00;\r\n\t\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\t\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t\t--pitch12-primary-note:     #c26afc;\r\n\t\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t\t--noise4-primary-note:      #a5ff00;\r\n\t\t\t\t}\r\n\t\t`,\r\n\t\t\"Poniryoshka\": `\r\n\t\t:root {\r\n\t\t\t\t--page-margin: black;\r\n\t\t\t\t--editor-background: black;\r\n\t\t\t\t--hover-preview: white;\r\n\t\t\t\t--playhead: white;\r\n\t\t\t\t--primary-text: white;\r\n\t\t\t\t--secondary-text: #999;\r\n\t\t\t\t--inverted-text: black;\r\n\t\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t\t--loop-accent: #4b4b4b;\r\n\t\t\t\t--link-accent: #98f;\r\n\t\t\t\t--ui-widget-background: #363636;\r\n\t\t\t\t--ui-widget-focus: #777;\r\n\t\t\t\t--volume-icon: #ffc100;\t\r\n\r\n\t\t\t\t--tonic: #1a2844;\r\n\t\t\t\t--fifth-note: #dabbe6;\r\n\t\t\t\t--pitch4-background: #faf4c3;\r\n\t\t\t\t--pitch-background: #444;\r\n\r\n\t\t\t\t--octave-scrollbar: #5f4c99; \r\n\t\t\t\t--scrollbar-octave: #ff8291;\r\n\r\n\t\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t\t--pitch10-primary-note:     #d85d00;\r\n\t\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\t\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t\t--pitch12-primary-note:     #c26afc;\r\n\t\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t\t--noise4-primary-note:      #a5ff00;\r\n\t\t\t\t}\r\n\t\t`,\r\n\t\t\"gameboy\": `\r\n\t\t:root {\r\n\t\t\t\t--page-margin: black;\r\n\t\t\t\t--editor-background: black;\r\n\t\t\t\t--hover-preview: white;\r\n\t\t\t\t--playhead: white;\r\n\t\t\t\t--primary-text: white;\r\n\t\t\t\t--secondary-text: #999;\r\n\t\t\t\t--inverted-text: black;\r\n\t\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t\t--loop-accent: #9bbc0f;\r\n\t\t\t\t--link-accent: #98f;\r\n\t\t\t\t--ui-widget-background: #363636;\r\n\t\t\t\t--ui-widget-focus: #777;\r\n\t\t\t\t--volume-icon: #8bac0f;\t\r\n\r\n\t\t\t\t--tonic: #9bbc0f; \r\n\t\t\t\t--pitch1-background: #9bbc0f; \r\n\t\t\t\t--pitch2-background: #9bbc0f; \r\n\t\t\t\t--pitch3-background: #9bbc0f; \r\n\t\t\t\t--pitch4-background: #9bbc0f;\r\n\t\t\t\t--pitch5-background: #9bbc0f; \r\n\t\t\t\t--pitch6-background: #306230; \r\n\t\t\t\t--fifth-note: #306230; \r\n\t\t\t\t--pitch8-background: #306230; \r\n\t\t\t\t--pitch9-background: #0f380f; \r\n\t\t\t\t--pitch10-background: #0f380f; \r\n\t\t\t\t--pitch11-background: #0f380f; \r\n\t\t\t\t--pitch-background: #444;\r\n\r\n\t\t\t\t--octave-scrollbar: #9bbc0f; \r\n\t\t\t\t--scrollbar-octave: #8bac0f;\r\n\r\n\t\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t\t--pitch10-primary-note:     #d85d00;\r\n\t\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\t\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t\t--pitch12-primary-note:     #c26afc;\r\n\t\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t\t--noise4-primary-note:      #a5ff00;\r\n\t\t\t\t}\r\n\t\t`,\r\n\t\t\"woodkid\": `\r\n\t\t:root {\r\n\t\t\t\t--page-margin: black;\r\n\t\t\t\t--editor-background: black;\r\n\t\t\t\t--hover-preview: white;\r\n\t\t\t\t--playhead: white;\r\n\t\t\t\t--primary-text: white;\r\n\t\t\t\t--secondary-text: #999;\r\n\t\t\t\t--inverted-text: black;\r\n\t\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t\t--loop-accent: #e83c4e;\r\n\t\t\t\t--link-accent: #98f;\r\n\t\t\t\t--ui-widget-background: #363636;\r\n\t\t\t\t--ui-widget-focus: #777;\r\n\t\t\t\t--volume-icon: #ef3027;\t\r\n\r\n\t\t\t\t--tonic: #fff6fe;\r\n\t\t\t\t--pitch1-background: #41323b;\r\n\t\t\t\t--pitch2-background: #41323b;\r\n\t\t\t\t--pitch3-background: #41323b;\r\n\t\t\t\t--pitch4-background: #fff6fe;\r\n\t\t\t\t--pitch5-background: #41323b;\r\n\t\t\t\t--pitch6-background: #41323b;\r\n\t\t\t\t--fifth-note: #fff6fe;\r\n\t\t\t\t--pitch8-background: #41323b;\r\n\t\t\t\t--pitch9-background: #41323b;\r\n\t\t\t\t--pitch10-background: #41323b;\r\n\t\t\t\t--pitch11-background: #41323b;\r\n\t\t\t\t--pitch-background: #444;\r\n\r\n\t\t\t\t--octave-scrollbar: #ef3027; \r\n\t\t\t\t--scrollbar-octave: #ffedca;\r\n\r\n\t\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t\t--pitch10-primary-note:     #d85d00;\r\n\t\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\t\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t\t--pitch12-primary-note:     #c26afc;\r\n\t\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t\t--noise4-primary-note:      #a5ff00;\r\n\t\t\t\t}\r\n\t\t`,\r\n\t\t\"midnight\": `\r\n\t\t:root {\r\n\t\t\t\t--page-margin: black;\r\n\t\t\t\t--editor-background: black;\r\n\t\t\t\t--hover-preview: white;\r\n\t\t\t\t--playhead: white;\r\n\t\t\t\t--primary-text: white;\r\n\t\t\t\t--secondary-text: #999;\r\n\t\t\t\t--inverted-text: black;\r\n\t\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t\t--loop-accent: #445566;\r\n\t\t\t\t--link-accent: #98f;\r\n\t\t\t\t--ui-widget-background: #363636;\r\n\t\t\t\t--ui-widget-focus: #777;\r\n\t\t\t\t--volume-icon: #aa5599;\t\r\n\r\n\t\t\t\t--tonic: #222222;\r\n\t\t\t\t--pitch1-background: #222222;\r\n\t\t\t\t--pitch2-background: #222222;\r\n\t\t\t\t--pitch3-background: #222222;\r\n\t\t\t\t--pitch4-background: #222222;\r\n\t\t\t\t--pitch5-background: #222222;\r\n\t\t\t\t--pitch6-background:#222222;\r\n\t\t\t\t--fifth-note: #444444;\r\n\t\t\t\t--pitch8-background: #222222;\r\n\t\t\t\t--pitch9-background: #222222;\r\n\t\t\t\t--pitch10-background: #222222;\r\n\t\t\t\t--pitch11-background: #222222;\r\n\t\t\t\t--pitch-background: #444;\r\n\r\n\t\t\t\t--octave-scrollbar: #444444; \r\n\t\t\t\t--scrollbar-octave: #aa5599;\r\n\r\n\t\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t\t--pitch10-primary-note:     #d85d00;\r\n\t\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\t\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t\t--pitch12-primary-note:     #c26afc;\r\n\t\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t\t--noise4-primary-note:      #a5ff00;\r\n\t\t\t\t}\r\n\t\t`,\r\n\t\t\"snedbox\": `\r\n\t\t:root {\r\n\t\t\t--page-margin: black;\r\n\t\t\t--editor-background: black;\r\n\t\t\t--hover-preview: white;\r\n\t\t\t--playhead: white;\r\n\t\t\t--primary-text: white;\r\n\t\t\t--secondary-text: #999;\r\n\t\t\t--inverted-text: black;\r\n\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t--loop-accent: #a53a3d;\r\n\t\t\t--link-accent: #98f;\r\n\t\t\t--ui-widget-background: #363636;\r\n\t\t\t--ui-widget-focus: #777;\r\n\t\t\t--pitch-background: #444;\r\n\t\t\t--tonic: #864;\r\n\t\t\t--fifth-note: #60389b;\r\n\t\t\t--pitch4-background: #10997e;\r\n\t\t\t--volume-icon: #a53a3d;\r\n\t\t\t--octave-scrollbar: #444;\r\n\t\t\t--scrollbar-octave: #a53a3d;\r\n\t\t\t--channel-box: #444;\r\n\r\n\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t--pitch10-primary-note:     #d85d00;\r\n\r\n\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\r\n\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t--pitch12-primary-note:     #c26afc;\r\n\r\n\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t--noise4-primary-note:      #a5ff00;\r\n\t\t}\r\n\t`,\r\n\t\"unnamed\": `\r\n\t:root {\r\n\t\t\t--page-margin: black;\r\n\t\t\t--editor-background: black;\r\n\t\t\t--hover-preview: white;\r\n\t\t\t--playhead: white;\r\n\t\t\t--primary-text: white;\r\n\t\t\t--secondary-text: #999;\r\n\t\t\t--inverted-text: black;\r\n\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t--loop-accent: #ffffff;\r\n\t\t\t--link-accent: #98f;\r\n\t\t\t--ui-widget-background: #363636;\r\n\t\t\t--ui-widget-focus: #777;\r\n\t\t\t--pitch-background: #444;\r\n\t\t\t--pitch1-background: #ffffa0;\r\n\t\t\t--pitch2-background: #ffffa0;\r\n\t\t\t--pitch3-background: #ffffa0;\r\n\t\t\t--pitch4-background: #ffffa0;\r\n\t\t\t--pitch5-background: #ffffa0;\r\n\t\t\t--pitch6-background: #ffffa0;\r\n\t\t\t--pitch8-background: #ffffa0;\r\n\t\t\t--pitch9-background: #ffffa0;\r\n\t\t\t--pitch10-background: #ffffa0;\r\n\t\t\t--pitch11-background: #ffffa0;\r\n\t\t\t--pitch12-background: #ffffa0;\r\n\t\t\t--tonic: #ffffa0;\r\n\t\t\t--fifth-note: #ffffa0;\r\n\t\t\t--volume-icon: #ffffff;\t\r\n\r\n\t\t\t--octave-scrollbar: #ffffff;\r\n\t\t\t--scrollbar-octave: #ffffff;\r\n\r\n\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t--pitch10-primary-note:     #d85d00;\r\n\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t--pitch12-primary-note:     #c26afc;\r\n\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t--noise4-primary-note:      #a5ff00;\r\n\t\t\t}\r\n\t`,\r\n\t\"piano\": `\r\n\t:root {\r\n\t\t\t--page-margin: black;\r\n\t\t\t--editor-background: black;\r\n\t\t\t--hover-preview: white;\r\n\t\t\t--playhead: white;\r\n\t\t\t--primary-text: white;\r\n\t\t\t--secondary-text: #999;\r\n\t\t\t--inverted-text: black;\r\n\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t--loop-accent: #ffffff;\r\n\t\t\t--link-accent: #98f;\r\n\t\t\t--ui-widget-background: #363636;\r\n\t\t\t--ui-widget-focus: #777;\r\n\r\n\t\t\t--use-piano-scheme: true;\r\n\r\n\t\t\t--pitch-background: #444;\r\n\t\t\t--volume-icon: #ff0000;\t\r\n\r\n\t\t\t--tonic: #ffffff;\r\n\t\t\t--white-tonic: #fff;\r\n\t\t\t--black-tonic: #222;\r\n\t\t\t--fifth-note: #7a7a7a;\r\n\r\n\t\t\t--octave-scrollbar: #211616;\r\n\t\t\t--scrollbar-octave: #ff4c4c;\r\n\t\t\t--pitch-white-key: #bfbfbf;\r\n\t\t\t--pitch-black-key: #7a7a7a;\r\n\r\n\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t--pitch10-primary-note:     #d85d00;\r\n\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t--pitch12-primary-note:     #c26afc;\r\n\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t--noise4-primary-note:      #a5ff00;\r\n\t\t\t}\r\n\t`,\r\n\t\"halloween\": `\r\n\t:root {\r\n\t\t\t\t--page-margin: black;\r\n\t\t\t\t--editor-background: black;\r\n\t\t\t\t--hover-preview: white;\r\n\t\t\t\t--playhead: white;\r\n\t\t\t\t--primary-text: white;\r\n\t\t\t\t--secondary-text: #999;\r\n\t\t\t\t--inverted-text: black;\r\n\t\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t\t--loop-accent: #9e2200;\r\n\t\t\t\t--link-accent: #98f;\r\n\t\t\t\t--ui-widget-background: #363636;\r\n\t\t\t\t--ui-widget-focus: #777;\r\n\t\t\t\t--volume-icon: #9e2200;\t\r\n\r\n\t\t\t\t--tonic: #681701;\r\n\t\t\t\t--pitch1-background: #754a3f;\r\n\t\t\t\t--pitch2-background: #754a3f;\r\n\t\t\t\t--pitch3-background: #754a3f;\r\n\t\t\t\t--pitch4-background: #754a3f;\r\n\t\t\t\t--pitch5-background: #754a3f;\r\n\t\t\t\t--pitch6-background:#754a3f;\r\n\t\t\t\t--fifth-note: #914300;\r\n\t\t\t\t--pitch8-background: #754a3f;\r\n\t\t\t\t--pitch9-background: #754a3f;\r\n\t\t\t\t--pitch10-background: #754a3f;\r\n\t\t\t\t--pitch11-background: #754a3f;\r\n\t\t\t\t--pitch-background: #444;\r\n\r\n\t\t\t\t--octave-scrollbar: #9e2200; \r\n\t\t\t\t--scrollbar-octave: #701800;\r\n\r\n\t\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t\t--pitch10-primary-note:     #d85d00;\r\n\t\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\t\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t\t--pitch12-primary-note:     #c26afc;\r\n\t\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t\t--noise4-primary-note:      #a5ff00;\r\n\t\t\t}\r\n\t`,\r\n\t\"frozen\": `\r\n\t:root {\r\n\t\t\t\t--page-margin: black;\r\n\t\t\t\t--editor-background: black;\r\n\t\t\t\t--hover-preview: white;\r\n\t\t\t\t--playhead: white;\r\n\t\t\t\t--primary-text: white;\r\n\t\t\t\t--secondary-text: #999;\r\n\t\t\t\t--inverted-text: black;\r\n\t\t\t\t--text-selection: rgba(119,68,255,0.99);\r\n\t\t\t\t--box-selection-fill: rgba(255,255,255,0.2);\r\n\t\t\t\t--loop-accent: #38ef17;\r\n\t\t\t\t--link-accent: #98f;\r\n\t\t\t\t--ui-widget-background: #363636;\r\n\t\t\t\t--ui-widget-focus: #777;\r\n\t\t\t\t--volume-icon: #ed2d2d;\t\r\n\r\n\t\t\t\t--tonic: #88bce8; \r\n\t\t\t\t--pitch1-background: #99c8ef; \r\n\t\t\t\t--pitch2-background: #abd3f4; \r\n\t\t\t\t--pitch3-background: #b8d7f2; \r\n\t\t\t\t--pitch4-background: #cbe0f2;\r\n\t\t\t\t--pitch5-background: #e5f0f9; \r\n\t\t\t\t--pitch6-background: #ffffff; \r\n\t\t\t\t--fifth-note: #e5f0f9; \r\n\t\t\t\t--pitch8-background: #cbe0f2; \r\n\t\t\t\t--pitch9-background: #b8d7f2; \r\n\t\t\t\t--pitch10-background: #abd3f4; \r\n\t\t\t\t--pitch11-background: #99c8ef;\r\n\t\t\t\t--pitch-background: #444;\r\n\r\n\t\t\t\t--octave-scrollbar: #ffffff; \r\n\t\t\t\t--scrollbar-octave: #ed2d2d;\r\n\r\n\t\t\t\t--pitch1-secondary-channel: #0099a1;\r\n\t\t\t\t--pitch1-primary-channel:   #25f3ff;\r\n\t\t\t\t--pitch1-secondary-note:    #0099a1;\r\n\t\t\t\t--pitch1-primary-note:      #25f3ff;\r\n\t\t\t\t--pitch2-secondary-channel: #439143;\r\n\t\t\t\t--pitch2-primary-channel:   #44ff44;\r\n\t\t\t\t--pitch2-secondary-note:    #439143;\r\n\t\t\t\t--pitch2-primary-note:      #44ff44;\r\n\t\t\t\t--pitch3-secondary-channel: #a1a100;\r\n\t\t\t\t--pitch3-primary-channel:   #ffff25;\r\n\t\t\t\t--pitch3-secondary-note:    #a1a100;\r\n\t\t\t\t--pitch3-primary-note:      #ffff25;\r\n\t\t\t\t--pitch4-secondary-channel: #c75000;\r\n\t\t\t\t--pitch4-primary-channel:   #ff9752;\r\n\t\t\t\t--pitch4-secondary-note:    #c75000;\r\n\t\t\t\t--pitch4-primary-note:      #ff9752;\r\n\t\t\t\t--pitch5-secondary-channel: #d020d0;\r\n\t\t\t\t--pitch5-primary-channel:   #FF90FF;\r\n\t\t\t\t--pitch5-secondary-note:    #d020d0;\r\n\t\t\t\t--pitch5-primary-note:      #ff90ff;\r\n\t\t\t\t--pitch6-secondary-channel: #552377;\r\n\t\t\t\t--pitch6-primary-channel:   #9f31ea;\r\n\t\t\t\t--pitch6-secondary-note:    #552377;\r\n\t\t\t\t--pitch6-primary-note:      #9f31ea;\r\n\t\t\t\t--pitch7-secondary-channel: #221b89;\r\n\t\t\t\t--pitch7-primary-channel:   #2b6aff;\r\n\t\t\t\t--pitch7-secondary-note:    #221b89;\r\n\t\t\t\t--pitch7-primary-note:      #2b6aff;\r\n\t\t\t\t--pitch8-secondary-channel: #00995f;\r\n\t\t\t\t--pitch8-primary-channel:   #00ff9f;\r\n\t\t\t\t--pitch8-secondary-note:    #00995f;\r\n\t\t\t\t--pitch8-primary-note:      #00ff9f;\r\n\t\t\t\t--pitch9-secondary-channel: #d6b03e;\r\n\t\t\t\t--pitch9-primary-channel:   #ffbf00;\r\n\t\t\t\t--pitch9-secondary-note:    #d6b03e;\r\n\t\t\t\t--pitch9-primary-note:      #ffbf00;\r\n\t\t\t\t--pitch10-secondary-channel:#b25915;\r\n\t\t\t\t--pitch10-primary-channel:  #d85d00;\r\n\t\t\t\t--pitch10-secondary-note:   #b25915;\r\n\t\t\t\t--pitch10-primary-note:     #d85d00;\r\n\t\t\t\t--pitch11-secondary-channel:#891a60;\r\n\t\t\t\t--pitch11-primary-channel:  #ff00a1;\r\n\t\t\t\t--pitch11-secondary-note:   #891a60;\r\n\t\t\t\t--pitch11-primary-note:     #ff00a1;\r\n\t\t\t\t--pitch12-secondary-channel:#965cbc;\r\n\t\t\t\t--pitch12-primary-channel:  #c26afc;\r\n\t\t\t\t--pitch12-secondary-note:   #965cbc;\r\n\t\t\t\t--pitch12-primary-note:     #c26afc;\r\n\t\t\t\t--noise1-secondary-channel: #991010;\r\n\t\t\t\t--noise1-primary-channel:   #ff1616;\r\n\t\t\t\t--noise1-secondary-note:    #991010;\r\n\t\t\t\t--noise1-primary-note:      #ff1616;\r\n\t\t\t\t--noise2-secondary-channel: #aaaaaa;\r\n\t\t\t\t--noise2-primary-channel:   #ffffff;\r\n\t\t\t\t--noise2-secondary-note:    #aaaaaa;\r\n\t\t\t\t--noise2-primary-note:      #ffffff;\r\n\t\t\t\t--noise3-secondary-channel: #5869BD;\r\n\t\t\t\t--noise3-primary-channel:   #768dfc;\r\n\t\t\t\t--noise3-secondary-note:    #5869BD;\r\n\t\t\t\t--noise3-primary-note:      #768dfc;\r\n\t\t\t\t--noise4-secondary-channel: #7c9b42;\r\n\t\t\t\t--noise4-primary-channel:   #a5ff00;\r\n\t\t\t\t--noise4-secondary-note:    #7c9b42;\r\n\t\t\t\t--noise4-primary-note:      #a5ff00;\r\n\t\t\t}\r\n\t`,\r\n\t}\r\n\r\n    public static readonly pageMargin: string = \"var(--page-margin, black)\";\r\n    public static readonly editorBackground: string = \"var(--editor-background, black)\";\r\n    public static readonly hoverPreview: string = \"var(--hover-preview, white)\";\r\n    public static readonly playhead: string = \"var(--playhead, white)\";\r\n    public static readonly primaryText: string = \"var(--primary-text, white)\";\r\n    public static readonly secondaryText: string = \"var(--secondary-text, #999)\";\r\n    public static readonly invertedText: string = \"var(--inverted-text, black)\";\r\n    public static readonly textSelection: string = \"var(--text-selection, rgba(119,68,255,0.99))\";\r\n    public static readonly boxSelectionFill: string = \"var(--box-selection-fill, rgba(255,255,255,0.2))\";\r\n    public static readonly loopAccent: string = \"var(--loop-accent, #9900cc)\";\r\n    public static readonly linkAccent: string = \"var(--link-accent, #98f)\";\r\n    public static readonly uiWidgetBackground: string = \"var(--ui-widget-background, #444)\";\r\n    public static readonly uiWidgetFocus: string = \"var(--ui-widget-focus)\";\r\n    public static readonly pitchBackground: string = \"var(--pitch-background, #444)\";\r\n    public static readonly tonic: string = \"var(--tonic, #864)\";\r\n    public static readonly fifthNote: string = \"var(--fifth-note, #468)\";\r\n\r\n\tpublic static readonly pitch1Background: string = \"var(--pitch1-background, var(--pitch-background, #444))\";\r\n\tpublic static readonly pitch2Background: string = \"var(--pitch2-background, var(--pitch-background, #444))\";\r\n\tpublic static readonly pitch3Background: string = \"var(--pitch3-background, var(--pitch-background, #444))\";\r\n\tpublic static readonly pitch4Background: string = \"var(--pitch4-background, var(--pitch-background, #444))\";\r\n\tpublic static readonly pitch5Background: string = \"var(--pitch5-background, var(--pitch-background, #444))\";\r\n\tpublic static readonly pitch6Background: string = \"var(--pitch6-background, var(--pitch-background, #444))\";\r\n\t// no need for a 7th since that's the --fifth-note's job\r\n\tpublic static readonly pitch8Background: string = \"var(--pitch8-background, var(--pitch-background, #444))\";\r\n\tpublic static readonly pitch9Background: string = \"var(--pitch9-background, var(--pitch-background, #444))\";\r\n\tpublic static readonly pitch10Background: string = \"var(--pitch10-background, var(--pitch-background, #444))\";\r\n\tpublic static readonly pitch11Background: string = \"var(--pitch11-background, var(--pitch-background, #444))\";\r\n    public static readonly volumeIcon: string = \"var(--volume-icon, #777777)\";\r\n\tpublic static readonly octaveScrollbar: string = \"var(--octave-scrollbar, #444444)\";\r\n\tpublic static readonly scrollbarOctave: string = \"var(--scrollbar-octave, #886644)\";\r\n\tpublic static readonly channelBox: string = \"var(--channel-box, #444444)\";\r\n\tpublic static readonly blackPianoKey: string = \"var(--black-piano-key, #444)\";\r\n\tpublic static readonly whitePianoKey: string = \"var(--white-piano-key, #bbb)\";\r\n\t\r\n\tpublic static readonly pitchChannels: DictionaryArray<ChannelColors> = toNameMap([\r\n        {\r\n            name: \"pitch1\", // cyan\r\n            secondaryChannel: \"var(--pitch1-secondary-channel)\",\r\n            primaryChannel: \"var(--pitch1-primary-channel)\",\r\n            secondaryNote: \"var(--pitch1-secondary-note)\",\r\n            primaryNote: \"var(--pitch1-primary-note)\",\r\n        }, {\r\n            name: \"pitch2\", // yellow\r\n            secondaryChannel: \"var(--pitch2-secondary-channel)\",\r\n            primaryChannel: \"var(--pitch2-primary-channel)\",\r\n            secondaryNote: \"var(--pitch2-secondary-note)\",\r\n            primaryNote: \"var(--pitch2-primary-note)\",\r\n        }, {\r\n            name: \"pitch3\", // orange\r\n            secondaryChannel: \"var(--pitch3-secondary-channel)\",\r\n            primaryChannel: \"var(--pitch3-primary-channel)\",\r\n            secondaryNote: \"var(--pitch3-secondary-note)\",\r\n            primaryNote: \"var(--pitch3-primary-note)\",\r\n        }, {\r\n            name: \"pitch4\", // green\r\n            secondaryChannel: \"var(--pitch4-secondary-channel)\",\r\n            primaryChannel: \"var(--pitch4-primary-channel)\",\r\n            secondaryNote: \"var(--pitch4-secondary-note)\",\r\n            primaryNote: \"var(--pitch4-primary-note)\",\r\n        }, {\r\n            name: \"pitch5\", // magenta\r\n            secondaryChannel: \"var(--pitch5-secondary-channel)\",\r\n            primaryChannel: \"var(--pitch5-primary-channel)\",\r\n            secondaryNote: \"var(--pitch5-secondary-note)\",\r\n            primaryNote: \"var(--pitch5-primary-note)\",\r\n        }, {\r\n            name: \"pitch6\", // blue\r\n            secondaryChannel: \"var(--pitch6-secondary-channel)\",\r\n            primaryChannel: \"var(--pitch6-primary-channel)\",\r\n            secondaryNote: \"var(--pitch6-secondary-note)\",\r\n            primaryNote: \"var(--pitch6-primary-note)\",\r\n        }, {\r\n            name: \"pitch7\", // olive\r\n            secondaryChannel: \"var(--pitch7-secondary-channel)\",\r\n            primaryChannel: \"var(--pitch7-primary-channel)\",\r\n            secondaryNote: \"var(--pitch7-secondary-note)\",\r\n            primaryNote: \"var(--pitch7-primary-note)\",\r\n        }, {\r\n            name: \"pitch8\", // red\r\n            secondaryChannel: \"var(--pitch8-secondary-channel)\",\r\n            primaryChannel: \"var(--pitch8-primary-channel)\",\r\n            secondaryNote: \"var(--pitch8-secondary-note)\",\r\n            primaryNote: \"var(--pitch8-primary-note)\",\r\n        }, {\r\n            name: \"pitch9\", // teal\r\n            secondaryChannel: \"var(--pitch9-secondary-channel)\",\r\n            primaryChannel: \"var(--pitch9-primary-channel)\",\r\n            secondaryNote: \"var(--pitch9-secondary-note)\",\r\n            primaryNote: \"var(--pitch9-primary-note)\",\r\n        }, {\r\n            name: \"pitch10\", // purple\r\n            secondaryChannel: \"var(--pitch10-secondary-channel)\",\r\n            primaryChannel: \"var(--pitch10-primary-channel)\",\r\n            secondaryNote: \"var(--pitch10-secondary-note)\",\r\n            primaryNote: \"var(--pitch10-primary-note)\",\r\n        },\r\n\t\t{\r\n            name: \"pitch11\", // teal\r\n            secondaryChannel: \"var(--pitch11-secondary-channel)\",\r\n            primaryChannel: \"var(--pitch11-primary-channel)\",\r\n            secondaryNote: \"var(--pitch11-secondary-note)\",\r\n            primaryNote: \"var(--pitch11-primary-note)\",\r\n        }, {\r\n            name: \"pitch12\", // purple\r\n            secondaryChannel: \"var(--pitch12-secondary-channel)\",\r\n            primaryChannel: \"var(--pitch12-primary-channel)\",\r\n            secondaryNote: \"var(--pitch12-secondary-note)\",\r\n            primaryNote: \"var(--pitch12-primary-note)\",\r\n        },\r\n    ]);\r\n\tpublic static readonly noiseChannels: DictionaryArray<ChannelColors> = toNameMap([\r\n        {\r\n            name: \"noise1\", // gray\r\n            secondaryChannel: \"var(--noise1-secondary-channel)\",\r\n            primaryChannel: \"var(--noise1-primary-channel)\",\r\n            secondaryNote: \"var(--noise1-secondary-note)\",\r\n            primaryNote: \"var(--noise1-primary-note)\",\r\n        }, {\r\n            name: \"noise2\", // brown\r\n            secondaryChannel: \"var(--noise2-secondary-channel)\",\r\n            primaryChannel: \"var(--noise2-primary-channel)\",\r\n            secondaryNote: \"var(--noise2-secondary-note)\",\r\n            primaryNote: \"var(--noise2-primary-note)\",\r\n        }, {\r\n            name: \"noise3\", // azure\r\n            secondaryChannel: \"var(--noise3-secondary-channel)\",\r\n            primaryChannel: \"var(--noise3-primary-channel)\",\r\n            secondaryNote: \"var(--noise3-secondary-note)\",\r\n            primaryNote: \"var(--noise3-primary-note)\",\r\n        }, {\r\n            name: \"noise4\", // purple\r\n            secondaryChannel: \"var(--noise4-secondary-channel)\",\r\n            primaryChannel: \"var(--noise4-primary-channel)\",\r\n            secondaryNote: \"var(--noise4-secondary-note)\",\r\n            primaryNote: \"var(--noise4-primary-note)\",\r\n        },\r\n    ]);\r\n\r\n\tpublic static getChannelColor(song: Song, channel: number): ChannelColors {\r\n\t\treturn channel < song.pitchChannelCount\r\n\t\t\t? ColorConfig.pitchChannels[channel % ColorConfig.pitchChannels.length]\r\n\t\t\t: ColorConfig.noiseChannels[(channel - song.pitchChannelCount) % ColorConfig.noiseChannels.length];\r\n\t}\r\n\t\tprivate static readonly _styleElement: HTMLStyleElement = document.head.appendChild(HTML.style({type: \"text/css\"}));\r\n\t\t\r\n\tpublic static setTheme(theme: string): void {\r\n\t\tthis._styleElement.textContent = this._themeMap[theme];\r\n\t\tthis.usesPianoScheme = (getComputedStyle(this._styleElement).getPropertyValue(\"--use-piano-scheme\").trim() == \"true\");\r\n\t\tconsole.log(\"use-piano-scheme: \"+this.usesPianoScheme);\r\n\t}\r\n}","/*\r\nCopyright (C) 2018 John Nesky\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of \r\nthis software and associated documentation files (the \"Software\"), to deal in \r\nthe Software without restriction, including without limitation the rights to \r\nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \r\nof the Software, and to permit persons to whom the Software is furnished to do \r\nso, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all \r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \r\nSOFTWARE.\r\n*/\r\n\r\nimport { HTML, SVG } from \"imperative-html/dist/esm/elements-strict\";\r\nimport { SongDocument } from \"./SongDocument\";\r\nimport { Note, NotePin, makeNotePin, makeNote, Pattern } from \"../synth/song\";\r\nimport {Config} from \"../synth/SynthConfig\";\r\nimport { UndoableChange, ChangeSequence } from \"./Change\";\r\nimport { ChangeChannelBar, ChangeNoteAdded, ChangeNoteTruncate, ChangePinTime, ChangeVolumeBend, ChangePitchBend, ChangePitchAdded, ChangeEnsurePatternExists } from \"./changes\";\r\nimport { ColorConfig } from \"./ColorConfig\";\r\n\tconst {div} = HTML;\r\n\r\n\r\n\tfunction prettyNumber(value: number): string {\r\n\t\treturn value.toFixed(2).replace(/\\.?0*$/, \"\");\r\n\t}\r\n\t\r\n\tfunction makeEmptyReplacementElement(node: Node): Node {\r\n\t\tconst clone: Node = node.cloneNode(false);\r\n\t\tnode.parentNode!.replaceChild(clone, node);\r\n\t\treturn clone;\r\n\t}\r\n\t\r\n\tclass PatternCursor {\r\n\t\tpublic valid:        boolean = false;\r\n\t\tpublic prevNote:     Note | null = null;\r\n\t\tpublic curNote:      Note | null = null;\r\n\t\tpublic nextNote:     Note | null = null;\r\n\t\tpublic pitch:        number = 0;\r\n\t\tpublic pitchIndex:   number = -1;\r\n\t\tpublic curIndex:     number = 0;\r\n\t\tpublic start:        number = 0;\r\n\t\tpublic end:          number = 0;\r\n\t\tpublic part:         number = 0;\r\n\t\tpublic notePart:     number = 0;\r\n\t\tpublic nearPinIndex: number = 0;\r\n\t\tpublic pins:         NotePin[] = [];\r\n\t}\r\n\t\r\n\texport class PatternEditor {\r\n\t\tprivate readonly _svgNoteBackground: SVGPatternElement = <SVGPatternElement> SVG.pattern( {id: \"patternEditorNoteBackground\", x: \"0\", y: \"0\", width: \"64\", height: \"156\", patternUnits: \"userSpaceOnUse\"});\r\n\t\tprivate readonly _svgDrumBackground: SVGPatternElement = <SVGPatternElement> SVG.pattern( {id: \"patternEditorDrumBackground\", x: \"0\", y: \"0\", width: \"64\", height: \"40\", patternUnits: \"userSpaceOnUse\"});\r\n\t\tprivate readonly _svgBackground: SVGRectElement = <SVGRectElement> SVG.rect( {x: \"0\", y: \"0\", width: \"512\", height: \"481\", \"pointer-events\": \"none\", fill: \"url(#patternEditorNoteBackground)\"});\r\n\t\tprivate _svgNoteContainer: SVGSVGElement = <SVGSVGElement> SVG.svg();\r\n\t\tprivate readonly _svgPlayhead: SVGRectElement = <SVGRectElement> SVG.rect( {id: \"\", x: \"0\", y: \"0\", width: \"4\", height: \"481\", fill: \"white\", \"pointer-events\": \"none\"});\r\n\t\tprivate readonly _svgPreview: SVGPathElement = <SVGPathElement> SVG.path( {fill: \"none\", stroke: \"white\", \"stroke-width\": \"2\", \"pointer-events\": \"none\"});\r\n\t\tprivate readonly _svg: SVGSVGElement = <SVGSVGElement> SVG.svg( {style: \"touch-action: none; position: absolute;\", width: \"100%\", height: \"100%\", viewBox: \"0 0 512 481\", preserveAspectRatio: \"none\"}, [\r\n\t\t\tSVG.defs( undefined, [\r\n\t\t\t\tthis._svgNoteBackground,\r\n\t\t\t\tthis._svgDrumBackground,\r\n\t\t\t]),\r\n\t\t\tthis._svgBackground,\r\n\t\t\tthis._svgNoteContainer,\r\n\t\t\tthis._svgPreview,\r\n\t\t\tthis._svgPlayhead,\r\n\t\t]);\r\n\t\tpublic readonly container: HTMLDivElement = div({style: \"height: 100%; overflow:hidden; position: relative; flex-grow: 1;\"}, [this._svg]);\r\n\t\t\r\n\t\tprivate readonly _defaultPitchHeight: number = 13;\r\n\t\tprivate readonly _defaultDrumHeight: number = 40;\r\n\t\tprivate readonly _backgroundPitchRows: SVGRectElement[] = [];\r\n\t\tprivate readonly _backgroundDrumRow: SVGRectElement = <SVGRectElement> SVG.rect();\r\n\t\t// The below array is unused.\r\n\t\tpublic readonly _defaultPinChannels: NotePin[][] = [\r\n\t\t\t[makeNotePin(0, 0, 3), makeNotePin(0, 2, 3)],\r\n\t\t\t[makeNotePin(0, 0, 3), makeNotePin(0, 2, 3)],\r\n\t\t\t[makeNotePin(0, 0, 3), makeNotePin(0, 2, 3)],\r\n\t\t\t[makeNotePin(0, 0, 3), makeNotePin(0, 2, 0)],\r\n\t\t];\r\n\t\t\r\n\t\tprivate _editorWidth: number;\r\n\t\tprivate _editorHeight: number = 481;\r\n\t\tprivate _partWidth: number;\r\n\t\tprivate _pitchHeight: number;\r\n\t\tprivate _pitchCount: number;\r\n\t\tprivate _mouseX: number = 0;\r\n\t\tprivate _mouseY: number = 0;\r\n\t\tprivate _mouseDown: boolean = false;\r\n\t\tprivate _mouseOver: boolean = false;\r\n\t\tprivate _mouseDragging: boolean = false;\r\n\t\tprivate _mouseHorizontal: boolean = false;\r\n\t\tprivate _usingTouch: boolean = false;\r\n\t\tprivate _copiedPinChannels: NotePin[][] = [];\r\n\t\tprivate _copiedPins: NotePin[];\r\n\t\tprivate _mouseXStart: number = 0;\r\n\t\tprivate _mouseYStart: number = 0;\r\n\t\tpublic _mouseXPrev: number = 0;\r\n\t\tpublic _mouseYPrev: number = 0;\r\n\t\tprivate _dragTime: number = 0;\r\n\t\tprivate _dragPitch: number = 0;\r\n\t\tprivate _dragVolume: number = 0;\r\n\t\tprivate _dragVisible: boolean = false;\r\n\t\t//private _precise: boolean = false;\r\n\t\t//private _precisionX: number = 0;\r\n\t\tprivate _dragChange: UndoableChange | null = null;\r\n\t\tprivate _cursor: PatternCursor = new PatternCursor();\r\n\t\tprivate _pattern: Pattern | null = null;\r\n\t\tprivate _playheadX: number = 0.0;\r\n\t\tprivate _octaveOffset: number = 0;\r\n\t\tprivate _renderedWidth: number = -1;\r\n\t\tprivate _renderedBeatWidth: number = -1;\r\n\t\tprivate _renderedFifths: boolean = false;\r\n\t\tprivate _renderedACS: boolean = false;\r\n\t\tprivate _renderedPiano: boolean = false;\r\n\t\tprivate _renderedDrums: boolean = false;\r\n\t\tprivate _setKey: number = 1;\r\n\t\tprivate _renderedPartsPerBeat: number = -1;\r\n\t\tprivate _renderedPitchChannelCount: number = -1;\r\n\t\tprivate _renderedDrumChannelCount: number = -1;\r\n\t\tprivate _followPlayheadBar: number = -1;\r\n\t\t\r\n\t\tconstructor(private _doc: SongDocument) {\r\n\t\t\tfor (let i: number = 0; i < 12; i++) {\r\n\t\t\t\tconst y: number = (12 - i) % 12;\r\n\t\t\t\tconst rectangle: SVGRectElement = <SVGRectElement> SVG.rect();\r\n\t\t\t\trectangle.setAttribute(\"x\", \"1\");\r\n\t\t\t\trectangle.setAttribute(\"y\", \"\" + (y * this._defaultPitchHeight + 1));\r\n\t\t\t\trectangle.setAttribute(\"height\", \"\" + (this._defaultPitchHeight - 2));\r\n\t\t\t\trectangle.setAttribute(\"fill\", (i == 0) ? ColorConfig.tonic : ColorConfig.uiWidgetBackground);\r\n\t\t\t\tthis._svgNoteBackground.appendChild(rectangle);\r\n\t\t\t\tthis._backgroundPitchRows[i] = rectangle;\r\n\t\t\t}\r\n\r\n\t\t\tthis._svg.style.backgroundColor = ColorConfig.editorBackground;\r\n\r\n\t\t\tthis._backgroundDrumRow.setAttribute(\"x\", \"1\");\r\n\t\t\tthis._backgroundDrumRow.setAttribute(\"y\", \"1\");\r\n\t\t\tthis._backgroundDrumRow.setAttribute(\"height\", \"\" + (this._defaultDrumHeight - 2));\r\n\t\t\tthis._backgroundDrumRow.setAttribute(\"fill\", \"#444444\");\r\n\t\t\tthis._svgDrumBackground.appendChild(this._backgroundDrumRow);\r\n\t\t\t\r\n\t\t\tthis._doc.notifier.watch(this._documentChanged);\r\n\t\t\tthis._documentChanged();\r\n\t\t\tthis._updateCursorStatus();\r\n\t\t\tthis._updatePreview();\r\n\t\t\twindow.requestAnimationFrame(this._animatePlayhead);\r\n\t\t\tthis._svg.addEventListener(\"mousedown\", this._whenMousePressed);\r\n\t\t\tdocument.addEventListener(\"mousemove\", this._whenMouseMoved);\r\n\t\t\tdocument.addEventListener(\"mouseup\", this._whenCursorReleased);\r\n\t\t\tthis._svg.addEventListener(\"mouseover\", this._whenMouseOver);\r\n\t\t\tthis._svg.addEventListener(\"mouseout\", this._whenMouseOut);\r\n\t\t\t\r\n\t\t\tthis._svg.addEventListener(\"touchstart\", this._whenTouchPressed);\r\n\t\t\tthis._svg.addEventListener(\"touchmove\", this._whenTouchMoved);\r\n\t\t\tthis._svg.addEventListener(\"touchend\", this._whenCursorReleased);\r\n\t\t\tthis._svg.addEventListener(\"touchcancel\", this._whenCursorReleased);\r\n\t\t\t\r\n\t\t\tthis.resetCopiedPins();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _getMaxDivision(): number {\r\n\t\t\tif (this._doc.song.partsPerBeat % 3 == 0) {\r\n\t\t\t\t// Beat is divisible by 3.\r\n\t\t\t\treturn this._doc.song.partsPerBeat / 3;\r\n\t\t\t} else if (this._doc.song.partsPerBeat % 2 == 0) {\r\n\t\t\t\t// Beat is divisible by 2.\r\n\t\t\t\treturn this._doc.song.partsPerBeat / 2;\r\n\t\t\t}\r\n\t\t\treturn this._doc.song.partsPerBeat;\r\n\t\t}\r\n\t\t\r\n\t\tprivate _updateCursorStatus(): void {\r\n\t\t\t//if (this._pattern == null) return;\r\n\t\t\t\r\n\t\t\tthis._cursor = new PatternCursor();\r\n\t\t\t\r\n\t\t\tif (this._mouseX < 0 || this._mouseX > this._editorWidth || this._mouseY < 0 || this._mouseY > this._editorHeight) return;\r\n\t\t\t\r\n\t\t\tthis._cursor.part = Math.floor(Math.max(0, Math.min(this._doc.song.beatsPerBar * this._doc.song.partsPerBeat - 1, this._mouseX / this._partWidth)));\r\n\t\t\t\r\n\t\t\tif (this._pattern != null) {\r\n\t\t\t\tfor (const note of this._pattern.notes) {\r\n\t\t\t\t\tif (note.end <= this._cursor.part) {\r\n\t\t\t\t\t\tthis._cursor.prevNote = note;\r\n\t\t\t\t\t\tthis._cursor.curIndex++;\r\n\t\t\t\t\t} else if (note.start <= this._cursor.part && note.end > this._cursor.part) {\r\n\t\t\t\t\t\tthis._cursor.curNote = note;\r\n\t\t\t\t\t} else if (note.start > this._cursor.part) {\r\n\t\t\t\t\t\tthis._cursor.nextNote = note;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tlet mousePitch: number = this._findMousePitch(this._mouseY);\r\n\t\t\t\r\n\t\t\tif (this._cursor.curNote != null) {\r\n\t\t\t\tthis._cursor.start = this._cursor.curNote.start;\r\n\t\t\t\tthis._cursor.end   = this._cursor.curNote.end;\r\n\t\t\t\tthis._cursor.pins  = this._cursor.curNote.pins;\r\n\t\t\t\t\r\n\t\t\t\tlet interval: number = 0;\r\n\t\t\t\tlet error: number = 0;\r\n\t\t\t\tlet prevPin: NotePin;\r\n\t\t\t\tlet nextPin: NotePin = this._cursor.curNote.pins[0];\r\n\t\t\t\tfor (let j: number = 1; j < this._cursor.curNote.pins.length; j++) {\r\n\t\t\t\t\tprevPin = nextPin;\r\n\t\t\t\t\tnextPin = this._cursor.curNote.pins[j];\r\n\t\t\t\t\tconst leftSide:    number = this._partWidth * (this._cursor.curNote.start + prevPin.time);\r\n\t\t\t\t\tconst rightSide:   number = this._partWidth * (this._cursor.curNote.start + nextPin.time);\r\n\t\t\t\t\tif (this._mouseX > rightSide) continue;\r\n\t\t\t\t\tif (this._mouseX < leftSide) throw new Error();\r\n\t\t\t\t\tconst intervalRatio: number = (this._mouseX - leftSide) / (rightSide - leftSide);\r\n\t\t\t\t\tconst arc: number = Math.sqrt(1.0 / Math.sqrt(4.0) - Math.pow(intervalRatio - 0.5, 2.0)) - 0.5;\r\n\t\t\t\t\tconst bendHeight: number = Math.abs(nextPin.interval - prevPin.interval);\r\n\t\t\t\t\tinterval = prevPin.interval * (1.0 - intervalRatio) + nextPin.interval * intervalRatio;\r\n\t\t\t\t\terror = arc * bendHeight + 1.0;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tlet minInterval: number = Number.MAX_VALUE;\r\n\t\t\t\tlet maxInterval: number = -Number.MAX_VALUE;\r\n\t\t\t\tlet bestDistance: number = Number.MAX_VALUE;\r\n\t\t\t\tfor (const pin of this._cursor.curNote.pins) {\r\n\t\t\t\t\tif (minInterval > pin.interval) minInterval = pin.interval;\r\n\t\t\t\t\tif (maxInterval < pin.interval) maxInterval = pin.interval;\r\n\t\t\t\t\tconst pinDistance: number = Math.abs(this._cursor.curNote.start + pin.time - this._mouseX / this._partWidth);\r\n\t\t\t\t\tif (bestDistance > pinDistance) {\r\n\t\t\t\t\t\tbestDistance = pinDistance;\r\n\t\t\t\t\t\tthis._cursor.nearPinIndex = this._cursor.curNote.pins.indexOf(pin);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tmousePitch -= interval;\r\n\t\t\t\tthis._cursor.pitch = this._snapToPitch(mousePitch, -minInterval, (this._doc.song.getChannelIsDrum(this._doc.channel) ? Config.drumCount - 1 : Config.maxPitch) - maxInterval);\r\n\t\t\t\t\r\n\t\t\t\t// Snap to nearby existing note if present.\r\n\t\t\t\t// @TODO: Do this for all channels? ModBox excludes the 4th\r\n\t\t\t\t// channel for some unknown reason.\r\n\t\t\t\tif (this._doc.channel != 3/*!this._doc.song.getChannelIsDrum(this._doc.channel)*/) {\r\n\t\t\t\t\tlet nearest: number = error;\r\n\t\t\t\t\tfor (let i: number = 0; i < this._cursor.curNote.pitches.length; i++) {\r\n\t\t\t\t\t\tconst distance: number = Math.abs(this._cursor.curNote.pitches[i] - mousePitch + 0.5);\r\n\t\t\t\t\t\tif (distance > nearest) continue;\r\n\t\t\t\t\t\tnearest = distance;\r\n\t\t\t\t\t\tthis._cursor.pitch = this._cursor.curNote.pitches[i];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tfor (let i: number = 0; i < this._cursor.curNote.pitches.length; i++) {\r\n\t\t\t\t\tif (this._cursor.curNote.pitches[i] == this._cursor.pitch) {\r\n\t\t\t\t\t\tthis._cursor.pitchIndex = i;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthis._cursor.pitch = this._snapToPitch(mousePitch, 0, Config.maxPitch);\r\n\t\t\t\tconst defaultLength: number = this._copiedPins[this._copiedPins.length-1].time;\r\n\t\t\t\tconst fullBeats: number = Math.floor(this._cursor.part / this._doc.song.partsPerBeat);\r\n\t\t\t\tconst maxDivision: number = this._getMaxDivision();\r\n\t\t\t\tconst modMouse: number = this._cursor.part % this._doc.song.partsPerBeat;\r\n\t\t\t\tif (defaultLength == 1) {\r\n\t\t\t\t\tthis._cursor.start = this._cursor.part;\r\n\t\t\t\t} else if (defaultLength > this._doc.song.partsPerBeat) {\r\n\t\t\t\t\tthis._cursor.start = fullBeats * this._doc.song.partsPerBeat;\r\n\t\t\t\t} else if (defaultLength == this._doc.song.partsPerBeat) {\r\n\t\t\t\t\tthis._cursor.start = fullBeats * this._doc.song.partsPerBeat;\r\n\t\t\t\t\tif (maxDivision < this._doc.song.partsPerBeat && modMouse > maxDivision) {\r\n\t\t\t\t\t\tthis._cursor.start += Math.floor(modMouse / maxDivision) * maxDivision;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis._cursor.start = fullBeats * this._doc.song.partsPerBeat;\r\n\t\t\t\t\tlet division = this._doc.song.partsPerBeat % defaultLength == 0 ? defaultLength : Math.min(defaultLength, maxDivision);\r\n\t\t\t\t\twhile (division < maxDivision && this._doc.song.partsPerBeat % division != 0) {\r\n\t\t\t\t\t\tdivision++;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis._cursor.start += Math.floor(modMouse / division) * division;\r\n\t\t\t\t}\r\n\t\t\t\tthis._cursor.end = this._cursor.start + defaultLength;\r\n\t\t\t\tlet forceStart: number = 0;\r\n\t\t\t\tlet forceEnd: number = this._doc.song.beatsPerBar * this._doc.song.partsPerBeat;\r\n\t\t\t\tif (this._cursor.prevNote != null) {\r\n\t\t\t\t\tforceStart = this._cursor.prevNote.end;\r\n\t\t\t\t}\r\n\t\t\t\tif (this._cursor.nextNote != null) {\r\n\t\t\t\t\tforceEnd   = this._cursor.nextNote.start;\r\n\t\t\t\t}\r\n\t\t\t\tif (this._cursor.start < forceStart) {\r\n\t\t\t\t\tthis._cursor.start = forceStart;\r\n\t\t\t\t\tthis._cursor.end = this._cursor.start + defaultLength;\r\n\t\t\t\t\tif (this._cursor.end > forceEnd) {\r\n\t\t\t\t\t\tthis._cursor.end = forceEnd;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (this._cursor.end > forceEnd) {\r\n\t\t\t\t\tthis._cursor.end = forceEnd;\r\n\t\t\t\t\tthis._cursor.start = this._cursor.end - defaultLength;\r\n\t\t\t\t\tif (this._cursor.start < forceStart) {\r\n\t\t\t\t\t\tthis._cursor.start = forceStart;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif (this._cursor.end - this._cursor.start == defaultLength) {\r\n\t\t\t\t\tthis._cursor.pins = this._copiedPins;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis._cursor.pins = [];\r\n\t\t\t\t\tfor (const oldPin of this._copiedPins) {\r\n\t\t\t\t\t\tif (oldPin.time <= this._cursor.end - this._cursor.start) {\r\n\t\t\t\t\t\t\tthis._cursor.pins.push(makeNotePin(0, oldPin.time, oldPin.volume));\r\n\t\t\t\t\t\t\tif (oldPin.time == this._cursor.end - this._cursor.start) break;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis._cursor.pins.push(makeNotePin(0, this._cursor.end - this._cursor.start, oldPin.volume));\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._cursor.valid = true;\r\n\t\t}\r\n\t\t\r\n\t\tprivate _findMousePitch(pixelY: number): number {\r\n\t\t\treturn Math.max(0, Math.min(this._pitchCount - 1, this._pitchCount - (pixelY / this._pitchHeight))) + this._octaveOffset;\r\n\t\t}\r\n\t\t\r\n\t\tprivate _snapToPitch(guess: number, min: number, max: number): number {\r\n\t\t\tif (guess < min) guess = min;\r\n\t\t\tif (guess > max) guess = max;\r\n\t\t\tconst scale: ReadonlyArray<boolean> = Config.scales[this._doc.song.scale].flags;\r\n\t\t\tif (scale[Math.floor(guess) % 12] || this._doc.song.getChannelIsDrum(this._doc.channel)) {\r\n\t\t\t\treturn Math.floor(guess);\r\n\t\t\t} else {\r\n\t\t\t\tlet topPitch: number = Math.floor(guess) + 1;\r\n\t\t\t\tlet bottomPitch: number = Math.floor(guess) - 1;\r\n\t\t\t\twhile (!scale[topPitch % 12]) {\r\n\t\t\t\t\ttopPitch++;\r\n\t\t\t\t}\r\n\t\t\t\twhile (!scale[(bottomPitch) % 12]) {\r\n\t\t\t\t\tbottomPitch--;\r\n\t\t\t\t}\r\n\t\t\t\tif (topPitch > max) {\r\n\t\t\t\t\tif (bottomPitch < min) {\r\n\t\t\t\t\t\treturn min;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn bottomPitch;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (bottomPitch < min) {\r\n\t\t\t\t\treturn topPitch;\r\n\t\t\t\t}\r\n\t\t\t\tlet topRange: number = topPitch;\r\n\t\t\t\tlet bottomRange: number = bottomPitch + 1;\r\n\t\t\t\tif (topPitch % 12 == 0 || topPitch % 12 == 7) {\r\n\t\t\t\t\ttopRange -= 0.5;\r\n\t\t\t\t}\r\n\t\t\t\tif (bottomPitch % 12 == 0 || bottomPitch % 12 == 7) {\r\n\t\t\t\t\tbottomRange += 0.5;\r\n\t\t\t\t}\r\n\t\t\t\treturn guess - bottomRange > topRange - guess ? topPitch : bottomPitch;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tprivate _copyPins(note: Note): void {\r\n\t\t\tthis._copiedPins = [];\r\n\t\t\tfor (const oldPin of note.pins) {\r\n\t\t\t\tthis._copiedPins.push(makeNotePin(0, oldPin.time, oldPin.volume));\r\n\t\t\t}\r\n\t\t\tfor (let i: number = 1; i < this._copiedPins.length - 1; ) {\r\n\t\t\t\tif (this._copiedPins[i-1].volume == this._copiedPins[i].volume && \r\n\t\t\t\t    this._copiedPins[i].volume == this._copiedPins[i+1].volume)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis._copiedPins.splice(i, 1);\r\n\t\t\t\t} else {\r\n\t\t\t\t\ti++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis._copiedPinChannels[this._doc.channel] = this._copiedPins;\r\n\t\t}\r\n\t\t\r\n\t\tpublic resetCopiedPins = (): void => {\r\n\t\t\tconst maxDivision: number = this._getMaxDivision();\r\n\t\t\tthis._copiedPinChannels.length = this._doc.song.getChannelCount();\r\n\t\t\tfor (let i: number = 0; i < this._doc.song.pitchChannelCount; i++) {\r\n\t\t\t\tthis._copiedPinChannels[i] = [makeNotePin(0, 0, 3), makeNotePin(0, maxDivision, 3)];\r\n\t\t\t}\r\n\t\t\tfor (let i: number = this._doc.song.pitchChannelCount; i < this._doc.song.getChannelCount(); i++) {\r\n\t\t\t\tthis._copiedPinChannels[i] = [makeNotePin(0, 0, 3), makeNotePin(0, maxDivision, 0)];\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tprivate _animatePlayhead = (timestamp: number): void => {\r\n\t\t\tconst playheadBar: number = Math.floor(this._doc.synth.playhead);\r\n\t\t\tif (this._doc.synth.playing && ((this._pattern != null && this._doc.song.getPattern(this._doc.channel, Math.floor(this._doc.synth.playhead)) == this._pattern) || Math.floor(this._doc.synth.playhead) == this._doc.bar)) {\r\n\t\t\t\tthis._svgPlayhead.setAttribute(\"visibility\", \"visible\");\r\n\t\t\t\tconst modPlayhead: number = this._doc.synth.playhead - playheadBar;\r\n\t\t\t\tif (Math.abs(modPlayhead - this._playheadX) > 0.1) {\r\n\t\t\t\t\tthis._playheadX = modPlayhead;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis._playheadX += (modPlayhead - this._playheadX) * 0.2;\r\n\t\t\t\t}\r\n\t\t\t\tthis._svgPlayhead.setAttribute(\"x\", \"\" + prettyNumber(this._playheadX * this._editorWidth - 2));\r\n\t\t\t} else {\r\n\t\t\t\tthis._svgPlayhead.setAttribute(\"visibility\", \"hidden\"); \r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (this._doc.synth.playing && this._doc.prefs.autoFollow && this._followPlayheadBar != playheadBar) {\r\n\t\t\t\tnew ChangeChannelBar(this._doc, this._doc.channel, playheadBar);\r\n\t\t\t\tthis._doc.notifier.notifyWatchers();\r\n\t\t\t}\r\n\t\t\tthis._followPlayheadBar = playheadBar;\r\n\t\t\twindow.requestAnimationFrame(this._animatePlayhead);\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenMouseOver = (event: MouseEvent): void => {\r\n\t\t\tif (this._mouseOver) return;\r\n\t\t\tthis._mouseOver = true;\r\n\t\t\tthis._usingTouch = false;\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenMouseOut = (event: MouseEvent): void => {\r\n\t\t\tif (!this._mouseOver) return;\r\n\t\t\tthis._mouseOver = false;\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenMousePressed = (event: MouseEvent): void => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tconst boundingRect: ClientRect = this._svg.getBoundingClientRect();\r\n    \t\tthis._mouseX = ((event.clientX || event.pageX) - boundingRect.left) * this._editorWidth / (boundingRect.right - boundingRect.left);\r\n\t\t    this._mouseY = ((event.clientY || event.pageY) - boundingRect.top) * this._editorHeight / (boundingRect.bottom - boundingRect.top);\r\n\t\t    if (isNaN(this._mouseX)) this._mouseX = 0;\r\n\t\t    if (isNaN(this._mouseY)) this._mouseY = 0;\r\n\t\t\tthis._usingTouch = false;\r\n\t\t\tthis._whenCursorPressed();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenTouchPressed = (event: TouchEvent): void => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tconst boundingRect: ClientRect = this._svg.getBoundingClientRect();\r\n\t\t\tthis._mouseX = (event.touches[0].clientX - boundingRect.left) * this._editorWidth / (boundingRect.right - boundingRect.left);\r\n\t\t\tthis._mouseY = (event.touches[0].clientY - boundingRect.top) * this._editorHeight / (boundingRect.bottom - boundingRect.top);\r\n\t\t    if (isNaN(this._mouseX)) this._mouseX = 0;\r\n\t\t    if (isNaN(this._mouseY)) this._mouseY = 0;\r\n\t\t\tthis._usingTouch = true;\r\n\t\t\tthis._whenCursorPressed();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenCursorPressed(): void {\r\n\t\t\tthis._mouseDown = true;\r\n\t\t\tthis._mouseXStart = this._mouseX;\r\n\t\t\tthis._mouseYStart = this._mouseY;\r\n\t\t\tthis._mouseXPrev = this._mouseX;\r\n\t\t\tthis._mouseYPrev = this._mouseY;\r\n\t\t\tthis._updateCursorStatus();\r\n\t\t\tthis._updatePreview();\r\n\t\t\tthis._dragChange = new ChangeSequence();\r\n\t\t\tthis._doc.setProspectiveChange(this._dragChange);\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenMouseMoved = (event: MouseEvent): void => {\r\n\t\t\tconst boundingRect: ClientRect = this._svg.getBoundingClientRect();\r\n    \t\tthis._mouseX = ((event.clientX || event.pageX) - boundingRect.left) * this._editorWidth / (boundingRect.right - boundingRect.left);\r\n\t\t    this._mouseY = ((event.clientY || event.pageY) - boundingRect.top) * this._editorHeight / (boundingRect.bottom - boundingRect.top);\r\n\t\t    if (isNaN(this._mouseX)) this._mouseX = 0;\r\n\t\t    if (isNaN(this._mouseY)) this._mouseY = 0;\r\n\t\t\tthis._usingTouch = false;\r\n\t\t    this._whenCursorMoved();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenTouchMoved = (event: TouchEvent): void => {\r\n\t\t\tif (!this._mouseDown) return;\r\n\t\t\tevent.preventDefault();\r\n\t\t\tconst boundingRect: ClientRect = this._svg.getBoundingClientRect();\r\n\t\t\tthis._mouseX = (event.touches[0].clientX - boundingRect.left) * this._editorWidth / (boundingRect.right - boundingRect.left);\r\n\t\t\tthis._mouseY = (event.touches[0].clientY - boundingRect.top) * this._editorHeight / (boundingRect.bottom - boundingRect.top);\r\n\t\t    if (isNaN(this._mouseX)) this._mouseX = 0;\r\n\t\t    if (isNaN(this._mouseY)) this._mouseY = 0;\r\n\t\t    this._whenCursorMoved();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenCursorMoved(): void {\r\n\t\t\tlet start: number;\r\n\t\t\tlet end: number;\r\n\t\t\t\r\n\t\t\t// HACK: Undoable pattern changes rely on persistent instance\r\n\t\t\t// references. Loading song from hash via undo/redo breaks that,\r\n\t\t\t// so changes are no longer undoable and the cursor status may be\r\n\t\t\t// invalid. Abort further drag changes until the mouse is released.\r\n\t\t\tconst continuousState: boolean = this._doc.lastChangeWas(this._dragChange);\r\n\t\t\t\r\n\t\t\tif (this._mouseDown && this._cursor.valid && continuousState) {\r\n\t\t\t\tif (!this._mouseDragging) {\r\n\t\t\t\t\tconst dx: number = this._mouseX - this._mouseXStart;\r\n\t\t\t\t\tconst dy: number = this._mouseY - this._mouseYStart;\r\n\t\t\t\t\tif (Math.sqrt(dx * dx + dy * dy) > 5) {\r\n\t\t\t\t\t\tthis._mouseDragging = true;\r\n\t\t\t\t\t\tthis._mouseHorizontal = Math.abs(dx) >= Math.abs(dy);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif (this._mouseDragging) {\r\n\t\t\t\t\tif (this._dragChange != null) {\r\n\t\t\t\t\t\tthis._dragChange.undo();\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tconst currentPart: number = Math.floor(this._mouseX / this._partWidth);\r\n\t\t\t\t\tconst sequence: ChangeSequence = new ChangeSequence();\r\n\t\t\t\t\tthis._dragChange = sequence;\r\n\t\t\t\t\tthis._doc.setProspectiveChange(this._dragChange);\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (this._cursor.curNote == null) {\r\n\t\t\t\t\t\tlet backwards: boolean;\r\n\t\t\t\t\t\tlet directLength: number;\r\n\t\t\t\t\t\tif (currentPart < this._cursor.start) {\r\n\t\t\t\t\t\t\tbackwards = true;\r\n\t\t\t\t\t\t\tdirectLength = this._cursor.start - currentPart;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tbackwards = false;\r\n\t\t\t\t\t\t\tdirectLength = currentPart - this._cursor.start + 1;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tlet defaultLength: number = 1;\r\n\t\t\t\t\t\tfor (let i: number = 0; i <= this._doc.song.beatsPerBar * this._doc.song.partsPerBeat; i++) {\r\n\t\t\t\t\t\t\tif (i >= 5 &&\r\n\t\t\t\t\t\t\t    i % this._doc.song.partsPerBeat != 0 &&\r\n\t\t\t\t\t\t\t    i != this._doc.song.partsPerBeat * 3.0 / 2.0 &&\r\n\t\t\t\t\t\t\t    i != this._doc.song.partsPerBeat * 4.0 / 3.0 &&\r\n\t\t\t\t\t\t\t    i != this._doc.song.partsPerBeat * 5.0 / 3.0)\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tconst blessedLength: number = i;\r\n\t\t\t\t\t\t\tif (blessedLength == directLength) {\r\n\t\t\t\t\t\t\t\tdefaultLength = blessedLength;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (blessedLength < directLength) {\r\n\t\t\t\t\t\t\t\tdefaultLength = blessedLength;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (blessedLength > directLength) {\r\n\t\t\t\t\t\t\t\tif (defaultLength < directLength - 1) {\r\n\t\t\t\t\t\t\t\t\tdefaultLength = blessedLength;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t/*\r\n\t\t\t\t\t\tif (defaultLength < directLength) {\r\n\t\t\t\t\t\t\t// See if I can find a better match by snapping to an existing note...\r\n\t\t\t\t\t\t\t// E.G. in another channel\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t*/\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif (backwards) {\r\n\t\t\t\t\t\t\tend = this._cursor.start;\r\n\t\t\t\t\t\t\tstart = end - defaultLength;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tstart = this._cursor.start;\r\n\t\t\t\t\t\t\tend = start + defaultLength;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (start < 0) start = 0;\r\n\t\t\t\t\t\tif (end > this._doc.song.beatsPerBar * this._doc.song.partsPerBeat) end = this._doc.song.beatsPerBar * this._doc.song.partsPerBeat;\r\n\t\t\t\t\t\tif (start < end) {\r\n\t\t\t\t\t\t\tsequence.append(new ChangeEnsurePatternExists(this._doc));\r\n\t\t\t\t\t\t\t\tconst pattern: Pattern | null = this._doc.getCurrentPattern();\r\n\t\t\t\t\t\t\t\tif (pattern == null) throw new Error();\r\n\t\t\t\t\t\t\t\tsequence.append(new ChangeNoteTruncate(this._doc, pattern, start, end));\r\n\t\t\t\t\t\t\tlet i: number;\r\n\t\t\t\t\t\t\tfor (i = 0; i < pattern.notes.length; i++) {\r\n\t\t\t\t\t\t\t\tif (pattern.notes[i].start >= end) break;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tconst theNote: Note = makeNote(this._cursor.pitch, start, end, 3, this._doc.song.getChannelIsDrum(this._doc.channel));\r\n\t\t\t\t\t\t\tsequence.append(new ChangeNoteAdded(this._doc, pattern, theNote, i));\r\n\t\t\t\t\t\t\tthis._copyPins(theNote);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tthis._dragTime = backwards ? start : end;\r\n\t\t\t\t\t\t\tthis._dragPitch = this._cursor.pitch;\r\n\t\t\t\t\t\t\tthis._dragVolume = theNote.pins[backwards ? 0 : 1].volume;\r\n\t\t\t\t\t\t\tthis._dragVisible = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis._pattern = this._doc.getCurrentPattern();\r\n\t\t\t\t\t} else if (this._mouseHorizontal) {\r\n\t\t\t\t\t\tconst shift: number = Math.round((this._mouseX - this._mouseXStart) / this._partWidth);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tconst shiftedPin: NotePin = this._cursor.curNote.pins[this._cursor.nearPinIndex];\r\n\t\t\t\t\t\tlet shiftedTime: number = this._cursor.curNote.start + shiftedPin.time + shift;\r\n\t\t\t\t\t\tif (shiftedTime < 0) shiftedTime = 0;\r\n\t\t\t\t\t\tif (shiftedTime > this._doc.song.beatsPerBar * this._doc.song.partsPerBeat) shiftedTime = this._doc.song.beatsPerBar * this._doc.song.partsPerBeat;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif (this._pattern == null) throw new Error();\r\n\r\n\t\t\t\t\t\tif (shiftedTime <= this._cursor.curNote.start && this._cursor.nearPinIndex == this._cursor.curNote.pins.length - 1 ||\r\n\t\t\t\t\t\t    shiftedTime >= this._cursor.curNote.end   && this._cursor.nearPinIndex == 0)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tsequence.append(new ChangeNoteAdded(this._doc, this._pattern, this._cursor.curNote, this._cursor.curIndex, true));\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tthis._dragVisible = false;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tstart = Math.min(this._cursor.curNote.start, shiftedTime);\r\n\t\t\t\t\t\t\tend   = Math.max(this._cursor.curNote.end,   shiftedTime);\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tthis._dragTime = shiftedTime;\r\n\t\t\t\t\t\t\tthis._dragPitch = this._cursor.curNote.pitches[this._cursor.pitchIndex == -1 ? 0 : this._cursor.pitchIndex] + this._cursor.curNote.pins[this._cursor.nearPinIndex].interval;\r\n\t\t\t\t\t\t\tthis._dragVolume = this._cursor.curNote.pins[this._cursor.nearPinIndex].volume;\r\n\t\t\t\t\t\t\tthis._dragVisible = true;\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif (this._pattern == null) throw new Error();\r\n\r\n\t\t\t\t\t\t\tsequence.append(new ChangeNoteTruncate(this._doc, this._pattern, start, end, this._cursor.curNote));\r\n\t\t\t\t\t\t\tsequence.append(new ChangePinTime(this._doc, this._cursor.curNote, this._cursor.nearPinIndex, shiftedTime));\r\n\t\t\t\t\t\t\tthis._copyPins(this._cursor.curNote);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if (this._cursor.pitchIndex == -1) {\r\n\t\t\t\t\t\tconst bendPart: number = Math.round(Math.max(this._cursor.curNote.start, Math.min(this._cursor.curNote.end, this._mouseX / this._partWidth))) - this._cursor.curNote.start;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tlet prevPin: NotePin;\r\n\t\t\t\t\t\tlet nextPin: NotePin = this._cursor.curNote.pins[0];\r\n\t\t\t\t\t\tlet bendVolume: number = 0;\r\n\t\t\t\t\t\tlet bendInterval: number = 0;\r\n\t\t\t\t\t\tfor (let i: number = 1; i < this._cursor.curNote.pins.length; i++) {\r\n\t\t\t\t\t\t\tprevPin = nextPin;\r\n\t\t\t\t\t\t\tnextPin = this._cursor.curNote.pins[i];\r\n\t\t\t\t\t\t\tif (bendPart > nextPin.time) continue;\r\n\t\t\t\t\t\t\tif (bendPart < prevPin.time) throw new Error();\r\n\t\t\t\t\t\t\tconst volumeRatio: number = (bendPart - prevPin.time) / (nextPin.time - prevPin.time);\r\n\t\t\t\t\t\t\tbendVolume = Math.round(prevPin.volume * (1.0 - volumeRatio) + nextPin.volume * volumeRatio + ((this._mouseYStart - this._mouseY) / 20.0/*25.0*/));\r\n\t\t\t\t\t\t\tif (bendVolume < 0) bendVolume = 0;\r\n\t\t\t\t\t\t\tif (bendVolume > 3) bendVolume = 3;\r\n\t\t\t\t\t\t\tbendInterval = this._snapToPitch(prevPin.interval * (1.0 - volumeRatio) + nextPin.interval * volumeRatio + this._cursor.curNote.pitches[0], 0, Config.maxPitch) - this._cursor.curNote.pitches[0];\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis._dragTime = this._cursor.curNote.start + bendPart;\r\n\t\t\t\t\t\tthis._dragPitch = this._cursor.curNote.pitches[this._cursor.pitchIndex == -1 ? 0 : this._cursor.pitchIndex] + bendInterval;\r\n\t\t\t\t\t\tthis._dragVolume = bendVolume;\r\n\t\t\t\t\t\tthis._dragVisible = true;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tsequence.append(new ChangeVolumeBend(this._doc, this._cursor.curNote, bendPart, bendVolume, bendInterval));\r\n\t\t\t\t\t\tthis._copyPins(this._cursor.curNote);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis._dragVolume = this._cursor.curNote.pins[this._cursor.nearPinIndex].volume;\r\n\r\n\t\t\t\t\t\tif (this._pattern == null) throw new Error();\r\n\r\n\t\t\t\t\t\tlet bendStart: number;\r\n\t\t\t\t\t\tlet bendEnd: number;\r\n\t\t\t\t\t\tif (this._mouseX >= this._mouseXStart) {\r\n\t\t\t\t\t\t\tbendStart = this._cursor.part;\r\n\t\t\t\t\t\t\tbendEnd   = currentPart + 1;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tbendStart = this._cursor.part + 1;\r\n\t\t\t\t\t\t\tbendEnd   = currentPart;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (bendEnd < 0) bendEnd = 0;\r\n\t\t\t\t\t\tif (bendEnd > this._doc.song.beatsPerBar * this._doc.song.partsPerBeat) bendEnd = this._doc.song.beatsPerBar * this._doc.song.partsPerBeat;\r\n\t\t\t\t\t\tif (bendEnd > this._cursor.curNote.end) {\r\n\t\t\t\t\t\t\tsequence.append(new ChangeNoteTruncate(this._doc, this._pattern, this._cursor.curNote.start, bendEnd, this._cursor.curNote));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (bendEnd < this._cursor.curNote.start) {\r\n\t\t\t\t\t\t\tsequence.append(new ChangeNoteTruncate(this._doc, this._pattern, bendEnd, this._cursor.curNote.end, this._cursor.curNote));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tlet minPitch: number = Number.MAX_VALUE;\r\n\t\t\t\t\t\tlet maxPitch: number = -Number.MAX_VALUE;\r\n\t\t\t\t\t\tfor (const pitch of this._cursor.curNote.pitches) {\r\n\t\t\t\t\t\t\tif (minPitch > pitch) minPitch = pitch;\r\n\t\t\t\t\t\t\tif (maxPitch < pitch) maxPitch = pitch;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tminPitch -= this._cursor.curNote.pitches[this._cursor.pitchIndex];\r\n\t\t\t\t\t\tmaxPitch -= this._cursor.curNote.pitches[this._cursor.pitchIndex];\r\n\t\t\t\t\t\tconst bendTo: number = this._snapToPitch(this._findMousePitch(this._mouseY), -minPitch, (this._doc.song.getChannelIsDrum(this._doc.channel) ? Config.drumCount-1 : Config.maxPitch) - maxPitch);\r\n\t\t\t\t\t\tsequence.append(new ChangePitchBend(this._doc, this._cursor.curNote, bendStart, bendEnd, bendTo, this._cursor.pitchIndex));\r\n\t\t\t\t\t\tthis._copyPins(this._cursor.curNote);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tthis._dragTime = bendEnd;\r\n\t\t\t\t\t\tthis._dragPitch = bendTo;\r\n\t\t\t\t\t\tthis._dragVisible = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tthis._mouseXPrev = this._mouseX;\r\n\t\t\t\tthis._mouseYPrev = this._mouseY;\r\n\t\t\t} else {\r\n\t\t\t\tthis._updateCursorStatus();\r\n\t\t\t\tthis._updatePreview();\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenCursorReleased = (event: Event): void => {\r\n\t\t\tif (!this._cursor.valid) return;\r\n\t\t\tconst continuousState: boolean = this._doc.lastChangeWas(this._dragChange);\r\n\t\t\tif (this._mouseDragging && continuousState) {\r\n\t\t\t\tif (this._dragChange != null) {\r\n\t\t\t\t\tthis._doc.record(this._dragChange);\r\n\t\t\t\t\tthis._dragChange = null;\r\n\t\t\t\t}\r\n\t\t\t} else if (this._mouseDown && continuousState) {\r\n\t\t\t\tif (this._cursor.curNote == null) {\r\n\t\t\t\t\tconst note: Note = makeNote(this._cursor.pitch, this._cursor.start, this._cursor.end, 3, this._doc.song.getChannelIsDrum(this._doc.channel));\r\n\t\t\t\t\tnote.pins = [];\r\n\t\t\t\t\tfor (const oldPin of this._cursor.pins) {\r\n\t\t\t\t\t\tnote.pins.push(makeNotePin(0, oldPin.time, oldPin.volume));\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconst sequence: ChangeSequence = new ChangeSequence();\r\n\t\t\t\t\tsequence.append(new ChangeEnsurePatternExists(this._doc));\r\n\t\t\t\t\tconst pattern: Pattern | null = this._doc.getCurrentPattern();\r\n\t\t\t\t\tif (pattern == null) throw new Error();\r\n\t\t\t\t\tsequence.append(new ChangeNoteAdded(this._doc, pattern, note, this._cursor.curIndex));\r\n\t\t\t\t\tthis._doc.record(sequence);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (this._pattern == null) throw new Error();\r\n\t\t\t\t\tif (this._cursor.pitchIndex == -1) {\r\n\t\t\t\t\t\tconst sequence: ChangeSequence = new ChangeSequence();\r\n\t\t\t\t\t\tif (this._cursor.curNote.pitches.length == 4) {\r\n\t\t\t\t\t\t\tsequence.append(new ChangePitchAdded(this._doc, this._cursor.curNote, this._cursor.curNote.pitches[0], 0, true));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tsequence.append(new ChangePitchAdded(this._doc, this._cursor.curNote, this._cursor.pitch, this._cursor.curNote.pitches.length));\r\n\t\t\t\t\t\tthis._doc.record(sequence);\r\n\t\t\t\t\t\tthis._copyPins(this._cursor.curNote);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (this._cursor.curNote.pitches.length == 1) {\r\n\t\t\t\t\t\t\tthis._doc.record(new ChangeNoteAdded(this._doc, this._pattern, this._cursor.curNote, this._cursor.curIndex, true));\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis._doc.record(new ChangePitchAdded(this._doc, this._cursor.curNote, this._cursor.pitch, this._cursor.curNote.pitches.indexOf(this._cursor.pitch), true));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._mouseDown = false;\r\n\t\t\tthis._mouseDragging = false;\r\n\t\t\tthis._updateCursorStatus();\r\n\t\t\tthis._updatePreview();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _updatePreview(): void {\r\n\t\t\tif (this._usingTouch) {\r\n\t\t\t\tif (!this._mouseDown || !this._cursor.valid  || !this._mouseDragging || !this._dragVisible) {\r\n\t\t\t\t\tthis._svgPreview.setAttribute(\"visibility\", \"hidden\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis._svgPreview.setAttribute(\"visibility\", \"visible\");\r\n\t\t\t\t\t\r\n\t\t\t\t\tconst x: number = this._partWidth * this._dragTime;\r\n\t\t\t\t\tconst y: number = this._pitchToPixelHeight(this._dragPitch - this._octaveOffset);\r\n\t\t\t\t\tconst radius: number = this._pitchHeight / 2;\r\n\t\t\t\t\tconst width: number = 80;\r\n\t\t\t\t\tconst height: number = 60;\r\n\t\t\t\t\t//this._drawNote(this._svgPreview, this._cursor.pitch, this._cursor.start, this._cursor.pins, this._pitchHeight / 2 + 1, true, this._octaveOffset);\r\n\t\t\t\t\t\r\n\t\t\t\t\tlet pathString: string = \"\";\r\n\t\t\t\t\t\r\n\t\t\t\t\tpathString += \"M \" + prettyNumber(x) + \" \" + prettyNumber(y - radius * (this._dragVolume / 3.0)) + \" \";\r\n\t\t\t\t\tpathString += \"L \" + prettyNumber(x) + \" \" + prettyNumber(y - radius * (this._dragVolume / 3.0) - height) + \" \";\r\n\t\t\t\t\tpathString += \"M \" + prettyNumber(x) + \" \" + prettyNumber(y + radius * (this._dragVolume / 3.0)) + \" \";\r\n\t\t\t\t\tpathString += \"L \" + prettyNumber(x) + \" \" + prettyNumber(y + radius * (this._dragVolume / 3.0) + height) + \" \";\r\n\t\t\t\t\tpathString += \"M \" + prettyNumber(x) + \" \" + prettyNumber(y - radius * (this._dragVolume / 3.0)) + \" \";\r\n\t\t\t\t\tpathString += \"L \" + prettyNumber(x + width) + \" \" + prettyNumber(y - radius * (this._dragVolume / 3.0)) + \" \";\r\n\t\t\t\t\tpathString += \"M \" + prettyNumber(x) + \" \" + prettyNumber(y + radius * (this._dragVolume / 3.0)) + \" \";\r\n\t\t\t\t\tpathString += \"L \" + prettyNumber(x + width) + \" \" + prettyNumber(y + radius * (this._dragVolume / 3.0)) + \" \";\r\n\t\t\t\t\tpathString += \"M \" + prettyNumber(x) + \" \" + prettyNumber(y - radius * (this._dragVolume / 3.0)) + \" \";\r\n\t\t\t\t\tpathString += \"L \" + prettyNumber(x - width) + \" \" + prettyNumber(y - radius * (this._dragVolume / 3.0)) + \" \";\r\n\t\t\t\t\tpathString += \"M \" + prettyNumber(x) + \" \" + prettyNumber(y + radius * (this._dragVolume / 3.0)) + \" \";\r\n\t\t\t\t\tpathString += \"L \" + prettyNumber(x - width) + \" \" + prettyNumber(y + radius * (this._dragVolume / 3.0)) + \" \";\r\n\t\t\t\t\t\r\n\t\t\t\t\tthis._svgPreview.setAttribute(\"d\", pathString);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (!this._mouseOver || this._mouseDown || !this._cursor.valid) {\r\n\t\t\t\t\tthis._svgPreview.setAttribute(\"visibility\", \"hidden\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis._svgPreview.setAttribute(\"visibility\", \"visible\");\r\n\t\t\t\t\tthis._drawNote(this._svgPreview, this._cursor.pitch, this._cursor.start, this._cursor.pins, this._pitchHeight / 2 + 1, true, this._octaveOffset);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\t\r\n\t\tprivate _documentChanged = (): void => {\r\n\t\t\tthis._editorWidth = this._doc.prefs.showLetters ? (this._doc.prefs.showScrollBar ? 460 : 480) : (this._doc.prefs.showScrollBar ? 492 : 512);\r\n\t\t\tthis._pattern = this._doc.getCurrentPattern();\r\n\t\t\tthis._partWidth = this._editorWidth / (this._doc.song.beatsPerBar * this._doc.song.partsPerBeat);\r\n\t\t\tthis._pitchHeight = this._doc.song.getChannelIsDrum(this._doc.channel) ? this._defaultDrumHeight : this._defaultPitchHeight;\r\n\t\t\tthis._pitchCount = this._doc.song.getChannelIsDrum(this._doc.channel) ? Config.drumCount : Config.pitchCount;\r\n\t\t\tthis._octaveOffset = this._doc.song.channels[this._doc.channel].octave * 12;\r\n\t\t\t\r\n\t\t\tif (this._renderedPartsPerBeat != this._doc.song.partsPerBeat || \r\n\t\t\t\tthis._renderedPitchChannelCount != this._doc.song.pitchChannelCount || \r\n\t\t\t\tthis._renderedDrumChannelCount != this._doc.song.drumChannelCount)\r\n\t\t\t{\r\n\t\t\t\tthis._renderedPartsPerBeat = this._doc.song.partsPerBeat;\r\n\t\t\t\tthis._renderedPitchChannelCount = this._doc.song.pitchChannelCount;\r\n\t\t\t\tthis._renderedDrumChannelCount = this._doc.song.drumChannelCount;\r\n\t\t\t\tthis.resetCopiedPins();\r\n\t\t\t}\r\n\t\t\t\r\n\r\n\r\n\t\t\tthis._copiedPins = this._copiedPinChannels[this._doc.channel];\r\n\t\t\t\r\n\t\t\tif (this._renderedWidth != this._editorWidth) {\r\n\t\t\t\tthis._renderedWidth = this._editorWidth;\r\n\t\t\t\t//this._svg.setAttribute(\"width\", \"\" + this._editorWidth);\r\n\t\t\t\tthis._svg.setAttribute(\"viewBox\", \"0 0 \" + this._editorWidth + \" 481\");\r\n\t\t\t\tthis._svgBackground.setAttribute(\"width\", \"\" + this._editorWidth);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tconst beatWidth = this._editorWidth / this._doc.song.beatsPerBar;\r\n\t\t\tif (this._renderedBeatWidth != beatWidth) {\r\n\t\t\t\tthis._renderedBeatWidth = beatWidth;\r\n\t\t\t\tthis._svgNoteBackground.setAttribute(\"width\", \"\" + beatWidth);\r\n\t\t\t\tthis._svgDrumBackground.setAttribute(\"width\", \"\" + beatWidth);\r\n\t\t\t\tthis._backgroundDrumRow.setAttribute(\"width\", \"\" + (beatWidth - 2));\r\n\t\t\t\tfor (let j: number = 0; j < 12; j++) {\r\n\t\t\t\t\tthis._backgroundPitchRows[j].setAttribute(\"width\", \"\" + (beatWidth - 2));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (!this._mouseDown) this._updateCursorStatus();\r\n\t\t\t\r\n\t\t\tthis._svgNoteContainer = <SVGSVGElement> makeEmptyReplacementElement(this._svgNoteContainer);\r\n\t\t\t\r\n\t\t\tthis._updatePreview();\r\n\t\t\r\n\t\t\tfor (let j: number = 0; j < 12; j++) {\r\n\t\t\t\tthis._backgroundPitchRows[j].style.visibility = Config.scales[this._doc.song.scale].flags[j] ? \"visible\" : \"hidden\";\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (this._doc.song.getChannelIsDrum(this._doc.channel)) {\r\n\t\t\t\tif (!this._renderedDrums) {\r\n\t\t\t\t\tthis._renderedDrums = true;\r\n\t\t\t\t\tthis._svgBackground.setAttribute(\"fill\", \"url(#patternEditorDrumBackground)\");\r\n\t\t\t\t\tthis._svgBackground.setAttribute(\"height\", \"\" + (this._defaultDrumHeight * Config.drumCount));\r\n\t\t\t\t\t//this._svg.setAttribute(\"height\", \"\" + (this._defaultDrumHeight * Config.drumCount));\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (this._renderedDrums) {\r\n\t\t\t\t\tthis._renderedDrums = false;\r\n\t\t\t\t\tthis._svgBackground.setAttribute(\"fill\", \"url(#patternEditorNoteBackground)\");\r\n\t\t\t\t\tthis._svgBackground.setAttribute(\"height\", \"\" + this._editorHeight);\r\n\t\t\t\t\t//this._svg.setAttribute(\"height\", \"\" + this._editorHeight);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (this._doc.prefs.showChannels) {\r\n\t\t\t\tfor (let channel: number = this._doc.song.getChannelCount() - 1; channel >= 0; channel--) {\r\n\t\t\t\t\tif (channel == this._doc.channel) continue;\r\n\t\t\t\t\tif (this._doc.song.getChannelIsDrum(channel) != this._doc.song.getChannelIsDrum(this._doc.channel)) continue;\r\n\t\t\t\t\t\r\n\t\t\t\t\tconst pattern2: Pattern | null = this._doc.song.getPattern(channel, this._doc.bar);\r\n\t\t\t\t\tif (pattern2 == null) continue;\r\n\t\t\t\t\tfor (const note of pattern2.notes) {\r\n\t\t\t\t\t\tfor (const pitch of note.pitches) {\r\n\t\t\t\t\t\t\tconst notePath: SVGPathElement = <SVGPathElement> SVG.path();\r\n\t\t\t\t\t\t\tnotePath.setAttribute(\"fill\", ColorConfig.getChannelColor(this._doc.song, channel).secondaryNote);\r\n\t\t\t\t\t\t\tnotePath.setAttribute(\"pointer-events\", \"none\");\r\n\t\t\t\t\t\t\tthis._drawNote(notePath, pitch, note.start, note.pins, this._pitchHeight * 0.19, false, this._doc.song.channels[channel].octave * 12);\r\n\t\t\t\t\t\t\tthis._svgNoteContainer.appendChild(notePath);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (this._pattern != null) {\r\n\t\t\t\tfor (const note of this._pattern.notes) {\r\n\t\t\t\t\tfor (let i: number = 0; i < note.pitches.length; i++) {\r\n\t\t\t\t\t\tconst pitch: number = note.pitches[i];\r\n\t\t\t\t\t\tlet notePath = <SVGPathElement> SVG.path();\r\n\t\t\t\t\t\tnotePath.setAttribute(\"fill\", ColorConfig.getChannelColor(this._doc.song, this._doc.channel).secondaryChannel);\r\n\t\t\t\t\t\tnotePath.setAttribute(\"pointer-events\", \"none\");\r\n\t\t\t\t\t\tthis._drawNote(notePath, pitch, note.start, note.pins, this._pitchHeight / 2 + 1, false, this._octaveOffset);\r\n\t\t\t\t\t\tthis._svgNoteContainer.appendChild(notePath);\r\n\t\t\t\t\t\tnotePath = <SVGPathElement> SVG.path();\r\n\t\t\t\t\t\tnotePath.setAttribute(\"fill\", ColorConfig.getChannelColor(this._doc.song, this._doc.channel).primaryNote);\r\n\t\t\t\t\t\tnotePath.setAttribute(\"pointer-events\", \"none\");\r\n\t\t\t\t\t\tthis._drawNote(notePath, pitch, note.start, note.pins, this._pitchHeight / 2 + 1, true, this._octaveOffset);\r\n\t\t\t\t\t\tthis._svgNoteContainer.appendChild(notePath);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif (note.pitches.length > 1/* && !this._doc.song.getChannelIsDrum(this._doc.channel)*/) {\r\n\t\t\t\t\t\t\t// const instrumentType: InstrumentType = this._doc.song.channels[this._doc.channel].instruments[this._doc.getCurrentInstrument()].type;\r\n\t\t\t\t\t\t\t// if (instrumentType == InstrumentType.fm) {\r\n\t\t\t\t\t\t\t\tlet oscillatorLabel = <SVGTextElement> SVG.text();\r\n\t\t\t\t\t\t\t\toscillatorLabel.setAttribute(\"x\", \"\" + prettyNumber(this._partWidth * note.start + 2));\r\n\t\t\t\t\t\t\t\toscillatorLabel.setAttribute(\"y\", \"\" + prettyNumber(this._pitchToPixelHeight(pitch - this._octaveOffset)));\r\n\t\t\t\t\t\t\t\toscillatorLabel.setAttribute(\"width\", \"30\");\r\n\t\t\t\t\t\t\t\toscillatorLabel.setAttribute(\"fill\", \"black\");\r\n\t\t\t\t\t\t\t\toscillatorLabel.setAttribute(\"text-anchor\", \"start\");\r\n\t\t\t\t\t\t\t\toscillatorLabel.setAttribute(\"dominant-baseline\", \"central\");\r\n\t\t\t\t\t\t\t\toscillatorLabel.setAttribute(\"pointer-events\", \"none\");\r\n\t\t\t\t\t\t\t\toscillatorLabel.textContent = \"\" + (i + 1);\r\n\t\t\t\t\t\t\t\tthis._svgNoteContainer.appendChild(oscillatorLabel);\r\n\t\t\t\t\t\t\t// }\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\r\n\t}\r\n\t\r\n\tpublic render(): void {\r\n\r\n\t\t\tif (this._doc.prefs.showMore == false) {\r\n\r\n\t\t\t\tif (this._renderedFifths != this._doc.prefs.showFifth) {\r\n\t\t\t\t\tthis._renderedFifths = this._doc.prefs.showFifth;\r\n\t\t\t\t\tthis._backgroundPitchRows[7].setAttribute(\"fill\", this._doc.prefs.showFifth ? ColorConfig.fifthNote : ColorConfig.pitchBackground);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this._renderedPiano == true) {\r\n\t\t\t\t\tthis._renderedPiano = false;\r\n\t\t\t\t}\r\n\t\t\tif (this._renderedACS != this._doc.prefs.showMore) {\r\n\t\t\t\tthis._backgroundPitchRows[0].setAttribute(\"fill\", ColorConfig.tonic);\r\n\t\t\t\tthis._backgroundPitchRows[1].setAttribute(\"fill\", this._doc.prefs.showMore ? ColorConfig.pitch1Background : ColorConfig.pitchBackground);\r\n\t\t\t\tthis._backgroundPitchRows[2].setAttribute(\"fill\", this._doc.prefs.showMore ? ColorConfig.pitch2Background : ColorConfig.pitchBackground);\r\n\t\t\t\tthis._backgroundPitchRows[3].setAttribute(\"fill\", this._doc.prefs.showMore ? ColorConfig.pitch3Background : ColorConfig.pitchBackground);\r\n\t\t\t\tthis._backgroundPitchRows[4].setAttribute(\"fill\", this._doc.prefs.showMore ? ColorConfig.pitch4Background : ColorConfig.pitchBackground);\r\n\t\t\t\tthis._backgroundPitchRows[5].setAttribute(\"fill\", this._doc.prefs.showMore ? ColorConfig.pitch5Background : ColorConfig.pitchBackground);\r\n\t\t\t\tthis._backgroundPitchRows[6].setAttribute(\"fill\", this._doc.prefs.showMore ? ColorConfig.pitch6Background : ColorConfig.pitchBackground);\r\n\t\t\t\tthis._backgroundPitchRows[7].setAttribute(\"fill\", this._doc.prefs.showFifth ? ColorConfig.fifthNote : ColorConfig.pitchBackground);\r\n\t\t\t\tthis._backgroundPitchRows[8].setAttribute(\"fill\", this._doc.prefs.showMore ? ColorConfig.pitch8Background : ColorConfig.pitchBackground);\r\n\t\t\t\tthis._backgroundPitchRows[9].setAttribute(\"fill\", this._doc.prefs.showMore ? ColorConfig.pitch9Background : ColorConfig.pitchBackground);\r\n\t\t\t\tthis._backgroundPitchRows[10].setAttribute(\"fill\", this._doc.prefs.showMore ? ColorConfig.pitch10Background : ColorConfig.pitchBackground);\r\n\t\t\t\tthis._backgroundPitchRows[11].setAttribute(\"fill\", this._doc.prefs.showMore ? ColorConfig.pitch11Background : ColorConfig.pitchBackground);\r\n\t\t\t\tthis._renderedACS = this._doc.prefs.showMore;\r\n\t\t\t\tconsole.log(\"this._renderedACS (acs disabled): \"+this._renderedACS);\r\n\t\t\t}\r\n\t\t\tthis._setKey = -1;\r\n\t\t} else {\r\n\t\t\tif (ColorConfig.usesPianoScheme == false) {\r\n\t\t\t\tif (this._renderedACS != this._doc.prefs.showMore || this._renderedPiano == true) {\r\n\t\t\t\t\tthis._backgroundPitchRows[0].setAttribute(\"fill\", this._doc.prefs.showMore ? ColorConfig.tonic : ColorConfig.tonic);\r\n\t\t\t\t\tthis._backgroundPitchRows[1].setAttribute(\"fill\", this._doc.prefs.showMore ? ColorConfig.pitch1Background :  ColorConfig.pitchBackground);\r\n\t\t\t\t\tthis._backgroundPitchRows[2].setAttribute(\"fill\", this._doc.prefs.showMore ? ColorConfig.pitch2Background :  ColorConfig.pitchBackground);\r\n\t\t\t\t\tthis._backgroundPitchRows[3].setAttribute(\"fill\", this._doc.prefs.showMore ? ColorConfig.pitch3Background :  ColorConfig.pitchBackground);\r\n\t\t\t\t\tthis._backgroundPitchRows[4].setAttribute(\"fill\", this._doc.prefs.showMore ? ColorConfig.pitch4Background :  ColorConfig.pitchBackground);\r\n\t\t\t\t\tthis._backgroundPitchRows[5].setAttribute(\"fill\", this._doc.prefs.showMore ? ColorConfig.pitch5Background :  ColorConfig.pitchBackground);\r\n\t\t\t\t\tthis._backgroundPitchRows[6].setAttribute(\"fill\", this._doc.prefs.showMore ? ColorConfig.pitch6Background :  ColorConfig.pitchBackground);\r\n\t\t\t\t\tthis._backgroundPitchRows[7].setAttribute(\"fill\", this._doc.prefs.showFifth ? ColorConfig.fifthNote : ColorConfig.pitchBackground);\r\n\t\t\t\t\tthis._backgroundPitchRows[8].setAttribute(\"fill\", this._doc.prefs.showMore ? ColorConfig.pitch8Background : ColorConfig.pitchBackground);\r\n\t\t\t\t\tthis._backgroundPitchRows[9].setAttribute(\"fill\", this._doc.prefs.showMore ? ColorConfig.pitch9Background : ColorConfig.pitchBackground);\r\n\t\t\t\t\tthis._backgroundPitchRows[10].setAttribute(\"fill\", this._doc.prefs.showMore ? ColorConfig.pitch10Background : ColorConfig.pitchBackground);\r\n\t\t\t\t\tthis._backgroundPitchRows[11].setAttribute(\"fill\", this._doc.prefs.showMore ? ColorConfig.pitch11Background : ColorConfig.pitchBackground);\r\n\t\t\t\t\tthis._renderedACS = this._doc.prefs.showMore;\r\n\t\t\t\t\tconsole.log(\"this._renderedACS (acs enabled): \"+this._renderedACS);\r\n\t\t\t\t} \r\n\t\t\t\tif (this._renderedPiano == true) {\r\n\t\t\t\t\tthis._renderedPiano = false;\r\n\t\t\t\t\tthis._setKey = -1;\r\n\t\t\t\t\tconsole.log(\"this._renderedACS (disabiling piano): \"+this._renderedACS);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (this._setKey != this._doc.song.key) {\r\n\t\t\t\t\t\tthis._setKey = this._doc.song.key;\r\n\t\t\t\t\t\tthis._renderedPiano = true;\r\n\t\t\t\t\t\tconsole.log(\"piano key\"+this._setKey);\r\n\t\t\t\t\t\tif ( (this._setKey == 0 ) || (this._setKey == 2 ) || (this._setKey == 4 ) || (this._setKey == 6 ) || (this._setKey == 7 ) || (this._setKey == 9 ) || (this._setKey == 11 )) {\r\n\t\t\t\t\t\t\tthis._backgroundPitchRows[0].setAttribute(\"fill\", this._doc.prefs.showMore ? \"var(--white-tonic, var(--pitch-white-key, var(--pitch-background)))\" : ColorConfig.pitchBackground);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis._backgroundPitchRows[0].setAttribute(\"fill\", this._doc.prefs.showMore ? \"var(--black-tonic, var(--pitch-black-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif ((this._setKey == 0 ) || (this._setKey == 1 ) || (this._setKey == 3 ) || (this._setKey == 5 )|| (this._setKey == 7 ) ||(this._setKey == 8 ) || (this._setKey == 10)) {\r\n\t\t\t\t\t\t\tthis._backgroundPitchRows[1].setAttribute(\"fill\", this._doc.prefs.showMore ? \"var(--pitch-white-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis._backgroundPitchRows[1].setAttribute(\"fill\", this._doc.prefs.showMore ? \"var(--pitch-black-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif ((this._setKey == 1 )||(this._setKey == 2 )||(this._setKey == 4 )||(this._setKey == 6 )||(this._setKey == 8 )||(this._setKey == 9 )||(this._setKey == 11)) {\r\n\t\t\t\t\t\t\tthis._backgroundPitchRows[2].setAttribute(\"fill\", this._doc.prefs.showMore ? \"var(--pitch-white-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis._backgroundPitchRows[2].setAttribute(\"fill\", this._doc.prefs.showMore ? \"var(--pitch-black-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif ((this._setKey == 0 ) ||(this._setKey == 2 )||(this._setKey == 3 )||(this._setKey == 5 )||(this._setKey == 7 )||(this._setKey == 9 )||(this._setKey == 10)) {\r\n\t\t\t\t\t\t\tthis._backgroundPitchRows[3].setAttribute(\"fill\", this._doc.prefs.showMore ? \"var(--pitch-white-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis._backgroundPitchRows[3].setAttribute(\"fill\", this._doc.prefs.showMore ? \"var(--pitch-black-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif ((this._setKey == 1) ||(this._setKey == 3 )||(this._setKey == 4 )||(this._setKey == 6 )||(this._setKey == 8 )||(this._setKey == 10 )||(this._setKey == 11)) {\r\n\t\t\t\t\t\t\tthis._backgroundPitchRows[4].setAttribute(\"fill\", this._doc.prefs.showMore ? \" var(--pitch-white-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis._backgroundPitchRows[4].setAttribute(\"fill\", this._doc.prefs.showMore ? \" var(--pitch-black-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif ((this._setKey == 0 )||(this._setKey == 2 )||(this._setKey == 4 )||(this._setKey == 5 )||(this._setKey == 7 )||(this._setKey == 9 )||(this._setKey == 11)) {\r\n\t\t\t\t\t\t\tthis._backgroundPitchRows[5].setAttribute(\"fill\", this._doc.prefs.showMore ? \"var(--pitch-white-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis._backgroundPitchRows[5].setAttribute(\"fill\", this._doc.prefs.showMore ? \"var(--pitch-black-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif ((this._setKey == 0 ) ||(this._setKey == 1 )||(this._setKey == 3 )||(this._setKey == 5 )||(this._setKey == 6 )||(this._setKey == 8 )||(this._setKey == 10)) {\r\n\t\t\t\t\t\t\tthis._backgroundPitchRows[6].setAttribute(\"fill\", this._doc.prefs.showMore ? \"var(--pitch-white-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis._backgroundPitchRows[6].setAttribute(\"fill\", this._doc.prefs.showMore ? \"var(--pitch-black-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif ((this._setKey == 1) ||(this._setKey == 2) ||(this._setKey == 4 )||(this._setKey == 6 )||(this._setKey == 7 )||(this._setKey == 9 )||(this._setKey == 11)) {\r\n\t\t\t\t\t\t\tif (this._doc.prefs.showFifth == true) {\r\n\t\t\t\t\t\t\t\tthis._backgroundPitchRows[7].setAttribute(\"fill\", this._doc.prefs.showMore ? \"var(--white-fifth-note, var(--pitch-white-key, var(--pitch-background)))\" : ColorConfig.pitchBackground);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tthis._backgroundPitchRows[7].setAttribute(\"fill\", this._doc.prefs.showMore ? \" var(--pitch-white-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tif (this._doc.prefs.showFifth == true) {\r\n\t\t\t\t\t\t\t\tthis._backgroundPitchRows[7].setAttribute(\"fill\", this._doc.prefs.showMore ? \"var(--black-fifth-note, var(--pitch-black-key, var(--pitch-background)))\" : ColorConfig.pitchBackground);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tthis._backgroundPitchRows[7].setAttribute(\"fill\", this._doc.prefs.showMore ? \"var(--pitch-black-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif ((this._setKey == 0 ) || (this._setKey == 2 ) || (this._setKey == 3 ) || (this._setKey == 5) || (this._setKey == 7) || (this._setKey == 8) || (this._setKey == 10)) {\r\n\t\t\t\t\t\t\tthis._backgroundPitchRows[8].setAttribute(\"fill\", this._doc.prefs.showMore ? \"var(--pitch-white-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis._backgroundPitchRows[8].setAttribute(\"fill\", this._doc.prefs.showMore ? \"var(--pitch-black-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif ((this._setKey == 1 )|| (this._setKey ==3 )||(this._setKey == 4 )||(this._setKey == 6 )||(this._setKey == 8 )||(this._setKey == 9 )||(this._setKey == 11)) {\r\n\t\t\t\t\t\t\tthis._backgroundPitchRows[9].setAttribute(\"fill\", this._doc.prefs.showMore ? \"var(--pitch-white-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis._backgroundPitchRows[9].setAttribute(\"fill\", this._doc.prefs.showMore ? \"var(--pitch-black-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif ((this._setKey == 0) ||(this._setKey == 2 )||(this._setKey == 4 )||(this._setKey == 5 )||(this._setKey == 7 )||(this._setKey == 9) ||(this._setKey == 10)) {\r\n\t\t\t\t\t\t\tthis._backgroundPitchRows[10].setAttribute(\"fill\", this._doc.prefs.showMore ? \"var(--pitch-white-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis._backgroundPitchRows[10].setAttribute(\"fill\", this._doc.prefs.showMore ? \"var(--pitch-black-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif ((this._setKey == 1 )||(this._setKey == 3 )||(this._setKey == 5 )||(this._setKey == 6 )||(this._setKey == 8 )||(this._setKey == 10 )||(this._setKey == 11)) {\r\n\t\t\t\t\t\t\tthis._backgroundPitchRows[11].setAttribute(\"fill\", this._doc.prefs.showMore ? \"var(--pitch-white-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis._backgroundPitchRows[11].setAttribute(\"fill\", this._doc.prefs.showMore ? \"var(--pitch-black-key, var(--pitch-background))\" : ColorConfig.pitchBackground);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\tif (this._renderedACS != this._doc.prefs.showMore) {\r\n\t\t\t\t\tthis._renderedACS = this._doc.prefs.showMore;\r\n\t\t\t\t\tconsole.log(\"this._renderedACS (in piano): \"+this._renderedACS);\r\n\t\t\t\t\t}\r\n\t\t\t\t} \r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t\tprivate _drawNote(svgElement: SVGPathElement, pitch: number, start: number, pins: NotePin[], radius: number, showVolume: boolean, offset: number): void {\r\n\t\t\tlet nextPin: NotePin = pins[0];\r\n\t\t\tlet pathString: string = \"M \" + prettyNumber(this._partWidth * (start + nextPin.time) + 1) + \" \" + prettyNumber(this._pitchToPixelHeight(pitch - offset) + radius * (showVolume ? nextPin.volume / 3.0 : 1.0)) + \" \";\r\n\t\t\tfor (let i: number = 1; i < pins.length; i++) {\r\n\t\t\t\tlet prevPin: NotePin = nextPin;\r\n\t\t\t\tnextPin = pins[i];\r\n\t\t\t\tlet prevSide: number = this._partWidth * (start + prevPin.time) + (i == 1 ? 1 : 0);\r\n\t\t\t\tlet nextSide: number = this._partWidth * (start + nextPin.time) - (i == pins.length - 1 ? 1 : 0);\r\n\t\t\t\tlet prevHeight: number = this._pitchToPixelHeight(pitch + prevPin.interval - offset);\r\n\t\t\t\tlet nextHeight: number = this._pitchToPixelHeight(pitch + nextPin.interval - offset);\r\n\t\t\t\tlet prevVolume: number = showVolume ? prevPin.volume / 3.0 : 1.0;\r\n\t\t\t\tlet nextVolume: number = showVolume ? nextPin.volume / 3.0 : 1.0;\r\n\t\t\t\tpathString += \"L \" + prettyNumber(prevSide) + \" \" + prettyNumber(prevHeight - radius * prevVolume) + \" \";\r\n\t\t\t\tif (prevPin.interval > nextPin.interval) pathString += \"L \" + prettyNumber(prevSide + 1) + \" \" + prettyNumber(prevHeight - radius * prevVolume) + \" \";\r\n\t\t\t\tif (prevPin.interval < nextPin.interval) pathString += \"L \" + prettyNumber(nextSide - 1) + \" \" + prettyNumber(nextHeight - radius * nextVolume) + \" \";\r\n\t\t\t\tpathString += \"L \" + prettyNumber(nextSide) + \" \" + prettyNumber(nextHeight - radius * nextVolume) + \" \";\r\n\t\t\t}\r\n\t\t\tfor (let i: number = pins.length - 2; i >= 0; i--) {\r\n\t\t\t\tlet prevPin: NotePin = nextPin;\r\n\t\t\t\tnextPin = pins[i];\r\n\t\t\t\tlet prevSide: number = this._partWidth * (start + prevPin.time) - (i == pins.length - 2 ? 1 : 0);\r\n\t\t\t\tlet nextSide: number = this._partWidth * (start + nextPin.time) + (i == 0 ? 1 : 0);\r\n\t\t\t\tlet prevHeight: number = this._pitchToPixelHeight(pitch + prevPin.interval - offset);\r\n\t\t\t\tlet nextHeight: number = this._pitchToPixelHeight(pitch + nextPin.interval - offset);\r\n\t\t\t\tlet prevVolume: number = showVolume ? prevPin.volume / 3.0 : 1.0;\r\n\t\t\t\tlet nextVolume: number = showVolume ? nextPin.volume / 3.0 : 1.0;\r\n\t\t\t\tpathString += \"L \" + prettyNumber(prevSide) + \" \" + prettyNumber(prevHeight + radius * prevVolume) + \" \";\r\n\t\t\t\tif (prevPin.interval < nextPin.interval) pathString += \"L \" + prettyNumber(prevSide - 1) + \" \" + prettyNumber(prevHeight + radius * prevVolume) + \" \";\r\n\t\t\t\tif (prevPin.interval > nextPin.interval) pathString += \"L \" + prettyNumber(nextSide + 1) + \" \" + prettyNumber(nextHeight + radius * nextVolume) + \" \";\r\n\t\t\t\tpathString += \"L \" + prettyNumber(nextSide) + \" \" + prettyNumber(nextHeight + radius * nextVolume) + \" \";\r\n\t\t\t}\r\n\t\t\tpathString += \"z\";\r\n\t\t\t\r\n\t\t\tsvgElement.setAttribute(\"d\", pathString);\r\n\t\t}\r\n\t\t\r\n\t\tprivate _pitchToPixelHeight(pitch: number): number {\r\n\t\t\treturn this._pitchHeight * (this._pitchCount - (pitch) - 0.5);\r\n\t\t}\r\n\t}\r\n\r\n","/*\r\nCopyright (C) 2018 John Nesky\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of \r\nthis software and associated documentation files (the \"Software\"), to deal in \r\nthe Software without restriction, including without limitation the rights to \r\nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \r\nof the Software, and to permit persons to whom the Software is furnished to do \r\nso, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all \r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \r\nSOFTWARE.\r\n*/\r\n\r\nimport { HTML, SVG } from \"imperative-html/dist/esm/elements-strict\";\r\nimport { SongDocument } from \"./SongDocument\";\r\nimport { Pattern } from \"../synth/song\";\r\nimport { ChangePattern, ChangeChannelBar } from \"./changes\";\r\nimport { ColorConfig } from \"./ColorConfig\";\r\n\tconst {select, div, option} = HTML;\r\n\r\n\tclass Box {\r\n\t\tprivate readonly _label: SVGTextElement = SVG.text( {x: 16, y: 23, \"font-family\": \"sans-serif\", \"font-size\": 20, \"text-anchor\": \"middle\", \"font-weight\": \"bold\", fill: ColorConfig.invertedText}, \"1\");\r\n\t\tprivate readonly _rect = <SVGRectElement> SVG.rect( {width: 30, height: 27, x: 1, y: 1});\r\n\t\tprivate readonly _vol1 = <SVGRectElement> SVG.rect( {width: 6, height: 3, x: 24, y: 5});\r\n\t\tprivate readonly _volb = <SVGRectElement> SVG.rect( {width: 6, height: 18, x: 24, y: 5});\r\n\t\tpublic readonly container = <SVGSVGElement> SVG.svg(this._rect, this._volb, this._vol1, this._label);\r\n\t\tprivate _renderedIndex: number = 1;\r\n\t\tprivate _renderedDim: boolean = true;\r\n\t\t//private _renderedMute: boolean = true;\r\n\t\tprivate _renderedSelected: boolean = false;\r\n\t\tprivate _renderedColor: string = \"\";\r\n\t\tconstructor(channel: number, x: number, y: number, color: string, showVolume: boolean) {\r\n\t\t\tthis.container.setAttribute(\"x\", \"\" + (x * 32));\r\n\t\t\tthis.container.setAttribute(\"y\", \"\" + (y * 32));\r\n\t\t\tthis._rect.setAttribute(\"fill\", \"#444444\");\r\n\t\t\tthis._vol1.setAttribute(\"fill\", \"#444444\");\r\n\t\t\tthis._volb.setAttribute(\"fill\", \"#444444\");\r\n\t\t\tthis._label.setAttribute(\"fill\", color);\r\n\t\t}\r\n\t\t\r\n\t\tpublic setSquashed(squashed: boolean, y: number): void {\r\n\t\t\tif (squashed) {\r\n\t\t\t\tthis.container.setAttribute(\"y\", \"\" + (y * 27));\r\n\t\t\t\tthis._rect.setAttribute(\"height\", \"\" + 25);\r\n\t\t\t\tthis._vol1.setAttribute(\"height\", \"\" + 2.7);\r\n\t\t\t\tthis._volb.setAttribute(\"height\", \"\" + 18);\r\n\t\t\t\tthis._label.setAttribute(\"y\", \"\" + 21);\r\n\t\t\t} else {\r\n\t\t\t\tthis.container.setAttribute(\"y\", \"\" + (y * 32));\r\n\t\t\t\tthis._rect.setAttribute(\"height\", \"\" + 30);\r\n\t\t\t\tthis._vol1.setAttribute(\"height\", \"\" + 3);\r\n\t\t\t\tthis._volb.setAttribute(\"height\", \"\" + 18);\r\n\t\t\t\tthis._label.setAttribute(\"y\", \"\" + 23);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tpublic setIndex(index: number, dim: boolean, selected: boolean, y: number, color: string, volume: number, colorB: string, showVolume: boolean, mix: number): void {\r\n\t\t\tif (mix == 2) {\r\n\t\t\t\tthis._vol1.setAttribute(\"height\", \"\" + (18 - volume * 2));\r\n\t\t\t\tthis._vol1.setAttribute(\"y\", \"\" + (5 + volume * 2));\r\n\t\t\t} else {\r\n\t\t\t\tthis._vol1.setAttribute(\"height\", \"\" + (18 - volume * 3.6));\r\n\t\t\t\tthis._vol1.setAttribute(\"y\", \"\" + (5 + volume * 3.6));\r\n\t\t\t}\r\n\t\t\tif (this._renderedIndex != index) {\r\n\t\t\t\tif (!this._renderedSelected && ((index == 0) != (this._renderedIndex == 0))) {\r\n\t\t\t\t\tthis._rect.setAttribute(\"fill\", (index == 0) ? ColorConfig.editorBackground : ColorConfig.channelBox);\r\n\t\t\t\t\tthis._vol1.setAttribute(\"fill\", (index == 0) ? ColorConfig.editorBackground : ColorConfig.channelBox);\r\n\t\t\t\t\tthis._volb.setAttribute(\"fill\", (index == 0) ? ColorConfig.editorBackground : ColorConfig.channelBox);\r\n\t\t\t\t}\r\n\t\t\t\r\n\t\t\t\tthis._renderedIndex = index;\r\n\t\t\t\tthis._label.innerHTML = String(index);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (this._renderedDim != dim || this._renderedColor != color) {\r\n\t\t\t\tthis._renderedDim = dim;\r\n\t\t\t\tif (selected) {\r\n\t\t\t\t\tthis._label.setAttribute(\"fill\", ColorConfig.invertedText);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis._label.setAttribute(\"fill\", color);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (this._renderedSelected != selected || this._renderedColor != color) {\r\n\t\t\t\tthis._renderedSelected = selected;\r\n\t\t\t\tif (selected) {\r\n\t\t\t\t\tthis._rect.setAttribute(\"fill\", color);\r\n\t\t\t\t\tthis._vol1.setAttribute(\"fill\", color);\r\n\t\t\t\t\tthis._volb.setAttribute(\"fill\", color);\r\n\t\t\t\t\tthis._label.setAttribute(\"fill\", ColorConfig.invertedText);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis._rect.setAttribute(\"fill\", (this._renderedIndex == 0) ? ColorConfig.editorBackground : ColorConfig.channelBox);\r\n\t\t\t\t\tthis._vol1.setAttribute(\"fill\", (this._renderedIndex == 0) ? ColorConfig.editorBackground : color);\r\n\t\t\t\t\tthis._volb.setAttribute(\"fill\", (this._renderedIndex == 0) ? ColorConfig.editorBackground : colorB);\r\n\t\t\t\t\tthis._label.setAttribute(\"fill\", color);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (showVolume) {\r\n\t\t\t\tthis._label.setAttribute(\"x\", \"12\");\r\n\t\t\t\tthis._vol1.style.visibility = \"visible\";\r\n\t\t\t\tthis._volb.style.visibility = \"visible\";\r\n\t\t\t} else {\r\n\t\t\t\tthis._label.setAttribute(\"x\", \"16\");\r\n\t\t\t\tthis._vol1.style.visibility = \"hidden\";\r\n\t\t\t\tthis._volb.style.visibility = \"hidden\";\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._renderedColor = color;\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class TrackEditor {\r\n\t\tprivate readonly _barWidth: number = 32;\r\n\t\tprivate readonly _svg = <SVGSVGElement> SVG.svg( {style: \"position: absolute;\", height: 128});\r\n\t\tprivate readonly _select: HTMLSelectElement = select({class: \"trackSelectBox\", style: \"width: 32px; height: 32px; background: none; border: none; appearance: none; color: transparent; position: absolute;\"});\r\n\t\tpublic readonly container: HTMLElement = div({style: \"height: 128px; position: relative; overflow:hidden;\"}, [this._svg, this._select]);\r\n\t\t\r\n\t\tprivate readonly _boxContainer = <SVGGElement> SVG.g();\r\n\t\tprivate readonly _playhead = <SVGRectElement> SVG.rect( {fill: \"white\", x: 0, y: 0, width: 4, height: 128});\r\n\t\tprivate readonly _boxHighlight = <SVGRectElement> SVG.rect( {fill: \"none\", stroke: \"white\", \"stroke-width\": 2, \"pointer-events\": \"none\", x: 1, y: 1, width: 30, height: 30});\r\n\t\tprivate readonly _upHighlight = <SVGPathElement> SVG.path( {fill: \"black\", stroke: \"black\", \"stroke-width\": 1, \"pointer-events\": \"none\"});\r\n\t\tprivate readonly _downHighlight = <SVGPathElement> SVG.path( {fill: \"black\", stroke: \"black\", \"stroke-width\": 1, \"pointer-events\": \"none\"});\r\n\t\t\r\n\t\tprivate readonly _grid: Box[][] = [];\r\n\t\tprivate _mouseX: number = 0;\r\n\t\tprivate _mouseY: number = 0;\r\n\t\tpublic _pattern: Pattern | null = null;\r\n\t\tprivate _mouseOver: boolean = false;\r\n\t\tpublic _digits: string = \"\";\r\n\t\tprivate _editorHeight: number = 128;\r\n\t\tprivate _channelHeight: number = 32;\r\n\t\tprivate _renderedChannelCount: number = 0;\r\n\t\tprivate _renderedBarCount: number = 0;\r\n\t\tprivate _renderedPatternCount: number = 0;\r\n\t\tprivate _renderedPlayhead: number = -1;\r\n\t\tprivate _renderedSquashed: boolean = false;\r\n\t\tprivate _changePattern: ChangePattern | null = null;\r\n\t\t\r\n\t\tconstructor(private _doc: SongDocument) {\r\n\t\t\tthis._svg.appendChild(this._boxContainer);\r\n\t\t\tthis._svg.appendChild(this._boxHighlight);\r\n\t\t\tthis._svg.appendChild(this._upHighlight);\r\n\t\t\tthis._svg.appendChild(this._downHighlight);\r\n\t\t\tthis._svg.appendChild(this._playhead);\r\n\t\t\tthis._svg.style.backgroundColor = ColorConfig.editorBackground;\r\n\r\n\t\t\twindow.requestAnimationFrame(this._animatePlayhead);\r\n\t\t\tthis._svg.addEventListener(\"mousedown\", this._whenMousePressed);\r\n\t\t\tdocument.addEventListener(\"mousemove\", this._whenMouseMoved);\r\n\t\t\tdocument.addEventListener(\"mouseup\", this._whenMouseReleased);\r\n\t\t\tthis._svg.addEventListener(\"mouseover\", this._whenMouseOver);\r\n\t\t\tthis._svg.addEventListener(\"mouseout\", this._whenMouseOut);\r\n\t\t\t\r\n\t\t\tthis._select.addEventListener(\"change\", this._whenSelectChanged);\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenSelectChanged = (): void => {\r\n\t\t\tthis._setPattern(this._select.selectedIndex);\r\n\t\t}\r\n\t\t\r\n\t\tprivate _animatePlayhead = (timestamp: number): void => {\r\n\t\t\tconst playhead = (this._barWidth * this._doc.synth.playhead - 2);\r\n\t\t\tif (this._renderedPlayhead != playhead) {\r\n\t\t\t\tthis._renderedPlayhead = playhead;\r\n\t\t\t\tthis._playhead.setAttribute(\"x\", \"\" + playhead);\r\n\t\t\t}\r\n\t\t\twindow.requestAnimationFrame(this._animatePlayhead);\r\n\t\t}\r\n\t\t\r\n\t\tpublic _setChannelBar(channel: number, bar: number): void {\r\n\t\t\tnew ChangeChannelBar(this._doc, channel, bar);\r\n\t\t\tthis._digits = \"\";\r\n\t\t\tthis._doc.forgetLastChange();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _setPattern(pattern: number): void {\r\n\t\t\tconst currentValue: number = this._doc.song.channels[this._doc.channel].bars[this._doc.bar];\r\n\t\t\tconst canReplaceLastChange: boolean = this._doc.lastChangeWas(this._changePattern);\r\n\t\t\tconst oldValue: number = canReplaceLastChange ? this._changePattern!.oldValue : currentValue;\r\n\t\t\tif (pattern != currentValue) {\r\n\t\t\t\tthis._changePattern = new ChangePattern(this._doc, oldValue, pattern);\r\n\t\t\t\tthis._doc.record(this._changePattern, canReplaceLastChange);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tpublic _nextDigit(digit: string): void {\r\n\t\t\tthis._digits += digit;\r\n\t\t\tlet parsed: number = parseInt(this._digits);\r\n\t\t\tif (parsed <= this._doc.song.patternsPerChannel) {\r\n\t\t\t\tthis._setPattern(parsed);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\t\r\n\t\t\tthis._digits = digit;\r\n\t\t\tparsed = parseInt(this._digits);\r\n\t\t\tif (parsed <= this._doc.song.patternsPerChannel) {\r\n\t\t\t\tthis._setPattern(parsed);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._digits = \"\";\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenMouseOver = (event: MouseEvent): void => {\r\n\t\t\tif (this._mouseOver) return;\r\n\t\t\tthis._mouseOver = true;\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenMouseOut = (event: MouseEvent): void => {\r\n\t\t\tif (!this._mouseOver) return;\r\n\t\t\tthis._mouseOver = false;\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenMousePressed = (event: MouseEvent): void => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tconst boundingRect: ClientRect = this._svg.getBoundingClientRect();\r\n    \t\tthis._mouseX = (event.clientX || event.pageX) - boundingRect.left;\r\n\t\t    this._mouseY = (event.clientY || event.pageY) - boundingRect.top;\r\n\t\t\tconst channel: number = Math.floor(Math.min(this._doc.song.getChannelCount() - 1, Math.max(0, this._mouseY / this._channelHeight)));\r\n\t\t\tconst bar: number = Math.floor(Math.min(this._doc.song.barCount - 1, Math.max(0, this._mouseX / this._barWidth)));\r\n\t\t\tif (this._doc.channel == channel && this._doc.bar == bar) {\r\n\t\t\t\tconst up: boolean = (this._mouseY % this._channelHeight) < this._channelHeight / 2;\r\n\t\t\t\tconst patternCount: number = this._doc.song.patternsPerChannel;\r\n\t\t\t\tthis._setPattern((this._doc.song.channels[channel].bars[bar] + (up ? 1 : patternCount)) % (patternCount + 1));\r\n\t\t\t} else {\r\n\t\t\t\tthis._setChannelBar(channel, bar);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenMouseMoved = (event: MouseEvent): void => {\r\n\t\t\tconst boundingRect: ClientRect = this._svg.getBoundingClientRect();\r\n    \t\tthis._mouseX = (event.clientX || event.pageX) - boundingRect.left;\r\n\t\t    this._mouseY = (event.clientY || event.pageY) - boundingRect.top;\r\n\t\t\tthis._updatePreview();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenMouseReleased = (event: MouseEvent): void => {\r\n\t\t}\r\n\t\t\r\n\t\tprivate _updatePreview(): void {\r\n\t\t\tlet channel: number = Math.floor(Math.min(this._doc.song.getChannelCount() - 1, Math.max(0, this._mouseY / this._channelHeight)));\r\n\t\t\tlet bar: number = Math.floor(Math.min(this._doc.song.barCount - 1, Math.max(0, this._mouseX / this._barWidth)));\r\n\t\t\t\r\n\t\t\tconst wideScreen: boolean = window.innerWidth > 700;\r\n\t\t\tif (!wideScreen) {\r\n\t\t\t\tbar = this._doc.bar;\r\n\t\t\t\tchannel = this._doc.channel;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tconst selected: boolean = (bar == this._doc.bar && channel == this._doc.channel);\r\n\t\t\t\r\n\t\t\tif (this._mouseOver && !selected) {\r\n\t\t\t\tthis._boxHighlight.setAttribute(\"x\", \"\" + (1 + this._barWidth * bar));\r\n\t\t\t\tthis._boxHighlight.setAttribute(\"y\", \"\" + (1 + (this._channelHeight * channel)));\r\n\t\t\t\tthis._boxHighlight.setAttribute(\"height\", \"\" + (this._channelHeight - 2));\r\n\t\t\t\tthis._boxHighlight.style.visibility = \"visible\";\r\n\t\t\t} else {\r\n\t\t\t\tthis._boxHighlight.style.visibility = \"hidden\";\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif ((this._mouseOver || !wideScreen) && selected) {\r\n\t\t\t\tconst up: boolean = (this._mouseY % this._channelHeight) < this._channelHeight / 2;\r\n\t\t\t\tconst center: number = this._barWidth * (bar + 0.8);\r\n\t\t\t\tconst middle: number = this._channelHeight * (channel + 0.5);\r\n\t\t\t\tconst base: number = this._channelHeight * 0.1;\r\n\t\t\t\tconst tip: number = this._channelHeight * 0.4;\r\n\t\t\t\tconst width: number = this._channelHeight * 0.175;\r\n\t\t\t\t\r\n\t\t\t\tthis._upHighlight.setAttribute(\"fill\", up && wideScreen ? \"#fff\" : \"#000\");\r\n\t\t\t\tthis._downHighlight.setAttribute(\"fill\", !up && wideScreen ? \"#fff\" : \"#000\");\r\n\t\t\t\t\r\n\t\t\t\tthis._upHighlight.setAttribute(\"d\", `M ${center} ${middle - tip} L ${center + width} ${middle - base} L ${center - width} ${middle - base} z`);\r\n\t\t\t\tthis._downHighlight.setAttribute(\"d\", `M ${center} ${middle + tip} L ${center + width} ${middle + base} L ${center - width} ${middle + base} z`);\r\n\t\t\t\t\r\n\t\t\t\tthis._upHighlight.style.visibility = \"visible\";\r\n\t\t\t\tthis._downHighlight.style.visibility = \"visible\";\r\n\t\t\t} else {\r\n\t\t\t\tthis._upHighlight.style.visibility = \"hidden\";\r\n\t\t\t\tthis._downHighlight.style.visibility = \"hidden\";\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._select.style.left = (this._barWidth * this._doc.bar) + \"px\";\r\n\t\t\tthis._select.style.top = (this._channelHeight * this._doc.channel) + \"px\";\r\n\t\t\tthis._select.style.height = this._channelHeight + \"px\";\r\n\t\t\t\r\n\t\t\tconst patternCount: number = this._doc.song.patternsPerChannel;\r\n\t\t\tfor (let i: number = this._renderedPatternCount; i < patternCount; i++) {\r\n\t\t\t\tthis._select.appendChild(option({value:i}, i));\r\n\t\t\t}\r\n\t\t\tfor (let i: number = patternCount; i < this._renderedPatternCount; i++) {\r\n\t\t\t\tthis._select.removeChild(<Node> this._select.lastChild);\r\n\t\t\t}\r\n\t\t\tthis._renderedPatternCount = patternCount;\r\n\t\t\tconst selectedPattern: number = this._doc.song.channels[this._doc.channel].bars[this._doc.bar];\r\n\t\t\tif (this._select.selectedIndex != selectedPattern) this._select.selectedIndex = selectedPattern;\r\n\t\t}\r\n\t\t\r\n\t\tpublic render(): void {\r\n\t\t\tthis._pattern = this._doc.getCurrentPattern();\r\n\t\t\t\r\n\t\t\tconst wideScreen: boolean = window.innerWidth > 700;\r\n\t\t\tconst squashed: boolean = !wideScreen || this._doc.song.getChannelCount() > 5/*4*/ || (this._doc.song.barCount > this._doc.trackVisibleBars && this._doc.song.getChannelCount() > 3);\r\n\t\t\tthis._channelHeight = squashed ? 27 : 32;\r\n\t\t\t\r\n\t\t\tif (this._renderedChannelCount != this._doc.song.getChannelCount()) {\r\n\t\t\t\tfor (let y: number = this._renderedChannelCount; y < this._doc.song.getChannelCount(); y++) {\r\n\t\t\t\t\tthis._grid[y] = [];\r\n\t\t\t\t\tfor (let x: number = 0; x < this._renderedBarCount; x++) {\r\n\t\t\t\t\t\t//const box: Box = new Box(y, x, y, this._doc.song.getChannelColorDim(y), this._doc.showVolumeBar);\r\n\t\t\t\t\t\tconst box: Box = new Box(y, x, y, ColorConfig.getChannelColor(this._doc.song, y).secondaryChannel, this._doc.prefs.showVolumeBar);\r\n\t\t\t\t\t\tbox.setSquashed(squashed, y);\r\n\t\t\t\t\t\tthis._boxContainer.appendChild(box.container);\r\n\t\t\t\t\t\tthis._grid[y][x] = box;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tfor (let y: number = this._doc.song.getChannelCount(); y < this._renderedChannelCount; y++) {\r\n\t\t\t\t\tfor (let x: number = 0; x < this._renderedBarCount; x++) {\r\n\t\t\t\t\t\tthis._boxContainer.removeChild(this._grid[y][x].container);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tthis._grid.length = this._doc.song.getChannelCount();\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (this._renderedBarCount < this._doc.song.barCount) {\r\n\t\t\t\tfor (let y: number = 0; y < this._doc.song.getChannelCount(); y++) {\r\n\t\t\t\t\tfor (let x: number = this._renderedBarCount; x < this._doc.song.barCount; x++) {\r\n\t\t\t\t\t\tconst box: Box = new Box(y, x, y, ColorConfig.getChannelColor(this._doc.song, y).secondaryChannel, this._doc.prefs.showVolumeBar);\r\n\t\t\t\t\t\tbox.setSquashed(squashed, y);\r\n\t\t\t\t\t\tthis._boxContainer.appendChild(box.container);\r\n\t\t\t\t\t\tthis._grid[y][x] = box;\r\n\t\t\t\t\t\t//SVG.text( {x: 16, y: 23, \"font-family\": \"sans-serif\", \"font-size\": 20, \"text-anchor\": \"middle\", \"font-weight\": \"bold\", fill: \"red\"});\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfor (let x: number = this._doc.song.barCount; x < this._renderedBarCount; x++) {\r\n\t\t\t\t\t\tthis._boxContainer.removeChild(this._grid[y][x].container);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis._grid[y].length = this._doc.song.barCount;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (this._renderedBarCount != this._doc.song.barCount) {\r\n\t\t\t\tthis._renderedBarCount = this._doc.song.barCount;\r\n\t\t\t\tconst editorWidth = 32 * this._doc.song.barCount;\r\n\t\t\t\tthis.container.style.width = editorWidth + \"px\";\r\n\t\t\t\tthis._svg.setAttribute(\"width\", editorWidth + \"\");\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (this._renderedSquashed != squashed) {\r\n\t\t\t\tfor (let y: number = 0; y < this._doc.song.getChannelCount(); y++) {\r\n\t\t\t\t\tfor (let x: number = 0; x < this._renderedBarCount; x++) {\r\n\t\t\t\t\t\tthis._grid[y][x].setSquashed(squashed, y);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (this._renderedSquashed != squashed || this._renderedChannelCount != this._doc.song.getChannelCount()) {\r\n\t\t\t\tthis._renderedSquashed = squashed;\r\n\t\t\t\tthis._renderedChannelCount = this._doc.song.getChannelCount();\r\n\t\t\t\tthis._editorHeight = this._doc.song.getChannelCount() * this._channelHeight;\r\n\t\t\t\tthis._svg.setAttribute(\"height\", \"\" + this._editorHeight);\r\n\t\t\t\tthis._playhead.setAttribute(\"height\", \"\" + this._editorHeight);\r\n\t\t\t\tthis.container.style.height = this._editorHeight + \"px\";\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tfor (let j: number = 0; j < this._doc.song.getChannelCount(); j++) {\r\n\t\t\t\tfor (let i: number = 0; i < this._renderedBarCount; i++) {\r\n\t\t\t\t\tconst pattern: Pattern | null = this._doc.song.getPattern(j, i);\r\n\t\t\t\t\tconst patternMute: number = this._doc.song.getPatternInstrumentMute(j, i);\r\n\t\t\t\t\tconst patternVolume: number = this._doc.song.getPatternInstrumentVolume(j, i);\r\n\t\t\t\t\tconst selected: boolean = (i == this._doc.bar && j == this._doc.channel);\r\n\t\t\t\t\tconst dim: boolean = (pattern == null || pattern.notes.length == 0);\r\n\t\t\t\t\tconst mute: boolean = patternMute == 1;\r\n\t\t\t\t\tconst volume: number = patternVolume;\r\n\t\t\t\t\tconst box: Box = this._grid[j][i];\r\n\t\t\t\t\tif (i < this._doc.song.barCount) {\r\n\t\t\t\t\t\tbox.setIndex(\r\n\t\t\t\t\t\t\tthis._doc.song.channels[j].bars[i],\r\n\t\t\t\t\t\t\tdim,\r\n\t\t\t\t\t\t\tselected,\r\n\t\t\t\t\t\t\tj,\r\n\t\t\t\t\t\t\tdim && !selected && !mute ? ColorConfig.getChannelColor(this._doc.song, j).secondaryChannel : mute && !selected ? \"#161616\" : ColorConfig.getChannelColor(this._doc.song, j).primaryChannel,\r\n\t\t\t\t\t\t\tvolume,\r\n\t\t\t\t\t\t\tdim && !selected && !mute ? ColorConfig.getChannelColor(this._doc.song, j).secondaryChannel : mute && !selected ? \"#9b9b9b\" : ColorConfig.getChannelColor(this._doc.song, j).secondaryChannel,\r\n\t\t\t\t\t\t\tthis._doc.prefs.showVolumeBar,\r\n\t\t\t\t\t\t\tthis._doc.song.mix\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\tbox.container.style.visibility = \"visible\";\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tbox.container.style.visibility = \"hidden\";\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._updatePreview();\r\n\t\t}\r\n\t}\r\n\r\n","/*\r\nCopyright (C) 2018 John Nesky\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of \r\nthis software and associated documentation files (the \"Software\"), to deal in \r\nthe Software without restriction, including without limitation the rights to \r\nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \r\nof the Software, and to permit persons to whom the Software is furnished to do \r\nso, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all \r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \r\nSOFTWARE.\r\n*/\r\n\r\nimport { HTML, SVG } from \"imperative-html/dist/esm/elements-strict\";\r\nimport { SongDocument } from \"./SongDocument\";\r\nimport { ChangeLoop } from \"./changes\";\r\nimport { ColorConfig } from \"./ColorConfig\";\r\n\tconst {div} = HTML;\r\n\r\n\r\n\tinterface Cursor {\r\n\t\tstartBar: number;\r\n\t\tmode: number;\r\n\t}\r\n\t\r\n\tinterface Endpoints {\r\n\t\tstart: number;\r\n\t\tlength: number;\r\n\t}\r\n\t\r\n\texport class LoopEditor {\r\n\t\tprivate readonly _barWidth: number = 32;\r\n\t\tprivate readonly _editorHeight: number = 20;\r\n\t\tprivate readonly _startMode:   number = 0;\r\n\t\tprivate readonly _endMode:     number = 1;\r\n\t\tprivate readonly _bothMode:    number = 2;\r\n\t\t\r\n\t\tprivate readonly _loop = <SVGPathElement> SVG.path( {fill: \"none\", stroke: ColorConfig.loopAccent, \"stroke-width\": 4});\r\n\t\tprivate readonly _highlight = <SVGPathElement> SVG.path( {fill: \"white\", \"pointer-events\": \"none\"});\r\n\t\t\r\n\t\tprivate readonly _svg = <SVGSVGElement> SVG.svg( {style: \"touch-action: pan-y; position: absolute;\", height: this._editorHeight}, [\r\n\t\t\tthis._loop,\r\n\t\t\tthis._highlight,\r\n\t\t]);\r\n\t\t\r\n\t\tpublic readonly container: HTMLElement = div({style: \"height: 20px; position: relative; margin: 5px 0;\"}, [this._svg]);\r\n\t\t\r\n\t\tprivate _change: ChangeLoop | null = null;\r\n\t\tprivate _cursor: Cursor = {startBar: -1, mode: -1};\r\n\t\tprivate _mouseX: number = 0;\r\n\t\tpublic _mouseY: number = 0;\r\n\t\tprivate _clientStartX: number = 0;\r\n\t\tprivate _clientStartY: number = 0;\r\n\t\tprivate _startedScrolling: boolean = false;\r\n\t\tprivate _draggingHorizontally: boolean = false;\r\n\t\tprivate _mouseDown: boolean = false;\r\n\t\tprivate _mouseOver: boolean = false;\r\n\t\tprivate _renderedLoopStart: number = -1;\r\n\t\tprivate _renderedLoopStop: number = -1;\r\n\t\tprivate _renderedBarCount: number = 0;\r\n\t\t\r\n\t\tconstructor(private _doc: SongDocument) {\r\n\t\t\tthis._updateCursorStatus();\r\n\t\t\tthis._render();\r\n\t\t\tthis._doc.notifier.watch(this._documentChanged);\r\n\t\t\t\r\n\t\t\tthis._svg.style.backgroundColor = ColorConfig.editorBackground;\r\n\r\n\t\t\tthis.container.addEventListener(\"mousedown\", this._whenMousePressed);\r\n\t\t\tdocument.addEventListener(\"mousemove\", this._whenMouseMoved);\r\n\t\t\tdocument.addEventListener(\"mouseup\", this._whenCursorReleased);\r\n\t\t\tthis.container.addEventListener(\"mouseover\", this._whenMouseOver);\r\n\t\t\tthis.container.addEventListener(\"mouseout\", this._whenMouseOut);\r\n\t\t\t\r\n\t\t\tthis.container.addEventListener(\"touchstart\", this._whenTouchPressed);\r\n\t\t\tthis.container.addEventListener(\"touchmove\", this._whenTouchMoved);\r\n\t\t\tthis.container.addEventListener(\"touchend\", this._whenTouchReleased);\r\n\t\t\tthis.container.addEventListener(\"touchcancel\", this._whenTouchReleased);\r\n\t\t}\r\n\t\t\r\n\t\tprivate _updateCursorStatus(): void {\r\n\t\t\tconst bar: number = this._mouseX / this._barWidth;\r\n\t\t\tthis._cursor.startBar = bar;\r\n\t\t\t\r\n\t\t\tif (bar > this._doc.song.loopStart - 0.25 && bar < this._doc.song.loopStart + this._doc.song.loopLength + 0.25) {\r\n\t\t\t\tif (bar - this._doc.song.loopStart < this._doc.song.loopLength * 0.5) {\r\n\t\t\t\t\tthis._cursor.mode = this._startMode;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis._cursor.mode = this._endMode;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthis._cursor.mode = this._bothMode;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tprivate _findEndPoints(middle: number): Endpoints {\r\n\t\t\tlet start: number = Math.round(middle - this._doc.song.loopLength / 2);\r\n\t\t\tlet end: number = start + this._doc.song.loopLength;\r\n\t\t\tif (start < 0) {\r\n\t\t\t\tend -= start;\r\n\t\t\t\tstart = 0;\r\n\t\t\t}\r\n\t\t\tif (end > this._doc.song.barCount) {\r\n\t\t\t\tstart -= end - this._doc.song.barCount;\r\n\t\t\t\tend = this._doc.song.barCount;\r\n\t\t\t}\r\n\t\t\treturn {start: start, length: end - start};\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenMouseOver = (event: MouseEvent): void => {\r\n\t\t\tif (this._mouseOver) return;\r\n\t\t\tthis._mouseOver = true;\r\n\t\t\tthis._updatePreview();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenMouseOut = (event: MouseEvent): void => {\r\n\t\t\tif (!this._mouseOver) return;\r\n\t\t\tthis._mouseOver = false;\r\n\t\t\tthis._updatePreview();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenMousePressed = (event: MouseEvent): void => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tthis._mouseDown = true;\r\n\t\t\tconst boundingRect: ClientRect = this._svg.getBoundingClientRect();\r\n    \t\tthis._mouseX = (event.clientX || event.pageX) - boundingRect.left;\r\n\t\t    this._mouseY = (event.clientY || event.pageY) - boundingRect.top;\r\n\t\t\tthis._updateCursorStatus();\r\n\t\t\tthis._updatePreview();\r\n\t\t\tthis._whenMouseMoved(event);\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenTouchPressed = (event: TouchEvent): void => {\r\n\t\t\t//event.preventDefault();\r\n\t\t\tthis._mouseDown = true;\r\n\t\t\tconst boundingRect: ClientRect = this._svg.getBoundingClientRect();\r\n\t\t\tthis._mouseX = event.touches[0].clientX - boundingRect.left;\r\n\t\t\tthis._mouseY = event.touches[0].clientY - boundingRect.top;\r\n\t\t\tthis._updateCursorStatus();\r\n\t\t\tthis._updatePreview();\r\n\t\t\t//this._whenTouchMoved(event);\r\n\t\t\tthis._clientStartX = event.touches[0].clientX;\r\n\t\t\tthis._clientStartY = event.touches[0].clientY;\r\n\t\t\tthis._draggingHorizontally = false;\r\n\t\t\tthis._startedScrolling = false;\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenMouseMoved = (event: MouseEvent): void => {\r\n\t\t\tconst boundingRect: ClientRect = this._svg.getBoundingClientRect();\r\n    \t\tthis._mouseX = (event.clientX || event.pageX) - boundingRect.left;\r\n\t\t    this._mouseY = (event.clientY || event.pageY) - boundingRect.top;\r\n\t\t    this._whenCursorMoved();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenTouchMoved = (event: TouchEvent): void => {\r\n\t\t\tif (!this._mouseDown) return;\r\n\t\t\tconst boundingRect: ClientRect = this._svg.getBoundingClientRect();\r\n\t\t\tthis._mouseX = event.touches[0].clientX - boundingRect.left;\r\n\t\t\tthis._mouseY = event.touches[0].clientY - boundingRect.top;\r\n\t\t\t\r\n\t\t\tif (!this._draggingHorizontally && !this._startedScrolling) {\r\n\t\t\t\tif (Math.abs(event.touches[0].clientY - this._clientStartY) > 10) {\r\n\t\t\t\t\tthis._startedScrolling = true;\r\n\t\t\t\t} else if (Math.abs(event.touches[0].clientX - this._clientStartX) > 10) {\r\n\t\t\t\t\tthis._draggingHorizontally = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t    if (this._draggingHorizontally) {\r\n\t\t\t\tthis._whenCursorMoved();\r\n\t\t\t\tevent.preventDefault();\r\n\t\t    }\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenCursorMoved(): void {\r\n\t\t\tif (this._mouseDown) {\r\n\t\t\t\tlet oldStart: number = this._doc.song.loopStart;\r\n\t\t\t\tlet oldEnd: number = this._doc.song.loopStart + this._doc.song.loopLength;\r\n\t\t\t\tif (this._change != null && this._doc.lastChangeWas(this._change)) {\r\n\t\t\t\t\toldStart = this._change.oldStart;\r\n\t\t\t\t\toldEnd = oldStart + this._change.oldLength;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tconst bar: number = this._mouseX / this._barWidth;\r\n\t\t\t\tlet start: number;\r\n\t\t\t\tlet end: number;\r\n\t\t\t\tlet temp: number;\r\n\t\t\t\tif (this._cursor.mode == this._startMode) {\r\n\t\t\t\t\tstart = oldStart + Math.round(bar - this._cursor.startBar);\r\n\t\t\t\t\tend = oldEnd;\r\n\t\t\t\t\t// @TODO: clamp before ChangeLoop like ModBox?\r\n\t\t\t\t\tif (start < 0) start = 0;\r\n\t\t\t\t\tif (start >= this._doc.song.barCount) start = this._doc.song.barCount;\r\n\t\t\t\t\tif (start == end) {\r\n\t\t\t\t\t\tstart = end - 1;\r\n\t\t\t\t\t} else if (start > end) {\r\n\t\t\t\t\t\ttemp = start;\r\n\t\t\t\t\t\tstart = end;\r\n\t\t\t\t\t\tend = temp;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis._change = new ChangeLoop(this._doc, oldStart, oldEnd - oldStart, start, end - start);\r\n\t\t\t\t} else if (this._cursor.mode == this._endMode) {\r\n\t\t\t\t\tstart = oldStart;\r\n\t\t\t\t\tend = oldEnd + Math.round(bar - this._cursor.startBar);\r\n\t\t\t\t\t// @TODO: clamp before ChangeLoop like ModBox?\r\n\t\t\t\t\tif (end < 0) end = 0;\r\n\t\t\t\t\tif (end >= this._doc.song.barCount) end = this._doc.song.barCount;\r\n\t\t\t\t\tif (end == start) {\r\n\t\t\t\t\t\tend = start + 1;\r\n\t\t\t\t\t} else if (end < start) {\r\n\t\t\t\t\t\ttemp = start;\r\n\t\t\t\t\t\tstart = end;\r\n\t\t\t\t\t\tend = temp;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis._change = new ChangeLoop(this._doc, oldStart, oldEnd - oldStart, start, end - start);\r\n\t\t\t\t} else if (this._cursor.mode == this._bothMode) {\r\n\t\t\t\t\tconst endPoints: Endpoints = this._findEndPoints(bar);\r\n\t\t\t\t\tthis._change = new ChangeLoop(this._doc, oldStart, oldEnd - oldStart, endPoints.start, endPoints.length);\r\n\t\t\t\t}\r\n\t\t\t\tthis._doc.setProspectiveChange(this._change);\r\n\t\t\t} else {\r\n\t\t\t\tthis._updateCursorStatus();\r\n\t\t\t\tthis._updatePreview();\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenTouchReleased = (event: TouchEvent): void => {\r\n\t\t\tevent.preventDefault();\r\n\t\t    if (!this._startedScrolling) {\r\n\t\t\t\tthis._whenCursorMoved();\r\n\t\t\t\tthis._mouseOver = false;\r\n\t\t\t\tthis._whenCursorReleased(event);\r\n\t\t\t\tthis._updatePreview();\r\n\t\t    }\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenCursorReleased = (event: Event): void => {\r\n\t\t\tif (this._change != null) this._doc.record(this._change);\r\n\t\t\tthis._change = null;\r\n\t\t\tthis._mouseDown = false;\r\n\t\t\tthis._updateCursorStatus();\r\n\t\t\tthis._render();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _updatePreview(): void {\r\n\t\t\tconst showHighlight: boolean = this._mouseOver && !this._mouseDown;\r\n\t\t\tthis._highlight.style.visibility = showHighlight ? \"visible\" : \"hidden\";\r\n\t\t\t\r\n\t\t\tif (showHighlight) {\r\n\t\t\t\tconst radius: number = this._editorHeight / 2;\r\n\t\t\t\t\r\n\t\t\t\tlet highlightStart: number = (this._doc.song.loopStart) * this._barWidth;\r\n\t\t\t\tlet highlightStop: number = (this._doc.song.loopStart + this._doc.song.loopLength) * this._barWidth;\r\n\t\t\t\tif (this._cursor.mode == this._startMode) {\r\n\t\t\t\t\thighlightStop = (this._doc.song.loopStart) * this._barWidth + radius * 2;\r\n\t\t\t\t} else if (this._cursor.mode == this._endMode) {\r\n\t\t\t\t\thighlightStart = (this._doc.song.loopStart + this._doc.song.loopLength) * this._barWidth - radius * 2;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconst endPoints: Endpoints = this._findEndPoints(this._cursor.startBar);\r\n\t\t\t\t\thighlightStart = (endPoints.start) * this._barWidth;\r\n\t\t\t\t\thighlightStop = (endPoints.start + endPoints.length) * this._barWidth;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tthis._highlight.setAttribute(\"d\",\r\n\t\t\t\t\t`M ${highlightStart + radius} ${4} ` +\r\n\t\t\t\t\t`L ${highlightStop - radius} ${4} ` +\r\n\t\t\t\t\t`A ${radius - 4} ${radius - 4} ${0} ${0} ${1} ${highlightStop - radius} ${this._editorHeight - 4} ` +\r\n\t\t\t\t\t`L ${highlightStart + radius} ${this._editorHeight - 4} ` +\r\n\t\t\t\t\t`A ${radius - 4} ${radius - 4} ${0} ${0} ${1} ${highlightStart + radius} ${4} ` +\r\n\t\t\t\t\t`z`\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tprivate _documentChanged = (): void => {\r\n\t\t\tthis._render();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _render(): void {\r\n\t\t\tconst radius: number = this._editorHeight / 2;\r\n\t\t\tconst loopStart: number = (this._doc.song.loopStart) * this._barWidth;\r\n\t\t\tconst loopStop: number = (this._doc.song.loopStart + this._doc.song.loopLength) * this._barWidth;\r\n\t\t\t\r\n\t\t\tif (this._renderedBarCount != this._doc.song.barCount) {\r\n\t\t\t\tthis._renderedBarCount = this._doc.song.barCount;\r\n\t\t\t\tconst editorWidth = 32 * this._doc.song.barCount;\r\n\t\t\t\tthis.container.style.width = editorWidth + \"px\";\r\n\t\t\t\tthis._svg.setAttribute(\"width\", editorWidth + \"\");\r\n\t\t\t}\r\n\r\n\t\t\tif (this._renderedLoopStart != loopStart || this._renderedLoopStop != loopStop) {\r\n\t\t\t\tthis._renderedLoopStart = loopStart;\r\n\t\t\t\tthis._renderedLoopStop = loopStop;\r\n\t\t\t\tthis._loop.setAttribute(\"d\",\r\n\t\t\t\t\t`M ${loopStart + radius} ${2} ` +\r\n\t\t\t\t\t`L ${loopStop - radius} ${2} ` +\r\n\t\t\t\t\t`A ${radius - 2} ${radius - 2} ${0} ${0} ${1} ${loopStop - radius} ${this._editorHeight - 2} ` +\r\n\t\t\t\t\t`L ${loopStart + radius} ${this._editorHeight - 2} ` +\r\n\t\t\t\t\t`A ${radius - 2} ${radius - 2} ${0} ${0} ${1} ${loopStart + radius} ${2} ` +\r\n\t\t\t\t\t`z`\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._updatePreview();\r\n\t\t}\r\n\t}\r\n\r\n","/*\r\nCopyright (C) 2018 John Nesky\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of \r\nthis software and associated documentation files (the \"Software\"), to deal in \r\nthe Software without restriction, including without limitation the rights to \r\nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \r\nof the Software, and to permit persons to whom the Software is furnished to do \r\nso, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all \r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \r\nSOFTWARE.\r\n*/\r\n\r\nimport { HTML, SVG } from \"imperative-html/dist/esm/elements-strict\";\r\nimport { SongDocument } from \"./SongDocument\";\r\nconst {div} = HTML;\r\n\r\n\texport class BarScrollBar {\r\n\t\tprivate readonly _editorWidth: number = 512;\r\n\t\tprivate readonly _editorHeight: number = 20;\r\n\t\t\r\n\t\tprivate readonly _notches = <SVGSVGElement> SVG.svg( {\"pointer-events\": \"none\"});\r\n\t\tprivate readonly _handle = <SVGRectElement> SVG.rect( {fill: \"#444444\", x: 0, y: 2, width: 10, height: this._editorHeight - 4});\r\n\t\tprivate readonly _handleHighlight = <SVGRectElement> SVG.rect( {fill: \"none\", stroke: \"white\", \"stroke-width\": 2, \"pointer-events\": \"none\", x: 0, y: 1, width: 10, height: this._editorHeight - 2});\r\n\t\tprivate readonly _leftHighlight = <SVGPathElement> SVG.path( {fill: \"white\", \"pointer-events\": \"none\"});\r\n\t\tprivate readonly _rightHighlight = <SVGPathElement> SVG.path( {fill: \"white\", \"pointer-events\": \"none\"});\r\n\t\t\r\n\t\tprivate readonly _svg = <SVGSVGElement> SVG.svg( {style: \"background-color: #000000; touch-action: pan-y; position: absolute;\", width: this._editorWidth, height: this._editorHeight}, [\r\n\t\t\tthis._notches,\r\n\t\t\tthis._handle,\r\n\t\t\tthis._handleHighlight,\r\n\t\t\tthis._leftHighlight,\r\n\t\t\tthis._rightHighlight,\r\n\t\t]);\r\n\t\t\r\n\t\tpublic readonly container: HTMLElement = div({class: \"barScrollBar\", style: \"width: 512px; height: 20px; overflow: hidden; position: relative;\"}, [this._svg]);\r\n\t\t\r\n\t\tprivate _mouseX: number = 0;\r\n\t\tpublic _mouseY: number = 0;\r\n\t\tprivate _mouseDown: boolean = false;\r\n\t\tprivate _mouseOver: boolean = false;\r\n\t\tprivate _dragging: boolean = false;\r\n\t\tprivate _dragStart: number;\r\n\t\tprivate _barWidth: number;\r\n\t\tprivate _renderedNotchCount: number = -1;\r\n\t\tprivate _renderedBarPos: number = -1;\r\n\t\t\r\n\t\tconstructor(private _doc: SongDocument, private _trackContainer: HTMLDivElement) {\r\n\t\t\tconst center: number = this._editorHeight * 0.5;\r\n\t\t\tconst base: number = 20;\r\n\t\t\tconst tip: number = 9;\r\n\t\t\tconst arrowHeight: number = 6;\r\n\t\t\tthis._leftHighlight.setAttribute(\"d\", `M ${tip} ${center} L ${base} ${center + arrowHeight} L ${base} ${center - arrowHeight} z`);\r\n\t\t\tthis._rightHighlight.setAttribute(\"d\", `M ${this._editorWidth - tip} ${center} L ${this._editorWidth - base} ${center + arrowHeight} L ${this._editorWidth - base} ${center - arrowHeight} z`);\r\n\t\t\t\r\n\t\t\tthis.container.addEventListener(\"mousedown\", this._whenMousePressed);\r\n\t\t\tdocument.addEventListener(\"mousemove\", this._whenMouseMoved);\r\n\t\t\tdocument.addEventListener(\"mouseup\", this._whenCursorReleased);\r\n\t\t\tthis.container.addEventListener(\"mouseover\", this._whenMouseOver);\r\n\t\t\tthis.container.addEventListener(\"mouseout\", this._whenMouseOut);\r\n\t\t\t\r\n\t\t\tthis.container.addEventListener(\"touchstart\", this._whenTouchPressed);\r\n\t\t\tthis.container.addEventListener(\"touchmove\", this._whenTouchMoved);\r\n\t\t\tthis.container.addEventListener(\"touchend\", this._whenCursorReleased);\r\n\t\t\tthis.container.addEventListener(\"touchcancel\", this._whenCursorReleased);\r\n\t\t\t\r\n\t\t\t// Sorry, bypassing typescript type safety on this function because I want to use the new \"passive\" option.\r\n\t\t\t//this._trackContainer.addEventListener(\"scroll\", this._onScroll, {capture: false, passive: true});\r\n\t\t\t(<Function>this._trackContainer.addEventListener)(\"scroll\", this._onScroll, {capture: false, passive: true});\r\n\t\t}\r\n\t\t\r\n\t\tprivate _onScroll = (event: Event): void => {\r\n\t\t\tthis._doc.barScrollPos = (this._trackContainer.scrollLeft / 32);\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenMouseOver = (event: MouseEvent): void => {\r\n\t\t\tif (this._mouseOver) return;\r\n\t\t\tthis._mouseOver = true;\r\n\t\t\tthis._updatePreview();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenMouseOut = (event: MouseEvent): void => {\r\n\t\t\tif (!this._mouseOver) return;\r\n\t\t\tthis._mouseOver = false;\r\n\t\t\tthis._updatePreview();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenMousePressed = (event: MouseEvent): void => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tthis._mouseDown = true;\r\n\t\t\tconst boundingRect: ClientRect = this._svg.getBoundingClientRect();\r\n    \t\tthis._mouseX = (event.clientX || event.pageX) - boundingRect.left;\r\n\t\t    this._mouseY = (event.clientY || event.pageY) - boundingRect.top;\r\n\t\t\tthis._updatePreview();\r\n\t\t\tif (this._mouseX >= this._doc.barScrollPos * this._barWidth && this._mouseX <= (this._doc.barScrollPos + this._doc.trackVisibleBars) * this._barWidth) {\r\n\t\t\t\tthis._dragging = true;\r\n\t\t\t\tthis._dragStart = this._mouseX;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenTouchPressed = (event: TouchEvent): void => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tthis._mouseDown = true;\r\n\t\t\tconst boundingRect: ClientRect = this._svg.getBoundingClientRect();\r\n\t\t\tthis._mouseX = event.touches[0].clientX - boundingRect.left;\r\n\t\t\tthis._mouseY = event.touches[0].clientY - boundingRect.top;\r\n\t\t\tthis._updatePreview();\r\n\t\t\tif (this._mouseX >= this._doc.barScrollPos * this._barWidth && this._mouseX <= (this._doc.barScrollPos + this._doc.trackVisibleBars) * this._barWidth) {\r\n\t\t\t\tthis._dragging = true;\r\n\t\t\t\tthis._dragStart = this._mouseX;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenMouseMoved = (event: MouseEvent): void => {\r\n\t\t\tconst boundingRect: ClientRect = this._svg.getBoundingClientRect();\r\n    \t\tthis._mouseX = (event.clientX || event.pageX) - boundingRect.left;\r\n\t\t    this._mouseY = (event.clientY || event.pageY) - boundingRect.top;\r\n\t\t    this._whenCursorMoved();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenTouchMoved = (event: TouchEvent): void => {\r\n\t\t\tif (!this._mouseDown) return;\r\n\t\t\tevent.preventDefault();\r\n\t\t\tconst boundingRect: ClientRect = this._svg.getBoundingClientRect();\r\n\t\t\tthis._mouseX = event.touches[0].clientX - boundingRect.left;\r\n\t\t\tthis._mouseY = event.touches[0].clientY - boundingRect.top;\r\n\t\t    this._whenCursorMoved();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenCursorMoved(): void {\r\n\t\t\tif (this._dragging) {\r\n\t\t\t\twhile (this._mouseX - this._dragStart < -this._barWidth * 0.5) {\r\n\t\t\t\t\tif (this._doc.barScrollPos > 0) {\r\n\t\t\t\t\t\tthis._doc.barScrollPos--;\r\n\t\t\t\t\t\tthis._dragStart -= this._barWidth;\r\n\t\t\t\t\t\tthis._doc.notifier.changed();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\twhile (this._mouseX - this._dragStart > this._barWidth * 0.5) {\r\n\t\t\t\t\tif (this._doc.barScrollPos < this._doc.song.barCount - this._doc.trackVisibleBars) {\r\n\t\t\t\t\t\tthis._doc.barScrollPos++;\r\n\t\t\t\t\t\tthis._dragStart += this._barWidth;\r\n\t\t\t\t\t\tthis._doc.notifier.changed();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (this._mouseOver) this._updatePreview();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenCursorReleased = (event: Event): void => {\r\n\t\t\tif (!this._dragging && this._mouseDown) {\r\n\t\t\t\tif (this._mouseX < (this._doc.barScrollPos + 8) * this._barWidth) {\r\n\t\t\t\t\tif (this._doc.barScrollPos > 0) this._doc.barScrollPos--;\r\n\t\t\t\t\tthis._doc.notifier.changed();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (this._doc.barScrollPos < this._doc.song.barCount - this._doc.trackVisibleBars) this._doc.barScrollPos++;\r\n\t\t\t\t\tthis._doc.notifier.changed();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis._mouseDown = false;\r\n\t\t\tthis._dragging = false;\r\n\t\t\tthis._updatePreview();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _updatePreview(): void {\r\n\t\t\tconst showHighlight: boolean = this._mouseOver && !this._mouseDown;\r\n\t\t\tlet showleftHighlight: boolean = false;\r\n\t\t\tlet showRightHighlight: boolean = false;\r\n\t\t\tlet showHandleHighlight: boolean = false;\r\n\t\t\t\r\n\t\t\tif (showHighlight) {\r\n\t\t\t\tif (this._mouseX < this._doc.barScrollPos * this._barWidth) {\r\n\t\t\t\t\tshowleftHighlight = true;\r\n\t\t\t\t} else if (this._mouseX > (this._doc.barScrollPos + this._doc.trackVisibleBars) * this._barWidth) {\r\n\t\t\t\t\tshowRightHighlight = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tshowHandleHighlight = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._leftHighlight.style.visibility = showleftHighlight ? \"visible\" : \"hidden\";\r\n\t\t\tthis._rightHighlight.style.visibility = showRightHighlight ? \"visible\" : \"hidden\";\r\n\t\t\tthis._handleHighlight.style.visibility = showHandleHighlight ? \"visible\" : \"hidden\";\r\n\t\t}\r\n\t\t\r\n\t\tpublic render(): void {\r\n\t\t\tthis._barWidth = (this._editorWidth-1) / Math.max(this._doc.trackVisibleBars, this._doc.song.barCount);\r\n\t\t\t\r\n\t\t\tconst resized: boolean = this._renderedNotchCount != this._doc.song.barCount;\r\n\t\t\tif (resized) {\r\n\t\t\t\tthis._renderedNotchCount = this._doc.song.barCount;\r\n\t\t\t\t\r\n\t\t\t\twhile (this._notches.firstChild) this._notches.removeChild(this._notches.firstChild);\r\n\t\t\t\t\r\n\t\t\t\tfor (let i: number = 0; i <= this._doc.song.barCount; i++) {\r\n\t\t\t\t\tconst lineHeight: number = (i % 16 == 0) ? 0 : ((i % 4 == 0) ? this._editorHeight / 8 : this._editorHeight / 3);\r\n\t\t\t\t\tthis._notches.appendChild(SVG.rect( {fill: \"#444444\", x: i * this._barWidth - 1, y: lineHeight, width: 2, height: this._editorHeight - lineHeight * 2}));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (resized || this._renderedBarPos != this._doc.barScrollPos) {\r\n\t\t\t\tthis._renderedBarPos = this._doc.barScrollPos;\r\n\t\t\t\tthis._handle.setAttribute(\"x\", \"\" + (this._barWidth * this._doc.barScrollPos));\r\n\t\t\t\tthis._handle.setAttribute(\"width\", \"\" + (this._barWidth * this._doc.trackVisibleBars));\r\n\t\t\t\tthis._handleHighlight.setAttribute(\"x\", \"\" + (this._barWidth * this._doc.barScrollPos));\r\n\t\t\t\tthis._handleHighlight.setAttribute(\"width\", \"\" + (this._barWidth * this._doc.trackVisibleBars));\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._updatePreview();\r\n\t\t\t\r\n\t\t\tthis._trackContainer.scrollLeft = this._doc.barScrollPos * 32;\r\n\t\t}\r\n\t}\r\n\r\n","/*\r\nCopyright (C) 2018 John Nesky\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of \r\nthis software and associated documentation files (the \"Software\"), to deal in \r\nthe Software without restriction, including without limitation the rights to \r\nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \r\nof the Software, and to permit persons to whom the Software is furnished to do \r\nso, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all \r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \r\nSOFTWARE.\r\n*/\r\n\r\nimport { HTML, SVG } from \"imperative-html/dist/esm/elements-strict\";\r\nimport { SongDocument } from \"./SongDocument\";\r\nimport { ChangeOctave } from \"./changes\";\r\nimport { ColorConfig } from \"./ColorConfig\";\r\n\tconst {div} = HTML;\r\n\r\n\texport class OctaveScrollBar {\r\n\t\tprivate readonly _editorWidth: number = 20;\r\n\t\tprivate readonly _editorHeight: number = 481;\r\n\t\tprivate readonly _notchHeight: number = 4.0;\r\n\t\tprivate readonly _octaveCount: number = 7;\r\n\t\tprivate readonly _octaveHeight: number = (this._editorHeight - this._notchHeight) / this._octaveCount;\r\n\t\tprivate readonly _barHeight: number = (this._octaveHeight * 3 + this._notchHeight);\r\n\t\t\r\n\t\tprivate readonly _handle = <SVGRectElement> SVG.rect( {fill: ColorConfig.octaveScrollbar, x: 2, y: 0, width: this._editorWidth - 4, height: this._barHeight});\r\n\t\tprivate readonly _handleHighlight = <SVGRectElement> SVG.rect( {fill: \"none\", stroke: \"white\", \"stroke-width\": 2, \"pointer-events\": \"none\", x: 1, y: 0, width: this._editorWidth - 2, height: this._barHeight});\r\n\t\tprivate readonly _upHighlight = <SVGPathElement> SVG.path( {fill: \"white\", \"pointer-events\": \"none\"});\r\n\t\tprivate readonly _downHighlight = <SVGPathElement> SVG.path( {fill: \"white\", \"pointer-events\": \"none\"});\r\n\t\t\r\n\t\tprivate readonly _svg = <SVGSVGElement> SVG.svg( {style: \"touch-action: pan-x; position: absolute;\", width: this._editorWidth, height: \"100%\", viewBox: \"0 0 20 481\", preserveAspectRatio: \"none\"});\r\n\t\tpublic readonly container: HTMLDivElement = div({id: \"octaveScrollBarContainer\", style: \"width: 20px; height: 100%; overflow: hidden; position: relative; flex-shrink: 0;\"}, [this._svg]);\r\n\t\t\r\n\t\tpublic _mouseX: number = 0;\r\n\t\tprivate _mouseY: number = 0;\r\n\t\tprivate _mouseDown: boolean = false;\r\n\t\tprivate _mouseOver: boolean = false;\r\n\t\tprivate _dragging: boolean = false;\r\n\t\tprivate _dragStart: number;\r\n\t\tprivate _barBottom: number;\r\n\t\tprivate _renderedBarBottom: number = -1;\r\n\t\tprivate _change: ChangeOctave | null = null;\r\n\t\t\r\n\t\tconstructor(private _doc: SongDocument) {\r\n\t\t\tthis._doc.notifier.watch(this._documentChanged);\r\n\t\t\tthis._documentChanged();\r\n\t\t\t\r\n\t\t\tthis._svg.appendChild(this._handle);\r\n\t\t\t\r\n\t\t\t// notches:\r\n\t\t\tfor (let i: number = 0; i <= this._octaveCount; i++) {\r\n\t\t\t\tthis._svg.appendChild(SVG.rect( {fill: ColorConfig.scrollbarOctave, x: 0, y: i * this._octaveHeight, width: this._editorWidth, height: this._notchHeight}));\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._svg.appendChild(this._handleHighlight);\r\n\t\t\tthis._svg.appendChild(this._upHighlight);\r\n\t\t\tthis._svg.appendChild(this._downHighlight);\r\n\t\t\tthis._svg.style.backgroundColor = ColorConfig.editorBackground;\r\n\t\t\t\r\n\t\t\tconst center: number = this._editorWidth * 0.5;\r\n\t\t\tconst base: number = 20;\r\n\t\t\tconst tip: number = 9;\r\n\t\t\tconst arrowWidth: number = 6;\r\n\t\t\tthis._upHighlight.setAttribute(\"d\", `M ${center} ${tip} L ${center + arrowWidth} ${base} L ${center - arrowWidth} ${base} z`);\r\n\t\t\tthis._downHighlight.setAttribute(\"d\", `M ${center} ${this._editorHeight - tip} L ${center + arrowWidth} ${this._editorHeight - base} L ${center - arrowWidth} ${this._editorHeight - base} z`);\r\n\t\t\t\r\n\t\t\tthis.container.addEventListener(\"mousedown\", this._whenMousePressed);\r\n\t\t\tdocument.addEventListener(\"mousemove\", this._whenMouseMoved);\r\n\t\t\tdocument.addEventListener(\"mouseup\", this._whenCursorReleased);\r\n\t\t\tthis.container.addEventListener(\"mouseover\", this._whenMouseOver);\r\n\t\t\tthis.container.addEventListener(\"mouseout\", this._whenMouseOut);\r\n\t\t\t\r\n\t\t\tthis.container.addEventListener(\"touchstart\", this._whenTouchPressed);\r\n\t\t\tthis.container.addEventListener(\"touchmove\", this._whenTouchMoved);\r\n\t\t\tthis.container.addEventListener(\"touchend\", this._whenCursorReleased);\r\n\t\t\tthis.container.addEventListener(\"touchcancel\", this._whenCursorReleased);\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenMouseOver = (event: MouseEvent): void => {\r\n\t\t\tif (this._mouseOver) return;\r\n\t\t\tthis._mouseOver = true;\r\n\t\t\tthis._updatePreview();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenMouseOut = (event: MouseEvent): void => {\r\n\t\t\tif (!this._mouseOver) return;\r\n\t\t\tthis._mouseOver = false;\r\n\t\t\tthis._updatePreview();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenMousePressed = (event: MouseEvent): void => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tthis._mouseDown = true;\r\n\t\t\tconst boundingRect: ClientRect = this._svg.getBoundingClientRect();\r\n    \t\tthis._mouseX = (event.clientX || event.pageX) - boundingRect.left;\r\n\t\t    this._mouseY = ((event.clientY || event.pageY) - boundingRect.top) * this._editorHeight / (boundingRect.bottom - boundingRect.top);\r\n\t\t    if (isNaN(this._mouseY)) this._mouseY = 0;\r\n\t\t\tif (this._doc.song.getChannelIsDrum(this._doc.channel)) return;\r\n\t\t\tthis._updatePreview();\r\n\t\t\t\r\n\t\t\tif (this._mouseY >= this._barBottom - this._barHeight && this._mouseY <= this._barBottom) {\r\n\t\t\t\tthis._dragging = true;\r\n\t\t\t\tthis._change = null;\r\n\t\t\t\tthis._dragStart = this._mouseY;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenTouchPressed = (event: TouchEvent): void => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tthis._mouseDown = true;\r\n\t\t\tconst boundingRect: ClientRect = this._svg.getBoundingClientRect();\r\n\t\t\tthis._mouseX = event.touches[0].clientX - boundingRect.left;\r\n\t\t\tthis._mouseY = (event.touches[0].clientY - boundingRect.top) * this._editorHeight / (boundingRect.bottom - boundingRect.top);\r\n\t\t    if (isNaN(this._mouseY)) this._mouseY = 0;\r\n\t\t\tif (this._doc.song.getChannelIsDrum(this._doc.channel)) return;\r\n\t\t\tthis._updatePreview();\r\n\t\t\t\r\n\t\t\tif (this._mouseY >= this._barBottom - this._barHeight && this._mouseY <= this._barBottom) {\r\n\t\t\t\tthis._dragging = true;\r\n\t\t\t\tthis._change = null;\r\n\t\t\t\tthis._dragStart = this._mouseY;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenMouseMoved = (event: MouseEvent): void => {\r\n\t\t\tconst boundingRect: ClientRect = this._svg.getBoundingClientRect();\r\n    \t\tthis._mouseX = (event.clientX || event.pageX) - boundingRect.left;\r\n\t\t    this._mouseY = ((event.clientY || event.pageY) - boundingRect.top) * this._editorHeight / (boundingRect.bottom - boundingRect.top);\r\n\t\t    if (isNaN(this._mouseY)) this._mouseY = 0;\r\n\t\t    this._whenCursorMoved();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenTouchMoved = (event: TouchEvent): void => {\r\n\t\t\tif (!this._mouseDown) return;\r\n\t\t\tevent.preventDefault();\r\n\t\t\tconst boundingRect: ClientRect = this._svg.getBoundingClientRect();\r\n\t\t\tthis._mouseX = event.touches[0].clientX - boundingRect.left;\r\n\t\t\tthis._mouseY = (event.touches[0].clientY - boundingRect.top) * this._editorHeight / (boundingRect.bottom - boundingRect.top);\r\n\t\t    if (isNaN(this._mouseY)) this._mouseY = 0;\r\n\t\t    this._whenCursorMoved();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenCursorMoved(): void {\r\n\t\t\tif (this._doc.song.getChannelIsDrum(this._doc.channel)) return;\r\n\t\t\tif (this._dragging) {\r\n\t\t\t\tconst currentOctave: number = this._doc.song.channels[this._doc.channel].octave;\r\n\t\t\t\tconst continuingProspectiveChange: boolean = this._doc.lastChangeWas(this._change);\r\n\t\t\t\tconst oldValue: number = continuingProspectiveChange ? this._change!.oldValue : currentOctave;\r\n\t\t\t\t\r\n\t\t\t\tlet octave: number = currentOctave;\r\n\t\t\t\twhile (this._mouseY - this._dragStart < -this._octaveHeight * 0.5) {\r\n\t\t\t\t\tif (octave < 4) {\r\n\t\t\t\t\t\toctave++;\r\n\t\t\t\t\t\tthis._dragStart -= this._octaveHeight;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\twhile (this._mouseY - this._dragStart > this._octaveHeight * 0.5) {\r\n\t\t\t\t\tif (octave > 0) {\r\n\t\t\t\t\t\toctave--;\r\n\t\t\t\t\t\tthis._dragStart += this._octaveHeight;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tthis._change = new ChangeOctave(this._doc, oldValue, octave);\r\n\t\t\t\tthis._doc.setProspectiveChange(this._change);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (this._mouseOver) this._updatePreview();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenCursorReleased = (event: Event): void => {\r\n\t\t\tif (!this._doc.song.getChannelIsDrum(this._doc.channel) && this._mouseDown) {\r\n\t\t\t\tif (this._dragging) {\r\n\t\t\t\t\tif (this._change != null) this._doc.record(this._change);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconst canReplaceLastChange: boolean = this._doc.lastChangeWas(this._change);\r\n\t\t\t\t\tconst oldValue: number = canReplaceLastChange ? this._change!.oldValue : this._doc.song.channels[this._doc.channel].octave;\r\n\t\t\t\t\tconst currentOctave: number = this._doc.song.channels[this._doc.channel].octave;\r\n\t\t\t\t\r\n\t\t\t\t\tif (this._mouseY < this._barBottom - this._barHeight * 0.5) {\r\n\t\t\t\t\t\tif (currentOctave < 4) {\r\n\t\t\t\t\t\t\tthis._change = new ChangeOctave(this._doc, oldValue, currentOctave + 1);\r\n\t\t\t\t\t\t\tthis._doc.record(this._change, canReplaceLastChange);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (currentOctave > 0) {\r\n\t\t\t\t\t\t\tthis._change = new ChangeOctave(this._doc, oldValue, currentOctave - 1);\r\n\t\t\t\t\t\t\tthis._doc.record(this._change, canReplaceLastChange);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis._mouseDown = false;\r\n\t\t\tthis._dragging = false;\r\n\t\t\tthis._updatePreview();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _updatePreview(): void {\r\n\t\t\tconst showHighlight: boolean = this._mouseOver && !this._mouseDown;\r\n\t\t\tlet showUpHighlight: boolean = false;\r\n\t\t\tlet showDownHighlight: boolean = false;\r\n\t\t\tlet showHandleHighlight: boolean = false;\r\n\t\t\t\r\n\t\t\tif (showHighlight) {\r\n\t\t\t\tif (this._mouseY < this._barBottom - this._barHeight) {\r\n\t\t\t\t\tshowUpHighlight = true;\r\n\t\t\t\t} else if (this._mouseY > this._barBottom) {\r\n\t\t\t\t\tshowDownHighlight = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tshowHandleHighlight = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._upHighlight.style.visibility = showUpHighlight ? \"inherit\" : \"hidden\";\r\n\t\t\tthis._downHighlight.style.visibility = showDownHighlight ? \"inherit\" : \"hidden\";\r\n\t\t\tthis._handleHighlight.style.visibility = showHandleHighlight ? \"inherit\" : \"hidden\";\r\n\t\t}\r\n\t\t\r\n\t\tprivate _documentChanged = (): void => {\r\n\t\t\tthis._barBottom = this._editorHeight - (this._octaveHeight * this._doc.song.channels[this._doc.channel].octave);\r\n\t\t\tthis._render();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _render(): void {\r\n\t\t\tthis._svg.style.visibility = (this._doc.song.getChannelIsDrum(this._doc.channel)) ? \"hidden\" : \"visible\";\r\n\t\t\tif (this._renderedBarBottom != this._barBottom) {\r\n\t\t\t\tthis._renderedBarBottom = this._barBottom;\r\n\t\t\t\tthis._handle.setAttribute(\"y\", \"\" + (this._barBottom - this._barHeight));\r\n\t\t\t\tthis._handleHighlight.setAttribute(\"y\", \"\" + (this._barBottom - this._barHeight));\r\n\t\t\t}\r\n\t\t\tthis._updatePreview();\r\n\t\t}\r\n\t}\r\n\r\n","/*\r\nCopyright (C) 2018 John Nesky\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of \r\nthis software and associated documentation files (the \"Software\"), to deal in \r\nthe Software without restriction, including without limitation the rights to \r\nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \r\nof the Software, and to permit persons to whom the Software is furnished to do \r\nso, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all \r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \r\nSOFTWARE.\r\n*/\r\n\r\nimport { HTML } from \"imperative-html/dist/esm/elements-strict\";\r\nimport { SongDocument } from \"./SongDocument\";\r\nimport { Config } from \"../synth/SynthConfig\";\r\nimport { ColorConfig } from \"./ColorConfig\";\r\n\tconst {canvas, div} = HTML;\r\n\r\n\texport class Piano {\r\n\r\n\t\tprivate readonly _pianoContainer: HTMLDivElement = HTML.div({style: \"width: 100%; height: 100%; display: flex; flex-direction: column-reverse; align-items: stretch;\"});\r\n\t\tprivate readonly _drumContainer: HTMLDivElement = HTML.div({style: \"width: 100%; height: 100%; display: flex; flex-direction: column-reverse; align-items: stretch;\"});\r\n\t\tprivate readonly _preview: HTMLCanvasElement = canvas({width: \"32\", height: \"40\"});\r\n\t\tpublic readonly container: HTMLDivElement = div({style: \"width: 32px; height: 100%; overflow:hidden; position: relative; flex-shrink: 0; touch-action: none;\"}, [\r\n\t\t\tthis._pianoContainer,\r\n\t\t\tthis._drumContainer,\r\n\t\t\tthis._preview,\r\n\t\t]);\r\n\t\tprivate readonly _editorHeight: number = 481;\r\n\t\tprivate readonly _pianoKeys: HTMLDivElement[] = [];\r\n\t\tprivate readonly _pianoLabels: HTMLDivElement[] = [];\r\n\t\t\r\n\t\tprivate _pitchHeight: number;\r\n\t\tprivate _pitchCount: number;\r\n\t\tpublic _mouseX: number = 0;\r\n\t\tprivate _mouseY: number = 0;\r\n\t\tprivate _mouseDown: boolean = false;\r\n\t\tprivate _mouseOver: boolean = false;\r\n\t\tprivate _cursorPitch: number;\r\n\t\t//private _playedPitch: number = -1;\r\n\t\tprivate _renderedScale: number = -1;\r\n\t\tprivate _renderedDrums: boolean = false;\r\n\t\tprivate _renderedKey: number = -1;\r\n\t\tprivate _renderedPitchCount: number = -1;\r\n\t\tprivate readonly _renderedLiveInputPitches: number[] = [];\r\n\t\t\r\n\t\tconstructor(private _doc: SongDocument) {\r\n\t\t\tfor (let i: number = 0; i < Config.drumCount; i++) {\r\n\t\t\t\tconst scale: number = (1.0 - (i / Config.drumCount) * 0.35) * 100;\r\n\t\t\t\tthis._drumContainer.appendChild(HTML.div({class: \"drum-button\", style: `background-size: ${scale}% ${scale}%;`}));\r\n\t\t\t}\r\n\t\t\tthis._doc.notifier.watch(this._documentChanged);\r\n\t\t\tthis._documentChanged();\r\n\t\t\t\r\n\t\t\t//this.container.addEventListener(\"mousedown\", this._whenMousePressed);\r\n\t\t\tdocument.addEventListener(\"mousemove\", this._whenMouseMoved);\r\n\t\t\tdocument.addEventListener(\"mouseup\", this._whenMouseReleased);\r\n\t\t\tthis.container.addEventListener(\"mouseover\", this._whenMouseOver);\r\n\t\t\tthis.container.addEventListener(\"mouseout\", this._whenMouseOut);\r\n\t\t\t\r\n\t\t\t//this.container.addEventListener(\"touchstart\", this._whenTouchPressed);\r\n\t\t\tthis.container.addEventListener(\"touchmove\", this._whenTouchMoved);\r\n\t\t\tthis.container.addEventListener(\"touchend\", this._whenTouchReleased);\r\n\t\t\tthis.container.addEventListener(\"touchcancel\", this._whenTouchReleased);\r\n\t\t}\r\n\t\t\r\n\t\tprivate _updateCursorPitch(): void {\r\n\t\tconst scale: ReadonlyArray<boolean> = Config.scales[this._doc.song.scale].flags;\r\n\t\tconst mousePitch: number = Math.max(0, Math.min(this._pitchCount-1, this._pitchCount - (this._mouseY / this._pitchHeight)));\r\n\t\tif (scale[Math.floor(mousePitch) % Config.pitchesPerOctave] || this._doc.song.getChannelIsDrum(this._doc.channel)) {\r\n\t\t\tthis._cursorPitch = Math.floor(mousePitch);\r\n\t\t} else {\r\n\t\t\tlet topPitch: number = Math.floor(mousePitch) + 1;\r\n\t\t\tlet bottomPitch: number = Math.floor(mousePitch) - 1;\r\n\t\t\twhile (!scale[topPitch % Config.pitchesPerOctave]) {\r\n\t\t\t\ttopPitch++;\r\n\t\t\t}\r\n\t\t\twhile (!scale[(bottomPitch) % Config.pitchesPerOctave]) {\r\n\t\t\t\tbottomPitch--;\r\n\t\t\t}\r\n\t\t\tlet topRange: number = topPitch;\r\n\t\t\tlet bottomRange: number = bottomPitch + 1;\r\n\t\t\tif (topPitch % Config.pitchesPerOctave == 0 || topPitch % Config.pitchesPerOctave == 7) {\r\n\t\t\t\ttopRange -= 0.5;\r\n\t\t\t}\r\n\t\t\tif (bottomPitch % Config.pitchesPerOctave == 0 || bottomPitch % Config.pitchesPerOctave == 7) {\r\n\t\t\t\tbottomRange += 0.5;\r\n\t\t\t}\r\n\t\t\tthis._cursorPitch = mousePitch - bottomRange > topRange - mousePitch ? topPitch : bottomPitch;\r\n\t\t}\r\n\t}\r\n\r\n\t\t/*private _playLiveInput(): void {\r\n\t\t\tconst currentPitch: number = this._cursorPitch + this._doc.song.channels[this._doc.channel].octave * 12;\r\n\t\t\tif (this._playedPitch == currentPitch) return;\r\n\t\t\tthis._playedPitch = currentPitch;\r\n\t\t\tthis._doc.synth.liveInputDuration = Number.MAX_SAFE_INTEGER;\r\n\t\t\tthis._doc.synth.liveInputPitches = [this._playedPitch];\r\n\t\t\tthis._doc.synth.liveInputStarted = true;\r\n\t\t}*/\r\n\t\t\r\n\t\tprivate _whenMouseOver = (event: MouseEvent): void => {\r\n\t\t\tif (this._mouseOver) return;\r\n\t\t\tthis._mouseOver = true;\r\n\t\t\tthis._updatePreview();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenMouseOut = (event: MouseEvent): void => {\r\n\t\t\tif (!this._mouseOver) return;\r\n\t\t\tthis._mouseOver = false;\r\n\t\t\tthis._updatePreview();\r\n\t\t}\r\n\t\t\r\n\t\t/*private _whenMousePressed = (event: MouseEvent): void => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\t//this._doc.synth.maintainLiveInput();\r\n\t\t\tthis._mouseDown = true;\r\n\t\t\tconst boundingRect: ClientRect = this.container.getBoundingClientRect();\r\n\t\t\t//this._mouseX = (event.clientX || event.pageX) - boundingRect.left;\r\n\t\t\tthis._mouseY = ((event.clientY || event.pageY) - boundingRect.top) * this._editorHeight / (boundingRect.bottom - boundingRect.top);\r\n\t\t\tif (isNaN(this._mouseY)) this._mouseY = 0;\r\n\t\t\tthis._updateCursorPitch();\r\n\t\t\t//this._playLiveInput();\r\n\t\t\tthis._updatePreview();\r\n\t\t}*/\r\n\t\t\r\n\t\tprivate _whenMouseMoved = (event: MouseEvent): void => {\r\n\t\t\tconst boundingRect: ClientRect = this.container.getBoundingClientRect();\r\n    \t\tthis._mouseX = (event.clientX || event.pageX) - boundingRect.left;\r\n\t\t    this._mouseY = ((event.clientY || event.pageY) - boundingRect.top) * this._editorHeight / (boundingRect.bottom - boundingRect.top);\r\n\t\t    if (isNaN(this._mouseY)) this._mouseY = 0;\r\n\t\t\tthis._updateCursorPitch();\r\n\t\t\tthis._doc.synth.pianoPitch[0] = this._cursorPitch + this._doc.song.channels[this._doc.channel].octave * 12;\r\n\t\t\tthis._updatePreview();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenMouseReleased = (event: MouseEvent): void => {\r\n\t\t\tthis._mouseDown = false;\r\n\t\t\tthis._doc.synth.pianoPressed = false;\r\n\t\t\tthis._updatePreview();\r\n\t\t}\r\n\t\t\r\n\t\t/*private _whenTouchPressed = (event: TouchEvent): void => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tthis._mouseDown = true;\r\n\t\t\tconst boundingRect: ClientRect = this.container.getBoundingClientRect();\r\n\t\t\tthis._mouseX = event.touches[0].clientX - boundingRect.left;\r\n\t\t\tthis._mouseY = (event.touches[0].clientY - boundingRect.top) * this._editorHeight / (boundingRect.bottom - boundingRect.top);\r\n\t\t    if (isNaN(this._mouseY)) this._mouseY = 0;\r\n\t\t\tthis._updateCursorPitch();\r\n\t\t\tthis._doc.synth.pianoPressed = true;\r\n\t\t\tthis._doc.synth.pianoPitch[0] = this._cursorPitch + this._doc.song.channels[this._doc.channel].octave * 12;\r\n\t\t}*/\r\n\t\t\r\n\t\tprivate _whenTouchMoved = (event: TouchEvent): void => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tconst boundingRect: ClientRect = this.container.getBoundingClientRect();\r\n\t\t\tthis._mouseX = event.touches[0].clientX - boundingRect.left;\r\n\t\t\tthis._mouseY = (event.touches[0].clientY - boundingRect.top) * this._editorHeight / (boundingRect.bottom - boundingRect.top);\r\n\t\t    if (isNaN(this._mouseY)) this._mouseY = 0;\r\n\t\t\tthis._updateCursorPitch();\r\n\t\t\tthis._doc.synth.pianoPitch[0] = this._cursorPitch + this._doc.song.channels[this._doc.channel].octave * 12;\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenTouchReleased = (event: TouchEvent): void => {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tthis._doc.synth.pianoPressed = false;\r\n\t\t}\r\n\t\t\r\n\t\tprivate _updatePreview(): void {\r\n\t\t\tthis._preview.style.visibility = (!this._mouseOver || this._mouseDown) ? \"hidden\" : \"visible\";\r\n\t\t\r\n\t\tif (this._mouseOver && !this._mouseDown) {\r\n\t\t\tconst boundingRect: ClientRect = this.container.getBoundingClientRect();\r\n\t\t\tconst pitchHeight: number = this._pitchHeight / (this._editorHeight / (boundingRect.bottom - boundingRect.top));\r\n\t\t\t\r\n\t\t\tthis._preview.style.left = \"0px\";\r\n\t\t\tthis._preview.style.top = pitchHeight * (this._pitchCount - this._cursorPitch - 1) + \"px\";\r\n\t\t\tthis._preview.style.height = pitchHeight + \"px\";\r\n\t\t}\r\n\t\t\r\n\t\t\tconst octaveOffset: number = this._doc.getBaseVisibleOctave(this._doc.channel) * Config.pitchesPerOctave;\r\n\t\t\tconst container: HTMLDivElement = this._doc.song.getChannelIsDrum(this._doc.channel) ? this._drumContainer : this._pianoContainer;\r\n\t\t\tconst children: HTMLCollection = container.children;\r\n\t\t\tfor (let i: number = 0; i < children.length; i++) {\r\n\t\t\t\tconst child: Element = children[i];\r\n\t\t\t\tif (this._renderedLiveInputPitches.indexOf(i + octaveOffset) == -1) {\r\n\t\t\t\t\tchild.classList.remove(\"pressed\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\tchild.classList.add(\"pressed\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tprivate _documentChanged = (): void => {\r\n\t\t\tconst isDrum: boolean = this._doc.song.getChannelIsDrum(this._doc.channel);\r\n\t\t\tthis._pitchCount = isDrum ? Config.drumCount : this._doc.getVisiblePitchCount();\r\n\t\t\tthis._pitchHeight = this._editorHeight / this._pitchCount;\r\n\t\t\tthis._updateCursorPitch();\r\n\t\t\t//if (this._mouseDown) this._playLiveInput();\r\n\t\t\t\r\n\t\t\tif (!this._doc.prefs.showLetters) return;\r\n\t\t\tif (this._renderedScale == this._doc.song.scale && this._renderedKey == this._doc.song.key && this._renderedDrums == isDrum && this._renderedPitchCount == this._pitchCount) return;\r\n\t\t\t\r\n\t\t\tthis._renderedScale = this._doc.song.scale;\r\n\t\t\tthis._renderedKey = this._doc.song.key;\r\n\t\t\tthis._renderedDrums = isDrum;\r\n\t\t\t\r\n\t\t\tthis._pianoContainer.style.display = isDrum ? \"none\" : \"flex\";\r\n\t\t\tthis._drumContainer.style.display = isDrum ? \"flex\" : \"none\";\r\n\t\t\t\r\n\t\t\tif (!isDrum) {\r\n\t\t\t\tif (this._renderedPitchCount != this._pitchCount) {\r\n\t\t\t\t\tthis._pianoContainer.innerHTML = \"\";\r\n\t\t\t\t\tfor (let i: number = 0; i < this._pitchCount; i++) {\r\n\t\t\t\t\t\tconst pianoLabel: HTMLDivElement = HTML.div({class: \"piano-label\", style: \"font-weight: bold; -webkit-text-stroke-width: 0; font-size: 11px; font-family: sans-serif; position: absolute; padding-left: 15px;\"});\r\n\t\t\t\t\t\tconst pianoKey: HTMLDivElement = HTML.div({class: \"piano-button\", style: \"background: gray;\"}, pianoLabel);\r\n\t\t\t\t\t\tthis._pianoContainer.appendChild(pianoKey);\r\n\t\t\t\t\t\tthis._pianoLabels[i] = pianoLabel;\r\n\t\t\t\t\t\tthis._pianoKeys[i] = pianoKey;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis._pianoLabels.length = this._pitchCount;\r\n\t\t\t\t\tthis._pianoKeys.length = this._pitchCount;\r\n\t\t\t\t\tthis._renderedPitchCount = this._pitchCount;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tfor (let j: number = 0; j < this._pitchCount; j++) {\r\n\t\t\t\t\tconst pitchNameIndex: number = (j + Config.keys[this._doc.song.key].basePitch) % Config.pitchesPerOctave;\r\n\t\t\t\t\tconst isWhiteKey: boolean = Config.keys[pitchNameIndex].isWhiteKey;\r\n\t\t\t\t\tthis._pianoKeys[j].style.background = isWhiteKey ? ColorConfig.whitePianoKey : ColorConfig.blackPianoKey;\r\n\t\t\t\t\tif (!Config.scales[this._doc.song.scale].flags[j % Config.pitchesPerOctave]) {\r\n\t\t\t\t\t\tthis._pianoKeys[j].classList.add(\"disabled\");\r\n\t\t\t\t\t\tthis._pianoLabels[j].style.display = \"none\";\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis._pianoKeys[j].classList.remove(\"disabled\");\r\n\t\t\t\t\t\tthis._pianoLabels[j].style.display = \"\";\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tconst label: HTMLDivElement = this._pianoLabels[j];\r\n\t\t\t\t\t\tlabel.style.color = Config.keys[pitchNameIndex].isWhiteKey ? \"black\" : \"white\";\r\n\t\t\t\t\t\tlabel.textContent = Piano.getPitchName(pitchNameIndex, j);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis._updatePreview();\r\n\t\t}\r\n\t\r\n\t\tpublic static getPitchName(pitchNameIndex: number, scaleIndex: number): string {\r\n\t\t\tlet text: string;\r\n\t\t\t\r\n\t\t\tif (Config.keys[pitchNameIndex].isWhiteKey) {\r\n\t\t\t\ttext = Config.keys[pitchNameIndex].name;\r\n\t\t\t} else {\r\n\t\t\t\tconst shiftDir: number = Config.blackKeyNameParents[scaleIndex % Config.pitchesPerOctave];\r\n\t\t\t\ttext = Config.keys[(pitchNameIndex + Config.pitchesPerOctave + shiftDir) % Config.pitchesPerOctave].name;\r\n\t\t\t\tif (shiftDir == 1) {\r\n\t\t\t\t\ttext += \"♭\";\r\n\t\t\t\t} else if (shiftDir == -1) {\r\n\t\t\t\t\ttext += \"♯\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\treturn text;\r\n\t\t}\r\n\t\t\r\n\t}\r\n\r\n","/*\r\nCopyright (C) 2018 John Nesky\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of \r\nthis software and associated documentation files (the \"Software\"), to deal in \r\nthe Software without restriction, including without limitation the rights to \r\nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \r\nof the Software, and to permit persons to whom the Software is furnished to do \r\nso, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all \r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \r\nSOFTWARE.\r\n*/\r\n\r\nimport { HTML } from \"imperative-html/dist/esm/elements-strict\";\r\nimport { Prompt } from \"./Prompt\";\r\nimport { SongDocument } from \"./SongDocument\";\r\n\tconst {button, div} = HTML;\r\n\r\n\t\texport class MixPrompt implements Prompt {\r\n\t\tprivate readonly _cancelButton: HTMLButtonElement = button({}, [div(\"Close\")]);\r\n\t\tpublic readonly container: HTMLDivElement = div({class: \"prompt\", style: \"width: 300px;\"}, [\r\n\t\t\tdiv({style: \"font-size: 2em\"}, [div(\"Mixing Styles\")]),\r\n\t\t\tdiv({style: \"text-align: left; margin: 0.5em 0;\"}, [\r\n\t\t\t\tdiv(\"Mixing styles are a way how changing how loud or soft different sounds are and can change the way different sounds blend and mix together. Using different mixing styles can drastically change your song.\")]),\r\n\t\t\tdiv({style: \"text-align: left; margin: 0.5em 0;\"}, [\r\n\t\t\t\tdiv(\"Type A Mixing is akin to mixing in vanilla Beepbox, Sandbox, and most other beepbox mods. In this mixing type, the drums are about twice as loud as in Type B mixing and the sound is generally a bit sharper and blends together differently.\")]),\r\n\t\t\tdiv({style: \"text-align: left; margin: 0.5em 0;\"}, [\r\n\t\t\t\tdiv(\"Type B Mixing is regular Modbox mixing.\")]),\r\n\t\t\tdiv({style: \"text-align: left; margin: 0.5em 0;\"}, [\r\n\t\t\t\tdiv(\"Type C Mixing is like Type B, save for a few upgrades. There are more volume options in Type C mixing, certain waves (acoustic bass, lyre, ramp pulse, and piccolo) are a bit quieter, the flatline wave is a bit louder, and blending works slightly differently.\")]),\r\n\t\t\tdiv({style: \"text-align: left; margin: 0.5em 0;\"}, [\r\n\t\t\t\tdiv(\"Type D Mixing includes slightly quieter drums from Type B, but also includes sharper sounds for regular notes in pitch channels.\")]),\r\n\t\t\tthis._cancelButton,\r\n\t\t]);\t\r\n\t\t\tconstructor(private _doc: SongDocument) {\r\n\t\t\t\tthis._cancelButton.addEventListener(\"click\", this._close);\r\n\t\t\t}\r\n\r\n\t\t\tprivate _close = (): void => { \r\n\t\t\t\tthis._doc.undo();\r\n\t\t\t}\r\n\t\t\t\t\r\n\t\t\tpublic cleanUp = (): void => { \r\n\t\t\t\tthis._cancelButton.removeEventListener(\"click\", this._close);\r\n\t\t\t};\r\n\t\t}\r\n\t","/*\r\nCopyright (C) 2018 John Nesky\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of \r\nthis software and associated documentation files (the \"Software\"), to deal in \r\nthe Software without restriction, including without limitation the rights to \r\nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \r\nof the Software, and to permit persons to whom the Software is furnished to do \r\nso, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all \r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \r\nSOFTWARE.\r\n*/\r\n\r\nimport { HTML } from \"imperative-html/dist/esm/elements-strict\";\r\nimport { Prompt } from \"./Prompt\";\r\nimport { SongDocument } from \"./SongDocument\";\r\n\tconst {button, div} = HTML;\r\n\r\n\texport class ChorusPrompt implements Prompt {\r\n\t\tprivate readonly _cancelButton: HTMLButtonElement = button({}, [div(\"Close\")]);\r\n\t\t\r\n\t\tpublic readonly container: HTMLDivElement = div({class: \"prompt\", style: \"width: 250px;\"}, [\r\n\t\t\tdiv({style: \"font-size: 2em\"}, [div(\"Custom Harmony\")]),\r\n\t\t\tdiv({style: \"text-align: left;\"}, [div(\r\n\t\t\t\t'BeepBox \"chip\" instruments play two waves at once, each with their own pitch.')]),\r\n\t\t\tdiv({style: \"text-align: left;\" }, [div('By placing two notes one above another it will play two indivdual sounds. ' +\r\n\t\t\t'This replaces the \"arpeggio/trill\" effect, and gives you greater control over your harmony. ')]),\r\n\t\t\tdiv({ style: \"text-align: left;\" }, [\r\n\t\t\t\tdiv('In older versions of Modbox, union would not allow notes to harmonize properly and needed a special harmonic chorus in order to work. This has been patched in Modbox 3.1.0. '\r\n\t\t\t\t)]),\r\n\t\t\tthis._cancelButton,\r\n\t\t]);\r\n\t\t\r\n\t\tconstructor(private _doc: SongDocument) {\r\n\t\t\tthis._cancelButton.addEventListener(\"click\", this._close);\r\n\t\t}\r\n\t\t\r\n\t\tprivate _close = (): void => { \r\n\t\t\tthis._doc.undo();\r\n\t\t}\r\n\t\t\r\n\t\tpublic cleanUp = (): void => { \r\n\t\t\tthis._cancelButton.removeEventListener(\"click\", this._close);\r\n\t\t}\r\n\t}\r\n\r\n","/*\r\nCopyright (C) 2018 John Nesky\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of \r\nthis software and associated documentation files (the \"Software\"), to deal in \r\nthe Software without restriction, including without limitation the rights to \r\nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \r\nof the Software, and to permit persons to whom the Software is furnished to do \r\nso, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all \r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \r\nSOFTWARE.\r\n*/\r\n\r\nimport { Config, Dictionary, InstrumentType, EnvelopeType } from \"./SynthConfig\";\r\nimport { Instrument, Song, Note, NotePin, Pattern } from \"./song\";\r\n//import { Deque } from \"./Deque\";\r\n\r\n\tdeclare global {\r\n\t\tinterface Window {\r\n\t\t\tAudioContext: any;\r\n\t\t\twebkitAudioContext: any;\r\n\t\t}\r\n\t}\r\n\r\n\tclass SynthChannel {\r\n\t\tpublic sampleLeft: number = 0.0;\r\n\t\tpublic sampleRight: number = 0.0;\r\n\t\tpublic readonly phases: number[] = [];\r\n\t\tpublic readonly phaseDeltas: number[] = [];\r\n\t\tpublic readonly volumeStarts: number[] = [];\r\n\t\tpublic readonly volumeDeltas: number[] = [];\r\n\t\tpublic readonly volumeLeft: number[] = [];\r\n\t\tpublic readonly volumeRight: number[] = [];\r\n\t\tpublic phaseDeltaScale: number = 0.0;\r\n\t\tpublic filter: number = 0.0;\r\n\t\tpublic filterScale: number = 0.0;\r\n\t\tpublic vibratoScale: number = 0.0;\r\n\t\tpublic harmonyMult: number = 0.0;\r\n\t\tpublic harmonyVolumeMult: number = 1.0;\r\n\t\tpublic feedbackOutputs: number[] = [];\r\n\t\tpublic feedbackMult: number = 0.0;\r\n\t\tpublic feedbackDelta: number = 0.0;\r\n\t\t\r\n\t\tconstructor() {\r\n\t\t\tthis.reset();\r\n\t\t}\r\n\t\t\r\n\t\tpublic reset(): void {\r\n\t\t\tfor (let i: number = 0; i < Config.operatorCount; i++) {\r\n\t\t\t\tthis.phases[i] = 0.0;\r\n\t\t\t\tthis.feedbackOutputs[i] = 0.0;\r\n\t\t\t}\r\n\t\t\tthis.sampleLeft = 0.0;\r\n\t\t\tthis.sampleRight = 0.0;\r\n\t\t}\r\n\t}\r\n\t\r\n\texport class Tone {\r\n\t\tpublic instrument: Instrument;\r\n\t\tpublic readonly pitches: number[] = [0, 0, 0, 0];\r\n\t\tpublic pitchCount: number = 0;\r\n\t\tpublic chordSize: number = 0;\r\n\t\tpublic drumsetPitch: number = 0;\r\n\t\tpublic note: Note | null = null;\r\n\t\tpublic prevNote: Note | null = null;\r\n\t\tpublic nextNote: Note | null = null;\r\n\t\tpublic prevNotePitchIndex: number = 0;\r\n\t\tpublic nextNotePitchIndex: number = 0;\r\n\t\tpublic active: boolean = false;\r\n\t\tpublic noteStart: number = 0;\r\n\t\tpublic noteEnd: number = 0;\r\n\t\tpublic noteLengthTicks: number = 0;\r\n\t\tpublic ticksSinceReleased: number = 0;\r\n\t\tpublic liveInputSamplesHeld: number = 0;\r\n\t\tpublic lastInterval: number = 0;\r\n\t\tpublic lastVolume: number = 0;\r\n\t\tpublic stereoVolume1: number = 0.0;\r\n\t\tpublic stereoVolume2: number = 0.0;\r\n\t\tpublic stereoOffset: number = 0.0;\r\n\t\tpublic stereoDelay: number = 0.0;\r\n\t\tpublic sample: number = 0.0;\r\n\t\tpublic readonly phases: number[] = [];\r\n\t\tpublic readonly phaseDeltas: number[] = [];\r\n\t\tpublic readonly volumeStarts: number[] = [];\r\n\t\tpublic readonly volumeDeltas: number[] = [];\r\n\t\tpublic volumeStart: number = 0.0;\r\n\t\tpublic volumeDelta: number = 0.0;\r\n\t\tpublic phaseDeltaScale: number = 0.0;\r\n\t\tpublic pulseWidth: number = 0.0;\r\n\t\tpublic pulseWidthDelta: number = 0.0;\r\n\t\tpublic filter: number = 0.0;\r\n\t\tpublic filterScale: number = 0.0;\r\n\t\tpublic filterSample0: number = 0.0;\r\n\t\tpublic filterSample1: number = 0.0;\r\n\t\tpublic vibratoScale: number = 0.0;\r\n\t\tpublic intervalMult: number = 0.0;\r\n\t\tpublic intervalVolumeMult: number = 1.0;\r\n\t\tpublic feedbackOutputs: number[] = [];\r\n\t\tpublic feedbackMult: number = 0.0;\r\n\t\tpublic feedbackDelta: number = 0.0;\r\n\t\t\r\n\t\tconstructor() {\r\n\t\t\tthis.reset();\r\n\t\t}\r\n\t\t\r\n\t\tpublic reset(): void {\r\n\t\t\tfor (let i: number = 0; i < Config.operatorCount; i++) {\r\n\t\t\t\tthis.phases[i] = 0.0;\r\n\t\t\t\tthis.feedbackOutputs[i] = 0.0;\r\n\t\t\t}\r\n\t\t\tthis.sample = 0.0;\r\n\t\t\tthis.filterSample0 = 0.0;\r\n\t\t\tthis.filterSample1 = 0.0;\r\n\t\t\tthis.liveInputSamplesHeld = 0.0;\r\n\t\t}\r\n\t}\r\n\r\n\texport class Synth {\r\n\t\t\r\n\t\tprivate static warmUpSynthesizer(song: Song | null): void {\r\n\t\t\t// Don't bother to generate the drum waves unless the song actually\r\n\t\t\t// uses them, since they may require a lot of computation.\r\n\t\t\tif (song != null) {\r\n\t\t\t\tfor (let i: number = 0; i < song.instrumentsPerChannel; i++) {\r\n\t\t\t\t\tfor (let j: number = song.pitchChannelCount; j < song.pitchChannelCount + song.drumChannelCount; j++) {\r\n\t\t\t\t\t\tConfig.getDrumWave(song.channels[j].instruments[i].wave);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tfor (let i: number = 0; i < song.barCount; i++) {\r\n\t\t\t\t\tSynth.getGeneratedSynthesizer(song, i);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tprivate static operatorAmplitudeCurve(amplitude: number): number {\r\n\t\t\treturn (Math.pow(16.0, amplitude / 15.0) - 1.0) / 15.0;\r\n\t\t}\r\n\t\t\r\n\t\tprivate static readonly negativePhaseGuard: number = 1000;\r\n\t\t\r\n\t\tpublic samplesPerSecond: number = 44100;\r\n\t\tprivate effectDuration: number = 0.14;\r\n\t\tprivate effectAngle: number = Math.PI * 2.0 / (this.effectDuration * this.samplesPerSecond);\r\n\t\tpublic effectYMult: number = 2.0 * Math.cos(this.effectAngle);\r\n\t\tpublic limitDecay: number = 1.0 / (2.0 * this.samplesPerSecond);\r\n\t\t\r\n\t\tpublic song: Song | null = null;\r\n\t\tpublic pianoPressed: boolean = false;\r\n\t\tpublic pianoPitch: number[] = [0];\r\n\t\tpublic pianoChannel: number = 0;\r\n\t\tpublic enableIntro: boolean = true;\r\n\t\tpublic enableOutro: boolean = false;\r\n\t\tpublic loopCount: number = -1;\r\n\t\tpublic volume: number = 1.0;\r\n\t\t\r\n\t\tpublic liveInputDuration: number = 0;\r\n\t\tpublic liveInputStarted: boolean = false;\r\n\t\tpublic liveInputPitches: number[] = [];\r\n\t\tpublic liveInputChannel: number = 0;\r\n\t\t\r\n\t\tprivate playheadInternal: number = 0.0;\r\n\t\tprivate bar: number = 0;\r\n\t\tprivate beat: number = 0;\r\n\t\tprivate part: number = 0;\r\n\t\tprivate arpeggio: number = 0;\r\n\t\tprivate arpSampleCountdown: number = 0;\r\n\t\tprivate isPlaying: boolean = false;\r\n\t\tprivate liveInputEndTime: number = 0.0;\r\n\t\tprivate browserAutomaticallyClearsAudioBuffer: boolean = true;\r\n\t\t\r\n\t\tprivate readonly channels: SynthChannel[] = [];\r\n\t\tpublic stillGoing: boolean = false;\r\n\t\tpublic effectPhase: number = 0.0;\r\n\t\tpublic limit: number = 0.0;\r\n\t\t\r\n\t\tprivate delayLineLeft: Float32Array = new Float32Array(16384);\r\n\t\tprivate delayLineRight: Float32Array = new Float32Array(16384);\r\n\t\tpublic delayPosLeft: number = 0;\r\n\t\tpublic delayPosRight: number = 0;\r\n\t\tpublic delayFeedback0Left: number = 0.0;\r\n\t\tpublic delayFeedback0Right: number = 0.0;\r\n\t\tpublic delayFeedback1Left: number = 0.0;\r\n\t\tpublic delayFeedback1Right: number = 0.0;\r\n\t\tpublic delayFeedback2Left: number = 0.0;\r\n\t\tpublic delayFeedback2Right: number = 0.0;\r\n\t\tpublic delayFeedback3Left: number = 0.0;\r\n\t\tpublic delayFeedback3Right: number = 0.0;\r\n\t\t\r\n\t\tprivate audioCtx: any | null = null;\r\n\t\tprivate scriptNode: any | null = null;\r\n\t\t\r\n\t\tpublic get playing(): boolean {\r\n\t\t\treturn this.isPlaying;\r\n\t\t}\r\n\t\t\r\n\t\tpublic get playhead(): number {\r\n\t\t\treturn this.playheadInternal;\r\n\t\t}\r\n\t\t\r\n\t\tpublic set playhead(value: number) {\r\n\t\t\tif (this.song != null) {\r\n\t\t\t\tthis.playheadInternal = Math.max(0, Math.min(this.song.barCount, value));\r\n\t\t\t\tlet remainder: number = this.playheadInternal;\r\n\t\t\t\tthis.bar = Math.floor(remainder);\r\n\t\t\t\tremainder = this.song.beatsPerBar * (remainder - this.bar);\r\n\t\t\t\tthis.beat = Math.floor(remainder);\r\n\t\t\t\tremainder = this.song.partsPerBeat * (remainder - this.beat);\r\n\t\t\t\tthis.part = Math.floor(remainder);\r\n\t\t\t\tremainder = 4 * (remainder - this.part);\r\n\t\t\t\tthis.arpeggio = Math.floor(remainder);\r\n\t\t\t\tconst samplesPerTick: number = this.getSamplesPerArpeggio();\r\n\t\t\t\tremainder = samplesPerTick * (remainder - this.arpeggio);\r\n\t\t\t\tthis.arpSampleCountdown = Math.floor(samplesPerTick - remainder);\r\n\t\t\t\tif (this.bar < this.song.loopStart) {\r\n\t\t\t\t\tthis.enableIntro = true;\r\n\t\t\t\t}\r\n\t\t\t\tif (this.bar > this.song.loopStart + this.song.loopLength) {\r\n\t\t\t\t\tthis.enableOutro = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tpublic get totalSamples(): number {\r\n\t\t\tif (this.song == null) return 0;\r\n\t\t\tconst samplesPerBar: number = this.getSamplesPerArpeggio() * 4 * this.song.partsPerBeat * this.song.beatsPerBar;\r\n\t\t\tlet loopMinCount: number = this.loopCount;\r\n\t\t\tif (loopMinCount < 0) loopMinCount = 1;\r\n\t\t\tlet bars: number = this.song.loopLength * loopMinCount;\r\n\t\t\tif (this.enableIntro) bars += this.song.loopStart;\r\n\t\t\tif (this.enableOutro) bars += this.song.barCount - (this.song.loopStart + this.song.loopLength);\r\n\t\t\treturn bars * samplesPerBar;\r\n\t\t}\r\n\t\t\r\n\t\tpublic get totalSeconds(): number {\r\n\t\t\t// @TODO: Revisit\r\n\t\t\treturn Math.round(this.totalSamples / this.samplesPerSecond);\r\n\t\t}\r\n\t\t\r\n\t\tpublic get totalBars(): number {\r\n\t\t\tif (this.song == null) return 0.0;\r\n\t\t\treturn this.song.barCount;\r\n\t\t}\r\n\t\t\r\n\t\tconstructor(song: any = null) {\r\n\t\t\tif (song != null) this.setSong(song);\r\n\t\t}\r\n\t\t\r\n\t\tpublic setSong(song: any): void {\r\n\t\t\tif (typeof(song) == \"string\") {\r\n\t\t\t\tthis.song = new Song(song);\r\n\t\t\t} else if (song instanceof Song) {\r\n\t\t\t\tthis.song = song;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tprivate spsCalc(): number {\r\n\t\t\tSynth.warmUpSynthesizer(this.song);\r\n\t\t\tif (this.song!.sampleRate == 0) return 44100;\r\n\t\t\telse if (this.song!.sampleRate == 1) return 48000;\r\n\t\t\telse if (this.song!.sampleRate == 2) return this.audioCtx.sampleRate;\r\n\t\t\telse if (this.song!.sampleRate == 3) return this.audioCtx.sampleRate * 4;\r\n\t\t\telse if (this.song!.sampleRate == 4) return this.audioCtx.sampleRate * 2;\r\n\t\t\telse if (this.song!.sampleRate == 5) return this.audioCtx.sampleRate / 2;\r\n\t\t\telse if (this.song!.sampleRate == 6) return this.audioCtx.sampleRate / 4;\r\n\t\t\telse if (this.song!.sampleRate == 7) return this.audioCtx.sampleRate / 8;\r\n\t\t\telse if (this.song!.sampleRate == 8) return this.audioCtx.sampleRate / 16;\r\n\t\t\telse return this.audioCtx.sampleRate;\r\n\t\t}\r\n\r\n\t\tprivate activateAudio(): void {\r\n\t\t\tif (this.audioCtx == null || this.scriptNode == null) {\r\n\t\t\t\tif (this.scriptNode != null) this.deactivateAudio();\r\n\t\t\t\tthis.audioCtx = this.audioCtx || new (window.AudioContext || window.webkitAudioContext);\r\n\t\t\t\tthis.samplesPerSecond = this.spsCalc();\r\n\t\t\t\tthis.scriptNode = this.audioCtx.createScriptProcessor ? this.audioCtx.createScriptProcessor(2048, 0, 2) : this.audioCtx.createJavaScriptNode(2048, 0, 2); \r\n\t\t\t\tthis.scriptNode.onaudioprocess = this.audioProcessCallback;\r\n\t\t\t\tthis.scriptNode.channelCountMode = 'explicit';\r\n\t\t\t\tthis.scriptNode.channelInterpretation = 'speakers';\r\n\r\n\t\t\t\tthis.effectAngle = Math.PI * 2.0 / (this.effectDuration * this.samplesPerSecond);\r\n\t\t\t\tthis.effectYMult = 2.0 * Math.cos(this.effectAngle);\r\n\t\t\t\tthis.limitDecay = 1.0 / (2.0 * this.samplesPerSecond);\r\n\t\t\t\t\r\n\t\t\t\tthis.scriptNode.connect(this.audioCtx.destination);\r\n\t\t\t}\r\n\t\t\tthis.audioCtx.resume();\r\n\t\t}\r\n\t\t\r\n\t\tprivate deactivateAudio(): void {\r\n\t\t\tif (this.audioCtx != null && this.scriptNode != null) {\r\n\t\t\t\tthis.scriptNode.disconnect(this.audioCtx.destination);\r\n\t\t\t\tthis.scriptNode = null;\r\n\t\t\t\tif (this.audioCtx.close) this.audioCtx.close(); // firefox is missing this function?\r\n\t\t\t\tthis.audioCtx = null;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t\tpublic maintainLiveInput(): void {\r\n\t\t\t\tthis.activateAudio();\r\n\t\t\t\tthis.liveInputEndTime = performance.now() + 10000.0;\r\n\t\t\t}\r\n\r\n\t\tpublic play(): void {\r\n\t\t\tif (this.isPlaying) return;\r\n\t\t\tthis.isPlaying = true;\r\n\t\t\t\r\n\t\t\tSynth.warmUpSynthesizer(this.song);\r\n\t\t\tthis.activateAudio();\r\n\t\t}\r\n\t\t\r\n\t\tpublic pause(): void {\r\n\t\t\tif (!this.isPlaying) return;\r\n\t\t\tthis.isPlaying = false;\r\n\t\t\tthis.deactivateAudio();\r\n\t\t\tthis.scriptNode = null;\r\n\t\t}\r\n\t\t\r\n\t\t/*private determineLiveInputTones(song: Song): void {\r\n\t\t\tconst toneList: Deque<Tone> = this.liveInputTones;\r\n\t\t\tconst pitches: number[] = this.liveInputPitches;\r\n\t\t\tlet toneCount: number = 0;\r\n\t\t\tif (this.liveInputDuration > 0) {\r\n\t\t\t\tconst instrument: Instrument = song.channels[this.liveInputChannel].instruments[song.getPatternInstrument(this.liveInputChannel, this.bar)];\r\n\t\t\t\t\r\n\t\t\t\tif (instrument.getChord().arpeggiates) {\r\n\t\t\t\t\tlet tone: Tone;\r\n\t\t\t\t\tif (toneList.count() == 0) {\r\n\t\t\t\t\t\ttone = this.newTone();\r\n\t\t\t\t\t\ttoneList.pushBack(tone);\r\n\t\t\t\t\t} else if (!instrument.getTransition().isSeamless && this.liveInputStarted) {\r\n\t\t\t\t\t\tthis.releaseTone(this.liveInputChannel, toneList.popFront());\r\n\t\t\t\t\t\ttone = this.newTone();\r\n\t\t\t\t\t\ttoneList.pushBack(tone);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\ttone = toneList.get(0);\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttoneCount = 1;\r\n\t\t\t\t\r\n\t\t\t\t\tfor (let i: number = 0; i < pitches.length; i++) {\r\n\t\t\t\t\t\ttone.pitches[i] = pitches[i];\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttone.pitchCount = pitches.length;\r\n\t\t\t\t\ttone.chordSize = 1;\r\n\t\t\t\t\ttone.instrument = instrument;\r\n\t\t\t\t\ttone.note = tone.prevNote = tone.nextNote = null;\r\n\t\t\t\t} else {\r\n\t\t\t\t\t//const transition: Transition = instrument.getTransition();\r\n\t\t\t\t\tfor (let i: number = 0; i < pitches.length; i++) {\r\n\t\t\t\t\t\t//const strumOffsetParts: number = i * instrument.getChord().strumParts;\r\n\r\n\t\t\t\t\t\tlet tone: Tone;\r\n\t\t\t\t\t\tif (toneList.count() <= i) {\r\n\t\t\t\t\t\t\ttone = this.newTone();\r\n\t\t\t\t\t\t\ttoneList.pushBack(tone);\r\n\t\t\t\t\t\t} else if (!instrument.getTransition().isSeamless && this.liveInputStarted) {\r\n\t\t\t\t\t\t\tthis.releaseTone(this.liveInputChannel, toneList.get(i));\r\n\t\t\t\t\t\t\ttone = this.newTone();\r\n\t\t\t\t\t\t\ttoneList.set(i, tone);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\ttone = toneList.get(i);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\ttoneCount++;\r\n\r\n\t\t\t\t\t\ttone.pitches[0] = pitches[i];\r\n\t\t\t\t\t\ttone.pitchCount = 1;\r\n\t\t\t\t\t\ttone.chordSize = pitches.length;\r\n\t\t\t\t\t\ttone.instrument = instrument;\r\n\t\t\t\t\t\ttone.note = tone.prevNote = tone.nextNote = null;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\twhile (toneList.count() > toneCount) {\r\n\t\t\t\tthis.releaseTone(this.liveInputChannel, toneList.popBack());\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.liveInputStarted = false;\r\n\t\t}*/\r\n\r\n\t\tpublic snapToStart(): void {\r\n\t\t\tthis.bar = 0;\r\n\t\t\tthis.enableIntro = true;\r\n\t\t\tthis.snapToBar();\r\n\t\t}\r\n\t\t\r\n\t\tpublic snapToBar(bar?: number): void {\r\n\t\t\tif (bar !== undefined) this.bar = bar;\r\n\t\t\tthis.playheadInternal = this.bar;\r\n\t\t\tthis.beat = 0;\r\n\t\t\tthis.part = 0;\r\n\t\t\tthis.arpeggio = 0;\r\n\t\t\tthis.arpSampleCountdown = 0;\r\n\t\t\tthis.effectPhase = 0.0;\r\n\t\t\t\r\n\t\t\tfor (const channel of this.channels) channel.reset();\r\n\t\t\t\r\n\t\t\tthis.delayPosLeft = 0;\r\n\t\t\tthis.delayPosRight = 0;\r\n\t\t\tthis.delayFeedback0Left = 0.0;\r\n\t\t\tthis.delayFeedback0Right = 0.0;\r\n\t\t\tthis.delayFeedback1Left = 0.0;\r\n\t\t\tthis.delayFeedback1Right = 0.0;\r\n\t\t\tthis.delayFeedback2Left = 0.0;\r\n\t\t\tthis.delayFeedback2Right = 0.0;\r\n\t\t\tthis.delayFeedback3Left = 0.0;\r\n\t\t\tthis.delayFeedback3Right = 0.0;\r\n\t\t\tfor (let i: number = 0; i < this.delayLineLeft.length; i++) this.delayLineLeft[i] = 0.0;\r\n\t\t\tfor (let i: number = 0; i < this.delayLineRight.length; i++) this.delayLineRight[i] = 0.0;\r\n\t\t}\r\n\t\t\r\n\t\tpublic nextBar(): void {\r\n\t\t\tif (!this.song) return;\r\n\t\t\tconst oldBar: number = this.bar;\r\n\t\t\tthis.bar++;\r\n\t\t\tif (this.enableOutro) {\r\n\t\t\t\tif (this.bar >= this.song.barCount) {\r\n\t\t\t\t\tthis.bar = this.enableIntro ? 0 : this.song.loopStart;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (this.bar >= this.song.loopStart + this.song.loopLength || this.bar >= this.song.barCount) {\r\n\t\t\t\t\tthis.bar = this.song.loopStart;\r\n\t\t\t\t}\r\n \t\t\t}\r\n\t\t\tthis.playheadInternal += this.bar - oldBar;\r\n\t\t}\r\n\t\t\r\n\t\tpublic prevBar(): void {\r\n\t\t\tif (!this.song) return;\r\n\t\t\tconst oldBar: number = this.bar;\r\n\t\t\tthis.bar--;\r\n\t\t\tif (this.bar < 0) {\r\n\t\t\t\tthis.bar = this.song.loopStart + this.song.loopLength - 1;\r\n\t\t\t}\r\n\t\t\tif (this.bar >= this.song.barCount) {\r\n\t\t\t\tthis.bar = this.song.barCount - 1;\r\n\t\t\t}\r\n\t\t\tif (this.bar < this.song.loopStart) {\r\n\t\t\t\tthis.enableIntro = true;\r\n\t\t\t}\r\n\t\t\tif (!this.enableOutro && this.bar >= this.song.loopStart + this.song.loopLength) {\r\n\t\t\t\tthis.bar = this.song.loopStart + this.song.loopLength - 1;\r\n\t\t\t}\r\n\t\t\tthis.playheadInternal += this.bar - oldBar;\r\n\t\t}\r\n\t\t\r\n\t\tprivate audioProcessCallback = (audioProcessingEvent: any): void => {\r\n\t\t\tconst outputBuffer = audioProcessingEvent.outputBuffer;\r\n\t\t\tconst outputDataL: Float32Array = outputBuffer.getChannelData(0);\r\n\t\t\tconst outputDataR: Float32Array = outputBuffer.getChannelData(1);\r\n\r\n\t\t\tif (this.browserAutomaticallyClearsAudioBuffer && (outputDataL[0] != 0.0 || outputDataR[0] != 0.0 || outputDataL[outputBuffer.length-1] != 0.0 || outputDataR[outputBuffer.length-1] != 0.0)) {\r\n\t\t\t// If the buffer is ever initially nonzero, then this must be an older browser that doesn't automatically clear the audio buffer.\r\n\t\t\tthis.browserAutomaticallyClearsAudioBuffer = false;\r\n\t\t\t}\r\n\t\t\tif (!this.browserAutomaticallyClearsAudioBuffer) {\r\n\t\t\t\t// If this browser does not clear the buffer automatically, do so manually before continuing.\r\n\t\t\t\tconst length: number = outputBuffer.length;\r\n\t\t\t\tfor (let i: number = 0; i < length; i++) {\r\n\t\t\t\t\toutputDataL[i] = 0.0;\r\n\t\t\t\t\toutputDataR[i] = 0.0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (!this.isPlaying && performance.now() >= this.liveInputEndTime) { \r\n\t\t\t\tthis.deactivateAudio();\r\n\t\t\t} else {\r\n\t\t\t\tthis.synthesize(outputDataL, outputDataR, outputBuffer.length, this.isPlaying);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tpublic synthesize(dataLeft: Float32Array, dataRight: Float32Array, bufferLength: number, playSong: boolean = true): void {\r\n\t\t\tif (this.song == null) {\r\n\t\t\t\tfor (let i: number = 0; i < bufferLength; i++) {\r\n\t\t\t\t\tdataLeft[i] = 0.0;\r\n\t\t\t\t\tdataRight[i] = 0.0;\r\n\t\t\t\t}\r\n\t\t\t\tthis.deactivateAudio();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tconst channelCount: number = this.song.getChannelCount();\r\n\t\t\tfor (let i: number = this.channels.length; i < channelCount; i++) {\r\n\t\t\t\tthis.channels[i] = new SynthChannel();\r\n\t\t\t}\r\n\t\t\tthis.channels.length = channelCount;\r\n\t\t\t\r\n\t\t\tconst samplesPerTick: number = this.getSamplesPerArpeggio();\r\n\t\t\tlet bufferIndex: number = 0;\r\n\t\t\tlet ended: boolean = false;\r\n\t\t\t\r\n\t\t\t// Check the bounds of the playhead:\r\n\t\t\tif (this.arpSampleCountdown == 0 || this.arpSampleCountdown > samplesPerTick) {\r\n\t\t\t\tthis.arpSampleCountdown = samplesPerTick;\r\n\t\t\t}\r\n\t\t\tif (playSong) {\r\n\t\t\t\tif (this.part >= this.song.partsPerBeat) {\r\n\t\t\t\t\tthis.beat++;\r\n\t\t\t\t\tthis.part = 0;\r\n\t\t\t\t\tthis.arpeggio = 0;\r\n\t\t\t\t\tthis.arpSampleCountdown = samplesPerTick;\r\n\t\t\t\t}\r\n\t\t\t\tif (this.beat >= this.song.beatsPerBar) {\r\n\t\t\t\t\tthis.bar++;\r\n\t\t\t\t\tthis.beat = 0;\r\n\t\t\t\t\tthis.part = 0;\r\n\t\t\t\t\tthis.arpeggio = 0;\r\n\t\t\t\t\tthis.arpSampleCountdown = samplesPerTick;\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (this.loopCount == -1) {\r\n\t\t\t\t\t\tif (this.bar < this.song.loopStart && !this.enableIntro) this.bar = this.song.loopStart;\r\n\t\t\t\t\t\tif (this.bar >= this.song.loopStart + this.song.loopLength && !this.enableOutro) this.bar = this.song.loopStart;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (this.bar >= this.song.barCount) {\r\n\t\t\t\t\tif (this.enableOutro) {\r\n\t\t\t\t\t\tthis.bar = 0;\r\n\t\t\t\t\t\tthis.enableIntro = true;\r\n\t\t\t\t\t\tended = true;\r\n\t\t\t\t\t\tthis.pause();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.bar = this.song.loopStart;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (this.bar >= this.song.loopStart) {\r\n\t\t\t\t\tthis.enableIntro = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n \t\t\twhile (true) {\r\n\t\t\t\tif (ended) {\r\n\t\t\t\t\twhile (bufferIndex < bufferLength) {\r\n\t\t\t\t\t\tdataLeft[bufferIndex] = 0.0;\r\n\t\t\t\t\t\tdataRight[bufferIndex] = 0.0;\r\n\t\t\t\t\t\tbufferIndex++;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tconst generatedSynthesizer: Function = Synth.getGeneratedSynthesizer(this.song, this.bar);\r\n\t\t\t\tbufferIndex = generatedSynthesizer(this, this.song, dataLeft, dataRight, bufferLength, bufferIndex, samplesPerTick);\r\n\t\t\t\t\r\n\t\t\t\tconst finishedBuffer: boolean = (bufferIndex == -1);\r\n\t\t\t\tif (finishedBuffer) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// bar changed, reset for next bar:\r\n\t\t\t\t\tthis.beat = 0;\r\n\t\t\t\t\tthis.effectPhase = 0.0;\r\n\t\t\t\t\tthis.bar++;\r\n\t\t\t\t\tif (this.bar < this.song.loopStart) {\r\n\t\t\t\t\t\tif (!this.enableIntro) this.bar = this.song.loopStart;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.enableIntro = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (this.bar >= this.song.loopStart + this.song.loopLength) {\r\n\t\t\t\t\t\tif (this.loopCount > 0) this.loopCount--;\r\n\t\t\t\t\t\tif (this.loopCount > 0 || !this.enableOutro) {\r\n\t\t\t\t\t\t\tthis.bar = this.song.loopStart;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (this.bar >= this.song.barCount) {\r\n\t\t\t\t\t\tthis.bar = 0;\r\n\t\t\t\t\t\tthis.enableIntro = true;\r\n\t\t\t\t\t\tended = true;\r\n\t\t\t\t\t\tthis.pause();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis.playheadInternal = (((this.arpeggio + 1.0 - this.arpSampleCountdown / samplesPerTick) / 4.0 + this.part) / this.song.partsPerBeat + this.beat) / this.song.beatsPerBar + this.bar;\r\n\t\t}\r\n\r\n\t\tprivate static computeOperatorEnvelope(envelope: number, time: number, beats: number, customVolume: number): number {\r\n\t\t\tswitch(Config.operatorEnvelopeType[envelope]) {\r\n\t\t\t\tcase EnvelopeType.custom: return customVolume;\r\n\t\t\t\tcase EnvelopeType.steady: return 1.0;\r\n\t\t\t\tcase EnvelopeType.pluck:\r\n\t\t\t\t\tlet curve: number = 1.0 / (1.0 + time * Config.operatorEnvelopeSpeed[envelope]);\r\n\t\t\t\t\tif (Config.operatorEnvelopeInverted[envelope]) {\r\n\t\t\t\t\t\treturn 1.0 - curve;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn curve;\r\n\t\t\t\t\t}\r\n\t\t\t\tcase EnvelopeType.tremolo: \r\n\t\t\t\t\tif (Config.operatorSpecialCustomVolume[envelope]) {\r\n\t\t\t\t\t\treturn 0.5 - Math.cos(beats * 2.0 * Math.PI * (customVolume * 4)) * 0.5;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn 0.5 - Math.cos(beats * 2.0 * Math.PI * Config.operatorEnvelopeSpeed[envelope]) * 0.5;\r\n\t\t\t\t\t}\r\n\t\t\t\tcase EnvelopeType.punch: \r\n\t\t\t\t\treturn Math.max(1.0, 2.0 - time * 10.0);\r\n\t\t\t\tcase EnvelopeType.flare:\r\n\t\t\t\t\tif (Config.operatorSpecialCustomVolume[envelope]) {\r\n\t\t\t\t\t\tconst attack: number = 0.25 / Math.sqrt(customVolume);\r\n\t\t\t\t\t\treturn time < attack ? time / attack : 1.0 / (1.0 + (time - attack) * (customVolume * 16));\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconst speed: number = Config.operatorEnvelopeSpeed[envelope];\r\n\t\t\t\t\t\tconst attack: number = 0.25 / Math.sqrt(speed);\r\n\t\t\t\t\t\treturn time < attack ? time / attack : 1.0 / (1.0 + (time - attack) * speed);\r\n\t\t\t\t\t}\r\n\t\t\t\tcase EnvelopeType.flute:\r\n\t\t\t\t\treturn Math.max(-1.0 - time, -2.0 + time);\r\n\t\t\t\tdefault: throw new Error(\"Unrecognized operator envelope type.\");\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tpublic static computeChannelInstrument(synth: Synth, song: Song, channel: number, time: number, sampleTime: number, samplesPerTick: number, samples: number): void {\r\n\t\t\tconst isDrum: boolean = song.getChannelIsDrum(channel);\r\n\t\t\tconst synthChannel: SynthChannel = synth.channels[channel];\r\n\t\t\tconst pattern: Pattern | null = song.getPattern(channel, synth.bar);\r\n\t\t\tconst instrument: Instrument = song.channels[channel].instruments[pattern == null ? 0 : pattern.instrument];\r\n\t\t\tconst pianoMode = (synth.pianoPressed && channel == synth.pianoChannel);\r\n\t\t\tconst basePitch: number = isDrum ? Config.drumBasePitches[instrument.wave] : Config.keys[song.key].basePitch;\r\n\t\t\tconst intervalScale: number = isDrum ? Config.drumInterval : 1;\r\n\t\t\tconst pitchDamping: number = isDrum ? (Config.drumWaveIsSoft[instrument.wave] ? 24.0 : 60.0) : 48.0;\r\n\t\t\tconst secondsPerPart: number = 4.0 * samplesPerTick / synth.samplesPerSecond;\r\n\t\t\tconst beatsPerPart: number = 1.0 / song.partsPerBeat;\r\n\t\t\t\r\n\t\t\tsynthChannel.phaseDeltaScale = 0.0;\r\n\t\t\tsynthChannel.filter = 1.0;\r\n\t\t\tsynthChannel.filterScale = 1.0;\r\n\t\t\tsynthChannel.vibratoScale = 0.0;\r\n\t\t\tsynthChannel.harmonyMult = 1.0;\r\n\t\t\tsynthChannel.harmonyVolumeMult = 1.0;\r\n\t\t\t\r\n\t\t\tlet partsSinceStart: number = 0.0;\r\n\t\t\tlet arpeggio: number = synth.arpeggio;\r\n\t\t\tlet arpSampleCountdown: number = synth.arpSampleCountdown;\r\n\t\t\t\r\n\t\t\tlet pitches: number[] | null = null;\r\n\t\t\tlet resetPhases: boolean = true;\r\n\t\t\t\r\n\t\t\tlet intervalStart: number = 0.0;\r\n\t\t\tlet intervalEnd: number = 0.0;\r\n\t\t\tlet transitionVolumeStart: number = 1.0;\r\n\t\t\tlet transitionVolumeEnd: number = 1.0;\r\n\t\t\tlet envelopeVolumeStart: number = 0.0;\r\n\t\t\tlet envelopeVolumeEnd: number = 0.0;\r\n\t\t\t// TODO: probably part time can be calculated independently of any notes?\r\n\t\t\tlet partTimeStart: number = 0.0;\r\n\t\t\tlet partTimeEnd:   number = 0.0;\r\n\t\t\tlet decayTimeStart: number = 0.0;\r\n\t\t\tlet decayTimeEnd:   number = 0.0;\r\n\t\t\t\r\n\t\t\tfor (let i: number = 0; i < Config.operatorCount; i++) {\r\n\t\t\t\tsynthChannel.phaseDeltas[i] = 0.0;\r\n\t\t\t\tsynthChannel.volumeStarts[i] = 0.0;\r\n\t\t\t\tsynthChannel.volumeDeltas[i] = 0.0;\r\n\t\t\t\tsynthChannel.volumeLeft[0] = 0.0;\r\n\t\t\t\tsynthChannel.volumeRight[0] = 0.0;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (pianoMode) {\r\n\t\t\t\tpitches = synth.pianoPitch;\r\n\t\t\t\ttransitionVolumeStart = transitionVolumeEnd = 1;\r\n\t\t\t\tenvelopeVolumeStart = envelopeVolumeEnd = 1;\r\n\t\t\t\tresetPhases = false;\r\n\t\t\t\t// TODO: track time since live piano note started for transition, envelope, decays, delayed vibrato, etc.\r\n\t\t\t} else if (pattern != null) {\r\n\t\t\t\tlet note: Note | null = null;\r\n\t\t\t\tlet prevNote: Note | null = null;\r\n\t\t\t\tlet nextNote: Note | null = null;\r\n\t\t\t\tfor (let i: number = 0; i < pattern.notes.length; i++) {\r\n\t\t\t\t\tif (pattern.notes[i].end <= time) {\r\n\t\t\t\t\t\tprevNote = pattern.notes[i];\r\n\t\t\t\t\t} else if (pattern.notes[i].start <= time && pattern.notes[i].end > time) {\r\n\t\t\t\t\t\tnote = pattern.notes[i];\r\n\t\t\t\t\t} else if (pattern.notes[i].start > time) {\r\n\t\t\t\t\t\tnextNote = pattern.notes[i];\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (note != null && prevNote != null && prevNote.end != note.start) prevNote = null;\r\n\t\t\t\tif (note != null && nextNote != null && nextNote.start != note.end) nextNote = null;\r\n\t\t\t\t\r\n\t\t\t\tif (note != null) {\r\n\t\t\t\t\tpitches = note.pitches;\r\n\t\t\t\t\tpartsSinceStart = time - note.start;\r\n\t\t\t\t\t\r\n\t\t\t\t\tlet endPinIndex: number;\r\n\t\t\t\t\tfor (endPinIndex = 1; endPinIndex < note.pins.length - 1; endPinIndex++) {\r\n\t\t\t\t\t\tif (note.pins[endPinIndex].time + note.start > time) break;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconst startPin: NotePin = note.pins[endPinIndex-1];\r\n\t\t\t\t\tconst endPin: NotePin = note.pins[endPinIndex];\r\n\t\t\t\t\tconst noteStart: number = note.start * 4;\r\n\t\t\t\t\tconst noteEnd:   number = note.end   * 4;\r\n\t\t\t\t\tconst pinStart: number  = (note.start + startPin.time) * 4;\r\n\t\t\t\t\tconst pinEnd:   number  = (note.start +   endPin.time) * 4;\r\n\t\t\t\t\t\r\n\t\t\t\t\tconst tickTimeStart: number = time * 4 + arpeggio;\r\n\t\t\t\t\tconst tickTimeEnd:   number = time * 4 + arpeggio + 1;\r\n\t\t\t\t\tconst pinRatioStart: number = (tickTimeStart - pinStart) / (pinEnd - pinStart);\r\n\t\t\t\t\tconst pinRatioEnd:   number = (tickTimeEnd   - pinStart) / (pinEnd - pinStart);\r\n\t\t\t\t\tlet envelopeVolumeTickStart: number = startPin.volume + (endPin.volume - startPin.volume) * pinRatioStart;\r\n\t\t\t\t\tlet envelopeVolumeTickEnd:   number = startPin.volume + (endPin.volume - startPin.volume) * pinRatioEnd;\r\n\t\t\t\t\tlet transitionVolumeTickStart: number = 1.0;\r\n\t\t\t\t\tlet transitionVolumeTickEnd:   number = 1.0;\r\n\t\t\t\t\tlet intervalTickStart: number = startPin.interval + (endPin.interval - startPin.interval) * pinRatioStart;\r\n\t\t\t\t\tlet intervalTickEnd:   number = startPin.interval + (endPin.interval - startPin.interval) * pinRatioEnd;\r\n\t\t\t\t\tlet partTimeTickStart: number = startPin.time + (endPin.time - startPin.time) * pinRatioStart;\r\n\t\t\t\t\tlet partTimeTickEnd:   number = startPin.time + (endPin.time - startPin.time) * pinRatioEnd;\r\n\t\t\t\t\tlet decayTimeTickStart: number = partTimeTickStart;\r\n\t\t\t\t\tlet decayTimeTickEnd:   number = partTimeTickEnd;\r\n\t\t\t\t\t\r\n\t\t\t\t\tconst startRatio: number = 1.0 - (arpSampleCountdown + samples) / samplesPerTick;\r\n\t\t\t\t\tconst endRatio:   number = 1.0 - (arpSampleCountdown)           / samplesPerTick;\r\n\t\t\t\t\tresetPhases = (tickTimeStart + startRatio - noteStart == 0.0);\r\n\t\t\t\t\t\r\n\t\t\t\t\tconst transition: number = instrument.transition;\r\n\t\t\t\t\tif (tickTimeStart == noteStart) {\r\n\t\t\t\t\t\tif (transition == 0) {\r\n\t\t\t\t\t\t\t// seamless start\r\n\t\t\t\t\t\t\tresetPhases = false;\r\n\t\t\t\t\t\t} else if (transition == 2) {\r\n\t\t\t\t\t\t\t// smooth start\r\n\t\t\t\t\t\t\ttransitionVolumeTickStart = 0.0;\r\n\t\t\t\t\t\t} else if (transition == 3) {\r\n\t\t\t\t\t\t\t// slide start\r\n\t\t\t\t\t\t\tif (prevNote == null) {\r\n\t\t\t\t\t\t\t\ttransitionVolumeTickStart = 0.0;\r\n\t\t\t\t\t\t\t} else if (prevNote.pins[prevNote.pins.length-1].volume == 0 || note.pins[0].volume == 0) {\r\n\t\t\t\t\t\t\t\ttransitionVolumeTickStart = 0.0;\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tintervalTickStart = (prevNote.pitches[0] + prevNote.pins[prevNote.pins.length-1].interval - note.pitches[0]) * 0.5;\r\n\t\t\t\t\t\t\t\tdecayTimeTickStart = prevNote.pins[prevNote.pins.length-1].time * 0.5;\r\n\t\t\t\t\t\t\t\tresetPhases = false;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else if (transition == 4) {\r\n\t\t\t\t\t\t\t// trill start\r\n\t\t\t\t\t\t\ttransitionVolumeTickEnd = 0.0;\r\n\t\t\t\t\t\t} else if (transition == 5) {\r\n\t\t\t\t\t\t\t// click start\r\n\t\t\t\t\t\t\tintervalTickStart = 100.0;\r\n\t\t\t\t\t\t} else if (transition == 6) {\r\n\t\t\t\t\t\t\t// bow start\r\n\t\t\t\t\t\t\tintervalTickStart = -1.0;\r\n\t\t\t\t\t\t} else if (transition == 7) {\r\n\t\t\t\t\t\t\t// blip start\r\n\t\t\t\t\t\t\ttransitionVolumeTickStart = 6.0;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (tickTimeEnd == noteEnd) {\r\n\t\t\t\t\t\tif (transition == 0) {\r\n\t\t\t\t\t\t\t// seamless ending: fade out, unless adjacent to another note or at end of bar.\r\n\t\t\t\t\t\t\tif (nextNote == null && note.start + endPin.time != song.partsPerBeat * song.beatsPerBar) {\r\n\t\t\t\t\t\t\t\ttransitionVolumeTickEnd = 0.0;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else if (transition == 1 || transition == 2) {\r\n\t\t\t\t\t\t\t// sudden/smooth ending\r\n\t\t\t\t\t\t\ttransitionVolumeTickEnd = 0.0;\r\n\t\t\t\t\t\t} else if (transition == 3) {\r\n\t\t\t\t\t\t\t// slide ending\r\n\t\t\t\t\t\t\tif (nextNote == null) {\r\n\t\t\t\t\t\t\t\ttransitionVolumeTickEnd = 0.0;\r\n\t\t\t\t\t\t\t} else if (note.pins[note.pins.length-1].volume == 0 || nextNote.pins[0].volume == 0) {\r\n\t\t\t\t\t\t\t\ttransitionVolumeTickEnd = 0.0;\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tintervalTickEnd = (nextNote.pitches[0] - note.pitches[0] + note.pins[note.pins.length-1].interval) * 0.5;\r\n\t\t\t\t\t\t\t\tdecayTimeTickEnd *= 0.5;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tintervalStart = intervalTickStart + (intervalTickEnd - intervalTickStart) * startRatio;\r\n\t\t\t\t\tintervalEnd   = intervalTickStart + (intervalTickEnd - intervalTickStart) * endRatio;\r\n\t\t\t\t\tenvelopeVolumeStart = synth.volumeConversion(envelopeVolumeTickStart + (envelopeVolumeTickEnd - envelopeVolumeTickStart) * startRatio);\r\n\t\t\t\t\tenvelopeVolumeEnd   = synth.volumeConversion(envelopeVolumeTickStart + (envelopeVolumeTickEnd - envelopeVolumeTickStart) * endRatio);\r\n\t\t\t\t\ttransitionVolumeStart = transitionVolumeTickStart + (transitionVolumeTickEnd - transitionVolumeTickStart) * startRatio;\r\n\t\t\t\t\ttransitionVolumeEnd   = transitionVolumeTickStart + (transitionVolumeTickEnd - transitionVolumeTickStart) * endRatio;\r\n\t\t\t\t\tpartTimeStart = note.start + partTimeTickStart + (partTimeTickEnd - partTimeTickStart) * startRatio;\r\n\t\t\t\t\tpartTimeEnd   = note.start + partTimeTickStart + (partTimeTickEnd - partTimeTickStart) * endRatio;\r\n\t\t\t\t\tdecayTimeStart = decayTimeTickStart + (decayTimeTickEnd - decayTimeTickStart) * startRatio;\r\n\t\t\t\t\tdecayTimeEnd   = decayTimeTickStart + (decayTimeTickEnd - decayTimeTickStart) * endRatio;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (pitches != null) {\r\n\t\t\t\tif (!isDrum && instrument.type == InstrumentType.fm) {\r\n\t\t\t\t\t// phase modulation!\r\n\t\t\t\t\t\r\n\t\t\t\t\tlet sineVolumeBoost: number = 1.0;\r\n\t\t\t\t\tlet totalCarrierVolume: number = 0.0;\r\n\t\t\t\t\t\r\n\t\t\t\t\tconst carrierCount: number = Config.operatorCarrierCounts[instrument.algorithm];\r\n\t\t\t\t\tfor (let i: number = 0; i < Config.operatorCount; i++) {\r\n\t\t\t\t\t\tconst isCarrier: boolean = i < Config.operatorCarrierCounts[instrument.algorithm];\r\n\t\t\t\t\t\tconst associatedCarrierIndex: number = Config.operatorAssociatedCarrier[instrument.algorithm][i] - 1;\r\n\t\t\t\t\t\tconst pitch: number = pitches[(i < pitches.length) ? i : ((associatedCarrierIndex < pitches.length) ? associatedCarrierIndex : 0)] + Config.octoffValues[instrument.octoff] + (song.detune / 24);\r\n\t\t\t\t\t\tconst freqMult = Config.operatorFrequencies[instrument.operators[i].frequency];\r\n\t\t\t\t\t\tconst chorusInterval = Config.operatorCarrierChorus[Config.fmChorusNames[instrument.fmChorus]][associatedCarrierIndex];\r\n\t\t\t\t\t\tconst startPitch: number = (pitch + intervalStart) * intervalScale + chorusInterval;\r\n\t\t\t\t\t\tconst startFreq: number = freqMult * (synth.frequencyFromPitch(basePitch + startPitch)) + Config.operatorHzOffsets[instrument.operators[i].frequency];\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tsynthChannel.phaseDeltas[i] = startFreq * sampleTime * Config.sineWaveLength;\r\n\t\t\t\t\t\tif (resetPhases) synthChannel.reset();\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tconst amplitudeCurve: number = Synth.operatorAmplitudeCurve(instrument.operators[i].amplitude);\r\n\t\t\t\t\t\t// const amplitudeMult: number = amplitudeCurve * Config.operatorAmplitudeSigns[instrument.operators[i].frequency];\r\n\t\t\t\t\t\t// @TODO: Revisit\r\n\t\t\t\t\t\tlet amplitudeMult: number = 0;\r\n\t\t\t\t\t\tif ((Config.volumeValues[instrument.volume] != -1.0 && song.mix == 2) || (Config.volumeMValues[instrument.volume] != -1.0 && song.mix != 2)) {\r\n\t\t\t\t\t\t\tif (song.mix == 2) {\r\n\t\t\t\t\t\t\t\tamplitudeMult = isCarrier ? (amplitudeCurve * Config.operatorAmplitudeSigns[instrument.operators[i].frequency]) * (1 - Config.volumeValues[instrument.volume] / 2.3) : (amplitudeCurve * Config.operatorAmplitudeSigns[instrument.operators[i].frequency]);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tamplitudeMult = (amplitudeCurve * Config.operatorAmplitudeSigns[instrument.operators[i].frequency]) * (1 - Config.volumeMValues[instrument.volume] / 2.3);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else if (Config.volumeValues[instrument.volume] != -1.0) {\r\n\t\t\t\t\t\t\tamplitudeMult = 0;\r\n\t\t\t\t\t\t} else if (Config.volumeMValues[instrument.volume] != -1.0) {\r\n\t\t\t\t\t\t\tamplitudeMult = 0;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tlet volumeStart: number = amplitudeMult * Config.imuteValues[instrument.imute];\r\n\t\t\t\t\t\tlet volumeEnd: number = amplitudeMult * Config.imuteValues[instrument.imute];\r\n\t\t\t\t\t\tsynthChannel.volumeLeft[0] = Math.min(1, 1 + Config.ipanValues[instrument.ipan]);\r\n\t\t\t\t\t\tsynthChannel.volumeRight[0] = Math.min(1, 1 - Config.ipanValues[instrument.ipan]);\r\n\t\t\t\t\t\tif (i < carrierCount) {\r\n\t\t\t\t\t\t\t// carrier\r\n\t\t\t\t\t\t\tconst volumeMult: number = 0.03;\r\n\t\t\t\t\t\t\t// The commented out portion in the line below fixes\r\n\t\t\t\t\t\t\t// the crackling heard when using FM chorus. It seems\r\n\t\t\t\t\t\t\t// that it was accidentally omitted in BeepBox 2.3.\r\n\t\t\t\t\t\t\tconst endPitch: number = (pitch + intervalEnd) * intervalScale/* + chorusInterval */;\r\n\t\t\t\t\t\t\tlet pitchVolumeStart: number = 0;\r\n\t\t\t\t\t\t\tlet pitchVolumeEnd: number = 0;\r\n\t\t\t\t\t\t\tif (song.mix == 3) {\r\n\t\t\t\t\t\t\t\tpitchVolumeStart = Math.pow(5.0, -startPitch / pitchDamping);\r\n\t\t\t\t\t\t\t\tpitchVolumeEnd   = Math.pow(5.0,   -endPitch / pitchDamping);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tpitchVolumeStart = Math.pow(2.0, -startPitch / pitchDamping);\r\n\t\t\t\t\t\t\t\tpitchVolumeEnd   = Math.pow(2.0,   -endPitch / pitchDamping);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tvolumeStart *= pitchVolumeStart * volumeMult * transitionVolumeStart;\r\n\t\t\t\t\t\t\tvolumeEnd *= pitchVolumeEnd * volumeMult * transitionVolumeEnd;\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\ttotalCarrierVolume += amplitudeCurve;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// modulator\r\n\t\t\t\t\t\t\tvolumeStart *= Config.sineWaveLength * 1.5;\r\n\t\t\t\t\t\t\tvolumeEnd *= Config.sineWaveLength * 1.5;\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tsineVolumeBoost *= 1.0 - Math.min(1.0, instrument.operators[i].amplitude / 15);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tconst envelope: number = instrument.operators[i].envelope;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tvolumeStart *= Synth.computeOperatorEnvelope(envelope, secondsPerPart * decayTimeStart, beatsPerPart * partTimeStart, envelopeVolumeStart);\r\n\t\t\t\t\t\tvolumeEnd *= Synth.computeOperatorEnvelope(envelope, secondsPerPart * decayTimeEnd, beatsPerPart * partTimeEnd, envelopeVolumeEnd);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tsynthChannel.volumeStarts[i] = volumeStart;\r\n\t\t\t\t\t\tsynthChannel.volumeDeltas[i] = (volumeEnd - volumeStart) / samples;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tconst feedbackAmplitude: number = Config.sineWaveLength * 0.3 * instrument.feedbackAmplitude / 15.0;\r\n\t\t\t\t\tlet feedbackStart: number = feedbackAmplitude * Synth.computeOperatorEnvelope(instrument.feedbackEnvelope, secondsPerPart * decayTimeStart, beatsPerPart * partTimeStart, envelopeVolumeStart);\r\n\t\t\t\t\tlet feedbackEnd: number = feedbackAmplitude * Synth.computeOperatorEnvelope(instrument.feedbackEnvelope, secondsPerPart * decayTimeEnd, beatsPerPart * partTimeEnd, envelopeVolumeEnd);\r\n\t\t\t\t\tsynthChannel.feedbackMult = feedbackStart;\r\n\t\t\t\t\tsynthChannel.feedbackDelta = (feedbackEnd - synthChannel.feedbackMult) / samples;\r\n\t\t\t\t\t\r\n\t\t\t\t\tsineVolumeBoost *= 1.0 - instrument.feedbackAmplitude / 15.0;\r\n\t\t\t\t\t\r\n\t\t\t\t\tsineVolumeBoost *= 1.0 - Math.min(1.0, Math.max(0.0, totalCarrierVolume - 1) / 2.0);\r\n\t\t\t\t\tfor (let i: number = 0; i < carrierCount; i++) {\r\n\t\t\t\t\t\tsynthChannel.volumeStarts[i] *= 1.0 + sineVolumeBoost * 3.0;\r\n\t\t\t\t\t\tsynthChannel.volumeDeltas[i] *= 1.0 + sineVolumeBoost * 3.0;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tlet pitch: number = pitches[0];\r\n\t\t\t\t\t// if (Config.chorusHarmonizes[instrument.chorus]) {\r\n\t\t\t\t\t// \tlet harmonyOffset: number = 0.0;\r\n\t\t\t\t\t// \tif (pitches.length == 2) {\r\n\t\t\t\t\t// \t\tharmonyOffset = pitches[1] - pitches[0];\r\n\t\t\t\t\t// \t} else if (pitches.length == 3) {\r\n\t\t\t\t\t// \t\tharmonyOffset = pitches[(arpeggio >> 1) + 1] - pitches[0];\r\n\t\t\t\t\t// \t} else if (pitches.length == 4) {\r\n\t\t\t\t\t// \t\tharmonyOffset = pitches[(arpeggio == 3 ? 1 : arpeggio) + 1] - pitches[0];\r\n\t\t\t\t\t// \t}\r\n\t\t\t\t\t// \tsynthChannel.harmonyMult = Math.pow(2.0, harmonyOffset / 12.0);\r\n\t\t\t\t\t// \tsynthChannel.harmonyVolumeMult = Math.pow(2.0, -harmonyOffset / pitchDamping)\r\n\t\t\t\t\t// } else {\r\n\t\t\t\t\t// \tif (pitches.length == 2) {\r\n\t\t\t\t\t// \t\tpitch = pitches[arpeggio >> 1];\r\n\t\t\t\t\t// \t} else if (pitches.length == 3) {\r\n\t\t\t\t\t// \t\tpitch = pitches[arpeggio == 3 ? 1 : arpeggio];\r\n\t\t\t\t\t// \t} else if (pitches.length == 4) {\r\n\t\t\t\t\t// \t\tpitch = pitches[arpeggio];\r\n\t\t\t\t\t// \t}\r\n\t\t\t\t\t// }\r\n\t\t\t\t\tif (!isDrum) {\r\n\t\t\t\t\t\tif (Config.harmNames[instrument.harm] == 1) {\r\n\t\t\t\t\t\t\t// duet\r\n\t\t\t\t\t\t\tlet harmonyOffset: number = 0.0;\r\n\t\t\t\t\t\t\tif (pitches.length == 2) {\r\n\t\t\t\t\t\t\t\tharmonyOffset = pitches[1] - pitches[0];\r\n\t\t\t\t\t\t\t} else if (pitches.length == 3) {\r\n\t\t\t\t\t\t\t\tharmonyOffset = pitches[(arpeggio >> 1) + 1] - pitches[0];\r\n\t\t\t\t\t\t\t} else if (pitches.length == 4) {\r\n\t\t\t\t\t\t\t\tharmonyOffset = pitches[(arpeggio == 3 ? 1 : arpeggio) + 1] - pitches[0];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tsynthChannel.harmonyMult = Math.pow(2.0, harmonyOffset / 12.0);\r\n\t\t\t\t\t\t\tsynthChannel.harmonyVolumeMult = Math.pow(2.0, -harmonyOffset / pitchDamping)\r\n\t\t\t\t\t\t} else if (Config.harmNames[instrument.harm] == 2) {\r\n\t\t\t\t\t\t\t// chord\r\n\t\t\t\t\t\t\tlet harmonyOffset: number = 0.0;\r\n\t\t\t\t\t\t\tif (pitches.length == 2) {\r\n\t\t\t\t\t\t\t\tharmonyOffset = pitches[1] - pitches[0];\r\n\t\t\t\t\t\t\t} else if (pitches.length == 3) {\r\n\t\t\t\t\t\t\t\tharmonyOffset = pitches[2] - pitches[0];\r\n\t\t\t\t\t\t\t} else if (pitches.length == 4) {\r\n\t\t\t\t\t\t\t\tharmonyOffset = pitches[(arpeggio == 3 ? 2 : arpeggio) + 1] - pitches[0];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tsynthChannel.harmonyMult = Math.pow(2.0, harmonyOffset / 12.0);\r\n\t\t\t\t\t\t\tsynthChannel.harmonyVolumeMult = Math.pow(2.0, -harmonyOffset / pitchDamping)\r\n\t\t\t\t\t\t} else if (Config.harmNames[instrument.harm] == 3) {\r\n\t\t\t\t\t\t\t// seventh\r\n\t\t\t\t\t\t\tlet harmonyOffset: number = 0.0;\r\n\t\t\t\t\t\t\tif (pitches.length == 2) {\r\n\t\t\t\t\t\t\t\tharmonyOffset = pitches[1] - pitches[0];\r\n\t\t\t\t\t\t\t} else if (pitches.length == 3) {\r\n\t\t\t\t\t\t\t\tharmonyOffset = pitches[2] - pitches[0];\r\n\t\t\t\t\t\t\t} else if (pitches.length == 4) {\r\n\t\t\t\t\t\t\t\tharmonyOffset = pitches[3] - pitches[0];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tsynthChannel.harmonyMult = Math.pow(2.0, harmonyOffset / 12.0);\r\n\t\t\t\t\t\t\tsynthChannel.harmonyVolumeMult = Math.pow(2.0, -harmonyOffset / pitchDamping)\r\n\t\t\t\t\t\t} else if (Config.harmNames[instrument.harm] == 4) {\r\n\t\t\t\t\t\t\t// half arpeggio\r\n\t\t\t\t\t\t\tlet harmonyOffset: number = 0.0;\r\n\t\t\t\t\t\t\tif (pitches.length == 2) {\r\n\t\t\t\t\t\t\t\tharmonyOffset = pitches[1] - pitches[0];\r\n\t\t\t\t\t\t\t} else if (pitches.length == 3) {\r\n\t\t\t\t\t\t\t\tharmonyOffset = pitches[(arpeggio >> 1) + 1] - pitches[0];\r\n\t\t\t\t\t\t\t} else if (pitches.length == 4) {\r\n\t\t\t\t\t\t\t\tharmonyOffset = pitches[(arpeggio >> 1) + 2] - pitches[0];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tsynthChannel.harmonyMult = Math.pow(2.0, harmonyOffset / 12.0);\r\n\t\t\t\t\t\t\tsynthChannel.harmonyVolumeMult = Math.pow(2.0, -harmonyOffset / pitchDamping)\r\n\t\t\t\t\t\t} else if (Config.harmNames[instrument.harm] == 5) {\r\n\t\t\t\t\t\t\t// arp-chord\r\n\t\t\t\t\t\t\tlet harmonyOffset: number = 0.0;\r\n\t\t\t\t\t\t\tif (pitches.length == 2) {\r\n\t\t\t\t\t\t\t\tharmonyOffset = pitches[1] - pitches[0];\r\n\t\t\t\t\t\t\t} else if (pitches.length == 3) {\r\n\t\t\t\t\t\t\t\tharmonyOffset = pitches[2] - pitches[0];\r\n\t\t\t\t\t\t\t} else if (pitches.length == 4) {\r\n\t\t\t\t\t\t\t\tharmonyOffset = pitches[(arpeggio == 3 ? 2 : arpeggio)] - pitches[0];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tsynthChannel.harmonyMult = Math.pow(2.0, harmonyOffset / 12.0);\r\n\t\t\t\t\t\t\tsynthChannel.harmonyVolumeMult = Math.pow(2.0, -harmonyOffset / pitchDamping)\r\n\t\t\t\t\t\t} else if (Config.harmNames[instrument.harm] == 0) {\r\n\t\t\t\t\t\t\t// arpeggio\r\n\t\t\t\t\t\t\tif (pitches.length == 2) {\r\n\t\t\t\t\t\t\t\tpitch = pitches[arpeggio >> 1];\r\n\t\t\t\t\t\t\t} else if (pitches.length == 3) {\r\n\t\t\t\t\t\t\t\tpitch = pitches[arpeggio == 3 ? 1 : arpeggio];\r\n\t\t\t\t\t\t\t} else if (pitches.length == 4) {\r\n\t\t\t\t\t\t\t\tpitch = pitches[arpeggio];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (Config.harmNames[instrument.harm] == 0) {\r\n\t\t\t\t\t\t\t// arpeggio\r\n\t\t\t\t\t\t\tif (pitches.length == 1) {\r\n\t\t\t\t\t\t\t\tpitch = pitches[0] + Config.octoffValues[instrument.octoff];\r\n\t\t\t\t\t\t\t} else if (pitches.length == 2) {\r\n\t\t\t\t\t\t\t\tpitch = pitches[arpeggio >> 1] + Config.octoffValues[instrument.octoff];\r\n\t\t\t\t\t\t\t} else if (pitches.length == 3) {\r\n\t\t\t\t\t\t\t\tpitch = pitches[arpeggio == 3 ? 1 : arpeggio] + Config.octoffValues[instrument.octoff];\r\n\t\t\t\t\t\t\t} else if (pitches.length == 4) {\r\n\t\t\t\t\t\t\t\tpitch = pitches[arpeggio] + Config.octoffValues[instrument.octoff];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else if (Config.harmNames[instrument.harm] == 1) {\r\n\t\t\t\t\t\t\t// duet\r\n\t\t\t\t\t\t\tif (pitches.length == 1) {\r\n\t\t\t\t\t\t\t\tpitch = pitches[0] + Config.octoffValues[instrument.octoff];\r\n\t\t\t\t\t\t\t} else if (pitches.length == 2) {\r\n\t\t\t\t\t\t\t\tpitch = (pitches[1] + pitches[0]) / 2 + Config.octoffValues[instrument.octoff];\r\n\t\t\t\t\t\t\t} else if (pitches.length == 3) {\r\n\t\t\t\t\t\t\t\tpitch = (pitches[(arpeggio >> 1) + 1] + pitches[0]) / 2 + Config.octoffValues[instrument.octoff];\r\n\t\t\t\t\t\t\t} else if (pitches.length == 4) {\r\n\t\t\t\t\t\t\t\tpitch = (pitches[(arpeggio == 3 ? 1 : arpeggio) + 1] + pitches[0]) / 2 + Config.octoffValues[instrument.octoff];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else if (Config.harmNames[instrument.harm] == 2) {\r\n\t\t\t\t\t\t\t// chord\r\n\t\t\t\t\t\t\tif (pitches.length == 1) {\r\n\t\t\t\t\t\t\t\tpitch = pitches[0] + Config.octoffValues[instrument.octoff];\r\n\t\t\t\t\t\t\t} else if (pitches.length == 2) {\r\n\t\t\t\t\t\t\t\tpitch = (pitches[1] + pitches[0]) / 2 + Config.octoffValues[instrument.octoff];\r\n\t\t\t\t\t\t\t} else if (pitches.length == 3) {\r\n\t\t\t\t\t\t\t\tpitch = (pitches[2] + pitches[0]) / 2 + Config.octoffValues[instrument.octoff];\r\n\t\t\t\t\t\t\t} else if (pitches.length == 4) {\r\n\t\t\t\t\t\t\t\tpitch = (pitches[(arpeggio == 3 ? 2 : arpeggio) + 1] + pitches[0]) / 2 + Config.octoffValues[instrument.octoff];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else if (Config.harmNames[instrument.harm] == 3) {\r\n\t\t\t\t\t\t\t// seventh\r\n\t\t\t\t\t\t\tif (pitches.length == 1) {\r\n\t\t\t\t\t\t\t\tpitch = pitches[0] + Config.octoffValues[instrument.octoff];\r\n\t\t\t\t\t\t\t} else if (pitches.length == 2) {\r\n\t\t\t\t\t\t\t\tpitch = (pitches[1] + pitches[0]) / 2 + Config.octoffValues[instrument.octoff];\r\n\t\t\t\t\t\t\t} else if (pitches.length == 3) {\r\n\t\t\t\t\t\t\t\tpitch = (pitches[2] + pitches[0]) / 2 + Config.octoffValues[instrument.octoff];\r\n\t\t\t\t\t\t\t} else if (pitches.length == 4) {\r\n\t\t\t\t\t\t\t\tpitch = (pitches[3] + pitches[0]) / 2 + Config.octoffValues[instrument.octoff];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else if (Config.harmNames[instrument.harm] == 4) {\r\n\t\t\t\t\t\t\t// half arpeggio\r\n\t\t\t\t\t\t\tif (pitches.length == 1) {\r\n\t\t\t\t\t\t\t\tpitch = pitches[0] + Config.octoffValues[instrument.octoff];\r\n\t\t\t\t\t\t\t} else if (pitches.length == 2) {\r\n\t\t\t\t\t\t\t\tpitch = (pitches[1] + pitches[0]) / 2 + Config.octoffValues[instrument.octoff];\r\n\t\t\t\t\t\t\t} else if (pitches.length == 3) {\r\n\t\t\t\t\t\t\t\tpitch = (pitches[(arpeggio >> 1) + 1] + pitches[0]) / 2 + Config.octoffValues[instrument.octoff];\r\n\t\t\t\t\t\t\t} else if (pitches.length == 4) {\r\n\t\t\t\t\t\t\t\tpitch = pitches[(arpeggio >> 1) + 2] + pitches[0] + Config.octoffValues[instrument.octoff];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tconst startPitch: number = (pitch + intervalStart) * intervalScale;\r\n\t\t\t\t\tconst endPitch: number = (pitch + intervalEnd) * intervalScale;\r\n\t\t\t\t\tconst startFreq: number = synth.frequencyFromPitch(basePitch + startPitch);\r\n\t\t\t\t\tconst pitchVolumeStart: number = Math.pow(2.0, -startPitch / pitchDamping);\r\n\t\t\t\t\tconst pitchVolumeEnd: number   = Math.pow(2.0,   -endPitch / pitchDamping);\r\n\t\t\t\t\tif (isDrum && Config.drumWaveIsSoft[instrument.wave]) {\r\n\t\t\t\t\t\tsynthChannel.filter = Math.min(1.0, startFreq * sampleTime * Config.drumPitchFilterMult[instrument.wave]);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet settingsVolumeMult: number;\r\n\t\t\t\t\tif (!isDrum) {\r\n\t\t\t\t\t\tconst filterScaleRate: number = Config.filterDecays[instrument.filter];\r\n\t\t\t\t\t\tsynthChannel.filter = Math.pow(2, -filterScaleRate * secondsPerPart * decayTimeStart);\r\n\t\t\t\t\t\tconst endFilter: number = Math.pow(2, -filterScaleRate * secondsPerPart * decayTimeEnd);\r\n\t\t\t\t\t\tsynthChannel.filterScale = Math.pow(endFilter / synthChannel.filter, 1.0 / samples);\r\n\t\t\t\t\t\tsettingsVolumeMult = 0.27 * 0.5 * Config.waveVolumes[instrument.wave] * Config.filterVolumes[instrument.filter] * Config.chorusVolumes[instrument.chorus];\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (song.mix == 0) {\r\n\t\t\t\t\t\t\tsettingsVolumeMult = 0.19 * Config.drumVolumes[instrument.wave];\r\n\t\t\t\t\t\t} else if (song.mix == 3) {\r\n\t\t\t\t\t\t\tsettingsVolumeMult = 0.12 * Config.drumVolumes[instrument.wave];\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tsettingsVolumeMult = 0.09 * Config.drumVolumes[instrument.wave];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (resetPhases && !isDrum) {\r\n\t\t\t\t\t\tsynthChannel.reset();\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tsynthChannel.phaseDeltas[0] = startFreq * sampleTime;\r\n\t\t\t\t\t\r\n\t\t\t\t\tlet instrumentVolumeMult: number = 0;\r\n\t\t\t\t\tif (song.mix == 2) {\r\n\t\t\t\t\t\tinstrumentVolumeMult = (instrument.volume == 9) ? 0.0 : Math.pow(3, -Config.volumeValues[instrument.volume]) * Config.imuteValues[instrument.imute];\r\n\t\t\t\t\t} else if (song.mix == 1) {\r\n\t\t\t\t\t\tinstrumentVolumeMult = (instrument.volume >= 5) ? 0.0 : Math.pow(3, -Config.volumeMValues[instrument.volume]) * Config.imuteValues[instrument.imute];\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tinstrumentVolumeMult = (instrument.volume >= 5) ? 0.0 : Math.pow(2, -Config.volumeMValues[instrument.volume]) * Config.imuteValues[instrument.imute];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tsynthChannel.volumeStarts[0] = transitionVolumeStart * envelopeVolumeStart * pitchVolumeStart * settingsVolumeMult * instrumentVolumeMult;\r\n\t\t\t\t\tconst volumeEnd: number = transitionVolumeEnd * envelopeVolumeEnd * pitchVolumeEnd * settingsVolumeMult * instrumentVolumeMult;\r\n\t\t\t\t\tsynthChannel.volumeDeltas[0] = (volumeEnd - synthChannel.volumeStarts[0]) / samples;\r\n\t\t\t\t\tsynthChannel.volumeLeft[0] = Math.min(1, 1 + Config.ipanValues[instrument.ipan]);\r\n\t\t\t\t\tsynthChannel.volumeRight[0] = Math.min(1, 1 - Config.ipanValues[instrument.ipan]);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tsynthChannel.phaseDeltaScale = Math.pow(2.0, ((intervalEnd - intervalStart) * intervalScale / 12.0) / samples);\r\n\t\t\t\tsynthChannel.vibratoScale = (partsSinceStart < Config.effectVibratoDelays[instrument.effect]) ? 0.0 : Math.pow(2.0, Config.effectVibratos[instrument.effect] / 12.0) - 1.0;\r\n\t\t\t} else {\r\n\t\t\t\t// @TODO: ModBox doesn't have this guard around .reset, why?\r\n\t\t\t\t// if (!isDrum) {\r\n\t\t\t\t\tsynthChannel.reset();\r\n\t\t\t\t// }\r\n\t\t\t\tfor (let i: number = 0; i < Config.operatorCount; i++) {\r\n\t\t\t\t\tsynthChannel.phaseDeltas[0] = 0.0;\r\n\t\t\t\t\tsynthChannel.volumeStarts[0] = 0.0;\r\n\t\t\t\t\tsynthChannel.volumeDeltas[0] = 0.0;\r\n\t\t\t\t\tsynthChannel.volumeLeft[0] = 0.0;\r\n\t\t\t\t\tsynthChannel.volumeRight[0] = 0.0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tprivate static readonly generatedSynthesizers: Dictionary<Function> = {};\r\n\t\t\r\n\t\tprivate static getGeneratedSynthesizer(song: Song, bar: number): Function {\r\n\t\t\tconst fingerprint: string = song.getChannelFingerprint(bar);\r\n\t\t\tif (Synth.generatedSynthesizers[fingerprint] == undefined) {\r\n\t\t\t\tconst synthSource: string[] = [];\r\n\t\t\t\tconst instruments: Instrument[] = [];\r\n\t\t\t\tfor (let channel = 0; channel < song.pitchChannelCount; channel++) {\r\n\t\t\t\t\tinstruments[channel] = song.channels[channel].instruments[song.getPatternInstrument(channel, bar)];\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tfor (const line of Synth.synthSourceTemplate) {\r\n\t\t\t\t\tif (line.indexOf(\"#\") != -1) {\r\n\t\t\t\t\t\tif (line.indexOf(\"// PITCH\") != -1) {\r\n\t\t\t\t\t\t\tfor (let channel = 0; channel < song.pitchChannelCount; channel++) {\r\n\t\t\t\t\t\t\t\tsynthSource.push(line.replace(/#/g, channel + \"\"));\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else if (line.indexOf(\"// JCHIP\") != -1) {\r\n\t\t\t\t\t\t\tfor (let channel = 0; channel < song.pitchChannelCount; channel++) {\r\n\t\t\t\t\t\t\t\tif (instruments[channel].type == InstrumentType.chip) {\r\n\t\t\t\t\t\t\t\t\tsynthSource.push(line.replace(/#/g, channel + \"\"));\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else if (line.indexOf(\"// CHIP\") != -1) {\r\n\t\t\t\t\t\t\tfor (let channel = 0; channel < song.pitchChannelCount; channel++) {\r\n\t\t\t\t\t\t\t\tif (instruments[channel].type == InstrumentType.chip) {\r\n\t\t\t\t\t\t\t\t\tsynthSource.push(line.replace(/#/g, channel + \"\"));\r\n\t\t\t\t\t\t\t\t} else if (instruments[channel].type == InstrumentType.pwm) {\r\n\t\t\t\t\t\t\t\t\tsynthSource.push(line.replace(/#/g, channel + \"\"));\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else if (line.indexOf(\"// FM\") != -1) {\r\n\t\t\t\t\t\t\tfor (let channel = 0; channel < song.pitchChannelCount; channel++) {\r\n\t\t\t\t\t\t\t\tif (instruments[channel].type == InstrumentType.fm) {\r\n\t\t\t\t\t\t\t\t\tif (line.indexOf(\"$\") != -1) {\r\n\t\t\t\t\t\t\t\t\t\tfor (let j = 0; j < Config.operatorCount; j++) {\r\n\t\t\t\t\t\t\t\t\t\t\tsynthSource.push(line.replace(/#/g, channel + \"\").replace(/\\$/g, j + \"\"));\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\tsynthSource.push(line.replace(/#/g, channel + \"\"));\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else if (line.indexOf(\"// PWM\") != -1) {\r\n\t\t\t\t\t\t\tfor (let channel = 0; channel < song.pitchChannelCount; channel++) {\r\n\t\t\t\t\t\t\t\tif (instruments[channel].type == InstrumentType.pwm) {\r\n\t\t\t\t\t\t\t\t\tsynthSource.push(line.replace(/#/g, channel + \"\"));\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else if (line.indexOf(\"// CARRIER OUTPUTS\") != -1) {\r\n\t\t\t\t\t\t\tfor (let channel = 0; channel < song.pitchChannelCount; channel++) {\r\n\t\t\t\t\t\t\t\tif (instruments[channel].type == InstrumentType.fm) {\r\n\t\t\t\t\t\t\t\t\tconst outputs: string[] = [];\r\n\t\t\t\t\t\t\t\t\tfor (let j = 0; j < Config.operatorCarrierCounts[instruments[channel].algorithm]; j++) {\r\n\t\t\t\t\t\t\t\t\t\toutputs.push(\"channel\" + channel + \"Operator\" + j + \"Scaled\");\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\tsynthSource.push(line.replace(/#/g, channel + \"\").replace(\"/*channel\" + channel + \"Operator$Scaled*/\", outputs.join(\" + \")));\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else if (line.indexOf(\"// NOISE\") != -1) {\r\n\t\t\t\t\t\t\tfor (let channel = song.pitchChannelCount; channel < song.pitchChannelCount + song.drumChannelCount; channel++) {\r\n\t\t\t\t\t\t\t\tsynthSource.push(line.replace(/#/g, channel + \"\"));\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else if (line.indexOf(\"// ALL\") != -1) {\r\n\t\t\t\t\t\t\tfor (let channel = 0; channel < song.pitchChannelCount + song.drumChannelCount; channel++) {\r\n\t\t\t\t\t\t\t\tsynthSource.push(line.replace(/#/g, channel + \"\"));\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthrow new Error(\"Missing channel type annotation for line: \" + line);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if (line.indexOf(\"// INSERT OPERATOR COMPUTATION HERE\") != -1) {\r\n\t\t\t\t\t\tfor (let j = Config.operatorCount - 1; j >= 0; j--) {\r\n\t\t\t\t\t\t\tfor (const operatorLine of Synth.operatorSourceTemplate) {\r\n\t\t\t\t\t\t\t\tfor (let channel = 0; channel < song.pitchChannelCount; channel++) {\r\n\t\t\t\t\t\t\t\t\tif (instruments[channel].type == InstrumentType.fm) {\r\n\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\tif (operatorLine.indexOf(\"/* + channel#Operator@Scaled*/\") != -1) {\r\n\t\t\t\t\t\t\t\t\t\t\tlet modulators = \"\";\r\n\t\t\t\t\t\t\t\t\t\t\tfor (const modulatorNumber of Config.operatorModulatedBy[instruments[channel].algorithm][j]) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tmodulators += \" + channel\" + channel + \"Operator\" + (modulatorNumber - 1) + \"Scaled\";\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\t\t\tconst feedbackIndices: ReadonlyArray<number> = Config.operatorFeedbackIndices[instruments[channel].feedbackType][j];\r\n\t\t\t\t\t\t\t\t\t\t\tif (feedbackIndices.length > 0) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tmodulators += \" + channel\" + channel + \"FeedbackMult * (\";\r\n\t\t\t\t\t\t\t\t\t\t\t\tconst feedbacks: string[] = [];\r\n\t\t\t\t\t\t\t\t\t\t\t\tfor (const modulatorNumber of feedbackIndices) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tfeedbacks.push(\"channel\" + channel + \"Operator\" + (modulatorNumber - 1) + \"Output\");\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\tmodulators += feedbacks.join(\" + \") + \")\";\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\tsynthSource.push(operatorLine.replace(/#/g, channel + \"\").replace(/\\$/g, j + \"\").replace(\"/* + channel\" + channel + \"Operator@Scaled*/\", modulators));\r\n\t\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\t\tsynthSource.push(operatorLine.replace(/#/g, channel + \"\").replace(/\\$/g, j + \"\"));\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tsynthSource.push(line);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t//console.log(synthSource.join(\"\\n\"));\r\n\t\t\t\t\r\n\t\t\t\tSynth.generatedSynthesizers[fingerprint] = new Function(\"synth\", \"song\", \"dataLeft\", \"dataRight\", \"bufferLength\", \"bufferIndex\", \"samplesPerTick\", synthSource.join(\"\\n\"));\r\n\t\t\t}\r\n\t\t\treturn Synth.generatedSynthesizers[fingerprint];\r\n\t\t}\r\n\r\n\t\tprivate static synthSourceTemplate: string[] = (`\r\n\t\t\tvar sampleTime = 1.0 / synth.samplesPerSecond;\r\n\t\t\tvar effectYMult = +synth.effectYMult;\r\n\t\t\tvar limitDecay = +synth.limitDecay;\r\n\t\t\tvar volume = +synth.volume;\r\n\t\t\tvar delayLineLeft = synth.delayLineLeft;\r\n\t\t\tvar delayLineRight = synth.delayLineRight;\r\n\t\t\tvar reverb = Math.pow(song.reverb / beepbox.Config.reverbRange, 0.667) * 0.425;\r\n\t\t\tvar blend = Math.pow(song.blend / beepbox.Config.blendRange, 0.667) * 0.425;\r\n\t\t\tvar mix = song.mix;\r\n\t\t\tvar muff = Math.pow(song.muff / beepbox.Config.muffRange, 0.667) * 0.425;\r\n\t\t\tvar detune = song.detune;\r\n\t\t\tvar riff = Math.pow(song.riff / beepbox.Config.riffRange, 0.667) * 0.425; \r\n\t\t\tvar sineWave = beepbox.Config.sineWave;\r\n\t\t\t\r\n\t\t\t// Initialize instruments based on current pattern.\r\n\t\t\tvar instrumentChannel# = song.getPatternInstrument(#, synth.bar); // ALL\r\n\t\t\tvar instrument# = song.channels[#].instruments[instrumentChannel#]; // ALL\r\n\t\t\tvar channel#Wave = (mix <= 1) ? beepbox.Config.waves[instrument#.wave] : beepbox.Config.wavesMixC[instrument#.wave]; // CHIP\r\n\t\t\tvar channel#Wave = beepbox.Config.getDrumWave(instrument#.wave); // NOISE\r\n\t\t\tvar channel#WaveLength = channel#Wave.length; // CHIP\r\n\t\t\tvar channel#Wave = beepbox.Config.pwmwaves[instrument#.wave]; // PWM\r\n\t\t\tvar channel#WaveLength = channel#Wave.length; // PWM\r\n\t\t\tvar channel#FilterBase = (song.mix == 2) ? Math.pow(2 - (blend * 2) + (muff * 2), -beepbox.Config.filterBases[instrument#.filter]) : Math.pow(2, -beepbox.Config.filterBases[instrument#.filter] + (blend * 4) - (muff * 4)); // CHIP\r\n\t\t\tvar channel#TremoloScale = beepbox.Config.effectTremolos[instrument#.effect]; // PITCH\r\n\t\t\t\r\n\t\t\twhile (bufferIndex < bufferLength) {\r\n\t\t\t\t\r\n\t\t\t\tvar samples;\r\n\t\t\t\tvar samplesLeftInBuffer = bufferLength - bufferIndex;\r\n\t\t\t\tif (synth.arpSampleCountdown <= samplesLeftInBuffer) {\r\n\t\t\t\t\tsamples = synth.arpSampleCountdown;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tsamples = samplesLeftInBuffer;\r\n\t\t\t\t}\r\n\t\t\t\tsynth.arpSampleCountdown -= samples;\r\n\t\t\t\t\r\n\t\t\t\tvar time = synth.part + synth.beat * song.partsPerBeat;\r\n\t\t\t\t\r\n\t\t\t\tbeepbox.Synth.computeChannelInstrument(synth, song, #, time, sampleTime, samplesPerTick, samples); // ALL\r\n\t\t\t\tvar synthChannel# = synth.channels[#]; // ALL\r\n\t\t\t\t\r\n\t\t\t\tvar channel#ChorusA = Math.pow(2.0, (beepbox.Config.chorusOffsets[instrument#.chorus] + beepbox.Config.chorusIntervals[instrument#.chorus] + beepbox.Config.octoffValues[instrument#.octoff] + (detune / 24) * ((riff * beepbox.Config.chorusRiffApp[instrument#.chorus]) + 1)) / 12.0); // CHIP\r\n\t\t\t\tvar channel#ChorusB = Math.pow(2.0, (beepbox.Config.chorusOffsets[instrument#.chorus] - beepbox.Config.chorusIntervals[instrument#.chorus] + beepbox.Config.octoffValues[instrument#.octoff] + (detune / 24) * ((riff * beepbox.Config.chorusRiffApp[instrument#.chorus]) + 1)) / 12.0); // CHIP\r\n\t\t\t\tvar channel#ChorusSign = synthChannel#.harmonyVolumeMult * (beepbox.Config.chorusSigns[instrument#.chorus]); // CHIP\r\n\t\t\t\tchannel#ChorusB *= synthChannel#.harmonyMult; // CHIP\r\n\t\t\t\tvar channel#ChorusDeltaRatio = channel#ChorusB / channel#ChorusA * ((riff * beepbox.Config.chorusRiffApp[instrument#.chorus]) + 1); // CHIP\r\n\t\t\t\t\r\n\t\t\t\tvar channel#PhaseDelta = synthChannel#.phaseDeltas[0] * channel#ChorusA * ((riff * beepbox.Config.chorusRiffApp[instrument#.chorus]) + 1); // CHIP\r\n\t\t\t\tvar channel#PhaseDelta = synthChannel#.phaseDeltas[0] / 32768.0; // NOISE\r\n\t\t\t\tvar channel#PhaseDeltaScale = synthChannel#.phaseDeltaScale; // ALL\r\n\t\t\t\tvar channel#Volume = synthChannel#.volumeStarts[0]; // CHIP\r\n\t\t\t\tvar channel#Volume = synthChannel#.volumeStarts[0]; // NOISE\r\n\t\t\t\tvar channel#VolumeLeft = synthChannel#.volumeLeft[0]; // ALL\r\n\t\t\t\tvar channel#VolumeRight = synthChannel#.volumeRight[0]; // ALL\r\n\t\t\t\tvar channel#VolumeDelta = synthChannel#.volumeDeltas[0]; // CHIP\r\n\t\t\t\tvar channel#VolumeDelta = synthChannel#.volumeDeltas[0]; // NOISE\r\n\t\t\t\tvar channel#Filter = synthChannel#.filter * channel#FilterBase; // CHIP\r\n\t\t\t\tvar channel#Filter = synthChannel#.filter; // NOISE\r\n\t\t\t\tvar channel#FilterScale = synthChannel#.filterScale; // CHIP\r\n\t\t\t\tvar channel#VibratoScale = synthChannel#.vibratoScale; // PITCH\r\n\t\t\t\t\r\n\t\t\t\tvar effectY     = Math.sin(synth.effectPhase);\r\n\t\t\t\tvar prevEffectY = Math.sin(synth.effectPhase - synth.effectAngle);\r\n\t\t\t\t\r\n\t\t\t\tvar channel#PhaseA = synth.channels[#].phases[0] % 1; // CHIP\r\n\t\t\t\tvar channel#PhaseB = synth.channels[#].phases[1] % 1; // CHIP\r\n\t\t\t\tvar channel#Phase  = synth.channels[#].phases[0] % 1; // NOISE\r\n\t\t\t\t\r\n\t\t\t\tvar channel#Operator$Phase       = ((synth.channels[#].phases[$] % 1) + ` + Synth.negativePhaseGuard + `) * ` + Config.sineWaveLength + `; // FM\r\n\t\t\t\tvar channel#Operator$PhaseDelta  = synthChannel#.phaseDeltas[$]; // FM\r\n\t\t\t\tvar channel#Operator$OutputMult  = synthChannel#.volumeStarts[$]; // FM\r\n\t\t\t\tvar channel#Operator$OutputDelta = synthChannel#.volumeDeltas[$]; // FM\r\n\t\t\t\tvar channel#Operator$Output      = synthChannel#.feedbackOutputs[$]; // FM\r\n\t\t\t\tvar channel#FeedbackMult         = synthChannel#.feedbackMult; // FM\r\n\t\t\t\tvar channel#FeedbackDelta        = synthChannel#.feedbackDelta; // FM\r\n\t\t\t\t\r\n\t\t\t\tvar channel#SampleLeft = +synth.channels[#].sampleLeft; // ALL\r\n\t\t\t\tvar channel#SampleRight = +synth.channels[#].sampleRight; // ALL\r\n\t\t\t\t\r\n\t\t\t\tvar delayPosLeft = 0|synth.delayPosLeft;\r\n\t\t\t\tvar delayFeedback0Left = +synth.delayFeedback0Left;\r\n\t\t\t\tvar delayFeedback1Left = +synth.delayFeedback1Left;\r\n\t\t\t\tvar delayFeedback2Left = +synth.delayFeedback2Left;\r\n\t\t\t\tvar delayFeedback3Left = +synth.delayFeedback3Left;\r\n\t\t\t\tvar delayPosRight = 0|synth.delayPosRight;\r\n\t\t\t\tvar delayFeedback0Right = +synth.delayFeedback0Right;\r\n\t\t\t\tvar delayFeedback1Right = +synth.delayFeedback1Right;\r\n\t\t\t\tvar delayFeedback2Right = +synth.delayFeedback2Right;\r\n\t\t\t\tvar delayFeedback3Right = +synth.delayFeedback3Right;\r\n\t\t\t\tvar limit = +synth.limit;\r\n\t\t\t\t\r\n\t\t\t\twhile (samples) {\r\n\t\t\t\t\tvar channel#Vibrato = 1.0 + channel#VibratoScale * effectY; // PITCH\r\n\t\t\t\t\tvar channel#Tremolo = 1.0 + channel#TremoloScale * (effectY - 1.0); // PITCH\r\n\t\t\t\t\tvar temp = effectY;\r\n\t\t\t\t\teffectY = effectYMult * effectY - prevEffectY;\r\n\t\t\t\t\tprevEffectY = temp;\r\n\t\t\t\t\t\r\n\t\t\t\t\tchannel#SampleLeft += ((channel#Wave[0|(channel#PhaseA * channel#WaveLength)] + channel#Wave[0|(channel#PhaseB * channel#WaveLength)] * channel#ChorusSign) * channel#Volume * channel#Tremolo - channel#SampleLeft) * channel#Filter * channel#VolumeLeft; // CHIP \r\n\t\t\t\t\tchannel#SampleLeft += (channel#Wave[0|(channel#Phase * 32768.0)] * channel#Volume - channel#SampleLeft) * channel#Filter * channel#VolumeLeft; // NOISE\r\n\t\t\t\t\tchannel#SampleRight += ((channel#Wave[0|(channel#PhaseA * channel#WaveLength)] + channel#Wave[0|(channel#PhaseB * channel#WaveLength)] * channel#ChorusSign) * channel#Volume * channel#Tremolo - channel#SampleRight) * channel#Filter * channel#VolumeRight; // CHIP \r\n\t\t\t\t\tchannel#SampleRight += (channel#Wave[0|(channel#Phase * 32768.0)] * channel#Volume - channel#SampleRight) * channel#Filter * channel#VolumeRight; // NOISE\r\n\t\t\t\t\tchannel#Volume += channel#VolumeDelta; // CHIP\r\n\t\t\t\t\tchannel#Volume += channel#VolumeDelta; // NOISE\r\n\t\t\t\t\tchannel#PhaseA += channel#PhaseDelta * channel#Vibrato; // CHIP\r\n\t\t\t\t\tchannel#PhaseB += channel#PhaseDelta * channel#Vibrato * channel#ChorusDeltaRatio; // CHIP\r\n\t\t\t\t\tchannel#Phase += channel#PhaseDelta; // NOISE\r\n\t\t\t\t\tchannel#Filter *= channel#FilterScale; // CHIP\r\n\t\t\t\t\tchannel#PhaseA -= 0|channel#PhaseA; // CHIP\r\n\t\t\t\t\tchannel#PhaseB -= 0|channel#PhaseB; // CHIP\r\n\t\t\t\t\tchannel#Phase -= 0|channel#Phase; // NOISE\r\n\t\t\t\t\tchannel#PhaseDelta *= channel#PhaseDeltaScale; // CHIP\r\n\t\t\t\t\tchannel#PhaseDelta *= channel#PhaseDeltaScale; // NOISE\r\n\t\t\t\t\t\r\n\t\t\t\t\t// INSERT OPERATOR COMPUTATION HERE\r\n\t\t\t\t\tchannel#SampleLeft = channel#Tremolo * (/*channel#Operator$Scaled*/) * channel#VolumeLeft; // CARRIER OUTPUTS\r\n\t\t\t\t\tchannel#SampleRight = channel#Tremolo * (/*channel#Operator$Scaled*/) * channel#VolumeRight; // CARRIER OUTPUTS\r\n\t\t\t\t\tchannel#FeedbackMult += channel#FeedbackDelta; // FM\r\n\t\t\t\t\tchannel#Operator$OutputMult += channel#Operator$OutputDelta; // FM\r\n\t\t\t\t\tchannel#Operator$Phase += channel#Operator$PhaseDelta * channel#Vibrato; // FM\r\n\t\t\t\t\tchannel#Operator$PhaseDelta *= channel#PhaseDeltaScale; // FM\r\n\t\t\t\t\t\r\n\t\t\t\t\t// Reverb, implemented using a feedback delay network with a Hadamard matrix and lowpass filters.\r\n\t\t\t\t\t// good ratios:    0.555235 + 0.618033 + 0.818 +   1.0 = 2.991268\r\n\t\t\t\t\t// Delay lengths:  3041     + 3385     + 4481  +  5477 = 16384 = 2^14\r\n\t\t\t\t\t// Buffer offsets: 3041    -> 6426   -> 10907 -> 16384\r\n\t\t\t\t\tvar delayPos1Left = (delayPosLeft +  3041) & 0x3FFF;\r\n\t\t\t\t\tvar delayPos2Left = (delayPosLeft +  6426) & 0x3FFF;\r\n\t\t\t\t\tvar delayPos3Left = (delayPosLeft + 10907) & 0x3FFF;\r\n\t\t\t\t\tvar delaySampleLeft0 = (delayLineLeft[delayPosLeft]\r\n\t\t\t\t\t\t+ channel#SampleLeft // PITCH\r\n\t\t\t\t\t);\r\n\t\t\t\t\tvar delayPos1Right = (delayPosRight +  3041) & 0x3FFF;\r\n\t\t\t\t\tvar delayPos2Right = (delayPosRight +  6426) & 0x3FFF;\r\n\t\t\t\t\tvar delayPos3Right = (delayPosRight + 10907) & 0x3FFF;\r\n\t\t\t\t\tvar delaySampleRight0 = (delayLineRight[delayPosRight]\r\n\t\t\t\t\t\t+ channel#SampleRight // PITCH\r\n\t\t\t\t\t);\r\n\t\t\t\t\tvar delaySampleLeft1 = delayLineLeft[delayPos1Left];\r\n\t\t\t\t\tvar delaySampleLeft2 = delayLineLeft[delayPos2Left];\r\n\t\t\t\t\tvar delaySampleLeft3 = delayLineLeft[delayPos3Left];\r\n\t\t\t\t\tvar delayTemp0Left = -delaySampleLeft0 + delaySampleLeft1;\r\n\t\t\t\t\tvar delayTemp1Left = -delaySampleLeft0 - delaySampleLeft1;\r\n\t\t\t\t\tvar delayTemp2Left = -delaySampleLeft2 + delaySampleLeft3;\r\n\t\t\t\t\tvar delayTemp3Left = -delaySampleLeft2 - delaySampleLeft3;\r\n\t\t\t\t\tdelayFeedback0Left += ((delayTemp0Left + delayTemp2Left) * reverb - delayFeedback0Left) * 0.5;\r\n\t\t\t\t\tdelayFeedback1Left += ((delayTemp1Left + delayTemp3Left) * reverb - delayFeedback1Left) * 0.5;\r\n\t\t\t\t\tdelayFeedback2Left += ((delayTemp0Left - delayTemp2Left) * reverb - delayFeedback2Left) * 0.5;\r\n\t\t\t\t\tdelayFeedback3Left += ((delayTemp1Left - delayTemp3Left) * reverb - delayFeedback3Left) * 0.5;\r\n\t\t\t\t\tdelayLineLeft[delayPos1Left] = delayFeedback0Left;\r\n\t\t\t\t\tdelayLineLeft[delayPos2Left] = delayFeedback1Left;\r\n\t\t\t\t\tdelayLineLeft[delayPos3Left] = delayFeedback2Left;\r\n\t\t\t\t\tdelayLineLeft[delayPosLeft ] = delayFeedback3Left;\r\n\t\t\t\t\tdelayPosLeft = (delayPosLeft + 1) & 0x3FFF;\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar delaySampleRight1 = delayLineRight[delayPos1Right];\r\n\t\t\t\t\tvar delaySampleRight2 = delayLineRight[delayPos2Right];\r\n\t\t\t\t\tvar delaySampleRight3 = delayLineRight[delayPos3Right];\r\n\t\t\t\t\tvar delayTemp0Right = -delaySampleRight0 + delaySampleRight1;\r\n\t\t\t\t\tvar delayTemp1Right = -delaySampleRight0 - delaySampleRight1;\r\n\t\t\t\t\tvar delayTemp2Right = -delaySampleRight2 + delaySampleRight3;\r\n\t\t\t\t\tvar delayTemp3Right = -delaySampleRight2 - delaySampleRight3;\r\n\t\t\t\t\tdelayFeedback0Right += ((delayTemp0Right + delayTemp2Right) * reverb - delayFeedback0Right) * 0.5;\r\n\t\t\t\t\tdelayFeedback1Right += ((delayTemp1Right + delayTemp3Right) * reverb - delayFeedback1Right) * 0.5;\r\n\t\t\t\t\tdelayFeedback2Right += ((delayTemp0Right - delayTemp2Right) * reverb - delayFeedback2Right) * 0.5;\r\n\t\t\t\t\tdelayFeedback3Right += ((delayTemp1Right - delayTemp3Right) * reverb - delayFeedback3Right) * 0.5;\r\n\t\t\t\t\tdelayLineRight[delayPos1Right] = delayFeedback0Right;\r\n\t\t\t\t\tdelayLineRight[delayPos2Right] = delayFeedback1Right;\r\n\t\t\t\t\tdelayLineRight[delayPos3Right] = delayFeedback2Right;\r\n\t\t\t\t\tdelayLineRight[delayPosRight ] = delayFeedback3Right;\r\n\t\t\t\t\tdelayPosRight = (delayPosRight + 1) & 0x3FFF;\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar sampleLeft = delaySampleLeft0 + delaySampleLeft1 + delaySampleLeft2 + delaySampleLeft3\r\n\t\t\t\t\t\t+ channel#SampleLeft // NOISE\r\n\t\t\t\t\t;\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar sampleRight = delaySampleRight0 + delaySampleRight1 + delaySampleRight2 + delaySampleRight3\r\n\t\t\t\t\t\t+ channel#SampleRight // NOISE\r\n\t\t\t\t\t;\r\n\t\t\t\t\t\r\n\t\t\t\t\tvar abs = sampleLeft < 0.0 ? -sampleLeft : sampleLeft;\r\n\t\t\t\t\tlimit -= limitDecay;\r\n\t\t\t\t\tif (limit < abs) limit = abs;\r\n\t\t\t\t\tsampleLeft /= limit * 0.75 + 0.25;\r\n\t\t\t\t\tsampleLeft *= volume;\r\n\t\t\t\t\tsampleLeft = sampleLeft;\r\n\t\t\t\t\tdataLeft[bufferIndex] = sampleLeft;\r\n\t\t\t\t\tsampleRight /= limit * 0.75 + 0.25;\r\n\t\t\t\t\tsampleRight *= volume;\r\n\t\t\t\t\tsampleRight = sampleRight;\r\n\t\t\t\t\tdataRight[bufferIndex] = sampleRight;\r\n\t\t\t\t\tbufferIndex++;\r\n\t\t\t\t\tsamples--;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tsynthChannel#.phases[0] = channel#PhaseA; // CHIP\r\n\t\t\t\tsynthChannel#.phases[1] = channel#PhaseB; // CHIP\r\n\t\t\t\tsynthChannel#.phases[0] = channel#Phase; // NOISE\r\n\t\t\t\tsynthChannel#.phases[$] = channel#Operator$Phase / ` + Config.sineWaveLength + `; // FM\r\n\t\t\t\tsynthChannel#.feedbackOutputs[$] = channel#Operator$Output; // FM\r\n\t\t\t\tsynthChannel#.sampleLeft = channel#SampleLeft; // ALL\r\n\t\t\t\tsynthChannel#.sampleRight = channel#SampleRight; // ALL\r\n\t\t\t\t\r\n\t\t\t\tsynth.delayPosLeft = delayPosLeft;\r\n\t\t\t\tsynth.delayFeedback0Left = delayFeedback0Left;\r\n\t\t\t\tsynth.delayFeedback1Left = delayFeedback1Left;\r\n\t\t\t\tsynth.delayFeedback2Left = delayFeedback2Left;\r\n\t\t\t\tsynth.delayFeedback3Left = delayFeedback3Left;\r\n\t\t\t\tsynth.delayPosRight = delayPosRight;\r\n\t\t\t\tsynth.delayFeedback0Right = delayFeedback0Right;\r\n\t\t\t\tsynth.delayFeedback1Right = delayFeedback1Right;\r\n\t\t\t\tsynth.delayFeedback2Right = delayFeedback2Right;\r\n\t\t\t\tsynth.delayFeedback3Right = delayFeedback3Right;\r\n\t\t\t\tsynth.limit = limit;\r\n\t\t\t\t\r\n\t\t\t\tif (effectYMult * effectY - prevEffectY > prevEffectY) {\r\n\t\t\t\t\tsynth.effectPhase = Math.asin(effectY);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tsynth.effectPhase = Math.PI - Math.asin(effectY);\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif (synth.arpSampleCountdown == 0) {\r\n\t\t\t\t\tsynth.arpeggio++;\r\n\t\t\t\t\tsynth.arpSampleCountdown = samplesPerTick;\r\n\t\t\t\t\tif (synth.arpeggio == 4) {\r\n\t\t\t\t\t\tsynth.arpeggio = 0;\r\n\t\t\t\t\t\tsynth.part++;\r\n\t\t\t\t\t\tif (synth.part == song.partsPerBeat) {\r\n\t\t\t\t\t\t\tsynth.part = 0;\r\n\t\t\t\t\t\t\tsynth.beat++;\r\n\t\t\t\t\t\t\tif (synth.beat == song.beatsPerBar) {\r\n\t\t\t\t\t\t\t\t// The bar ended, may need to regenerate synthesizer.\r\n\t\t\t\t\t\t\t\treturn bufferIndex;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// Indicate that the buffer is finished generating.\r\n\t\t\treturn -1;\r\n\t\t`).split(\"\\n\");\r\n\t\t\r\n\t\tprivate static operatorSourceTemplate: string[] = (`\r\n\t\t\t\t\t\tvar channel#Operator$PhaseMix = channel#Operator$Phase/* + channel#Operator@Scaled*/;\r\n\t\t\t\t\t\tvar channel#Operator$PhaseInt = channel#Operator$PhaseMix|0;\r\n\t\t\t\t\t\tvar channel#Operator$Index    = channel#Operator$PhaseInt & ` + Config.sineWaveMask + `;\r\n\t\t\t\t\t\tvar channel#Operator$Sample   = sineWave[channel#Operator$Index];\r\n\t\t\t\t\t\tchannel#Operator$Output       = channel#Operator$Sample + (sineWave[channel#Operator$Index + 1] - channel#Operator$Sample) * (channel#Operator$PhaseMix - channel#Operator$PhaseInt);\r\n\t\t\t\t\t\tvar channel#Operator$Scaled   = channel#Operator$OutputMult * channel#Operator$Output;\r\n\t\t`).split(\"\\n\");\r\n\t\t\r\n\t\tprivate frequencyFromPitch(pitch: number): number {\r\n\t\t\treturn 440.0 * Math.pow(2.0, (pitch - 69.0) / 12.0);\r\n\t\t}\r\n\t\t\r\n\t\tprivate volumeConversion(noteVolume: number): number {\r\n\t\t\treturn Math.pow(noteVolume / 3.0, 1.5);\r\n\t\t}\r\n\t\t\r\n\t\tprivate getSamplesPerArpeggio(): number {\r\n\t\t\tif (this.song == null) return 0;\r\n\t\t\tconst beatsPerMinute: number = this.song.getBeatsPerMinute();\r\n\t\t\tconst beatsPerSecond: number = beatsPerMinute / 60.0;\r\n\t\t\tconst partsPerSecond: number = beatsPerSecond * this.song.partsPerBeat;\r\n\t\t\tconst arpeggioPerSecond: number = partsPerSecond * 4.0;\r\n\t\t\treturn Math.floor(this.samplesPerSecond / arpeggioPerSecond);\r\n\t\t}\r\n\t}\r\n","/*\r\nCopyright (C) 2018 John Nesky\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of \r\nthis software and associated documentation files (the \"Software\"), to deal in \r\nthe Software without restriction, including without limitation the rights to \r\nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \r\nof the Software, and to permit persons to whom the Software is furnished to do \r\nso, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all \r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \r\nSOFTWARE.\r\n*/\r\n\r\nimport { HTML} from \"imperative-html/dist/esm/elements-strict\";\r\nimport { Prompt } from \"./Prompt\";\r\nimport { SongDocument } from \"./SongDocument\";\r\nimport { Synth } from \"../synth/synth\";\r\n\tconst {button, div, input} = HTML;\r\n\r\n\t// function lerp(low: number, high: number, t: number): number {\r\n\t// \treturn low + t * (high - low);\r\n\t// }\r\n\t\r\n\tfunction save(blob: Blob, name: string): void {\r\n\t\tif ((<any>navigator).msSaveOrOpenBlob) {\r\n\t\t\t(<any>navigator).msSaveOrOpenBlob(blob, name);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\r\n\t\tconst anchor: HTMLAnchorElement = document.createElement(\"a\");\r\n\t\tif (anchor.download != undefined) {\r\n\t\t\tconst url: string = URL.createObjectURL(blob);\r\n\t\t\tsetTimeout(function() { URL.revokeObjectURL(url); }, 60000);\r\n\t\t\tanchor.href = url;\r\n\t\t\tanchor.download = name;\r\n\t\t\t// Chrome bug regression: We need to delay dispatching the click\r\n\t\t\t// event. Seems to be related to going back in the browser history.\r\n\t\t\t// https://bugs.chromium.org/p/chromium/issues/detail?id=825100\r\n\t\t\tsetTimeout(function() { anchor.dispatchEvent(new MouseEvent(\"click\")); }, 0);\r\n\t\t} else {\r\n\t\t\tconst url: string = URL.createObjectURL(blob);\r\n\t\t\tsetTimeout(function() { URL.revokeObjectURL(url); }, 60000);\r\n\t\t\tif (!window.open(url, \"_blank\")) window.location.href = url;\r\n\t\t}\r\n\t}\r\n\r\n\texport class ExportPrompt implements Prompt {\r\n\t\tprivate readonly _fileName: HTMLInputElement = input({type: \"text\", style: \"width: 10em;\", value: \"Modbox-Song\", maxlength: 250});\r\n\t\tprivate readonly _enableIntro: HTMLInputElement = input({type: \"checkbox\"});\r\n\t\tprivate readonly _loopDropDown: HTMLInputElement = input({style:\"width: 2em;\", type: \"number\", min: \"1\", max: \"4\", step: \"1\"});\r\n\t\tprivate readonly _enableOutro: HTMLInputElement = input({type: \"checkbox\"});\r\n\t\tprivate readonly _exportWavButton: HTMLButtonElement = button({}, [div(\"Export to .wav file\")]);\r\n\t\tprivate readonly _exportJsonButton: HTMLButtonElement = button({}, [div(\"Export to .json file\")]);\r\n\t\tprivate readonly _cancelButton: HTMLButtonElement = button({}, [div(\"Cancel\")]);\r\n\t\t\r\n\t\tpublic readonly container: HTMLDivElement = div({class: \"prompt\", style: \"width: 200px;\"}, [\r\n\t\t\tdiv({style: \"font-size: 2em\"}, [div(\"Export Options\")]),\r\n\t\t\tdiv({style: \"display: flex; flex-direction: row; align-items: center; justify-content: space-between;\"}, [\r\n\t\t\t\tdiv(\"File name:\"),\r\n\t\t\t\tthis._fileName,\r\n\t\t\t]),\r\n\t\t\tdiv({style: \"display: table; width: 100%;\"}, [\r\n\t\t\t\tdiv({style: \"display: table-row;\"}, [\r\n\t\t\t\t\tdiv({style: \"display: table-cell;\"}, [div(\"Intro:\")]),\r\n\t\t\t\t\tdiv({style: \"display: table-cell;\"}, [div(\"Loop Count:\")]),\r\n\t\t\t\t\tdiv({style: \"display: table-cell;\"}, [div(\"Outro:\")]),\r\n\t\t\t\t]),\r\n\t\t\t\tdiv({style: \"display: table-row;\"}, [\r\n\t\t\t\t\tdiv({style: \"display: table-cell; vertical-align: middle;\"}, [this._enableIntro]),\r\n\t\t\t\t\tdiv({style: \"display: table-cell; vertical-align: middle;\"}, [this._loopDropDown]),\r\n\t\t\t\t\tdiv({style: \"display: table-cell; vertical-align: middle;\"}, [this._enableOutro]),\r\n\t\t\t\t]),\r\n\t\t\t]),\r\n\t\t\tthis._exportWavButton,\r\n\t\t\tthis._exportJsonButton,\r\n\t\t\tthis._cancelButton,\r\n\t\t]);\r\n\t\t\r\n\t\tconstructor(private _doc: SongDocument) {\r\n\t\t\tthis._loopDropDown.value = \"1\";\r\n\t\t\t\r\n\t\t\tif (this._doc.song.loopStart == 0) {\r\n\t\t\t\tthis._enableIntro.checked = false;\r\n\t\t\t\tthis._enableIntro.disabled = true;\r\n\t\t\t} else {\r\n\t\t\t\tthis._enableIntro.checked = true;\r\n\t\t\t\tthis._enableIntro.disabled = false;\r\n\t\t\t}\r\n\t\t\tif (this._doc.song.loopStart + this._doc.song.loopLength == this._doc.song.barCount) {\r\n\t\t\t\tthis._enableOutro.checked = false;\r\n\t\t\t\tthis._enableOutro.disabled = true;\r\n\t\t\t} else {\r\n\t\t\t\tthis._enableOutro.checked = true;\r\n\t\t\t\tthis._enableOutro.disabled = false;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._fileName.addEventListener(\"input\", ExportPrompt._validateFileName);\r\n\t\t\tthis._loopDropDown.addEventListener(\"blur\", ExportPrompt._validateNumber);\r\n\t\t\tthis._exportWavButton.addEventListener(\"click\", this._whenExportToWav);\r\n\t\t\tthis._exportJsonButton.addEventListener(\"click\", this._whenExportToJson);\r\n\t\t\tthis._cancelButton.addEventListener(\"click\", this._close);\r\n\t\t}\r\n\t\t\r\n\t\tprivate _close = (): void => { \r\n\t\t\tthis._doc.undo();\r\n\t\t}\r\n\t\t\r\n\t\tpublic cleanUp = (): void => { \r\n\t\t\tthis._fileName.removeEventListener(\"input\", ExportPrompt._validateFileName);\r\n\t\t\tthis._loopDropDown.removeEventListener(\"blur\", ExportPrompt._validateNumber);\r\n\t\t\tthis._exportWavButton.removeEventListener(\"click\", this._whenExportToWav);\r\n\t\t\tthis._exportJsonButton.removeEventListener(\"click\", this._whenExportToJson);\r\n\t\t\tthis._cancelButton.removeEventListener(\"click\", this._close);\r\n\t\t}\r\n\t\t\r\n\t\tprivate static _validateFileName(event: Event): void {\r\n\t\t\tconst input: HTMLInputElement = <HTMLInputElement>event.target;\r\n\t\t\tconst deleteChars = /[\\+\\*\\$\\?\\|\\{\\}\\\\\\/<>#%!`&'\"=:@]/gi;\r\n\t\t\tif (deleteChars.test(input.value)) {\r\n\t\t\t\tlet cursorPos: number = <number>input.selectionStart;\r\n\t\t\t\tinput.value = input.value.replace(deleteChars, \"\");\r\n\t\t\t\tcursorPos--;\r\n\t\t\t\tinput.setSelectionRange(cursorPos, cursorPos);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tprivate static _validateNumber(event: Event): void {\r\n\t\t\tconst input: HTMLInputElement = <HTMLInputElement>event.target;\r\n\t\t\tinput.value = Math.floor(Math.max(Number(input.min), Math.min(Number(input.max), Number(input.value)))) + \"\";\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenExportToWav = (): void => {\r\n\t\t\t\r\n\t\t\tconst synth: Synth = new Synth(this._doc.song)\r\n\t\t\tsynth.enableIntro = this._enableIntro.checked;\r\n\t\t\tsynth.enableOutro = this._enableOutro.checked;\r\n\t\t\tsynth.loopCount = Number(this._loopDropDown.value);\r\n\t\t\tif (!synth.enableIntro) {\r\n\t\t\t\tfor (let introIter: number = 0; introIter < this._doc.song.loopStart; introIter++) {\r\n\t\t\t\t\tsynth.nextBar();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tconst sampleFrames: number = synth.totalSamples;\r\n\t\t\tconst recordedSamplesLeft: Float32Array = new Float32Array(sampleFrames);\r\n\t\t\tconst recordedSamplesRight: Float32Array = new Float32Array(sampleFrames);\r\n\t\t\t//const timer: number = performance.now();\r\n\t\t\tsynth.synthesize(recordedSamplesLeft, recordedSamplesRight, sampleFrames);\r\n\t\t\t//console.log(\"export timer\", (performance.now() - timer) / 1000.0);\r\n\t\t\t\r\n\t\t\tconst srcChannelCount: number = 2;\r\n\t\t\tconst wavChannelCount: number = 2;\r\n\t\t\t// const sampleRate: number = 44100;\r\n\t\t\tconst sampleRate: number = synth.samplesPerSecond;\r\n\t\t\tconst bytesPerSample: number = 2;\r\n\t\t\tconst bitsPerSample: number = 8 * bytesPerSample;\r\n\t\t\tconst sampleCount: number = wavChannelCount * sampleFrames;\r\n\t\t\t\r\n\t\t\tconst totalFileSize: number = 44 + sampleCount * bytesPerSample;\r\n\t\t\t\r\n\t\t\tlet index: number = 0;\r\n\t\t\tconst arrayBuffer: ArrayBuffer = new ArrayBuffer(totalFileSize);\r\n\t\t\tconst data: DataView = new DataView(arrayBuffer);\r\n\t\t\tdata.setUint32(index, 0x52494646, false); index += 4;\r\n\t\t\tdata.setUint32(index, 36 + sampleCount * bytesPerSample, true); index += 4; // size of remaining file\r\n\t\t\tdata.setUint32(index, 0x57415645, false); index += 4;\r\n\t\t\tdata.setUint32(index, 0x666D7420, false); index += 4;\r\n\t\t\tdata.setUint32(index, 0x00000010, true); index += 4; // size of following header\r\n\t\t\tdata.setUint16(index, 0x0001, true); index += 2; // not compressed\r\n\t\t\tdata.setUint16(index, wavChannelCount, true); index += 2; // channel count\r\n\t\t\tdata.setUint32(index, sampleRate, true); index += 4; // sample rate\r\n\t\t\tdata.setUint32(index, sampleRate * bytesPerSample * wavChannelCount, true); index += 4; // bytes per second\r\n\t\t\tdata.setUint16(index, bytesPerSample, true); index += 2; // sample rate\r\n\t\t\tdata.setUint16(index, bitsPerSample, true); index += 2; // sample rate\r\n\t\t\tdata.setUint32(index, 0x64617461, false); index += 4;\r\n\t\t\tdata.setUint32(index, sampleCount * bytesPerSample, true); index += 4;\r\n\t\t\tlet stride: number;\r\n\t\t\tlet repeat: number;\r\n\t\t\tif (srcChannelCount == wavChannelCount) {\r\n\t\t\t\tstride = 1;\r\n\t\t\t\trepeat = 1;\r\n\t\t\t} else {\r\n\t\t\t\tstride = srcChannelCount;\r\n\t\t\t\trepeat = wavChannelCount;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tlet valLeft: number;\r\n\t\t\tlet valRight: number;\r\n\t\t\tif (bytesPerSample > 1) {\r\n\t\t\t\t// usually samples are signed. \r\n\t\t\t\tfor (let i: number = 0; i < sampleFrames; i++) {\r\n\t\t\t\t\tvalLeft = Math.floor(recordedSamplesLeft[i * stride] * ((1 << (bitsPerSample - 1)) - 1));\r\n\t\t\t\t\tvalRight = Math.floor(recordedSamplesRight[i * stride] * ((1 << (bitsPerSample - 1)) - 1));\r\n\t\t\t\t\tfor (let k: number = 0; k < repeat; k++) {\r\n\t\t\t\t\t\tif (bytesPerSample == 2) {\r\n\t\t\t\t\t\t\tdata.setInt16(index, valLeft, true); index += 2;\r\n\t\t\t\t\t\t\tdata.setInt16(index, valRight, true); index += 2;\r\n\t\t\t\t\t\t} else if (bytesPerSample == 4) {\r\n\t\t\t\t\t\t\tdata.setInt32(index, valLeft, true); index += 4;\r\n\t\t\t\t\t\t\tdata.setInt32(index, valRight, true); index += 4;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthrow new Error(\"unsupported sample size\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t// 8 bit samples are a special case: they are unsigned.\r\n\t\t\t\tfor (let i: number = 0; i < sampleFrames; i++) {\r\n\t\t\t\t\tvalLeft = Math.floor(recordedSamplesLeft[i*stride] * 127 + 128);\r\n\t\t\t\t\tvalRight = Math.floor(recordedSamplesRight[i*stride] * 127 + 128);\r\n\t\t\t\t\tfor (let k: number = 0; k < repeat; k++) {\r\n\t\t\t\t\t\tdata.setUint8(index, valLeft > 255 ? 255 : (valLeft < 0 ? 0 : valLeft)); index++;\r\n\t\t\t\t\t\tdata.setUint8(index, valRight > 255 ? 255 : (valRight < 0 ? 0 : valRight)); index++;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tconst blob = new Blob([arrayBuffer], {type: \"audio/wav\"});\r\n\t\t\tsave(blob, this._fileName.value.trim() + \".wav\");\r\n\t\t\t\r\n\t\t\tthis._close();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenExportToJson = (): void => {\r\n\t\t\tconst jsonObject: Object = this._doc.song.toJsonObject(this._enableIntro.checked, Number(this._loopDropDown.value), this._enableOutro.checked);\r\n\t\t\tconst jsonString: string = JSON.stringify(jsonObject, null, '\\t');\r\n\t\t\tconst blob = new Blob([jsonString], {type: \"application/json\"});\r\n\t\t\tsave(blob, this._fileName.value.trim() + \".json\");\r\n\t\t\tthis._close();\r\n\t\t}\r\n\t}\r\n\r\n","/*\r\nCopyright (C) 2018 John Nesky\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of \r\nthis software and associated documentation files (the \"Software\"), to deal in \r\nthe Software without restriction, including without limitation the rights to \r\nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \r\nof the Software, and to permit persons to whom the Software is furnished to do \r\nso, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all \r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \r\nSOFTWARE.\r\n*/\r\n\r\nimport { HTML } from \"imperative-html/dist/esm/elements-strict\";\r\nimport { Prompt } from \"./Prompt\";\r\nimport { SongDocument } from \"./SongDocument\";\r\nimport { ChangeSong } from \"./changes\";\r\n\tconst {button, div, input} = HTML;\r\n\r\n\r\n\texport class ImportPrompt implements Prompt {\r\n\t\tprivate readonly _fileInput: HTMLInputElement = input({type: \"file\", accept: \".json,application/json\"});\r\n\t\tprivate readonly _cancelButton: HTMLButtonElement = button({}, [div(\"Cancel\")]);\r\n\t\t\r\n\t\tpublic readonly container: HTMLDivElement = div({class: \"prompt\", style: \"width: 200px;\"}, [\r\n\t\t\tdiv({style: \"font-size: 2em\"}, [div(\"Import\")]),\r\n\t\t\tdiv({style: \"text-align: left;\"}, [div(\"BeepBox songs can be exported and re-imported as .json files. You could also use other means to make .json files for BeepBox as long as they follow the same structure.\")]),\r\n\t\t\tthis._fileInput,\r\n\t\t\tthis._cancelButton,\r\n\t\t]);\r\n\t\t\r\n\t\tconstructor(private _doc: SongDocument) {\r\n\t\t\tthis._fileInput.addEventListener(\"change\", this._whenFileSelected);\r\n\t\t\tthis._cancelButton.addEventListener(\"click\", this._close);\r\n\t\t}\r\n\t\t\r\n\t\tprivate _close = (): void => { \r\n\t\t\tthis._doc.undo();\r\n\t\t}\r\n\t\t\r\n\t\tpublic cleanUp = (): void => { \r\n\t\t\tthis._fileInput.removeEventListener(\"change\", this._whenFileSelected);\r\n\t\t\tthis._cancelButton.removeEventListener(\"click\", this._close);\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenFileSelected = (): void => {\r\n\t\t\tconst file: File = this._fileInput.files![0];\r\n\t\t\tif (!file) return;\r\n\t\t\t\r\n\t\t\tconst reader: FileReader = new FileReader();\r\n\t\t\treader.addEventListener(\"load\", (event: Event): void => {\r\n\t\t\t\tthis._doc.prompt = null;\r\n\t\t\t\tthis._doc.record(new ChangeSong(this._doc, <string>reader.result), true);\r\n\t\t\t});\r\n\t\t\treader.readAsText(file);\r\n\t\t}\r\n\t}\r\n\r\n","/*\r\nCopyright (C) 2018 John Nesky\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of \r\nthis software and associated documentation files (the \"Software\"), to deal in \r\nthe Software without restriction, including without limitation the rights to \r\nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \r\nof the Software, and to permit persons to whom the Software is furnished to do \r\nso, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all \r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \r\nSOFTWARE.\r\n*/\r\n\r\nimport { HTML } from \"imperative-html/dist/esm/elements-strict\";\r\nimport { Prompt } from \"./Prompt\";\r\nimport { SongDocument } from \"./SongDocument\";\r\n\r\n\tconst {button, div, a} = HTML;\r\n\texport class ArchivePrompt implements Prompt {\r\n\t\tprivate readonly _cancelButton: HTMLButtonElement = button({}, div(\"No thanks!\"));\r\n\t\t\r\n\t\tpublic readonly container: HTMLDivElement = div({class: \"prompt\", style: \"width: 250px;\"}, \r\n\t\t\tdiv({ style: \"font-size: 2em\" }, div(\"Archives\")),\r\n\t\t\tdiv({ style: \"text-align: center;\" }, div('These are the Archives. Below are previous versions of Modded Beepbox/Sandbox that you are able to play around with, changelog included. Go nuts!')),\r\n\t\t\tdiv({ style: \"text-align: center;\" }, \r\n\t\t\t\ta({ target: \"_blank\", href: \"https://moddedbeepbox.github.io/beta/mb-archives/1.3.0.htm\" }, div(\"MB 1.3.0\")), div(\" | \"),\r\n\t\t\t\ta({ target: \"_blank\", href: \"https://moddedbeepbox.github.io/beta/mb-archives/1.6.0.htm\" }, div(\"MB 1.6.0\")), div(\" | \"),\r\n\t\t\t\ta({ target: \"_blank\", href: \"https://moddedbeepbox.github.io/beta/mb-archives/1.9.1.htm\" }, div(\"MB 1.9.1\")), div(\" | \"),\r\n\t\t\t\ta({ target: \"_blank\", href: \"https://moddedbeepbox.github.io/beta/mb-archives/2.0.0.htm\" }, div(\"MB v2.0.0\")), div(\" | \"),\r\n\t\t\t\ta({ target: \"_blank\", href: \"https://moddedbeepbox.github.io/beta/mb-archives/2.3.0.htm\" }, div(\"MB v2.2.2\")), div(\" | \"),\r\n\t\t\t\ta({ target: \"_blank\", href: \"https://moddedbeepbox.github.io/beta/mb-archives/2.3.html\" }, div(\"MB v2.3.0\")), div(\" | \"),\r\n\t\t\t\ta({ target: \"_blank\", href: \"https://moddedbeepbox.github.io/beta/mb-archives/3.0.html\" }, div(\"MB v3.0.3\")), div(\" | \"),\r\n\t\t\t\ta({ target: \"_blank\", href: \"https://moddedbeepbox.github.io/beta/sb-archives/1.2.1.htm\" }, div(\"SB v1.2.1\")), div(\" | \"),\r\n\t\t\t\ta({ target: \"_blank\", href: \"https://moddedbeepbox.github.io/beta/sb-archives/1.3.0.htm\" }, div(\"SB v1.3.0\")), div(\" | \"),\r\n\t\t\t\ta({ target: \"_blank\", href: \"https://moddedbeepbox.github.io/beta/sb-archives/1.4.0.htm\" }, div(\"SB v1.4.0\")), div(\" | \"),\r\n\t\t\t\ta({ target: \"_blank\", href: \"https://moddedbeepbox.github.io/beta/sb-archives/2.0.6.1.htm\" }, div(\"SB v2.0.6.1\")), div(\" | \"),\r\n\t\t\t\ta({ target: \"_blank\", href: \"https://moddedbeepbox.github.io/beta/sb-archives/2.1.3.htm\" }, div(\"SB v2.1.3\")), div(\" | \"),\r\n\t\t\t\ta({ target: \"_blank\", href: \"https://moddedbeepbox.github.io/beta/sb-archives/3.0.0.htm\" }, div(\"SB v3.0.0\")), div(\" | \"),\r\n\t\t\t\ta({ target: \"_blank\", href: \"https://moddedbeepbox.github.io/beta/changelogs/mbchangelog.html\" }, div(\"Changelog\")),\r\n\t\t\t),\r\n\t\t\tthis._cancelButton,\r\n\t\t);\r\n\r\n\t\t\tconstructor(private _doc: SongDocument) {\r\n\t\t\t\tthis._cancelButton.addEventListener(\"click\", this._close);\r\n\t\t\t}\r\n\t\t\tprivate _close = (): void => { \r\n\t\t\t\tthis._doc.undo();\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tpublic cleanUp = (): void => { \r\n\t\t\t\tthis._cancelButton.removeEventListener(\"click\", this._close);\r\n            };\r\n    }\r\n","/*\r\nCopyright (C) 2018 John Nesky\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of \r\nthis software and associated documentation files (the \"Software\"), to deal in \r\nthe Software without restriction, including without limitation the rights to \r\nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \r\nof the Software, and to permit persons to whom the Software is furnished to do \r\nso, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all \r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \r\nSOFTWARE.\r\n*/\r\n\r\nimport { HTML } from \"imperative-html/dist/esm/elements-strict\";\r\nimport { SongDocument } from \"./SongDocument\";\r\nimport { Prompt } from \"./Prompt\";\r\n\tconst {button, div} = HTML;\r\n\r\n\texport class SongDataPrompt implements Prompt {\r\n\t\tprivate readonly _cancelButton: HTMLButtonElement = button({}, [div(\"Close\")]);\r\n\t\t\r\n\t\tpublic readonly container: HTMLDivElement = div({class: \"prompt\", style: \"width: 250px;\"}, [\r\n                div({ style: \"font-size: 2em\" }, [div(\"Song Data\")]),\r\n\t\t\t\tdiv({ style: \"text-align: left;\" }, [div('You are on update Modbox 3.3.0-B_1.')]),\r\n\t\t\t\tdiv({ style: \"text-align: left;\" }, [div('Your song is ' + this._doc.synth.totalSeconds + ' seconds long.')]),\r\n\t\t\t\tdiv({ style: \"text-align: left;\" }, [div('Your song runs at ' + this._doc.song.getBeatsPerMinute() + ' beats per minute.')]),\r\n\t\t\t\tdiv({ style: \"text-align: left;\" }, [div('There are currently ' + this._doc.song.getChannelUnusedCount() + ' unused channels in your song out of 16.')]),\r\n\t\t\t\tdiv({ style: \"text-align: left;\" }, [div(this._doc.song.setSongTheme == \"none\" ? 'You are using your personal theme.' :'Your are using the ' + this._doc.song.setSongTheme + ' theme.')]),\r\n\t\t\t\tdiv({ style: \"text-align: left;\" }, [div('Your time signuature is ' + this._doc.song.getTimeSig())]),\r\n\t\t\t\tdiv({ style: \"text-align: left;\" }, [div('Your scale is ' + this._doc.song.getScaleNKey() + '.')]),\r\n\t\t\tthis._cancelButton,\r\n         ]);\r\n\r\n\t\t\tconstructor(private _doc: SongDocument) {\r\n\t\t\t\tthis._cancelButton.addEventListener(\"click\", this._close);\r\n\t\t\t}\r\n\t\t\tprivate _close = (): void => { \r\n\t\t\t\tthis._doc.undo();\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tpublic cleanUp = (): void => { \r\n\t\t\t\tthis._cancelButton.removeEventListener(\"click\", this._close);\r\n            };\r\n    }\r\n","/*\r\nCopyright (C) 2018 John Nesky\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of \r\nthis software and associated documentation files (the \"Software\"), to deal in \r\nthe Software without restriction, including without limitation the rights to \r\nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \r\nof the Software, and to permit persons to whom the Software is furnished to do \r\nso, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all \r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \r\nSOFTWARE.\r\n*/\r\n\r\nimport { HTML } from \"imperative-html/dist/esm/elements-strict\";\r\nimport { SongDocument } from \"./SongDocument\";\r\nimport { Prompt } from \"./Prompt\";\r\nimport { SongEditor } from \"./SongEditor\";\r\nimport { ChangeKey } from \"./changes\";\r\n\tconst {button, div} = HTML;\r\n\texport class RefreshKeyPrompt implements Prompt {\r\n\t\tprivate readonly _refreshButton: HTMLButtonElement = button({}, [div(\"Refresh\")]);\r\n\t\t\r\n\t\tpublic readonly container: HTMLDivElement = div({class: \"prompt\", style: \"width: 200px;\"}, [\r\n\t\t\tdiv({style: \"font-size: 1em\"}, [div(\"Refresh\")]),\r\n\t\t\tdiv({style: \"text-align: left; margin: 0.5em 0;\"}, [\r\n\t\t\t\tdiv(\"Due to you using the Piano theme, you will need to refresh to display the change in key colors.\")]),\r\n\t\t\tdiv({style: \"text-align: left; margin: 0.5em 0;\"}, [\r\n\t\t\t\tdiv(\"You must refresh to continue.\")]),\r\n            this._refreshButton,\r\n         ]);\r\n\r\n\t\t\tconstructor(private _doc: SongDocument, private _songEditor: SongEditor, private _newKeyValue: number) {\r\n\t\t\t\tthis._refreshButton.addEventListener(\"click\", this._saveChangesAndRefresh);\r\n\t\t\t}\r\n\r\n\t\t\tprivate _saveChangesAndRefresh = (): void => {\r\n\t\t\t\tthis._doc.prompt = null;\r\n\t\t\t\tthis._doc.record(new ChangeKey(this._doc, this._newKeyValue));\r\n\t\t\t\tthis._songEditor.refreshNow();\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tpublic cleanUp = (): void => { \r\n\t\t\t\tthis._refreshButton.addEventListener(\"click\", this._saveChangesAndRefresh);\r\n            };\r\n    }\r\n","/*\r\nCopyright (C) 2018 John Nesky\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of \r\nthis software and associated documentation files (the \"Software\"), to deal in \r\nthe Software without restriction, including without limitation the rights to \r\nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \r\nof the Software, and to permit persons to whom the Software is furnished to do \r\nso, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all \r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \r\nSOFTWARE.\r\n*/\r\n\r\nimport { HTML } from \"imperative-html/dist/esm/elements-strict\";\r\nimport { SongDocument } from \"./SongDocument\";\r\nimport { Prompt } from \"./Prompt\";\r\nimport { Config } from \"../synth/SynthConfig\";\r\nimport { ChangeGroup } from \"./Change\";\r\nimport { ChangeBeatsPerBar, ChangeBarCount, ChangePatternsPerChannel, ChangeInstrumentsPerChannel, ChangeChannelCount } from \"./changes\";\r\n\tconst {button, div, input, span} = HTML;\r\n\t\r\n\texport class SongDurationPrompt implements Prompt {\r\n\t\tprivate readonly _beatsStepper: HTMLInputElement = input({style: \"width: 3em; margin-left: 1em;\", type: \"number\", step: \"1\"});\r\n\t\tprivate readonly _barsStepper: HTMLInputElement = input({style: \"width: 3em; margin-left: 1em;\", type: \"number\", step: \"1\"});\r\n\t\tprivate readonly _patternsStepper: HTMLInputElement = input({style: \"width: 3em; margin-left: 1em;\", type: \"number\", step: \"1\"});\r\n\t\tprivate readonly _instrumentsStepper: HTMLInputElement = input({style: \"width: 3em; margin-left: 1em;\", type: \"number\", step: \"1\"});\r\n\t\tprivate readonly _pitchChannelStepper: HTMLInputElement = input({style: \"width: 3em; margin-left: 1em;\", type: \"number\", step: \"1\"});\r\n\t\tprivate readonly _drumChannelStepper: HTMLInputElement = input({style: \"width: 3em; margin-left: 1em;\", type: \"number\", step: \"1\"});\r\n\t\tprivate readonly _okayButton: HTMLButtonElement = button({style: \"width:45%;\"}, [div(\"Okay\")]);\r\n\t\tprivate readonly _cancelButton: HTMLButtonElement = button({style: \"width:45%;\"}, [div(\"Cancel\")]);\r\n\t\t\r\n\t\tpublic readonly container: HTMLDivElement = div({class: \"prompt\", style: \"width: 250px;\"}, [\r\n\t\t\tdiv({style: \"font-size: 2em\"}, [div(\"Custom Song Size\")]),\r\n\t\t\tdiv({style: \"display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;\"}, [\r\n\t\t\t\tdiv({style: \"text-align: right;\"}, [\r\n\t\t\t\t\tdiv(\"Beats per bar:\"),\r\n\t\t\t\t\tspan({style: \"font-size: smaller; color: #888888;\"}, [div(\"(Multiples of 3 or 4 are recommended)\")]),\r\n\t\t\t\t]),\r\n\t\t\t\tthis._beatsStepper,\r\n\t\t\t]),\r\n\t\t\tdiv({style: \"display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;\"}, [\r\n\t\t\t\tdiv({style: \"display: inline-block; text-align: right;\"}, [\r\n\t\t\t\t\tdiv(\"Bars per song:\"),\r\n\t\t\t\t\tspan({style: \"font-size: smaller; color: #888888;\"}, [div(\"(Multiples of 2 or 4 are recommended)\")]),\r\n\t\t\t\t]),\r\n\t\t\t\tthis._barsStepper,\r\n\t\t\t]),\r\n\t\t\tdiv({style: \"display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;\"}, [\r\n\t\t\t\tdiv(\"Patterns per channel:\"),\r\n\t\t\t\tthis._patternsStepper,\r\n\t\t\t]),\r\n\t\t\tdiv({style: \"display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;\"}, [\r\n\t\t\t\tdiv(\"Instruments per channel:\"),\r\n\t\t\t\tthis._instrumentsStepper,\r\n\t\t\t]),\r\n\t\t\tdiv({style: \"display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;\"}, [\r\n\t\t\t\tdiv(\"Number of pitch channels:\"),\r\n\t\t\t\tthis._pitchChannelStepper,\r\n\t\t\t]),\r\n\t\t\tdiv({style: \"display: flex; flex-direction: row; align-items: center; height: 2em; justify-content: flex-end;\"}, [\r\n\t\t\t\tdiv(\"Number of drum channels:\"),\r\n\t\t\t\tthis._drumChannelStepper,\r\n\t\t\t]),\r\n\t\t\tdiv({style: \"display: flex; flex-direction: row; justify-content: space-between;\"}, [\r\n\t\t\t\tthis._okayButton,\r\n\t\t\t\tthis._cancelButton,\r\n\t\t\t]),\r\n\t\t]);\r\n\t\t\r\n\t\tconstructor(private _doc: SongDocument) {\r\n\t\t\tthis._beatsStepper.value = this._doc.song.beatsPerBar + \"\";\r\n\t\t\tthis._beatsStepper.min = Config.beatsPerBarMin + \"\";\r\n\t\t\tthis._beatsStepper.max = Config.beatsPerBarMax + \"\";\r\n\t\t\t\r\n\t\t\tthis._barsStepper.value = this._doc.song.barCount + \"\";\r\n\t\t\tthis._barsStepper.min = Config.barCountMin + \"\";\r\n\t\t\tthis._barsStepper.max = Config.barCountMax + \"\";\r\n\t\t\t\r\n\t\t\tthis._patternsStepper.value = this._doc.song.patternsPerChannel + \"\";\r\n\t\t\tthis._patternsStepper.min = Config.patternsPerChannelMin + \"\";\r\n\t\t\tthis._patternsStepper.max = Config.patternsPerChannelMax + \"\";\r\n\t\t\t\r\n\t\t\tthis._instrumentsStepper.value = this._doc.song.instrumentsPerChannel + \"\";\r\n\t\t\tthis._instrumentsStepper.min = Config.instrumentsPerChannelMin + \"\";\r\n\t\t\tthis._instrumentsStepper.max = Config.instrumentsPerChannelMax + \"\";\r\n\t\t\t\r\n\t\t\tthis._pitchChannelStepper.value = this._doc.song.pitchChannelCount + \"\";\r\n\t\t\tthis._pitchChannelStepper.min = Config.pitchChannelCountMin + \"\";\r\n\t\t\tthis._pitchChannelStepper.max = Config.pitchChannelCountMax + \"\";\r\n\t\t\t\r\n\t\t\tthis._drumChannelStepper.value = this._doc.song.drumChannelCount + \"\";\r\n\t\t\tthis._drumChannelStepper.min = Config.drumChannelCountMin + \"\";\r\n\t\t\tthis._drumChannelStepper.max = Config.drumChannelCountMax + \"\";\r\n\t\t\t\r\n\t\t\tthis._okayButton.addEventListener(\"click\", this._saveChanges);\r\n\t\t\tthis._cancelButton.addEventListener(\"click\", this._close);\r\n\t\t\tthis._beatsStepper.addEventListener(\"keypress\", SongDurationPrompt._validateKey);\r\n\t\t\tthis._barsStepper.addEventListener(\"keypress\", SongDurationPrompt._validateKey);\r\n\t\t\tthis._patternsStepper.addEventListener(\"keypress\", SongDurationPrompt._validateKey);\r\n\t\t\tthis._instrumentsStepper.addEventListener(\"keypress\", SongDurationPrompt._validateKey);\r\n\t\t\tthis._pitchChannelStepper.addEventListener(\"keypress\", SongDurationPrompt._validateKey);\r\n\t\t\tthis._drumChannelStepper.addEventListener(\"keypress\", SongDurationPrompt._validateKey);\r\n\t\t\tthis._beatsStepper.addEventListener(\"blur\", SongDurationPrompt._validateNumber);\r\n\t\t\tthis._barsStepper.addEventListener(\"blur\", SongDurationPrompt._validateNumber);\r\n\t\t\tthis._patternsStepper.addEventListener(\"blur\", SongDurationPrompt._validateNumber);\r\n\t\t\tthis._instrumentsStepper.addEventListener(\"blur\", SongDurationPrompt._validateNumber);\r\n\t\t\tthis._pitchChannelStepper.addEventListener(\"blur\", SongDurationPrompt._validateNumber);\r\n\t\t\tthis._drumChannelStepper.addEventListener(\"blur\", SongDurationPrompt._validateNumber);\r\n\t\t}\r\n\t\t\r\n\t\tprivate _close = (): void => { \r\n\t\t\tthis._doc.undo();\r\n\t\t}\r\n\t\t\r\n\t\tpublic cleanUp = (): void => { \r\n\t\t\tthis._okayButton.removeEventListener(\"click\", this._saveChanges);\r\n\t\t\tthis._cancelButton.removeEventListener(\"click\", this._close);\r\n\t\t\tthis._beatsStepper.removeEventListener(\"keypress\", SongDurationPrompt._validateKey);\r\n\t\t\tthis._barsStepper.removeEventListener(\"keypress\", SongDurationPrompt._validateKey);\r\n\t\t\tthis._patternsStepper.removeEventListener(\"keypress\", SongDurationPrompt._validateKey);\r\n\t\t\tthis._instrumentsStepper.removeEventListener(\"keypress\", SongDurationPrompt._validateKey);\r\n\t\t\tthis._pitchChannelStepper.removeEventListener(\"keypress\", SongDurationPrompt._validateKey);\r\n\t\t\tthis._drumChannelStepper.removeEventListener(\"keypress\", SongDurationPrompt._validateKey);\r\n\t\t\tthis._beatsStepper.removeEventListener(\"blur\", SongDurationPrompt._validateNumber);\r\n\t\t\tthis._barsStepper.removeEventListener(\"blur\", SongDurationPrompt._validateNumber);\r\n\t\t\tthis._patternsStepper.removeEventListener(\"blur\", SongDurationPrompt._validateNumber);\r\n\t\t\tthis._instrumentsStepper.removeEventListener(\"blur\", SongDurationPrompt._validateNumber);\r\n\t\t\tthis._pitchChannelStepper.removeEventListener(\"blur\", SongDurationPrompt._validateNumber);\r\n\t\t\tthis._drumChannelStepper.removeEventListener(\"blur\", SongDurationPrompt._validateNumber);\r\n\t\t}\r\n\t\t\r\n\t\tprivate static _validateKey(event: KeyboardEvent): boolean {\r\n\t\t\tconst charCode = (event.which) ? event.which : event.keyCode;\r\n\t\t\tif (charCode != 46 && charCode > 31 && (charCode < 48 || charCode > 57)) {\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t\r\n\t\tprivate static _validateNumber(event: Event): void {\r\n\t\t\tconst input: HTMLInputElement = <HTMLInputElement>event.target;\r\n\t\t\tinput.value = Math.floor(Math.max(Number(input.min), Math.min(Number(input.max), Number(input.value)))) + \"\";\r\n\t\t}\r\n\t\t\r\n\t\tprivate static _validate(input: HTMLInputElement): number {\r\n\t\t\treturn Math.floor(Number(input.value));\r\n\t\t}\r\n\t\t\r\n\t\tprivate _saveChanges = (): void => {\r\n\t\t\tconst group: ChangeGroup = new ChangeGroup();\r\n\t\t\tgroup.append(new ChangeBeatsPerBar(this._doc, SongDurationPrompt._validate(this._beatsStepper)));\r\n\t\t\tgroup.append(new ChangeBarCount(this._doc, SongDurationPrompt._validate(this._barsStepper)));\r\n\t\t\tgroup.append(new ChangePatternsPerChannel(this._doc, SongDurationPrompt._validate(this._patternsStepper)));\r\n\t\t\tgroup.append(new ChangeInstrumentsPerChannel(this._doc, SongDurationPrompt._validate(this._instrumentsStepper)));\r\n\t\t\tgroup.append(new ChangeChannelCount(this._doc, SongDurationPrompt._validate(this._pitchChannelStepper), SongDurationPrompt._validate(this._drumChannelStepper)));\r\n\t\t\tthis._doc.prompt = null;\r\n\t\t\tthis._doc.record(group, true);\r\n\t\t}\r\n\t}\r\n\r\n","/*\r\nCopyright (C) 2018 John Nesky\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of \r\nthis software and associated documentation files (the \"Software\"), to deal in \r\nthe Software without restriction, including without limitation the rights to \r\nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \r\nof the Software, and to permit persons to whom the Software is furnished to do \r\nso, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all \r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \r\nSOFTWARE.\r\n*/\r\n\r\nimport { HTML} from \"imperative-html/dist/esm/elements-strict\";\r\nimport { Prompt } from \"./Prompt\";\r\nimport { SongDocument } from \"./SongDocument\";\r\n\tconst {button, div, a} = HTML;\r\n\r\n\texport class InstrumentTypePrompt implements Prompt {\r\n\t\tprivate readonly _cancelButton: HTMLButtonElement = button({}, [div(\"Close\")]);\r\n\t\t\r\n\t\tpublic readonly container: HTMLDivElement = div({class: \"prompt\", style: \"width: 300px;\"}, [\r\n\t\t\tdiv({style: \"font-size: 2em\"}, [div(\"FM Synthesis\")]),\r\n\t\t\tdiv({ style: \"text-align: left; margin: 0.5em 0;\" }, [\r\n\t\t\t\tdiv('Popularized by the Sega Genesis and Yamaha keyboards, FM Synthesis is a mysterious but powerful technique for crafting sounds. It may seem confusing, but just play around with the options until you get a feel for it, check out some examples in '),\r\n\t\t\t\ta( { target: \"_blank\", href: \"#6n10s0kbl00e07t5m0a7g07j7i7r1o2T1d2c0A0F1B0V1Q0200Pff00E0411T1d1c0A0F0B0V1Q2800Pf700E0711T1d2c0A0F1B4VaQ0200Pfb00E0911T1d1c2A0F9B3V1Q1000Pfbc0E0191T1d2c0AcF8B5V1Q0259PffffE0000T1d3c1AcF4B5V4Q2600Pff00E0011T1d1c0AbF0B0V1Q2580PfffaE2226T1d1c0A1F0B0V1Q520dPff4dEd41eb4zhmu0p21h5dfxd7ij7XrjfiAjPudUTtUSRsTzudTudJvdUTztTzrpPudUTtUSSYTzudTudJTdUTztTzrvPudUTtUSQ\" }, [div(\"this demo\")]),\r\n\t\t\t\tdiv(\", or find some instruments to use in the Beepbox Discord's FM sheet \"),\r\n\t\t\t\ta( { target: \"_blank\", href: \"https://docs.google.com/spreadsheets/d/1ddbXnrP7yvv5X4oUur9boi3AxcI-Xxz1XIHIAo-wi0s/edit#gid=230623845\" }, [div(\"right here\")]),\r\n\t\t\t\tdiv(\".\")\r\n\t\t\t]),\r\n\t\t\tdiv({style: \"text-align: left; margin: 0.5em 0;\"}, [div(\r\n\t\t\t\t'This FM instrument uses up to four waves, numbered 1, 2, 3, and 4. ' +\r\n\t\t\t\t'Each wave may have its own frequency, volume, and volume envelope to control its effect over time. '\r\n\t\t\t)]),\r\n\t\t\tdiv({style: \"text-align: left; margin: 0.5em 0;\"}, [div(\r\n\t\t\t\t'There are two kinds of waves: \"carrier\" waves play a tone out loud, but \"modulator\" waves distort other waves instead. ' +\r\n\t\t\t\t'Wave 1 is always a carrier and plays a tone, but other waves may distort it. ' +\r\n\t\t\t\t'The \"Algorithm\" setting determines which waves are modulators, and which other waves those modulators distort. '\r\n\t\t\t)]),\r\n\t\t\tdiv({style: \"text-align: left; margin: 0.5em 0;\"}, [div(\r\n\t\t\t\t'Modulators distort in one direction (like 1←2), but you can also use \"Feedback\" to make any wave distort in the opposite direction (1→2), in both directions (1🗘2), or even itself (1⟲). '\r\n\t\t\t)]),\r\n\t\t\tdiv({style: \"text-align: left; margin: 0.5em 0;\"}, [div(\r\n\t\t\t\t'You can set the pitch of each wave independently by adding simultaneous notes, one above another. This often sounds harsh or dissonant, but can make cool sound effects! '\r\n\t\t\t)]),\r\n\t\t\tthis._cancelButton,\r\n\t\t]);\r\n\t\t\r\n\t\tconstructor(private _doc: SongDocument) {\r\n\t\t\tthis._cancelButton.addEventListener(\"click\", this._close);\r\n\t\t}\r\n\t\t\r\n\t\tprivate _close = (): void => { \r\n\t\t\tthis._doc.undo();\r\n\t\t}\r\n\t\t\r\n\t\tpublic cleanUp = (): void => { \r\n\t\t\tthis._cancelButton.removeEventListener(\"click\", this._close);\r\n\t\t}\r\n\t}\r\n\r\n","/*\r\nCopyright (C) 2018 John Nesky\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of \r\nthis software and associated documentation files (the \"Software\"), to deal in \r\nthe Software without restriction, including without limitation the rights to \r\nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \r\nof the Software, and to permit persons to whom the Software is furnished to do \r\nso, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all \r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \r\nSOFTWARE.\r\n*/\r\n\r\nimport { HTML } from \"imperative-html/dist/esm/elements-strict\";\r\nimport { SongDocument } from \"./SongDocument\";\r\nimport { Prompt } from \"./Prompt\";\r\nimport { ColorConfig } from \"./ColorConfig\"; \r\n\tconst {button, div, form, label, input } = HTML;\r\n\r\n\texport class ThemePrompt implements Prompt {\r\n\t\tpublic hasChanged = false;\r\n\t\tprivate readonly _closeButton: HTMLButtonElement = button({style:\"flex: 1; width: 0;\"},\"Close\");\r\n\t\tprivate readonly _previewButton: HTMLButtonElement = button({style:\"flex: 1; width: 0;\"},\"Preview\");\r\n\t\tprivate readonly _previewText: HTMLDivElement = div({style:\"opacity: 0; position:absolute; left: 8px; top: 24px; font-size: 32px; font-weight:bold;\"},\"Previewing...\")\r\n\t\tpublic readonly previewExit: HTMLDivElement = div({style: \"width: 100vw; height: 100vh; position: fixed; left: 0; top: -2vh; display: flex; pointer-events: none;\"},this._previewText);\r\n\t\t\r\n\t\tprivate _form: HTMLFormElement = form({style: \"display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; max-height:265px; overflow-y: scroll; overflow-x: hidden;\"},\r\n\t\t\tlabel({title:\"Default\", class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"default\", style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #606060; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Default\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"NepBox\", class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"nepbox\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #9150ff; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"NepBox\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Laffey\", class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"laffey\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #dbbeed; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Laffey\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"ModBox 2.0\", class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"modbox2\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #c4ffa3; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"ModBox 2.0\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Artic\", class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"artic\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #a5eeff; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Artic\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Cinnamon Roll [!]\", class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"Cinnamon Roll\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #f5bb00; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"CinnaBun [!]\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Ocean\", class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"Ocean\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #4449a3; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Ocean\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Rainbow [!]\", class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"rainbow\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: linear-gradient(140deg, #faa, #ffceaa, #ffdfaa, #fff5aa, #e8ffaa, #bfffb2, #b2ffc8, #b2ffe4, #b2b3ff, #e0b2ff, #ffafe9); border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Rainbow [!]\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Float\", class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"float\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: linear-gradient(140deg, #fff, #282828); border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Float [!]\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({ title:\"Windows\", class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"windows\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #295294; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Windows\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Grassland\",class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"grassland\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #74bc21; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Grassland\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Dessert\",class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"dessert\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #fffc5b; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Dessert\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Kahootiest\",class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"kahootiest\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #864cbf; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Kahoot\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Beam to the Bit [!]\",class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"beambit\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #fa0103; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Beambit [!]\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Pretty Egg\",class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"egg\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #ffb1f4; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Pretty Egg\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Poniryoshka\",class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"Poniryoshka\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #dabbe6; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Poni\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Gameboy [!]\",class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"gameboy\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #306230; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Gameboy [!]\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Woodkid\",class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"woodkid\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #41323b; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Woodkid\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Midnight\",class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"midnight\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #445566; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Midnight\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Snedbox\",class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"snedbox\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #10997e; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Snedbox\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"unnamed\",class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"unnamed\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #ffffa0; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"unnamed\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Piano\",class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"piano\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #bfbfbf; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Piano [!]\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Halloween\",class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"halloween\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #914300; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Halloween\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"FrozenOver❄️\",class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"frozen\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #99c8ef; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Frozen\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t);\r\n\t\t\r\n\t\t\r\n\t\tpublic readonly themeContainer: HTMLDivElement = div({class: \"prompt\", style: \"width: 330px; max-height: 600px;\"}, \r\n                div({ style: \"font-size: 2em\" }, div(\"Themes\")),\r\n\t\t\t\tthis._form,\r\n\t\t\t\tdiv({style:\"display:flex; flex-direction:row; width:100%; gap: 16px;\"},\r\n\t\t\tthis._previewButton,\r\n\t\t\tthis._closeButton),\r\n        );\r\n\t\tpublic readonly container: HTMLDivElement = div({}, \r\n\t\t\tthis.themeContainer,\r\n\t\t\tthis.previewExit,\r\n        );\r\n\r\n\t\t\tconstructor(private _doc: SongDocument) {\r\n\t\t\t\tthis._closeButton.addEventListener(\"click\", this._close);\r\n\t\t\t\tthis._previewButton.addEventListener(\"click\", this._previewTheme);\r\n\t\t\t\tthis.previewExit.addEventListener(\"click\", this._exitPreview);\r\n\t\t\t\tthis._form.addEventListener(\"change\", this._themeChange);\r\n\t\t\t\tif (window.localStorage.getItem(\"modboxTheme\") != null) {\r\n\t\t\t\t\t(<any> this._form.elements)[\"theme\"].value = window.localStorage.getItem(\"modboxTheme\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tprivate _close = (): void => { \r\n\t\t\t\tif (this.hasChanged == false) {\r\n\t\t\t\t\tif (window.localStorage.getItem(\"modboxTheme\")){\r\n\t\t\t\t\t\tColorConfig.setTheme(String(window.localStorage.getItem(\"modboxTheme\")));\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tColorConfig.setTheme(\"default\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis._doc.prompt = null;\r\n\t\t\t\t\tthis._doc.undo(); \r\n\t\t\t\t} else {\r\n\t\t\t\t\twindow.localStorage.setItem(\"modboxTheme\", (<any> this._form.elements)[\"theme\"].value);\r\n\t\t\t\t\tthis._doc.prompt = null;\r\n\t\t\t\t\tthis._doc.undo();\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tprivate _themeChange = (): void => {\r\n\t\t\t\tColorConfig.setTheme((<any> this._form.elements)[\"theme\"].value);\r\n\t\t\t\t\r\n\t\t\t\tif ((<any> this._form.elements)[\"theme\"].value != window.localStorage.getItem(\"modboxTheme\")) {\r\n\t\t\t\tthis.hasChanged = true;\r\n\t\t\t\tthis._closeButton.innerHTML = \"Save\"; \r\n\t\t\t} else {\r\n\t\t\t\tthis.hasChanged = false;\r\n\t\t\t\tthis._closeButton.innerHTML = \"Cancel\"; \r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tprivate _previewTheme = (): void => { \r\n\t\t\t\tthis.themeContainer.style.opacity = \"0\";\r\n\t\t\t\tthis.previewExit.style.pointerEvents = \"\";\r\n\t\t\t\tthis._previewText.style.opacity = \"1\";\r\n\t\t\t}\r\n\r\n\t\t\tprivate _exitPreview = (): void => { \r\n\t\t\t\tthis.themeContainer.style.opacity = \"1\";\r\n\t\t\t\tthis.previewExit.style.pointerEvents = \"none\";\r\n\t\t\t\tthis._previewText.style.opacity = \"0\";\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tpublic cleanUp = (): void => { \r\n\t\t\t\tthis._closeButton.removeEventListener(\"click\", this._close);\r\n            };\r\n    }\r\n","/*\r\nCopyright (C) 2018 John Nesky\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of \r\nthis software and associated documentation files (the \"Software\"), to deal in \r\nthe Software without restriction, including without limitation the rights to \r\nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \r\nof the Software, and to permit persons to whom the Software is furnished to do \r\nso, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all \r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \r\nSOFTWARE.\r\n*/\r\n\r\nimport { HTML } from \"imperative-html/dist/esm/elements-strict\";\r\nimport { SongDocument } from \"./SongDocument\";\r\nimport { Prompt } from \"./Prompt\";\r\nimport { ColorConfig } from \"./ColorConfig\"; \r\nimport { ChangeSongTheme } from \"./changes\";\r\n\tconst {button, div, form, label, input } = HTML;\r\n\r\n\texport class SongThemePrompt implements Prompt {\r\n\t\tpublic hasChanged = false;\r\n\t\tprivate readonly _closeButton: HTMLButtonElement = button({style:\"flex: 1; width: 0;\"},\"Close\");\r\n\t\tprivate readonly _previewButton: HTMLButtonElement = button({style:\"flex: 1; width: 0;\"},\"Preview\");\r\n\t\tprivate readonly _previewText: HTMLDivElement = div({style:\"opacity: 0; position:absolute; left: 8px; top: 24px; font-size: 32px; font-weight:bold;\"},\"Previewing...\")\r\n\t\tpublic readonly previewExit: HTMLDivElement = div({style: \"width: 100vw; height: 100vh; position: fixed; left: 0; top: -2vh; display: flex; pointer-events: none;\"},this._previewText);\r\n\t\t\r\n\t\tprivate _form: HTMLFormElement = form({style: \"display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; max-height:265px; overflow-y: scroll; overflow-x: hidden;\"},\r\n\t\t\tlabel({title:\"None\", class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"none\", style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background:rgb(0, 0, 0); border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"None\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Default\", class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"default\", style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #606060; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Default\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Laffey\", class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"laffey\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #dbbeed; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Laffey\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"NepBox\", class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"nepbox\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #9150ff; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"NepBox\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"ModBox 2.0\", class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"modbox2\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #c4ffa3; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"ModBox 2.0\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Artic\", class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"artic\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #a5eeff; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Artic\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Cinnamon Roll [!]\", class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"Cinnamon Roll\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #f5bb00; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"CinnaBun [!]\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Ocean\", class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"Ocean\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #4449a3; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Ocean\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Rainbow [!]\", class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"rainbow\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: linear-gradient(140deg, #faa, #ffceaa, #ffdfaa, #fff5aa, #e8ffaa, #bfffb2, #b2ffc8, #b2ffe4, #b2b3ff, #e0b2ff, #ffafe9); border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Rainbow [!]\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Float\", class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"float\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: linear-gradient(140deg, #fff, #282828); border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Float [!]\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({ title:\"Windows\", class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"windows\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #295294; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Windows\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Grassland\",class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"grassland\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #74bc21; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Grassland\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Dessert\",class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"dessert\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #fffc5b; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Dessert\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Kahootiest\",class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"kahootiest\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #864cbf; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Kahoot\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Beam to the Bit [!]\",class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"beambit\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #fa0103; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Beambit [!]\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Pretty Egg\",class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"egg\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #ffb1f4; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Pretty Egg\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Poniryoshka\",class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"Poniryoshka\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #dabbe6; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Poni\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Gameboy [!]\",class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"gameboy\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #306230; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Gameboy [!]\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Woodkid\",class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"woodkid\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #41323b; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Woodkid\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Midnight\",class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"midnight\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #445566; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Midnight\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Snedbox\",class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"snedbox\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #10997e; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Snedbox\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"unnamed\",class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"unnamed\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #ffffa0; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"unnamed\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Piano\",class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"piano\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #bfbfbf; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Piano [!]\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"Halloween\",class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"halloween\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #914300; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Halloween\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tlabel({title:\"FrozenOver❄️\",class: \"theme-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"theme\", value: \"frozen\",style:\"display:none;\"}),\r\n\t\t\t\tdiv({style:\"display: flex; flex-direction: column; gap: 3px; align-items: center;\"},\r\n\t\t\t\t\tdiv({style:\"background: black; width: 64px; height: 64px; border-radius: 35px; border: solid; border-color:currentColor; display: flex; align-items: center; justify-content: center;\"},\r\n\t\t\t\t\t\tdiv({style:\"width: 58px; height: 58px; background: #99c8ef; border-radius: 35px;\"}),\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({style:\"text-wrap:wrap; max-width: 64px; color:currentColor;\"},\"Frozen\"),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t);\r\n\t\t\r\n\t\t\r\n\t\tpublic readonly themeContainer: HTMLDivElement = div({class: \"prompt\", style: \"width: 330px; max-height: 600px;\"}, \r\n                div({ style: \"font-size: 2em\" }, div(\"Song Themes\")),\r\n\t\t\t\tthis._form,\r\n\t\t\t\tdiv({style:\"display:flex; flex-direction:row; width:100%; gap: 16px;\"},\r\n\t\t\tthis._previewButton,\r\n\t\t\tthis._closeButton),\r\n        );\r\n\t\tpublic readonly container: HTMLDivElement = div({}, \r\n\t\t\tthis.themeContainer,\r\n\t\t\tthis.previewExit,\r\n        );\r\n\r\n\t\t\tconstructor(private _doc: SongDocument) {\r\n\t\t\t\tthis._closeButton.addEventListener(\"click\", this._close);\r\n\t\t\t\tthis._previewButton.addEventListener(\"click\", this._previewTheme);\r\n\t\t\t\tthis.previewExit.addEventListener(\"click\", this._exitPreview);\r\n\t\t\t\tthis._form.addEventListener(\"change\", this._themeChange);\r\n\t\t\t\tif (this._doc.song.setSongTheme != \"none\") {\r\n\t\t\t\t\t(<any> this._form.elements)[\"theme\"].value = this._doc.song.setSongTheme;\r\n\t\t\t\t} else {\r\n\t\t\t\t\t(<any> this._form.elements)[\"theme\"].value = \"none\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tprivate _close = (): void => { \r\n\t\t\t\tif (this.hasChanged == false) {\r\n\t\t\t\t\tif (this._doc.song.setSongTheme == \"none\") {\r\n\t\t\t\t\t\tif (window.localStorage.getItem(\"modboxTheme\")){\r\n\t\t\t\t\t\t\tColorConfig.setTheme(String(window.localStorage.getItem(\"modboxTheme\")));\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tColorConfig.setTheme(\"default\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tColorConfig.setTheme(this._doc.song.setSongTheme)\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis._doc.prompt = null;\r\n\t\t\t\t\tthis._doc.undo(); \r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis._doc.prompt = null;\r\n\t\t\t\t\tthis._doc.record(new ChangeSongTheme(this._doc, this._doc.song.setSongTheme, (<any> this._form.elements)[\"theme\"].value), true);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tprivate _themeChange = (): void => {\r\n\t\t\t\tif ((<any> this._form.elements)[\"theme\"].value != \"none\") {\r\n\t\t\t\tColorConfig.setTheme((<any> this._form.elements)[\"theme\"].value);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (window.localStorage.getItem(\"modboxTheme\")){\r\n\t\t\t\t\t\tColorConfig.setTheme(String(window.localStorage.getItem(\"modboxTheme\")));\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tColorConfig.setTheme(\"default\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif ((<any> this._form.elements)[\"theme\"].value != this._doc.song.setSongTheme) {\r\n\t\t\t\tthis.hasChanged = true;\r\n\t\t\t\tthis._closeButton.innerHTML = \"Save\"; \r\n\t\t\t} else {\r\n\t\t\t\tthis.hasChanged = false;\r\n\t\t\t\tthis._closeButton.innerHTML = \"Cancel\"; \r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tprivate _previewTheme = (): void => { \r\n\t\t\t\tthis.themeContainer.style.opacity = \"0\";\r\n\t\t\t\tthis.previewExit.style.pointerEvents = \"\";\r\n\t\t\t\tthis._previewText.style.opacity = \"1\";\r\n\t\t\t}\r\n\r\n\t\t\tprivate _exitPreview = (): void => { \r\n\t\t\t\tthis.themeContainer.style.opacity = \"1\";\r\n\t\t\t\tthis.previewExit.style.pointerEvents = \"none\";\r\n\t\t\t\tthis._previewText.style.opacity = \"0\";\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tpublic cleanUp = (): void => { \r\n\t\t\t\tthis._closeButton.removeEventListener(\"click\", this._close);\r\n            };\r\n    }\r\n","// Copyright (c) 2012-2022 John Nesky and contributing authors, distributed under the MIT license, see accompanying the LICENSE.md file.\r\n\r\nimport {HTML} from \"imperative-html/dist/esm/elements-strict\";\r\n//import {ColorConfig} from \"./ColorConfig\";\r\n\r\n// check SongEditor.ts for these\r\n//const fullLayoutColumns = window.localStorage.getItem(\"advancedSettings\") ? \"minmax(0, 1fr) 190px 200px\" : \"minmax(0, 1fr) 190px\";\r\n//const middleLayoutColumns = window.localStorage.getItem(\"advancedSettings\") ? \"190px minmax(0, 1fr) 200px\" : \"190px minmax(0, 1fr)\";\r\n\r\n\r\n\r\nexport class Layout {\r\n\tprivate static readonly _layoutMap: {[K: string]: string} = {\r\n\t\t\"small\": \"\",\r\n\r\n\t\t// Full\r\n\r\n\t\t\"full\": `\\\r\n\t\tbody {\r\n\t\t\tmargin: 0;\r\n\t\t}\r\n\r\n\t\t.centerDiv {\r\n\t\t\twidth: unset !important;\r\n\t\t}\r\n\r\n\t\t#beepboxEditorContainer {\r\n\t\t\twidth: 100% !important;\r\n\t\t\theight: 100vh !important;\r\n\t\t}\r\n\t\t\r\n\t\t.modTitle {\r\n\t\tdisplay: none;\r\n\t\t}\r\n\r\n\t\t.beepboxEditor {\r\n\t\t\twidth: 100%;\r\n\t\t\theight: 100vh;\r\n\t\t\tgrid-template-columns: var(--full-layout-columns);\r\n\t\t\tgrid-template-rows: minmax(0px, min-content) minmax(0px, 1fr) minmax(0, min-content);\r\n\t\t\toverflow-y: hidden;\r\n\t\t}\r\n\r\n\t\t.editorBox {\r\n\t\t\theight: unset !important;\r\n\t\t}\r\n\r\n\t\t.trackContainer {\r\n\t\t\twidth: unset !important;\r\n\t\t\toverflow-x: scroll !important;\r\n\t\t}\r\n\r\n\t\t.beepboxEditor .trackAndMuteContainer {\r\n\t\t\twidth: 100%;\r\n\t\t\tmin-height: 0;\r\n\t\t\tflex: 1;\r\n\t\t\toverflow: auto;\r\n\t\t}\r\n\r\n\t\t.trackArea {\r\n\t\t\toverflow-y: scroll;\r\n\t\t}\r\n\r\n\t\t.barScrollBar {\r\n\t\t\tdisplay: none !important;\r\n\t\t}\r\n\t\t`,\r\n\r\n\t\t// Middle\r\n\r\n\t\t\"middle\": `\\\r\n\t\t\t\tbody {\r\n\t\t\tmargin: 0;\r\n\t\t}\r\n\r\n\t\t.centerDiv {\r\n\t\t\twidth: unset !important;\r\n\t\t}\r\n\r\n\t\t.modTitle {\r\n\t\tdisplay: none;\r\n\t\t}\r\n\r\n\t\t#beepboxEditorContainer {\r\n\t\t\twidth: 100% !important;\r\n\t\t\theight: 100vh !important;\r\n\t\t}\r\n\t\t\r\n\t\t.beepboxEditor {\r\n\t\t\twidth: 100%;\r\n\t\t\theight: 100vh;\r\n\t\t\tgrid-template-areas:\r\n\t\t\t\t\"settings-area      pattern-area  advanced-settings-area\" \r\n\t\t\t\t\"song-settings-area pattern-area  advanced-settings-area\" \r\n\t\t\t\t\"song-settings-area track-area    advanced-settings-area\" !important;\r\n\t\t\tgrid-template-columns: var(--middle-layout-columns);\r\n\t\t\tgrid-template-rows: minmax(0px, min-content) minmax(0px, 1fr) minmax(0, min-content);\r\n\t\t\toverflow-y: hidden;\r\n\t\t}\r\n\r\n\t\t.settings-area {\r\n\t\t\tmargin-left: 0 !important;\r\n\t\t\tmargin-right: 6px !important;\r\n\t\t}\r\n\r\n\t\t.song-settings-area {\r\n\t\t\tmargin-left: 0 !important;\r\n\t\t\tmargin-right: 6px !important;\r\n\t\t}\r\n\r\n\t\t.editorBox {\r\n\t\t\theight: unset !important;\r\n\t\t}\r\n\r\n\t\t.trackContainer {\r\n\t\t\twidth: unset !important;\r\n\t\t\toverflow-x: scroll !important;\r\n\t\t}\r\n\r\n\t\t.trackArea {\r\n\t\t\toverflow-y: scroll;\r\n\t\t}\r\n\r\n\t\t.beepboxEditor .trackAndMuteContainer {\r\n\t\t\twidth: 100%;\r\n\t\t\tmin-height: 0;\r\n\t\t\tflex: 1;\r\n\t\t\toverflow: auto;\r\n\t\t}\r\n\r\n\t\t.barScrollBar {\r\n\t\t\tdisplay: none !important;\r\n\t\t}\r\n\t\t`,\r\n\r\n\t\t// Flow\r\n\r\n\t\t\"flow\": `\\\r\n\t\tbody {\r\n\t\t\tmargin: 0;\r\n\t\t}\r\n\r\n\t\t.beepboxEditor {\r\n\t\t\twidth: 100%;\r\n\t\t\theight: 100vh;\r\n\t\t\tgrid-template-areas:\r\n\t\t\t\t\"settings-area settings-area         \" \r\n\t\t\t\t\"song-settings-area     pattern-area\" \r\n\t\t\t\t\"advanced-settings-area pattern-area\"\r\n\t\t\t\t\"advanced-settings-area track-area  \" !important;\r\n\t\t\tgrid-template-columns: 190px minmax(0, 1fr);\r\n\t\t\tgrid-template-rows: minmax(0px, min-content) minmax(0px, min-content) minmax(0px, 1fr);\r\n\t\t\toverflow-y: hidden;\r\n\t\t}\r\n\r\n\r\n\t\t.centerDiv {\r\n\t\t\twidth: unset !important;\r\n\t\t}\r\n\r\n\t\t#beepboxEditorContainer {\r\n\t\t\twidth: 100% !important;\r\n\t\t\theight: 100vh !important;\r\n\t\t}\r\n\t\t\r\n\t\t.modTitle {\r\n\t\tdisplay: none;\r\n\t\t}\r\n\r\n\t\t.editorBox {\r\n\t\t\theight: unset !important;\r\n\t\t}\r\n\r\n\t\t.trackContainer {\r\n\t\t\twidth: unset !important;\r\n\t\t\toverflow-x: scroll !important;\r\n\t\t}\r\n\r\n\t\t.beepboxEditor .trackAndMuteContainer {\r\n\t\t\twidth: 100%;\r\n\t\t\tmin-height: 0;\r\n\t\t\tflex: 1;\r\n\t\t\toverflow: auto;\r\n\t\t}\r\n\r\n\t\t.trackArea {\r\n\t\t\toverflow-y: scroll;\r\n\t\t}\r\n\r\n\t\t.barScrollBar {\r\n\t\t\tdisplay: none !important;\r\n\t\t}\r\n\r\n\t\t.beepboxEditor .editor-settings {\r\n\t\t\tmargin-right: 6px;\r\n\t\t}\r\n\r\n\t\t.settings-area {\r\n\t\t\twidth: 50% !important;\r\n  \t\t\tgap: 3px !important;\r\n\t\t\tflex-direction: row !important;\r\n\t\t}\r\n\r\n\t\t.settings-area .title {\r\n\t\t\tflex: 1;\r\n\t\t}\r\n\r\n\t\t.settings-area .controller {\r\n\t\t\tflex-direction: row-reverse !important;\r\n\t\t\tflex: 3;\r\n\t\t}\r\n\r\n\t\t.settings-area .controller div {\r\n\t\t\tflex: 1;\r\n\t\t}\r\n\r\n\t\t.settings-area .editor-widgets {\r\n\t\t\tflex: 1;\r\n\t\t}\r\n\r\n\t\t.settings-area .editor-widgets .editor-menus {\r\n\t\t\tflex-direction: row;\r\n\t\t\tgap: 3px;\r\n\t\t\tmargin-top: .2em;\r\n\t\t\twidth: 0 !important;\r\n\t\t}\r\n\r\n\t\t.settings-area .editor-widgets .editor-menus .selectContainer {\r\n\t\t\tdisplay: flex;\r\n  \t\t\tjustify-content: center;\r\n\t\t}\r\n\r\n\t\t.settings-area .editor-widgets .editor-menus svg {\r\n\t\t\tleft: unset !important;\r\n\t\t}\r\n\r\n\t\t.settings-area .editor-widgets .editor-menus .selectContainer select {\r\n\t\t\twidth: 0 !important;\r\n\t\t}\r\n\r\n\t\t.beepboxEditor .selectContainer.menu::after {\r\n\t\t\tcontent: none !important;\r\n\t\t}\r\n\t\t`,\r\n\t}\r\n\t\r\n\tprivate static readonly _styleElement: HTMLStyleElement = document.head.appendChild(HTML.style({type: \"text/css\"}));\r\n\t\r\n\tpublic static setLayout(layout: string): void {\r\n\t\tthis._styleElement.textContent = this._layoutMap[layout];\r\n\t}\r\n}\r\n","// Copyright (c) 2012-2022 John Nesky and contributing authors, distributed under the MIT license, see accompanying the LICENSE.md file.\r\n\r\nimport {SongDocument} from \"./SongDocument\";\r\nimport {Layout} from \"./Layout\";\r\nimport {Prompt} from \"./Prompt\";\r\nimport {HTML, SVG} from \"imperative-html/dist/esm/elements-strict\";\r\n\r\nconst {button, label, div, form, input} = HTML;\r\n\r\nexport class LayoutPrompt implements Prompt {\r\n\tprivate readonly _fileInput: HTMLInputElement = input({type: \"file\", accept: \".json,application/json,.mid,.midi,audio/midi,audio/x-midi\"});\r\n\tprivate readonly _okayButton: HTMLButtonElement = button({class: \"okayButton\", style: \"flex:1;\"}, \"Okay\");\r\n\tprivate readonly _cancelButton: HTMLButtonElement = button({style:\"flex: 1; width: 0;\"},\"Cancel\");\r\n\tprivate readonly _form: HTMLFormElement = form({style: \"display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; max-height: 265px; overflow-y: scroll; overflow-x: hidden;\"},\r\n\t\t\tlabel({class: \"layout-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"layout\", value: \"small\"}),\r\n\t\t\t\tSVG(`\\\r\n\t\t\t\t\t<svg viewBox=\"-4 -1 28 22\">\r\n\t\t\t\t\t\t<rect x=\"0\" y=\"0\" width=\"20\" height=\"20\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1\"/>\r\n\t\t\t\t\t\t<rect x=\"2\" y=\"2\" width=\"11\" height=\"10\" fill=\"currentColor\"/>\r\n\t\t\t\t\t\t<rect x=\"14\" y=\"2\" width=\"4\" height=\"16\" fill=\"currentColor\"/>\r\n\t\t\t\t\t\t<rect x=\"2\" y=\"13\" width=\"11\" height=\"5\" fill=\"currentColor\"/>\r\n\t\t\t\t\t</svg>\r\n\t\t\t\t`),\r\n\t\t\t\tdiv(\"Small\"),\r\n\t\t\t),\r\n\t\t\tlabel({class: \"layout-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"layout\", value: \"full\"}),\r\n\t\t\t\tSVG(`\\\r\n\t\t\t\t\t<svg viewBox=\"-1 -1 28 22\">\r\n\t\t\t\t\t\t<rect x=\"0\" y=\"0\" width=\"26\" height=\"20\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1\"/>\r\n\t\t\t\t\t\t<rect x=\"2\" y=\"2\" width=\"12\" height=\"10\" fill=\"currentColor\"/>\r\n\t\t\t\t\t\t<rect x=\"15\" y=\"2\" width=\"4\" height=\"16\" fill=\"currentColor\"/>\r\n\t\t\t\t\t\t<rect x=\"20\" y=\"2\" width=\"4\" height=\"16\" fill=\"currentColor\"/>\r\n\t\t\t\t\t\t<rect x=\"2\" y=\"13\" width=\"12\" height=\"5\" fill=\"currentColor\"/>\r\n\t\t\t\t\t</svg>\r\n\t\t\t\t`),\r\n\t\t\t\tdiv(\"Full\"),\r\n\t\t\t),\r\n\t\t\tlabel({class: \"layout-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"layout\", value: \"middle\"}),\r\n\t\t\t\tSVG(`\\\r\n\t\t\t\t\t<svg viewBox=\"-1 -1 28 22\">\r\n\t\t\t\t\t\t<rect x=\"0\" y=\"0\" width=\"26\" height=\"20\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1\"/>\r\n\t\t\t\t\t\t<rect x=\"7\" y=\"2\" width=\"12\" height=\"10\" fill=\"currentColor\"/>\r\n\t\t\t\t\t\t<rect x=\"2\" y=\"2\" width=\"4\" height=\"16\" fill=\"currentColor\"/>\r\n\t\t\t\t\t\t<rect x=\"20\" y=\"2\" width=\"4\" height=\"16\" fill=\"currentColor\"/>\r\n\t\t\t\t\t\t<rect x=\"7\" y=\"13\" width=\"12\" height=\"5\" fill=\"currentColor\"/>\r\n\t\t\t\t\t</svg>\r\n\t\t\t\t`),\r\n\t\t\t\tdiv(\"Middle\"),\r\n\t\t\t),\r\n\t\t\tlabel({class: \"layout-option\"},\r\n\t\t\t\tinput({type: \"radio\", name: \"layout\", value: \"flow\"}),\r\n\t\t\t\tSVG(`\\\r\n\t\t\t\t\t<svg viewBox=\"-1 -1 28 22\">\r\n\t\t\t\t\t\t<rect x=\"0\" y=\"0\" width=\"26\" height=\"20\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1\"/>\r\n\t\t\t\t\t\t<rect x=\"7\" y=\"5\" width=\"17\" height=\"7\" fill=\"currentColor\"/>\r\n\t\t\t\t\t\t<rect x=\"2\" y=\"2\" width=\"22\" height=\"2\" fill=\"currentColor\"/>\r\n\t\t\t\t\t\t<rect x=\"2\" y=\"5\" width=\"4\" height=\"13\" fill=\"currentColor\"/>\r\n\t\t\t\t\t\t<rect x=\"7\" y=\"13\" width=\"17\" height=\"5\" fill=\"currentColor\"/>\r\n\t\t\t\t\t</svg>\r\n\t\t\t\t`),\r\n\t\t\t\tdiv(\"Flow\"),\r\n\t\t\t),\r\n\t\t);\r\n\t\r\n\tpublic readonly container: HTMLDivElement = div({class: \"prompt noSelection\", style: \"width: 300px;\"},\r\n\t\tdiv({ style: \"font-size: 2em\" }, div(\"Layouts\")),\r\n\t\tthis._form,\r\n\t\tdiv({style: \"display: flex; flex-direction: row; justify-content: space-between; gap: 3px;\"},\r\n\t\t\tthis._cancelButton,\r\n\t\t\tthis._okayButton,\r\n\t\t),\r\n\t);\r\n\t\r\n\tconstructor(private _doc: SongDocument) {\r\n\t\tthis._fileInput.select();\r\n\t\tsetTimeout(()=>this._fileInput.focus());\r\n\t\t\r\n\t\tthis._okayButton.addEventListener(\"click\", this._confirm);\r\n\t\tthis._cancelButton.addEventListener(\"click\", this._close);\r\n\t\tthis.container.addEventListener(\"keydown\", this._whenKeyPressed);\r\n\t\t\r\n\t\t(<any> this._form.elements)[\"layout\"].value = this._doc.prefs.layout;\r\n\t}\r\n\t\r\n\tprivate _close = (): void => { \r\n\t\tthis._doc.undo();\r\n\t}\r\n\t\r\n\tpublic cleanUp = (): void => { \r\n\t\tthis._okayButton.removeEventListener(\"click\", this._confirm);\r\n\t\tthis._cancelButton.removeEventListener(\"click\", this._close);\r\n\t\tthis.container.removeEventListener(\"keydown\", this._whenKeyPressed);\r\n\t}\r\n\t\r\n\tprivate _whenKeyPressed = (event: KeyboardEvent): void => {\r\n\t\tif ((<Element> event.target).tagName != \"BUTTON\" && event.keyCode == 13) { // Enter key\r\n\t\t\tthis._confirm();\r\n\t\t}\r\n\t}\r\n\t\r\n\tprivate _confirm = (): void => { \r\n\t\twindow.localStorage.setItem(\"layout\", (<any> this._form.elements)[\"layout\"].value)\r\n\t\tthis._doc.prefs.layout = (<any> this._form.elements)[\"layout\"].value;\r\n\t\tLayout.setLayout(this._doc.prefs.layout);\r\n\t\tthis._close();\r\n\t}\r\n}\r\n","/*\r\nCopyright (C) 2018 John Nesky\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of \r\nthis software and associated documentation files (the \"Software\"), to deal in \r\nthe Software without restriction, including without limitation the rights to \r\nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \r\nof the Software, and to permit persons to whom the Software is furnished to do \r\nso, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all \r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \r\nSOFTWARE.\r\n*/\r\n\r\nimport {Prompt} from \"./Prompt\";\r\nimport { SongDocument } from \"./SongDocument\";\r\nimport {Change} from \"./Change\";\r\nimport {PatternEditor} from \"./PatternEditor\";\r\nimport { HTML, SVG } from \"imperative-html/dist/esm/elements-strict\";\r\nimport { Channel, Instrument, Note, Pattern } from \"../synth/song\";\r\nimport { InstrumentType, Config } from \"../synth/SynthConfig\";\r\nimport { TrackEditor } from \"./TrackEditor\";\r\nimport { LoopEditor } from \"./LoopEditor\";\r\nimport { BarScrollBar } from \"./BarScrollBar\";\r\nimport { OctaveScrollBar } from \"./OctaveScrollBar\";\r\nimport { Piano } from \"./Piano\";\r\nimport { ChangeInsertBars, ChangeTransition, ChangeAlgorithm, ChangeBlend, ChangeChannelBar, ChangeChorus, ChangeDetune, ChangeEffect,ChangeFMChorus, ChangeFeedbackAmplitude, ChangeFeedbackEnvelope, ChangeFeedbackType, ChangeFilter, ChangeHarm, ChangeImute, ChangeInstrumentType, ChangeIpan, ChangeKey,  ChangeMix, ChangeMuff, ChangeOctoff, ChangeOperatorAmplitude, ChangeOperatorEnvelope, ChangeOperatorFrequency, ChangePartsPerBeat, ChangePaste, ChangePatternInstrument, ChangeReverb, ChangeRiff, ChangeSampleRate, ChangeScale, ChangeSong, ChangeTempo, ChangeTranspose, ChangeVolume, ChangeWave, ChangeDeleteBars, ChangeRemoveChannel, ChangeEnsurePatternExists } from \"./changes\";\r\nimport { MixPrompt} from \"./MixPrompt\";\r\nimport { ChorusPrompt } from \"./ChorusPrompt\";\r\nimport { ExportPrompt } from \"./ExportPrompt\";\r\nimport { ImportPrompt } from \"./ImportPrompt\";\r\nimport { ArchivePrompt } from \"./ArchivePrompt\";\r\nimport { SongDataPrompt } from \"./SongDataPrompt\";\r\nimport { RefreshKeyPrompt } from \"./RefreshKeyPrompt\";\r\nimport { SongDurationPrompt } from \"./SongDurationPrompt\";\r\nimport { InstrumentTypePrompt } from \"./InstrumentTypePrompt\";\r\nimport { ThemePrompt } from \"./ThemePrompt\";\r\nimport { SongThemePrompt } from \"./SongThemePrompt\";\r\nimport { LayoutPrompt } from \"./LayoutPrompt\";\r\nimport { ColorConfig } from \"./ColorConfig\"; \r\n\r\nconst {button, div, span, select, option, input, a} = HTML;\r\n\t\r\n\texport const isMobile: boolean = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|android|ipad|playbook|silk/i.test(navigator.userAgent);\r\n\t\r\n\tlet songThemeSet = \"none\";\r\n\r\n\tfunction buildOptions(menu: HTMLSelectElement, items: ReadonlyArray<string | number>): HTMLSelectElement {\r\n\t\tfor (let index: number = 0; index < items.length; index++) {\r\n\t\t\tmenu.appendChild(option({value: index}, items[index]));\r\n\t\t}\r\n\t\treturn menu;\r\n\t}\r\n\t\r\n\tfunction buildOptionsWithSpecificValues(menu: HTMLSelectElement, items: ReadonlyArray<string | number>, values: ReadonlyArray<string | number>): HTMLSelectElement {\r\n\t\tif (items.length != values.length) {\r\n\t\t\tthrow new Error(\"items and values don't have the same length\");\r\n\t\t}\r\n\t\tfor (let i: number = 0; i < items.length; i++) {\r\n\t\t\tconst item: string | number = items[i];\r\n\t\t\tconst value: string | number = values[i];\r\n\t\t\tmenu.appendChild(option({value:value}, item));\r\n\t\t}\r\n\t\treturn menu;\r\n\t}\r\n\t\r\n\tfunction setSelectedIndex(menu: HTMLSelectElement, index: number): void {\r\n\t\tif (menu.selectedIndex != index) menu.selectedIndex = index;\r\n\t}\r\n\r\n\tfunction setSelectedValue(menu: HTMLInputElement, index: string): void {\r\n\t\tif (menu.value != index) menu.value = index;\r\n\t}\r\n\t\r\n\tinterface PatternCopy {\r\n\t\tnotes: Note[];\r\n\t\tbeatsPerBar: number;\r\n\t\tpartsPerBeat: number;\r\n\t\tdrums: boolean;\r\n\t}\r\n\t\r\n\tclass Slider {\r\n\t\tprivate _change: Change | null = null;\r\n\t\tprivate _value: number = 0;\r\n\t\tprivate _oldValue: number = 0;\r\n\t\t\r\n\t\tconstructor(public readonly input: HTMLInputElement, private readonly _doc: SongDocument, private readonly _getChange: (oldValue: number, newValue: number)=>Change) {\r\n\t\t\tinput.addEventListener(\"input\", this._whenInput);\r\n\t\t\tinput.addEventListener(\"change\", this._whenChange);\r\n\t\t}\r\n\t\t\r\n\t\tpublic updateValue(value: number): void {\r\n\t\t\tthis._value = value;\r\n\t\t\tthis.input.value = String(value);\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenInput = (): void => {\r\n\t\t\tconst continuingProspectiveChange: boolean = this._doc.lastChangeWas(this._change);\r\n\t\t\tif (!continuingProspectiveChange) this._oldValue = this._value;\r\n\t\t\tthis._change = this._getChange(this._oldValue, parseInt(this.input.value));\r\n\t\t\tthis._doc.setProspectiveChange(this._change);\r\n\t\t};\r\n\t\t\r\n\t\tprivate _whenChange = (): void => {\r\n\t\t\tthis._doc.record(this._change!);\r\n\t\t\tthis._change = null;\r\n\t\t};\r\n\t}\r\n\t\r\n\texport class SongEditor {\r\n\t\tpublic prompt: Prompt | null = null;\r\n\t\t\r\n\t\tpublic readonly _patternEditor: PatternEditor = new PatternEditor(this._doc);\r\n\t\tprivate readonly _trackEditor: TrackEditor = new TrackEditor(this._doc);\r\n\t\tprivate readonly _loopEditor: LoopEditor = new LoopEditor(this._doc);\r\n\t\tprivate readonly _trackContainer: HTMLDivElement = div({class: \"trackContainer\"}, \r\n\t\t\tthis._trackEditor.container,\r\n\t\t\tthis._loopEditor.container,\r\n\t\t);\r\n\t\tprivate readonly _trackVisibleArea: HTMLDivElement = div({style: \"position: absolute; width: 100%; height: 100%; pointer-events: none;\"});\r\n\t\tprivate readonly _barScrollBar: BarScrollBar = new BarScrollBar(this._doc, this._trackContainer);\r\n\t\tprivate readonly _octaveScrollBar: OctaveScrollBar = new OctaveScrollBar(this._doc);\r\n\t\tprivate readonly _piano: Piano = new Piano(this._doc);\r\n\t\tprivate readonly _editorBox: HTMLDivElement = div({class: \"editorBox\", style: \"height: 481px; display: flex; flex-direction: row; margin-bottom: 6px;\"}, \r\n\t\t\t\tthis._piano.container,\r\n\t\t\t\tthis._patternEditor.container,\r\n\t\t\t\tthis._octaveScrollBar.container,\r\n\t\t);\r\n\t\t//private readonly _trackVisibleArea: HTMLDivElement = div({style: \"position: absolute; width: 100%; height: 100%; pointer-events: none;\"});\r\n\t\tprivate readonly _trackAndMuteContainer: HTMLDivElement = div({class: \"trackAndMuteContainer prefers-big-scrollbars\"},\r\n\t\t\tthis._trackContainer,\r\n\t\t\tthis._trackVisibleArea,\r\n\t\t);\r\n\t\tprivate readonly _trackEditorBox: HTMLDivElement = div({class:\"track-area\"}, \r\n\t\t\tthis._trackAndMuteContainer,\r\n\t\t\tthis._barScrollBar.container,\r\n\t\t);\r\n\t\tprivate readonly _playButton: HTMLButtonElement = button({style: \"width:0; flex:2;\", type: \"button\"});\r\n\t\tprivate readonly _prevBarButton: HTMLButtonElement = button({class: \"prevBarButton\", style: \"width: 0; margin: 0px; flex:1; margin-left: 0px;\", type: \"button\", title: \"Prev Bar (left bracket)\"});\r\n\t\tprivate readonly _nextBarButton: HTMLButtonElement = button({class: \"nextBarButton\", style: \"width: 0; margin: 0px; flex:1; margin-left: 0px;\", type: \"button\", title: \"Next Bar (right bracket)\"});\r\n\t\tprivate readonly _volumeSlider: HTMLInputElement = input({title: \"main volume\", style: \"flex:1; margin: 0px;\", type: \"range\", min: \"0\", max: \"100\", value: \"50\", step: \"1\"});\r\n\t\tprivate readonly _fileMenu: HTMLSelectElement = select({style: \"width: 100%;\"}, \r\n\t\t\toption({selected: true, disabled: true, hidden: false}, \"File Menu\"),\r\n\t\t\toption({value: \"cleanS\"}, \"New Song\"),\r\n\t\t\toption({value: \"import\"}, \"Import JSON...\"),\r\n\t\t\toption({value: \"export\"}, \"Export Song...\"),\r\n\t\t\toption({value: \"shortenUrl\"}, \"Shorten Song Url...\"),\r\n\t\t\toption({value: \"songdata\"}, \"Song Data...\"),\r\n\t\t\toption({value: \"manual\"}, \"Open Manual...\"),\r\n\t\t);\r\n\t\tprivate readonly _editMenu: HTMLSelectElement = select({style: \"width: 100%;\"}, \r\n\t\t\toption({selected: true, disabled: true, hidden: false}, \"Edit Menu\"),\r\n\t\t\toption({value: \"undo\"}, \"Undo (Z)\"),\r\n\t\t\toption({value: \"redo\"}, \"Redo (Y)\"),\r\n\t\t\toption({value: \"copy\"}, \"Copy Pattern (C)\"),\r\n\t\t\toption({value: \"cut\"}, \"Cut Pattern (X)\"),\r\n\t\t\toption({value: \"paste\"}, \"Paste Pattern (V)\"),\r\n\t\t\toption({value: \"transposeUp\"}, \"Shift Notes Up (+)\"),\r\n\t\t\toption({value: \"transposeDown\"}, \"Shift Notes Down (-)\"),\r\n\t\t\toption({value: \"duration\"}, \"Custom Song Size (Q)\"),\r\n\t\t\toption({value: \"songTheme\"}, \"Set Song Theme...\"),\r\n\t\t);\r\n\t\tprivate readonly _optionsMenu: HTMLSelectElement = select({style: \"width: 100%;\"}, \r\n\t\t\toption({selected: true, disabled: true, hidden: false}, \"Preferences Menu\"),\r\n\t\t\toption({value: \"autoPlay\"}, \"Auto Play On Load\"),\r\n\t\t\toption({value: \"autoFollow\"}, \"Auto Follow Track\"),\r\n\t\t\toption({value: \"showLetters\"}, \"Show Piano\"),\r\n\t\t\toption({value: \"showFifth\"}, \"Highlight 'Fifth' Notes\"),\r\n\t\t\toption({value: \"showMore\"}, \"Advanced Color Scheme\"),\r\n\t\t\toption({value: \"showChannels\"},\"Show All Channels\"),\r\n\t\t\toption({value: \"showScrollBar\"}, \"Octave Scroll Bar\"),\r\n\t\t\toption({value: \"showVolumeBar\"}, \"Show Channel Volume\"),\r\n\t\t\toption({value: \"advancedSettings\"}, \"Enable Advanced Settings\"),\r\n\t\t\toption({value: \"themes\"}, \"Set Theme...\"),\r\n\t\t\toption({value: \"layouts\"}, \"Set Layout...\"),\r\n\t\t);\r\n\t\tprivate readonly _newSongButton: HTMLButtonElement = button({type: \"button\"}, \r\n\t\t\tdiv({},\"New\"),\r\n\t\t\tspan({class: \"fullWidthOnly\"}, div({},\" Song\")),\r\n\t\t\t// Page icon:\r\n\t\t\tSVG.svg( {style: \"flex-shrink: 0; position: absolute; left: 0; top: 50%; margin-top: -1em; pointer-events: none;\", width: \"2em\", height: \"2em\", viewBox: \"-5 -21 26 26\"}, \r\n\t\t\t\tSVG.path({d: \"M 2 0 L 2 -16 L 10 -16 L 14 -12 L 14 0 z M 3 -1 L 13 -1 L 13 -11 L 9 -11 L 9 -15 L 3 -15 z\", fill: \"currentColor\"}),\r\n\t\t\t),\r\n\t\t);\r\n\t\tprivate readonly _songDataButton: HTMLButtonElement = button({type: \"button\"}, \r\n\t\t\tdiv({},\"Song Data\"),\r\n\t\t\tSVG.svg( {style: \"flex-shrink: 0; position: absolute; left: 0; top: 50%; margin-top: -1em; pointer-events: none;\", width: \"2em\", height: \"2em\", viewBox: \"-5 -21 26 26\"}, \r\n\t\t\t\tSVG.path({d: \"M 0 0 L 16 0 L 16 -13 L 10 -13 L 8 -16 L 0 -16 L 0 -13 z\", fill: \"currentColor\"}),\r\n\t\t\t),\r\n\t\t);\r\n\t\tprivate readonly _customizeButton: HTMLButtonElement = button({type: \"button\"}, \r\n\t\t\tspan({ class: \"center\" }, div({},\"Custom Song Size\")),\r\n\t\t\tSVG.svg( {style: \"flex-shrink: 0; position: absolute; left: 0; top: 50%; margin-top: -1em; pointer-events: none;\", width: \"2em\", height: \"2em\", viewBox: \"-13 -13 26 26\"}, \r\n\t\t\t\tSVG.path({d: \"M -8 2 L -2 2 L -2 8 L 2 8 L 2 2 L 8 2 L 8 -2 L 2 -2 L 2 -8 L -2 -8 L -2 -2 L -8 -2 z M 0 2 L -4 -2 L -1 -2 L -1 -8 L 1 -8 L 1 -2 L 4 -2 z M -8 -8 L 8 -8 L 8 -9 L -8 -9 L -8 -8 z\", fill: \"currentColor\"}),\r\n\t\t\t),\r\n\t\t);\r\n\t\tprivate readonly _archiveButton: HTMLButtonElement = button({type: \"button\"}, \r\n\t\t\tspan({ class: \"center\" }, div({},\"Load Mods...\")),\r\n\t\t\tSVG.svg( {style: \"flex-shrink: 0; position: absolute; left: 0; top: 50%; margin-top: -1em; pointer-events: none;\", width: \"2em\", height: \"2em\", viewBox: \"-13 -13 26 26\"}, \r\n\t\t\t\tSVG.path({d: \"M 5.78 -1.6 L 7.93 -0.94 L 7.93 0.94 L 5.78 1.6 L 4.85 3.53 L 5.68 5.61 L 4.21 6.78 L 2.36 5.52 L 0.27 5.99 L -0.85 7.94 L -2.68 7.52 L -2.84 5.28 L -4.52 3.95 L -6.73 4.28 L -7.55 2.59 L -5.9 1.07 L -5.9 -1.07 L -7.55 -2.59 L -6.73 -4.28 L -4.52 -3.95 L -2.84 -5.28 L -2.68 -7.52 L -0.85 -7.94 L 0.27 -5.99 L 2.36 -5.52 L 4.21 -6.78 L 5.68 -5.61 L 4.85 -3.53 M 2.92 0.67 L 2.92 -0.67 L 2.35 -1.87 L 1.3 -2.7 L 0 -3 L -1.3 -2.7 L -2.35 -1.87 L -2.92 -0.67 L -2.92 0.67 L -2.35 1.87 L -1.3 2.7 L -0 3 L 1.3 2.7 L 2.35 1.87 z\", fill: \"currentColor\"}),\r\n\t\t\t),\r\n\t\t);\r\n\t\tprivate readonly _undoButton: HTMLButtonElement = button({type: \"button\", style: \"width: 45%; margin: 0px; margin-top: -2px;\"}, div({},\"Undo\"));\r\n\t\tprivate readonly _redoButton: HTMLButtonElement = button({type: \"button\", style: \"width: 45%; margin: 0px; margin-top: -2px;\"}, div({},\"Redo\"));\r\n\t\tprivate readonly _exportButton: HTMLButtonElement = button({type: \"button\"}, \r\n\t\t\tdiv({},\"Export\"),\r\n\t\t\t// Download icon:\r\n\t\t\tSVG.svg( {style: \"flex-shrink: 0; position: absolute; left: 0; top: 50%; margin-top: -1em; pointer-events: none;\", width: \"2em\", height: \"2em\", viewBox: \"-13 -13 26 26\"}, \r\n\t\t\t\tSVG.path({d: \"M -8 3 L -8 8 L 8 8 L 8 3 L 6 3 L 6 6 L -6 6 L -6 3 z M 0 2 L -4 -2 L -1 -2 L -1 -8 L 1 -8 L 1 -2 L 4 -2 z\", fill: \"currentColor\"}),\r\n\t\t\t),\r\n\t\t);\r\n\t\tprivate readonly _scaleSelect: HTMLSelectElement = buildOptions(select({}), Config.scales.map(scale=>scale.name));\r\n\t\tprivate readonly _mixSelect: HTMLSelectElement = buildOptions(select({}), Config.mixNames);\r\n\t\tprivate readonly _sampleRateSelect: HTMLSelectElement = buildOptions(select({}), Config.sampleRateNames);\r\n\t\tprivate readonly _mixHint: HTMLAnchorElement = <HTMLAnchorElement> a({ class: \"hintButton\" }, div({},\"?\"));\r\n\t\tprivate readonly _archiveHint: HTMLAnchorElement = <HTMLAnchorElement> a({ class: \"hintButton\" }, div({},\"?\"));\r\n\t\tprivate readonly _mixSelectRow: HTMLDivElement = div({class: \"selectRow\"}, this._mixHint, this._mixSelect);\r\n\t\t// private readonly _chipHint: HTMLAnchorElement = <HTMLAnchorElement> a( { class: \"hintButton\" }, div({},\"?\"));\r\n\t\tprivate readonly _instrumentTypeHint: HTMLAnchorElement = <HTMLAnchorElement> a( { class: \"hintButton\" }, div({},\"?\"));\r\n\t\tprivate readonly _keySelect: HTMLSelectElement = buildOptions(select({}), Config.keys.map(key=>key.name).reverse());\r\n\t\tprivate readonly _tempoSlider: Slider = new Slider(input({style: \"margin: 0px;\", type: \"range\", min: \"0\", max: Config.tempoSteps - 1, value: \"7\", step: \"1\"}), this._doc, (oldValue: number, newValue: number) => new ChangeTempo(this._doc, oldValue, newValue));\r\n\t\tprivate readonly _reverbSlider: Slider = new Slider(input({style: \"margin: 0px;\", type: \"range\", min: \"0\", max: Config.reverbRange - 1, value: \"0\", step: \"1\"}), this._doc, (oldValue: number, newValue: number) => new ChangeReverb(this._doc, oldValue, newValue));\r\n\t\tprivate readonly _blendSlider: Slider = new Slider(input({style: \"width: 9em; margin: 0px;\", type: \"range\", min: \"0\", max: Config.blendRange - 1, value: \"0\", step: \"1\"}), this._doc, (oldValue: number, newValue: number) => new ChangeBlend(this._doc, oldValue, newValue));\r\n\t\tprivate readonly _riffSlider: Slider = new Slider(input({style: \"width: 9em; margin: 0px;\", type: \"range\", min: \"0\", max: Config.riffRange - 1, value: \"0\", step: \"1\"}), this._doc, (oldValue: number, newValue: number) => new ChangeRiff(this._doc, oldValue, newValue));\r\n\t\tprivate readonly _detuneSlider: Slider = new Slider(input({style: \"width: 9em; margin: 0px;\", type: \"range\", min: \"0\", max: Config.detuneRange - 1, value: \"0\", step: \"1\"}), this._doc, (oldValue: number, newValue: number) => new ChangeDetune(this._doc, oldValue, newValue));\r\n\t\tprivate readonly _muffSlider: Slider = new Slider(input({style: \"width: 9em; margin: 0px;\", type: \"range\", min: \"0\", max: Config.muffRange - 1, value: \"0\", step: \"1\"}), this._doc, (oldValue: number, newValue: number) => new ChangeMuff(this._doc, oldValue, newValue));\r\n\t\tprivate readonly _imuteButton: HTMLButtonElement = button({ style: \"width: 27px;\", type: \"button\" });\r\n\t\tprivate readonly _iMmuteButton: HTMLButtonElement = button({ style: \"width: 27px;\", type: \"button\" });\r\n\t\tprivate readonly _partSelect: HTMLSelectElement = buildOptions(select({}), Config.partNames);\r\n\t\tprivate readonly _instrumentTypeSelect: HTMLSelectElement = buildOptionsWithSpecificValues(select({}), Config.pitchChannelTypeNames, Config.pitchChannelTypeValues);\r\n\t\tprivate readonly _instrumentTypeSelectRow: HTMLDivElement = div({class: \"selectRow\"}, span({}, div({},\"Type: \")), this._instrumentTypeHint, div({class: \"selectContainer\"}, this._instrumentTypeSelect));\r\n\t\tprivate readonly _algorithmSelect: HTMLSelectElement = buildOptions(select({}), Config.operatorAlgorithmNames);\r\n\t\tprivate readonly _algorithmSelectRow: HTMLDivElement = div({class: \"selectRow\"}, span({}, div({},\"Algorithm: \")), div({class: \"selectContainer\"}, this._algorithmSelect));\r\n\t\tprivate readonly _instrumentSelect: HTMLSelectElement = select({});\r\n\t\tprivate readonly _instrumentInput: HTMLInputElement = input({class: \"numberInput\", type:\"number\", min:1});\r\n\t\tprivate readonly _instrumentSelectRow: HTMLDivElement = div({class: \"selectRow\", style: \"display: none;\"}, span({}, div({},\"Instrument: \")), \r\n\t\tdiv({class: \"inputContainer\"}, \r\n\t\t\tthis._instrumentInput\r\n\t\t));\r\n\t\tprivate readonly _instrumentVolumeSlider: Slider = new Slider(input({style: \"margin: 8px; width: 60px;\", type: \"range\", min: \"-9\", max: \"0\", value: \"0\", step: \"1\"}), this._doc, (oldValue: number, newValue: number) => new ChangeVolume(this._doc, oldValue, -newValue));\r\n\t\tprivate readonly _instrumentMVolumeSlider: Slider = new Slider(input({style: \"margin: 8px; width: 60px;\", type: \"range\", min: \"-5\", max: \"0\", value: \"0\", step: \"1\"}), this._doc, (oldValue: number, newValue: number) => new ChangeVolume(this._doc, oldValue, -newValue));\r\n\t\tprivate readonly _instrumentVolumeSliderRow: HTMLDivElement = div({class: \"selectRow\"}, span({}, div({},\"Volume: \")), this._instrumentVolumeSlider.input, this._imuteButton);\r\n\t\tprivate readonly _instrumentMVolumeSliderRow: HTMLDivElement = div({class: \"selectRow\"}, span({}, div({},\"Volume: \")), this._instrumentMVolumeSlider.input, this._iMmuteButton);\r\n\t\tprivate readonly _SettingsLabel: HTMLDivElement = div({ style: \"margin: 3px 0; text-align: center; color: rgb(170, 170, 170);\" }, div({},\"Settings\"));\r\n\t\tprivate readonly _advancedInstrumentSettingsLabel: HTMLDivElement = div({ style: \"margin: 3px 0; text-align: center;\" }, div({},\"Advanced Instrument Settings\"));\r\n\t\tprivate readonly _waveSelect: HTMLSelectElement = buildOptions(select({}), Config.waveNames);\r\n\t\tprivate readonly _drumSelect: HTMLSelectElement = buildOptions(select({}), Config.drumNames);\r\n\t\tprivate readonly _pwmwaveSelect: HTMLSelectElement = buildOptions(select({}), Config.pwmwaveNames);\r\n\t\tprivate readonly _waveSelectRow: HTMLDivElement = div({class: \"selectRow\"}, span({}, div({},\"Wave: \")), div({class: \"selectContainer\"}, this._waveSelect, this._pwmwaveSelect, this._drumSelect));\r\n\t\tprivate readonly _transitionSelect: HTMLSelectElement = buildOptions(select({}), Config.transitionNames);\r\n\t\tprivate readonly _filterSelect: HTMLSelectElement = buildOptions(select({}), Config.filterNames);\r\n\t\tprivate readonly _filterSelectRow: HTMLDivElement = div({class: \"selectRow\"}, span({}, div({},\"Filter: \")), div({class: \"selectContainer\"}, this._filterSelect));\r\n\t\tprivate readonly _chorusSelect: HTMLSelectElement = buildOptions(select({}), Config.chorusNames);\r\n\t\tprivate readonly _chorusHint = <HTMLAnchorElement> a( {class: \"hintButton\"}, div({},\"?\"));\r\n\t\tprivate readonly _chorusSelectRow: HTMLElement = div({class: \"selectRow\"}, span({}, div({},\"Chorus: \")), div({class: \"selectContainer\"}, this._chorusSelect));\r\n\t\tprivate readonly _effectSelect: HTMLSelectElement = buildOptions(select({}), Config.effectNames);\r\n\t\tprivate readonly _effectSelectRow: HTMLDivElement = div({class: \"selectRow\"}, span({}, div({},\"Effect: \")), div({class: \"selectContainer\"}, this._effectSelect));\r\n\t\tprivate readonly _harmSelect: HTMLSelectElement = buildOptions(select({}), Config.harmDisplay);\r\n\t\tprivate readonly _harmSelectRow: HTMLDivElement = div({class: \"selectRow\"}, span({}, div({},\"Chord: \")), this._chorusHint, div({class: \"selectContainer\"}, this._harmSelect));\r\n\t\tprivate readonly _octoffSelect: HTMLSelectElement = buildOptions(select({}), Config.octoffNames);\r\n\t\tprivate readonly _octoffSelectRow: HTMLDivElement = div({class: \"selectRow\"}, span({}, div({},\"Octave Offset: \")), div({class: \"selectContainer\"}, this._octoffSelect));\r\n\t\tprivate readonly _fmChorusSelect: HTMLSelectElement = buildOptions(select({}), Config.fmChorusDisplay);\r\n\t\tprivate readonly _fmChorusSelectRow: HTMLDivElement = div({class: \"selectRow\"}, span({}, div({},\"FM Chorus: \")), div({class: \"selectContainer\"}, this._fmChorusSelect));\r\n\t\tprivate readonly _ipanSlider: Slider = new Slider(input({style: \"margin: 8px; width: 100px;\", type: \"range\", min: \"-8\", max: \"0\", value: \"0\", step: \"1\"}), this._doc, (oldValue: number, newValue: number) => new ChangeIpan(this._doc, oldValue, -newValue));\r\n\t\tprivate readonly _ipanSliderRow: HTMLDivElement = div({class: \"selectRow\"}, span({}, div({},\"Panning: \")), span({}, div({},\"L\")), this._ipanSlider.input, span({}, div({},\"R\")));\r\n\t\tprivate readonly _phaseModGroup: HTMLElement = div({style: \"display: flex; flex-direction: column; display: none;\"}, );\r\n\t\tprivate readonly _feedbackTypeSelect: HTMLSelectElement = buildOptions(select({}), Config.operatorFeedbackNames);\r\n\t\tprivate readonly _feedbackRow1: HTMLDivElement = div({class: \"selectRow\"}, span({}, div({},\"Feedback:\")), div({class: \"selectContainer\"}, this._feedbackTypeSelect));\r\n\t\t\r\n\t\tprivate readonly _feedbackAmplitudeSlider: Slider = new Slider(input({style: \"margin: 0px; width: 4em;\", type: \"range\", min: \"0\", max: Config.operatorAmplitudeMax, value: \"0\", step: \"1\", title: \"Feedback Amplitude\"}), this._doc, (oldValue: number, newValue: number) => new ChangeFeedbackAmplitude(this._doc, oldValue, newValue));\r\n\t\tprivate readonly _feedbackEnvelopeSelect: HTMLSelectElement = buildOptions(select({style: \"width: 100%;\", title: \"Feedback Envelope\"}), Config.operatorEnvelopeNames);\r\n\t\tprivate readonly _feedbackRow2: HTMLDivElement = div({class: \"operatorRow\"}, \r\n\t\t\tdiv({style: \"margin-right: .1em; visibility: hidden;\"}, div({},1 + \".\")),\r\n\t\t\tdiv({style: \"width: 3em; margin-right: .3em;\"}),\r\n\t\t\tthis._feedbackAmplitudeSlider.input,\r\n\t\t\tdiv({class: \"selectContainer\", style: \"width: 5em; margin-left: .3em;\"}, this._feedbackEnvelopeSelect),\r\n\t\t);\r\n\r\n\t\tprivate readonly _songSettingsButton: HTMLButtonElement = button({style:\"flex: 1; border-bottom: solid 2px var(--link-accent);\"}, \"Song\");\r\n\t\tprivate readonly _instSettingsButton: HTMLButtonElement = button({style:\"flex: 1;\"}, \"Instrument\");\r\n\t\tprivate readonly _settingsTabs: HTMLDivElement = div({style:\"display: flex; gap: 3px;\"},\r\n\t\t\t\tthis._songSettingsButton,\r\n\t\t\t\tthis._instSettingsButton\r\n\t\t);\r\n\r\n\t\tprivate readonly _instrumentSettingsGroup: HTMLDivElement = div({style:\"display:none;\"}, \r\n\t\t\tthis._instrumentSelectRow,\r\n\t\t\tthis._instrumentTypeSelectRow,\r\n\t\t\tthis._instrumentMVolumeSliderRow,\r\n\t\t\tthis._instrumentVolumeSliderRow,\r\n\t\t\tthis._waveSelectRow,\r\n\t\t\tdiv({class: \"selectRow\"}, \r\n\t\t\t\tspan({}, div({},\"Transitions: \")),\r\n\t\t\t\tdiv({class: \"selectContainer\"}, this._transitionSelect),\r\n\t\t\t),\r\n\t\t\tthis._filterSelectRow,\r\n\t\t\tthis._chorusSelectRow,\r\n\t\t\tthis._effectSelectRow,\r\n\t\t\tthis._algorithmSelectRow,\r\n\t\t\tthis._phaseModGroup,\r\n\t\t\tthis._feedbackRow1,\r\n\t\t\tthis._feedbackRow2,\r\n\t\t);\r\n\t\tprivate readonly _songSettingsGroup: HTMLDivElement = div({ class: \"editor-song-settings\" }, \r\n\t\t\tdiv({ class: \"selectRow\" }, span({}, div({},\"Scale: \")), div({ class: \"selectContainer\", style: \"margin: 3px 0; text-align: center; color: #ccc;\" }, this._scaleSelect)),\r\n\t\t\tdiv({ class: \"selectRow\" }, span({}, div({},\"Key: \")), div({ class: \"selectContainer\", style: \"margin: 3px 0; text-align: center; color: #ccc;\" }, this._keySelect)),\r\n\t\t\tdiv({ class: \"selectRow\" }, span({}, div({},\"Tempo: \")), this._tempoSlider.input),\r\n\t\t\tdiv({ class: \"selectRow\" }, span({}, div({},\"Reverb: \")), this._reverbSlider.input),\r\n\t\t\tdiv({ class: \"selectRow\" }, span({}, div({},\"Rhythm: \")), div({ class: \"selectContainer\", style: \"margin: 3px 0; text-align: center; color: #ccc;\" }, this._partSelect)),\r\n\t\t);\r\n\t\tprivate readonly _advancedInstrumentSettingsGroup: HTMLDivElement = div({}, \r\n\t\t\tthis._advancedInstrumentSettingsLabel,\r\n\t\t\tthis._ipanSliderRow,\r\n\t\t\tthis._harmSelectRow,\r\n\t\t\tthis._octoffSelectRow,\r\n\t\t\tthis._fmChorusSelectRow,\r\n\t\t);\r\n\t\tprivate readonly _promptContainer: HTMLDivElement = div({class: \"promptContainer\", id: \"promptContainer\", style: \"display: none;\"});\r\n\t\tprivate readonly _advancedSongSettings: HTMLDivElement = div({ class: \"editor-song-settings\", style: \"margin: 0px 5px;\" }, \r\n\t\t\tdiv({ style: \"margin: 3px 0; text-align: center;\" }, div({},\"Advanced Song Settings\")),\r\n\t\t\tdiv({ class: \"selectRow\" }, span({}, div({},\"Mix: \")), div({ class: \"selectContainer\" }, this._mixSelectRow)),\r\n\t\t\tdiv({ class: \"selectRow\" }, span({}, div({},\"Sample Rate: \")), div({ class: \"selectContainer\" }, this._sampleRateSelect)),\r\n\t\t\tdiv({ class: \"selectRow\" }, span({}, div({},\"Blending: \")), this._blendSlider.input),\r\n\t\t\tdiv({ class: \"selectRow\" }, span({}, div({},\"Riff: \")), this._riffSlider.input),\r\n\t\t\tdiv({ class: \"selectRow\" }, span({}, div({},\"Detune: \")), this._detuneSlider.input),\r\n\t\t\tdiv({ class: \"selectRow\" }, span({}, div({},\"Muff: \")), this._muffSlider.input),\r\n\t\t);\r\n\t\tprivate readonly _advancedSettingsContainer: HTMLDivElement = div({ class: \"advanced-settings-area\", style: \"margin: 0px 5px;\" }, \r\n\t\t\tdiv({ class: \"editor-widgets\" }, \r\n\t\t\t\tdiv({ style: \"text-align: center;\" }, div({},\"Advanced Settings\")),\r\n\t\t\t\tdiv({ style: \"margin: 2px 0; display: flex; flex-direction: row; align-items: center;\" }, ),\r\n\t\t\t\tdiv({ class: \"editor-menus\" }, \r\n\t\t\t\t\tdiv({ style: \"margin: 5px 0; display: flex; flex-direction: row; justify-content: space-between;\" }, \r\n\t\t\t\t\t\tthis._prevBarButton,\r\n\t\t\t\t\t\tthis._undoButton,\r\n\t\t\t\t\t\tthis._redoButton,\r\n\t\t\t\t\t\tthis._nextBarButton,\r\n\t\t\t\t\t),\r\n\t\t\t\t),\r\n\t\t\t\tdiv({ class: \"editor-settings\" }, \r\n\t\t\t\t\tthis._advancedSongSettings,\r\n\t\t\t\t\tdiv({ class: \"editor-instrument-settings\" }, \r\n\t\t\t\t\t\tthis._advancedInstrumentSettingsGroup,\r\n\t\t\t\t\t),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t);\r\n\t\tpublic readonly mainLayer: HTMLDivElement = div({class: \"beepboxEditor\", tabIndex: \"0\"}, \r\n\t\t\tthis._editorBox,\r\n\t\t\tthis._trackEditorBox,\r\n\t\t\tdiv({class: \"settings-area\"}, \r\n\t\t\t\tdiv({ class:\"title\", style: \"align-items: center; display: flex; justify-content: center;\" }, div({},\"Neo NepBox\")),\r\n\t\t\t\tdiv({ class:\"controller\", style: \"margin: 5px 0; gap: 3px; display: flex; flex-direction: column; align-items: center;\" }, \r\n\t\t\t\t\tdiv({ style: \"display:flex; flex-direction:row;\" },\r\n\t\t\t\t\t\tSVG.svg( { width: \"2em\", height: \"2em\", viewBox: \"0 0 26 26\" }, \r\n\t\t\t\t\t\t\tSVG.path({ d: \"M 4 17 L 4 9 L 8 9 L 12 5 L 12 21 L 8 17 z\", fill: ColorConfig.volumeIcon}),\r\n\t\t\t\t\t\t\tSVG.path({ d: \"M 15 11 L 16 10 A 7.2 7.2 0 0 1 16 16 L 15 15 A 5.8 5.8 0 0 0 15 12 z\", fill: ColorConfig.volumeIcon }),\r\n\t\t\t\t\t\t\tSVG.path({ d: \"M 18 8 L 19 7 A 11.5 11.5 0 0 1 19 19 L 18 18 A 10.1 10.1 0 0 0 18 8 z\", fill: ColorConfig.volumeIcon }),\r\n\t\t\t\t\t\t),\r\n\t\t\t\t\t\tthis._volumeSlider,\r\n\t\t\t\t\t),\r\n\t\t\t\t\tdiv({ style: \"display: flex; flex-direction: row; align-items: center; width:100%; gap: 3px;\" }, \r\n\t\t\t\t\t\tthis._playButton,\r\n\t\t\t\t\t\tthis._prevBarButton,\r\n\t\t\t\t\t\tthis._nextBarButton,\r\n\t\t\t\t\t),\r\n\t\t\t\t),\r\n\t\t\t\tdiv({ class: \"editor-widgets\" }, \r\n\t\t\t\t\tdiv({ class: \"editor-menus\" }, \r\n\t\t\t\t\t\tdiv({class: \"selectContainer menu\"}, \r\n\t\t\t\t\t\t\tthis._fileMenu,\r\n\t\t\t\t\t\t\t// File icon:\r\n\t\t\t\t\t\t\tSVG.svg( {style: \"flex-shrink: 0; position: absolute; left: 0; top: 50%; margin-top: -1em; pointer-events: none;\", width: \"2em\", height: \"2em\", viewBox: \"-5 -21 26 26\"}, \r\n\t\t\t\t\t\t\t\tSVG.path({d: \"M 0 0 L 16 0 L 16 -13 L 10 -13 L 8 -16 L 0 -16 L 0 -13 z\", fill: \"currentColor\"}),\r\n\t\t\t\t\t\t\t),\r\n\t\t\t\t\t\t),\r\n\t\t\t\t\t\tdiv({class: \"selectContainer menu\"}, \r\n\t\t\t\t\t\t\tthis._editMenu,\r\n\t\t\t\t\t\t\t// Edit icon:\r\n\t\t\t\t\t\t\tSVG.svg( {style: \"flex-shrink: 0; position: absolute; left: 0; top: 50%; margin-top: -1em; pointer-events: none;\", width: \"2em\", height: \"2em\", viewBox: \"-5 -21 26 26\"}, \r\n\t\t\t\t\t\t\t\tSVG.path({d: \"M 0 0 L 1 -4 L 4 -1 z M 2 -5 L 10 -13 L 13 -10 L 5 -2 zM 11 -14 L 13 -16 L 14 -16 L 16 -14 L 16 -13 L 14 -11 z\", fill: \"currentColor\"}),\r\n\t\t\t\t\t\t\t),\r\n\t\t\t\t\t\t),\r\n\t\t\t\t\t\tdiv({class: \"selectContainer menu\"}, \r\n\t\t\t\t\t\t\tthis._optionsMenu,\r\n\t\t\t\t\t\t\t// Gear icon:\r\n\t\t\t\t\t\t\tSVG.svg( {style: \"flex-shrink: 0; position: absolute; left: 0; top: 50%; margin-top: -1em; pointer-events: none;\", width: \"2em\", height: \"2em\", viewBox: \"-13 -13 26 26\"}, \r\n\t\t\t\t\t\t\t\tSVG.path({d: \"M 5.78 -1.6 L 7.93 -0.94 L 7.93 0.94 L 5.78 1.6 L 4.85 3.53 L 5.68 5.61 L 4.21 6.78 L 2.36 5.52 L 0.27 5.99 L -0.85 7.94 L -2.68 7.52 L -2.84 5.28 L -4.52 3.95 L -6.73 4.28 L -7.55 2.59 L -5.9 1.07 L -5.9 -1.07 L -7.55 -2.59 L -6.73 -4.28 L -4.52 -3.95 L -2.84 -5.28 L -2.68 -7.52 L -0.85 -7.94 L 0.27 -5.99 L 2.36 -5.52 L 4.21 -6.78 L 5.68 -5.61 L 4.85 -3.53 M 2.92 0.67 L 2.92 -0.67 L 2.35 -1.87 L 1.3 -2.7 L 0 -3 L -1.3 -2.7 L -2.35 -1.87 L -2.92 -0.67 L -2.92 0.67 L -2.35 1.87 L -1.3 2.7 L -0 3 L 1.3 2.7 L 2.35 1.87 z\", fill: \"currentColor\"}),\r\n\t\t\t\t\t\t\t),\r\n\t\t\t\t\t\t),\r\n\t\t\t\t\t),\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tdiv({ class: \"song-settings-area editor-settings\" }, \r\n\t\t\t\tthis._SettingsLabel,\r\n\t\t\t\tthis._settingsTabs,\r\n\t\t\t\tthis._songSettingsGroup,\r\n\t\t\t\tdiv({class: \"editor-instrument-settings\"}, \r\n\t\t\t\t\tthis._instrumentSettingsGroup,\r\n\t\t\t\t),\r\n\t\t\t),\r\n\t\t\tthis._advancedSettingsContainer,\r\n\t\t\tthis._promptContainer,\r\n\t\t);\r\n\t\t\r\n\t\tprivate _wasPlaying: boolean;\r\n\t\tprivate _changeTranspose: ChangeTranspose | null = null;\r\n\t\tprivate readonly _operatorRows: HTMLDivElement[] = []\r\n\t\tprivate readonly _operatorAmplitudeSliders: Slider[] = []\r\n\t\tprivate readonly _operatorEnvelopeSelects: HTMLSelectElement[] = []\r\n\t\tprivate readonly _operatorFrequencySelects: HTMLSelectElement[] = []\r\n\t\t\r\n\t\tconstructor(private _doc: SongDocument) {\r\n\t\t\tthis._doc.notifier.watch(this.whenUpdated);\r\n\t\t\t\r\n\t\t\tthis._phaseModGroup.appendChild(div({class: \"operatorRow\", style: \"height: 1em; margin-top: 0.5em;\"}, \r\n\t\t\t\tdiv({style: \"margin-right: .1em; visibility: hidden;\"}, div({},1 + \".\")),\r\n\t\t\t\tdiv({style: \"width: 3em; margin-right: .3em;\"}, div({},\"Freq:\")),\r\n\t\t\t\tdiv({style: \"width: 4em; margin: 0;\"}, div({},\"Volume:\")),\r\n\t\t\t\tdiv({style: \"width: 5em; margin-left: .3em;\"}, div({},\"Envelope:\")),\r\n\t\t\t));\r\n\t\t\tfor (let i = 0; i < Config.operatorCount; i++) {\r\n\t\t\t\tconst operatorIndex: number = i;\r\n\t\t\t\tconst operatorNumber: HTMLDivElement = div({style: \"margin-right: .1em; color: #999;\"}, div({},i + 1 + \".\"));\r\n\t\t\t\tconst frequencySelect: HTMLSelectElement = buildOptions(select({style: \"width: 100%;\", title: \"Frequency\"}), Config.operatorFrequencyNames);\r\n\t\t\t\tconst amplitudeSlider: Slider = new Slider(input({style: \"margin: 0; width: 4em;\", type: \"range\", min: \"0\", max: Config.operatorAmplitudeMax, value: \"0\", step: \"1\", title: \"Volume\"}), this._doc, (oldValue: number, newValue: number) => new ChangeOperatorAmplitude(this._doc, operatorIndex, oldValue, newValue));\r\n\t\t\t\tconst envelopeSelect: HTMLSelectElement = buildOptions(select({style: \"width: 100%;\", title: \"Envelope\"}), Config.operatorEnvelopeNames);\r\n\t\t\t\tconst row = div({class: \"operatorRow\"}, \r\n\t\t\t\t\toperatorNumber,\r\n\t\t\t\t\tdiv({class: \"selectContainer\", style: \"width: 3em; margin-right: .3em;\"}, frequencySelect),\r\n\t\t\t\t\tamplitudeSlider.input,\r\n\t\t\t\t\tdiv({class: \"selectContainer\", style: \"width: 5em; margin-left: .3em;\"}, envelopeSelect),\r\n\t\t\t\t);\r\n\t\t\t\tthis._phaseModGroup.appendChild(row);\r\n\t\t\t\tthis._operatorRows[i] = row;\r\n\t\t\t\tthis._operatorAmplitudeSliders[i] = amplitudeSlider;\r\n\t\t\t\tthis._operatorEnvelopeSelects[i] = envelopeSelect;\r\n\t\t\t\tthis._operatorFrequencySelects[i] = frequencySelect;\r\n\t\t\t\t\r\n\t\t\t\tenvelopeSelect.addEventListener(\"change\", () => {\r\n\t\t\t\t\tthis._doc.record(new ChangeOperatorEnvelope(this._doc, operatorIndex, envelopeSelect.selectedIndex));\r\n\t\t\t\t});\r\n\t\t\t\tfrequencySelect.addEventListener(\"change\", () => {\r\n\t\t\t\t\tthis._doc.record(new ChangeOperatorFrequency(this._doc, operatorIndex, frequencySelect.selectedIndex));\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._fileMenu.addEventListener(\"change\", this._fileMenuHandler);\r\n\t\t\tthis._editMenu.addEventListener(\"change\", this._editMenuHandler);\r\n\t\t\tthis._optionsMenu.addEventListener(\"change\", this._optionsMenuHandler);\r\n\t\t\tthis._scaleSelect.addEventListener(\"change\", this._whenSetScale);\r\n\t\t\tthis._mixSelect.addEventListener(\"change\", this._whenSetMix);\r\n\t\t\tthis._sampleRateSelect.addEventListener(\"change\", this._whenSetSampleRate);\r\n\t\t\tthis._keySelect.addEventListener(\"change\", this._whenSetKey);\r\n\t\t\tthis._partSelect.addEventListener(\"change\", this._whenSetPartsPerBeat);\r\n\t\t\tthis._instrumentTypeSelect.addEventListener(\"change\", this._whenSetInstrumentType);\r\n\t\t\tthis._algorithmSelect.addEventListener(\"change\", this._whenSetAlgorithm);\r\n\t\t\t//this._instrumentSelect.addEventListener(\"change\", this._whenSetInstrument);\r\n\t\t\tthis._instrumentInput.addEventListener(\"change\", this._whenSetInstrument);\r\n\t\t\tthis._feedbackTypeSelect.addEventListener(\"change\", this._whenSetFeedbackType);\r\n\t\t\tthis._feedbackEnvelopeSelect.addEventListener(\"change\", this._whenSetFeedbackEnvelope);\r\n\t\t\tthis._waveSelect.addEventListener(\"change\", this._whenSetWave);\r\n\t\t\tthis._drumSelect.addEventListener(\"change\", this._whenSetDrum);\r\n\t\t\tthis._pwmwaveSelect.addEventListener(\"change\", this._whenSetPWMWave);\r\n\t\t\tthis._transitionSelect.addEventListener(\"change\", this._whenSetTransition);\r\n\t\t\tthis._filterSelect.addEventListener(\"change\", this._whenSetFilter);\r\n\t\t\tthis._chorusSelect.addEventListener(\"change\", this._whenSetChorus);\r\n\t\t\tthis._effectSelect.addEventListener(\"change\", this._whenSetEffect);\r\n\t\t\tthis._harmSelect.addEventListener(\"change\", this._whenSetHarm);\r\n\t\t\tthis._octoffSelect.addEventListener(\"change\", this._whenSetOctoff);\r\n\t\t\tthis._fmChorusSelect.addEventListener(\"change\", this._whenSetFMChorus);\r\n\t\t\tthis._imuteButton.addEventListener(\"click\", this._muteInstrument);\r\n\t\t\tthis._iMmuteButton.addEventListener(\"click\", this._muteInstrument);\r\n\t\t\tthis._playButton.addEventListener(\"click\", this._togglePlay);\r\n\t\t\tthis._prevBarButton.addEventListener(\"click\", this._whenPrevBarPressed);\r\n\t\t\tthis._nextBarButton.addEventListener(\"click\", this._whenNextBarPressed);\r\n\t\t\tthis._newSongButton.addEventListener(\"click\", this._whenNewSongPressed);\r\n\t\t\tthis._songDataButton.addEventListener(\"click\", this._openSongDataPrompt);\r\n\t\t\tthis._customizeButton.addEventListener(\"click\", this._whenCustomizePressed);\r\n\t\t\tthis._undoButton.addEventListener(\"click\", this._advancedUndo);\r\n\t\t\tthis._redoButton.addEventListener(\"click\", this._advancedRedo);\r\n\t\t\tthis._exportButton.addEventListener(\"click\", this._openExportPrompt);\r\n\t\t\tthis._archiveButton.addEventListener(\"click\", this._openArchivePrompt);\r\n\t\t\tthis._volumeSlider.addEventListener(\"input\", this._setVolumeSlider);\r\n\t\t\t// this._chipHint.addEventListener(\"click\", this._openChipPrompt);\r\n\t\t\tthis._instrumentTypeHint.addEventListener(\"click\", this._openInstrumentTypePrompt);\r\n\t\t\tthis._mixHint.addEventListener(\"click\", this._openMixPrompt);\r\n\t\t\tthis._chorusHint.addEventListener(\"click\", this._openChorusPrompt);\r\n\t\t\tthis._archiveHint.addEventListener(\"click\", this._openArchivePrompt);\r\n\r\n\t\t\tthis._instrumentInput.addEventListener(\"keydown\", this._captureNumberKeys, false);\r\n\t\t\t\r\n\t\t\tthis._editorBox.addEventListener(\"mousedown\", this._refocusStage);\r\n\t\t\tthis.mainLayer.addEventListener(\"keydown\", this._whenKeyPressed);\r\n\t\t\t\r\n\t\t\tthis._songSettingsButton.addEventListener(\"click\", this._setSongSettings);\r\n\t\t\tthis._instSettingsButton.addEventListener(\"click\", this._setInstSettings);\r\n\r\n\t\t\tif (isMobile) (<HTMLOptionElement> this._optionsMenu.children[1]).disabled = true;\r\n\t\t}\r\n\t\t\r\n\t\tprivate _openPrompt(promptName: string): void {\r\n\t\t\tthis._doc.openPrompt(promptName);\r\n\t\t\tthis._setPrompt(promptName);\r\n\t\t}\r\n\t\t\r\n\t\tprivate _setPrompt(promptName: string | null): void {\r\n\t\t\tif (this.prompt) {\r\n\t\t\t\tif (this._wasPlaying) this._play();\r\n\t\t\t\tthis._wasPlaying = false;\r\n\t\t\t\tthis._promptContainer.style.display = \"none\";\r\n\t\t\t\tthis._promptContainer.removeChild(this.prompt.container);\r\n\t\t\t\tthis.prompt.cleanUp();\r\n\t\t\t\tthis.prompt = null;\r\n\t\t\t\tthis.mainLayer.focus();\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (promptName) {\r\n\t\t\t\tswitch (promptName) {\r\n\t\t\t\t\tcase \"export\":\r\n\t\t\t\t\t\tthis.prompt = new ExportPrompt(this._doc);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"import\":\r\n\t\t\t\t\t\tthis.prompt = new ImportPrompt(this._doc);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"duration\":\r\n\t\t\t\t\t\tthis.prompt = new SongDurationPrompt(this._doc);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"archive\":\r\n\t\t\t\t\t\tthis.prompt = new ArchivePrompt(this._doc);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"instrumentType\":\r\n\t\t\t\t\t\tthis.prompt = new InstrumentTypePrompt(this._doc);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t// case \"chipPrompt\":\r\n\t\t\t\t\t// \tthis.prompt = new ChipPrompt(this._doc, this);\r\n\t\t\t\t\t// \tbreak;\r\n\t\t\t\t\tcase \"mix\":\r\n\t\t\t\t\t\tthis.prompt = new MixPrompt(this._doc);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"chorus\":\r\n\t\t\t\t\t\tthis.prompt = new ChorusPrompt(this._doc);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"songdata\":\r\n\t\t\t\t\t\tthis.prompt = new SongDataPrompt(this._doc);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"refresh key\":\r\n\t\t\t\t\t\tthis.prompt = new RefreshKeyPrompt(this._doc, this, this._keySelect.selectedIndex);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"archive\":\r\n\t\t\t\t\t\tthis.prompt = new ArchivePrompt(this._doc);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"themes\":\r\n\t\t\t\t\t\tthis.prompt = new ThemePrompt(this._doc);\r\n\t\t\t\t\t\tbreak;\t\r\n\t\t\t\t\tcase \"songTheme\":\r\n\t\t\t\t\t\tthis.prompt = new SongThemePrompt(this._doc);\r\n\t\t\t\t\t\tbreak;\t\r\n\t\t\t\t\tcase \"layouts\":\r\n\t\t\t\t\t\tthis.prompt = new LayoutPrompt(this._doc);\r\n\t\t\t\t\t\tbreak;\t\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tthrow new Error(\"Unrecognized prompt type.\");\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif (this.prompt) {\r\n\t\t\t\t\tthis._wasPlaying = this._doc.synth.playing;\r\n\t\t\t\t\tthis._pause();\r\n\t\t\t\t\tthis._promptContainer.style.display = \"\";\r\n\t\t\t\t\tthis._promptContainer.appendChild(this.prompt.container);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tprivate _refocusStage = (): void => {\r\n\t\t\tthis.mainLayer.focus();\r\n\t\t}\r\n\t\t\r\n\t\tpublic whenUpdated = (): void => {\r\n\t\t\tconst trackBounds = this._trackContainer.getBoundingClientRect();\r\n\t\t\tthis._doc.trackVisibleBars = Math.floor((trackBounds.right - trackBounds.left) / 32);\r\n\t\t\tthis._barScrollBar.render();\r\n\t\t\tthis._trackEditor.render();\r\n\t\t\tthis._patternEditor.render();\r\n\r\n\t\t\tif (this._doc.song.setSongTheme != songThemeSet) {\r\n\t\t\t\tif (this._doc.song.setSongTheme == \"none\") {\r\n\t\t\t\t\tif (window.localStorage.getItem(\"modboxTheme\") != null) {\r\n\t\t\t\t\t\tColorConfig.setTheme(String(window.localStorage.getItem(\"modboxTheme\")));\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\twindow.localStorage.setItem(\"modboxTheme\", \"default\");\r\n\t\t\t\t\t\tColorConfig.setTheme(\"default\");\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tColorConfig.setTheme(this._doc.song.setSongTheme);\r\n\t\t\t\t}\r\n\t\t\t\tsongThemeSet = this._doc.song.setSongTheme;\r\n\t\t\t} \r\n\r\n\t\t\tdocument.documentElement.style.setProperty(\"--full-layout-columns\", this._doc.prefs.advancedSettings ? \"minmax(0, 1fr) 190px 200px\": \"minmax(0, 1fr) 190px\");\r\n\t\t\tdocument.documentElement.style.setProperty(\"--middle-layout-columns\", this._doc.prefs.advancedSettings ? \"190px minmax(0, 1fr) 200px\" : \"190px minmax(0, 1fr)\");\r\n\r\n\t\t\tconst optionCommands: ReadonlyArray<string> = [\r\n\t\t\t\t(this._doc.prefs.autoPlay ? \"✓ \" : \"✗ \") + \"Auto Play On Load\",\r\n\t\t\t\t(this._doc.prefs.autoFollow ? \"✓ \" : \"✗ \") + \"Auto Follow Track\",\r\n\t\t\t\t(this._doc.prefs.showLetters ? \"✓ \" : \"✗ \") + \"Show Piano\",\r\n\t\t\t\t(this._doc.prefs.showFifth ? \"✓ \" : \"✗ \") + \"Highlight 'Fifth' Notes\",\r\n\t\t\t\t(this._doc.prefs.showMore ? \"✓ \" : \"✗ \") + \"Advanced Color Scheme\",\r\n\t\t\t\t(this._doc.prefs.showChannels ? \"✓ \" : \"✗ \") + \"Show All Channels\",\r\n\t\t\t\t(this._doc.prefs.showScrollBar ? \"✓ \" : \"✗ \") + \"Octave Scroll Bar\",\r\n\t\t\t\t(this._doc.prefs.showVolumeBar ? \"✓ \" : \"✗ \") + \"Show Channel Volume\",\r\n\t\t\t\t(this._doc.prefs.advancedSettings ? \"✓ \" : \"✗ \") + \"Enable Advanced Settings\",\r\n\t\t\t\t\"  Set Theme...\",\r\n\t\t\t]\r\n\t\t\tfor (let i: number = 0; i < optionCommands.length; i++) {\r\n\t\t\t\tconst option: HTMLOptionElement = <HTMLOptionElement> this._optionsMenu.children[i + 1];\r\n\t\t\t\tif (option.innerText != optionCommands[i]) option.innerText = optionCommands[i];\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tconst channel: Channel = this._doc.song.channels[this._doc.channel];\r\n\t\t\tconst pattern: Pattern | null = this._doc.getCurrentPattern();\r\n\t\t\tconst instrumentIndex: number = this._doc.getCurrentInstrument();\r\n\t\t\tconst instrument: Instrument = channel.instruments[instrumentIndex];\r\n\t\t\tconst wasActive: boolean = this.mainLayer.contains(document.activeElement);\r\n\t\t\tlet activeElement: Element = document.activeElement ? document.activeElement : document.activeElement!;\r\n\r\n\t\t\t\r\n\t\t\tsetSelectedIndex(this._scaleSelect, this._doc.song.scale);\r\n\t\t\tsetSelectedIndex(this._mixSelect, this._doc.song.mix);\r\n\t\t\tsetSelectedIndex(this._sampleRateSelect, this._doc.song.sampleRate);\r\n\t\t\tsetSelectedIndex(this._keySelect, Config.keys.length - 1 - this._doc.song.key);\r\n\t\t\tthis._tempoSlider.updateValue(this._doc.song.tempo);\r\n\t\t\tthis._tempoSlider.input.title = this._doc.song.getBeatsPerMinute() + \" beats per minute\";\r\n\t\t\tthis._reverbSlider.updateValue(this._doc.song.reverb);\r\n\t\t\tthis._advancedSettingsContainer.style.display = this._doc.prefs.advancedSettings ? \"\" : \"none\";\r\n\t\t\tthis._blendSlider.updateValue(this._doc.song.blend);\r\n\t\t\tthis._riffSlider.updateValue(this._doc.song.riff);\r\n\t\t\tthis._detuneSlider.updateValue(this._doc.song.detune);\r\n\t\t\tthis._muffSlider.updateValue(this._doc.song.muff);\r\n\t\t\tsetSelectedIndex(this._partSelect, Config.partCounts.indexOf(this._doc.song.partsPerBeat));\r\n\t\t\tif (this._doc.song.getChannelIsDrum(this._doc.channel)) {\r\n\t\t\t\tif (this._doc.song.mix == 2) {\r\n\t\t\t\t\tthis._instrumentVolumeSliderRow.style.display = \"\";\r\n\t\t\t\t\tthis._instrumentMVolumeSliderRow.style.display = \"none\";\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis._instrumentVolumeSliderRow.style.display = \"none\";\r\n\t\t\t\t\tthis._instrumentMVolumeSliderRow.style.display = \"\";\r\n\t\t\t\t}\r\n\t\t\t\tthis._drumSelect.style.display = \"\";\r\n\t\t\t\tthis._waveSelectRow.style.display = \"\";\r\n\t\t\t\tthis._instrumentTypeSelectRow.style.display = \"none\";\r\n\t\t\t\tthis._instrumentTypeSelect.style.display = \"none\";\r\n\t\t\t\tthis._algorithmSelectRow.style.display = \"none\";\r\n\t\t\t\tthis._phaseModGroup.style.display = \"none\";\r\n\t\t\t\tthis._feedbackRow1.style.display = \"none\";\r\n\t\t\t\tthis._feedbackRow2.style.display = \"none\";\r\n\t\t\t\tthis._waveSelect.style.display = \"none\";\r\n\t\t\t\tthis._pwmwaveSelect.style.display = \"none\";\r\n\t\t\t\tthis._filterSelectRow.style.display = \"none\";\r\n\t\t\t\tthis._chorusSelectRow.style.display = \"none\";\r\n\t\t\t\tthis._effectSelectRow.style.display = \"none\";\r\n\t\t\t\tthis._ipanSliderRow.style.display = \"\";\r\n\t\t\t\tthis._harmSelectRow.style.display = \"\";\r\n\t\t\t\tthis._octoffSelectRow.style.display = \"\";\r\n\t\t\t\tthis._fmChorusSelectRow.style.display = \"none\";\r\n\t\t\t} else {\r\n\t\t\t\tthis._instrumentTypeSelectRow.style.display = \"\";\r\n\t\t\t\tthis._instrumentTypeSelect.style.display = \"\";\r\n\t\t\t\tthis._effectSelectRow.style.display = \"\";\r\n\t\t\t\tif (this._doc.song.mix == 2) {\r\n\t\t\t\t\tthis._instrumentVolumeSliderRow.style.display = \"\";\r\n\t\t\t\t\tthis._instrumentMVolumeSliderRow.style.display = \"none\";\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis._instrumentVolumeSliderRow.style.display = \"none\";\r\n\t\t\t\t\tthis._instrumentMVolumeSliderRow.style.display = \"\";\r\n\t\t\t\t}\r\n\t\t\t\tthis._drumSelect.style.display = \"none\";\r\n\t\t\t\t\r\n\t\t\t\tif (instrument.type == InstrumentType.chip) {\r\n\t\t\t\t\tthis._waveSelect.style.display = \"\";\r\n\t\t\t\t\tthis._pwmwaveSelect.style.display = \"none\";\r\n\t\t\t\t\tthis._waveSelectRow.style.display = \"\";\r\n\t\t\t\t\tthis._filterSelectRow.style.display = \"\";\r\n\t\t\t\t\tthis._chorusSelectRow.style.display = \"\";\r\n\t\t\t\t\tthis._harmSelectRow.style.display = \"\";\r\n\t\t\t\t\tthis._algorithmSelectRow.style.display = \"none\";\r\n\t\t\t\t\tthis._phaseModGroup.style.display = \"none\";\r\n\t\t\t\t\tthis._feedbackRow1.style.display = \"none\";\r\n\t\t\t\t\tthis._feedbackRow2.style.display = \"none\";\r\n\t\t\t\t\tthis._ipanSliderRow.style.display = \"\";\r\n\t\t\t\t\tthis._octoffSelectRow.style.display = \"\";\r\n\t\t\t\t\tthis._fmChorusSelectRow.style.display = \"none\";\r\n\t\t\t\t} else if (instrument.type == InstrumentType.pwm) {\r\n\t\t\t\t\tthis._waveSelect.style.display = \"none\";\r\n\t\t\t\t\tthis._pwmwaveSelect.style.display = \"\";\r\n\t\t\t\t\tthis._waveSelectRow.style.display = \"\";\r\n\t\t\t\t\tthis._filterSelectRow.style.display = \"none\"; // @TODO: Unhide?\r\n\t\t\t\t\tthis._chorusSelectRow.style.display = \"none\"; // @TODO: Unhide?\r\n\t\t\t\t\tthis._harmSelectRow.style.display = \"none\";\r\n\t\t\t\t\tthis._algorithmSelectRow.style.display = \"none\";\r\n\t\t\t\t\tthis._phaseModGroup.style.display = \"none\";\r\n\t\t\t\t\tthis._feedbackRow1.style.display = \"none\";\r\n\t\t\t\t\tthis._feedbackRow2.style.display = \"none\";\r\n\t\t\t\t\tthis._ipanSliderRow.style.display = \"\";\r\n\t\t\t\t\tthis._octoffSelectRow.style.display = \"\";\r\n\t\t\t\t\tthis._fmChorusSelectRow.style.display = \"none\";\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis._algorithmSelectRow.style.display = \"\";\r\n\t\t\t\t\tthis._phaseModGroup.style.display = \"\";\r\n\t\t\t\t\tthis._feedbackRow1.style.display = \"\";\r\n\t\t\t\t\tthis._feedbackRow2.style.display = \"\";\r\n\t\t\t\t\tthis._harmSelectRow.style.display = \"none\";\r\n\t\t\t\t\tthis._waveSelectRow.style.display = \"none\";\r\n\t\t\t\t\tthis._filterSelectRow.style.display = \"none\";\r\n\t\t\t\t\tthis._chorusSelectRow.style.display = \"none\";\r\n\t\t\t\t\tthis._ipanSliderRow.style.display = \"\";\r\n\t\t\t\t\tthis._octoffSelectRow.style.display = \"\";\r\n\t\t\t\t\tthis._fmChorusSelectRow.style.display = \"\";\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._instrumentTypeSelect.value = instrument.type + \"\";\r\n\t\t\tsetSelectedIndex(this._algorithmSelect, instrument.algorithm);\r\n\t\t\t\r\n\t\t\tthis._instrumentSelectRow.style.display = (this._doc.song.instrumentsPerChannel > 1) ? \"\" : \"none\";\r\n\t\t\tthis._instrumentSelectRow.style.visibility = (pattern == null) ? \"hidden\" : \"\";\r\n\t\t\t/*if (this._instrumentSelect.children.length != this._doc.song.instrumentsPerChannel) {\r\n\t\t\t\twhile (this._instrumentSelect.firstChild) this._instrumentSelect.removeChild(this._instrumentSelect.firstChild);\r\n\t\t\t\tconst instrumentList: number[] = [];\r\n\t\t\t\tfor (let i: number = 0; i < this._doc.song.instrumentsPerChannel; i++) {\r\n\t\t\t\t\tinstrumentList.push(i + 1);\r\n\t\t\t\t}\r\n\t\t\t\tbuildOptions(this._instrumentSelect, instrumentList);\r\n\t\t\t}*/\r\n\r\n\t\t\tconsole.log(this._doc.song.instrumentsPerChannel);\r\n\r\n\t\t\tif (this._instrumentInput.max != String(this._doc.song.instrumentsPerChannel)) {\r\n\t\t\t\tthis._instrumentInput.max = String(this._doc.song.instrumentsPerChannel);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (instrument.imute == 0) {\r\n\t\t\t\tthis._instrumentSettingsGroup.style.color = this._doc.song.getNoteColorBright(this._doc.channel);\r\n\t\t\t\tthis._advancedInstrumentSettingsGroup.style.color = this._doc.song.getNoteColorDim(this._doc.channel);\r\n\t\t\t\tthis._advancedSongSettings.style.color = \"#aaaaaa\";\r\n\t\t\t\tthis._imuteButton.innerText = \"◉\";\r\n\t\t\t\tthis._iMmuteButton.innerText = \"◉\";\r\n\t\t\t} else {\r\n\t\t\t\tthis._instrumentSettingsGroup.style.color = \"#cccccc\";\r\n\t\t\t\tthis._advancedInstrumentSettingsGroup.style.color = \"#aaaaaa\";\r\n\t\t\t\tthis._advancedSongSettings.style.color = \"#aaaaaa\";\r\n\t\t\t\tthis._imuteButton.innerText = \"◎\";\r\n\t\t\t\tthis._iMmuteButton.innerText = \"◎\";\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tsetSelectedIndex(this._waveSelect, instrument.wave);\r\n\t\t\tsetSelectedIndex(this._drumSelect, instrument.wave);\r\n\t\t\tsetSelectedIndex(this._pwmwaveSelect, instrument.wave);\r\n\t\t\tsetSelectedIndex(this._filterSelect, instrument.filter);\r\n\t\t\tsetSelectedIndex(this._transitionSelect, instrument.transition);\r\n\t\t\tsetSelectedIndex(this._effectSelect, instrument.effect);\r\n\t\t\tsetSelectedIndex(this._chorusSelect, instrument.chorus);\r\n\t\t\tsetSelectedIndex(this._harmSelect, instrument.harm);\r\n\t\t\tsetSelectedIndex(this._octoffSelect, instrument.octoff);\r\n\t\t\tsetSelectedIndex(this._fmChorusSelect, instrument.fmChorus);\r\n\t\t\tsetSelectedIndex(this._feedbackTypeSelect, instrument.feedbackType);\r\n\t\t\tthis._feedbackAmplitudeSlider.updateValue(instrument.feedbackAmplitude);\r\n\t\t\tsetSelectedIndex(this._feedbackEnvelopeSelect, instrument.feedbackEnvelope);\r\n\t\t\tthis._feedbackEnvelopeSelect.parentElement!.style.color = (instrument.feedbackAmplitude > 0) ? \"\" : \"#999\";\r\n\t\t\tthis._instrumentVolumeSlider.updateValue(-instrument.volume);\r\n\t\t\tthis._instrumentMVolumeSlider.updateValue(-instrument.volume);\r\n\t\t\tthis._ipanSlider.updateValue(-instrument.ipan);\r\n\t\t\tsetSelectedIndex(this._instrumentSelect, instrumentIndex);\r\n\t\t\tsetSelectedValue(this._instrumentInput, String(instrumentIndex+1));\r\n\t\t\tfor (let i: number = 0; i < Config.operatorCount; i++) {\r\n\t\t\t\tconst isCarrier: boolean = (i < Config.operatorCarrierCounts[instrument.algorithm]);\r\n\t\t\t\tthis._operatorRows[i].style.color = isCarrier ? \"white\" : \"\";\r\n\t\t\t\tsetSelectedIndex(this._operatorFrequencySelects[i], instrument.operators[i].frequency);\r\n\t\t\t\tthis._operatorAmplitudeSliders[i].updateValue(instrument.operators[i].amplitude);\r\n\t\t\t\tsetSelectedIndex(this._operatorEnvelopeSelects[i], instrument.operators[i].envelope);\r\n\t\t\t\tconst operatorName: string = (isCarrier ? \"Voice \" : \"Modulator \") + (i + 1);\r\n\t\t\t\tthis._operatorFrequencySelects[i].title = operatorName + \" Frequency\";\r\n\t\t\t\tthis._operatorAmplitudeSliders[i].input.title = operatorName + (isCarrier ? \" Volume\" : \" Amplitude\");\r\n\t\t\t\tthis._operatorEnvelopeSelects[i].title = operatorName + \" Envelope\";\r\n\t\t\t\tthis._operatorEnvelopeSelects[i].parentElement!.style.color = (instrument.operators[i].amplitude > 0) ? \"\" : \"#999\";\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._piano.container.style.display = this._doc.prefs.showLetters ? \"\" : \"none\";\r\n\t\t\tthis._octaveScrollBar.container.style.display = this._doc.prefs.showScrollBar ? \"\" : \"none\";\r\n\t\t\tthis._barScrollBar.container.style.display = this._doc.song.barCount > this._doc.trackVisibleBars ? \"\" : \"none\";\r\n\t\t\t// this._chipHint.style.display = (instrument.type == InstrumentType.fm) ? \"none\" : \"\";\r\n\t\t\tthis._instrumentTypeHint.style.display = (instrument.type == InstrumentType.fm) ? \"\" : \"none\";\r\n\t\t\tthis._mixHint.style.display = (this._doc.song.mix != 1) ? \"\" : \"none\";\r\n\t\t\tthis._chorusHint.style.display = (Config.harmNames[instrument.harm]) ? \"\" : \"none\";\r\n\t\t\t\r\n\t\t\tlet patternWidth: number = 512;\r\n\t\t\tif (this._doc.prefs.showLetters) patternWidth -= 32;\r\n\t\t\tif (this._doc.prefs.showScrollBar) patternWidth -= 20;\r\n\t\t\tthis._patternEditor.container.style.width = String(patternWidth) + \"px\";\r\n\t\t\t\r\n\t\t\tthis._volumeSlider.value = String(this._doc.prefs.volume);\r\n\t\t\t\r\n\t\t\t// If an interface element was selected, but becomes invisible (e.g. an instrument\r\n\t\t\t// select menu) just select the editor container so keyboard commands still work.\r\n\t\t\tif (wasActive && (activeElement.clientWidth == 0)) {\r\n\t\t\t\tthis._refocusStage();\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._setPrompt(this._doc.prompt);\r\n\t\t\t\r\n\t\t\tif (this._doc.prefs.autoFollow && !this._doc.synth.playing) {\r\n\t\t\t\tthis._doc.synth.snapToBar(this._doc.bar);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tprivate _setSongSettings = (): void => {\r\n\t\t\tthis._songSettingsGroup.style.display = \"flex\";\r\n\t\t\tthis._instrumentSettingsGroup.style.display = \"none\";\r\n\t\t\tthis._songSettingsButton.style.borderBottom = \"solid 2px var(--link-accent)\";\r\n\t\t\tthis._instSettingsButton.style.borderBottom = \"\";\r\n\t\t}\r\n\r\n\t\tprivate _setInstSettings = (): void => {\r\n\t\t\tthis._instrumentSettingsGroup.style.display = \"unset\";\r\n\t\t\tthis._songSettingsGroup.style.display = \"none\";\r\n\t\t\tthis._instSettingsButton.style.borderBottom = \"solid 2px var(--link-accent)\";\r\n\t\t\tthis._songSettingsButton.style.borderBottom = \"\";\r\n\t\t}\r\n\r\n\t\tprivate _muteInstrument = (): void => {\r\n\t\t\tconst channel: Channel = this._doc.song.channels[this._doc.channel];\r\n\t\t\tconst instrumentIndex: number = this._doc.getCurrentInstrument();\r\n\t\t\tconst instrument: Instrument = channel.instruments[instrumentIndex];\r\n\t\t\tconst oldValue: number = instrument.imute;\r\n\t\t\tconst isMuted: boolean = oldValue == 1;\r\n\t\t\tconst newValue: number = isMuted ? 0 : 1;\r\n\t\t\tthis._doc.record(new ChangeImute(this._doc, newValue));\r\n\t\t\tif (instrument.imute == 0) {\r\n\t\t\t\tthis._instrumentSettingsGroup.style.color = this._doc.song.getNoteColorBright(this._doc.channel);\r\n\t\t\t\tthis._advancedInstrumentSettingsGroup.style.color = this._doc.song.getNoteColorDim(this._doc.channel);\r\n\t\t\t\tthis._advancedSongSettings.style.color = \"#aaaaaa\";\r\n\t\t\t\tthis._imuteButton.innerText = \"◉\";\r\n\t\t\t\tthis._iMmuteButton.innerText = \"◉\";\r\n\t\t\t} else {\r\n\t\t\t\tthis._instrumentSettingsGroup.style.color = \"#cccccc\";\r\n\t\t\t\tthis._advancedInstrumentSettingsGroup.style.color = \"#aaaaaa\";\r\n\t\t\t\tthis._advancedSongSettings.style.color = \"#aaaaaa\";\r\n\t\t\t\tthis._imuteButton.innerText = \"◎\";\r\n\t\t\t\tthis._iMmuteButton.innerText = \"◎\";\r\n\t\t\t}\r\n\t\t\tthis.whenUpdated();\r\n\t\t}\r\n\t\t\r\n\t\tpublic updatePlayButton(): void {\r\n\t\t\tif (this._doc.synth.playing) {\r\n\t\t\t\tthis._playButton.classList.remove(\"playButton\");\r\n\t\t\t\tthis._playButton.classList.add(\"pauseButton\");\r\n\t\t\t\tthis._playButton.title = \"Pause (Space)\";\r\n\t\t\t\tthis._playButton.innerText = \"Pause\";\r\n\t\t\t} else {\r\n\t\t\t\tthis._playButton.classList.remove(\"pauseButton\");\r\n\t\t\t\tthis._playButton.classList.add(\"playButton\");\r\n\t\t\t\tthis._playButton.title = \"Play (Space)\";\r\n\t\t\t\tthis._playButton.innerText = \"Play\";\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tprivate _captureNumberKeys = (event: KeyboardEvent): void => {\r\n        // When the number input is in focus, allow some keyboard events to\r\n        // edit the input without accidentally editing the song otherwise.\r\n\t\t\tswitch (event.keyCode) {\r\n\t\t\t\tcase 8: // backspace/delete\r\n\t\t\t\tcase 13: // enter/return\r\n\t\t\t\tcase 38: // up\r\n\t\t\t\tcase 40: // down\r\n\t\t\t\tcase 37: // left\r\n\t\t\t\tcase 39: // right\r\n\t\t\t\tcase 48: // 0\r\n\t\t\t\tcase 49: // 1\r\n\t\t\t\tcase 50: // 2\r\n\t\t\t\tcase 51: // 3\r\n\t\t\t\tcase 52: // 4\r\n\t\t\t\tcase 53: // 5\r\n\t\t\t\tcase 54: // 6\r\n\t\t\t\tcase 55: // 7\r\n\t\t\t\tcase 56: // 8\r\n\t\t\t\tcase 57: // 9\r\n\t\t\t\t\tevent.stopPropagation();\r\n\t\t\t\t\tbreak;\r\n        \t}\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenKeyPressed = (event: KeyboardEvent): void => {\r\n\t\t\tif (this.prompt) {\r\n\t\t\t\tif (event.keyCode == 27) { // ESC key\r\n\t\t\t\t\t// close prompt.\r\n\t\t\t\t\twindow.history.back();\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t//if (event.ctrlKey)\r\n\t\t\t//trace(event.keyCode)\r\n\t\t\tswitch (event.keyCode) {\r\n\t\t\t\tcase 8:\r\n\t\t\t\t\tif (event.ctrlKey) {\r\n\t\t\t\t\t\tif (this._doc.channel > 0) {\r\n\t\t\t\t\t\t\tthis._doc.record(new ChangeRemoveChannel(this._doc, this._doc.channel, this._doc.channel));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis._doc.record(new ChangeDeleteBars(this._doc, this._doc.bar, 1));\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 13: // enter\r\n\t\t\t\t\tif (event.ctrlKey || event.metaKey) {\t\t\r\n\t\t\t\t\t\t\tthis._doc.selection.insertChannel();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis._doc.record(new ChangeInsertBars(this._doc, this._doc.bar+1, 1)); }\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 38: // up\r\n\t\t\t\t\tthis._trackEditor._setChannelBar((this._doc.channel - 1 + this._doc.song.getChannelCount()) % this._doc.song.getChannelCount(), this._doc.bar);\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 40: // down\r\n\t\t\t\tthis._trackEditor._setChannelBar((this._doc.channel + 1) % this._doc.song.getChannelCount(), this._doc.bar);\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 37: // left\r\n\t\t\t\tthis._trackEditor._setChannelBar(this._doc.channel, (this._doc.bar + this._doc.song.barCount - 1) % this._doc.song.barCount);\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 39: // right\r\n\t\t\t\tthis._trackEditor._setChannelBar(this._doc.channel, (this._doc.bar + 1) % this._doc.song.barCount);\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 48: // 0\r\n\t\t\t\tthis._trackEditor._nextDigit(\"0\");\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 49: // 1\r\n\t\t\t\tthis._trackEditor._nextDigit(\"1\");\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 50: // 2\r\n\t\t\t\tthis._trackEditor._nextDigit(\"2\");\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 51: // 3\r\n\t\t\t\tthis._trackEditor._nextDigit(\"3\");\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 52: // 4\r\n\t\t\t\tthis._trackEditor._nextDigit(\"4\");\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 53: // 5\r\n\t\t\t\tthis._trackEditor._nextDigit(\"5\");\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 54: // 6\r\n\t\t\t\tthis._trackEditor._nextDigit(\"6\");\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 55: // 7\r\n\t\t\t\tthis._trackEditor._nextDigit(\"7\");\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 56: // 8\r\n\t\t\t\tthis._trackEditor._nextDigit(\"8\");\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 57: // 9\r\n\t\t\t\tthis._trackEditor._nextDigit(\"9\");\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\tthis._trackEditor._digits = \"\";\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 77: // m\r\n\t\t\t\tif (event.shiftKey) {\r\n\t\t\t\t\tthis._doc.selection.muteAllInstruments();\r\n\t\t\t\t\t} else { \r\n\t\t\t\t\tthis._muteInstrument();\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 83: // s\r\n\t\t\t\tif (event.ctrlKey || event.metaKey) {\r\n\t\t\t\t\tthis._openPrompt(\"export\");\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t}\telse {\r\n\t\t\t\t\tthis._doc.selection.soloChannels(event.shiftKey);\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 79: // o\r\n\t\t\t\tif (event.ctrlKey || event.metaKey) {\r\n\t\t\t\t\tthis._openPrompt(\"import\");\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 32: // space\r\n\t\t\t\t\t//stage.focus = stage;\r\n\t\t\t\t\tthis._togglePlay();\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 90: // z\r\n\t\t\t\t\tif (event.shiftKey) {\r\n\t\t\t\t\t\tthis._doc.redo();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis._doc.undo();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 89: // y\r\n\t\t\t\t\tthis._doc.redo();\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 88: // x\r\n\t\t\t\t\tthis._cut();\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 67: // c\r\n\t\t\t\t\tthis._copy();\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 70: // f\r\n\t\t\t\tif (event.shiftKey) {\r\n\t\t\t\t\tthis._doc.synth.snapToBar(this._doc.song.loopStart);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis._doc.synth.snapToStart();\r\n\t\t\t\t}\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 86: // v\r\n\t\t\t\t\tthis._paste();\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 219: // left brace\r\n\t\t\t\t\tthis._doc.synth.prevBar();\r\n\t\t\t\t\tif (this._doc.prefs.autoFollow) {\r\n\t\t\t\t\t\tnew ChangeChannelBar(this._doc, this._doc.channel, Math.floor(this._doc.synth.playhead));\r\n\t\t\t\t\t}\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 221: // right brace\r\n\t\t\t\t\tthis._doc.synth.nextBar();\r\n\t\t\t\t\tif (this._doc.prefs.autoFollow) {\r\n\t\t\t\t\t\tnew ChangeChannelBar(this._doc, this._doc.channel, Math.floor(this._doc.synth.playhead));\r\n\t\t\t\t\t}\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 189: // -\r\n\t\t\t\tcase 173: // Firefox -\r\n\t\t\t\t\tthis._transpose(false);\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 187: // +\r\n\t\t\t\tcase 61: // Firefox +\r\n\t\t\t\t\tthis._transpose(true);\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 81: // q\r\n\t\t\t\t\tthis._openPrompt(\"duration\");\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenPrevBarPressed = (): void => {\r\n\t\t\tthis._doc.synth.prevBar();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenNextBarPressed = (): void => {\r\n\t\t\tthis._doc.synth.nextBar();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _togglePlay = (): void => {\r\n\t\t\tif (this._doc.synth.playing) {\r\n\t\t\t\tthis._pause();\r\n\t\t\t} else {\r\n\t\t\t\tthis._play();\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tprivate _play(): void {\r\n\t\t\tthis._doc.synth.play();\r\n\t\t\tthis.updatePlayButton();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _pause(): void {\r\n\t\t\tthis._doc.synth.pause();\r\n\t\t\tif (this._doc.prefs.autoFollow) {\r\n\t\t\t\tthis._doc.synth.snapToBar(this._doc.bar);\r\n\t\t\t} else {\r\n\t\t\t\tthis._doc.synth.snapToBar();\r\n\t\t\t}\r\n\t\t\tthis.updatePlayButton();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _setVolumeSlider = (): void => {\r\n\t\t\tthis._doc.setVolume(Number(this._volumeSlider.value));\r\n\t\t\tthis._trackEditor.render();\r\n\t\t}\r\n\r\n\t\tprivate _cut(): void {\r\n\t\t\tconst pattern: Pattern | null = this._doc.getCurrentPattern();\r\n\t\t\tif (pattern == null) return;\r\n\t\t\twindow.localStorage.setItem(\"patternCopy\", JSON.stringify({\r\n\t\t\t\tnotes: pattern.notes,\r\n\t\t\t\tbeatsPerBar: this._doc.song.beatsPerBar,\r\n\t\t\t\tpartsPerBeat: this._doc.song.partsPerBeat,\r\n\t\t\t\tdrums: this._doc.song.getChannelIsDrum(this._doc.channel),\r\n\t\t\t}));\r\n\t\t\tthis._doc.record(new ChangePaste(this._doc, pattern, [], this._doc.song.beatsPerBar, this._doc.song.partsPerBeat));\r\n\t\t}\r\n\t\t\r\n\t\tprivate _copy(): void {\r\n\t\t\tconst pattern: Pattern | null = this._doc.getCurrentPattern();\r\n\t\t\tlet notes: Note[] = [];\r\n\t\t\tif (pattern != null) notes = pattern.notes;\r\n\t\t\t\r\n\t\t\tconst patternCopy: PatternCopy = {\r\n\t\t\t\tnotes: notes,\r\n\t\t\t\tbeatsPerBar: this._doc.song.beatsPerBar,\r\n\t\t\t\tpartsPerBeat: this._doc.song.partsPerBeat,\r\n\t\t\t\tdrums: this._doc.song.getChannelIsDrum(this._doc.channel),\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\twindow.localStorage.setItem(\"patternCopy\", JSON.stringify(patternCopy));\r\n\t\t}\r\n\t\t\r\n\t\tprivate _paste(): void {\r\n\t\t\tconst patternCopy: PatternCopy | null = JSON.parse(String(window.localStorage.getItem(\"patternCopy\")));\r\n\t\t\tif (patternCopy != null && patternCopy.drums == this._doc.song.getChannelIsDrum(this._doc.channel)) {\r\n\t\t\t\tnew ChangeEnsurePatternExists(this._doc);\r\n\t\t\t\tconst pattern: Pattern | null = this._doc.getCurrentPattern();\r\n\t\t\t\tif (pattern == null) throw new Error();\r\n\t\t\t\tthis._doc.record(new ChangePaste(this._doc, pattern, patternCopy.notes, patternCopy.beatsPerBar, patternCopy.partsPerBeat));\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tprivate _transpose(upward: boolean): void {\r\n\t\t\tconst pattern: Pattern | null = this._doc.getCurrentPattern();\r\n\t\t\tif (pattern == null) return;\r\n\t\t\t\r\n\t\t\tconst canReplaceLastChange: boolean = this._doc.lastChangeWas(this._changeTranspose);\r\n\t\t\tthis._changeTranspose = new ChangeTranspose(this._doc, pattern, upward);\r\n\t\t\tthis._doc.record(this._changeTranspose, canReplaceLastChange);\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenNewSongPressed = (): void => {\r\n\t\t\tthis._doc.record(new ChangeSong(this._doc, \"\"));\r\n\t\t\tthis._patternEditor.resetCopiedPins();\r\n\t\t}\r\n\r\n\t\tprivate _whenCustomizePressed = (): void => {\r\n\t\t\tthis._openPrompt(\"duration\");\r\n\t\t}\r\n\r\n\t\tprivate _advancedUndo = (): void => {\r\n\t\t\tthis._doc.undo();\r\n\t\t}\r\n\r\n\t\tprivate _advancedRedo = (): void => {\r\n\t\t\tthis._doc.redo();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _openExportPrompt = (): void => {\r\n\t\t\tthis._openPrompt(\"export\");\r\n\t\t}\r\n\t\t\r\n\t\tprivate _openSongDataPrompt = (): void => {\r\n\t\t\tthis._openPrompt(\"songdata\");\r\n\t\t}\r\n\t\t\r\n\t\tprivate _openInstrumentTypePrompt = (): void => {\r\n\t\t\tthis._openPrompt(\"instrumentType\");\r\n\t\t}\r\n\t\t\r\n\t\t// private _openChipPrompt = (): void => {\r\n\t\t// \tthis._openPrompt(\"chipPrompt\");\r\n\t\t// }\r\n\t\t\r\n\t\tprivate _openMixPrompt = (): void => {\r\n\t\t\tthis._openPrompt(\"mix\");\r\n\t\t}\r\n\t\t\r\n\t\tprivate _openChorusPrompt = (): void => {\r\n\t\t\tthis._openPrompt(\"chorus\");\r\n\t\t}\r\n\t\t\r\n\t\tprivate _openArchivePrompt = (): void => {\r\n\t\t\tthis._openPrompt(\"archive\");\r\n\t\t}\r\n\r\n\t\tpublic refreshNow = (): void => {\r\n\t\t\tsetTimeout(() => { // Prompts seem to get stuck if reloading is done too quickly.\r\n\t\t\t\tlocation.reload();\r\n\t\t\t}, 500);\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenSetScale = (): void => {\r\n\t\t\tthis._doc.record(new ChangeScale(this._doc, this._scaleSelect.selectedIndex));\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenSetMix = (): void => {\r\n\t\t\tthis._doc.record(new ChangeMix(this._doc, this._mixSelect.selectedIndex));\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenSetSampleRate = (): void => {\r\n\t\t\tthis._doc.record(new ChangeSampleRate(this._doc, this._sampleRateSelect.selectedIndex));\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenSetKey = (): void => {\r\n\t\t\tthis._doc.record(new ChangeKey(this._doc, Config.keys.length - 1 - this._keySelect.selectedIndex));\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenSetPartsPerBeat = (): void => {\r\n\t\t\tthis._doc.record(new ChangePartsPerBeat(this._doc, Config.partCounts[this._partSelect.selectedIndex]));\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenSetInstrumentType = (): void => {\r\n\t\t\tthis._doc.record(new ChangeInstrumentType(this._doc, +this._instrumentTypeSelect.value));\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenSetFeedbackType = (): void => {\r\n\t\t\tthis._doc.record(new ChangeFeedbackType(this._doc, this._feedbackTypeSelect.selectedIndex));\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenSetFeedbackEnvelope = (): void => {\r\n\t\t\tthis._doc.record(new ChangeFeedbackEnvelope(this._doc, this._feedbackEnvelopeSelect.selectedIndex));\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenSetAlgorithm = (): void => {\r\n\t\t\tthis._doc.record(new ChangeAlgorithm(this._doc, this._algorithmSelect.selectedIndex));\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenSetInstrument = (): void => {\r\n\t\t\tconst pattern : Pattern | null = this._doc.getCurrentPattern();\r\n\t\t\tif (pattern == null) return;\r\n\t\t\tthis._doc.record(new ChangePatternInstrument(this._doc, Number(this._instrumentInput.value)-1, pattern));\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenSetWave = (): void => {\r\n\t\t\tthis._doc.record(new ChangeWave(this._doc, this._waveSelect.selectedIndex));\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenSetDrum = (): void => {\r\n\t\t\tthis._doc.record(new ChangeWave(this._doc, this._drumSelect.selectedIndex));\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenSetPWMWave = (): void => {\r\n\t\t\tthis._doc.record(new ChangeWave(this._doc, this._pwmwaveSelect.selectedIndex));\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenSetFilter = (): void => {\r\n\t\t\tthis._doc.record(new ChangeFilter(this._doc, this._filterSelect.selectedIndex));\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenSetTransition = (): void => {\r\n\t\t\tthis._doc.record(new ChangeTransition(this._doc, this._transitionSelect.selectedIndex));\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenSetEffect = (): void => {\r\n\t\t\tthis._doc.record(new ChangeEffect(this._doc, this._effectSelect.selectedIndex));\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenSetHarm = (): void => {\r\n\t\t\tthis._doc.record(new ChangeHarm(this._doc, this._harmSelect.selectedIndex));\r\n\t\t}\r\n\r\n\t\tprivate _whenSetFMChorus = (): void => {\r\n\t\t\tthis._doc.record(new ChangeFMChorus(this._doc, this._fmChorusSelect.selectedIndex));\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenSetOctoff = (): void => {\r\n\t\t\tthis._doc.record(new ChangeOctoff(this._doc, this._octoffSelect.selectedIndex));\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenSetChorus = (): void => {\r\n\t\t\tthis._doc.record(new ChangeChorus(this._doc, this._chorusSelect.selectedIndex));\r\n\t\t}\r\n\t\t\r\n\t\tprivate _fileMenuHandler = (event:Event): void => {\r\n\t\t\tswitch (this._fileMenu.value) {\r\n\t\t\t\tcase \"import\":\r\n\t\t\t\t\tthis._openPrompt(\"import\");\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"export\":\r\n\t\t\t\t\tthis._openPrompt(\"export\");\r\n\t\t\t\t\tbreak;\t\r\n\t\t\t\tcase \"cleanS\":\r\n\t\t\t\t\tthis._whenNewSongPressed();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"songdata\":\r\n\t\t\t\t\tthis._openPrompt(\"songdata\");\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"manual\":\r\n\t\t\t\t\twindow.open(\"./manual.html\");\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"shortenUrl\":\r\n\t\t\t\t\twindow.open(\"https://tinyurl.com/api-create.php?url=\" + encodeURIComponent(new URL(\"#\" + this._doc.song.toBase64String(), location.href).href));\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tthis._fileMenu.selectedIndex = 0;\r\n\t\t}\r\n\r\n\t\tprivate _editMenuHandler = (event:Event): void => {\r\n\t\t\tswitch (this._editMenu.value) {\r\n\t\t\t\tcase \"undo\":\r\n\t\t\t\t\tthis._doc.undo();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"redo\":\r\n\t\t\t\t\tthis._doc.redo();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"cut\":\r\n\t\t\t\t\tthis._cut();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"copy\":\r\n\t\t\t\t\tthis._copy();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"paste\":\r\n\t\t\t\t\tthis._paste();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"transposeUp\":\r\n\t\t\t\t\tthis._transpose(true);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"transposeDown\":\r\n\t\t\t\t\tthis._transpose(false);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"duration\":\r\n\t\t\t\t\tthis._openPrompt(\"duration\");\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"archive\":\r\n\t\t\t\t\tthis._openPrompt(\"archive\");\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"songTheme\":\r\n\t\t\t\t\tthis._openPrompt(\"songTheme\");\r\n\t\t\t\t\tbreak;\t\r\n\t\t\t}\r\n\t\t\tthis._editMenu.selectedIndex = 0;\r\n\t\t}\r\n\t\t\r\n\t\tprivate _optionsMenuHandler = (event:Event): void => {\r\n\t\t\tswitch (this._optionsMenu.value) {\r\n\t\t\t\tcase \"autoPlay\":\r\n\t\t\t\t\tthis._doc.prefs.autoPlay = !this._doc.prefs.autoPlay;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"autoFollow\":\r\n\t\t\t\t\tthis._doc.prefs.autoFollow = !this._doc.prefs.autoFollow;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"showLetters\":\r\n\t\t\t\t\tthis._doc.prefs.showLetters = !this._doc.prefs.showLetters;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"showFifth\":\r\n\t\t\t\t\tthis._doc.prefs.showFifth = !this._doc.prefs.showFifth;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"showMore\":\r\n\t\t\t\t\tthis._doc.prefs.showMore = !this._doc.prefs.showMore;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"showChannels\":\r\n\t\t\t\t\tthis._doc.prefs.showChannels = !this._doc.prefs.showChannels;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"showScrollBar\":\r\n\t\t\t\t\tthis._doc.prefs.showScrollBar = !this._doc.prefs.showScrollBar;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"showVolumeBar\":\r\n\t\t\t\t\tthis._doc.prefs.showVolumeBar = !this._doc.prefs.showVolumeBar;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"advancedSettings\":\r\n\t\t\t\t\tthis._doc.prefs.advancedSettings = !this._doc.prefs.advancedSettings;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"themes\":\r\n\t\t\t\t\tthis._openPrompt(\"themes\");\r\n\t\t\t\t\tbreak;\t\r\n\t\t\t\tcase \"layouts\":\r\n\t\t\t\t\tthis._openPrompt(\"layouts\");\r\n\t\t\t\t\tbreak;\t\t\r\n\t\t\t}\r\n\t\t\tthis._optionsMenu.selectedIndex = 0;\r\n\t\t\tthis._doc.notifier.changed();\r\n\t\t\tthis._doc.prefs.save();\r\n\t\t}\r\n\t}\r\n\t\r\n","/*\r\nCopyright (C) 2018 John Nesky\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of \r\nthis software and associated documentation files (the \"Software\"), to deal in \r\nthe Software without restriction, including without limitation the rights to \r\nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \r\nof the Software, and to permit persons to whom the Software is furnished to do \r\nso, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all \r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \r\nSOFTWARE.\r\n*/\r\n\r\n\r\n\texport class ChangeNotifier {\r\n\t\tprivate _watchers: (()=>void)[] = [];\r\n\t\tprivate _dirty: boolean = false;\r\n\t\t\r\n\t\tpublic watch(watcher: ()=>void): void {\r\n\t\t\tif (this._watchers.indexOf(watcher) == -1) {\r\n\t\t\t\tthis._watchers.push(watcher);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tpublic unwatch(watcher: ()=>void): void {\r\n\t\t\tconst index: number = this._watchers.indexOf(watcher);\r\n\t\t\tif (index != -1) {\r\n\t\t\t\tthis._watchers.splice(index, 1);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tpublic changed(): void {\r\n\t\t\tthis._dirty = true;\r\n\t\t}\r\n\t\t\r\n\t\tpublic notifyWatchers(): void {\r\n\t\t\tif (!this._dirty) return;\r\n\t\t\tthis._dirty = false;\r\n\t\t\tfor (const watcher of this._watchers.concat()) {\r\n\t\t\t\twatcher();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n","import {ChangeGroup} from \"./Change\";\r\nimport { ChangeChannelBar, ChangeAddChannel, ChangeSoloChannels, ChangeAllImute } from \"./changes\";\r\nimport { Config } from \"../synth/SynthConfig\";\r\nimport { SongDocument } from \"./SongDocument\";\r\n//import { Channel, Instrument } from \"../synth/synth\";\r\n\r\nexport class Selection {\r\n\r\n    constructor(private _doc: SongDocument) {}\r\n\r\n    public muteAllInstruments(): void {\r\n        let shouldMute: boolean = false;\r\n        if (this._doc.song.channels[this._doc.channel].instruments[0].imute == 0) {\r\n            shouldMute = true;\r\n        }\r\n\r\n        for(let instrumentIndex: number = 0; instrumentIndex < this._doc.song.channels[this._doc.channel].instruments.length; instrumentIndex++) {  \r\n            this._doc.record(new ChangeAllImute(this._doc, Number(shouldMute), instrumentIndex));\r\n        }\r\n\r\n    this._doc.notifier.changed();\r\n}\r\n\r\n    public soloChannels(invert: boolean): void {\r\n\r\n            let mutedCounter: number = 0;\r\n\r\n\t\t\tfor (let channelIndex: number = 0; channelIndex < this._doc.song.channels.length; channelIndex++) {\r\n\t\t\t\tfor(let instrumentIndex: number = 0; instrumentIndex < this._doc.song.channels[channelIndex].instruments.length; instrumentIndex++) {\r\n\r\n                    if (this._doc.song.channels[channelIndex].instruments[instrumentIndex].imute == (invert ? 0 : 1) && channelIndex != this._doc.channel) {\r\n                        mutedCounter++;\r\n                    }\r\n\r\n                    if (channelIndex != this._doc.channel) {\r\n                        this._doc.record(new ChangeSoloChannels(this._doc, Number(!invert), channelIndex, instrumentIndex));\r\n                    } else {\r\n                        this._doc.record(new ChangeSoloChannels(this._doc, Number(invert), channelIndex, instrumentIndex));\r\n                    }\r\n\r\n                    \r\n                }\r\n\t\t\t}\r\n\r\n            if (mutedCounter >= this._doc.song.pitchChannelCount + this._doc.song.drumChannelCount - 1) {\r\n                for (let channelIndex: number = 0; channelIndex < this._doc.song.channels.length; channelIndex++) {\r\n                    for(let instrumentIndex: number = 0; instrumentIndex < this._doc.song.channels[channelIndex].instruments.length; instrumentIndex++) {\r\n                        this._doc.record(new ChangeSoloChannels(this._doc, Number(invert), channelIndex, instrumentIndex));  \r\n                    }\r\n                }\r\n            }\r\n\t\tthis._doc.notifier.changed();\r\n\t}\r\n\r\n    public insertChannel(): void {\r\n\r\n        const group: ChangeGroup = new ChangeGroup();\r\n        const insertIndex: number = this._doc.channel;\r\n        const isNoise: boolean = this._doc.song.getChannelIsDrum(insertIndex);\r\n        group.append(new ChangeAddChannel(this._doc, insertIndex+1, isNoise));\r\n        if (!group.isNoop()) {\r\n            group.append(new ChangeChannelBar(this._doc, insertIndex, this._doc.bar));\r\n            this._doc.record(group);\r\n        }\r\n\r\n        if (!isNoise && this._doc.channel < Config.pitchChannelCountMax-1) {\r\n            this._doc.channel++;\r\n        }\r\n\r\n        if (isNoise && this._doc.channel < Config.drumChannelCountMax + this._doc.song.pitchChannelCount - 1) {\r\n            this._doc.channel++;\r\n        }\r\n\r\n    }\r\n}","export class Preferences {\r\n\r\n    public static readonly defaultVisibleOctaves: number = 3;\r\n\r\n    autoPlay: boolean = localStorage.getItem(\"autoPlay\") == \"true\";\r\n\tautoFollow: boolean = localStorage.getItem(\"autoFollow\") == \"true\";\r\n\tshowFifth: boolean = localStorage.getItem(\"showFifth\") != \"false\";\r\n\tshowMore: boolean = localStorage.getItem(\"showMore\") == \"true\";\r\n\tshowLetters: boolean = localStorage.getItem(\"showLetters\") != \"false\";\r\n\tshowChannels: boolean = localStorage.getItem(\"showChannels\") == \"true\";\r\n\tshowScrollBar: boolean = localStorage.getItem(\"showScrollBar\") != \"false\";\r\n\tshowVolumeBar: boolean = localStorage.getItem(\"showVolumeBar\") == \"true\";\r\n\tadvancedSettings: boolean = localStorage.getItem(\"advancedSettings\") != \"false\";\r\n\tvisibleOctaves: number = Preferences.defaultVisibleOctaves;\r\n    layout: string = localStorage.getItem(\"layout\") || \"small\";\r\n\tvolume: number = localStorage.getItem(\"volume\") != null ? Number(localStorage.getItem(\"volume\")) : 75;\r\n\r\n    save(): void {\r\n\t\tlocalStorage.setItem(\"autoPlay\", this.autoPlay ? \"true\" : \"false\");\r\n\t\tlocalStorage.setItem(\"autoFollow\", this.autoFollow ? \"true\" : \"false\");\r\n\t\tlocalStorage.setItem(\"showFifth\", this.showFifth ? \"true\" : \"false\");\r\n\t\tlocalStorage.setItem(\"showMore\", this.showMore ? \"true\" : \"false\");\r\n\t\tlocalStorage.setItem(\"showLetters\", this.showLetters ? \"true\" : \"false\");\r\n\t\tlocalStorage.setItem(\"showChannels\", this.showChannels ? \"true\" : \"false\");\r\n\t\tlocalStorage.setItem(\"showScrollBar\", this.showScrollBar ? \"true\" : \"false\");\r\n\t\tlocalStorage.setItem(\"showVolumeBar\", this.showVolumeBar ? \"true\" : \"false\");\r\n\t\tlocalStorage.setItem(\"advancedSettings\", this.advancedSettings ? \"true\" : \"false\");\r\n\t\tlocalStorage.setItem(\"volume\", String(this.volume));\r\n\t}\r\n\r\n}","/*\r\nCopyright (C) 2018 John Nesky\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of \r\nthis software and associated documentation files (the \"Software\"), to deal in \r\nthe Software without restriction, including without limitation the rights to \r\nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \r\nof the Software, and to permit persons to whom the Software is furnished to do \r\nso, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all \r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \r\nSOFTWARE.\r\n*/\r\n\r\nimport { Synth} from \"../synth/synth\";\r\nimport { Song, Pattern  } from \"../synth/song\";\r\nimport { ChangeNotifier } from \"./ChangeNotifier\";\r\nimport { Change } from \"./Change\";\r\nimport { ChangeSong } from \"./changes\";\r\nimport { ColorConfig } from \"./ColorConfig\"; \r\nimport { Layout } from \"./Layout\";\r\nimport {Selection} from \"./Selection.js\";\r\nimport { Config } from \"../synth/SynthConfig\";\r\n\r\nimport { Preferences } from \"./Preferences\";\r\n\r\n\tinterface HistoryState {\r\n\t\tcanUndo: boolean;\r\n\t\tsequenceNumber: number;\r\n\t\tbar: number;\r\n\t\tchannel: number;\r\n\t\tprompt: string | null;\r\n\t}\r\n\t\r\n\texport class SongDocument {\r\n\t\tpublic song: Song;\r\n\t\tpublic synth: Synth;\r\n\t\tpublic notifier: ChangeNotifier = new ChangeNotifier();\r\n\t\tpublic readonly selection: Selection = new Selection(this);\r\n\t\tpublic channel: number = 0;\r\n\t\tpublic bar: number = 0;\r\n\t\tpublic trackVisibleBars: number = 16;\r\n\t\tpublic barScrollPos: number = 0;\r\n\t\tpublic prompt: string | null = null;\r\n\t\tpublic readonly prefs: Preferences = new Preferences();\r\n\t\t\r\n\t\tprivate _recentChange: Change | null = null;\r\n\t\tprivate _sequenceNumber: number = 0;\r\n\t\tprivate _barFromCurrentState: number = 0;\r\n\t\tprivate _channelFromCurrentState: number = 0;\r\n\t\tprivate _shouldPushState: boolean = false;\r\n\t\tprivate _waitingToUpdateState: boolean = false;\r\n\t\t\r\n\t\tconstructor(string?: string) {\r\n\t\t\tthis.song = new Song(string);\r\n\t\t\tthis.synth = new Synth(this.song);\r\n\r\n\t\t\tthis.synth.volume = this._calcVolume();\r\n\t\t\t\r\n\t\t\tif (this.song.setSongTheme == \"none\") {\r\n\t\t\t\tif (window.localStorage.getItem(\"modboxTheme\") != null) {\r\n\t\t\t\t\tColorConfig.setTheme(String(window.localStorage.getItem(\"modboxTheme\")));\r\n\t\t\t\t} else {\r\n\t\t\t\t\twindow.localStorage.setItem(\"modboxTheme\", \"default\");\r\n\t\t\t\t\tColorConfig.setTheme(\"default\");\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tColorConfig.setTheme(this.song.setSongTheme);\r\n\t\t\t}\r\n\r\n\t\t\tif (window.localStorage.getItem(\"layout\") != null) {\r\n\t\t\t\tLayout.setLayout(String(window.localStorage.getItem(\"layout\")));\r\n\t\t\t} else {\r\n\t\t\t\twindow.localStorage.setItem(\"layout\", \"small\");\r\n\t\t\t\tLayout.setLayout(\"small\");\r\n\t\t\t}\r\n\r\n\t\t\tlet state: HistoryState | null = window.history.state;\r\n\t\t\tif (state == null) {\r\n\t\t\t\t// When the page is first loaded, indicate that undo is NOT possible.\r\n\t\t\t\tstate = {canUndo: false, sequenceNumber: 0, bar: 0, channel: 0, prompt: null};\r\n\t\t\t\twindow.history.replaceState(state, \"\", \"#\" + this.song.toBase64String());\r\n\t\t\t}\r\n\t\t\twindow.addEventListener(\"hashchange\", this._whenHistoryStateChanged);\r\n\t\t\twindow.addEventListener(\"popstate\", this._whenHistoryStateChanged);\r\n\t\t\t\r\n\t\t\tthis.bar = state.bar;\r\n\t\t\tthis.channel = state.channel;\r\n\t\t\tthis._barFromCurrentState = state.bar;\r\n\t\t\tthis._channelFromCurrentState = state.channel;\r\n\t\t\tthis.barScrollPos = Math.max(0, this.bar - (this.trackVisibleBars - 6));\r\n\t\t\tthis.prompt = state.prompt;\r\n\t\t\t\r\n\t\t\t// For all input events, catch them when they are about to finish bubbling,\r\n\t\t\t// presumably after all handlers are done updating the model and update the\r\n\t\t\t// view before the screen renders. mouseenter and mouseleave do not bubble,\r\n\t\t\t// but they are immediately followed by mousemove which does. \r\n\t\t\tfor (const eventName of [\"input\", \"change\", \"click\", \"keyup\", \"keydown\", \"mousedown\", \"mousemove\", \"mouseup\", \"touchstart\", \"touchmove\", \"touchend\", \"touchcancel\"]) {\r\n\t\t\t\twindow.addEventListener(eventName, this._cleanDocument);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tprivate _whenHistoryStateChanged = (): void => {\r\n\t\t\tlet state: HistoryState | null = window.history.state;\r\n\t\t\t\r\n\t\t\t// We're listening for both hashchanged and popstate, which often fire together.\r\n\t\t\t// Abort if we've already handled the current state. \r\n\t\t\tif (state && state.sequenceNumber == this._sequenceNumber) return;\r\n\t\t\t\r\n\t\t\tif (state == null) {\r\n\t\t\t\t// The user changed the hash directly.\r\n\t\t\t\tthis._sequenceNumber++;\r\n\t\t\t\tstate = {canUndo: true, sequenceNumber: this._sequenceNumber, bar: this.bar, channel: this.channel, prompt: this.prompt};\r\n\t\t\t\tnew ChangeSong(this, location.hash);\r\n\t\t\t\twindow.history.replaceState(state, \"\", \"#\" + this.song.toBase64String());\r\n\t\t\t} else {\r\n\t\t\t\tif (state.sequenceNumber == this._sequenceNumber - 1) {\r\n\t\t\t\t\t// undo:\r\n\t\t\t\t\tthis.bar = this._barFromCurrentState;\r\n\t\t\t\t\tthis.channel = this._channelFromCurrentState;\r\n\t\t\t\t} else if (state.sequenceNumber != this._sequenceNumber) {\r\n\t\t\t\t\t// redo, or jump multiple steps in history:\r\n\t\t\t\t\tthis.bar = state.bar;\r\n\t\t\t\t\tthis.channel = state.channel;\r\n\t\t\t\t}\r\n\t\t\t\tthis._sequenceNumber = state.sequenceNumber;\r\n\t\t\t\tthis.prompt = state.prompt;\r\n\t\t\t\tnew ChangeSong(this, location.hash);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._barFromCurrentState = state.bar;\r\n\t\t\tthis._channelFromCurrentState = state.channel;\r\n\t\t\t\r\n\t\t\t//this.barScrollPos = Math.min(this.bar, Math.max(this.bar - (this.trackVisibleBars - 1), this.barScrollPos));\r\n\t\t\t\r\n\t\t\tthis.forgetLastChange();\r\n\t\t\tthis.notifier.notifyWatchers();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _cleanDocument = (): void => {\r\n\t\t\tthis.notifier.notifyWatchers();\r\n\t\t}\r\n\t\t\r\n\t\tprivate _updateHistoryState = (): void => {\r\n\t\t\tthis._waitingToUpdateState = false;\r\n\t\t\tconst hash: string = \"#\" + this.song.toBase64String();\r\n\t\t\tlet state: HistoryState;\r\n\t\t\tif (this._shouldPushState) {\r\n\t\t\t\tthis._sequenceNumber++;\r\n\t\t\t\tstate = {canUndo: true, sequenceNumber: this._sequenceNumber, bar: this.bar, channel: this.channel, prompt: this.prompt};\r\n\t\t\t\twindow.history.pushState(state, \"\", hash);\r\n\t\t\t} else {\r\n\t\t\t\tstate = {canUndo: true, sequenceNumber: this._sequenceNumber, bar: this.bar, channel: this.channel, prompt: this.prompt};\r\n\t\t\t\twindow.history.replaceState(state, \"\", hash);\r\n\t\t\t}\r\n\t\t\tthis._barFromCurrentState = state.bar;\r\n\t\t\tthis._channelFromCurrentState = state.channel;\r\n\t\t\tthis._shouldPushState = false;\r\n\t\t}\r\n\t\t\r\n\t\tpublic record(change: Change, replaceState: boolean = false): void {\r\n\t\t\tif (change.isNoop()) {\r\n\t\t\t\tthis._recentChange = null;\r\n\t\t\t\tif (replaceState) {\r\n\t\t\t\t\twindow.history.back();\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthis._recentChange = change;\r\n\t\t\t\tif (!replaceState) {\r\n\t\t\t\t\tthis._shouldPushState = true;\r\n\t\t\t\t}\r\n\t\t\t\tif (!this._waitingToUpdateState) {\r\n\t\t\t\t\twindow.requestAnimationFrame(this._updateHistoryState);\r\n\t\t\t\t\tthis._waitingToUpdateState = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tpublic openPrompt(prompt: string): void {\r\n\t\t\tthis.prompt = prompt;\r\n\t\t\tconst hash: string = \"#\" + this.song.toBase64String();\r\n\t\t\tthis._sequenceNumber++;\r\n\t\t\tconst state = {canUndo: true, sequenceNumber: this._sequenceNumber, bar: this.bar, channel: this.channel, prompt: this.prompt};\r\n\t\t\twindow.history.pushState(state, \"\", hash);\r\n\t\t}\r\n\t\t\r\n\t\tpublic undo(): void {\r\n\t\t\tconst state: HistoryState = window.history.state;\r\n\t\t\tif (state.canUndo) window.history.back();\r\n\t\t}\r\n\t\t\r\n\t\tpublic redo(): void {\r\n\t\t\twindow.history.forward();\r\n\t\t}\r\n\t\t\r\n\t\tpublic setProspectiveChange(change: Change | null): void {\r\n\t\t\tthis._recentChange = change;\r\n\t\t}\r\n\t\t\r\n\t\tpublic forgetLastChange(): void {\r\n\t\t\tthis._recentChange = null;\r\n\t\t}\r\n\t\t\r\n\t\tpublic lastChangeWas(change: Change | null): boolean {\r\n\t\t\treturn change != null && change == this._recentChange;\r\n\t\t}\r\n\t\t\r\n\t\tpublic setVolume(val: number): void {\r\n\t\t\tthis.prefs.volume = val;\r\n\t\t\tthis.prefs.save();\r\n\t\t\tthis.synth.volume = this._calcVolume();\r\n\t\t}\r\n\t\t\r\n\t\tpublic getMobileLayout(): boolean {\r\n\t\t\treturn window.innerWidth <= 710;\r\n\t\t}\r\n\r\n\t\tpublic getFullScreen(): boolean {\r\n\t\t\treturn !this.getMobileLayout() && (this.prefs.layout != \"small\");\r\n\t\t}\r\n\r\n\t\tprivate _calcVolume(): number {\r\n\t\t\treturn Math.min(1.0, Math.pow(this.prefs.volume / 50.0, 0.5)) * Math.pow(2.0, (this.prefs.volume - 75.0) / 25.0);\r\n\t\t}\r\n\t\t\r\n\t\tpublic getCurrentPattern(): Pattern | null {\r\n\t\t\treturn this.song.getPattern(this.channel, this.bar);\r\n\t\t}\r\n\t\t\r\n\t\tpublic getCurrentInstrument(): number {\r\n\t\t\tconst pattern: Pattern | null = this.getCurrentPattern();\r\n\t\t\treturn pattern == null ? 0 : pattern.instrument;\r\n\t\t}\r\n\r\n\t\tpublic getVisibleOctaveCount(): number {\r\n\t\treturn this.getFullScreen() ? this.prefs.visibleOctaves : Preferences.defaultVisibleOctaves;\r\n\t\t}\r\n\t\t\r\n\t\tpublic getVisiblePitchCount(): number {\r\n\t\t\treturn this.getVisibleOctaveCount() * Config.pitchesPerOctave + 1;\r\n\t\t}\r\n\r\n\t\tpublic getBaseVisibleOctave(channel: number): number {\r\n\t\tconst visibleOctaveCount: number = this.getVisibleOctaveCount();\r\n\t\treturn Math.max(0, Math.min(Config.pitchOctaves - visibleOctaveCount, Math.ceil(this.song.channels[channel].octave - visibleOctaveCount * 0.5)));\r\n\t\t}\r\n\t}\r\n\r\n","/*\r\nCopyright (C) 2018 John Nesky\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy of \r\nthis software and associated documentation files (the \"Software\"), to deal in \r\nthe Software without restriction, including without limitation the rights to \r\nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies \r\nof the Software, and to permit persons to whom the Software is furnished to do \r\nso, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all \r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR \r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, \r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER \r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, \r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE \r\nSOFTWARE.\r\n*/\r\n\r\nimport {HTML} from \"imperative-html/dist/esm/elements-strict\";\r\nimport { ColorConfig } from \"./ColorConfig\";\r\n\r\ndocument.head.appendChild(HTML.style({ type: \"text/css\" }, `\r\n\r\n:root {\r\n--drum-symbol: url('data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"32\" height=\"40\" viewBox=\"0 0 32 40\"> \\\r\n\t\t\t<defs> \\\r\n\t\t\t\t<linearGradient id=\"gold1\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"0%\"> \\\r\n\t\t\t\t\t<stop offset=\"0%\" stop-color=\"%237e3302\"/> \\\r\n\t\t\t\t\t<stop offset=\"40%\" stop-color=\"%23ffec6b\"/> \\\r\n\t\t\t\t\t<stop offset=\"100%\" stop-color=\"%237e3302\"/> \\\r\n\t\t\t\t</linearGradient> \\\r\n\t\t\t\t<linearGradient id=\"gold2\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"0%\"> \\\r\n\t\t\t\t\t<stop offset=\"0%\" stop-color=\"%23faaf7d\"/> \\\r\n\t\t\t\t\t<stop offset=\"15%\" stop-color=\"%23fffba9\"/> \\\r\n\t\t\t\t\t<stop offset=\"40%\" stop-color=\"%23ffffe3\"/> \\\r\n\t\t\t\t\t<stop offset=\"65%\" stop-color=\"%23fffba9\"/> \\\r\n\t\t\t\t\t<stop offset=\"100%\" stop-color=\"%23faaf7d\"/> \\\r\n\t\t\t\t</linearGradient> \\\r\n\t\t\t\t<radialGradient id=\"gold3\" cx=\"0%\" cy=\"0%\" r=\"100%\"> \\\r\n\t\t\t\t\t<stop offset=\"0%\" stop-color=\"%23ffffe3\"/> \\\r\n\t\t\t\t\t<stop offset=\"50%\" stop-color=\"%23ffec6b\"/> \\\r\n\t\t\t\t\t<stop offset=\"100%\" stop-color=\"%237e3302\"/> \\\r\n\t\t\t\t</radialGradient> \\\r\n\t\t\t\t<linearGradient id=\"red\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"0%\"> \\\r\n\t\t\t\t\t<stop offset=\"0%\" stop-color=\"%23641919\"/> \\\r\n\t\t\t\t\t<stop offset=\"40%\" stop-color=\"%23cd2c2c\"/> \\\r\n\t\t\t\t\t<stop offset=\"100%\" stop-color=\"%23641919\"/> \\\r\n\t\t\t\t</linearGradient> \\\r\n\t\t\t\t<radialGradient id=\"membrane\"> \\\r\n\t\t\t\t\t<stop offset=\"10%\" stop-color=\"%23cccccc\" /> \\\r\n\t\t\t\t\t<stop offset=\"90%\" stop-color=\"%23f6f6f7\" /> \\\r\n\t\t\t\t\t<stop offset=\"100%\" stop-color=\"%23999\" /> \\\r\n\t\t\t\t</radialGradient> \\\r\n\t\t\t</defs> \\\r\n\t\t\t<ellipse cx=\"16\" cy=\"26\" rx=\"16\" ry=\"14\" fill=\"rgba(0,0,0,0.5)\"/> \\\r\n\t\t\t<ellipse cx=\"16\" cy=\"25\" rx=\"16\" ry=\"14\" fill=\"url(%23gold1)\"/> \\\r\n\t\t\t<rect x=\"0\" y=\"23\" width=\"32\" height=\"2\" fill=\"url(%23gold1)\"/> \\\r\n\t\t\t<ellipse cx=\"16\" cy=\"23\" rx=\"16\" ry=\"14\" fill=\"url(%23gold2)\"/> \\\r\n\t\t\t<ellipse cx=\"16\" cy=\"23\" rx=\"15\" ry=\"13\" fill=\"url(%23red)\"/> \\\r\n\t\t\t<rect x=\"1\" y=\"17\" width=\"30\" height=\"6\" fill=\"url(%23red)\"/> \\\r\n\t\t\t<rect x=\"5\" y=\"27\" width=\"1\" height=\"5\" rx=\"0.5\" fill=\"rgba(0,0,0,0.5)\"/> \\\r\n\t\t\t<rect x=\"15\" y=\"31\" width=\"2\" height=\"5\" rx=\"1\" fill=\"rgba(0,0,0,0.5)\"/> \\\r\n\t\t\t<rect x=\"26\" y=\"27\" width=\"1\" height=\"5\" rx=\"0.5\" fill=\"rgba(0,0,0,0.5)\"/> \\\r\n\t\t\t<rect x=\"5\" y=\"26\" width=\"1\" height=\"5\" rx=\"0.5\" fill=\"url(%23gold3)\"/> \\\r\n\t\t\t<rect x=\"15\" y=\"30\" width=\"2\" height=\"5\" rx=\"1\" fill=\"url(%23gold3)\"/> \\\r\n\t\t\t<rect x=\"26\" y=\"26\" width=\"1\" height=\"5\" rx=\"0.5\" fill=\"url(%23gold3)\"/> \\\r\n\t\t\t<ellipse cx=\"16\" cy=\"18\" rx=\"15\" ry=\"13\" fill=\"rgba(0,0,0,0.5)\"/> \\\r\n\t\t\t<ellipse cx=\"16\" cy=\"16\" rx=\"16\" ry=\"14\" fill=\"url(%23gold1)\"/> \\\r\n\t\t\t<rect x=\"0\" y=\"14\" width=\"32\" height=\"2\" fill=\"url(%23gold1)\"/> \\\r\n\t\t\t<ellipse cx=\"16\" cy=\"14\" rx=\"16\" ry=\"14\" fill=\"url(%23gold2)\"/> \\\r\n\t\t\t<ellipse cx=\"16\" cy=\"14\" rx=\"15\" ry=\"13\" fill=\"url(%23membrane)\"/> \\\r\n\t\t</svg>');\r\n\t--piano-key-symbol: url('data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"32\" height=\"15\" preserveAspectRatio=\"none\" viewBox=\"0 -1 32 15\"> \\\r\n\t\t\t<defs> \\\r\n\t\t\t\t<linearGradient id=\"shadow\" x1=\"0%\" y1=\"0%\" x2=\"100%\" y2=\"0%\"> \\\r\n\t\t\t\t\t<stop offset=\"0%\" stop-color=\"rgba(0,0,0,0.5)\"/> \\\r\n\t\t\t\t\t<stop offset=\"100%\" stop-color=\"transparent\"/> \\\r\n\t\t\t\t</linearGradient> \\\r\n\t\t\t</defs> \\\r\n\t\t\t<rect x=\"-1\" y=\"1\" width=\"31\" height=\"1\" rx=\"0.6\" fill=\"rgba(255,255,255,0.4)\"/> \\\r\n\t\t\t<path d=\"M -1 11 L 30 11 L 30 2 L 33 -1 L 33 14 L -1 14 z\" fill=\"rgba(0,0,0,0.7)\"/> \\\r\n\t\t\t<rect x=\"-1\" y=\"-1\" width=\"19\" height=\"15\" fill=\"url(%23shadow)\"/> \\\r\n\t\t</svg>');\r\n}\r\n\r\nhtml {\r\nbackground: ${ColorConfig.pageMargin};\r\n}\r\n\r\n.beepboxEditor .drum-button {\r\n\tflex: 1;\r\n\tbackground-color: transparent;\r\n\tbackground-image: var(--drum-symbol);\r\n\tbackground-repeat: no-repeat;\r\n\tbackground-position: center;\r\n}\r\n\r\n.beepboxEditor .piano-button.pressed, .beepboxEditor .drum-button.pressed {\r\n\tfilter: brightness(0.5);\r\n}\r\n\r\n.beepboxEditor .piano-button {\r\n\tflex: 1;\r\n\tposition: relative;\r\n\tdisplay: flex;\r\n\talign-items: center;\r\n}\r\n.beepboxEditor .piano-button::before {\r\n\tcontent: \"\";\r\n\tposition: absolute;\r\n\tleft: 0;\r\n\ttop: 0;\r\n\twidth: 100%;\r\n\theight: 100%;\r\n\tpointer-events: none;\r\n\tbackground-image: var(--piano-key-symbol);\r\n\tbackground-repeat: no-repeat;\r\n\tbackground-position: center;\r\n\tbackground-size: 100% 115.38%;\r\n}\r\n.beepboxEditor .piano-button.disabled::after {\r\n\tcontent: \"\";\r\n\tposition: absolute;\r\n\tright: 0;\r\n\ttop: 0;\r\n\twidth: 70%;\r\n\theight: 100%;\r\n\tpointer-events: none;\r\n\tbackground: ${ColorConfig.editorBackground};\r\n\t-webkit-mask-image: linear-gradient(90deg, transparent 0%, gray 70%, gray 100%);\r\n\t-webkit-mask-repeat: no-repeat;\r\n\t-webkit-mask-position: center;\r\n\tmask-image: linear-gradient(90deg, transparent 0%, gray 70%, gray 100%);\r\n\tmask-repeat: no-repeat;\r\n\tmask-position: center;\r\n}\r\n\r\n.beepboxEditor .piano-button.pressed, .beepboxEditor .drum-button.pressed {\r\n\tfilter: brightness(0.5);\r\n}\r\n\r\n.beepboxEditor {\r\n\tdisplay: grid;\r\n\tgrid-template-areas: \"pattern-area settings-area advanced-settings-area\" \"pattern-area   song-settings-area advanced-settings-area\" \"track-area   song-settings-area advanced-settings-area\";\r\n\t-webkit-touch-callout: none;\r\n\t-webkit-user-select: none;\r\n\t-khtml-user-select: none;\r\n\t-moz-user-select: none;\r\n\t-ms-user-select: none;\r\n\tuser-select: none;\r\n\tposition: relative;\r\n\ttouch-action: manipulation;\r\n\tcursor: default;\r\n\tfont-size: small;\r\n\tbackground: ${ColorConfig.editorBackground};\r\n}\r\n\r\n.beepboxEditor .theme-option input:checked ~ * {\r\n\tcolor: #fff;\r\n}\r\n\r\n.beepboxEditor .theme-option {\r\n\tcolor: #999;\r\n}\r\n\r\n\r\n.hintButton {\r\n\twidth: 0.5em; \r\n\tdisplay: flex; \r\n\talign-items: center;\r\n}\r\n\r\n.beepboxEditor div {\r\n\tmargin: 0;\r\n\tpadding: 0;\r\n}\r\n\r\n.beepboxEditor .promptContainer {\r\n\tposition: absolute;\r\n\ttop: 0;\r\n\tleft: 0;\r\n\twidth: 100%;\r\n\theight: 100%;\r\n\t/*background: rgba(0,0,0,0.5);*/\r\n\tdisplay: flex;\r\n\tjustify-content: center;\r\n\talign-items: center;\r\n}\r\n\r\n.beepboxEditor .prompt {\r\n\tmargin: auto;\r\n\ttext-align: center;\r\n\tbackground: ${ColorConfig.editorBackground};\r\n\tborder-radius: 15px;\r\n\tborder: 4px solid #444;\r\n\tcolor: #fff;\r\n\tpadding: 20px;\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n}\r\n\r\n.beepboxEditor .prompt > *:not(:first-child) {\r\n\tmargin-top: 1.5em;\r\n}\r\n\r\n/* Use psuedo-elements to add cross-browser up & down arrows to select elements: */\r\n.beepboxEditor .selectContainer {\r\n\tposition: relative;\r\n}\r\n.beepboxEditor .selectContainer:not(.menu)::before {\r\n\tcontent: \"\";\r\n\tposition: absolute;\r\n\tright: 0.3em;\r\n\ttop: 0.4em;\r\n\tborder-bottom: 0.4em solid currentColor;\r\n\tborder-left: 0.3em solid transparent;\r\n\tborder-right: 0.3em solid transparent;\r\n\tpointer-events: none;\r\n}\r\n.beepboxEditor .selectContainer:not(.menu)::after {\r\n\tcontent: \"\";\r\n\tposition: absolute;\r\n\tright: 0.3em;\r\n\tbottom: 0.4em;\r\n\tborder-top: 0.4em solid currentColor;\r\n\tborder-left: 0.3em solid transparent;\r\n\tborder-right: 0.3em solid transparent;\r\n\tpointer-events: none;\r\n}\r\n.beepboxEditor .selectContainer.menu::after {\r\n\tcontent: \"\";\r\n\tposition: absolute;\r\n\tright: 0.7em;\r\n\tmargin: auto;\r\n\ttop: 0;\r\n\tbottom: 0;\r\n\theight: 0;\r\n\tborder-top: 0.4em solid currentColor;\r\n\tborder-left: 0.3em solid transparent;\r\n\tborder-right: 0.3em solid transparent;\r\n\tpointer-events: none;\r\n}\r\n.beepboxEditor select {\r\n\tmargin: 0;\r\n\tpadding: 0 0.3em;\r\n\tdisplay: block;\r\n\theight: 2em;\r\n\tborder: none;\r\n\tborder-radius: 0.4em;\r\n\tbackground: ${ColorConfig.uiWidgetBackground};\r\n\tcolor: inherit;\r\n\tfont-size: inherit;\r\n\tcursor: pointer;\r\n\tfont-family: inherit;\r\n\r\n\t-webkit-appearance:none;\r\n\t-moz-appearance: none;\r\n\tappearance: none;\r\n}\r\n.beepboxEditor .menu select {\r\n\tpadding: 0 2em;\r\n}\r\n.beepboxEditor select:focus {\r\n\tbackground: ${ColorConfig.uiWidgetFocus};\r\n\toutline: none;\r\n}\r\n.beepboxEditor .menu select {\r\n\ttext-align: center;\r\n\ttext-align-last: center;\r\n}\r\n\r\n/* This makes it look better in firefox on my computer... What about others?\r\n@-moz-document url-prefix() {\r\n\t.beepboxEditor select { padding: 0 2px; }\r\n}\r\n*/\r\n.beepboxEditor button {\r\n\tmargin: 0;\r\n\tposition: relative;\r\n\theight: 2em;\r\n\tborder: none;\r\n\tborder-radius: 0.4em;\r\n\tbackground: ${ColorConfig.uiWidgetBackground};\r\n\tcolor: inherit;\r\n\tfont-size: inherit;\r\n\tfont-family: inherit;\r\n\tcursor: pointer;\r\n}\r\n.beepboxEditor .numberInput {\r\n\twidth: 3em !important;\r\n  \tmargin-left: 1em;\r\n}\r\n.beepboxEditor button:focus {\r\n\tbackground: ${ColorConfig.uiWidgetFocus};\r\n\toutline: none;\r\n}\r\n.beepboxEditor button.playButton, .beepboxEditor button.pauseButton {\r\n\tpadding-left: 2em;\r\n}\r\n.beepboxEditor button.playButton::before {\r\n\tcontent: \"\";\r\n\tposition: absolute;\r\n\tleft: 0.7em;\r\n\ttop: 50%;\r\n\tmargin-top: -0.65em;\r\n\tborder-left: 1em solid currentColor;\r\n\tborder-top: 0.65em solid transparent;\r\n\tborder-bottom: 0.65em solid transparent;\r\n\tpointer-events: none;\r\n}\r\n.beepboxEditor button.pauseButton::before {\r\n\tcontent: \"\";\r\n\tposition: absolute;\r\n\tleft: 0.7em;\r\n\ttop: 50%;\r\n\tmargin-top: -0.65em;\r\n\twidth: 0.3em;\r\n\theight: 1.3em;\r\n\tbackground: currentColor;\r\n\tpointer-events: none;\r\n}\r\n.beepboxEditor button.pauseButton::after {\r\n\tcontent: \"\";\r\n\tposition: absolute;\r\n\tleft: 1.4em;\r\n\ttop: 50%;\r\n\tmargin-top: -0.65em;\r\n\twidth: 0.3em;\r\n\theight: 1.3em;\r\n\tbackground: currentColor;\r\n\tpointer-events: none;\r\n}\r\n\r\n.beepboxEditor button.prevBarButton::before {\r\n\tcontent: \"\";\r\n\tposition: absolute;\r\n\tleft: 50%;\r\n\ttop: 50%;\r\n\tmargin-left: -0.5em;\r\n\tmargin-top: -0.5em;\r\n\twidth: 0.2em;\r\n\theight: 1em;\r\n\tbackground: currentColor;\r\n\tpointer-events: none;\r\n}\r\n.beepboxEditor button.prevBarButton::after {\r\n\tcontent: \"\";\r\n\tposition: absolute;\r\n\tleft: 50%;\r\n\ttop: 50%;\r\n\tmargin-left: -0.3em;\r\n\tmargin-top: -0.5em;\r\n\tborder-right: 0.8em solid currentColor;\r\n\tborder-top: 0.5em solid transparent;\r\n\tborder-bottom: 0.5em solid transparent;\r\n\tpointer-events: none;\r\n}\r\n\r\n.beepboxEditor .song-settings-area {\r\n\tgrid-area: song-settings-area;\r\n}\r\n\r\n.beepboxEditor button.nextBarButton::before {\r\n\tcontent: \"\";\r\n\tposition: absolute;\r\n\tleft: 50%;\r\n\ttop: 50%;\r\n\tmargin-left: -0.5em;\r\n\tmargin-top: -0.5em;\r\n\tborder-left: 0.8em solid currentColor;\r\n\tborder-top: 0.5em solid transparent;\r\n\tborder-bottom: 0.5em solid transparent;\r\n\tpointer-events: none;\r\n}\r\n.beepboxEditor button.nextBarButton::after {\r\n\tcontent: \"\";\r\n\tposition: absolute;\r\n\tleft: 50%;\r\n\ttop: 50%;\r\n\tmargin-left: 0.3em;\r\n\tmargin-top: -0.5em;\r\n\twidth: 0.2em;\r\n\theight: 1em;\r\n\tbackground: currentColor;\r\n\tpointer-events: none;\r\n}\r\n\r\n.beepboxEditor canvas {\r\n\toverflow: hidden;\r\n\tposition: absolute;\r\n\tdisplay: block;\r\n}\r\n\r\n.beepboxEditor .trackContainer {\r\n\toverflow-x: hidden;\r\n}\r\n\r\n.beepboxEditor .trackAndMuteContainer {\r\n\tdisplay: flex;\r\n\talign-items: flex-start;\r\n\twidth: 100%;\r\n\tmin-height: 0;\r\n\tflex: 1;\r\n\toverflow-x: hidden;\r\n\tposition: relative;\r\n}\r\n\r\n.beepboxEditor .selectRow {\r\n\tmargin: 0;\r\n\theight: 2.5em;\r\n\tdisplay: flex;\r\n\tflex-direction: row;\r\n\talign-items: center;\r\n\tjustify-content: space-between;\r\n}\r\n\r\n.beepboxEditor .selectRow > span {\r\n\tcolor: ${ColorConfig.secondaryText};\r\n}\r\n\r\n.beepboxEditor .inputRow {\r\n\tmargin: 0;\r\n\theight: 2.5em;\r\n\tdisplay: flex;\r\n\tflex-direction: row;\r\n\talign-items: center;\r\n\tjustify-content: space-between;\r\n}\r\n\r\n.beepboxEditor .inputRow > span {\r\n\tcolor: ${ColorConfig.secondaryText};\r\n}\r\n\r\n.beepboxEditor .operatorRow {\r\n\tmargin: 0;\r\n\theight: 2.5em;\r\n\tdisplay: flex;\r\n\tflex-direction: row;\r\n\talign-items: center;\r\n}\r\n\r\n.beepboxEditor .operatorRow > * {\r\n\tflex-grow: 1;\r\n\tflex-shrink: 1;\r\n}\r\n\r\n.beepboxEditor .settings-area {\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n}\r\n\r\n.beepboxEditor .editor-widgets {\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n}\r\n\r\n.beepboxEditor .editor-menus {\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n}\r\n\r\n.beepboxEditor .editor-settings {\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n\tmargin-left: 6px;\r\n}\r\n\r\n.beepboxEditor .layout-option {\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n\tcursor: pointer;\r\n\tcolor: ${ColorConfig.secondaryText};\r\n\twidth: 25%;\r\n}\r\n\r\n.beepboxEditor .layout-option input {\r\n\tdisplay: none;\r\n}\r\n\r\n.beepboxEditor .layout-option input:checked ~ * {\r\n\tcolor: ${ColorConfig.primaryText};\r\n}\r\n\r\n.beepboxEditor .editor-song-settings {\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n}\r\n\r\n.beepboxEditor .editor-instrument-settings {\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n}\r\n.beepboxEditor .advanced-settings-area {\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n\tgrid-area: advanced-settings-area;\r\n}\r\n\r\n.beepboxEditor .editorBox {\r\n\tgrid-area: pattern-area;\r\n}\r\n\r\n.beepboxEditor .track-area {\r\n\tgrid-area: track-area;\r\n}\r\n\r\n.beepboxEditor .editor-right-menus {\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n}\r\n\r\n.beepboxEditor .editor-right-settings {\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n}\r\n\r\n.beepboxEditor .editor-right-song-settings {\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n}\r\n\r\n.beepboxEditor .editor-right-instrument-settings {\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n}\r\n\r\n.beepboxEditor .editor-right-side-top > *, .beepboxEditor .editor-right-side-bottom > * {\r\n\tflex-shrink: 0;\r\n}\r\n\r\n.beepboxEditor input[type=text], .beepboxEditor input[type=number] {\r\n\tfont-size: inherit;\r\n\tbackground: transparent;\r\n\tborder: 1px solid #777;\r\n\tcolor: white;\r\n}\r\n\r\n.beepboxEditor input[type=checkbox] {\r\n  transform: scale(1.5);\r\n}\r\n\r\n.beepboxEditor input[type=range] {\r\n\t-webkit-appearance: none;\r\n\tcolor: inherit;\r\n\twidth: 100%;\r\n\theight: 2em;\r\n\tfont-size: inherit;\r\n\tmargin: 0;\r\n\tcursor: pointer;\r\n\tbackground-color: ${ColorConfig.editorBackground};\r\n\ttouch-action: pan-y;\r\n}\r\n.beepboxEditor input[type=range]:focus {\r\n\toutline: none;\r\n}\r\n.beepboxEditor input[type=range]::-webkit-slider-runnable-track {\r\n\twidth: 100%;\r\n\theight: 0.5em;\r\n\tcursor: pointer;\r\n\tbackground: ${ColorConfig.uiWidgetBackground};\r\n}\r\n.beepboxEditor input[type=range]::-webkit-slider-thumb {\r\n\theight: 2em;\r\n\twidth: 0.5em;\r\n\tborder-radius: 0.25em;\r\n\tbackground: currentColor;\r\n\tcursor: pointer;\r\n\t-webkit-appearance: none;\r\n\tmargin-top: -0.75em;\r\n}\r\n.beepboxEditor input[type=range]:focus::-webkit-slider-runnable-track {\r\n\tbackground: ${ColorConfig.uiWidgetFocus};\r\n}\r\n.beepboxEditor input[type=range]::-moz-range-track {\r\n\twidth: 100%;\r\n\theight: 0.5em;\r\n\tcursor: pointer;\r\n\tbackground: ${ColorConfig.uiWidgetBackground};\r\n}\r\n.beepboxEditor input[type=range]:focus::-moz-range-track {\r\n\tbackground: ${ColorConfig.uiWidgetFocus};\r\n}\r\n.beepboxEditor input[type=range]::-moz-range-thumb {\r\n\theight: 2em;\r\n\twidth: 0.5em;\r\n\tborder-radius: 0.25em;\r\n\tborder: none;\r\n\tbackground: currentColor;\r\n\tcursor: pointer;\r\n}\r\n.beepboxEditor input[type=range]::-ms-track {\r\n\twidth: 100%;\r\n\theight: 0.5em;\r\n\tcursor: pointer;\r\n\tbackground: ${ColorConfig.uiWidgetBackground};\r\n\tborder-color: transparent;\r\n}\r\n.beepboxEditor input[type=range]:focus::-ms-track {\r\n\tbackground: ${ColorConfig.uiWidgetFocus};\r\n}\r\n.beepboxEditor input[type=range]::-ms-thumb {\r\n\theight: 2em;\r\n\twidth: 0.5em;\r\n\tborder-radius: 0.25em;\r\n\tbackground: currentColor;\r\n\tcursor: pointer;\r\n}\r\n.beepboxEditor .hintButton {\r\n\tborder: 1px solid currentColor;\r\n\tborder-radius: 50%;\r\n\ttext-decoration: none;\r\n\theight: 1em;\r\n\ttext-align: center;\r\n\tmargin-right: .4em;\r\n\tcursor: pointer;\r\n}\r\n\r\n/* wide screen */\r\n@media (min-width: 501px) {\r\n\t#beepboxEditorContainer {\r\n\t\tdisplay: table;\r\n\t}\r\n\t.beepboxEditor {\r\n\t\tflex-direction: row;\r\n\t}\r\n\t.beepboxEditor:focus-within {\r\n\t\toutline: 3px solid #555;\r\n\t}\r\n\t.beepboxEditor .trackContainer {\r\n\t\twidth: 512px;\r\n\t\tgrid-area: track-editor;\r\n\t}\r\n\t.beepboxEditor .trackSelectBox {\r\n\t\tdisplay: none;\r\n\t}\r\n\t.beepboxEditor .playback-controls {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t}\r\n\t.beepboxEditor .playback-bar-controls {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: row;\r\n\t\tmargin: .2em 0;\r\n\t}\r\n\t.beepboxEditor .playback-volume-controls {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: row;\r\n\t\tmargin: .2em 0;\r\n\t\talign-items: center;\r\n\t}\r\n\t.beepboxEditor .pauseButton, .beepboxEditor .playButton {\r\n\t\tflex-grow: 1;\r\n\t}\r\n\t.beepboxEditor .nextBarButton, .beepboxEditor .prevBarButton {\r\n\t\tflex-grow: 1;\r\n\t\tmargin-left: 10px;\r\n\t}\r\n\t.beepboxEditor .settings-area {\r\n\t\tmargin-left: 6px;\r\n\t\twidth: 14em;\r\n\t\tflex-direction: column;\r\n\t\tgrid-area: settings-area;\r\n\t}\r\n\t.beepboxEditor .advanced-settings-area {\r\n\t\tmargin-left: 6px;\r\n\t\twidth: 14em;\r\n\t\tflex-direction: column;\r\n\t}\r\n\t.beepboxEditor .editor-widgets {\r\n\t\tflex-grow: 1;\r\n\t}\r\n\t.beepboxEditor .editor-right-widgets {\r\n\t\tflex-grow: 1;\r\n\t}\r\n\t.beepboxEditor .editor-settings input, .beepboxEditor .editor-settings select {\r\n\t\twidth: 8.6em;\r\n\t}\r\n\t.beepboxEditor .editor-right-settings input, .beepboxEditor .editor-right-settings select {\r\n\t\twidth: 8.6em;\r\n\t}\r\n\t.beepboxEditor .editor-menus > * {\r\n\t\tflex-grow: 1;\r\n\t\tmargin: .2em 0;\r\n\t}\r\n\t.beepboxEditor .editor-right-menus > * {\r\n\t\tflex-grow: 1;\r\n\t\tmargin: .2em 0;\r\n\t}\r\n\t.beepboxEditor .editor-menus > button {\r\n\t\tpadding: 0 2em;\r\n\t\twhite-space: nowrap;\r\n\t}\r\n\t.beepboxEditor .editor-right-menus > button {\r\n\t\tpadding: 0 2em;\r\n\t\twhite-space: nowrap;\r\n\t}\r\n}\r\n\r\n/* narrow screen */\r\n@media (max-width: 500px) {\r\n\t.beepboxEditor {\r\n\t\tflex-direction: column;\r\n\t}\r\n\t.beepboxEditor:focus-within {\r\n\t\toutline: none;\r\n\t}\r\n\t.beepboxEditor .editorBox {\r\n\t\tmax-height: 75vh;\r\n\t\tgrid-area: pattern-area;\r\n\t}\r\n\t.beepboxEditor .editor-menus {\r\n\t\tflex-direction: row;\r\n\t}\r\n\t.beepboxEditor .editor-right-menus {\r\n\t\tflex-direction: row;\r\n\t}\r\n\t.beepboxEditor .editor-menus > * {\r\n\t\tflex-grow: 1;\r\n\t\tmargin: .10em;\r\n\t}\r\n\t.beepboxEditor .editor-right-menus > * {\r\n\t\tflex-grow: 1;\r\n\t\tmargin: .2em;\r\n\t}\r\n\t.beepboxEditor .editor-menus > button {\r\n\t\tpadding-left: 2em;\r\n\t\twhite-space: nowrap;\r\n\t}\r\n\t.beepboxEditor .editor-right-menus > button {\r\n\t\tpadding-left: 2em;\r\n\t\twhite-space: nowrap;\r\n\t}\r\n\t.beepboxEditor .trackContainer {\r\n\t\toverflow-x: auto;\r\n\t}\r\n\t.beepboxEditor .barScrollBar {\r\n\t\tdisplay: none;\r\n\t}\r\n\t.beepboxEditor .playback-controls {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: row;\r\n\t\tmargin: .2em 0;\r\n\t}\r\n\t.beepboxEditor .playback-bar-controls {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: row;\r\n\t\tflex-grow: 1;\r\n\t}\r\n\t.beepboxEditor .playback-volume-controls {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: row;\r\n\t\talign-items: center;\r\n\t\tflex-grow: 1;\r\n\t\tmargin: 0 .2em;\r\n\t}\r\n\t.beepboxEditor .settings-area {\r\n\t\tflex-direction: column-reverse;\r\n\t}\r\n\t.beepboxEditor .editor-settings {\r\n\t\tflex-direction: row;\r\n\t\tmargin-left: 6px;\r\n\t}\r\n\t.beepboxEditor .advanced-settings-area {\r\n\t\tflex-direction: column-reverse;\r\n\t}\r\n\t.beepboxEditor .editor-right-settings {\r\n\t\tflex-direction: row;\r\n\t}\r\n\t.beepboxEditor .pauseButton, .beepboxEditor .playButton,\r\n\t.beepboxEditor .nextBarButton, .beepboxEditor .prevBarButton {\r\n\t\tflex-grow: 1;\r\n\t\tmargin: 0 .2em;\r\n\t}\r\n\t.beepboxEditor .editor-song-settings, .beepboxEditor .editor-instrument-settings {\r\n\t\tflex-grow: 1;\r\n\t\tmargin: 0 .2em;\r\n\t}\r\n\t.beepboxEditor .editor-right-song-settings, .beepboxEditor .editor-right-instrument-settings {\r\n\t\tflex-grow: 1;\r\n\t\tmargin: 0 .2em;\r\n\t}\r\n\t.beepboxEditor .editor-settings input, .beepboxEditor .editor-settings .selectContainer {\r\n\t\twidth: 60%;\r\n\t}\r\n\t.beepboxEditor .editor-right-settings input, .beepboxEditor .editor-right-settings .selectContainer {\r\n\t\twidth: 60%;\r\n\t}\r\n\t.beepboxEditor .editor-settings select {\r\n\t\twidth: 100%;\r\n\t}\r\n\t.beepboxEditor .editor-right-settings select {\r\n\t\twidth: 100%;\r\n\t}\r\n\t.fullWidthOnly {\r\n\t\tdisplay: none;\r\n\t}\r\n\tp {\r\n\t\tmargin: 1em 0.5em;\r\n\t}\r\n}\r\n`));\r\n\t\r\n","// Copyright (c) 2012-2022 John Nesky and contributing authors, distributed under the MIT license, see accompanying the LICENSE.md file.\r\n\r\nimport {InstrumentType, Config} from \"../synth/SynthConfig\";\r\nimport {isMobile, SongEditor} from \"./SongEditor\";\r\nimport {Synth} from \"../synth/synth\";\r\nimport {Instrument, Channel, NotePin, Note, Pattern, Song } from \"../synth/song\";\r\nimport {SongDocument} from \"./SongDocument\";\r\nimport {ExportPrompt} from \"./ExportPrompt\";\r\nimport \"./style\"; // Import for the side effects, there's no exports.\r\n\r\nconst doc: SongDocument = new SongDocument(location.hash);\r\nconst editor: SongEditor = new SongEditor(doc);\r\nconst beepboxEditorContainer: HTMLElement = document.getElementById(\"beepboxEditorContainer\")!;\r\nbeepboxEditorContainer.appendChild(editor.mainLayer);\r\neditor.whenUpdated();\r\neditor.mainLayer.focus();\r\n\r\nif (!isMobile && doc.prefs.autoPlay) {\r\n\tfunction autoplay(): void {\r\n\t\tif (!document.hidden) {\r\n\t\t\tdoc.synth.play();\r\n\t\t\teditor.updatePlayButton();\r\n\t\t\twindow.removeEventListener(\"visibilitychange\", autoplay);\r\n\t\t}\r\n\t}\r\n\tif (document.hidden) {\r\n\t\t// Wait until the tab is visible to autoplay:\r\n\t\twindow.addEventListener(\"visibilitychange\", autoplay);\r\n\t} else {\r\n\t\tautoplay();\r\n\t}\r\n}\r\n\r\n// BeepBox uses browser history state as its own undo history. Browsers typically\r\n// remember scroll position for each history state, but BeepBox users would prefer not \r\n// auto scrolling when undoing. Sadly this tweak doesn't work on Edge or IE.\r\nif (\"scrollRestoration\" in history) history.scrollRestoration = \"manual\";\r\n\r\neditor.updatePlayButton();\r\n\r\nif (\"serviceWorker\" in navigator) {\r\n\tnavigator.serviceWorker.register(\"/service_worker.js\", {updateViaCache: \"all\", scope: \"/\"}).catch(() => {});\r\n}\r\n\r\n// When compiling synth.ts as a standalone module named \"beepbox\", expose these classes as members to JavaScript:\r\nexport {InstrumentType, Config, NotePin, Note, Pattern, Instrument, Channel, Song, Synth, SongDocument, SongEditor, ExportPrompt};\r\n"],"mappings":"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","ignoreList":[]}